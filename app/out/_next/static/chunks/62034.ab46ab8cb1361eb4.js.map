{"version":3,"file":"static/chunks/62034.ab46ab8cb1361eb4.js","mappings":"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","sources":["webpack://_N_E/./charts/bar/rendering-utils.ts","webpack://_N_E/./charts/bar/show-values-utils.ts","webpack://_N_E/./charts/bar/bars.tsx","webpack://_N_E/./charts/bar/bars-grouped.tsx","webpack://_N_E/./charts/bar/bars-grouped-state-props.ts","webpack://_N_E/./charts/bar/constants.ts","webpack://_N_E/./charts/bar/bars-grouped-state.tsx","webpack://_N_E/./charts/bar/bars-stacked.tsx","webpack://_N_E/./charts/bar/bars-stacked-state-props.ts","webpack://_N_E/./charts/bar/bars-stacked-state.tsx","webpack://_N_E/./charts/bar/bars-state-props.ts","webpack://_N_E/./charts/bar/bars-state.tsx","webpack://_N_E/./charts/bar/overlay-bars.tsx","webpack://_N_E/./charts/shared/axis-height-band.tsx","webpack://_N_E/./charts/shared/limits/horizontal.tsx","webpack://_N_E/./charts/bar/chart-bar.tsx","webpack://_N_E/./charts/shared/axis-width-linear.tsx","webpack://_N_E/./charts/shared/overlay-rects.tsx","webpack://_N_E/./configurator/interactive-filters/time-slider.tsx","webpack://_N_E/../node_modules/d3-shape/src/offset/diverging.js","webpack://_N_E/../node_modules/d3-shape/src/order/ascending.js","webpack://_N_E/../node_modules/d3-shape/src/order/descending.js","webpack://_N_E/../node_modules/d3-shape/src/order/none.js","webpack://_N_E/../node_modules/d3-shape/src/order/reverse.js","webpack://_N_E/../node_modules/d3-shape/src/offset/none.js","webpack://_N_E/../node_modules/d3-shape/src/stack.js"],"sourcesContent":["import { getContrastingColor } from \"@uiw/react-color\";\nimport { select, Selection } from \"d3-selection\";\nimport { Series } from \"d3-shape\";\nimport { useCallback } from \"react\";\n\nimport { StackedBarsState } from \"@/charts/bar/bars-stacked-state\";\nimport { hasSegmentAnnotation } from \"@/charts/shared/annotation-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport {\n  setSegmentValueLabelProps,\n  setSegmentWrapperValueLabelProps,\n} from \"@/charts/shared/render-value-labels\";\nimport {\n  maybeTransition,\n  RenderOptions,\n  toggleFocusBorder,\n} from \"@/charts/shared/rendering-utils\";\nimport { getChartConfig, useDefinitiveFilters } from \"@/config-utils\";\nimport { useConfiguratorState } from \"@/configurator/configurator-state\";\nimport { Observation } from \"@/domain/data\";\nimport { getTextWidth } from \"@/utils/get-text-width\";\n\nexport type RenderBarDatum = {\n  key: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  color: string;\n  focused?: boolean;\n  valueLabel?: string;\n  valueLabelColor?: string;\n  observation: Observation;\n  segment?: string;\n  valueLabelOffset?: number;\n};\n\nexport const useGetRenderStackedBarDatum = () => {\n  const {\n    colors,\n    showValuesBySegmentMapping,\n    valueLabelFormatter,\n    xScale,\n    yScale,\n    getY,\n    getRenderingKey,\n  } = useChartState() as StackedBarsState;\n  const [state] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n  const definitiveFilters = useDefinitiveFilters();\n  const bandwidth = yScale.bandwidth();\n\n  return useCallback(\n    (s: Series<{ [key: string]: number }, string>) => {\n      const segment = s.key;\n      const color = colors(segment);\n\n      return s.map((d) => {\n        const observation = d.data;\n        const value = observation[segment];\n        const valueLabel =\n          segment && showValuesBySegmentMapping[segment]\n            ? valueLabelFormatter(value)\n            : undefined;\n        const valueLabelColor = valueLabel\n          ? getContrastingColor(color)\n          : undefined;\n        const x = xScale(d[0]);\n        const yRaw = getY(observation);\n        const y = yScale(yRaw) as number;\n\n        const hasAnnotation = hasSegmentAnnotation(\n          observation,\n          segment,\n          chartConfig,\n          definitiveFilters\n        );\n\n        const valueLabelOffset =\n          hasAnnotation && valueLabel\n            ? -(getTextWidth(valueLabel, { fontSize: 12 }) + 2)\n            : 0;\n\n        return {\n          key: getRenderingKey(observation, segment),\n          y,\n          x,\n          height: bandwidth,\n          width: Math.min(0, x - xScale(d[1])) * -1,\n          color,\n          valueLabel,\n          valueLabelColor,\n          observation,\n          segment,\n          valueLabelOffset,\n        } satisfies RenderBarDatum;\n      });\n    },\n    [\n      bandwidth,\n      colors,\n      getRenderingKey,\n      getY,\n      showValuesBySegmentMapping,\n      valueLabelFormatter,\n      xScale,\n      yScale,\n      chartConfig,\n      definitiveFilters,\n    ]\n  );\n};\n\ntype RenderBarOptions = RenderOptions & {\n  x0: number;\n};\n\nexport const renderBars = (\n  g: Selection<SVGGElement, null, SVGGElement, unknown>,\n  data: RenderBarDatum[],\n  options: RenderBarOptions\n) => {\n  const { transition, x0 } = options;\n\n  g.selectAll<SVGGElement, RenderBarDatum>(\"g.bar\")\n    .data(data, (d) => d.key)\n    .join(\n      (enter) =>\n        enter\n          .append(\"g\")\n          .attr(\"class\", \"bar\")\n          .call((g) =>\n            g\n              .append(\"rect\")\n              .attr(\"data-index\", (_, i) => i)\n              .attr(\"y\", (d) => d.y)\n              .attr(\"x\", x0)\n              .attr(\"width\", 0)\n              .attr(\"height\", (d) => d.height)\n              .attr(\"fill\", (d) => d.color)\n              .call((enter) =>\n                maybeTransition(enter, {\n                  transition,\n                  s: (g) =>\n                    g.attr(\"x\", (d) => d.x).attr(\"width\", (d) => d.width),\n                })\n              )\n          )\n          .call((g) =>\n            g\n              .append(\"foreignObject\")\n              .attr(\"x\", x0)\n              .attr(\"y\", (d) => d.y)\n              .attr(\"width\", (d) => d.width)\n              .attr(\"height\", (d) => d.height)\n              .call((g) =>\n                maybeTransition(g, {\n                  transition,\n                  s: (g) => g.attr(\"x\", (d) => d.x + (d.valueLabelOffset ?? 0)),\n                })\n              )\n              .append(\"xhtml:div\")\n              .call(setSegmentWrapperValueLabelProps)\n              .append(\"xhtml:p\")\n              .call(setSegmentValueLabelProps)\n              .style(\"color\", function (d) {\n                return d.valueLabelColor ?? select(this).style(\"color\");\n              })\n              .text((d) => d.valueLabel ?? \"\")\n          ),\n      (update) => {\n        toggleFocusBorder(update.select(\"rect\"));\n\n        return maybeTransition(update, {\n          s: (g) =>\n            g\n              .call((g) =>\n                g\n                  .select(\"rect\")\n                  .attr(\"x\", (d) => d.x)\n                  .attr(\"y\", (d) => d.y)\n                  .attr(\"width\", (d) => d.width)\n                  .attr(\"height\", (d) => d.height)\n                  .attr(\"fill\", (d) => d.color)\n              )\n              .call((g) =>\n                g\n                  .select(\"foreignObject\")\n                  .attr(\"x\", (d) => d.x + (d.valueLabelOffset ?? 0))\n                  .attr(\"y\", (d) => d.y)\n                  .attr(\"width\", (d) => d.width)\n                  .attr(\"height\", (d) => d.height)\n                  .select(\"p\")\n                  .style(\"color\", function (d) {\n                    return d.valueLabelColor ?? select(this).style(\"color\");\n                  })\n                  .text((d) => d.valueLabel ?? \"\")\n              ),\n          transition,\n        });\n      },\n      (exit) =>\n        maybeTransition(exit, {\n          transition,\n          s: (g) =>\n            g\n              .call((g) => g.select(\"rect\").attr(\"x\", x0).attr(\"width\", 0))\n              .remove(),\n        })\n    );\n};\n","import { useMemo } from \"react\";\n\nimport { BarsState } from \"@/charts/bar/bars-state\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { RenderTotalValueLabelDatum } from \"@/charts/shared/render-value-labels\";\nimport { truthy } from \"@/domain/types\";\n\nexport const useBarValueLabelsData = () => {\n  const {\n    bounds: { width, height },\n    showValues,\n    renderEveryNthValue,\n    chartData,\n    getRenderingKey,\n    xScale,\n    getX,\n    yScale,\n    getY,\n    valueLabelFormatter,\n    getValueOffset,\n  } = useChartState() as BarsState;\n  const bandwidth = yScale.bandwidth();\n  const valueLabelsData = useMemo(() => {\n    if (!showValues || !width || !height) {\n      return [];\n    }\n\n    return chartData\n      .map((d, i) => {\n        if (i % renderEveryNthValue !== 0) {\n          return null;\n        }\n\n        const key = getRenderingKey(d);\n        const valueRaw = getX(d);\n        const value = valueRaw === null || isNaN(valueRaw) ? 0 : valueRaw;\n        const xScaled = xScale(Math.max(value, 0));\n        const yRender = yScale(getY(d)) as number;\n        const valueOffset = getValueOffset(d);\n\n        return {\n          key,\n          x: xScaled + valueOffset,\n          y: yRender + bandwidth / 2,\n          valueLabel: valueLabelFormatter(value),\n        } satisfies RenderTotalValueLabelDatum;\n      })\n      .filter(truthy);\n  }, [\n    showValues,\n    width,\n    height,\n    chartData,\n    renderEveryNthValue,\n    getRenderingKey,\n    getX,\n    xScale,\n    yScale,\n    getY,\n    bandwidth,\n    valueLabelFormatter,\n    getValueOffset,\n  ]);\n\n  return valueLabelsData;\n};\n","import { useEffect, useMemo, useRef } from \"react\";\n\nimport { BarsState } from \"@/charts/bar/bars-state\";\nimport { RenderBarDatum, renderBars } from \"@/charts/bar/rendering-utils\";\nimport { useBarValueLabelsData } from \"@/charts/bar/show-values-utils\";\nimport { useGetAnnotationRenderState } from \"@/charts/shared/annotation-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { renderTotalValueLabels } from \"@/charts/shared/render-value-labels\";\nimport {\n  renderContainer,\n  RenderContainerOptions,\n  renderHorizontalWhisker,\n  RenderHorizontalWhiskerDatum,\n} from \"@/charts/shared/rendering-utils\";\nimport { useChartTheme } from \"@/charts/shared/use-chart-theme\";\nimport { useTransitionStore } from \"@/stores/transition\";\n\nexport const ErrorWhiskers = () => {\n  const {\n    getY,\n    getXErrorPresent,\n    getXErrorRange,\n    chartData,\n    yScale,\n    xScale,\n    showXUncertainty,\n    bounds,\n  } = useChartState() as BarsState;\n  const { margins, width, chartHeight } = bounds;\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const renderData = useMemo(() => {\n    if (!getXErrorRange || !showXUncertainty) {\n      return [];\n    }\n\n    const bandwidth = yScale.bandwidth();\n\n    return chartData.filter(getXErrorPresent).map((d, i) => {\n      const y0 = yScale(getY(d)) as number;\n      const barHeight = Math.min(bandwidth, 16);\n      const [x1, x2] = getXErrorRange(d);\n\n      return {\n        key: `${i}`,\n        y: y0 + bandwidth / 2 - barHeight / 2,\n        x1: xScale(x1),\n        x2: xScale(x2),\n        height: barHeight,\n      } satisfies RenderHorizontalWhiskerDatum;\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    chartData,\n    getY,\n    getXErrorPresent,\n    getXErrorRange,\n    showXUncertainty,\n    xScale,\n    yScale,\n    width,\n    chartHeight,\n  ]);\n\n  useEffect(() => {\n    if (ref.current) {\n      renderContainer(ref.current, {\n        id: \"bars-error-whiskers\",\n        transform: `translate(${margins.left} ${margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g, opts) => renderHorizontalWhisker(g, renderData, opts),\n      });\n    }\n  }, [\n    enableTransition,\n    margins.left,\n    margins.top,\n    renderData,\n    transitionDuration,\n  ]);\n\n  return <g ref={ref} />;\n};\n\nexport const Bars = () => {\n  const {\n    chartData,\n    bounds: { width, margins },\n    getX,\n    xScale,\n    yDimension,\n    getY,\n    yScale,\n    getRenderingKey,\n    colors,\n    rotateValues,\n  } = useChartState() as BarsState;\n  const { labelFontSize, fontFamily } = useChartTheme();\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const bandwidth = yScale.bandwidth();\n  const x0 = xScale(0);\n  const getAnnotationRenderState = useGetAnnotationRenderState();\n  const renderData = useMemo(() => {\n    return chartData.map((d) => {\n      const key = getRenderingKey(d);\n      const y = getY(d);\n      const yScaled = yScale(y) as number;\n      const xRaw = getX(d);\n      const x = xRaw === null || isNaN(xRaw) ? 0 : xRaw;\n      const xScaled = xScale(x);\n      const xRender = xScale(Math.min(x, 0));\n      const width = Math.max(0, Math.abs(xScaled - x0));\n      const { color, focused } = getAnnotationRenderState(d, {\n        axisComponentId: yDimension.id,\n        axisValue: y,\n      });\n\n      return {\n        key,\n        x: xRender,\n        y: yScaled,\n        width,\n        height: bandwidth,\n        // Calling colors(key) directly results in every key being added to the domain,\n        // which is not what we want.\n        color: color ?? colors.copy()(key),\n        focused,\n        observation: d,\n      } satisfies RenderBarDatum;\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    width,\n    chartData,\n    bandwidth,\n    getX,\n    getY,\n    xScale,\n    yScale,\n    x0,\n    getRenderingKey,\n    getAnnotationRenderState,\n    yDimension.id,\n    colors,\n  ]);\n\n  const valueLabelsData = useBarValueLabelsData();\n\n  useEffect(() => {\n    const g = ref.current;\n\n    if (g) {\n      const common: Pick<\n        RenderContainerOptions,\n        \"id\" | \"transform\" | \"transition\"\n      > = {\n        id: \"bars\",\n        transform: `translate(${margins.left} ${margins.top})`,\n        transition: {\n          enable: enableTransition,\n          duration: transitionDuration,\n        },\n      };\n      renderContainer(g, {\n        ...common,\n        render: (g, opts) => renderBars(g, renderData, { ...opts, x0 }),\n      });\n      renderContainer(g, {\n        ...common,\n        render: (g, opts) =>\n          renderTotalValueLabels(g, valueLabelsData, {\n            ...opts,\n            rotate: rotateValues,\n            textAnchor: \"start\",\n            dx: 6,\n            dy: 4,\n            fontFamily,\n            fontSize: labelFontSize,\n          }),\n      });\n    }\n  }, [\n    enableTransition,\n    fontFamily,\n    labelFontSize,\n    margins.left,\n    margins.top,\n    renderData,\n    rotateValues,\n    transitionDuration,\n    valueLabelsData,\n    x0,\n  ]);\n\n  return <g ref={ref} />;\n};\n","import { useEffect, useMemo, useRef } from \"react\";\n\nimport { GroupedBarsState } from \"@/charts/bar/bars-grouped-state\";\nimport { RenderBarDatum, renderBars } from \"@/charts/bar/rendering-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport {\n  renderContainer,\n  renderHorizontalWhisker,\n  RenderHorizontalWhiskerDatum,\n} from \"@/charts/shared/rendering-utils\";\nimport { useTransitionStore } from \"@/stores/transition\";\n\nexport const ErrorWhiskers = () => {\n  const {\n    bounds,\n    xScale,\n    yScaleIn,\n    getXErrorRange,\n    getXErrorPresent,\n    yScale,\n    getSegment,\n    grouped,\n    showXUncertainty,\n  } = useChartState() as GroupedBarsState;\n  const { margins, width, height } = bounds;\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const renderData = useMemo(() => {\n    if (!getXErrorRange || !showXUncertainty) {\n      return [];\n    }\n\n    const bandwidth = yScaleIn.bandwidth();\n\n    return grouped\n      .filter((d) => d[1].some(getXErrorPresent))\n      .flatMap(([segment, observations]) =>\n        observations.map((d) => {\n          const y0 = yScaleIn(getSegment(d)) as number;\n          const barHeight = Math.min(bandwidth, 15);\n          const [x1, x2] = getXErrorRange(d);\n\n          return {\n            key: `${segment}-${getSegment(d)}`,\n            y: (yScale(segment) as number) + y0 + bandwidth / 2 - barHeight / 2,\n            x1: xScale(x1),\n            x2: xScale(x2),\n            height: barHeight,\n          } satisfies RenderHorizontalWhiskerDatum;\n        })\n      );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    getSegment,\n    getXErrorRange,\n    getXErrorPresent,\n    grouped,\n    showXUncertainty,\n    xScale,\n    yScaleIn,\n    yScale,\n    width,\n    height,\n  ]);\n\n  useEffect(() => {\n    if (ref.current) {\n      renderContainer(ref.current, {\n        id: \"bars-grouped-error-whiskers\",\n        transform: `translate(${margins.left} ${margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g, opts) => renderHorizontalWhisker(g, renderData, opts),\n      });\n    }\n  }, [\n    enableTransition,\n    margins.left,\n    margins.top,\n    renderData,\n    transitionDuration,\n  ]);\n\n  return <g ref={ref} />;\n};\n\nexport const BarsGrouped = () => {\n  const {\n    bounds,\n    xScale,\n    yScaleIn,\n    getX,\n    yScale,\n    getSegment,\n    colors,\n    grouped,\n    getRenderingKey,\n  } = useChartState() as GroupedBarsState;\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const { margins, height } = bounds;\n  const bandwidth = yScaleIn.bandwidth();\n  const x0 = xScale(0);\n  const renderData: RenderBarDatum[] = useMemo(() => {\n    return grouped.flatMap(([segment, observations]) => {\n      return observations.map((d) => {\n        const key = getRenderingKey(d, getSegment(d));\n        const y = getSegment(d);\n        const x = getX(d) ?? NaN;\n\n        return {\n          key,\n          y: (yScale(segment) as number) + (yScaleIn(y) as number),\n          x: xScale(Math.min(x, 0)),\n          width: Math.max(0, Math.abs(xScale(x) - x0)),\n          height: bandwidth,\n          color: colors(y),\n          observation: d,\n        };\n      });\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    colors,\n    getSegment,\n    bandwidth,\n    getX,\n    grouped,\n    yScaleIn,\n    xScale,\n    yScale,\n    x0,\n    getRenderingKey,\n    height,\n  ]);\n\n  useEffect(() => {\n    if (ref.current) {\n      renderContainer(ref.current, {\n        id: \"bars-grouped\",\n        transform: `translate(${margins.left} ${margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g, opts) => renderBars(g, renderData, { ...opts, x0 }),\n      });\n    }\n  }, [\n    enableTransition,\n    margins.left,\n    margins.top,\n    renderData,\n    transitionDuration,\n    x0,\n  ]);\n\n  return <g ref={ref} />;\n};\n","import { ascending, rollup, sum } from \"d3-array\";\nimport orderBy from \"lodash/orderBy\";\nimport { useCallback } from \"react\";\n\nimport { usePlottableData } from \"@/charts/shared/chart-helpers\";\nimport {\n  BandYVariables,\n  BaseVariables,\n  ChartStateData,\n  InteractiveFiltersVariables,\n  NumericalXErrorVariables,\n  NumericalXVariables,\n  RenderingVariables,\n  SegmentVariables,\n  SortingVariables,\n  useBandYVariables,\n  useBaseVariables,\n  useChartData,\n  useInteractiveFiltersVariables,\n  useNumericalXErrorVariables,\n  useNumericalXVariables,\n  useSegmentVariables,\n} from \"@/charts/shared/chart-state\";\nimport { useRenderingKeyVariable } from \"@/charts/shared/rendering-utils\";\nimport { useChartConfigFilters } from \"@/config-utils\";\nimport { BarConfig } from \"@/configurator\";\nimport { isTemporalEntityDimension, Observation } from \"@/domain/data\";\nimport { sortByIndex } from \"@/utils/array\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type BarsGroupedStateVariables = BaseVariables &\n  SortingVariables &\n  BandYVariables &\n  NumericalXVariables &\n  NumericalXErrorVariables &\n  SegmentVariables &\n  RenderingVariables &\n  InteractiveFiltersVariables;\n\nexport const useBarsGroupedStateVariables = (\n  props: ChartProps<BarConfig>\n): BarsGroupedStateVariables => {\n  const {\n    chartConfig,\n    observations,\n    dimensions,\n    dimensionsById,\n    measures,\n    measuresById,\n  } = props;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const { x, y, segment, animation } = fields;\n  const yDimension = dimensionsById[y.componentId];\n  const filters = useChartConfigFilters(chartConfig);\n\n  const baseVariables = useBaseVariables(chartConfig);\n  const numericalXVariables = useNumericalXVariables(\"bar\", x, {\n    measuresById,\n  });\n  const bandYVariables = useBandYVariables(y, {\n    dimensionsById,\n    observations,\n  });\n  const numericalXErrorVariables = useNumericalXErrorVariables(x, {\n    getValue: numericalXVariables.getX,\n    dimensions,\n    measures,\n  });\n  const segmentVariables = useSegmentVariables(segment, {\n    dimensionsById,\n    observations,\n  });\n  const interactiveFiltersVariables = useInteractiveFiltersVariables(\n    interactiveFiltersConfig,\n    { dimensionsById }\n  );\n\n  const { getY, getYAsDate } = bandYVariables;\n  const { getX } = numericalXVariables;\n  const sortData: BarsGroupedStateVariables[\"sortData\"] = useCallback(\n    (data) => {\n      const { sortingOrder, sortingType } = y.sorting ?? {};\n      const yGetter = isTemporalEntityDimension(yDimension)\n        ? (d: Observation) => getYAsDate(d).getTime().toString()\n        : getY;\n      const order = [\n        ...rollup(\n          data,\n          (v) => sum(v, (d) => getX(d)),\n          (d) => yGetter(d)\n        ),\n      ]\n        .sort((a, b) => ascending(a[1], b[1]))\n        .map((d) => d[0]);\n\n      if (sortingType === \"byDimensionLabel\") {\n        return orderBy(data, yGetter, sortingOrder);\n      } else if (sortingType === \"byMeasure\") {\n        return sortByIndex({ data, order, getCategory: yGetter, sortingOrder });\n      } else {\n        return orderBy(data, yGetter, \"asc\");\n      }\n    },\n    [getX, getYAsDate, getY, y.sorting, yDimension]\n  );\n\n  const getRenderingKey = useRenderingKeyVariable(\n    dimensions,\n    filters,\n    animation\n  );\n\n  return {\n    ...baseVariables,\n    sortData,\n    ...bandYVariables,\n    ...numericalXVariables,\n    ...numericalXErrorVariables,\n    ...segmentVariables,\n    ...interactiveFiltersVariables,\n    getRenderingKey,\n  };\n};\n\nexport const useBarsGroupedStateData = (\n  chartProps: ChartProps<BarConfig>,\n  variables: BarsGroupedStateVariables\n): ChartStateData => {\n  const { chartConfig, observations } = chartProps;\n  const {\n    sortData,\n    yDimension,\n    getYAsDate,\n    getX,\n    getSegmentAbbreviationOrLabel,\n    getTimeRangeDate,\n  } = variables;\n  const plottableData = usePlottableData(observations, {\n    getX,\n  });\n\n  return useChartData(plottableData, {\n    sortData,\n    chartConfig,\n    timeRangeDimensionId: yDimension.id,\n    getAxisValueAsDate: getYAsDate,\n    getSegmentAbbreviationOrLabel,\n    getTimeRangeDate,\n  });\n};\n","export const PADDING_OUTER = 0;\nexport const PADDING_INNER = 0.1;\nexport const PADDING_WITHIN = 0.1;\nexport const MIN_BAR_HEIGHT = 16;\n","import { extent, group, max, rollup, sum } from \"d3-array\";\nimport {\n  ScaleBand,\n  scaleBand,\n  ScaleLinear,\n  scaleLinear,\n  ScaleOrdinal,\n  scaleOrdinal,\n  scaleTime,\n} from \"d3-scale\";\nimport { schemeCategory10 } from \"d3-scale-chromatic\";\nimport orderBy from \"lodash/orderBy\";\nimport { PropsWithChildren, useCallback, useMemo } from \"react\";\n\nimport {\n  BarsGroupedStateVariables,\n  useBarsGroupedStateData,\n  useBarsGroupedStateVariables,\n} from \"@/charts/bar/bars-grouped-state-props\";\nimport {\n  PADDING_INNER,\n  PADDING_OUTER,\n  PADDING_WITHIN,\n} from \"@/charts/bar/constants\";\nimport {\n  AxisLabelSizeVariables,\n  getChartWidth,\n  useAxisLabelSizeVariables,\n  useChartBounds,\n  useChartPadding,\n} from \"@/charts/shared/chart-dimensions\";\nimport {\n  ChartContext,\n  ChartStateData,\n  CommonChartState,\n  InteractiveYTimeRangeState,\n} from \"@/charts/shared/chart-state\";\nimport { TooltipInfo, TooltipValue } from \"@/charts/shared/interaction/tooltip\";\nimport {\n  getCenteredTooltipPlacement,\n  MOBILE_TOOLTIP_PLACEMENT,\n} from \"@/charts/shared/interaction/tooltip-box\";\nimport { DEFAULT_MARGIN_TOP } from \"@/charts/shared/margins\";\nimport { useChartFormatters } from \"@/charts/shared/use-chart-formatters\";\nimport { InteractionProvider } from \"@/charts/shared/use-interaction\";\nimport { useSize } from \"@/charts/shared/use-size\";\nimport { BarConfig } from \"@/configurator\";\nimport { isTemporalDimension, Observation } from \"@/domain/data\";\nimport { formatNumberWithUnit, useFormatNumber } from \"@/formatters\";\nimport { getPalette } from \"@/palettes\";\nimport { sortByIndex } from \"@/utils/array\";\nimport {\n  getSortingOrders,\n  makeDimensionValueSorters,\n} from \"@/utils/sorting-values\";\nimport { useIsMobile } from \"@/utils/use-is-mobile\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type GroupedBarsState = CommonChartState &\n  BarsGroupedStateVariables &\n  InteractiveYTimeRangeState & {\n    chartType: \"bar\";\n    yScale: ScaleBand<string>;\n    yScaleInteraction: ScaleBand<string>;\n    yScaleIn: ScaleBand<string>;\n    xScale: ScaleLinear<number, number>;\n    segments: string[];\n    colors: ScaleOrdinal<string, string>;\n    getColorLabel: (segment: string) => string;\n    grouped: [string, Observation[]][];\n    getTooltipInfo: (d: Observation) => TooltipInfo;\n    leftAxisLabelSize: AxisLabelSizeVariables;\n    leftAxisLabelOffsetTop: number;\n    bottomAxisLabelSize: AxisLabelSizeVariables;\n    formatYAxisTick?: (tick: string) => string;\n  };\n\nconst useBarsGroupedState = (\n  chartProps: ChartProps<BarConfig>,\n  variables: BarsGroupedStateVariables,\n  data: ChartStateData\n): GroupedBarsState => {\n  const { chartConfig } = chartProps;\n  const {\n    yDimension,\n    getX,\n    getYAsDate,\n    getYAbbreviationOrLabel,\n    getYLabel,\n    xMeasure,\n    getY,\n    formatYDate,\n    getMinX,\n    getXErrorRange,\n    getFormattedXUncertainty,\n    segmentDimension,\n    segmentsByAbbreviationOrLabel,\n    getSegment,\n    getSegmentAbbreviationOrLabel,\n    getSegmentLabel,\n    xAxisLabel,\n    yAxisLabel,\n  } = variables;\n  const {\n    chartData,\n    scalesData,\n    segmentData,\n    timeRangeData,\n    paddingData,\n    allData,\n  } = data;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const { x } = fields;\n\n  const { width, height } = useSize();\n  const formatNumber = useFormatNumber({ decimals: \"auto\" });\n  const formatters = useChartFormatters(chartProps);\n\n  const segmentsByValue = useMemo(() => {\n    const values = segmentDimension?.values || [];\n\n    return new Map(values.map((d) => [d.value, d]));\n  }, [segmentDimension?.values]);\n\n  // segments\n  const segmentSortingOrder = fields.segment?.sorting?.sortingOrder;\n\n  const sumsBySegment = useMemo(() => {\n    return Object.fromEntries(\n      rollup(\n        segmentData,\n        (v) => sum(v, (y) => getX(y)),\n        (y) => getSegment(y)\n      )\n    );\n  }, [segmentData, getX, getSegment]);\n\n  const segmentFilter = segmentDimension?.id\n    ? chartConfig.cubes.find((d) => d.iri === segmentDimension.cubeIri)\n        ?.filters[segmentDimension.id]\n    : undefined;\n  const { allSegments, segments } = useMemo(() => {\n    const allUniqueSegments = Array.from(\n      new Set(segmentData.map((d) => getSegment(d)))\n    );\n    const uniqueSegments = Array.from(\n      new Set(scalesData.map((d) => getSegment(d)))\n    );\n    const sorting = fields?.segment?.sorting;\n    const sorters = makeDimensionValueSorters(segmentDimension, {\n      sorting,\n      sumsBySegment,\n      useAbbreviations: fields.segment?.useAbbreviations,\n      dimensionFilter: segmentFilter,\n    });\n    const allSegments = orderBy(\n      allUniqueSegments,\n      sorters,\n      getSortingOrders(sorters, sorting)\n    );\n\n    return {\n      allSegments,\n      segments: allSegments.filter((d) => uniqueSegments.includes(d)),\n    };\n  }, [\n    scalesData,\n    segmentData,\n    segmentDimension,\n    fields.segment?.sorting,\n    fields.segment?.useAbbreviations,\n    sumsBySegment,\n    segmentFilter,\n    getSegment,\n  ]);\n\n  /* Scales */\n  const yFilter = chartConfig.cubes.find((d) => d.iri === yDimension.cubeIri)\n    ?.filters[yDimension.id];\n  const sumsByY = useMemo(() => {\n    return Object.fromEntries(\n      rollup(\n        chartData,\n        (v) => sum(v, (d) => getX(d)),\n        (y) => getY(y)\n      )\n    );\n  }, [chartData, getX, getY]);\n\n  const {\n    yTimeRangeDomainLabels,\n    colors,\n    xScale,\n    paddingXScale,\n    yScaleTimeRange,\n    yScale,\n    yScaleIn,\n    yScaleInteraction,\n  } = useMemo(() => {\n    const colors = scaleOrdinal<string, string>();\n\n    if (fields.segment && segmentDimension && fields.color) {\n      const orderedSegmentLabelsAndColors = allSegments.map((segment) => {\n        const dvIri =\n          segmentsByAbbreviationOrLabel.get(segment)?.value ||\n          segmentsByValue.get(segment)?.value ||\n          \"\";\n\n        return {\n          label: segment,\n          color:\n            fields.color.type === \"segment\"\n              ? (fields.color.colorMapping![dvIri] ?? schemeCategory10[0])\n              : schemeCategory10[0],\n        };\n      });\n\n      colors.domain(orderedSegmentLabelsAndColors.map((s) => s.label));\n      colors.range(orderedSegmentLabelsAndColors.map((s) => s.color));\n    } else {\n      colors.domain(allSegments);\n      colors.range(\n        getPalette({\n          paletteId: fields.color.paletteId,\n          colorField: fields.color,\n        })\n      );\n    }\n\n    colors.unknown(() => undefined);\n\n    const yValues = [...new Set(scalesData.map(getY))];\n    const yTimeRangeValues = [...new Set(timeRangeData.map(getY))];\n    const ySorting = fields.y?.sorting;\n    const ySorters = makeDimensionValueSorters(yDimension, {\n      sorting: ySorting,\n      useAbbreviations: fields.y?.useAbbreviations,\n      measureBySegment: sumsByY,\n      dimensionFilter: yFilter,\n    });\n    const yDomain = orderBy(\n      yValues,\n      ySorters,\n      getSortingOrders(ySorters, ySorting)\n    );\n    const yTimeRangeDomainLabels = yTimeRangeValues.map(getYLabel);\n    const yScale = scaleBand()\n      .domain(yDomain)\n      .paddingInner(PADDING_INNER)\n      .paddingOuter(PADDING_OUTER);\n    const yScaleInteraction = scaleBand()\n      .domain(yDomain)\n      .paddingInner(0)\n      .paddingOuter(0);\n    const yScaleIn = scaleBand().domain(segments).padding(PADDING_WITHIN);\n\n    const yScaleTimeRangeDomain = extent(timeRangeData, (d) =>\n      getYAsDate(d)\n    ) as [Date, Date];\n    const yScaleTimeRange = scaleTime().domain(yScaleTimeRangeDomain);\n\n    // x\n    const xScale = scaleLinear();\n    const paddingXScale = scaleLinear();\n\n    if (x.customDomain) {\n      xScale.domain(x.customDomain);\n      paddingXScale.domain(x.customDomain);\n    } else {\n      const minValue = getMinX(scalesData, (d) => {\n        return getXErrorRange?.(d)[0] ?? getX(d);\n      });\n      const maxValue = Math.max(\n        max(scalesData, (d) => {\n          return getXErrorRange?.(d)[1] ?? getX(d);\n        }) ?? 0,\n        0\n      );\n      xScale.domain([minValue, maxValue]).nice();\n\n      const minPaddingValue = getMinX(paddingData, (d) => {\n        return getXErrorRange?.(d)[0] ?? getX(d);\n      });\n      const maxPaddingValue = Math.max(\n        max(paddingData, (d) => {\n          return getXErrorRange?.(d)[1] ?? getX(d);\n        }) ?? 0,\n        0\n      );\n      paddingXScale.domain([minPaddingValue, maxPaddingValue]).nice();\n    }\n\n    return {\n      colors,\n      xScale,\n      paddingXScale,\n      yScaleTimeRange,\n      yScale,\n      yScaleIn,\n      yScaleInteraction,\n      yTimeRangeDomainLabels,\n    };\n  }, [\n    fields.color,\n    fields.segment,\n    fields.y?.sorting,\n    fields.y?.useAbbreviations,\n    segmentDimension,\n    scalesData,\n    getY,\n    yDimension,\n    sumsByY,\n    yFilter,\n    getYLabel,\n    segments,\n    timeRangeData,\n    paddingData,\n    allSegments,\n    segmentsByAbbreviationOrLabel,\n    segmentsByValue,\n    getYAsDate,\n    getXErrorRange,\n    getX,\n    getMinX,\n    x.customDomain,\n  ]);\n\n  // Group\n  const grouped: [string, Observation[]][] = useMemo(() => {\n    const yKeys = yScale.domain();\n    const groupedMap = group(chartData, getY);\n    const grouped: [string, Observation[]][] =\n      groupedMap.size < yKeys.length\n        ? yKeys.map((d) => {\n            if (groupedMap.has(d)) {\n              return [d, groupedMap.get(d) as Observation[]];\n            } else {\n              return [d, []];\n            }\n          })\n        : [...groupedMap];\n\n    return grouped.map(([key, data]) => {\n      return [\n        key,\n        sortByIndex({\n          data,\n          order: segments,\n          getCategory: getSegment,\n          sortingOrder: segmentSortingOrder,\n        }),\n      ];\n    });\n  }, [getSegment, getY, chartData, segmentSortingOrder, segments, yScale]);\n\n  const { top, left, bottom } = useChartPadding({\n    xLabelPresent: !!xMeasure.label,\n    yScale: paddingXScale,\n    width,\n    height,\n    interactiveFiltersConfig,\n    formatNumber,\n    bandDomain: yTimeRangeDomainLabels.every((d) => d === undefined)\n      ? yScale.domain()\n      : yTimeRangeDomainLabels,\n    isFlipped: true,\n  });\n  const right = 40;\n  const leftAxisLabelSize = useAxisLabelSizeVariables({\n    label: yAxisLabel,\n    width,\n  });\n  const bottomAxisLabelSize = useAxisLabelSizeVariables({\n    label: xAxisLabel,\n    width,\n  });\n  const margins = {\n    top: DEFAULT_MARGIN_TOP + top + leftAxisLabelSize.offset,\n    right,\n    bottom: bottom + 45,\n    left,\n  };\n  const chartWidth = getChartWidth({ width, left, right });\n  const bounds = useChartBounds({ width, chartWidth, height, margins });\n  const { chartHeight } = bounds;\n\n  // Adjust of scales based on chart dimensions\n  yScale.range([0, chartHeight]);\n  yScaleInteraction.range([0, chartHeight]);\n  yScaleIn.range([0, yScale.bandwidth()]);\n  yScaleTimeRange.range([0, chartHeight]);\n  xScale.range([0, chartWidth]);\n\n  const isMobile = useIsMobile();\n\n  const formatYAxisTick = useCallback(\n    (tick: string) => {\n      return isTemporalDimension(yDimension)\n        ? formatYDate(tick)\n        : getYLabel(tick);\n    },\n    [yDimension, formatYDate, getYLabel]\n  );\n\n  const getTooltipInfo = (datum: Observation): TooltipInfo => {\n    const bw = yScale.bandwidth();\n    const y = getY(datum);\n\n    const tooltipValues = chartData.filter((d) => getY(d) === y);\n    const xValues = tooltipValues.map(getX);\n    const sortedTooltipValues = sortByIndex({\n      data: tooltipValues,\n      order: segments,\n      getCategory: getSegment,\n      // Always ascending to match visual order of colors of the stack\n      sortingOrder: \"asc\",\n    });\n    const xValueFormatter = (value: number | null) => {\n      return formatNumberWithUnit(\n        value,\n        formatters[xMeasure.id] ?? formatNumber,\n        xMeasure.unit\n      );\n    };\n\n    const yAnchorRaw = (yScale(y) as number) + bw * 0.5;\n    const [xMin, xMax] = extent(xValues, (d) => d ?? 0) as [number, number];\n    const xAnchor = isMobile ? chartHeight : xScale(xMin + xMax);\n    const placement = isMobile\n      ? MOBILE_TOOLTIP_PLACEMENT\n      : getCenteredTooltipPlacement({\n          chartWidth,\n          xAnchor,\n          topAnchor: !fields.segment,\n        });\n    const yLabel = getYAbbreviationOrLabel(datum);\n\n    return {\n      yAnchor: yAnchorRaw + (placement.y === \"bottom\" ? 0.5 : -0.5) * bw,\n      xAnchor,\n      placement,\n      value: formatYAxisTick(yLabel),\n      datum: {\n        label: fields.segment && getSegmentAbbreviationOrLabel(datum),\n        value: xValueFormatter(getX(datum)),\n        error: getFormattedXUncertainty(datum),\n        color: colors(getSegment(datum)),\n      },\n      values: sortedTooltipValues.map((d) => {\n        const segment = getSegment(d);\n\n        return {\n          label: getSegmentAbbreviationOrLabel(d),\n          value: xMeasure.unit\n            ? `${formatNumber(getX(d))}${xMeasure.unit}`\n            : formatNumber(getX(d)),\n          error: getFormattedXUncertainty(d),\n          color: colors(segment),\n        } satisfies TooltipValue;\n      }),\n    };\n  };\n\n  return {\n    chartType: \"bar\",\n    bounds,\n    chartData,\n    allData,\n    yScale,\n    yScaleInteraction,\n    yScaleIn,\n    yScaleTimeRange,\n    xScale,\n    segments,\n    colors,\n    getColorLabel: getSegmentLabel,\n    grouped,\n    getTooltipInfo,\n    leftAxisLabelSize,\n    leftAxisLabelOffsetTop: top,\n    bottomAxisLabelSize,\n    formatYAxisTick,\n    ...variables,\n  };\n};\n\nconst GroupedBarChartProvider = (\n  props: PropsWithChildren<ChartProps<BarConfig>>\n) => {\n  const { children, ...chartProps } = props;\n  const variables = useBarsGroupedStateVariables(chartProps);\n  const data = useBarsGroupedStateData(chartProps, variables);\n  const state = useBarsGroupedState(chartProps, variables, data);\n\n  return (\n    <ChartContext.Provider value={state}>{children}</ChartContext.Provider>\n  );\n};\n\nexport const GroupedBarChart = (\n  props: PropsWithChildren<ChartProps<BarConfig>>\n) => {\n  return (\n    <InteractionProvider>\n      <GroupedBarChartProvider {...props} />\n    </InteractionProvider>\n  );\n};\n","import { useEffect, useMemo, useRef } from \"react\";\n\nimport { StackedBarsState } from \"@/charts/bar/bars-stacked-state\";\nimport {\n  renderBars,\n  useGetRenderStackedBarDatum,\n} from \"@/charts/bar/rendering-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { renderContainer } from \"@/charts/shared/rendering-utils\";\nimport { useTransitionStore } from \"@/stores/transition\";\n\nexport const BarsStacked = () => {\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const {\n    bounds: { height, margins },\n    xScale,\n    series,\n  } = useChartState() as StackedBarsState;\n  const getRenderDatum = useGetRenderStackedBarDatum();\n\n  const renderData = useMemo(() => {\n    return series.flatMap(getRenderDatum);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    getRenderDatum,\n    series,\n    // We need to reset the yRange on height change.\n    height,\n  ]);\n\n  const x0 = xScale(0);\n\n  useEffect(() => {\n    if (ref.current) {\n      renderContainer(ref.current, {\n        id: \"bars-stacked\",\n        transform: `translate(${margins.left} ${margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g, opts) => renderBars(g, renderData, { ...opts, x0 }),\n      });\n    }\n  }, [\n    enableTransition,\n    margins.left,\n    margins.top,\n    renderData,\n    transitionDuration,\n    x0,\n  ]);\n\n  return <g ref={ref} />;\n};\n","import { ascending, descending, group } from \"d3-array\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { getWideData, usePlottableData } from \"@/charts/shared/chart-helpers\";\nimport {\n  BandYVariables,\n  BaseVariables,\n  ChartStateData,\n  InteractiveFiltersVariables,\n  NumericalXVariables,\n  RenderingVariables,\n  SegmentVariables,\n  SortingVariables,\n  useBandYVariables,\n  useBaseVariables,\n  useChartData,\n  useInteractiveFiltersVariables,\n  useNumericalXVariables,\n  useSegmentVariables,\n} from \"@/charts/shared/chart-state\";\nimport { useRenderingKeyVariable } from \"@/charts/shared/rendering-utils\";\nimport { useChartConfigFilters } from \"@/config-utils\";\nimport { BarConfig } from \"@/configurator\";\nimport { isTemporalEntityDimension, Observation } from \"@/domain/data\";\nimport { sortByIndex } from \"@/utils/array\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type BarsStackedStateVariables = BaseVariables &\n  SortingVariables<{ plottableDataWide: Observation[] }> &\n  BandYVariables &\n  NumericalXVariables &\n  SegmentVariables &\n  RenderingVariables &\n  InteractiveFiltersVariables;\n\nexport const useBarsStackedStateVariables = (\n  props: ChartProps<BarConfig>\n): BarsStackedStateVariables => {\n  const {\n    chartConfig,\n    observations,\n    dimensions,\n    dimensionsById,\n    measuresById,\n  } = props;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const { x, y, segment, animation } = fields;\n  const yDimension = dimensionsById[y.componentId];\n  const filters = useChartConfigFilters(chartConfig);\n\n  const baseVariables = useBaseVariables(chartConfig);\n  const numericalXVariables = useNumericalXVariables(\"bar\", x, {\n    measuresById,\n  });\n  const bandYVariables = useBandYVariables(y, {\n    dimensionsById,\n    observations,\n  });\n  const segmentVariables = useSegmentVariables(segment, {\n    dimensionsById,\n    observations,\n  });\n  const interactiveFiltersVariables = useInteractiveFiltersVariables(\n    interactiveFiltersConfig,\n    { dimensionsById }\n  );\n\n  const { getY, getYAsDate } = bandYVariables;\n  const sortData: BarsStackedStateVariables[\"sortData\"] = useCallback(\n    (data, { plottableDataWide }) => {\n      const { sortingOrder, sortingType } = y.sorting ?? {};\n      const yGetter = isTemporalEntityDimension(yDimension)\n        ? (d: Observation) => getYAsDate(d).getTime().toString()\n        : getY;\n      const yOrder = plottableDataWide\n        .sort((a, b) => ascending(a.total ?? undefined, b.total ?? undefined))\n        .map(yGetter);\n\n      if (sortingOrder === \"desc\" && sortingType === \"byDimensionLabel\") {\n        return [...data].sort((a, b) => descending(yGetter(a), yGetter(b)));\n      } else if (sortingOrder === \"asc\" && sortingType === \"byDimensionLabel\") {\n        return [...data].sort((a, b) => ascending(yGetter(a), yGetter(b)));\n      } else if (sortingType === \"byMeasure\") {\n        return sortByIndex({\n          data,\n          order: yOrder,\n          getCategory: yGetter,\n          sortingOrder,\n        });\n      } else {\n        return [...data].sort((a, b) => ascending(yGetter(a), yGetter(b)));\n      }\n    },\n    [getY, getYAsDate, y.sorting, yDimension]\n  );\n\n  const getRenderingKey = useRenderingKeyVariable(\n    dimensions,\n    filters,\n    animation\n  );\n\n  return {\n    ...baseVariables,\n    sortData,\n    ...bandYVariables,\n    ...numericalXVariables,\n    ...segmentVariables,\n    ...interactiveFiltersVariables,\n    getRenderingKey,\n  };\n};\n\nexport type BarsStackedStateData = ChartStateData & {\n  plottableDataWide: Observation[];\n};\n\nexport const useBarsStackedStateData = (\n  chartProps: ChartProps<BarConfig>,\n  variables: BarsStackedStateVariables\n): BarsStackedStateData => {\n  const { chartConfig, observations } = chartProps;\n  const { fields } = chartConfig;\n  const { y } = fields;\n  const {\n    sortData,\n    yDimension,\n    getX,\n    getYAsDate,\n    getY,\n    getSegment,\n    getSegmentAbbreviationOrLabel,\n    getTimeRangeDate,\n  } = variables;\n  const plottableData = usePlottableData(observations, {\n    getX,\n  });\n  const plottableDataWide = useMemo(() => {\n    const plottableDataByY = group(plottableData, getY);\n\n    return getWideData({\n      dataGrouped: plottableDataByY,\n      key: y.componentId,\n      getAxisValue: getX,\n      getSegment,\n    });\n  }, [plottableData, getX, y.componentId, getY, getSegment]);\n  const sortPlottableData = useCallback(\n    (data: Observation[]) => {\n      return sortData(data, { plottableDataWide });\n    },\n    [plottableDataWide, sortData]\n  );\n  const data = useChartData(plottableData, {\n    sortData: sortPlottableData,\n    chartConfig,\n    timeRangeDimensionId: yDimension.id,\n    getAxisValueAsDate: getYAsDate,\n    getSegmentAbbreviationOrLabel,\n    getTimeRangeDate,\n  });\n\n  return {\n    ...data,\n    plottableDataWide,\n  };\n};\n","import { extent, group, rollup, sum } from \"d3-array\";\nimport {\n  ScaleBand,\n  scaleBand,\n  ScaleLinear,\n  scaleLinear,\n  ScaleOrdinal,\n  scaleOrdinal,\n  scaleTime,\n} from \"d3-scale\";\nimport { schemeCategory10 } from \"d3-scale-chromatic\";\nimport {\n  Series,\n  stack,\n  stackOffsetDiverging,\n  stackOrderAscending,\n  stackOrderDescending,\n  stackOrderReverse,\n} from \"d3-shape\";\nimport orderBy from \"lodash/orderBy\";\nimport { PropsWithChildren, useCallback, useMemo } from \"react\";\n\nimport {\n  BarsStackedStateData,\n  BarsStackedStateVariables,\n  useBarsStackedStateData,\n  useBarsStackedStateVariables,\n} from \"@/charts/bar/bars-stacked-state-props\";\nimport {\n  MIN_BAR_HEIGHT,\n  PADDING_INNER,\n  PADDING_OUTER,\n} from \"@/charts/bar/constants\";\nimport {\n  ANNOTATION_SINGLE_SEGMENT_OFFSET,\n  GetAnnotationInfo,\n} from \"@/charts/shared/annotations\";\nimport {\n  AxisLabelSizeVariables,\n  getChartWidth,\n  useAxisLabelSizeVariables,\n  useChartBounds,\n  useChartPadding,\n} from \"@/charts/shared/chart-dimensions\";\nimport {\n  getWideData,\n  normalizeData,\n  useGetIdentityX,\n} from \"@/charts/shared/chart-helpers\";\nimport {\n  ChartContext,\n  CommonChartState,\n  InteractiveYTimeRangeState,\n} from \"@/charts/shared/chart-state\";\nimport { TooltipInfo, TooltipValue } from \"@/charts/shared/interaction/tooltip\";\nimport {\n  getCenteredTooltipPlacement,\n  MOBILE_TOOLTIP_PLACEMENT,\n} from \"@/charts/shared/interaction/tooltip-box\";\nimport { DEFAULT_MARGIN_TOP } from \"@/charts/shared/margins\";\nimport {\n  useValueLabelFormatter,\n  ValueLabelFormatter,\n} from \"@/charts/shared/show-values-utils\";\nimport {\n  getStackedPosition,\n  getStackedTooltipValueFormatter,\n  getStackedXScale,\n} from \"@/charts/shared/stacked-helpers\";\nimport { useChartFormatters } from \"@/charts/shared/use-chart-formatters\";\nimport { InteractionProvider } from \"@/charts/shared/use-interaction\";\nimport { useSize } from \"@/charts/shared/use-size\";\nimport { BarConfig } from \"@/configurator\";\nimport { isTemporalDimension, Observation } from \"@/domain/data\";\nimport { useFormatNumber } from \"@/formatters\";\nimport { getPalette } from \"@/palettes\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\nimport { sortByIndex } from \"@/utils/array\";\nimport {\n  getSortingOrders,\n  makeDimensionValueSorters,\n} from \"@/utils/sorting-values\";\nimport { useIsMobile } from \"@/utils/use-is-mobile\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type StackedBarsState = CommonChartState &\n  BarsStackedStateVariables &\n  InteractiveYTimeRangeState & {\n    chartType: \"bar\";\n    chartDataGroupedByY: Map<string, Observation[]>;\n    yScale: ScaleBand<string>;\n    yScaleInteraction: ScaleBand<string>;\n    xScale: ScaleLinear<number, number>;\n    segments: string[];\n    colors: ScaleOrdinal<string, string>;\n    getColorLabel: (segment: string) => string;\n    chartWideData: ArrayLike<Observation>;\n    series: Series<{ [key: string]: number }, string>[];\n    getAnnotationInfo: GetAnnotationInfo;\n    getTooltipInfo: (d: Observation) => TooltipInfo;\n    leftAxisLabelSize: AxisLabelSizeVariables;\n    leftAxisLabelOffsetTop: number;\n    bottomAxisLabelSize: AxisLabelSizeVariables;\n    valueLabelFormatter: ValueLabelFormatter;\n    formatYAxisTick?: (tick: string) => string;\n  };\n\nconst useBarsStackedState = (\n  chartProps: ChartProps<BarConfig>,\n  variables: BarsStackedStateVariables,\n  data: BarsStackedStateData\n): StackedBarsState => {\n  const { chartConfig, dimensions, measures } = chartProps;\n  const {\n    yDimension,\n    xMeasure,\n    getX,\n    getYAsDate,\n    getYAbbreviationOrLabel,\n    getYLabel,\n    getY,\n    formatYDate,\n    segmentDimension,\n    segmentsByAbbreviationOrLabel,\n    getSegment,\n    getSegmentAbbreviationOrLabel,\n    getSegmentLabel,\n    xAxisLabel,\n    yAxisLabel,\n  } = variables;\n  const getIdentityX = useGetIdentityX(xMeasure.id);\n  const {\n    chartData,\n    scalesData,\n    segmentData,\n    timeRangeData,\n    paddingData,\n    allData,\n  } = data;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const { x } = fields;\n\n  const { width, height } = useSize();\n  const formatNumber = useFormatNumber({ decimals: \"auto\" });\n  const formatters = useChartFormatters(chartProps);\n  const calculationType = useChartInteractiveFilters((d) => d.calculation.type);\n\n  const yKey = fields.y.componentId;\n\n  const segmentsByValue = useMemo(() => {\n    const values = segmentDimension?.values || [];\n\n    return new Map(values.map((d) => [d.value, d]));\n  }, [segmentDimension?.values]);\n\n  const sumsBySegment = useMemo(() => {\n    return Object.fromEntries(\n      rollup(\n        scalesData,\n        (v) => sum(v, (x) => getX(x)),\n        (x) => getSegment(x)\n      )\n    );\n  }, [getSegment, getX, scalesData]);\n\n  const segmentFilter = segmentDimension?.id\n    ? chartConfig.cubes.find((d) => d.iri === segmentDimension.cubeIri)\n        ?.filters[segmentDimension.id]\n    : undefined;\n  const { allSegments, segments } = useMemo(() => {\n    const allUniqueSegments = Array.from(new Set(segmentData.map(getSegment)));\n    const uniqueSegments = Array.from(new Set(scalesData.map(getSegment)));\n    const sorting = fields?.segment?.sorting;\n    const sorters = makeDimensionValueSorters(segmentDimension, {\n      sorting,\n      sumsBySegment,\n      useAbbreviations: fields.segment?.useAbbreviations,\n      dimensionFilter: segmentFilter,\n    });\n    const allSegments = orderBy(\n      allUniqueSegments,\n      sorters,\n      getSortingOrders(sorters, sorting)\n    );\n\n    return {\n      allSegments,\n      segments: allSegments.filter((d) => uniqueSegments.includes(d)),\n    };\n  }, [\n    scalesData,\n    segmentData,\n    segmentDimension,\n    fields.segment?.sorting,\n    fields.segment?.useAbbreviations,\n    sumsBySegment,\n    segmentFilter,\n    getSegment,\n  ]);\n\n  const sumsByY = useMemo(() => {\n    return Object.fromEntries(\n      rollup(\n        chartData,\n        (v) => sum(v, (d) => getX(d)),\n        (x) => getY(x)\n      )\n    );\n  }, [chartData, getX, getY]);\n\n  const normalize = calculationType === \"percent\";\n  const chartDataGroupedByY = useMemo(() => {\n    if (normalize) {\n      return group(\n        normalizeData(chartData, {\n          key: xMeasure.id,\n          getAxisValue: getX,\n          getTotalGroupValue: (d) => sumsByY[getY(d)],\n        }),\n        getY\n      );\n    }\n\n    return group(chartData, getY);\n  }, [normalize, chartData, getY, xMeasure.id, getX, sumsByY]);\n\n  const chartWideData = useMemo(() => {\n    return getWideData({\n      dataGrouped: chartDataGroupedByY,\n      key: yKey,\n      getAxisValue: getX,\n      getSegment,\n      allSegments: segments,\n      imputationType: \"zeros\",\n    });\n  }, [getSegment, getX, chartDataGroupedByY, segments, yKey]);\n\n  const yFilter = chartConfig.cubes.find((d) => d.iri === yDimension.cubeIri)\n    ?.filters[yDimension.id];\n\n  // Map ordered segments labels to colors\n  const {\n    colors,\n    yScale,\n    yTimeRangeDomainLabels,\n    yScaleInteraction,\n    yScaleTimeRange,\n  } = useMemo(() => {\n    const colors = scaleOrdinal<string, string>();\n\n    if (fields.segment && segmentsByAbbreviationOrLabel && fields.color) {\n      const orderedSegmentLabelsAndColors = allSegments.map((segment) => {\n        // FIXME: Labels in observations can differ from dimension values because the latter can be concatenated to only appear once per value\n        // See https://github.com/visualize-admin/visualization-tool/issues/97\n        const dvIri =\n          segmentsByAbbreviationOrLabel.get(segment)?.value ||\n          segmentsByValue.get(segment)?.value ||\n          \"\";\n\n        // There is no way to gracefully recover here :(\n        if (!dvIri) {\n          console.warn(`Can't find color for '${segment}'.`);\n        }\n\n        return {\n          label: segment,\n          color:\n            fields.color.type === \"segment\"\n              ? (fields.color.colorMapping![dvIri] ?? schemeCategory10[0])\n              : schemeCategory10[0],\n        };\n      });\n\n      colors.domain(orderedSegmentLabelsAndColors.map((s) => s.label));\n      colors.range(orderedSegmentLabelsAndColors.map((s) => s.color));\n    } else {\n      colors.domain(allSegments);\n      colors.range(\n        getPalette({\n          paletteId: fields.color.paletteId,\n          colorField: fields.color,\n        })\n      );\n    }\n\n    colors.unknown(() => undefined);\n\n    const yValues = [...new Set(scalesData.map(getY))];\n    const yTimeRangeValues = [...new Set(timeRangeData.map(getY))];\n    const ySorting = fields.y?.sorting;\n    const ySorters = makeDimensionValueSorters(yDimension, {\n      sorting: ySorting,\n      useAbbreviations: fields.y?.useAbbreviations,\n      measureBySegment: sumsByY,\n      dimensionFilter: yFilter,\n    });\n    const yDomain = orderBy(\n      yValues,\n      ySorters,\n      getSortingOrders(ySorters, ySorting)\n    );\n    const yTimeRangeDomainLabels = yTimeRangeValues.map(getYLabel);\n    const yScale = scaleBand()\n      .domain(yDomain)\n      .paddingInner(PADDING_INNER)\n      .paddingOuter(PADDING_OUTER);\n    const yScaleInteraction = scaleBand()\n      .domain(yDomain)\n      .paddingInner(0)\n      .paddingOuter(0);\n\n    const yScaleTimeRangeDomain = extent(timeRangeData, (d) =>\n      getYAsDate(d)\n    ) as [Date, Date];\n    const yScaleTimeRange = scaleTime().domain(yScaleTimeRangeDomain);\n\n    return {\n      colors,\n      yScale,\n      yTimeRangeDomainLabels,\n      yScaleTimeRange,\n      yScaleInteraction,\n    };\n  }, [\n    fields.color,\n    fields.segment,\n    fields.y.sorting,\n    fields.y.useAbbreviations,\n    yDimension,\n    yFilter,\n    sumsByY,\n    getY,\n    getYLabel,\n    getYAsDate,\n    scalesData,\n    timeRangeData,\n    segmentsByAbbreviationOrLabel,\n    segmentsByValue,\n    allSegments,\n  ]);\n\n  const animationIri = fields.animation?.componentId;\n  const getAnimation = useCallback(\n    (d: Observation) => {\n      return animationIri ? (d[animationIri] as string) : \"\";\n    },\n    [animationIri]\n  );\n\n  const xScale = useMemo(() => {\n    return getStackedXScale(scalesData, {\n      normalize,\n      getY,\n      getX,\n      getTime: getAnimation,\n      customDomain: x.customDomain,\n    });\n  }, [scalesData, normalize, getX, getY, getAnimation, x.customDomain]);\n\n  const paddingXScale = useMemo(() => {\n    //  When the user can toggle between absolute and relative values, we use the\n    // absolute values to calculate the xScale domain, so that the xScale doesn't\n    // change when the user toggles between absolute and relative values.\n    if (interactiveFiltersConfig.calculation.active) {\n      const scale = getStackedXScale(paddingData, {\n        normalize: false,\n        getX,\n        getY,\n        getTime: getAnimation,\n        customDomain: x.customDomain,\n      });\n\n      if (scale.domain()[1] < 100 && scale.domain()[0] > -100) {\n        return scaleLinear().domain([0, 100]);\n      }\n\n      return scale;\n    }\n\n    return getStackedXScale(paddingData, {\n      normalize,\n      getX,\n      getY,\n      getTime: getAnimation,\n      customDomain: x.customDomain,\n    });\n  }, [\n    interactiveFiltersConfig.calculation.active,\n    paddingData,\n    normalize,\n    getX,\n    getY,\n    getAnimation,\n    x.customDomain,\n  ]);\n\n  // stack order\n  const series = useMemo(() => {\n    const sorting = fields.segment?.sorting;\n    const sortingType = sorting?.sortingType;\n    const sortingOrder = sorting?.sortingOrder;\n    const stackOrder =\n      sortingType === \"byTotalSize\"\n        ? sortingOrder === \"asc\"\n          ? stackOrderAscending\n          : stackOrderDescending\n        : // Reverse segments here, so they're sorted from top to bottom\n          stackOrderReverse;\n    const stacked = stack()\n      .order(stackOrder)\n      .offset(stackOffsetDiverging)\n      .keys(segments);\n\n    return stacked(chartWideData as { [key: string]: number }[]);\n  }, [chartWideData, fields.segment?.sorting, segments]);\n\n  /** Chart dimensions */\n  const { top, left, bottom } = useChartPadding({\n    xLabelPresent: !!xMeasure.label,\n    yScale: paddingXScale,\n    width,\n    height,\n    interactiveFiltersConfig,\n    formatNumber,\n    bandDomain: yTimeRangeDomainLabels.every((d) => d === undefined)\n      ? yScale.domain()\n      : yTimeRangeDomainLabels,\n    normalize,\n    isFlipped: true,\n  });\n  const right = 40;\n  const leftAxisLabelSize = useAxisLabelSizeVariables({\n    label: yAxisLabel,\n    width,\n  });\n  const bottomAxisLabelSize = useAxisLabelSizeVariables({\n    label: xAxisLabel,\n    width,\n  });\n  const margins = {\n    top: DEFAULT_MARGIN_TOP + top + leftAxisLabelSize.offset,\n    right,\n    bottom: bottom + 45,\n    left,\n  };\n\n  const barCount = yScale.domain().length;\n\n  const chartWidth = getChartWidth({ width, left, right });\n  const bounds = useChartBounds({ width, chartWidth, height, margins });\n  const { chartHeight } = bounds;\n\n  // Here we adjust the height to make sure the bars have a minimum height and are legible\n  const adjustedChartHeight =\n    barCount * MIN_BAR_HEIGHT > chartHeight\n      ? barCount * MIN_BAR_HEIGHT\n      : chartHeight;\n\n  yScale.range([0, adjustedChartHeight]);\n  yScaleInteraction.range([0, adjustedChartHeight]);\n  yScaleTimeRange.range([0, adjustedChartHeight]);\n  xScale.range([0, chartWidth]);\n\n  const isMobile = useIsMobile();\n\n  const formatYAxisTick = useCallback(\n    (tick: string) => {\n      return isTemporalDimension(yDimension)\n        ? formatYDate(tick)\n        : getYLabel(tick);\n    },\n    [yDimension, formatYDate, getYLabel]\n  );\n\n  const getAnnotationInfo: GetAnnotationInfo = useCallback(\n    (observation, { segment, focusingSegment }) => {\n      const y = getY(observation);\n      let x: number;\n      let color: string | undefined;\n\n      if (focusingSegment) {\n        x = getStackedPosition({\n          observation,\n          series,\n          key: yKey,\n          getAxisValue: getY,\n          measureScale: xScale,\n          fallbackMeasureValue: xScale(getX(observation) ?? 0),\n          segment,\n        });\n        color = colors(segment);\n      } else {\n        const values = chartDataGroupedByY.get(y) ?? [];\n        const xValues = values.map(getX);\n        x =\n          xScale(sum(xValues.map((d) => d ?? 0))) +\n          ANNOTATION_SINGLE_SEGMENT_OFFSET;\n      }\n\n      return {\n        x,\n        y: (yScale(y) as number) + yScale.bandwidth() * 0.5,\n        color,\n      };\n    },\n    [colors, getX, getY, series, xScale, yKey, yScale, chartDataGroupedByY]\n  );\n\n  const getTooltipInfo = useCallback(\n    (datum: Observation): TooltipInfo => {\n      const bw = yScale.bandwidth();\n      const y = getY(datum);\n\n      const tooltipValues = chartDataGroupedByY.get(y) ?? [];\n      const xValues = tooltipValues.map(getX);\n      const sortedTooltipValues = sortByIndex({\n        data: tooltipValues,\n        order: segments,\n        getCategory: getSegment,\n        sortingOrder: \"asc\",\n      });\n      const xValueFormatter = getStackedTooltipValueFormatter({\n        normalize,\n        measureId: xMeasure.id,\n        measureUnit: xMeasure.unit,\n        formatters,\n        formatNumber,\n      });\n\n      const yAnchorRaw = (yScale(y) as number) + bw * 0.5;\n      const xAnchor = isMobile\n        ? chartHeight\n        : xScale(sum(xValues.map((d) => d ?? 0)));\n      const placement = isMobile\n        ? MOBILE_TOOLTIP_PLACEMENT\n        : getCenteredTooltipPlacement({\n            chartWidth,\n            xAnchor,\n            topAnchor: !fields.segment,\n          });\n      const yLabel = getYAbbreviationOrLabel(datum);\n\n      return {\n        yAnchor: yAnchorRaw + (placement.y === \"top\" ? bw : 0),\n        xAnchor,\n        placement,\n        value: formatYAxisTick(yLabel),\n        datum: {\n          label: fields.segment && getSegmentAbbreviationOrLabel(datum),\n          value: xValueFormatter(getX(datum), getIdentityX(datum)),\n          color: colors(getSegment(datum)),\n        },\n        values: sortedTooltipValues.map((d) => {\n          const segment = getSegment(d);\n          const x = getStackedPosition({\n            observation: d,\n            series,\n            key: yKey,\n            getAxisValue: getY,\n            measureScale: xScale,\n            fallbackMeasureValue: xScale(getX(d) ?? 0),\n            segment,\n          });\n\n          return {\n            label: getSegmentAbbreviationOrLabel(d),\n            value: xValueFormatter(getX(d), getIdentityX(d)),\n            axis: \"x\",\n            axisOffset: x,\n            color: colors(segment),\n          } satisfies TooltipValue;\n        }),\n      };\n    },\n    [\n      yScale,\n      getY,\n      chartDataGroupedByY,\n      getX,\n      segments,\n      getSegment,\n      normalize,\n      xMeasure.id,\n      xMeasure.unit,\n      formatters,\n      formatNumber,\n      isMobile,\n      chartHeight,\n      xScale,\n      chartWidth,\n      fields.segment,\n      getYAbbreviationOrLabel,\n      formatYAxisTick,\n      getSegmentAbbreviationOrLabel,\n      getIdentityX,\n      colors,\n      series,\n      yKey,\n    ]\n  );\n\n  const valueLabelFormatter = useValueLabelFormatter({\n    measureId: xMeasure.id,\n    dimensions,\n    measures,\n    normalize,\n  });\n\n  return {\n    chartType: \"bar\",\n    chartDataGroupedByY,\n    bounds: {\n      ...bounds,\n      chartHeight: adjustedChartHeight,\n    },\n    chartData,\n    allData,\n    xScale,\n    yScaleInteraction,\n    yScaleTimeRange,\n    yScale,\n    segments,\n    colors,\n    getColorLabel: getSegmentLabel,\n    chartWideData,\n    series,\n    getAnnotationInfo,\n    getTooltipInfo,\n    leftAxisLabelSize,\n    leftAxisLabelOffsetTop: top,\n    bottomAxisLabelSize,\n    valueLabelFormatter,\n    formatYAxisTick,\n    ...variables,\n  };\n};\n\nconst StackedBarsChartProvider = (\n  props: PropsWithChildren<ChartProps<BarConfig>>\n) => {\n  const { children, ...chartProps } = props;\n  const variables = useBarsStackedStateVariables(chartProps);\n  const data = useBarsStackedStateData(chartProps, variables);\n  const state = useBarsStackedState(chartProps, variables, data);\n\n  return (\n    <ChartContext.Provider value={state}>{children}</ChartContext.Provider>\n  );\n};\n\nexport const StackedBarsChart = (\n  props: PropsWithChildren<ChartProps<BarConfig>>\n) => {\n  return (\n    <InteractionProvider>\n      <StackedBarsChartProvider {...props} />\n    </InteractionProvider>\n  );\n};\n","import { ascending, descending } from \"d3-array\";\nimport { useCallback } from \"react\";\n\nimport { usePlottableData } from \"@/charts/shared/chart-helpers\";\nimport {\n  BandYVariables,\n  BaseVariables,\n  ChartStateData,\n  InteractiveFiltersVariables,\n  LimitsVariables,\n  NumericalXErrorVariables,\n  NumericalXVariables,\n  RenderingVariables,\n  SegmentVariables,\n  SortingVariables,\n  useBandYVariables,\n  useBaseVariables,\n  useChartData,\n  useInteractiveFiltersVariables,\n  useLimitsVariables,\n  useNumericalXErrorVariables,\n  useNumericalXVariables,\n  useSegmentVariables,\n} from \"@/charts/shared/chart-state\";\nimport { useRenderingKeyVariable } from \"@/charts/shared/rendering-utils\";\nimport { useChartConfigFilters, useLimits } from \"@/config-utils\";\nimport { BarConfig } from \"@/configurator\";\nimport { isTemporalEntityDimension } from \"@/domain/data\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type BarsStateVariables = BaseVariables &\n  SortingVariables &\n  NumericalXVariables &\n  BandYVariables &\n  NumericalXErrorVariables &\n  SegmentVariables &\n  RenderingVariables &\n  InteractiveFiltersVariables &\n  LimitsVariables;\n\nexport const useBarsStateVariables = (\n  props: ChartProps<BarConfig> & { limits: ReturnType<typeof useLimits> }\n): BarsStateVariables => {\n  const {\n    chartConfig,\n    observations,\n    dimensions,\n    dimensionsById,\n    measures,\n    measuresById,\n    limits,\n  } = props;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const { x, y, animation, segment } = fields;\n  const yDimension = dimensionsById[y.componentId];\n  const filters = useChartConfigFilters(chartConfig);\n\n  const baseVariables = useBaseVariables(chartConfig);\n  const numericalXVariables = useNumericalXVariables(\"bar\", x, {\n    measuresById,\n  });\n  const bandYVariables = useBandYVariables(y, {\n    dimensionsById,\n    observations,\n  });\n  const numericalXErrorVariables = useNumericalXErrorVariables(x, {\n    getValue: numericalXVariables.getX,\n    dimensions,\n    measures,\n  });\n  const interactiveFiltersVariables = useInteractiveFiltersVariables(\n    interactiveFiltersConfig,\n    { dimensionsById }\n  );\n  const limitsVariables = useLimitsVariables(limits);\n\n  const { getY, getYAsDate } = bandYVariables;\n  const { getX } = numericalXVariables;\n  const sortData: BarsStateVariables[\"sortData\"] = useCallback(\n    (data) => {\n      const { sortingOrder, sortingType } = y.sorting ?? {};\n      const yGetter = isTemporalEntityDimension(yDimension) ? getYAsDate : getY;\n      if (sortingOrder === \"desc\" && sortingType === \"byDimensionLabel\") {\n        return [...data].sort((a, b) => descending(yGetter(a), yGetter(b)));\n      } else if (sortingOrder === \"asc\" && sortingType === \"byDimensionLabel\") {\n        return [...data].sort((a, b) => ascending(yGetter(a), yGetter(b)));\n      } else if (sortingOrder === \"desc\" && sortingType === \"byMeasure\") {\n        return [...data].sort((a, b) =>\n          descending(getX(a) ?? -1, getX(b) ?? -1)\n        );\n      } else if (sortingOrder === \"asc\" && sortingType === \"byMeasure\") {\n        return [...data].sort((a, b) =>\n          ascending(getX(a) ?? -1, getX(b) ?? -1)\n        );\n      } else {\n        return [...data].sort((a, b) => ascending(yGetter(a), yGetter(b)));\n      }\n    },\n    [getX, getYAsDate, getY, y.sorting, yDimension]\n  );\n\n  const segmentVariables = useSegmentVariables(segment, {\n    dimensionsById,\n    observations,\n  });\n  const getRenderingKey = useRenderingKeyVariable(\n    dimensions,\n    filters,\n    animation\n  );\n\n  return {\n    ...segmentVariables,\n    ...baseVariables,\n    sortData,\n    ...bandYVariables,\n    ...numericalXVariables,\n    ...numericalXErrorVariables,\n    ...interactiveFiltersVariables,\n    ...limitsVariables,\n    getRenderingKey,\n  };\n};\n\nexport const useBarsStateData = (\n  chartProps: ChartProps<BarConfig> & { limits: ReturnType<typeof useLimits> },\n  variables: BarsStateVariables\n): ChartStateData => {\n  const { chartConfig, observations } = chartProps;\n  const { sortData, yDimension, getYAsDate, getX, getTimeRangeDate } =\n    variables;\n  const plottableData = usePlottableData(observations, {\n    getX,\n  });\n\n  return useChartData(plottableData, {\n    sortData,\n    chartConfig,\n    timeRangeDimensionId: yDimension.id,\n    getAxisValueAsDate: getYAsDate,\n    getTimeRangeDate,\n  });\n};\n","import { extent, max, rollup, sum } from \"d3-array\";\nimport {\n  ScaleBand,\n  scaleBand,\n  ScaleLinear,\n  scaleLinear,\n  ScaleOrdinal,\n  scaleOrdinal,\n  scaleTime,\n} from \"d3-scale\";\nimport orderBy from \"lodash/orderBy\";\nimport { PropsWithChildren, useCallback, useMemo } from \"react\";\n\nimport {\n  BarsStateVariables,\n  useBarsStateData,\n  useBarsStateVariables,\n} from \"@/charts/bar/bars-state-props\";\nimport {\n  MIN_BAR_HEIGHT,\n  PADDING_INNER,\n  PADDING_OUTER,\n} from \"@/charts/bar/constants\";\nimport { DEFAULT_ANNOTATION_CIRCLE_COLOR } from \"@/charts/shared/annotation-circle\";\nimport {\n  ANNOTATION_SINGLE_SEGMENT_OFFSET,\n  GetAnnotationInfo,\n} from \"@/charts/shared/annotations\";\nimport {\n  AxisLabelSizeVariables,\n  getChartWidth,\n  useAxisLabelSizeVariables,\n  useChartBounds,\n  useChartPadding,\n} from \"@/charts/shared/chart-dimensions\";\nimport {\n  ChartContext,\n  ChartStateData,\n  CommonChartState,\n  InteractiveYTimeRangeState,\n} from \"@/charts/shared/chart-state\";\nimport { TooltipInfo } from \"@/charts/shared/interaction/tooltip\";\nimport {\n  getCenteredTooltipPlacement,\n  MOBILE_TOOLTIP_PLACEMENT,\n} from \"@/charts/shared/interaction/tooltip-box\";\nimport { DEFAULT_MARGIN_TOP } from \"@/charts/shared/margins\";\nimport {\n  ShowBandValueLabelsVariables,\n  useShowBandValueLabelsVariables,\n} from \"@/charts/shared/show-values-utils\";\nimport { useChartFormatters } from \"@/charts/shared/use-chart-formatters\";\nimport { InteractionProvider } from \"@/charts/shared/use-interaction\";\nimport { useSize } from \"@/charts/shared/use-size\";\nimport { useLimits } from \"@/config-utils\";\nimport { BarConfig } from \"@/configurator\";\nimport { isTemporalDimension, Observation } from \"@/domain/data\";\nimport { formatNumberWithUnit, useFormatNumber } from \"@/formatters\";\nimport { getPalette } from \"@/palettes\";\nimport {\n  getSortingOrders,\n  makeDimensionValueSorters,\n} from \"@/utils/sorting-values\";\nimport { useIsMobile } from \"@/utils/use-is-mobile\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type BarsState = CommonChartState &\n  BarsStateVariables &\n  InteractiveYTimeRangeState &\n  Omit<ShowBandValueLabelsVariables, \"offset\"> & {\n    chartType: \"bar\";\n    xScale: ScaleLinear<number, number>;\n    yScaleInteraction: ScaleBand<string>;\n    yScale: ScaleBand<string>;\n    minY: string;\n    getAnnotationInfo: GetAnnotationInfo;\n    getTooltipInfo: (d: Observation) => TooltipInfo;\n    segments: string[];\n    colors: ScaleOrdinal<string, string>;\n    getColorLabel: (segment: string) => string;\n    leftAxisLabelSize: AxisLabelSizeVariables;\n    leftAxisLabelOffsetTop: number;\n    bottomAxisLabelSize: AxisLabelSizeVariables;\n    formatYAxisTick?: (tick: string) => string;\n  };\n\nconst useBarsState = (\n  chartProps: ChartProps<BarConfig>,\n  variables: BarsStateVariables,\n  data: ChartStateData\n): BarsState => {\n  const { chartConfig, dimensions, measures } = chartProps;\n  const {\n    yDimension,\n    getX,\n    getYAsDate,\n    getYAbbreviationOrLabel,\n    getYLabel,\n    formatYDate,\n    xMeasure,\n    getY,\n    getMinX,\n    getXErrorRange,\n    getFormattedXUncertainty,\n    getSegmentLabel,\n    xAxisLabel,\n    yAxisLabel,\n    minLimitValue,\n    maxLimitValue,\n  } = variables;\n  const { chartData, scalesData, timeRangeData, paddingData, allData } = data;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const { x } = fields;\n\n  const { width, height } = useSize();\n  const formatNumber = useFormatNumber({ decimals: \"auto\" });\n  const formatters = useChartFormatters(chartProps);\n\n  const sumsByY = useMemo(() => {\n    return Object.fromEntries(\n      rollup(\n        chartData,\n        (v) => sum(v, (x) => getX(x)),\n        (x) => getY(x)\n      )\n    );\n  }, [chartData, getX, getY]);\n\n  const {\n    xScale,\n    paddingXScale,\n    yScale,\n    minY,\n    yScaleTimeRange,\n    yScaleInteraction,\n    yTimeRangeDomainLabels,\n  } = useMemo(() => {\n    const sorters = makeDimensionValueSorters(yDimension, {\n      sorting: fields.y.sorting,\n      measureBySegment: sumsByY,\n      useAbbreviations: fields.y.useAbbreviations,\n      dimensionFilter: yDimension?.id\n        ? chartConfig.cubes.find((d) => d.iri === yDimension.cubeIri)?.filters[\n            yDimension.id\n          ]\n        : undefined,\n    });\n    const sortingOrders = getSortingOrders(sorters, fields.y.sorting);\n    const bandDomain = orderBy(\n      [...new Set(scalesData.map(getY))],\n      sorters,\n      sortingOrders\n    );\n    const yTimeRangeValues = [...new Set(timeRangeData.map(getY))];\n    const yTimeRangeDomainLabels = yTimeRangeValues.map(getYLabel);\n    const yScale = scaleBand()\n      .domain(bandDomain)\n      .paddingInner(PADDING_INNER)\n      .paddingOuter(PADDING_OUTER);\n    const yScaleInteraction = scaleBand()\n      .domain(bandDomain)\n      .paddingInner(0)\n      .paddingOuter(0);\n\n    const yScaleTimeRangeDomain = extent(timeRangeData, (d) =>\n      getYAsDate(d)\n    ) as [Date, Date];\n\n    const yScaleTimeRange = scaleTime().domain(yScaleTimeRangeDomain);\n\n    const xScale = scaleLinear();\n    const paddingXScale = scaleLinear();\n\n    if (x.customDomain) {\n      xScale.domain(x.customDomain);\n      paddingXScale.domain(x.customDomain);\n    } else {\n      const minValue = getMinX(scalesData, (d) => {\n        return getXErrorRange?.(d)[0] ?? getX(d);\n      });\n      const maxValue = Math.max(\n        max(scalesData, (d) => {\n          return getXErrorRange?.(d)[1] ?? getX(d);\n        }) ?? 0,\n        0\n      );\n      xScale\n        .domain([\n          minLimitValue !== undefined\n            ? Math.min(minLimitValue, minValue)\n            : minValue,\n          maxLimitValue !== undefined\n            ? Math.max(maxLimitValue, maxValue)\n            : maxValue,\n        ])\n        .nice();\n\n      const paddingMinValue = getMinX(paddingData, (d) => {\n        return getXErrorRange?.(d)[0] ?? getX(d);\n      });\n      const paddingMaxValue = Math.max(\n        max(paddingData, (d) => {\n          return getXErrorRange?.(d)[1] ?? getX(d);\n        }) ?? 0,\n        0\n      );\n      paddingXScale\n        .domain([\n          minLimitValue !== undefined\n            ? Math.min(minLimitValue, paddingMinValue)\n            : paddingMinValue,\n          maxLimitValue !== undefined\n            ? Math.max(maxLimitValue, paddingMaxValue)\n            : paddingMaxValue,\n        ])\n        .nice();\n    }\n\n    return {\n      xScale,\n      yScale,\n      minY: bandDomain[0],\n      paddingXScale,\n      yScaleTimeRange,\n      yScaleInteraction,\n      yTimeRangeDomainLabels,\n    };\n  }, [\n    yDimension,\n    fields.y.sorting,\n    fields.y.useAbbreviations,\n    sumsByY,\n    chartConfig.cubes,\n    scalesData,\n    getY,\n    timeRangeData,\n    getYLabel,\n    getMinX,\n    minLimitValue,\n    maxLimitValue,\n    paddingData,\n    getYAsDate,\n    getXErrorRange,\n    getX,\n    x.customDomain,\n  ]);\n\n  const { top, left, bottom } = useChartPadding({\n    xLabelPresent: !!xMeasure.label,\n    yScale: paddingXScale,\n    width,\n    height,\n    interactiveFiltersConfig,\n    formatNumber,\n    bandDomain: yTimeRangeDomainLabels.every((d) => d === undefined)\n      ? yScale.domain()\n      : yTimeRangeDomainLabels,\n    isFlipped: true,\n  });\n  const right = 40;\n  const leftAxisLabelSize = useAxisLabelSizeVariables({\n    label: yAxisLabel,\n    width,\n  });\n  const bottomAxisLabelSize = useAxisLabelSizeVariables({\n    label: xAxisLabel,\n    width,\n  });\n  const margins = {\n    top: DEFAULT_MARGIN_TOP + top + leftAxisLabelSize.offset,\n    right,\n    bottom: bottom + 45,\n    left,\n  };\n\n  const { offset: xValueLabelsOffset, ...showValuesVariables } =\n    useShowBandValueLabelsVariables(x, {\n      chartData,\n      dimensions,\n      measures,\n      getValue: getX,\n      getErrorRange: getXErrorRange,\n      scale: xScale,\n    });\n\n  const chartWidth = getChartWidth({ width, left, right });\n  const bounds = useChartBounds({ width, chartWidth, height, margins });\n  const { chartHeight } = bounds;\n\n  // Here we adjust the height to make sure the bars have a minimum height and are legible\n  const barCount = yScale.domain().length;\n  const adjustedChartHeight =\n    barCount * MIN_BAR_HEIGHT > chartHeight\n      ? barCount * MIN_BAR_HEIGHT\n      : chartHeight;\n\n  xScale.range([0, chartWidth - xValueLabelsOffset]);\n  yScaleInteraction.range([0, adjustedChartHeight]);\n  yScaleTimeRange.range([0, adjustedChartHeight]);\n  yScale.range([0, adjustedChartHeight]);\n\n  const isMobile = useIsMobile();\n\n  const formatYAxisTick = useCallback(\n    (tick: string) => {\n      return isTemporalDimension(yDimension)\n        ? formatYDate(tick)\n        : getYLabel(tick);\n    },\n    [yDimension, formatYDate, getYLabel]\n  );\n\n  const getAnnotationInfo: GetAnnotationInfo = useCallback(\n    (observation) => {\n      const hasValueLabels = showValuesVariables.showValues;\n      const xOffset = hasValueLabels ? xValueLabelsOffset + 8 : 0;\n      const x =\n        xScale(Math.max(getX(observation) ?? NaN, 0)) +\n        ANNOTATION_SINGLE_SEGMENT_OFFSET +\n        xOffset;\n      const y =\n        (yScale(getY(observation)) as number) + yScale.bandwidth() * 0.5;\n\n      return {\n        x,\n        y,\n        color: DEFAULT_ANNOTATION_CIRCLE_COLOR,\n      };\n    },\n    [\n      showValuesVariables.showValues,\n      xValueLabelsOffset,\n      xScale,\n      getX,\n      yScale,\n      getY,\n    ]\n  );\n\n  const getTooltipInfo = (datum: Observation): TooltipInfo => {\n    const yAnchor = (yScale(getY(datum)) as number) + yScale.bandwidth() * 0.5;\n    const xAnchor = isMobile\n      ? chartHeight\n      : xScale(Math.max(getX(datum) ?? NaN, 0));\n    const placement = isMobile\n      ? MOBILE_TOOLTIP_PLACEMENT\n      : getCenteredTooltipPlacement({\n          chartWidth,\n          xAnchor: yAnchor,\n          topAnchor: !fields.segment,\n        });\n\n    const yLabel = getYAbbreviationOrLabel(datum);\n\n    const xValueFormatter = (value: number | null) =>\n      formatNumberWithUnit(\n        value,\n        formatters[xMeasure.id] ?? formatNumber,\n        xMeasure.unit\n      );\n\n    const x = getX(datum);\n\n    return {\n      xAnchor,\n      yAnchor,\n      placement,\n      value: formatYAxisTick(yLabel),\n      datum: {\n        label: undefined,\n        value: x !== null && isNaN(x) ? \"-\" : `${xValueFormatter(getX(datum))}`,\n        error: getFormattedXUncertainty(datum),\n        color: \"\",\n      },\n      values: undefined,\n    };\n  };\n\n  const { segments, colors } = useMemo(() => {\n    const segments: string[] = [];\n    const colors = scaleOrdinal<string, string>();\n\n    colors.range(\n      getPalette({\n        paletteId: fields.color.paletteId,\n        colorField: fields.color,\n      })\n    );\n\n    return {\n      segments,\n      colors,\n    };\n  }, [fields.color]);\n\n  return {\n    chartType: \"bar\",\n    bounds: {\n      ...bounds,\n      chartHeight: adjustedChartHeight,\n    },\n    chartData,\n    allData,\n    xScale,\n    minY,\n    yScaleTimeRange,\n    yScaleInteraction,\n    yScale,\n    getAnnotationInfo,\n    getTooltipInfo,\n    getColorLabel: getSegmentLabel,\n    segments,\n    colors,\n    leftAxisLabelSize,\n    leftAxisLabelOffsetTop: top,\n    bottomAxisLabelSize,\n    formatYAxisTick,\n    ...showValuesVariables,\n    ...variables,\n  };\n};\n\nconst BarChartProvider = (\n  props: PropsWithChildren<\n    ChartProps<BarConfig> & { limits: ReturnType<typeof useLimits> }\n  >\n) => {\n  const { children, ...chartProps } = props;\n  const variables = useBarsStateVariables(chartProps);\n  const data = useBarsStateData(chartProps, variables);\n  const state = useBarsState(chartProps, variables, data);\n\n  return (\n    <ChartContext.Provider value={state}>{children}</ChartContext.Provider>\n  );\n};\n\nexport const BarChart = (\n  props: PropsWithChildren<\n    ChartProps<BarConfig> & { limits: ReturnType<typeof useLimits> }\n  >\n) => {\n  return (\n    <InteractionProvider>\n      <BarChartProvider {...props} />\n    </InteractionProvider>\n  );\n};\n","import { useCallback, useMemo } from \"react\";\n\nimport { GroupedBarsState } from \"@/charts/bar/bars-grouped-state\";\nimport { StackedBarsState } from \"@/charts/bar/bars-stacked-state\";\nimport { BarsState } from \"@/charts/bar/bars-state\";\nimport { useGetRenderStackedBarDatum } from \"@/charts/bar/rendering-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { StackedAnnotationHighlight } from \"@/charts/shared/overlay-rects\";\nimport { useAnnotationInteractions } from \"@/charts/shared/use-annotation-interactions\";\nimport { Observation } from \"@/domain/data\";\n\nexport const InteractionBars = ({\n  disableGaps = true,\n}: {\n  disableGaps?: boolean;\n}) => {\n  const {\n    chartData,\n    bounds: { chartWidth, margins },\n    getY,\n    yScale,\n    yScaleInteraction,\n  } = useChartState() as BarsState | StackedBarsState | GroupedBarsState;\n  const { onClick, onHover, onHoverOut } = useAnnotationInteractions({\n    focusingSegment: false,\n  });\n  const scale = disableGaps ? yScaleInteraction : yScale;\n  const bandwidth = scale.bandwidth();\n\n  return (\n    <g transform={`translate(${margins.left} ${margins.top})`}>\n      {chartData.map((d, i) => {\n        return (\n          <rect\n            key={i}\n            x={0}\n            y={scale(getY(d)) as number}\n            height={bandwidth}\n            width={Math.max(0, chartWidth)}\n            stroke=\"none\"\n            fill=\"hotpink\"\n            fillOpacity={0}\n            onMouseOver={() => onHover(d, { segment: undefined })}\n            onMouseOut={onHoverOut}\n            onClick={() => onClick(d, { segment: undefined })}\n          />\n        );\n      })}\n    </g>\n  );\n};\n\nexport const InteractionBarsStacked = () => {\n  const {\n    bounds: { height, margins },\n    series,\n  } = useChartState() as StackedBarsState;\n  const { onClick, onHover, onHoverOut } = useAnnotationInteractions({\n    focusingSegment: true,\n  });\n  const getRenderDatum = useGetRenderStackedBarDatum();\n  const renderData = useMemo(() => {\n    return series.flatMap(getRenderDatum);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    getRenderDatum,\n    series,\n    // We need to reset the yRange on height change.\n    height,\n  ]);\n\n  return (\n    <g transform={`translate(${margins.left} ${margins.top})`}>\n      {renderData.map((d) => {\n        return (\n          <rect\n            key={d.key}\n            x={d.x}\n            y={d.y}\n            width={d.width}\n            height={d.height}\n            fill=\"hotpink\"\n            fillOpacity={0}\n            stroke=\"none\"\n            onMouseOver={() => onHover(d.observation, { segment: d.segment })}\n            onMouseOut={onHoverOut}\n            onClick={() => onClick(d.observation, { segment: d.segment })}\n          />\n        );\n      })}\n    </g>\n  );\n};\n\nexport const StackedBarAnnotationHighlight = () => {\n  const {\n    bounds,\n    getY,\n    getX,\n    yScale,\n    xScale,\n    chartDataGroupedByY,\n    yDimension,\n  } = useChartState() as StackedBarsState;\n  const getValue = useCallback(\n    (d: Observation) => {\n      return getX(d) ?? 0;\n    },\n    [getX]\n  );\n\n  return (\n    <StackedAnnotationHighlight\n      bounds={bounds}\n      getValue={getValue}\n      getAxisValue={getY}\n      valueScale={xScale}\n      axisScale={yScale}\n      chartDataGrouped={chartDataGroupedByY}\n      dimension={yDimension}\n      isHorizontal\n    />\n  );\n};\n","import { axisLeft } from \"d3-axis\";\nimport { useEffect, useRef } from \"react\";\n\nimport { GroupedBarsState } from \"@/charts/bar/bars-grouped-state\";\nimport { StackedBarsState } from \"@/charts/bar/bars-stacked-state\";\nimport { BarsState } from \"@/charts/bar/bars-state\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport {\n  maybeTransition,\n  renderContainer,\n} from \"@/charts/shared/rendering-utils\";\nimport { useChartTheme } from \"@/charts/shared/use-chart-theme\";\nimport { OpenMetadataPanelWrapper } from \"@/components/metadata-panel\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { useTransitionStore } from \"@/stores/transition\";\n\nexport const AxisHeightBand = () => {\n  const ref = useRef<SVGGElement>(null);\n  const {\n    xScale,\n    getYLabel,\n    yTimeUnit,\n    yScale,\n    bounds,\n    yDimension,\n    leftAxisLabelSize,\n    leftAxisLabelOffsetTop,\n    formatYAxisTick,\n  } = useChartState() as BarsState | GroupedBarsState | StackedBarsState;\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const formatDate = useTimeFormatUnit();\n  const { chartHeight, margins } = bounds;\n  const {\n    labelColor,\n    axisLabelFontSize,\n    gridColor,\n    labelFontSize,\n    fontFamily,\n    domainColor,\n  } = useChartTheme();\n  const bandwidth = yScale.bandwidth();\n  const fontSize = bandwidth > labelFontSize ? labelFontSize : bandwidth;\n\n  useEffect(() => {\n    if (ref.current) {\n      const hasNegativeValues = xScale.domain()[0] < 0;\n      const axis = axisLeft(yScale)\n        .tickSizeOuter(0)\n        .tickSizeInner(hasNegativeValues ? -chartHeight : 6)\n        .tickFormat(formatYAxisTick ?? ((tick) => tick));\n\n      const g = renderContainer(ref.current, {\n        id: \"axis-height-band\",\n        transform: `translate(${margins.left} ${margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g) => g.attr(\"data-testid\", \"axis-height-band\").call(axis),\n        renderUpdate: (g, opts) =>\n          maybeTransition(g, {\n            transition: opts.transition,\n            s: (g) => g.call(axis),\n          }),\n      });\n\n      g.select(\".domain\").remove();\n      g.selectAll(\".tick line\").attr(\n        \"stroke\",\n        hasNegativeValues ? gridColor : domainColor\n      );\n      g.selectAll(\".tick text\")\n        .attr(\"font-size\", fontSize)\n        .attr(\"font-family\", fontFamily)\n        .attr(\"fill\", labelColor)\n        .attr(\"text-anchor\", \"unset\");\n    }\n  }, [\n    chartHeight,\n    domainColor,\n    enableTransition,\n    fontFamily,\n    formatDate,\n    getYLabel,\n    gridColor,\n    labelColor,\n    labelFontSize,\n    margins.left,\n    margins.top,\n    transitionDuration,\n    xScale,\n    yTimeUnit,\n    yScale,\n    fontSize,\n    formatYAxisTick,\n  ]);\n\n  return (\n    <>\n      <g ref={ref} />\n      <foreignObject\n        y={leftAxisLabelOffsetTop}\n        width={leftAxisLabelSize.width}\n        height={leftAxisLabelSize.height}\n        style={{ display: \"flex\" }}\n      >\n        <OpenMetadataPanelWrapper component={yDimension}>\n          <span style={{ fontSize: axisLabelFontSize, lineHeight: 1.5 }}>\n            {yDimension.label}\n          </span>\n        </OpenMetadataPanelWrapper>\n      </foreignObject>\n    </>\n  );\n};\n\nexport const AxisHeightBandDomain = () => {\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const { xScale, yScale, bounds, minY } = useChartState() as BarsState;\n  const { chartHeight, margins } = bounds;\n  const { domainColor } = useChartTheme();\n\n  useEffect(() => {\n    if (ref.current) {\n      const axis = axisLeft(yScale).tickSizeOuter(0);\n      const g = renderContainer(ref.current, {\n        id: \"axis-height-band-domain\",\n        transform: `translate(${margins.left} ${margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g) => g.call(axis),\n        renderUpdate: (g, opts) =>\n          maybeTransition(g, {\n            transition: opts.transition,\n            s: (g) => g.call(axis),\n          }),\n      });\n\n      g.selectAll(\".tick line\").remove();\n      g.selectAll(\".tick text\").remove();\n      g.select(\".domain\")\n        .attr(\"transform\", `translate(0, 0)`)\n        .attr(\"stroke\", domainColor);\n    }\n  }, [\n    minY,\n    bounds.chartHeight,\n    chartHeight,\n    domainColor,\n    enableTransition,\n    margins.left,\n    margins.top,\n    transitionDuration,\n    xScale,\n    yScale,\n  ]);\n\n  return <g ref={ref} />;\n};\n","import { useMemo } from \"react\";\n\nimport { BarsState } from \"@/charts/bar/bars-state\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { createLimitsComponent } from \"@/charts/shared/limits/create-component\";\nimport { useLimits } from \"@/config-utils\";\n\nexport type HorizontalChartState = BarsState;\n\nexport const HorizontalLimits = (props: ReturnType<typeof useLimits>) => {\n  const chartState = useChartState() as HorizontalChartState;\n  const LimitsComponent = useMemo(() => {\n    return createLimitsComponent({\n      isHorizontal: true,\n      getChartState: () => chartState,\n    });\n  }, [chartState]);\n\n  return <LimitsComponent {...props} />;\n};\nHorizontalLimits.displayName = \"HorizontalLimits\";\n","import { memo } from \"react\";\n\nimport { Bars, ErrorWhiskers } from \"@/charts/bar/bars\";\nimport {\n  BarsGrouped,\n  ErrorWhiskers as ErrorWhiskersGrouped,\n} from \"@/charts/bar/bars-grouped\";\nimport { GroupedBarChart } from \"@/charts/bar/bars-grouped-state\";\nimport { BarsStacked } from \"@/charts/bar/bars-stacked\";\nimport { StackedBarsChart } from \"@/charts/bar/bars-stacked-state\";\nimport { BarChart } from \"@/charts/bar/bars-state\";\nimport {\n  InteractionBars,\n  InteractionBarsStacked,\n  StackedBarAnnotationHighlight,\n} from \"@/charts/bar/overlay-bars\";\nimport { ChartDataWrapper } from \"@/charts/chart-data-wrapper\";\nimport { useIsEditingAnnotation } from \"@/charts/shared/annotation-utils\";\nimport { Annotations } from \"@/charts/shared/annotations\";\nimport {\n  AxisHeightBand,\n  AxisHeightBandDomain,\n} from \"@/charts/shared/axis-height-band\";\nimport { AxisHideYOverflowRect } from \"@/charts/shared/axis-hide-overflow-rect\";\nimport { AxisWidthLinear } from \"@/charts/shared/axis-width-linear\";\nimport { BrushTime, shouldShowBrush } from \"@/charts/shared/brush\";\nimport {\n  ChartContainer,\n  ChartControlsContainer,\n  ChartSvg,\n} from \"@/charts/shared/containers\";\nimport { HoverAnnotationDot } from \"@/charts/shared/interaction/hover-annotation-dot\";\nimport { Tooltip } from \"@/charts/shared/interaction/tooltip\";\nimport { LegendColor } from \"@/charts/shared/legend-color\";\nimport { HorizontalLimits } from \"@/charts/shared/limits/horizontal\";\nimport { BarConfig } from \"@/config-types\";\nimport { useChartConfigFilters, useLimits } from \"@/config-utils\";\nimport { hasChartConfigs } from \"@/configurator\";\nimport { useConfiguratorState } from \"@/configurator/configurator-state\";\nimport { TimeSlider } from \"@/configurator/interactive-filters/time-slider\";\n\nimport { ChartProps, VisualizationProps } from \"../shared/chart-props\";\n\nexport const ChartBarsVisualization = (\n  props: VisualizationProps<BarConfig>\n) => {\n  return <ChartDataWrapper {...props} Component={ChartBars} />;\n};\n\nconst ChartBars = memo((props: ChartProps<BarConfig>) => {\n  const { chartConfig, dimensions, dimensionsById, measures } = props;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const filters = useChartConfigFilters(chartConfig);\n  const [{ dashboardFilters }] = useConfiguratorState(hasChartConfigs);\n  const showTimeBrush = shouldShowBrush(\n    interactiveFiltersConfig,\n    dashboardFilters?.timeRange\n  );\n  const limits = useLimits({\n    chartConfig,\n    dimensions,\n    measures,\n  });\n  const isEditingAnnotation = useIsEditingAnnotation();\n\n  return (\n    <>\n      {fields.segment?.componentId && fields.segment.type === \"stacked\" ? (\n        <StackedBarsChart {...props}>\n          <ChartContainer>\n            <ChartSvg>\n              <AxisWidthLinear />\n              <AxisHideYOverflowRect />\n              <AxisHeightBand />\n              <AxisHeightBandDomain />\n              <BarsStacked />\n              {isEditingAnnotation ? (\n                <>\n                  <InteractionBars disableGaps={false} />\n                  <InteractionBarsStacked />\n                  <StackedBarAnnotationHighlight />\n                </>\n              ) : (\n                <InteractionBars />\n              )}\n              {showTimeBrush && <BrushTime />}\n            </ChartSvg>\n            {isEditingAnnotation ? (\n              <HoverAnnotationDot />\n            ) : (\n              <Tooltip type=\"multiple\" />\n            )}\n          </ChartContainer>\n          <Annotations />\n          <ChartControlsContainer>\n            {fields.animation && (\n              <TimeSlider\n                filters={filters}\n                dimensions={dimensions}\n                {...fields.animation}\n              />\n            )}\n            <LegendColor\n              dimensionsById={dimensionsById}\n              chartConfig={chartConfig}\n              symbol=\"square\"\n              interactive={interactiveFiltersConfig.legend.active}\n              showTitle={fields.segment.showTitle}\n            />\n          </ChartControlsContainer>\n        </StackedBarsChart>\n      ) : fields.segment?.componentId && fields.segment.type === \"grouped\" ? (\n        <GroupedBarChart {...props}>\n          <ChartContainer>\n            <ChartSvg>\n              <AxisWidthLinear />\n              <AxisHideYOverflowRect />\n              <AxisHeightBand />\n              <AxisHeightBandDomain />\n              <BarsGrouped />\n              <ErrorWhiskersGrouped />\n              <InteractionBars />\n              {showTimeBrush && <BrushTime />}\n            </ChartSvg>\n            <Tooltip type=\"multiple\" />\n          </ChartContainer>\n          <ChartControlsContainer>\n            {fields.animation && (\n              <TimeSlider\n                filters={filters}\n                dimensions={dimensions}\n                {...fields.animation}\n              />\n            )}\n            <LegendColor\n              dimensionsById={dimensionsById}\n              chartConfig={chartConfig}\n              symbol=\"square\"\n              interactive={interactiveFiltersConfig.legend.active}\n              showTitle={fields.segment.showTitle}\n            />\n          </ChartControlsContainer>\n        </GroupedBarChart>\n      ) : (\n        <BarChart {...props} limits={limits}>\n          <ChartContainer>\n            <ChartSvg>\n              <AxisWidthLinear />\n              <AxisHideYOverflowRect />\n              <AxisHeightBand />\n              <AxisHeightBandDomain />\n              <Bars />\n              <ErrorWhiskers />\n              <HorizontalLimits {...limits} />\n              <InteractionBars />\n              {showTimeBrush && <BrushTime />}\n            </ChartSvg>\n            {isEditingAnnotation ? (\n              <HoverAnnotationDot />\n            ) : (\n              <Tooltip type=\"single\" />\n            )}\n          </ChartContainer>\n          <Annotations />\n          {fields.animation || limits.limits.length > 0 ? (\n            <ChartControlsContainer>\n              {limits.limits.length > 0 && (\n                <LegendColor\n                  limits={limits}\n                  dimensionsById={dimensionsById}\n                  chartConfig={chartConfig}\n                  symbol=\"square\"\n                />\n              )}\n              {fields.animation && (\n                <TimeSlider\n                  filters={filters}\n                  dimensions={dimensions}\n                  {...fields.animation}\n                />\n              )}\n            </ChartControlsContainer>\n          ) : null}\n        </BarChart>\n      )}\n    </>\n  );\n});\n","import { axisBottom } from \"d3-axis\";\nimport { useEffect, useRef } from \"react\";\n\nimport { GroupedBarsState } from \"@/charts/bar/bars-grouped-state\";\nimport { StackedBarsState } from \"@/charts/bar/bars-stacked-state\";\nimport { BarsState } from \"@/charts/bar/bars-state\";\nimport { ScatterplotState } from \"@/charts/scatterplot/scatterplot-state\";\nimport { useXAxisTitleOffset } from \"@/charts/shared/chart-dimensions\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport {\n  maybeTransition,\n  renderContainer,\n} from \"@/charts/shared/rendering-utils\";\nimport { useChartTheme } from \"@/charts/shared/use-chart-theme\";\nimport { OpenMetadataPanelWrapper } from \"@/components/metadata-panel\";\nimport { useFormatNumber } from \"@/formatters\";\nimport { useTransitionStore } from \"@/stores/transition\";\nimport { getTextWidth } from \"@/utils/get-text-width\";\n\nexport const AxisWidthLinear = () => {\n  const formatNumber = useFormatNumber();\n  const {\n    xScale,\n    bounds,\n    xAxisLabel,\n    xMeasure,\n    chartType,\n    bottomAxisLabelSize,\n  } = useChartState() as\n    | ScatterplotState\n    | BarsState\n    | GroupedBarsState\n    | StackedBarsState;\n  const { chartWidth, chartHeight, margins } = bounds;\n  const {\n    labelColor,\n    labelFontSize,\n    axisLabelFontSize,\n    gridColor,\n    fontFamily,\n  } = useChartTheme();\n  const xAxisTitleOffset = useXAxisTitleOffset();\n\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n\n  useEffect(() => {\n    if (ref.current) {\n      const maxLabelLength = getTextWidth(formatNumber(xScale.domain()[1]), {\n        fontSize: labelFontSize,\n      });\n      const ticks = Math.min(bounds.chartWidth / (maxLabelLength + 20), 4);\n      const tickValues = xScale.ticks(ticks);\n      const axis = axisBottom(xScale)\n        .tickValues(tickValues)\n        .tickSizeInner(-chartHeight - 10)\n        .tickSizeOuter(-chartHeight)\n        .tickFormat(formatNumber);\n      const g = renderContainer(ref.current, {\n        id: \"axis-width-linear\",\n        transform: `translate(${margins.left} ${chartHeight + margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g) => g.call(axis),\n        renderUpdate: (g, opts) =>\n          maybeTransition(g, {\n            transition: opts.transition,\n            s: (g) => g.call(axis),\n          }),\n      });\n\n      g.selectAll(\".tick line\")\n        .attr(\"y1\", 10)\n        .attr(\"stroke\", (_, i) => (i === 0 ? \"#000000\" : gridColor))\n        .attr(\"stroke-width\", 1);\n      g.selectAll(\".tick text\")\n        .attr(\"font-size\", labelFontSize)\n        .attr(\"font-family\", fontFamily)\n        .attr(\"fill\", labelColor)\n        .attr(\"dy\", labelFontSize + 10)\n        .attr(\"text-anchor\", \"middle\");\n      g.select(\"path.domain\").attr(\"stroke\", gridColor);\n      if (chartType === \"bar\") {\n        g.select(\"path.domain\").remove();\n      }\n    }\n  }, [\n    chartType,\n    bounds.chartWidth,\n    chartHeight,\n    enableTransition,\n    fontFamily,\n    formatNumber,\n    gridColor,\n    labelColor,\n    labelFontSize,\n    margins.left,\n    margins.top,\n    transitionDuration,\n    xScale,\n  ]);\n\n  return (\n    <>\n      <foreignObject\n        x={margins.left + chartWidth / 2 - bottomAxisLabelSize.width / 2}\n        y={margins.top + chartHeight + xAxisTitleOffset}\n        width={chartWidth}\n        height={bottomAxisLabelSize.height}\n        style={{ display: \"flex\" }}\n      >\n        <OpenMetadataPanelWrapper component={xMeasure}>\n          <span style={{ fontSize: axisLabelFontSize, lineHeight: 1.5 }}>\n            {xAxisLabel}\n          </span>\n        </OpenMetadataPanelWrapper>\n      </foreignObject>\n      <g ref={ref} />\n    </>\n  );\n};\n\nexport const AxisWidthLinearDomain = () => {\n  const { xScale, yScale, bounds } = useChartState() as ScatterplotState;\n  const { chartHeight, margins } = bounds;\n  const { domainColor } = useChartTheme();\n  const ref = useRef<SVGGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n\n  useEffect(() => {\n    if (ref.current) {\n      const axis = axisBottom(xScale).tickSizeOuter(0);\n      const g = renderContainer(ref.current, {\n        id: \"axis-width-linear-domain\",\n        transform: `translate(${margins.left} ${chartHeight + margins.top})`,\n        transition: { enable: enableTransition, duration: transitionDuration },\n        render: (g) => g.call(axis),\n        renderUpdate: (g, opts) =>\n          maybeTransition(g, {\n            transition: opts.transition,\n            s: (g) => g.call(axis),\n          }),\n      });\n\n      g.selectAll(\".tick line\").remove();\n      g.selectAll(\".tick text\").remove();\n      g.select(\"path.domain\")\n        .attr(\"data-name\", \"width-axis-domain\")\n        .attr(\"transform\", `translate(0, -${bounds.chartHeight - yScale(0)})`)\n        .attr(\"stroke\", domainColor);\n    }\n  }, [\n    bounds.chartHeight,\n    chartHeight,\n    domainColor,\n    enableTransition,\n    margins.left,\n    margins.top,\n    transitionDuration,\n    xScale,\n    yScale,\n  ]);\n\n  return <g ref={ref} />;\n};\n","import { sum } from \"d3-array\";\nimport { ScaleBand, ScaleLinear } from \"d3-scale\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { useGetAnnotationRenderState } from \"@/charts/shared/annotation-utils\";\nimport {\n  ANNOTATION_FOCUS_COLOR,\n  ANNOTATION_FOCUS_WIDTH,\n} from \"@/charts/shared/rendering-utils\";\nimport { useInteraction } from \"@/charts/shared/use-interaction\";\nimport { Observation } from \"@/domain/data\";\n\nconst OverlayHighlightRect = ({\n  x,\n  y,\n  width,\n  height,\n}: {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}) => {\n  return (\n    <rect\n      x={x}\n      y={y}\n      width={width}\n      height={height}\n      fill=\"none\"\n      stroke={ANNOTATION_FOCUS_COLOR}\n      strokeWidth={ANNOTATION_FOCUS_WIDTH}\n      pointerEvents=\"none\"\n    />\n  );\n};\n\nexport const StackedAnnotationHighlight = ({\n  bounds,\n  getValue,\n  getAxisValue,\n  valueScale,\n  axisScale,\n  chartDataGrouped,\n  dimension,\n  isHorizontal,\n}: {\n  bounds: { width: number; margins: { left: number; top: number } };\n  getValue: (d: Observation) => number;\n  getAxisValue: (d: Observation) => string;\n  valueScale: ScaleLinear<number, number>;\n  axisScale: ScaleBand<string>;\n  chartDataGrouped: Map<string, Observation[]>;\n  dimension: { id: string };\n  isHorizontal: boolean;\n}) => {\n  const [interaction] = useInteraction();\n  const getAnnotationRenderState = useGetAnnotationRenderState();\n  const axisSize = axisScale.bandwidth();\n\n  const getHighlightRect = useCallback(\n    (axisKey: string) => {\n      const axisPosition = axisScale(axisKey) as number;\n      const values = chartDataGrouped.get(axisKey) ?? [];\n      const valueSum = sum(values, getValue) ?? 0;\n      const value0 = valueScale(0);\n      const value1 = valueScale(valueSum);\n      const valueSize = Math.abs(value1 - value0);\n\n      if (isHorizontal) {\n        return {\n          x: value0,\n          y: axisPosition,\n          width: valueSize,\n          height: axisSize,\n        };\n      } else {\n        return {\n          x: axisPosition,\n          y: value1,\n          width: axisSize,\n          height: valueSize,\n        };\n      }\n    },\n    [chartDataGrouped, getValue, valueScale, axisScale, axisSize, isHorizontal]\n  );\n\n  const highlightedRects = useMemo(() => {\n    bounds.width;\n\n    const rects: {\n      x: number;\n      y: number;\n      width: number;\n      height: number;\n    }[] = [];\n\n    if (\n      interaction.observation &&\n      interaction.type === \"annotation\" &&\n      interaction.visible &&\n      !interaction.focusingSegment\n    ) {\n      const axisValue = getAxisValue(interaction.observation);\n      const { focused } = getAnnotationRenderState(interaction.observation, {\n        axisComponentId: dimension.id,\n        axisValue,\n      });\n\n      if (focused) {\n        rects.push(getHighlightRect(axisValue));\n      }\n    }\n\n    for (const [axisValue, observations] of chartDataGrouped) {\n      const { focused, isActive } = getAnnotationRenderState(observations[0], {\n        axisComponentId: dimension.id,\n        axisValue,\n      });\n\n      if (\n        isActive ||\n        (focused &&\n          interaction.type === \"annotation\" &&\n          !interaction.focusingSegment)\n      ) {\n        rects.push(getHighlightRect(axisValue));\n      }\n    }\n\n    return rects;\n  }, [\n    bounds.width,\n    interaction,\n    getAxisValue,\n    getAnnotationRenderState,\n    dimension.id,\n    getHighlightRect,\n    chartDataGrouped,\n  ]);\n\n  if (highlightedRects.length === 0) {\n    return null;\n  }\n\n  return (\n    <g transform={`translate(${bounds.margins.left} ${bounds.margins.top})`}>\n      {highlightedRects.map((rect, i) => (\n        <OverlayHighlightRect\n          key={i}\n          x={rect.x}\n          y={rect.y}\n          width={rect.width}\n          height={rect.height}\n        />\n      ))}\n    </g>\n  );\n};\n","import { Box, Button, sliderClasses, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport orderBy from \"lodash/orderBy\";\nimport {\n  ChangeEvent,\n  createContext,\n  useContext,\n  useEffect,\n  useMemo,\n} from \"react\";\nimport { useSyncExternalStore } from \"use-sync-external-store/shim\";\n\nimport { ChartState, useChartState } from \"@/charts/shared/chart-state\";\nimport { TableChartState } from \"@/charts/table/table-state\";\nimport { Slider as GenericSlider } from \"@/components/form\";\nimport { AnimationField, Filters, SortingField } from \"@/config-types\";\nimport { parseDate } from \"@/configurator/components/ui-helpers\";\nimport { hasChartConfigs } from \"@/configurator/configurator-state\";\nimport {\n  Dimension,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  isTemporalOrdinalDimension,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { Icon } from \"@/icons\";\nimport { useConfiguratorState } from \"@/src\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\nimport { Timeline, TimelineProps } from \"@/utils/observables\";\nimport {\n  getSortingOrders,\n  makeDimensionValueSorters,\n} from \"@/utils/sorting-values\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nconst TimelineContext = createContext<Timeline | undefined>(undefined);\n\nconst useTimeline = () => {\n  const timeline = useContext(TimelineContext);\n\n  if (!timeline) {\n    throw Error(\n      \"useTimeline must be called inside a TimelineContext.Provider!\"\n    );\n  }\n\n  useSyncExternalStore(timeline.subscribe, timeline.getUpdateKey);\n\n  return timeline;\n};\n\ntype TimeSliderProps = {\n  filters: Filters;\n  dimensions: Dimension[];\n} & AnimationField;\n\nexport const TimeSlider = (props: TimeSliderProps) => {\n  const {\n    componentId,\n    showPlayButton,\n    type: animationType,\n    duration: animationDuration,\n    filters,\n    dimensions,\n  } = props;\n\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const dimension = useMemo(() => {\n    return dimensions.find((d) => d.id === componentId);\n  }, [componentId, dimensions]);\n  const temporal = isTemporalDimension(dimension);\n  const temporalEntity = isTemporalEntityDimension(dimension);\n  const temporalOrdinal = isTemporalOrdinalDimension(dimension);\n\n  if (!(temporal || temporalEntity || temporalOrdinal)) {\n    throw Error(\"You can only use TimeSlider with temporal dimensions!\");\n  }\n\n  const timeFormatUnit = useTimeFormatUnit();\n  const timeUnit = \"timeUnit\" in dimension ? dimension.timeUnit : undefined;\n\n  // No TimeSlider for tables.\n  const chartState = useChartState() as NonNullable<\n    Exclude<ChartState, TableChartState>\n  >;\n  const dimensionFilter = filters[dimension.id];\n  const timelineProps: TimelineProps = useMemo(() => {\n    const commonProps = {\n      animationType,\n      msDuration: animationDuration * 1000,\n    };\n    const uniqueValues = Array.from(\n      new Set(\n        chartState.allData\n          .map((d) => d[dimension.id])\n          .filter(truthy) as string[]\n      )\n    );\n\n    if (temporal) {\n      const msValues = uniqueValues.map((d) => parseDate(d).getTime());\n      const formatValue = (d: number) => timeFormatUnit(new Date(d), timeUnit!);\n\n      return {\n        type: \"interval\",\n        msValues,\n        formatValue,\n        ...commonProps,\n      };\n    } else {\n      const sorting: NonNullable<SortingField[\"sorting\"]> = {\n        sortingType: \"byAuto\",\n        sortingOrder: \"asc\",\n      };\n      const sorters = makeDimensionValueSorters(dimension, {\n        dimensionFilter,\n        sorting,\n      });\n      const sortingOrders = getSortingOrders(sorters, sorting);\n      const sortedData = orderBy(uniqueValues, sorters, sortingOrders);\n\n      return {\n        type: \"ordinal\",\n        sortedData,\n        ...commonProps,\n      };\n    }\n  }, [\n    animationType,\n    animationDuration,\n    chartState.allData,\n    temporal,\n    dimension,\n    timeFormatUnit,\n    timeUnit,\n    dimensionFilter,\n  ]);\n\n  const timeline = useMemo(() => {\n    return new Timeline(timelineProps);\n  }, [timelineProps]);\n\n  if (state.dashboardFilters?.timeRange.active) {\n    return null;\n  }\n\n  return (\n    <TimelineContext.Provider value={timeline}>\n      <Root showPlayButton={showPlayButton} />\n    </TimelineContext.Provider>\n  );\n};\n\nconst Root = ({ showPlayButton }: { showPlayButton: boolean }) => {\n  const timeline = useTimeline();\n  const [min, max] = timeline.formattedExtent;\n\n  return (\n    <Box\n      {...DISABLE_SCREENSHOT_ATTR}\n      sx={{\n        display: \"flex\",\n        alignItems: \"center\",\n        gap: 5,\n        mb: 5,\n        mr: 2.5,\n      }}\n    >\n      {showPlayButton && <PlayButton />}\n      <div style={{ position: \"relative\", width: \"100%\" }}>\n        <Slider />\n        <Typography\n          variant=\"caption\"\n          sx={{ position: \"absolute\", left: 0, mt: 2 }}\n        >\n          {min}\n        </Typography>\n        <Typography\n          variant=\"caption\"\n          sx={{ position: \"absolute\", right: 0, mt: 2 }}\n        >\n          {max}\n        </Typography>\n      </div>\n    </Box>\n  );\n};\n\nconst PlayButton = () => {\n  const timeline = useTimeline();\n\n  const onClick = useEvent(() => {\n    timeline.playing ? timeline.stop() : timeline.start();\n  });\n\n  return (\n    <Button\n      onClick={onClick}\n      variant=\"outlined\"\n      style={{\n        minHeight: 32,\n        minWidth: 32,\n        padding: 0,\n        borderRadius: \"50%\",\n      }}\n    >\n      <Icon name={timeline.playing ? \"pause\" : \"play\"} size={16} />\n    </Button>\n  );\n};\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    width: \"100%\",\n\n    [`& .${sliderClasses.root}`]: {\n      height: \"6px\",\n\n      [`& .${sliderClasses.thumb}`]: {\n        width: \"16px\",\n        height: \"16px\",\n      },\n    },\n  },\n\n  playing: {\n    [`& .${sliderClasses.thumb}`]: {\n      transition: \"none\",\n    },\n\n    [`& .${sliderClasses.track}`]: {\n      transition: \"none\",\n    },\n  },\n}));\n\nconst Slider = () => {\n  const timeline = useTimeline();\n  const timeSlider = useChartInteractiveFilters((d) => d.timeSlider);\n  const setTimeSlider = useChartInteractiveFilters((d) => d.setTimeSlider);\n  const classes = useStyles();\n\n  const marks = useMemo(() => {\n    return timeline.domain.map((d) => ({ value: d })) ?? [];\n  }, [timeline.domain]);\n\n  const onChange = useEvent((e: ChangeEvent<HTMLInputElement>) => {\n    timeline.setProgress(+e.target.value);\n  });\n\n  const onClick = useEvent(() => {\n    timeline.stop();\n  });\n\n  useEffect(() => {\n    if (timeline.type !== timeSlider.type) {\n      setTimeSlider({\n        type: timeline.type,\n        value: undefined,\n      });\n    }\n\n    if (\n      timeline.type === \"interval\" &&\n      timeSlider.type === \"interval\" &&\n      timeSlider.value?.getTime() !== timeline.value\n    ) {\n      setTimeSlider({\n        type: \"interval\",\n        value: new Date(timeline.value),\n      });\n    }\n\n    if (\n      timeline.type === \"ordinal\" &&\n      timeSlider.type === \"ordinal\" &&\n      timeSlider?.value !== timeline.value\n    ) {\n      setTimeSlider({\n        type: \"ordinal\",\n        value: timeline.value as string,\n      });\n    }\n  }, [\n    timeline.value,\n    timeline.type,\n    timeSlider.type,\n    timeSlider.value,\n    setTimeSlider,\n  ]);\n\n  return (\n    <GenericSlider\n      name=\"time-slider\"\n      renderTextInput={false}\n      min={0}\n      max={1}\n      step={null}\n      marks={marks}\n      value={timeline.progress}\n      onChange={onChange}\n      onClick={onClick}\n      valueLabelDisplay=\"on\"\n      valueLabelFormat={timeline.formattedValue}\n      className={clsx(classes.root, timeline.playing && classes.playing)}\n    />\n  );\n};\n","export default function(series, order) {\n  if (!((n = series.length) > 0)) return;\n  for (var i, j = 0, d, dy, yp, yn, n, m = series[order[0]].length; j < m; ++j) {\n    for (yp = yn = 0, i = 0; i < n; ++i) {\n      if ((dy = (d = series[order[i]][j])[1] - d[0]) > 0) {\n        d[0] = yp, d[1] = yp += dy;\n      } else if (dy < 0) {\n        d[1] = yn, d[0] = yn += dy;\n      } else {\n        d[0] = 0, d[1] = dy;\n      }\n    }\n  }\n}\n","import none from \"./none.js\";\n\nexport default function(series) {\n  var sums = series.map(sum);\n  return none(series).sort(function(a, b) { return sums[a] - sums[b]; });\n}\n\nexport function sum(series) {\n  var s = 0, i = -1, n = series.length, v;\n  while (++i < n) if (v = +series[i][1]) s += v;\n  return s;\n}\n","import ascending from \"./ascending.js\";\n\nexport default function(series) {\n  return ascending(series).reverse();\n}\n","export default function(series) {\n  var n = series.length, o = new Array(n);\n  while (--n >= 0) o[n] = n;\n  return o;\n}\n","import none from \"./none.js\";\n\nexport default function(series) {\n  return none(series).reverse();\n}\n","export default function(series, order) {\n  if (!((n = series.length) > 1)) return;\n  for (var i = 1, j, s0, s1 = series[order[0]], n, m = s1.length; i < n; ++i) {\n    s0 = s1, s1 = series[order[i]];\n    for (j = 0; j < m; ++j) {\n      s1[j][1] += s1[j][0] = isNaN(s0[j][1]) ? s0[j][0] : s0[j][1];\n    }\n  }\n}\n","import array from \"./array.js\";\nimport constant from \"./constant.js\";\nimport offsetNone from \"./offset/none.js\";\nimport orderNone from \"./order/none.js\";\n\nfunction stackValue(d, key) {\n  return d[key];\n}\n\nfunction stackSeries(key) {\n  const series = [];\n  series.key = key;\n  return series;\n}\n\nexport default function() {\n  var keys = constant([]),\n      order = orderNone,\n      offset = offsetNone,\n      value = stackValue;\n\n  function stack(data) {\n    var sz = Array.from(keys.apply(this, arguments), stackSeries),\n        i, n = sz.length, j = -1,\n        oz;\n\n    for (const d of data) {\n      for (i = 0, ++j; i < n; ++i) {\n        (sz[i][j] = [0, +value(d, sz[i].key, j, data)]).data = d;\n      }\n    }\n\n    for (i = 0, oz = array(order(sz)); i < n; ++i) {\n      sz[oz[i]].index = i;\n    }\n\n    offset(sz, oz);\n    return sz;\n  }\n\n  stack.keys = function(_) {\n    return arguments.length ? (keys = typeof _ === \"function\" ? _ : constant(Array.from(_)), stack) : keys;\n  };\n\n  stack.value = function(_) {\n    return arguments.length ? (value = typeof _ === \"function\" ? _ : constant(+_), stack) : value;\n  };\n\n  stack.order = function(_) {\n    return arguments.length ? (order = _ == null ? orderNone : typeof _ === \"function\" ? _ : constant(Array.from(_)), stack) : order;\n  };\n\n  stack.offset = function(_) {\n    return arguments.length ? (offset = _ == null ? offsetNone : _, stack) : offset;\n  };\n\n  return stack;\n}\n"],"names":["useGetRenderStackedBarDatum","colors","showValuesBySegmentMapping","valueLabelFormatter","xScale","yScale","getY","getRenderingKey","useChartState","state","useConfiguratorState","chartConfig","getChartConfig","definitiveFilters","useDefinitiveFilters","bandwidth","useCallback","s","segment","key","color","map","d","observation","data","value","valueLabel","undefined","valueLabelColor","getContrastingColor","x","y","valueLabelOffset","hasAnnotation","hasSegmentAnnotation","getTextWidth","fontSize","height","width","Math","min","renderBars","g","options","transition","x0","selectAll","join","enter","append","attr","call","_","i","maybeTransition","setSegmentWrapperValueLabelProps","setSegmentValueLabelProps","style","select","text","update","toggleFocusBorder","exit","remove","useBarValueLabelsData","bounds","showValues","renderEveryNthValue","chartData","getX","getValueOffset","useMemo","valueRaw","isNaN","xScaled","max","yRender","filter","truthy","ErrorWhiskers","getXErrorPresent","getXErrorRange","showXUncertainty","margins","chartHeight","ref","useRef","enableTransition","useTransitionStore","enable","transitionDuration","duration","renderData","y0","barHeight","x1","x2","useEffect","current","renderContainer","id","transform","left","top","render","opts","renderHorizontalWhisker","_jsx","Bars","yDimension","rotateValues","labelFontSize","fontFamily","useChartTheme","getAnnotationRenderState","useGetAnnotationRenderState","yScaled","xRaw","xRender","abs","focused","axisComponentId","axisValue","copy","valueLabelsData","common","_objectSpread","renderTotalValueLabels","rotate","textAnchor","dx","dy","yScaleIn","getSegment","grouped","some","flatMap","_ref","observations","BarsGrouped","_ref2","NaN","useBarsGroupedStateVariables","props","dimensions","dimensionsById","measures","measuresById","fields","interactiveFiltersConfig","animation","componentId","filters","useChartConfigFilters","baseVariables","useBaseVariables","numericalXVariables","useNumericalXVariables","bandYVariables","useBandYVariables","numericalXErrorVariables","useNumericalXErrorVariables","getValue","segmentVariables","useSegmentVariables","interactiveFiltersVariables","useInteractiveFiltersVariables","getYAsDate","sortData","sortingOrder","sortingType","sorting","yGetter","isTemporalEntityDimension","getTime","toString","order","rollup","v","sum","sort","a","b","ascending","orderBy","sortByIndex","getCategory","useRenderingKeyVariable","useBarsGroupedStateData","chartProps","variables","getSegmentAbbreviationOrLabel","getTimeRangeDate","plottableData","usePlottableData","useChartData","timeRangeDimensionId","getAxisValueAsDate","useBarsGroupedState","getYAbbreviationOrLabel","getYLabel","xMeasure","formatYDate","getMinX","getFormattedXUncertainty","segmentDimension","segmentsByAbbreviationOrLabel","getSegmentLabel","xAxisLabel","yAxisLabel","scalesData","segmentData","timeRangeData","paddingData","allData","useSize","formatNumber","useFormatNumber","decimals","formatters","useChartFormatters","segmentsByValue","Map","values","segmentSortingOrder","sumsBySegment","Object","fromEntries","segmentFilter","cubes","find","iri","cubeIri","allSegments","segments","allUniqueSegments","Array","from","Set","uniqueSegments","sorters","makeDimensionValueSorters","useAbbreviations","dimensionFilter","getSortingOrders","includes","yFilter","sumsByY","yTimeRangeDomainLabels","paddingXScale","yScaleTimeRange","yScaleInteraction","scaleOrdinal","orderedSegmentLabelsAndColors","dvIri","get","label","type","colorMapping","schemeCategory10","domain","range","getPalette","paletteId","colorField","unknown","yValues","yTimeRangeValues","ySorting","ySorters","measureBySegment","yDomain","scaleBand","paddingInner","paddingOuter","padding","yScaleTimeRangeDomain","extent","scaleTime","scaleLinear","customDomain","minValue","maxValue","nice","minPaddingValue","maxPaddingValue","yKeys","groupedMap","group","size","length","has","bottom","useChartPadding","xLabelPresent","bandDomain","every","isFlipped","leftAxisLabelSize","useAxisLabelSizeVariables","bottomAxisLabelSize","DEFAULT_MARGIN_TOP","offset","right","chartWidth","getChartWidth","useChartBounds","isMobile","useIsMobile","formatYAxisTick","tick","isTemporalDimension","chartType","getColorLabel","getTooltipInfo","datum","bw","tooltipValues","xValues","sortedTooltipValues","yAnchorRaw","xMin","xMax","xAnchor","placement","MOBILE_TOOLTIP_PLACEMENT","getCenteredTooltipPlacement","topAnchor","yLabel","yAnchor","formatNumberWithUnit","unit","error","leftAxisLabelOffsetTop","GroupedBarChartProvider","children","_objectWithoutProperties","_excluded","ChartContext","Provider","GroupedBarChart","InteractionProvider","BarsStacked","series","getRenderDatum","useBarsStackedStateVariables","plottableDataWide","yOrder","total","descending","useBarsStackedStateData","plottableDataByY","getWideData","dataGrouped","getAxisValue","sortPlottableData","useBarsStackedState","getIdentityX","useGetIdentityX","calculationType","useChartInteractiveFilters","calculation","yKey","normalize","chartDataGroupedByY","normalizeData","getTotalGroupValue","chartWideData","imputationType","console","warn","animationIri","getAnimation","getStackedXScale","active","scale","stackOrder","stackOrderAscending","stackOrderDescending","stackOrderReverse","stacked","stack","stackOffsetDiverging","keys","barCount","adjustedChartHeight","getAnnotationInfo","focusingSegment","getStackedPosition","measureScale","fallbackMeasureValue","ANNOTATION_SINGLE_SEGMENT_OFFSET","xValueFormatter","getStackedTooltipValueFormatter","measureId","measureUnit","axis","axisOffset","useValueLabelFormatter","StackedBarsChartProvider","StackedBarsChart","useBarsStateVariables","limits","limitsVariables","useLimitsVariables","useBarsStateData","useBarsState","minLimitValue","maxLimitValue","minY","sortingOrders","paddingMinValue","paddingMaxValue","_useShowBandValueLabe","useShowBandValueLabelsVariables","getErrorRange","xValueLabelsOffset","showValuesVariables","xOffset","hasValueLabels","DEFAULT_ANNOTATION_CIRCLE_COLOR","BarChartProvider","_excluded2","BarChart","InteractionBars","disableGaps","onClick","onHover","onHoverOut","useAnnotationInteractions","stroke","fill","fillOpacity","onMouseOver","onMouseOut","InteractionBarsStacked","StackedBarAnnotationHighlight","StackedAnnotationHighlight","valueScale","axisScale","chartDataGrouped","dimension","isHorizontal","AxisHeightBand","yTimeUnit","formatDate","useTimeFormatUnit","labelColor","axisLabelFontSize","gridColor","domainColor","hasNegativeValues","axisLeft","tickSizeOuter","tickSizeInner","tickFormat","renderUpdate","_jsxs","_Fragment","display","OpenMetadataPanelWrapper","component","lineHeight","AxisHeightBandDomain","HorizontalLimits","chartState","LimitsComponent","createLimitsComponent","getChartState","displayName","ChartBarsVisualization","ChartDataWrapper","Component","ChartBars","memo","dashboardFilters","hasChartConfigs","showTimeBrush","shouldShowBrush","timeRange","useLimits","isEditingAnnotation","useIsEditingAnnotation","ChartContainer","ChartSvg","AxisWidthLinear","AxisHideYOverflowRect","BrushTime","HoverAnnotationDot","Tooltip","Annotations","ChartControlsContainer","TimeSlider","LegendColor","symbol","interactive","legend","showTitle","ErrorWhiskersGrouped","xAxisTitleOffset","useXAxisTitleOffset","maxLabelLength","ticks","tickValues","axisBottom","AxisWidthLinearDomain","OverlayHighlightRect","ANNOTATION_FOCUS_COLOR","strokeWidth","ANNOTATION_FOCUS_WIDTH","pointerEvents","interaction","useInteraction","axisSize","getHighlightRect","axisKey","axisPosition","valueSum","value0","value1","valueSize","highlightedRects","rects","visible","push","isActive","rect","TimelineContext","createContext","useTimeline","timeline","useContext","Error","useSyncExternalStore","subscribe","getUpdateKey","showPlayButton","animationType","animationDuration","temporal","temporalEntity","temporalOrdinal","isTemporalOrdinalDimension","timeFormatUnit","timeUnit","timelineProps","commonProps","msDuration","uniqueValues","msValues","parseDate","formatValue","Date","sortedData","Timeline","Root","formattedExtent","Box","DISABLE_SCREENSHOT_ATTR","sx","alignItems","gap","mb","mr","PlayButton","position","Slider","Typography","variant","mt","useEvent","playing","stop","start","Button","minHeight","minWidth","borderRadius","Icon","name","useStyles","makeStyles","root","sliderClasses","thumb","track","timeSlider","setTimeSlider","classes","marks","onChange","e","setProgress","target","GenericSlider","renderTextInput","step","progress","valueLabelDisplay","valueLabelFormat","formattedValue","className","clsx","__WEBPACK_DEFAULT_EXPORT__","n","yp","yn","j","m","sums","_none_js__WEBPACK_IMPORTED_MODULE_0__","Z","_ascending_js__WEBPACK_IMPORTED_MODULE_0__","reverse","o","none","s0","s1","stackValue","stackSeries","constant","order_none","oz","sz","apply","arguments","array","index"],"sourceRoot":""}