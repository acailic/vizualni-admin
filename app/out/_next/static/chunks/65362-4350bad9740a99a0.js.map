{"version":3,"file":"static/chunks/65362-4350bad9740a99a0.js","mappings":"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","sources":["webpack://_N_E/./components/chart-data-table-preview/ui/component-label.tsx","webpack://_N_E/./browse/ui/data-table-preview.tsx","webpack://_N_E/./browse/ui/date-format.tsx","webpack://_N_E/./browse/ui/dataset-result.tsx","webpack://_N_E/./browse/ui/dataset-results.tsx","webpack://_N_E/./browse/ui/first-ten-rows-caption.tsx","webpack://_N_E/./browse/ui/search-dataset-drafts-control.tsx","webpack://_N_E/./browse/ui/search-dataset-results-count.tsx","webpack://_N_E/./browse/ui/search-dataset-sort-control.tsx","webpack://_N_E/./browse/lib/use-redirect-to-latest-cube.tsx","webpack://_N_E/./browse/ui/dataset-metadata-single-cube.tsx","webpack://_N_E/./browse/ui/dataset-preview.tsx","webpack://_N_E/./browse/ui/search-dataset-controls.tsx","webpack://_N_E/./browse/ui/search-dataset-input.tsx","webpack://_N_E/./browse/ui/navigation-chip.tsx","webpack://_N_E/./components/maybe-link.tsx","webpack://_N_E/./browse/ui/navigation-item.tsx","webpack://_N_E/./browse/ui/navigation-section-title.tsx","webpack://_N_E/./browse/ui/navigation-section.tsx","webpack://_N_E/./browse/ui/subtheme-filters.tsx","webpack://_N_E/./browse/ui/search-filters.tsx","webpack://_N_E/./browse/ui/select-dataset-banner.tsx","webpack://_N_E/./utils/soft-json-parse.ts","webpack://_N_E/./browse/ui/select-dataset-step.tsx","webpack://_N_E/./charts/chart-config-ui-options.ts","webpack://_N_E/./charts/index.ts","webpack://_N_E/./charts/map/constants.ts","webpack://_N_E/./charts/map/ref.ts","webpack://_N_E/./charts/map/wms-utils.ts","webpack://_N_E/./charts/map/wms-wmts-endpoint-utils.ts","webpack://_N_E/./charts/map/wms-wmts-parse-utils.ts","webpack://_N_E/./charts/map/wmts-utils.ts","webpack://_N_E/./charts/shared/brush/utils.ts","webpack://_N_E/./charts/shared/chart-data-filters/group-filters.ts","webpack://_N_E/./charts/shared/chart-data-filters/index.tsx","webpack://_N_E/./charts/shared/abbreviations.ts","webpack://_N_E/./charts/shared/observation-labels.ts","webpack://_N_E/./charts/shared/chart-helpers.tsx","webpack://_N_E/./charts/shared/chart-loading-state.tsx","webpack://_N_E/./charts/shared/chart-state.ts","webpack://_N_E/./charts/shared/interactive-filter-calculation-toggle.tsx","webpack://_N_E/./charts/shared/containers.tsx","webpack://_N_E/./charts/shared/imputation.tsx","webpack://_N_E/./charts/shared/legend-color-helpers.ts","webpack://_N_E/./charts/shared/legend-color.tsx","webpack://_N_E/./utils/ordered-is-equal.ts","webpack://_N_E/./charts/shared/possible-filters.ts","webpack://_N_E/./charts/shared/stacked-helpers.ts","webpack://_N_E/./charts/shared/use-combined-temporal-dimension.ts","webpack://_N_E/./charts/shared/use-size.tsx","webpack://_N_E/./components/action-elements-container.tsx","webpack://_N_E/./components/add-button.tsx","webpack://_N_E/./components/arrow-menu.tsx","webpack://_N_E/./components/chart-data-table-preview/ui/index.tsx","webpack://_N_E/./components/chart-error-boundary.tsx","webpack://_N_E/./components/chart-filters-list.tsx","webpack://_N_E/./components/chart-footnotes.tsx","webpack://_N_E/./components/chart-panel-layout-grid.tsx","webpack://_N_E/./components/chart-panel-layout-tall.tsx","webpack://_N_E/./components/chart-panel-layout-vertical.tsx","webpack://_N_E/./components/chart-panel.tsx","webpack://_N_E/./components/tabs.tsx","webpack://_N_E/./locales/index.ts","webpack://_N_E/./components/chart-selection-tabs.tsx","webpack://_N_E/./utils/most-recent-value.ts","webpack://_N_E/./charts/shared/chart-data-filters/filter.tsx","webpack://_N_E/./charts/shared/chart-data-filters/filters-list.tsx","webpack://_N_E/./components/chart-shared.tsx","webpack://_N_E/./components/chart-table-preview.tsx","webpack://_N_E/./utils/use-changes.ts","webpack://_N_E/./configurator/use-filter-changes.ts","webpack://_N_E/./charts/shared/use-sync-interactive-filters.tsx","webpack://_N_E/./components/chart-with-filters.tsx","webpack://_N_E/./components/dashboard-interactive-filters.tsx","webpack://_N_E/./components/data-download.tsx","webpack://_N_E/./utils/opendata.ts","webpack://_N_E/./components/dataset-metadata.tsx","webpack://_N_E/./components/drag-handle.tsx","webpack://_N_E/./components/embed-params.ts","webpack://_N_E/./components/info-icon-tooltip.tsx","webpack://_N_E/./components/markdown.tsx","webpack://_N_E/./components/metadata-panel-store.tsx","webpack://_N_E/./components/join-by-chip.tsx","webpack://_N_E/./components/metadata-panel.tsx","webpack://_N_E/./components/multi-select/input.tsx","webpack://_N_E/./components/multi-select/option.tsx","webpack://_N_E/./components/multi-select/tags.tsx","webpack://_N_E/./components/multi-select/transition-popper.tsx","webpack://_N_E/./components/multi-select/index.tsx","webpack://_N_E/./components/react-grid.tsx","webpack://_N_E/./components/select-tree.tsx","webpack://_N_E/./components/tag.tsx","webpack://_N_E/./components/dashboard-shared.tsx","webpack://_N_E/./components/text-block.tsx","webpack://_N_E/./config-types.ts","webpack://_N_E/./config-utils.ts","webpack://_N_E/./components/dialog-close-button.tsx","webpack://_N_E/./configurator/components/add-new-dataset-panel.tsx","webpack://_N_E/./configurator/components/annotators.tsx","webpack://_N_E/./configurator/components/chart-annotations/utils.ts","webpack://_N_E/./configurator/components/chart-controls/color-palette.tsx","webpack://_N_E/./configurator/components/chart-controls/color-ramp.tsx","webpack://_N_E/./configurator/components/chart-controls/control-tab.tsx","webpack://_N_E/./configurator/components/chart-controls/drawer-color-palette-content.tsx","webpack://_N_E/./configurator/components/chart-controls/section.tsx","webpack://_N_E/./configurator/components/chart-type-selector.tsx","webpack://_N_E/./configurator/components/drawers.tsx","webpack://_N_E/./configurator/components/field-date-picker.tsx","webpack://_N_E/./configurator/components/field.tsx","webpack://_N_E/./configurator/configurator-state/segment-config-state.tsx","webpack://_N_E/./configurator/interactive-filters/editor-brush.tsx","webpack://_N_E/./configurator/components/filters.tsx","webpack://_N_E/./configurator/components/icon-button.tsx","webpack://_N_E/./configurator/components/layout.tsx","webpack://_N_E/./configurator/config-form.tsx","webpack://_N_E/./configurator/configurator-state/initial.tsx","webpack://_N_E/./urql-cache.tsx","webpack://_N_E/./configurator/configurator-state/reducer.tsx","webpack://_N_E/./configurator/configurator-state/local-storage.tsx","webpack://_N_E/./configurator/configurator-state/init.tsx","webpack://_N_E/./configurator/configurator-state/context.tsx","webpack://_N_E/./configurator/configurator-state/index.tsx","webpack://_N_E/./components/debug-panel/index.tsx","webpack://_N_E/./utils/dnd.ts","webpack://_N_E/./components/chart-preview.tsx","webpack://_N_E/./components/use-local-snack.tsx","webpack://_N_E/./configurator/components/confirm-button.tsx","webpack://_N_E/./configurator/components/annotator-options.tsx","webpack://_N_E/./configurator/components/block-options-selector.tsx","webpack://_N_E/./configurator/components/chart-annotations/chart-annotations-selector.tsx","webpack://_N_E/./components/move-drag-button.tsx","webpack://_N_E/./configurator/components/badges.tsx","webpack://_N_E/./configurator/components/chart-annotations/add-annotation-button.tsx","webpack://_N_E/./configurator/components/chart-annotations/chart-annotations.tsx","webpack://_N_E/./configurator/components/chart-controls/show-filter-area-open.tsx","webpack://_N_E/./utils/use-local-state.ts","webpack://_N_E/./configurator/components/add-dataset-drawer/caution-alert.tsx","webpack://_N_E/./configurator/components/add-dataset-drawer/infer-join-by.tsx","webpack://_N_E/./configurator/components/add-dataset-drawer/use-styles.tsx","webpack://_N_E/./configurator/components/add-dataset-drawer/preview-table.tsx","webpack://_N_E/./configurator/components/add-dataset-drawer/use-add-dataset.ts","webpack://_N_E/./configurator/components/add-dataset-drawer/add-dataset-drawer.tsx","webpack://_N_E/./configurator/components/dataset-control-section.tsx","webpack://_N_E/./configurator/interactive-filters/interactive-filters-configurator.tsx","webpack://_N_E/./configurator/components/chart-configurator.tsx","webpack://_N_E/./configurator/components/chart-options-selector/abbreviations.tsx","webpack://_N_E/./configurator/components/chart-options-selector/animation-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/base-layer-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/calculation-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/color-component-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/combo-y-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/conversion-units-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/imputation-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/layout-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/limits-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/multi-filter-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/scale-domain.tsx","webpack://_N_E/./configurator/components/chart-options-selector/show-dots-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/size-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/sorting-field.tsx","webpack://_N_E/./configurator/components/chart-options-selector/utils.ts","webpack://_N_E/./charts/map/wms-wmts-provider-info.tsx","webpack://_N_E/./charts/map/wms-wmts-providers-autocomplete.tsx","webpack://_N_E/./charts/map/wms-wmts-selector.tsx","webpack://_N_E/./configurator/components/custom-layers-selector.tsx","webpack://_N_E/./configurator/table/table-config-state.ts","webpack://_N_E/./configurator/table/table-chart-sorting-options.tsx","webpack://_N_E/./configurator/table/table-chart-options.tsx","webpack://_N_E/./configurator/components/chart-options-selector.tsx","webpack://_N_E/./configurator/components/layout-configurator.tsx","webpack://_N_E/./configurator/components/preview-breakpoint.tsx","webpack://_N_E/./configurator/components/show-drawer-button.tsx","webpack://_N_E/./configurator/components/chart-controls/drag-and-drop-tab.tsx","webpack://_N_E/./configurator/table/configurator/links-section.tsx","webpack://_N_E/./configurator/table/table-chart-configurator.hook.tsx","webpack://_N_E/./configurator/table/table-chart-configurator.tsx","webpack://_N_E/./utils/ui-strings.ts","webpack://_N_E/./configurator/components/configurator.tsx","webpack://_N_E/./configurator/index.ts","webpack://_N_E/./configurator/interactive-filters/interactive-filters-config-state.tsx","webpack://_N_E/./domain/get-sorted-components.ts","webpack://_N_E/./domain/most-recent-value.ts","webpack://_N_E/./domain/user-configs.ts","webpack://_N_E/./formatters.ts","webpack://_N_E/./graphql/caching-utils.ts","webpack://_N_E/./graphql/hooks.ts","webpack://_N_E/./graphql/join.ts","webpack://_N_E/./graphql/make-component-id.ts","webpack://_N_E/./login/components/color-palettes/color-palette-types.tsx","webpack://_N_E/./pages/browse/index.tsx","webpack://_N_E/./rdf/query-latest-cube-iri.ts","webpack://_N_E/./rdf/tree-utils.ts","webpack://_N_E/./src/index.ts","webpack://_N_E/./stores/utils.ts","webpack://_N_E/./stores/interactive-filters.tsx","webpack://_N_E/./stores/transition.ts","webpack://_N_E/./themes/index.ts","webpack://_N_E/./utils/animation-frame.ts","webpack://_N_E/./utils/assert.ts","webpack://_N_E/./utils/api.ts","webpack://_N_E/./utils/chart-config/api.ts","webpack://_N_E/./utils/chart-config/constants.ts","webpack://_N_E/./rdf/query-cube-unversioned-iri.ts","webpack://_N_E/./utils/chart-config/upgrade-cube.ts","webpack://_N_E/./utils/chart-config/versioning.ts","webpack://_N_E/./utils/create-id.ts","webpack://_N_E/./utils/hash-utils.ts","webpack://_N_E/./utils/hierarchy.ts","webpack://_N_E/./utils/interlace.ts","webpack://_N_E/./utils/observables.ts","webpack://_N_E/./utils/time-filter-options.tsx","webpack://_N_E/./utils/unreachable.ts","webpack://_N_E/./utils/use-fetch-data.ts","webpack://_N_E/./utils/use-i18n.ts","webpack://_N_E/./utils/use-screenshot.ts","webpack://_N_E/./utils/use-timeout.tsx","webpack://_N_E/./utils/use-user-palettes.ts","webpack://_N_E/./components/chart-panel-layout-tall.module.css","webpack://_N_E/./components/markdown.module.css","webpack://_N_E/ignored|/home/runner/work/vizualni-admin/vizualni-admin/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams|util","webpack://_N_E/ignored|/home/runner/work/vizualni-admin/vizualni-admin/node_modules/concat-stream/node_modules/readable-stream/lib|util","webpack://_N_E/ignored|/home/runner/work/vizualni-admin/vizualni-admin/node_modules/pump|fs","webpack://_N_E/ignored|/home/runner/work/vizualni-admin/vizualni-admin/node_modules/readable-error/node_modules/readable-stream/lib/internal/streams|util","webpack://_N_E/ignored|/home/runner/work/vizualni-admin/vizualni-admin/node_modules/readable-error/node_modules/readable-stream/lib|util","webpack://_N_E/ignored|/home/runner/work/vizualni-admin/vizualni-admin/node_modules/readable-stream/lib/internal/streams|util","webpack://_N_E/ignored|/home/runner/work/vizualni-admin/vizualni-admin/node_modules/readable-stream/lib|util"],"sourcesContent":["import { TooltipProps, Typography } from \"@mui/material\";\n\nimport { getLabelWithUnit } from \"@/charts/shared/chart-helpers\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport { OpenMetadataPanelWrapper } from \"@/components/metadata-panel\";\nimport { Component } from \"@/domain/data\";\n\nexport const ComponentLabel = ({\n  component,\n  tooltipProps,\n  linkToMetadataPanel,\n}: {\n  component: Component;\n  tooltipProps?: Omit<TooltipProps, \"title\" | \"children\">;\n  linkToMetadataPanel: boolean;\n}) => {\n  return linkToMetadataPanel ? (\n    <OpenMetadataPanelWrapper component={component}>\n      <ComponentLabelInner component={component} />\n    </OpenMetadataPanelWrapper>\n  ) : component.description ? (\n    <MaybeTooltip title={component.description} tooltipProps={tooltipProps}>\n      <div>\n        <ComponentLabelInner component={component} />\n      </div>\n    </MaybeTooltip>\n  ) : (\n    <ComponentLabelInner component={component} />\n  );\n};\n\nconst ComponentLabelInner = ({ component }: { component: Component }) => {\n  const label = getLabelWithUnit(component);\n\n  return (\n    <Typography\n      variant=\"h6\"\n      component=\"span\"\n      color=\"monochrome.500\"\n      textTransform=\"uppercase\"\n    >\n      {label}\n    </Typography>\n  );\n};\n","import {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableRow,\n  TableSortLabel,\n} from \"@mui/material\";\nimport { ascending, descending } from \"d3-array\";\nimport { useCallback, useMemo, useRef, useState } from \"react\";\n\nimport { ComponentLabel } from \"@/components/chart-data-table-preview/ui/component-label\";\nimport { Loading } from \"@/components/hint\";\nimport {\n  Component,\n  Dimension,\n  isNumericalMeasure,\n  Measure,\n  Observation,\n} from \"@/domain/data\";\nimport { getSortedComponents } from \"@/domain/get-sorted-components\";\nimport { useDimensionFormatters } from \"@/formatters\";\nimport SvgIcChevronDown from \"@/icons/components/IcChevronDown\";\nimport { uniqueMapBy } from \"@/utils/unique-map-by\";\n\nexport const DataTablePreview = ({\n  title,\n  dimensions,\n  measures,\n  observations,\n  linkToMetadataPanel,\n}: {\n  title: string;\n  dimensions: Dimension[];\n  measures: Measure[];\n  observations: Observation[] | undefined;\n  linkToMetadataPanel: boolean;\n}) => {\n  const [sortBy, setSortBy] = useState<Component>();\n  const [sortDirection, setSortDirection] = useState<\"asc\" | \"desc\">();\n  const sortedComponents = useMemo(() => {\n    return getSortedComponents([...dimensions, ...measures]);\n  }, [dimensions, measures]);\n  const formatters = useDimensionFormatters(sortedComponents);\n  const sortedObservations = useMemo(() => {\n    if (!sortBy || !observations) {\n      return observations;\n    }\n\n    const compare = sortDirection === \"asc\" ? ascending : descending;\n    const valuesByLabel = uniqueMapBy(sortBy.values, (d) => d.label);\n    const convert =\n      isNumericalMeasure(sortBy) || sortBy.isNumerical\n        ? (v: string) => +v\n        : (v: string) => valuesByLabel.get(v)?.position ?? v;\n\n    return [...observations].sort((a, b) =>\n      compare(convert(a[sortBy.id] as string), convert(b[sortBy.id] as string))\n    );\n  }, [observations, sortBy, sortDirection]);\n\n  const tooltipContainerRef = useRef<HTMLDivElement>(null);\n  const tooltipProps = useMemo(() => {\n    return {\n      PopperProps: {\n        // Tooltip contained inside the table so as not to overflow when table is scrolled\n        container: tooltipContainerRef.current,\n      },\n    };\n  }, []);\n\n  const handleSort = useCallback(\n    (component: Component) => {\n      if (sortBy?.id === component.id) {\n        setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\");\n      } else {\n        setSortBy(component);\n        setSortDirection(\"asc\");\n      }\n    },\n    [sortBy, sortDirection]\n  );\n\n  return (\n    <div ref={tooltipContainerRef} style={{ width: \"100%\" }}>\n      <Table>\n        <caption style={{ display: \"none\" }}>{title}</caption>\n        <TableHead sx={{ position: \"sticky\", top: 0 }}>\n          <TableRow>\n            {sortedComponents.map((component) => {\n              return (\n                <TableCell\n                  key={component.id}\n                  component=\"th\"\n                  role=\"columnheader\"\n                  onClick={() => handleSort(component)}\n                  sx={{\n                    textAlign: isNumericalMeasure(component) ? \"right\" : \"left\",\n                    whiteSpace: \"nowrap\",\n                  }}\n                >\n                  <TableSortLabel\n                    active={!sortBy || sortBy.id === component.id}\n                    direction={!sortBy ? \"desc\" : sortDirection}\n                    IconComponent={SvgIcChevronDown}\n                    sx={{\n                      \"&:hover > svg\": {\n                        ...(!sortBy ? { transform: \"translateY(-15%)\" } : {}),\n                      },\n                    }}\n                  >\n                    <ComponentLabel\n                      component={component}\n                      tooltipProps={tooltipProps}\n                      linkToMetadataPanel={linkToMetadataPanel}\n                    />\n                  </TableSortLabel>\n                </TableCell>\n              );\n            })}\n          </TableRow>\n        </TableHead>\n        <TableBody>\n          {sortedObservations ? (\n            sortedObservations.map((obs, i) => {\n              return (\n                <TableRow key={i}>\n                  {sortedComponents.map((c) => {\n                    const numerical = isNumericalMeasure(c);\n                    const format = formatters[c.id];\n                    const v = obs[c.id];\n\n                    return (\n                      <TableCell\n                        key={c.id}\n                        component=\"td\"\n                        sx={{ textAlign: numerical ? \"right\" : \"left\" }}\n                      >\n                        {format(numerical && v ? +v : v)}\n                      </TableCell>\n                    );\n                  })}\n                </TableRow>\n              );\n            })\n          ) : (\n            <Loading />\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n};\n","import { useMemo } from \"react\";\n\nimport { useFormatDate } from \"@/formatters\";\n\nexport const DateFormat = ({ date }: { date: string }) => {\n  const formatter = useFormatDate();\n  const formatted = useMemo(() => {\n    return formatter(date);\n  }, [formatter, date]);\n\n  return <>{formatted}</>;\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Box, CardProps, Stack, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport sortBy from \"lodash/sortBy\";\nimport NextLink from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { ComponentProps, MouseEvent } from \"react\";\n\nimport { getBrowseParamsFromQuery } from \"@/browse/lib/params\";\nimport { DateFormat } from \"@/browse/ui/date-format\";\nimport { Flex } from \"@/components/flex\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport { MotionCard, smoothPresenceProps } from \"@/components/presence\";\nimport { Tag } from \"@/components/tag\";\nimport { PartialSearchCube } from \"@/domain/data\";\nimport { DataCubePublicationStatus } from \"@/graphql/query-hooks\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport type DatasetResultProps = ComponentProps<typeof DatasetResult>;\n\nexport const DatasetResult = ({\n  dataCube: {\n    iri,\n    publicationStatus,\n    title,\n    description,\n    themes,\n    datePublished,\n    creator,\n    dimensions,\n  },\n  highlightedTitle,\n  highlightedDescription,\n  showTags = true,\n  disableTitleLink,\n  showDimensions,\n  onClickTitle,\n  ...cardProps\n}: {\n  dataCube: PartialSearchCube;\n  highlightedTitle?: string | null;\n  highlightedDescription?: string | null;\n  showTags?: boolean;\n  disableTitleLink?: boolean;\n  showDimensions?: boolean;\n  onClickTitle?: (e: MouseEvent<HTMLDivElement>, iri: string) => void;\n} & CardProps) => {\n  const isDraft = publicationStatus === DataCubePublicationStatus.Draft;\n  const router = useRouter();\n  const classes = useStyles();\n\n  const handleTitleClick = useEvent((e: MouseEvent<HTMLDivElement>) => {\n    onClickTitle?.(e, iri);\n\n    if (e.defaultPrevented) {\n      return;\n    }\n\n    const browseParams = getBrowseParamsFromQuery(router.query);\n    const query = {\n      previous: JSON.stringify(browseParams),\n      dataset: iri,\n    };\n    router.push({ pathname: \"/browse\", query }, undefined, {\n      shallow: true,\n      scroll: false,\n    });\n  });\n\n  return (\n    <MotionCard\n      elevation={1}\n      {...smoothPresenceProps}\n      {...cardProps}\n      className={clsx(classes.root, cardProps.className)}\n    >\n      <Stack spacing={2}>\n        <Flex\n          justifyContent=\"space-between\"\n          width=\"100%\"\n          // To account for the space taken by the draft tag\n          minHeight={24}\n        >\n          <Typography variant=\"body2\" color=\"monochrome.500\">\n            {datePublished && <DateFormat date={datePublished} />}\n          </Typography>\n          {isDraft ? (\n            <Tag type=\"draft\">\n              <Trans id=\"dataset.tag.draft\">Draft</Trans>\n            </Tag>\n          ) : null}\n        </Flex>\n        <Typography\n          className={disableTitleLink ? undefined : classes.titleClickable}\n          fontWeight={700}\n          onClick={disableTitleLink ? undefined : handleTitleClick}\n        >\n          {highlightedTitle ? (\n            <Box\n              className={classes.textWrapper}\n              component=\"span\"\n              fontWeight={highlightedTitle === title ? 700 : 400}\n              dangerouslySetInnerHTML={{ __html: highlightedTitle }}\n            />\n          ) : (\n            title\n          )}\n        </Typography>\n        <Typography\n          className={classes.description}\n          variant=\"body2\"\n          title={description ?? \"\"}\n        >\n          {highlightedDescription ? (\n            <Box\n              className={classes.textWrapper}\n              component=\"span\"\n              dangerouslySetInnerHTML={{ __html: highlightedDescription }}\n            />\n          ) : (\n            description\n          )}\n        </Typography>\n      </Stack>\n      <Flex sx={{ flexWrap: \"wrap\", gap: 2 }}>\n        {themes && showTags\n          ? sortBy(themes, (t) => t.label).map(\n              (t) =>\n                t.iri &&\n                t.label && (\n                  <NextLink\n                    key={t.iri}\n                    href={`/browse/theme/${encodeURIComponent(t.iri)}`}\n                    passHref\n                    legacyBehavior\n                    scroll={false}\n                  >\n                    <Tag type=\"theme\">{t.label}</Tag>\n                  </NextLink>\n                )\n            )\n          : null}\n        {creator?.label ? (\n          <NextLink\n            key={creator.iri}\n            href={`/browse/organization/${encodeURIComponent(creator.iri)}`}\n            passHref\n            legacyBehavior\n            scroll={false}\n          >\n            <Tag type=\"organization\">{creator.label}</Tag>\n          </NextLink>\n        ) : null}\n        {showDimensions &&\n          dimensions?.length !== undefined &&\n          dimensions.length > 0 && (\n            <>\n              {sortBy(dimensions, (dimension) => dimension.label).map(\n                (dimension) => {\n                  return (\n                    <MaybeTooltip\n                      key={dimension.id}\n                      title={\n                        dimension.termsets.length > 0 ? (\n                          <>\n                            <Typography variant=\"caption\">\n                              <Trans id=\"dataset-result.dimension-joined-by\">\n                                Contains values of\n                              </Trans>\n                              <Stack flexDirection=\"row\" gap={1} mt={1}>\n                                {dimension.termsets.map((termset) => {\n                                  return (\n                                    <Tag\n                                      key={termset.iri}\n                                      type=\"termset\"\n                                      style={{ flexShrink: 0 }}\n                                    >\n                                      {termset.label}\n                                    </Tag>\n                                  );\n                                })}\n                              </Stack>\n                            </Typography>\n                          </>\n                        ) : null\n                      }\n                    >\n                      <Tag style={{ cursor: \"default\" }} type=\"dimension\">\n                        {dimension.label}\n                      </Tag>\n                    </MaybeTooltip>\n                  );\n                }\n              )}\n            </>\n          )}\n      </Flex>\n    </MotionCard>\n  );\n};\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  root: {\n    position: \"relative\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: theme.spacing(4),\n    padding: `${theme.spacing(8)} 0`,\n    borderTop: `1px solid ${theme.palette.monochrome[400]}`,\n    borderRadius: 0,\n    textAlign: \"left\",\n    boxShadow: \"none\",\n  },\n  textWrapper: {\n    \"& > b\": {\n      fontWeight: 700,\n    },\n  },\n  titleClickable: {\n    display: \"inline-block\",\n    cursor: \"pointer\",\n    transition: \"color 0.2s ease\",\n\n    \"&:hover\": {\n      color: theme.palette.primary.main,\n    },\n  },\n  description: {\n    display: \"-webkit-box\",\n    overflow: \"hidden\",\n    WebkitLineClamp: 2,\n    WebkitBoxOrient: \"vertical\",\n  },\n}));\n","import { Trans } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\nimport { ComponentProps } from \"react\";\nimport { CombinedError } from \"urql\";\n\nimport { DatasetResult, DatasetResultProps } from \"@/browse/ui/dataset-result\";\nimport { Loading, LoadingDataError } from \"@/components/hint\";\nimport { SearchCube } from \"@/domain/data\";\nimport { SearchCubeResult } from \"@/graphql/query-hooks\";\n\nexport type DatasetResultsProps = ComponentProps<typeof DatasetResults>;\n\nexport const DatasetResults = ({\n  fetching,\n  error,\n  cubes,\n  datasetResultProps,\n}: {\n  fetching: boolean;\n  error?: CombinedError;\n  cubes: SearchCubeResult[];\n  datasetResultProps?: ({\n    cube,\n  }: {\n    cube: SearchCube;\n  }) => Partial<DatasetResultProps>;\n}) => {\n  if (fetching) {\n    return <Loading />;\n  }\n\n  if (error) {\n    return <LoadingDataError message={error.message} />;\n  }\n\n  if (cubes.length === 0) {\n    return (\n      <Typography\n        variant=\"h2\"\n        sx={{ mt: 8, color: \"grey.600\", textAlign: \"center\" }}\n      >\n        <Trans id=\"No results\">No results</Trans>\n      </Typography>\n    );\n  }\n\n  return (\n    <div>\n      {cubes.map(({ cube, highlightedTitle, highlightedDescription }) => (\n        <DatasetResult\n          key={cube.iri}\n          dataCube={cube}\n          highlightedTitle={highlightedTitle}\n          highlightedDescription={highlightedDescription}\n          {...datasetResultProps?.({ cube })}\n        />\n      ))}\n    </div>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\n\nexport const FirstTenRowsCaption = () => {\n  return (\n    <Typography variant=\"h6\" component=\"span\" color=\"monochrome.500\">\n      <Trans id=\"datatable.showing.first.rows\">Showing first 10 rows</Trans>\n    </Typography>\n  );\n};\n","import { t } from \"@lingui/macro\";\n\nimport { Checkbox } from \"@/components/form\";\n\nexport const SearchDatasetDraftsControl = ({\n  checked,\n  onChange,\n}: {\n  checked: boolean;\n  onChange: (value: boolean) => void;\n}) => {\n  return (\n    <Checkbox\n      label={t({\n        id: \"dataset.includeDrafts\",\n        message: \"Include draft datasets\",\n      })}\n      name=\"dataset-include-drafts\"\n      value=\"dataset-include-drafts\"\n      checked={checked}\n      onChange={() => onChange(!checked)}\n    />\n  );\n};\n","import { Plural } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\n\nimport { SearchCubeResult } from \"@/graphql/query-hooks\";\n\nexport const SearchDatasetResultsCount = ({\n  cubes,\n}: {\n  cubes: SearchCubeResult[];\n}) => {\n  return (\n    <Typography\n      variant=\"h5\"\n      component=\"p\"\n      aria-live=\"polite\"\n      data-testid=\"search-results-count\"\n    >\n      {cubes.length > 0 && (\n        <Plural\n          id=\"dataset.results\"\n          value={cubes.length}\n          zero=\"No datasets\"\n          one=\"# dataset\"\n          other=\"# datasets\"\n        />\n      )}\n    </Typography>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\nimport { useMemo } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport { Select } from \"@/components/form\";\nimport { SearchCubeResultOrder } from \"@/graphql/query-hooks\";\n\nexport const SearchDatasetSortControl = ({\n  value,\n  onChange,\n  disableScore,\n}: {\n  value: SearchCubeResultOrder;\n  onChange: (order: SearchCubeResultOrder) => void;\n  disableScore?: boolean;\n}) => {\n  const options = useMemo(() => {\n    const options = [\n      {\n        value: SearchCubeResultOrder.Score,\n        label: t({ id: \"dataset.order.relevance\", message: \"Relevance\" }),\n      },\n      {\n        value: SearchCubeResultOrder.TitleAsc,\n        label: t({ id: \"dataset.order.title\", message: \"Title\" }),\n      },\n      {\n        value: SearchCubeResultOrder.CreatedDesc,\n        label: t({ id: \"dataset.order.newest\", message: \"Newest\" }),\n      },\n    ];\n\n    if (disableScore) {\n      return options.filter((o) => o.value !== SearchCubeResultOrder.Score);\n    }\n\n    return options;\n  }, [disableScore]);\n\n  return (\n    <Flex alignItems=\"center\">\n      <label htmlFor=\"datasetSort\">\n        <Typography variant=\"body3\">\n          <Trans id=\"dataset.sortby\">Sort by</Trans>\n        </Typography>\n      </label>\n      <Select\n        id=\"datasetSort\"\n        data-testId=\"datasetSort\"\n        variant=\"standard\"\n        size=\"sm\"\n        onChange={(e) => {\n          onChange(e.target.value as SearchCubeResultOrder);\n        }}\n        value={value}\n        options={options}\n        sort={false}\n        sx={{ width: \"fit-content\" }}\n      />\n    </Flex>\n  );\n};\n","import { useRouter } from \"next/router\";\nimport { useEffect, useRef } from \"react\";\nimport ParsingClient from \"sparql-http-client/ParsingClient\";\n\nimport { ConfiguratorState } from \"@/config-types\";\nimport { getMaybeCachedSparqlUrl } from \"@/graphql/caching-utils\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { queryLatestCubeIri } from \"@/rdf/query-latest-cube-iri\";\nimport { getErrorQueryParams } from \"@/utils/flashes\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const useRedirectToLatestCube = ({\n  datasetIri,\n  dataSource,\n}: {\n  datasetIri: string | undefined;\n  dataSource: ConfiguratorState[\"dataSource\"];\n}) => {\n  const locale = useLocale();\n  const router = useRouter();\n  const hasRun = useRef(false);\n\n  const handleLoad = useEvent(async () => {\n    const { url } = dataSource;\n    if (hasRun.current) {\n      return;\n    }\n\n    if (datasetIri && !Array.isArray(datasetIri)) {\n      hasRun.current = true;\n\n      const endpointUrl = getMaybeCachedSparqlUrl({\n        endpointUrl: url,\n        cubeIri: datasetIri,\n      });\n      const sparqlClient = new ParsingClient({\n        endpointUrl,\n      });\n      const latestIri = await queryLatestCubeIri(sparqlClient, datasetIri);\n\n      if (!latestIri) {\n        return router.replace({\n          pathname: `/`,\n          query: getErrorQueryParams(\"CANNOT_FIND_CUBE\", {\n            ...router.query,\n            iri: datasetIri,\n            endpointUrl,\n          }),\n        });\n      }\n\n      if (datasetIri !== latestIri) {\n        return router.replace({\n          pathname: \"/browse\",\n          query: {\n            ...router.query,\n            ...(router.query.iri ? { iri: latestIri } : { dataset: latestIri }),\n          },\n        });\n      }\n    }\n  });\n\n  useEffect(() => {\n    if (dataSource.type !== \"sparql\") {\n      console.error(\n        `Cannot redirect to unversioned IRI if dataSource.type !== \"sparql\", here it's ${dataSource.type}`\n      );\n      return;\n    }\n\n    if (router.isReady) {\n      handleLoad();\n    }\n  }, [router, locale, dataSource, datasetIri, handleLoad]);\n};\n","import { DatasetMetadata } from \"@/components/dataset-metadata\";\nimport { DataSource } from \"@/config-types\";\nimport { useDataCubeMetadataQuery } from \"@/graphql/query-hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const DatasetMetadataSingleCube = ({\n  dataSource,\n  datasetIri,\n}: {\n  dataSource: DataSource;\n  datasetIri: string;\n}) => {\n  const locale = useLocale();\n  const [data] = useDataCubeMetadataQuery({\n    variables: {\n      cubeFilter: { iri: datasetIri },\n      locale: locale,\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n    },\n  });\n\n  if (!data.data) {\n    return null;\n  }\n\n  return (\n    <DatasetMetadata\n      cube={data.data.dataCubeMetadata}\n      showTitle={false}\n      dataSource={dataSource}\n    />\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Box, Paper, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport Head from \"next/head\";\nimport { ComponentProps, useEffect } from \"react\";\nimport { UseQueryResponse } from \"urql\";\n\nimport { DataTablePreview } from \"@/browse/ui/data-table-preview\";\nimport { FirstTenRowsCaption } from \"@/browse/ui/first-ten-rows-caption\";\nimport { useFootnotesStyles } from \"@/components/chart-footnotes\";\nimport { DataDownloadMenu } from \"@/components/data-download\";\nimport { Flex } from \"@/components/flex\";\nimport { HintError, Loading, LoadingDataError } from \"@/components/hint\";\nimport { DataSource } from \"@/config-types\";\nimport {\n  DataCubeMetadataQuery,\n  useDataCubePreviewQuery,\n} from \"@/graphql/query-hooks\";\nimport { DataCubePublicationStatus } from \"@/graphql/resolver-types\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport type DataSetPreviewProps = ComponentProps<typeof DataSetPreview>;\n\nexport const DataSetPreview = ({\n  dataSetIri,\n  dataSource,\n  dataCubeMetadataQuery,\n  odsIframe,\n}: {\n  dataSetIri: string;\n  dataSource: DataSource;\n  dataCubeMetadataQuery: UseQueryResponse<DataCubeMetadataQuery, object>;\n  odsIframe: boolean;\n}) => {\n  const footnotesClasses = useFootnotesStyles({ useMarginTop: false });\n  const locale = useLocale();\n  const variables = {\n    sourceType: dataSource.type,\n    sourceUrl: dataSource.url,\n    locale,\n    cubeFilter: { iri: dataSetIri },\n  };\n  const [{ data: metadata, fetching: fetchingMetadata, error: metadataError }] =\n    dataCubeMetadataQuery;\n  const [\n    { data: previewData, fetching: fetchingPreview, error: previewError },\n  ] = useDataCubePreviewQuery({ variables });\n  const classes = useStyles({\n    descriptionPresent: !!metadata?.dataCubeMetadata.description,\n    odsIframe,\n  });\n\n  useEffect(() => {\n    window.scrollTo({ top: 0 });\n  }, []);\n\n  if (fetchingMetadata || fetchingPreview) {\n    return (\n      <Flex className={classes.loadingWrapper}>\n        <Loading />\n      </Flex>\n    );\n  } else if (metadata?.dataCubeMetadata && previewData?.dataCubePreview) {\n    const { dataCubeMetadata } = metadata;\n    const { dataCubePreview } = previewData;\n\n    return (\n      <Flex className={classes.root}>\n        {dataCubeMetadata.publicationStatus ===\n          DataCubePublicationStatus.Draft && (\n          <Box sx={{ mb: 4 }}>\n            <HintError>\n              <Trans id=\"dataset.publicationStatus.draft.warning\">\n                Careful, this dataset is only a draft.\n                <br />\n                <strong>Don&apos;t use for reporting!</strong>\n              </Trans>\n            </HintError>\n          </Box>\n        )}\n        <Flex\n          className={classes.header}\n          sx={{ justifyContent: odsIframe ? \"end\" : \"space-between\" }}\n        >\n          <Head>\n            <title key=\"title\">\n              {dataCubeMetadata.title} - visualize.admin.ch\n            </title>\n          </Head>\n          {!odsIframe && (\n            <Typography variant=\"h1\" fontWeight={700}>\n              {dataCubeMetadata.title}\n            </Typography>\n          )}\n        </Flex>\n        <Paper className={classes.paper}>\n          {dataCubeMetadata.description && !odsIframe && (\n            <Typography className={classes.description} variant=\"body2\">\n              {dataCubeMetadata.description}\n            </Typography>\n          )}\n          <div className={classes.tableOuterWrapper}>\n            <Flex className={classes.tableInnerWrapper}>\n              <DataTablePreview\n                title={dataCubeMetadata.title}\n                dimensions={dataCubePreview.dimensions}\n                measures={dataCubePreview.measures}\n                observations={dataCubePreview.observations}\n                linkToMetadataPanel={false}\n              />\n            </Flex>\n          </div>\n          <Flex className={classes.footnotesWrapper}>\n            <Flex className={footnotesClasses.actions}>\n              {odsIframe ? null : (\n                <DataDownloadMenu\n                  dataSource={dataSource}\n                  title={dataCubeMetadata.title}\n                  filters={variables.cubeFilter}\n                />\n              )}\n            </Flex>\n            <FirstTenRowsCaption />\n          </Flex>\n        </Paper>\n      </Flex>\n    );\n  } else {\n    return (\n      <Flex className={classes.loadingWrapper}>\n        <LoadingDataError\n          message={metadataError?.message ?? previewError?.message}\n        />\n      </Flex>\n    );\n  }\n};\n\nconst useStyles = makeStyles<\n  Theme,\n  { odsIframe: boolean; descriptionPresent: boolean }\n>((theme) => ({\n  root: {\n    flexGrow: 1,\n    flexDirection: \"column\",\n    justifyContent: \"space-between\",\n  },\n  header: {\n    marginBottom: ({ odsIframe }) => (odsIframe ? 0 : theme.spacing(4)),\n  },\n  paper: {\n    borderRadius: theme.spacing(4),\n    boxShadow: \"none\",\n  },\n  description: {\n    marginBottom: theme.spacing(6),\n  },\n  tableOuterWrapper: {\n    width: \"100%\",\n    boxShadow: theme.shadows[4],\n  },\n  tableInnerWrapper: {\n    flexGrow: 1,\n    width: \"100%\",\n    position: \"relative\",\n    overflowX: \"auto\",\n    marginTop: ({ descriptionPresent }) =>\n      descriptionPresent ? theme.spacing(6) : 0,\n  },\n  footnotesWrapper: {\n    marginTop: theme.spacing(4),\n    justifyContent: \"space-between\",\n  },\n  loadingWrapper: {\n    flexDirection: \"column\",\n    justifyContent: \"space-between\",\n    flexGrow: 1,\n    padding: theme.spacing(5),\n  },\n}));\n","import { Divider } from \"@mui/material\";\n\nimport { BrowseState } from \"@/browse/model/context\";\nimport { SearchDatasetDraftsControl } from \"@/browse/ui/search-dataset-drafts-control\";\nimport { SearchDatasetResultsCount } from \"@/browse/ui/search-dataset-results-count\";\nimport { SearchDatasetSortControl } from \"@/browse/ui/search-dataset-sort-control\";\nimport { Flex } from \"@/components/flex\";\nimport { SearchCubeResult, SearchCubeResultOrder } from \"@/graphql/query-hooks\";\nimport { sleep } from \"@/utils/sleep\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const SearchDatasetControls = ({\n  browseState: {\n    inputRef,\n    search,\n    onSubmitSearch,\n    includeDrafts,\n    setIncludeDrafts,\n    order = SearchCubeResultOrder.CreatedDesc,\n    onSetOrder,\n  },\n  cubes,\n}: {\n  browseState: BrowseState;\n  cubes: SearchCubeResult[];\n}) => {\n  const isSearching = search !== \"\" && search !== undefined;\n\n  const onToggleIncludeDrafts = useEvent(async () => {\n    setIncludeDrafts(!includeDrafts);\n    const input = inputRef.current;\n\n    if (input && input.value.length > 0) {\n      // We need to wait here otherwise the includeDrafts is reset :/\n      await sleep(200);\n      onSubmitSearch(input.value);\n    }\n  });\n\n  return (\n    <Flex sx={{ justifyContent: \"space-between\", alignItems: \"center\", mb: 2 }}>\n      <SearchDatasetResultsCount cubes={cubes} />\n      <Flex sx={{ alignItems: \"center\", gap: 5 }}>\n        <SearchDatasetDraftsControl\n          checked={includeDrafts}\n          onChange={onToggleIncludeDrafts}\n        />\n        <Divider flexItem orientation=\"vertical\" />\n        <SearchDatasetSortControl\n          value={order}\n          onChange={onSetOrder}\n          disableScore={!isSearching}\n        />\n      </Flex>\n    </Flex>\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport { KeyboardEvent, useState } from \"react\";\n\nimport { BrowseState } from \"@/browse/model/context\";\nimport { Flex } from \"@/components/flex\";\nimport { SearchField, SearchFieldProps } from \"@/components/form\";\n\nexport const SearchDatasetInput = ({\n  browseState: { inputRef, search, onSubmitSearch, onReset },\n  searchFieldProps,\n}: {\n  browseState: BrowseState;\n  searchFieldProps?: Partial<SearchFieldProps>;\n}) => {\n  const [_, setShowDraftCheckbox] = useState(false);\n  const searchLabel = t({\n    id: \"dataset.search.label\",\n    message: \"Search\",\n  });\n  const placeholderLabel = t({\n    id: \"dataset.search.placeholder\",\n    message: \"Name, description, organization, theme, keyword\",\n  });\n  const handleKeyPress = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && inputRef.current) {\n      onSubmitSearch(inputRef.current.value);\n    }\n  };\n\n  return (\n    <Flex sx={{ alignItems: \"center\", gap: 2, pt: 4 }}>\n      <SearchField\n        key={search}\n        inputRef={inputRef}\n        id=\"datasetSearch\"\n        label={searchLabel}\n        defaultValue={search ?? \"\"}\n        InputProps={{\n          inputProps: {\n            \"data-testid\": \"datasetSearch\",\n          },\n          onKeyPress: handleKeyPress,\n          onReset,\n          onFocus: () => setShowDraftCheckbox(true),\n        }}\n        placeholder={placeholderLabel}\n        {...searchFieldProps}\n        sx={{ ...searchFieldProps?.sx, width: \"100%\", maxWidth: 820 }}\n      />\n    </Flex>\n  );\n};\n","import { ReactNode } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\n\nexport const NavigationChip = ({\n  children,\n  backgroundColor,\n}: {\n  children: ReactNode;\n  backgroundColor: string;\n}) => {\n  return (\n    <Flex\n      data-testid=\"navChip\"\n      justifyContent=\"center\"\n      alignItems=\"center\"\n      minWidth={32}\n      height={24}\n      borderRadius={9999}\n      typography=\"caption\"\n      bgcolor={backgroundColor}\n    >\n      {children}\n    </Flex>\n  );\n};\n","import NextLink, { LinkProps } from \"next/link\";\nimport { ReactNode } from \"react\";\n\n/** A link where the default link behavior can be disabled */\nexport const MaybeLink = ({\n  disabled,\n  children,\n  ...props\n}: LinkProps & { disabled: boolean; children: ReactNode }) => {\n  if (disabled) {\n    return <>{children}</>;\n  }\n\n  return <NextLink {...props}>{children}</NextLink>;\n};\n","import { ButtonBase, Link, LinkProps, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport pickBy from \"lodash/pickBy\";\nimport { stringify } from \"qs\";\nimport { ReactNode, useMemo } from \"react\";\n\nimport { BrowseFilter, encodeFilter } from \"@/browse/lib/filters\";\nimport { useBrowseContext } from \"@/browse/model/context\";\nimport { NavigationChip } from \"@/browse/ui/navigation-chip\";\nimport { MaybeLink } from \"@/components/maybe-link\";\nimport { accordionPresenceProps, MotionBox } from \"@/components/presence\";\nimport SvgIcClose from \"@/icons/components/IcClose\";\n\nexport const NavigationItem = ({\n  children,\n  filters,\n  next,\n  count,\n  active,\n  level = 1,\n  disableLink,\n  countBg,\n}: {\n  children: ReactNode;\n  filters: BrowseFilter[];\n  next: BrowseFilter;\n  count?: number;\n  active: boolean;\n  /** Level is there to differentiate between organizations and organization subtopics */\n  level?: number;\n  disableLink?: boolean;\n  countBg: string;\n} & LinkProps) => {\n  const { includeDrafts, search, setFilters } = useBrowseContext();\n  const classes = useStyles({ level });\n  const highlighted = active && level === 1;\n\n  const [newFiltersAdd, href] = useMemo(() => {\n    const extraURLParams = stringify(\n      pickBy(\n        {\n          includeDrafts,\n          search,\n          topic: level === 2 && !disableLink ? next.iri : undefined,\n        },\n        Boolean\n      )\n    );\n    const newFilters = [...filters].filter(\n      (f) =>\n        (disableLink ? true : f.__typename !== \"DataCubeAbout\") &&\n        (level === 1 ? f.__typename !== next.__typename : true)\n    );\n\n    if (level === 1 || disableLink) {\n      newFilters.push(next);\n    }\n\n    return [\n      newFilters,\n      `/browse/${newFilters.map(encodeFilter).join(\"/\")}?${extraURLParams}`,\n    ] as const;\n  }, [includeDrafts, search, level, next, filters, disableLink]);\n\n  const [newFiltersRemove, removeFilterPath] = useMemo(() => {\n    const extraURLParams = stringify(\n      pickBy({ includeDrafts, search }, Boolean)\n    );\n    const newFilters = filters.filter(\n      (f) => f.__typename !== \"DataCubeAbout\" && f.iri !== next.iri\n    );\n\n    return [\n      newFilters,\n      `/browse/${newFilters.map(encodeFilter).join(\"/\")}?${extraURLParams}`,\n    ] as const;\n  }, [includeDrafts, search, filters, next.iri]);\n\n  return (\n    <MotionBox {...accordionPresenceProps} data-testid=\"navItem\">\n      <MaybeLink\n        href={href}\n        passHref\n        legacyBehavior\n        disabled={!!disableLink}\n        scroll={false}\n        shallow\n      >\n        <Link\n          className={classes.root}\n          variant=\"body3\"\n          onClick={\n            disableLink && !active\n              ? (e) => {\n                  e.preventDefault();\n                  setFilters(newFiltersAdd);\n                }\n              : undefined\n          }\n          sx={{\n            p: 2,\n            backgroundColor: highlighted ? \"cobalt.50\" : \"transparent\",\n            color: active\n              ? level === 1\n                ? \"text.primary\"\n                : \"cobalt.50\"\n              : \"text.primary\",\n            cursor: active ? \"default\" : \"pointer\",\n          }}\n        >\n          {children}\n          {highlighted ? (\n            <MaybeLink\n              href={removeFilterPath}\n              passHref\n              legacyBehavior\n              disabled={!!disableLink}\n              scroll={false}\n              shallow\n            >\n              <ButtonBase\n                className={classes.removeFilterButton}\n                onClick={\n                  disableLink\n                    ? (e) => {\n                        e.preventDefault();\n                        setFilters(newFiltersRemove);\n                      }\n                    : undefined\n                }\n              >\n                <SvgIcClose width={24} height={24} />\n              </ButtonBase>\n            </MaybeLink>\n          ) : count !== undefined ? (\n            <NavigationChip backgroundColor={countBg}>{count}</NavigationChip>\n          ) : null}\n        </Link>\n      </MaybeLink>\n    </MotionBox>\n  );\n};\n\nconst useStyles = makeStyles<Theme, { level: number }>((theme) => ({\n  root: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    gap: theme.spacing(3),\n    width: \"100%\",\n    padding: theme.spacing(2),\n    borderRadius: 2,\n    transition: \"background-color 0.1s ease\",\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.cobalt[50],\n    },\n  },\n  removeFilterButton: ({ level }) => ({\n    display: \"flex\",\n    alignItems: \"center\",\n    width: \"auto\",\n    height: \"auto\",\n    minWidth: 16,\n    minHeight: 16,\n    marginRight: 2,\n    padding: 0,\n    borderRadius: 2,\n    backgroundColor: level === 1 ? \"cobalt.50\" : \"transparent\",\n    color: level === 1 ? theme.palette.text.primary : \"cobalt.50\",\n    transition: \"background-color 0.1s ease\",\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.cobalt[100],\n    },\n  }),\n}));\n","import { Box, Typography } from \"@mui/material\";\nimport { ReactNode } from \"react\";\n\nexport const NavigationSectionTitle = ({\n  label,\n  backgroundColor,\n}: {\n  label: ReactNode;\n  backgroundColor: string;\n}) => {\n  return (\n    <Box sx={{ mb: 2, px: 2, py: 3, borderRadius: \"6px\", backgroundColor }}>\n      <Typography variant=\"h4\" component=\"div\" sx={{ fontWeight: 700 }}>\n        {label}\n      </Typography>\n    </Box>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Button } from \"@mui/material\";\nimport { Reorder } from \"framer-motion\";\nimport orderBy from \"lodash/orderBy\";\nimport sortBy from \"lodash/sortBy\";\nimport { ReactNode, useMemo } from \"react\";\n\nimport { BrowseFilter } from \"@/browse/lib/filters\";\nimport { NavigationItem } from \"@/browse/ui/navigation-item\";\nimport { NavigationSectionTitle } from \"@/browse/ui/navigation-section-title\";\nimport { useDisclosure } from \"@/components/use-disclosure\";\nimport {\n  DataCubeOrganization,\n  DataCubeTermset,\n  DataCubeTheme,\n} from \"@/graphql/query-hooks\";\nimport { Icon } from \"@/icons\";\n\nexport const NavigationSection = ({\n  label,\n  items,\n  backgroundColor,\n  currentFilter,\n  filters,\n  counts,\n  extra,\n  disableLinks,\n}: {\n  label: ReactNode;\n  items: (DataCubeTheme | DataCubeOrganization | DataCubeTermset)[];\n  backgroundColor: string;\n  currentFilter?: DataCubeTheme | DataCubeOrganization | DataCubeTermset;\n  filters: BrowseFilter[];\n  counts: Record<string, number>;\n  extra?: ReactNode;\n  disableLinks?: boolean;\n}) => {\n  const { isOpen, open, close } = useDisclosure(!!currentFilter);\n  const topItems = useMemo(() => {\n    return sortBy(\n      orderBy(items, (item) => counts[item.iri], \"desc\").slice(0, 7),\n      (item) => item.label\n    );\n  }, [counts, items]);\n\n  return (\n    <div>\n      <NavigationSectionTitle label={label} backgroundColor={backgroundColor} />\n      <Reorder.Group\n        axis=\"y\"\n        as=\"div\"\n        onReorder={() => {}}\n        values={isOpen ? items : topItems}\n      >\n        {(isOpen ? items : topItems).map((item) => {\n          return (\n            <Reorder.Item key={item.iri} as=\"div\" value={item}>\n              <NavigationItem\n                active={currentFilter?.iri === item.iri}\n                filters={filters}\n                next={item}\n                count={counts[item.iri]}\n                disableLink={disableLinks}\n                countBg={backgroundColor}\n              >\n                {item.label}\n              </NavigationItem>\n            </Reorder.Item>\n          );\n        })}\n        {topItems.length !== items.length ? (\n          <Button\n            variant=\"text\"\n            color=\"primary\"\n            size=\"sm\"\n            onClick={isOpen ? close : open}\n            endIcon={<Icon name={isOpen ? \"arrowUp\" : \"arrowDown\"} size={20} />}\n            sx={{ width: \"100%\", mt: 2 }}\n          >\n            {isOpen ? (\n              <Trans id=\"show.less\">Show less</Trans>\n            ) : (\n              <Trans id=\"show.all\">Show all</Trans>\n            )}\n          </Button>\n        ) : null}\n      </Reorder.Group>\n      {extra}\n    </div>\n  );\n};\n","import { BrowseFilter } from \"@/browse/lib/filters\";\nimport { NavigationItem } from \"@/browse/ui/navigation-item\";\nimport { SearchCube } from \"@/domain/data\";\n\nexport const SubthemeFilters = ({\n  subthemes,\n  filters,\n  counts,\n  disableLinks,\n  countBg,\n}: {\n  subthemes: SearchCube[\"subthemes\"];\n  filters: BrowseFilter[];\n  counts: Record<string, number>;\n  disableLinks?: boolean;\n  countBg: string;\n}) => {\n  return (\n    <>\n      {subthemes.map((d) => {\n        const count = counts[d.iri];\n\n        if (!count) {\n          return null;\n        }\n\n        return (\n          <NavigationItem\n            key={d.iri}\n            next={{ __typename: \"DataCubeAbout\", ...d }}\n            filters={filters}\n            active={filters[filters.length - 1]?.iri === d.iri}\n            level={2}\n            count={count}\n            disableLink={disableLinks}\n            countBg={countBg}\n          >\n            {d.label}\n          </NavigationItem>\n        );\n      })}\n    </>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Stack } from \"@mui/material\";\nimport { AnimatePresence } from \"framer-motion\";\nimport keyBy from \"lodash/keyBy\";\nimport sortBy from \"lodash/sortBy\";\nimport uniqBy from \"lodash/uniqBy\";\nimport { ReactNode, useMemo } from \"react\";\n\nimport { BrowseFilter } from \"@/browse/lib/filters\";\nimport { useBrowseContext } from \"@/browse/model/context\";\nimport { NavigationSection } from \"@/browse/ui/navigation-section\";\nimport { SubthemeFilters } from \"@/browse/ui/subtheme-filters\";\nimport { Flex } from \"@/components/flex\";\nimport { InfoIconTooltip } from \"@/components/info-icon-tooltip\";\nimport { truthy } from \"@/domain/types\";\nimport {\n  DataCubeOrganization,\n  DataCubeTermset,\n  DataCubeTheme,\n} from \"@/graphql/query-hooks\";\nimport { SearchCubeResult } from \"@/graphql/resolver-types\";\n\nconst navigationOrder: Record<BrowseFilter[\"__typename\"], number> = {\n  DataCubeTheme: 1,\n  DataCubeOrganization: 2,\n  DataCubeTermset: 3,\n  // Not used in the navigation\n  DataCubeAbout: 4,\n};\n\nexport const SearchFilters = ({\n  cubes,\n  themes,\n  orgs,\n  termsets,\n  disableNavLinks,\n}: {\n  cubes: SearchCubeResult[];\n  themes: DataCubeTheme[];\n  orgs: DataCubeOrganization[];\n  termsets: DataCubeTermset[];\n  disableNavLinks?: boolean;\n}) => {\n  const { filters } = useBrowseContext();\n  const counts = useMemo(() => {\n    const result: Record<string, number> = {};\n\n    for (const { cube } of cubes) {\n      const countable = [\n        ...cube.themes,\n        ...cube.subthemes,\n        ...cube.termsets,\n        cube.creator,\n      ].filter(truthy);\n\n      for (const { iri } of countable) {\n        if (iri) {\n          result[iri] = (result[iri] ?? 0) + 1;\n        }\n      }\n    }\n\n    return result;\n  }, [cubes]);\n\n  const { themeFilter, organizationFilter, termsetFilter } = useMemo(() => {\n    const result = keyBy(filters, (f) => f.__typename);\n\n    return {\n      themeFilter: result.DataCubeTheme as DataCubeTheme,\n      organizationFilter: result.DataCubeOrganization as\n        | DataCubeOrganization\n        | undefined,\n      termsetFilter: result.DataCubeTermset as DataCubeTermset | undefined,\n    };\n  }, [filters]);\n\n  const displayedThemes = themes.filter((theme) => {\n    if (!theme.label) {\n      return false;\n    }\n\n    if (!counts[theme.iri]) {\n      return false;\n    }\n\n    if (themeFilter && themeFilter.iri !== theme.iri) {\n      return false;\n    }\n\n    return true;\n  });\n\n  const displayedOrgs = orgs.filter((org) => {\n    if (!org.label) {\n      return false;\n    }\n\n    if (!counts[org.iri] && organizationFilter?.iri !== org.iri) {\n      return false;\n    }\n\n    if (organizationFilter && organizationFilter.iri !== org.iri) {\n      return false;\n    }\n\n    return true;\n  });\n\n  const displayedTermsets = termsets.filter((termset) => {\n    if (!termset.label) {\n      return false;\n    }\n\n    if (!counts[termset.iri] && termsetFilter?.iri !== termset.iri) {\n      return false;\n    }\n\n    if (termsetFilter && termsetFilter.iri !== termset.iri) {\n      return false;\n    }\n\n    return true;\n  });\n\n  const themeNavigation =\n    displayedThemes.length > 0 ? (\n      <NavigationSection\n        key=\"themes\"\n        items={displayedThemes}\n        backgroundColor=\"green.100\"\n        currentFilter={themeFilter}\n        counts={counts}\n        filters={filters}\n        label={<Trans id=\"browse-panel.themes\">Themes</Trans>}\n        disableLinks={disableNavLinks}\n      />\n    ) : null;\n\n  const subthemes = useMemo(() => {\n    return sortBy(\n      uniqBy(\n        cubes.flatMap((d) => d.cube.subthemes),\n        (d) => d.iri\n      ),\n      (d) => d.label\n    );\n  }, [cubes]);\n\n  const organizationBackgroundColor = \"blue.100\";\n  const organizationNavigation =\n    displayedOrgs.length > 0 ? (\n      <NavigationSection\n        key=\"orgs\"\n        items={displayedOrgs}\n        backgroundColor={organizationBackgroundColor}\n        currentFilter={organizationFilter}\n        counts={counts}\n        filters={filters}\n        label={<Trans id=\"browse-panel.organizations\">Organizations</Trans>}\n        extra={\n          organizationFilter &&\n          filters.map((d) => d.iri).includes(organizationFilter.iri) ? (\n            <SubthemeFilters\n              subthemes={subthemes}\n              filters={filters}\n              counts={counts}\n              disableLinks={disableNavLinks}\n              countBg={organizationBackgroundColor}\n            />\n          ) : null\n        }\n        disableLinks={disableNavLinks}\n      />\n    ) : null;\n\n  const termsetNavigation =\n    termsets.length > 0 ? (\n      <NavigationSection\n        key=\"termsets\"\n        items={displayedTermsets}\n        backgroundColor=\"monochrome.200\"\n        currentFilter={termsetFilter}\n        counts={counts}\n        filters={filters}\n        label={\n          <Stack\n            direction=\"row\"\n            justifyContent=\"space-between\"\n            alignItems=\"center\"\n            gap={2}\n            width=\"100%\"\n          >\n            <Trans id=\"browse-panel.termsets\">Concepts</Trans>\n            <InfoIconTooltip\n              title={\n                <Trans id=\"browse-panel.termsets.explanation\">\n                  Concepts represent values that can be shared across different\n                  dimensions and datasets.\n                </Trans>\n              }\n            />\n          </Stack>\n        }\n        extra={null}\n        disableLinks={disableNavLinks}\n      />\n    ) : null;\n\n  const baseNavigations: {\n    element: ReactNode;\n    __typename: BrowseFilter[\"__typename\"];\n  }[] = [\n    { element: themeNavigation, __typename: \"DataCubeTheme\" },\n    { element: organizationNavigation, __typename: \"DataCubeOrganization\" },\n    { element: termsetNavigation, __typename: \"DataCubeTermset\" },\n  ];\n\n  const navigations = sortBy(baseNavigations, (nav) => {\n    const i = filters.findIndex((f) => f.__typename === nav.__typename);\n\n    return i === -1\n      ? // If the filter is not in the list, we want to put it at the end\n        navigationOrder[nav.__typename] + Object.keys(navigationOrder).length\n      : i;\n  });\n\n  return (\n    <div key={filters.length} role=\"search\">\n      {/* Need to \"catch\" the Reorder items here, as otherwise there is an exiting\n          bug as they get picked by parent AnimatePresence. Probably related to\n          https://github.com/framer/motion/issues/1619. */}\n      <AnimatePresence>\n        <Flex sx={{ flexDirection: \"column\", rowGap: 8, width: \"100%\" }}>\n          {navigations.map((nav) => nav.element)}\n        </Flex>\n      </AnimatePresence>\n    </div>\n  );\n};\n","import { ContentWrapper } from \"@interactivethings/swiss-federal-ci/dist/components\";\nimport { Trans } from \"@lingui/macro\";\nimport { Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { AnimatePresence } from \"framer-motion\";\n\nimport { useBrowseContext } from \"@/browse/model/context\";\nimport { SearchDatasetInput } from \"@/browse/ui/search-dataset-input\";\nimport {\n  __BANNER_MARGIN_CSS_VAR,\n  bannerPresenceProps,\n  MotionBox,\n} from \"@/components/presence\";\nimport { useResizeObserver } from \"@/utils/use-resize-observer\";\n\nexport const SelectDatasetBanner = ({\n  dataset,\n  variant,\n}: {\n  dataset: string | undefined;\n  variant: \"page\" | \"drawer\";\n}) => {\n  const [ref] = useResizeObserver<HTMLDivElement>(({ height }) => {\n    if (height) {\n      document.documentElement.style.setProperty(\n        __BANNER_MARGIN_CSS_VAR,\n        `-${height}px`\n      );\n    }\n  });\n  const classes = useStyles();\n  const show = !dataset && variant === \"page\";\n  const browseState = useBrowseContext();\n\n  return (\n    <AnimatePresence>\n      {show ? (\n        <MotionBox key=\"banner\" ref={ref} {...bannerPresenceProps}>\n          <section className={classes.outerWrapper} role=\"banner\">\n            <ContentWrapper className={classes.innerWrapper}>\n              <div className={classes.content}>\n                <Typography className={classes.title} variant=\"h1\">\n                  Swiss Open Government Data\n                </Typography>\n                <Typography className={classes.description} variant=\"body2\">\n                  <Trans id=\"browse.datasets.description\">\n                    Explore datasets provided by the LINDAS Linked Data Service\n                    by either filtering by categories or organizations or search\n                    directly for specific keywords. Click on a dataset to see\n                    more detailed information and start creating your own\n                    visualizations.\n                  </Trans>\n                </Typography>\n                <SearchDatasetInput browseState={browseState} />\n              </div>\n            </ContentWrapper>\n          </section>\n        </MotionBox>\n      ) : null}\n    </AnimatePresence>\n  );\n};\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  outerWrapper: {\n    backgroundColor: theme.palette.monochrome[100],\n  },\n  innerWrapper: {\n    paddingTop: theme.spacing(25),\n    paddingBottom: theme.spacing(25),\n  },\n  content: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    maxWidth: 940,\n  },\n  title: {\n    marginBottom: theme.spacing(4),\n    fontWeight: 700,\n  },\n  description: {\n    marginBottom: theme.spacing(10),\n  },\n}));\n","export const softJSONParse = (v: string) => {\n  try {\n    return JSON.parse(v);\n  } catch (e) {\n    return null;\n  }\n};\n","import { ContentWrapper } from \"@interactivethings/swiss-federal-ci/dist/components\";\nimport { Trans } from \"@lingui/macro\";\nimport { Box, Button, darken, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { AnimatePresence } from \"framer-motion\";\nimport sortBy from \"lodash/sortBy\";\nimport uniqBy from \"lodash/uniqBy\";\nimport Head from \"next/head\";\nimport NextLink from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { ComponentProps, type MouseEvent, useCallback, useMemo } from \"react\";\nimport { useDebounce } from \"use-debounce\";\n\nimport { BrowseFilter, DataCubeAbout } from \"@/browse/lib/filters\";\nimport { buildURLFromBrowseParams, isOdsIframe } from \"@/browse/lib/params\";\nimport { useRedirectToLatestCube } from \"@/browse/lib/use-redirect-to-latest-cube\";\nimport { BrowseStateProvider, useBrowseContext } from \"@/browse/model/context\";\nimport { DatasetMetadataSingleCube } from \"@/browse/ui/dataset-metadata-single-cube\";\nimport {\n  DataSetPreview,\n  DataSetPreviewProps,\n} from \"@/browse/ui/dataset-preview\";\nimport {\n  DatasetResults,\n  DatasetResultsProps,\n} from \"@/browse/ui/dataset-results\";\nimport { SearchDatasetControls } from \"@/browse/ui/search-dataset-controls\";\nimport { SearchDatasetInput } from \"@/browse/ui/search-dataset-input\";\nimport { SearchFilters } from \"@/browse/ui/search-filters\";\nimport { SelectDatasetBanner } from \"@/browse/ui/select-dataset-banner\";\nimport { CHART_RESIZE_EVENT_TYPE } from \"@/charts/shared/use-size\";\nimport { Flex } from \"@/components/flex\";\nimport { Footer } from \"@/components/footer\";\nimport {\n  DURATION,\n  MotionBox,\n  navPresenceProps,\n  smoothPresenceProps,\n} from \"@/components/presence\";\nimport {\n  PanelBodyWrapper,\n  PanelLayout,\n} from \"@/configurator/components/layout\";\nimport { sourceToLabel } from \"@/domain/data-source\";\nimport { truthy } from \"@/domain/types\";\nimport {\n  DataCubeOrganization,\n  DataCubeTermset,\n  DataCubeTheme,\n  SearchCubeFilterType,\n  useDataCubeMetadataQuery,\n  useSearchCubesQuery,\n} from \"@/graphql/query-hooks\";\nimport { Icon } from \"@/icons\";\nimport { useConfiguratorState, useLocale } from \"@/src\";\nimport { softJSONParse } from \"@/utils/soft-json-parse\";\nimport { useResizeObserver } from \"@/utils/use-resize-observer\";\n\nexport const SelectDatasetStep = (\n  props: Omit<ComponentProps<typeof SelectDatasetStepInner>, \"variant\"> & {\n    /**\n     * Is passed to the content component. At this level, it controls which whether the\n     * browsing state is synced with the URL or not.\n     * At the SelectDatasetStepContent level, it tweaks UI elements.\n     * /!\\ It should not change during the lifetime of the component.\n     */\n    variant: \"page\" | \"drawer\";\n  }\n) => {\n  return (\n    <BrowseStateProvider syncWithUrl={props.variant === \"page\"}>\n      <SelectDatasetStepInner {...props} />\n    </BrowseStateProvider>\n  );\n};\n\nconst SelectDatasetStepInner = ({\n  datasetPreviewProps,\n  datasetResultsProps,\n  dataset: propsDataset,\n  onClickBackLink,\n  onCreateChartFromDataset,\n  variant = \"page\",\n}: {\n  datasetPreviewProps?: Partial<DataSetPreviewProps>;\n  datasetResultsProps?: Partial<DatasetResultsProps>;\n  onClickBackLink?: (e: MouseEvent<HTMLButtonElement>) => void;\n  onCreateChartFromDataset?: (\n    e: MouseEvent<HTMLAnchorElement>,\n    datasetIri: string\n  ) => void;\n  dataset?: string | undefined;\n  variant?: \"page\" | \"drawer\";\n}) => {\n  const locale = useLocale();\n  const [{ state, dataSource }] = useConfiguratorState();\n  const browseState = useBrowseContext();\n  const {\n    search,\n    order,\n    includeDrafts,\n    filters,\n    dataset: browseDataset,\n  } = browseState;\n  const dataset = propsDataset ?? browseDataset;\n  const router = useRouter();\n  const odsIframe = isOdsIframe(router.query);\n  const classes = useStyles({ datasetPresent: !!dataset, odsIframe });\n\n  const [debouncedQuery] = useDebounce(search, 500, { leading: true });\n  const handleHeightChange = useCallback(\n    ({ height }: { width: number; height: number }) => {\n      window.parent.postMessage({ type: CHART_RESIZE_EVENT_TYPE, height }, \"*\");\n    },\n    []\n  );\n  const [ref] = useResizeObserver<HTMLDivElement>(handleHeightChange);\n  const backLink = useMemo(() => {\n    const backParameters = softJSONParse(router.query.previous as string);\n\n    if (!backParameters) {\n      return \"/browse\";\n    }\n\n    return buildURLFromBrowseParams(backParameters);\n  }, [router.query]);\n\n  const queryFilters = useMemo(() => {\n    if (!filters) {\n      return [];\n    }\n\n    return (\n      filters\n        // Subthemes are filtered on client side.\n        .filter(\n          (d): d is Exclude<BrowseFilter, DataCubeAbout> =>\n            d.__typename !== SearchCubeFilterType.DataCubeAbout\n        )\n        .map((d) => {\n          const type = SearchCubeFilterType[d.__typename];\n          return {\n            type,\n            label: d.label,\n            value: d.iri,\n          };\n        })\n    );\n  }, [filters]);\n\n  // Use the debounced query value here only!\n  const [{ data, fetching, error }] = useSearchCubesQuery({\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      query: debouncedQuery,\n      order,\n      includeDrafts,\n      filters: queryFilters,\n    },\n    pause: !!dataset,\n  });\n\n  useRedirectToLatestCube({ dataSource, datasetIri: dataset });\n\n  const { allCubes, cubes } = useMemo(() => {\n    if (!data || data.searchCubes.length === 0) {\n      return {\n        allCubes: [],\n        cubes: [],\n      };\n    }\n\n    const subthemeFilters = filters.filter(\n      (d) => d.__typename === \"DataCubeAbout\"\n    );\n\n    if (subthemeFilters.length === 0) {\n      return {\n        allCubes: data.searchCubes,\n        cubes: data.searchCubes,\n      };\n    }\n\n    const subthemes = subthemeFilters.map((d) => d.iri);\n\n    return {\n      allCubes: data.searchCubes,\n      cubes: data.searchCubes.filter((d) => {\n        return d.cube.subthemes.some((d) => subthemes.includes(d.iri));\n      }),\n    };\n  }, [data, filters]);\n\n  const themes: DataCubeTheme[] = useMemo(() => {\n    return sortBy(\n      uniqBy(\n        cubes\n          .flatMap((d) => d.cube.themes)\n          .map((d) => ({ ...d, __typename: \"DataCubeTheme\" })),\n        (d) => d.iri\n      ),\n      (d) => d.label\n    );\n  }, [cubes]);\n\n  const orgs: DataCubeOrganization[] = useMemo(() => {\n    return sortBy(\n      uniqBy(\n        cubes\n          .map((d) => d.cube.creator)\n          .filter((d) => d?.iri)\n          .filter(truthy)\n          .map((d) => ({ ...d, __typename: \"DataCubeOrganization\" })),\n        (d) => d.iri\n      ),\n      (d) => d.label\n    );\n  }, [cubes]);\n\n  const termsets: DataCubeTermset[] = useMemo(() => {\n    return sortBy(\n      uniqBy(\n        cubes.flatMap((d) =>\n          d.cube.termsets.map((d) => ({ ...d, __typename: \"DataCubeTermset\" }))\n        ),\n        (d) => d.iri\n      ),\n      (d) => d.label\n    );\n  }, [cubes]);\n\n  const pageTitle = useMemo(() => {\n    return queryFilters\n      .map((queryFilter) => {\n        const searchList = (() => {\n          switch (queryFilter.type) {\n            case SearchCubeFilterType.DataCubeTheme:\n              return themes;\n            case SearchCubeFilterType.DataCubeOrganization:\n              return orgs;\n            case SearchCubeFilterType.DataCubeTermset:\n              return termsets;\n            case SearchCubeFilterType.DataCubeAbout:\n            case SearchCubeFilterType.TemporalDimension:\n              return [];\n            default:\n              const _exhaustiveCheck: never = queryFilter.type;\n              return _exhaustiveCheck;\n          }\n        })();\n        const foundQueryFilter = (\n          searchList as { iri: string; label?: string }[]\n        ).find(({ iri }) => iri === queryFilter.value);\n\n        return (foundQueryFilter ?? queryFilter).label;\n      })\n      .join(\", \");\n  }, [orgs, queryFilters, termsets, themes]);\n\n  const dataCubeMetadataQuery = useDataCubeMetadataQuery({\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilter: {\n        iri: dataset ?? \"\",\n      },\n    },\n    pause: !dataset,\n  });\n  const [{ data: dataCubeMetadata }] = dataCubeMetadataQuery;\n\n  if (state !== \"SELECTING_DATASET\") {\n    return null;\n  }\n\n  return (\n    <div ref={odsIframe ? ref : null}>\n      <SelectDatasetBanner dataset={dataset} variant={variant} />\n      <Box\n        sx={{\n          borderBottom:\n            odsIframe || variant === \"drawer\"\n              ? \"none\"\n              : (t) => `1px solid ${t.palette.cobalt[100]}`,\n        }}\n      >\n        <ContentWrapper\n          sx={\n            odsIframe\n              ? { maxWidth: \"unset !important\", px: \"8px !important\" }\n              : {}\n          }\n        >\n          <AnimatePresence mode=\"wait\">\n            {dataset ? (\n              <MotionBox\n                key=\"navigation\"\n                initial={{ opacity: 0, height: 0, overflow: \"hidden\" }}\n                animate={{ opacity: 1, height: \"auto\" }}\n                exit={{ opacity: 0, height: 0 }}\n                // To match mode=\"wait\" enter / exit animation duration\n                transition={{ duration: odsIframe ? 0 : DURATION * 2 }}\n                style={{ width: \"100%\" }}\n              >\n                <Flex\n                  sx={(theme) => ({\n                    justifyContent: odsIframe ? \"flex-end\" : \"space-between\",\n                    alignItems: \"center\",\n                    pt: odsIframe ? 12 : variant == \"drawer\" ? 10 : 6,\n                    pb: 6,\n\n                    [theme.breakpoints.down(\"md\")]: {\n                      flexWrap: \"wrap\",\n                    },\n                  })}\n                >\n                  {odsIframe ? null : (\n                    <NextLink href={backLink} passHref legacyBehavior>\n                      <Button\n                        variant=\"outlined\"\n                        size=\"sm\"\n                        startIcon={<Icon name=\"arrowLeft\" size={20} />}\n                        onClick={onClickBackLink}\n                      >\n                        <Trans id=\"dataset-preview.back-to-results\">\n                          Back to the datasets\n                        </Trans>\n                      </Button>\n                    </NextLink>\n                  )}\n                  {onCreateChartFromDataset ? (\n                    <Button\n                      component=\"a\"\n                      size=\"sm\"\n                      target={odsIframe ? \"_blank\" : undefined}\n                      endIcon={\n                        <Icon\n                          name={odsIframe ? \"legacyLinkExternal\" : \"arrowRight\"}\n                          size={20}\n                        />\n                      }\n                      onClick={(e) => onCreateChartFromDataset?.(e, dataset)}\n                    >\n                      {!odsIframe ? (\n                        <Trans id=\"browse.dataset.create-visualization\">\n                          Create a visualization\n                        </Trans>\n                      ) : (\n                        <Trans id=\"browse.dataset.create-visualization-visualize\">\n                          Create with visualize.admin\n                        </Trans>\n                      )}\n                    </Button>\n                  ) : (\n                    <NextLink\n                      href={`/create/new?cube=${\n                        dataCubeMetadata?.dataCubeMetadata.iri\n                      }&dataSource=${sourceToLabel(dataSource)}`}\n                      passHref\n                      legacyBehavior={!odsIframe}\n                      target={odsIframe ? \"_blank\" : undefined}\n                    >\n                      <Button\n                        size=\"sm\"\n                        endIcon={\n                          <Icon\n                            name={\n                              odsIframe ? \"legacyLinkExternal\" : \"arrowRight\"\n                            }\n                            size={20}\n                          />\n                        }\n                        sx={\n                          odsIframe\n                            ? {\n                                // Could be extracted in case we have more\n                                // openData.swiss dependencies\n                                backgroundColor: \"#009688\",\n\n                                \"&:hover\": {\n                                  backgroundColor: darken(\"#009688\", 0.2),\n                                },\n                              }\n                            : null\n                        }\n                      >\n                        {!odsIframe ? (\n                          <Trans id=\"browse.dataset.create-visualization\">\n                            Create a visualization\n                          </Trans>\n                        ) : (\n                          <Trans id=\"browse.dataset.create-visualization-visualize\">\n                            Create with visualize.admin\n                          </Trans>\n                        )}\n                      </Button>\n                    </NextLink>\n                  )}\n                </Flex>\n              </MotionBox>\n            ) : null}\n          </AnimatePresence>\n        </ContentWrapper>\n      </Box>\n      <ContentWrapper\n        sx={\n          odsIframe\n            ? { maxWidth: \"unset !important\", px: \"8px !important\" }\n            : {}\n        }\n      >\n        <PanelLayout\n          type={odsIframe ? \"M\" : \"LM\"}\n          className={classes.panelLayout}\n        >\n          {odsIframe ? null : (\n            <PanelBodyWrapper type=\"L\" className={classes.panelLeft}>\n              <AnimatePresence mode=\"wait\">\n                {dataset ? (\n                  <MotionBox key=\"metadata\" {...navPresenceProps}>\n                    <MotionBox {...smoothPresenceProps}>\n                      <DatasetMetadataSingleCube\n                        datasetIri={dataset}\n                        dataSource={dataSource}\n                      />\n                    </MotionBox>\n                  </MotionBox>\n                ) : (\n                  <MotionBox key=\"search-filters\" {...navPresenceProps}>\n                    <SearchFilters\n                      cubes={allCubes}\n                      themes={themes}\n                      orgs={orgs}\n                      termsets={termsets}\n                      disableNavLinks={variant === \"drawer\"}\n                    />\n                  </MotionBox>\n                )}\n              </AnimatePresence>\n            </PanelBodyWrapper>\n          )}\n          <PanelBodyWrapper type=\"M\" className={classes.panelMiddle}>\n            <AnimatePresence mode=\"wait\">\n              {dataset ? (\n                <MotionBox\n                  key=\"preview\"\n                  {...navPresenceProps}\n                  transition={{\n                    ...navPresenceProps.transition,\n                    duration: odsIframe\n                      ? 0\n                      : navPresenceProps.transition.duration,\n                  }}\n                >\n                  <DataSetPreview\n                    dataSetIri={dataset}\n                    dataSource={dataSource}\n                    dataCubeMetadataQuery={dataCubeMetadataQuery}\n                    odsIframe={odsIframe}\n                    {...datasetPreviewProps}\n                  />\n                </MotionBox>\n              ) : (\n                <MotionBox key=\"filters\" {...navPresenceProps}>\n                  <AnimatePresence>\n                    {variant === \"drawer\" ? (\n                      <div\n                        key=\"select-dataset\"\n                        style={{ marginTop: \"0.125rem\", marginBottom: \"2rem\" }}\n                      >\n                        <Typography variant=\"h2\">\n                          <Trans id=\"chart.datasets.add-dataset-drawer.title\">\n                            Select dataset\n                          </Trans>\n                        </Typography>\n                        <SearchDatasetInput\n                          browseState={browseState}\n                          searchFieldProps={{\n                            sx: {\n                              \"&&\": {\n                                maxWidth: \"unset\",\n                              },\n                            },\n                          }}\n                        />\n                      </div>\n                    ) : null}\n                    {queryFilters.length > 0 && (\n                      <>\n                        <Head>\n                          <title key=\"title\">\n                            {pageTitle} - visualize.admin.ch\n                          </title>\n                        </Head>\n                        <MotionBox\n                          key=\"query-filters\"\n                          {...{\n                            initial: {\n                              transform: \"translateY(-16px)\",\n                              height: 0,\n                              marginBottom: 0,\n                              opacity: 0,\n                            },\n                            animate: {\n                              transform: \"translateY(0px)\",\n                              height: \"auto\",\n                              marginBottom: 16,\n                              opacity: 1,\n                            },\n                            exit: {\n                              transform: \"translateY(-16px)\",\n                              height: 0,\n                              marginBottom: 0,\n                              opacity: 0,\n                            },\n                            transition: {\n                              duration: DURATION,\n                            },\n                          }}\n                        >\n                          <Typography\n                            key=\"filters\"\n                            className={classes.filters}\n                            variant=\"h1\"\n                          >\n                            {pageTitle}\n                          </Typography>\n                        </MotionBox>\n                      </>\n                    )}\n                  </AnimatePresence>\n                  <SearchDatasetControls\n                    browseState={browseState}\n                    cubes={cubes}\n                  />\n                  <DatasetResults\n                    fetching={fetching}\n                    error={error}\n                    cubes={cubes}\n                    datasetResultProps={() => ({ showDimensions: true })}\n                    {...datasetResultsProps}\n                  />\n                </MotionBox>\n              )}\n            </AnimatePresence>\n          </PanelBodyWrapper>\n        </PanelLayout>\n      </ContentWrapper>\n      {variant == \"page\" && !odsIframe ? (\n        <Box sx={{ mt: 8, borderTop: \"2px solid rgba(0,0,0,0.05)\" }}>\n          <Footer sx={{ width: \"100%\", mx: \"auto\", borderTopWidth: 0 }} />\n        </Box>\n      ) : null}\n    </div>\n  );\n};\n\nconst useStyles = makeStyles<\n  Theme,\n  { datasetPresent: boolean; odsIframe: boolean }\n>((theme) => ({\n  panelLayout: {\n    position: \"static\",\n    height: \"auto\",\n    margin: \"auto\",\n    marginTop: ({ odsIframe }) => (odsIframe ? 0 : theme.spacing(12)),\n    backgroundColor: theme.palette.background.paper,\n    transition: \"margin-top 0.5s ease\",\n  },\n  panelLeft: {\n    marginBottom: theme.spacing(12),\n    boxShadow: \"none\",\n    outline: \"none\",\n    transition: \"padding-top 0.5s ease\",\n\n    [theme.breakpoints.up(\"md\")]: {\n      position: ({ datasetPresent }) => (datasetPresent ? \"static\" : \"sticky\"),\n      top: ({ datasetPresent }) => (datasetPresent ? 0 : theme.spacing(8)),\n      overflowY: \"auto\",\n      minHeight: \"100vh\",\n      maxHeight: ({ datasetPresent }) => (datasetPresent ? \"none\" : \"100vh\"),\n      marginBottom: \"unset\",\n      paddingBottom: ({ datasetPresent }) =>\n        datasetPresent ? 0 : theme.spacing(16),\n    },\n  },\n  panelMiddle: {\n    gridColumnStart: \"middle\",\n    gridColumnEnd: \"right\",\n    backgroundColor: theme.palette.background.paper,\n    transition: \"padding-top 0.5s ease\",\n\n    [theme.breakpoints.up(\"md\")]: {\n      marginLeft: ({ odsIframe }) => (odsIframe ? 0 : theme.spacing(8)),\n    },\n  },\n  filters: {\n    display: \"block\",\n    color: theme.palette.grey[800],\n  },\n}));\n","import { i18n } from \"@lingui/core\";\nimport { defineMessage, t } from \"@lingui/macro\";\nimport { extent, group } from \"d3-array\";\nimport { scaleLinear } from \"d3-scale\";\nimport { schemeCategory10 } from \"d3-scale-chromatic\";\nimport get from \"lodash/get\";\nimport setWith from \"lodash/setWith\";\nimport unset from \"lodash/unset\";\n\nimport { DEFAULT_SORTING, initializeMapLayerField } from \"@/charts\";\nimport {\n  DEFAULT_FIXED_COLOR_FIELD,\n  getDefaultCategoricalColorField,\n  getDefaultNumericalColorField,\n} from \"@/charts/map/constants\";\nimport {\n  checkForMissingValuesInSegments,\n  getSegment,\n  parseOptionalNumericVariable,\n  parseStringVariable,\n} from \"@/charts/shared/chart-helpers\";\nimport {\n  getStackedXScale,\n  getStackedYScale,\n} from \"@/charts/shared/stacked-helpers\";\nimport {\n  AreaConfig,\n  BarConfig,\n  ChartConfig,\n  ChartSegmentField,\n  ChartSubType,\n  ChartType,\n  ColorScaleType,\n  ColumnConfig,\n  ColumnSegmentField,\n  ComboLineColumnConfig,\n  ComboLineDualConfig,\n  ComboLineSingleConfig,\n  ComponentType,\n  fieldHasComponentId,\n  GenericField,\n  getAnimationField,\n  isSortingInConfig,\n  LineConfig,\n  MapColorField,\n  MapConfig,\n  PaletteType,\n  PieConfig,\n  ScatterPlotConfig,\n  SortingOrder,\n  SortingType,\n  TableConfig,\n} from \"@/config-types\";\nimport { makeMultiFilter } from \"@/config-utils\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport {\n  ANIMATION_ENABLED_COMPONENTS,\n  Component,\n  Dimension,\n  isNumericalMeasure,\n  isOrdinalMeasure,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  isTemporalOrdinalDimension,\n  Measure,\n  MULTI_FILTER_ENABLED_COMPONENTS,\n  Observation,\n  SEGMENT_ENABLED_COMPONENTS,\n} from \"@/domain/data\";\nimport { getDefaultCategoricalPaletteId, getPalette } from \"@/palettes\";\n\n/**\n * This module controls chart controls displayed in the UI.\n * Related to config-types.ts.\n */\n\ntype BaseEncodingFieldType = \"animation\";\ntype MapEncodingFieldType =\n  | \"baseLayer\"\n  | \"areaLayer\"\n  | \"symbolLayer\"\n  | \"customLayers\";\ntype RegularChartEncodingType = \"x\" | \"y\" | \"segment\" | \"color\";\nexport type EncodingFieldType =\n  | BaseEncodingFieldType\n  | MapEncodingFieldType\n  | RegularChartEncodingType;\n\ntype OnEncodingOptionChange<\n  V,\n  T extends ChartConfig = ChartConfig,\n  F extends GenericField = GenericField,\n> = (\n  value: V,\n  options: {\n    chartConfig: T;\n    dimensions: Dimension[];\n    measures: Measure[];\n    field: EncodingFieldType;\n    oldField: F;\n  }\n) => void;\n\nexport type EncodingOptionChartSubType<T extends ChartConfig = ChartConfig> = {\n  field: \"chartSubType\";\n  getValues: (\n    chartConfig: T,\n    dimensions: Component[]\n  ) => {\n    value: ChartSubType;\n    disabled: boolean;\n    warnMessage?: string;\n  }[];\n  onChange: OnEncodingOptionChange<ChartSubType, T>;\n};\n\nexport type EncodingOption<T extends ChartConfig = ChartConfig> =\n  | EncodingOptionChartSubType<T>\n  | {\n      field: \"calculation\";\n      getDisabledState?: (chartConfig: T) => {\n        disabled: boolean;\n        warnMessage?: string;\n      };\n    }\n  | {\n      field: \"colorPalette\";\n    }\n  | EncodingOptionColorComponent\n  | EncodingOptionImputation<T>\n  | {\n      field: \"showValues\";\n      getDisabledState?: (chartConfig: T) => {\n        disabled: boolean;\n        warnMessage?: string;\n      };\n    }\n  | {\n      field: \"adjustScaleDomain\";\n      getDefaultDomain: (options: {\n        chartConfig: T;\n        observations: Observation[];\n      }) => [number, number];\n    }\n  | {\n      field: \"convertUnit\";\n    }\n  | {\n      field: \"showStandardError\";\n    }\n  | {\n      field: \"showConfidenceInterval\";\n    }\n  | {\n      field: \"sorting\";\n    }\n  | {\n      field: \"showDots\";\n    }\n  | {\n      field: \"showDotsSize\";\n    }\n  | {\n      field: \"size\";\n      componentTypes: ComponentType[];\n      optional: boolean;\n    }\n  | {\n      field: \"useAbbreviations\";\n    }\n  // TODO: As these are quite chart type specific, they might be handled in\n  // some other way.\n  | {\n      field: \"lineAxisOrientation\";\n      onChange: OnEncodingOptionChange<\"left\" | \"right\", ComboLineColumnConfig>;\n    }\n  | {\n      field: \"componentIds\";\n      onChange: OnEncodingOptionChange<string[], ComboLineSingleConfig>;\n    }\n  | {\n      field: \"leftAxisComponentId\";\n      onChange: OnEncodingOptionChange<string, ComboLineDualConfig>;\n    }\n  | {\n      field: \"rightAxisComponentId\";\n      onChange: OnEncodingOptionChange<string, ComboLineDualConfig>;\n    }\n  | {\n      field: \"lineComponentId\";\n      onChange: OnEncodingOptionChange<string, ComboLineColumnConfig>;\n    }\n  | {\n      field: \"columnComponentId\";\n      onChange: OnEncodingOptionChange<string, ComboLineColumnConfig>;\n    };\n\nconst onColorComponentScaleTypeChange: OnEncodingOptionChange<\n  ColorScaleType,\n  MapConfig\n> = (value, { chartConfig, field }) => {\n  const basePath = `fields.${field}`;\n  const interpolationTypePath = `${basePath}.color.interpolationType`;\n  const nbClassPath = `${basePath}.color.nbClass`;\n\n  if (value === \"continuous\") {\n    setWith(chartConfig, interpolationTypePath, \"linear\", Object);\n    unset(chartConfig, nbClassPath);\n  } else if (value === \"discrete\") {\n    setWith(chartConfig, interpolationTypePath, \"jenks\", Object);\n    setWith(chartConfig, nbClassPath, 3, Object);\n  }\n};\n\nconst onColorComponentIdChange: OnEncodingOptionChange<string, MapConfig> = (\n  id,\n  { chartConfig, dimensions, measures, field }\n) => {\n  const basePath = `fields[\"${field}\"]`;\n  const components = [...dimensions, ...measures];\n  let newField: MapColorField = DEFAULT_FIXED_COLOR_FIELD;\n  const component = components.find((d) => d.id === id);\n  const currentColorComponentId = get(\n    chartConfig,\n    `${basePath}.color.componentId`\n  );\n\n  if (component) {\n    const colorPalette: PaletteType | undefined = get(\n      chartConfig,\n      `${basePath}.color.palette`\n    );\n\n    if (\n      MULTI_FILTER_ENABLED_COMPONENTS.includes(component.__typename) ||\n      isOrdinalMeasure(component)\n    ) {\n      const paletteId = getDefaultCategoricalPaletteId(\n        component,\n        colorPalette?.paletteId\n      );\n      newField = getDefaultCategoricalColorField({\n        id,\n        paletteId,\n        dimensionValues: component.values,\n      });\n    } else if (isNumericalMeasure(component)) {\n      newField = getDefaultNumericalColorField({\n        id,\n        colorPalette,\n      });\n    }\n\n    // Remove old filter.\n    const cube = chartConfig.cubes.find((d) => d.iri === component.cubeIri);\n\n    if (cube) {\n      unset(cube, `filters[\"${currentColorComponentId}\"]`);\n    }\n  }\n\n  setWith(chartConfig, `${basePath}.color`, newField, Object);\n};\n\ntype EncodingOptionColorComponent = {\n  field: \"colorComponent\";\n  optional: boolean;\n  componentTypes: ComponentType[];\n  enableUseAbbreviations: boolean;\n  onComponentIdChange: OnEncodingOptionChange<string, MapConfig>;\n  onScaleTypeChange: OnEncodingOptionChange<ColorScaleType, MapConfig>;\n};\n\ntype EncodingOptionImputation<T extends ChartConfig = ChartConfig> = {\n  field: \"imputation\";\n  shouldShow: (chartConfig: T, data: Observation[]) => boolean;\n};\n/**\n * @todo\n * - Differentiate sorting within chart vs. sorting legend / tooltip only\n */\nexport type EncodingSortingOption<T extends ChartConfig = ChartConfig> = {\n  sortingType: SortingType;\n  sortingOrder: SortingOrder[];\n  getDisabledState?: (chartConfig: T) => {\n    disabled: boolean;\n    warnMessage?: string;\n  };\n};\n\ntype OnEncodingChange<\n  T extends ChartConfig = ChartConfig,\n  F extends GenericField = GenericField,\n> = (\n  id: string,\n  options: {\n    chartConfig: T;\n    dimensions: Dimension[];\n    measures: Measure[];\n    initializing: boolean;\n    selectedValues: any[];\n    field: EncodingFieldType;\n    oldField: F;\n  }\n) => void;\n\nexport interface EncodingSpec<\n  T extends ChartConfig = ChartConfig,\n  F extends GenericField = GenericField,\n> {\n  field: EncodingFieldType;\n  optional: boolean;\n  componentTypes: ComponentType[];\n  /** Used to find component id inside the encoding. Particularly useful for fields that may contain several components. */\n  idAttributes: string[];\n  /** If true, won't use the ChartFieldOption component, but a custom one. Needs to be handled then in ChartOptionsSelector. */\n  customComponent?: boolean;\n  /** If false, using a dimension in this encoding will not prevent it to be used in an other encoding. Default: true */\n  exclusive?: boolean;\n  filters: boolean;\n  disableInteractiveFilters?: boolean;\n  sorting?: EncodingSortingOption<T>[];\n  hide?: boolean;\n  options?: {\n    [K in EncodingOption[\"field\"]]?: Omit<\n      Extract<EncodingOption<T>, { field: K }>,\n      \"field\"\n    >;\n  };\n  onChange?: OnEncodingChange<T, F>;\n  onDelete?: (options: { chartConfig: T }) => void;\n  getDisabledState?: (\n    chartConfig: T,\n    components: Component[],\n    observations: Observation[]\n  ) => {\n    disabled: boolean;\n    warnMessage?: string;\n  };\n}\n\n// dataFilters is enabled by default\ntype InteractiveFilterType = \"legend\" | \"timeRange\" | \"animation\";\n\ntype ChartSpec<T extends ChartConfig = ChartConfig> = {\n  chartType: ChartType;\n  encodings: EncodingSpec<T>[];\n  interactiveFilters: InteractiveFilterType[];\n};\n\ntype ChartSpecs = {\n  area: ChartSpec<AreaConfig>;\n  column: ChartSpec<ColumnConfig>;\n  bar: ChartSpec<BarConfig>;\n  line: ChartSpec<LineConfig>;\n  map: ChartSpec<MapConfig>;\n  pie: ChartSpec<PieConfig>;\n  scatterplot: ChartSpec<ScatterPlotConfig>;\n  table: ChartSpec<TableConfig>;\n  comboLineSingle: ChartSpec<ComboLineSingleConfig>;\n  comboLineDual: ChartSpec<ComboLineDualConfig>;\n  comboLineColumn: ChartSpec<ComboLineColumnConfig>;\n};\n\nconst getDefaultSegmentSorting = <\n  T extends ChartConfig = ChartConfig,\n>(): EncodingSortingOption<T>[] => [\n  {\n    sortingType: \"byAuto\",\n    sortingOrder: [\"asc\", \"desc\"],\n  },\n  {\n    sortingType: \"byDimensionLabel\",\n    sortingOrder: [\"asc\", \"desc\"],\n  },\n  {\n    sortingType: \"byTotalSize\",\n    sortingOrder: [\"asc\", \"desc\"],\n    getDisabledState: (\n      chartConfig\n    ): {\n      disabled: boolean;\n      warnMessage?: string;\n    } => {\n      const animationPresent = !!getAnimationField(chartConfig);\n\n      if (animationPresent) {\n        return {\n          disabled: true,\n          warnMessage: t({\n            id: \"controls.sorting.byTotalSize.disabled-by-animation\",\n            message: \"Sorting by total size is disabled during animation.\",\n          }),\n        };\n      }\n\n      return {\n        disabled: false,\n      };\n    },\n  },\n];\n\nexport const AREA_SEGMENT_SORTING = getDefaultSegmentSorting<AreaConfig>();\n\nconst LINE_SEGMENT_SORTING: EncodingSortingOption<LineConfig>[] = [\n  { sortingType: \"byAuto\", sortingOrder: [\"asc\", \"desc\"] },\n  { sortingType: \"byDimensionLabel\", sortingOrder: [\"asc\", \"desc\"] },\n];\n\nexport const COLUMN_SEGMENT_SORTING = getDefaultSegmentSorting<ColumnConfig>();\nconst BAR_SEGMENT_SORTING = getDefaultSegmentSorting<BarConfig>();\n\nexport const PIE_SEGMENT_SORTING: EncodingSortingOption<PieConfig>[] = [\n  { sortingType: \"byAuto\", sortingOrder: [\"asc\", \"desc\"] },\n  { sortingType: \"byMeasure\", sortingOrder: [\"asc\", \"desc\"] },\n  { sortingType: \"byDimensionLabel\", sortingOrder: [\"asc\", \"desc\"] },\n];\n\nexport const ANIMATION_FIELD_SPEC: EncodingSpec<\n  ColumnConfig | BarConfig | MapConfig | ScatterPlotConfig | PieConfig\n> = {\n  field: \"animation\",\n  optional: true,\n  idAttributes: [],\n  componentTypes: ANIMATION_ENABLED_COMPONENTS,\n  filters: true,\n  hide: true,\n  disableInteractiveFilters: true,\n  onChange: (id, { chartConfig, initializing }) => {\n    if (initializing || !chartConfig.fields.animation) {\n      chartConfig.fields.animation = {\n        componentId: id,\n        showPlayButton: true,\n        duration: 30,\n        type: \"continuous\",\n        dynamicScales: false,\n      };\n    } else {\n      chartConfig.fields.animation.componentId = id;\n    }\n  },\n  getDisabledState: (\n    chartConfig,\n    components\n  ): {\n    disabled: boolean;\n    warnMessage?: string;\n  } => {\n    const temporalDimensions = components.filter((d) => {\n      return (\n        isTemporalDimension(d) ||\n        isTemporalEntityDimension(d) ||\n        isTemporalOrdinalDimension(d)\n      );\n    });\n    const noTemporalDimensions = temporalDimensions.length === 0;\n\n    if (noTemporalDimensions) {\n      return {\n        disabled: true,\n        warnMessage: t({\n          id: \"controls.section.animation.no-temporal-dimensions\",\n          message: \"There is no dimension that can be animated.\",\n        }),\n      };\n    }\n\n    const fieldComponentsMap = Object.fromEntries(\n      Object.entries<GenericField>(fieldHasComponentId(chartConfig))\n        .filter((d) => d[0] !== \"animation\")\n        .map(([k, v]) => [v.componentId, k])\n    );\n    const temporalFieldComponentIds = temporalDimensions.filter((d) => {\n      return fieldComponentsMap[d.id];\n    });\n\n    if (temporalDimensions.length === temporalFieldComponentIds.length) {\n      return {\n        disabled: true,\n        warnMessage: i18n._(\n          defineMessage({\n            id: \"controls.section.animation.no-available-temporal-dimensions\",\n            message:\n              \"There are no available temporal dimensions to use. Change some of the following encodings: {fields} to enable animation.\",\n          }) as unknown as string,\n          {\n            fields: temporalFieldComponentIds\n              .map((d) => getFieldLabel(fieldComponentsMap[d.id]))\n              .join(\", \"),\n          }\n        ),\n      };\n    }\n\n    if (\n      isSortingInConfig(chartConfig) &&\n      chartConfig.fields.segment?.sorting?.sortingType === \"byTotalSize\"\n    ) {\n      return {\n        disabled: true,\n        warnMessage: t({\n          id: \"controls.section.animation.disabled-by-sorting\",\n          message: \"Animation is disabled when sorting by total size.\",\n        }),\n      };\n    }\n\n    return {\n      disabled: false,\n    };\n  },\n};\n\nconst isMissingDataPresent = (chartConfig: AreaConfig, data: Observation[]) => {\n  const { fields } = chartConfig;\n  const grouped = group(\n    data.filter((d) => {\n      const y = d[fields.y.componentId];\n      return y !== null && y !== undefined;\n    }),\n    (d) => d[fields.x.componentId] as string\n  );\n  const segments = Array.from(\n    new Set(data.map((d) => getSegment(fields.segment?.componentId)(d)))\n  );\n\n  return checkForMissingValuesInSegments(grouped, segments);\n};\n\nexport const disableStacked = (d?: Component): boolean => {\n  return d?.scaleType !== \"Ratio\";\n};\n\nexport const defaultSegmentOnChange: OnEncodingChange<\n  | AreaConfig\n  | ColumnConfig\n  | BarConfig\n  | LineConfig\n  | ScatterPlotConfig\n  | PieConfig\n  | TableConfig\n> = (id, { chartConfig, dimensions, measures, selectedValues }) => {\n  const components = [...dimensions, ...measures];\n  const component = components.find((d) => d.id === id);\n  const paletteId = getDefaultCategoricalPaletteId(\n    component,\n    chartConfig.fields.color && \"paletteId\" in chartConfig.fields.color\n      ? chartConfig.fields.color.paletteId\n      : undefined\n  );\n  const colorMapping = mapValueIrisToColor({\n    paletteId,\n    dimensionValues: component ? component.values : selectedValues,\n  });\n\n  if (chartConfig.fields.segment) {\n    (chartConfig.fields.segment as ChartSegmentField).componentId = id;\n    (chartConfig.fields.segment as ChartSegmentField).showValuesMapping = {};\n  } else {\n    chartConfig.fields.segment = {\n      componentId: id,\n      sorting: DEFAULT_SORTING,\n      showValuesMapping: {},\n    };\n    chartConfig.fields.color = {\n      type: \"segment\",\n      paletteId: paletteId,\n      colorMapping,\n    };\n  }\n\n  if (!selectedValues.length || !component) {\n    return;\n  }\n\n  const multiFilter = makeMultiFilter(selectedValues.map((d) => d.value));\n  const cube = chartConfig.cubes.find((d) => d.iri === component.cubeIri);\n\n  if (cube) {\n    cube.filters[id] = multiFilter;\n  }\n};\n\nconst onMapFieldChange: OnEncodingChange<MapConfig> = (\n  id,\n  { chartConfig, dimensions, measures, field }\n) => {\n  initializeMapLayerField({\n    chartConfig,\n    field,\n    componentId: id,\n    dimensions,\n    measures,\n  });\n};\n\nconst getNonStackedDomain = (\n  observations: Observation[],\n  getValue: (o: Observation) => number\n) => {\n  const [min, max] = extent(observations.map(getValue)) as [number, number];\n\n  return scaleLinear()\n    .domain([Math.min(min, 0), max])\n    .nice()\n    .domain() as [number, number];\n};\n\nexport const getChartSpec = <T extends ChartConfig>(\n  chartConfig: T\n): ChartSpec<T> => {\n  return chartConfigOptionsUISpec[chartConfig.chartType] as ChartSpec<T>;\n};\n\nconst chartConfigOptionsUISpec: ChartSpecs = {\n  area: {\n    chartType: \"area\",\n    encodings: [\n      {\n        field: \"y\",\n        idAttributes: [\"componentId\"],\n        optional: false,\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        onChange: (id, { chartConfig, measures }) => {\n          const yMeasure = measures.find((d) => d.id === id);\n\n          if (disableStacked(yMeasure)) {\n            delete chartConfig.fields.segment;\n          }\n        },\n        options: {\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"schemaCategory10\",\n            color: schemeCategory10[0],\n          },\n          showValues: {\n            getDisabledState: (chartConfig) => {\n              return {\n                disabled: !!chartConfig.fields.segment,\n              };\n            },\n          },\n          adjustScaleDomain: {\n            getDefaultDomain: ({ chartConfig, observations }) => {\n              const { segment } = chartConfig.fields;\n              const getX = (o: Observation) => {\n                const x = o[chartConfig.fields.x.componentId];\n                return parseStringVariable(x);\n              };\n              const getY = (o: Observation) => {\n                const y = o[chartConfig.fields.y.componentId] ?? null;\n                return parseOptionalNumericVariable(y) ?? 0;\n              };\n\n              if (segment) {\n                const yScale = getStackedYScale(observations, {\n                  normalize:\n                    chartConfig.interactiveFiltersConfig.calculation.type ===\n                    \"percent\",\n                  getX,\n                  getY,\n                });\n\n                return yScale.domain() as [number, number];\n              }\n\n              return getNonStackedDomain(observations, getY);\n            },\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        field: \"x\",\n        idAttributes: [\"componentId\"],\n        optional: false,\n        componentTypes: [\"TemporalDimension\", \"TemporalEntityDimension\"],\n        filters: true,\n      },\n      {\n        field: \"segment\",\n        optional: true,\n        idAttributes: [\"componentId\"],\n        componentTypes: SEGMENT_ENABLED_COMPONENTS,\n        filters: true,\n        sorting: AREA_SEGMENT_SORTING,\n        onChange: (id, options) => {\n          defaultSegmentOnChange(id, options);\n          delete options.chartConfig.fields.y.customDomain;\n        },\n        onDelete: ({ chartConfig }) => {\n          delete chartConfig.fields.y.customDomain;\n        },\n        getDisabledState: (chartConfig, components, data) => {\n          const yId = chartConfig.fields.y.componentId;\n          const yDimension = components.find((d) => d.id === yId);\n          const disabledStacked = disableStacked(yDimension);\n\n          if (disabledStacked) {\n            return {\n              disabled: true,\n              warnMessage: t({\n                id: \"controls.segment.stacked.disabled-by-scale-type\",\n                message:\n                  \"Stacked layout can only be enabled if the vertical axis dimension has a ratio scale.\",\n              }),\n            };\n          }\n\n          const missingDataPresent = isMissingDataPresent(chartConfig, data);\n          const imputationType = chartConfig.fields.y.imputationType;\n          const disabled = false;\n          const warnMessage =\n            missingDataPresent && (!imputationType || imputationType === \"none\")\n              ? t({\n                  id: \"controls.section.imputation.explanation\",\n                  message:\n                    \"For this chart type, replacement values should be assigned to missing values. Decide on the imputation logic or switch to another chart type.\",\n                })\n              : undefined;\n\n          return {\n            disabled,\n            warnMessage,\n          };\n        },\n        options: {\n          calculation: {},\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          imputation: {\n            shouldShow: (chartConfig, data) => {\n              return isMissingDataPresent(chartConfig, data);\n            },\n          },\n          useAbbreviations: {},\n        },\n      },\n    ],\n    interactiveFilters: [\"legend\", \"timeRange\"],\n  },\n  column: {\n    chartType: \"column\",\n    encodings: [\n      {\n        field: \"y\",\n        optional: false,\n        idAttributes: [\"componentId\"],\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        onChange: (id, { chartConfig, measures }) => {\n          if (chartConfig.fields.segment?.type === \"stacked\") {\n            const yMeasure = measures.find((d) => d.id === id);\n\n            if (disableStacked(yMeasure)) {\n              setWith(chartConfig, \"fields.segment.type\", \"grouped\", Object);\n\n              if (chartConfig.interactiveFiltersConfig.calculation) {\n                setWith(\n                  chartConfig,\n                  \"interactiveFiltersConfig.calculation\",\n                  { active: false, type: \"identity\" },\n                  Object\n                );\n              }\n            }\n          }\n        },\n        options: {\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          showValues: {\n            getDisabledState: (chartConfig) => {\n              return {\n                disabled: !!chartConfig.fields.segment,\n              };\n            },\n          },\n          showStandardError: {},\n          showConfidenceInterval: {},\n          adjustScaleDomain: {\n            getDefaultDomain: ({ chartConfig, observations }) => {\n              const { segment } = chartConfig.fields;\n              const getX = (o: Observation) => {\n                const x = o[chartConfig.fields.x.componentId];\n                return parseStringVariable(x);\n              };\n              const getY = (o: Observation) => {\n                const y = o[chartConfig.fields.y.componentId] ?? null;\n                return parseOptionalNumericVariable(y) ?? 0;\n              };\n\n              if (segment && segment.type === \"stacked\") {\n                const yScale = getStackedYScale(observations, {\n                  normalize:\n                    chartConfig.interactiveFiltersConfig.calculation.type ===\n                    \"percent\",\n                  getX,\n                  getY,\n                });\n\n                return yScale.domain() as [number, number];\n              }\n\n              return getNonStackedDomain(observations, getY);\n            },\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        field: \"x\",\n        optional: false,\n        idAttributes: [\"componentId\"],\n        componentTypes: [\n          \"TemporalDimension\",\n          \"TemporalEntityDimension\",\n          \"TemporalOrdinalDimension\",\n          \"NominalDimension\",\n          \"OrdinalDimension\",\n          \"GeoCoordinatesDimension\",\n          \"GeoShapesDimension\",\n        ],\n        filters: true,\n        sorting: [\n          { sortingType: \"byAuto\", sortingOrder: [\"asc\", \"desc\"] },\n          { sortingType: \"byMeasure\", sortingOrder: [\"asc\", \"desc\"] },\n          { sortingType: \"byDimensionLabel\", sortingOrder: [\"asc\", \"desc\"] },\n        ],\n        onChange: (id, { chartConfig, dimensions }) => {\n          const component = dimensions.find((d) => d.id === id);\n\n          if (!isTemporalDimension(component)) {\n            setWith(\n              chartConfig,\n              \"interactiveFiltersConfig.timeRange.active\",\n              false,\n              Object\n            );\n          }\n        },\n        options: {\n          useAbbreviations: {},\n        },\n      },\n      {\n        field: \"segment\",\n        optional: true,\n        idAttributes: [\"componentId\"],\n        componentTypes: SEGMENT_ENABLED_COMPONENTS,\n        filters: true,\n        sorting: COLUMN_SEGMENT_SORTING,\n        onChange: (id, options) => {\n          const { chartConfig, dimensions, measures } = options;\n          defaultSegmentOnChange(id, options);\n          chartConfig.fields.y.showValues = false;\n          delete chartConfig.fields.y.customDomain;\n\n          const components = [...dimensions, ...measures];\n          const segment: ColumnSegmentField = get(\n            chartConfig,\n            \"fields.segment\"\n          );\n          const yComponent = components.find(\n            (d) => d.id === chartConfig.fields.y.componentId\n          );\n          setWith(\n            chartConfig,\n            \"fields.segment\",\n            {\n              ...segment,\n              type: disableStacked(yComponent) ? \"grouped\" : \"stacked\",\n            },\n            Object\n          );\n        },\n        onDelete: ({ chartConfig }) => {\n          delete chartConfig.fields.y.customDomain;\n        },\n        options: {\n          calculation: {\n            getDisabledState: (chartConfig) => {\n              const grouped = chartConfig.fields.segment?.type === \"grouped\";\n\n              return {\n                disabled: grouped,\n                warnMessage: grouped\n                  ? t({\n                      id: \"controls.calculation.disabled-by-grouped\",\n                      message:\n                        \"100% mode cannot be used with a grouped layout.\",\n                    })\n                  : undefined,\n              };\n            },\n          },\n          chartSubType: {\n            getValues: (chartConfig, dimensions) => {\n              const yId = chartConfig.fields.y.componentId;\n              const yDimension = dimensions.find((d) => d.id === yId);\n              const disabledStacked = disableStacked(yDimension);\n\n              return [\n                {\n                  value: \"stacked\",\n                  disabled: disabledStacked,\n                  warnMessage: disabledStacked\n                    ? t({\n                        id: \"controls.segment.stacked.disabled-by-scale-type\",\n                        message:\n                          \"Stacked layout can only be enabled if the vertical axis dimension has a ratio scale.\",\n                      })\n                    : undefined,\n                },\n                {\n                  value: \"grouped\",\n                  disabled: false,\n                },\n              ];\n            },\n            onChange: (d, { chartConfig }) => {\n              if (chartConfig.interactiveFiltersConfig && d === \"grouped\") {\n                const path = \"interactiveFiltersConfig.calculation\";\n                setWith(chartConfig, path, { active: false, type: \"identity\" });\n              }\n            },\n          },\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          useAbbreviations: {},\n        },\n      },\n      ANIMATION_FIELD_SPEC,\n    ],\n    interactiveFilters: [\"legend\", \"timeRange\", \"animation\"],\n  },\n  bar: {\n    chartType: \"bar\",\n    encodings: [\n      {\n        field: \"x\",\n        optional: false,\n        idAttributes: [\"componentId\"],\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        onChange: (id, { chartConfig, measures }) => {\n          if (chartConfig.fields.segment?.type === \"stacked\") {\n            const xMeasure = measures.find((d) => d.id === id);\n\n            if (disableStacked(xMeasure)) {\n              setWith(chartConfig, \"fields.segment.type\", \"grouped\", Object);\n\n              if (chartConfig.interactiveFiltersConfig.calculation) {\n                setWith(\n                  chartConfig,\n                  \"interactiveFiltersConfig.calculation\",\n                  { active: false, type: \"identity\" },\n                  Object\n                );\n              }\n            }\n          }\n        },\n        options: {\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          showValues: {\n            getDisabledState: (chartConfig) => {\n              return {\n                disabled: !!chartConfig.fields.segment,\n              };\n            },\n          },\n          showStandardError: {},\n          showConfidenceInterval: {},\n          adjustScaleDomain: {\n            getDefaultDomain: ({ chartConfig, observations }) => {\n              const { segment } = chartConfig.fields;\n              const getX = (o: Observation) => {\n                const x = o[chartConfig.fields.x.componentId] ?? null;\n                return parseOptionalNumericVariable(x) ?? 0;\n              };\n              const getY = (o: Observation) => {\n                const y = o[chartConfig.fields.y.componentId];\n                return parseStringVariable(y);\n              };\n\n              if (segment && segment.type === \"stacked\") {\n                const xScale = getStackedXScale(observations, {\n                  normalize:\n                    chartConfig.interactiveFiltersConfig.calculation.type ===\n                    \"percent\",\n                  getX,\n                  getY,\n                });\n\n                return xScale.domain() as [number, number];\n              }\n\n              return getNonStackedDomain(observations, getX);\n            },\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        field: \"y\",\n        optional: false,\n        idAttributes: [\"componentId\"],\n        componentTypes: [\n          \"TemporalDimension\",\n          \"TemporalEntityDimension\",\n          \"TemporalOrdinalDimension\",\n          \"NominalDimension\",\n          \"OrdinalDimension\",\n          \"GeoCoordinatesDimension\",\n          \"GeoShapesDimension\",\n        ],\n        filters: true,\n        sorting: [\n          { sortingType: \"byAuto\", sortingOrder: [\"asc\", \"desc\"] },\n          { sortingType: \"byMeasure\", sortingOrder: [\"asc\", \"desc\"] },\n          { sortingType: \"byDimensionLabel\", sortingOrder: [\"asc\", \"desc\"] },\n        ],\n        onChange: (id, { chartConfig, dimensions }) => {\n          const component = dimensions.find((d) => d.id === id);\n\n          if (!isTemporalDimension(component)) {\n            setWith(\n              chartConfig,\n              \"interactiveFiltersConfig.timeRange.active\",\n              false,\n              Object\n            );\n          }\n        },\n        options: {\n          useAbbreviations: {},\n        },\n      },\n      {\n        field: \"segment\",\n        optional: true,\n        idAttributes: [\"componentId\"],\n        componentTypes: SEGMENT_ENABLED_COMPONENTS,\n        filters: true,\n        sorting: BAR_SEGMENT_SORTING,\n        onChange: (id, options) => {\n          const { chartConfig, dimensions, measures } = options;\n          defaultSegmentOnChange(id, options);\n          chartConfig.fields.x.showValues = false;\n          delete chartConfig.fields.x.customDomain;\n\n          const components = [...dimensions, ...measures];\n          const segment: ColumnSegmentField = get(\n            chartConfig,\n            \"fields.segment\"\n          );\n          const xComponent = components.find(\n            (d) => d.id === chartConfig.fields.x.componentId\n          );\n          setWith(\n            chartConfig,\n            \"fields.segment\",\n            {\n              ...segment,\n              type: disableStacked(xComponent) ? \"grouped\" : \"stacked\",\n            },\n            Object\n          );\n        },\n        onDelete: ({ chartConfig }) => {\n          delete chartConfig.fields.x.customDomain;\n        },\n        options: {\n          calculation: {\n            getDisabledState: (chartConfig) => {\n              const grouped = chartConfig.fields.segment?.type === \"grouped\";\n\n              return {\n                disabled: grouped,\n                warnMessage: grouped\n                  ? t({\n                      id: \"controls.calculation.disabled-by-grouped\",\n                      message:\n                        \"100% mode cannot be used with a grouped layout.\",\n                    })\n                  : undefined,\n              };\n            },\n          },\n          chartSubType: {\n            getValues: (chartConfig, dimensions) => {\n              const xId = chartConfig.fields.x.componentId;\n              const xDimension = dimensions.find((d) => d.id === xId);\n              const disabledStacked = disableStacked(xDimension);\n\n              return [\n                {\n                  value: \"stacked\",\n                  disabled: disabledStacked,\n                  warnMessage: disabledStacked\n                    ? t({\n                        id: \"controls.segment.stacked.disabled-by-scale-type\",\n                        message:\n                          \"Stacked layout can only be enabled if the vertical axis dimension has a ratio scale.\",\n                      })\n                    : undefined,\n                },\n                {\n                  value: \"grouped\",\n                  disabled: false,\n                },\n              ];\n            },\n            onChange: (d, { chartConfig }) => {\n              if (chartConfig.interactiveFiltersConfig && d === \"grouped\") {\n                const path = \"interactiveFiltersConfig.calculation\";\n                setWith(chartConfig, path, { active: false, type: \"identity\" });\n              }\n            },\n          },\n          colorPalette: {},\n          useAbbreviations: {},\n        },\n      },\n      ANIMATION_FIELD_SPEC,\n    ],\n    interactiveFilters: [\"legend\", \"timeRange\", \"animation\"],\n  },\n\n  line: {\n    chartType: \"line\",\n    encodings: [\n      {\n        idAttributes: [\"componentId\"],\n        field: \"y\",\n        optional: false,\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        options: {\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          showValues: {\n            getDisabledState: (chartConfig) => {\n              return {\n                disabled: !!chartConfig.fields.segment,\n              };\n            },\n          },\n          showStandardError: {},\n          showConfidenceInterval: {},\n          adjustScaleDomain: {\n            getDefaultDomain: ({ chartConfig, observations }) => {\n              const getY = (o: Observation) => {\n                const y = o[chartConfig.fields.y.componentId] ?? null;\n                return parseOptionalNumericVariable(y) ?? 0;\n              };\n\n              return getNonStackedDomain(observations, getY);\n            },\n          },\n          convertUnit: {},\n          showDots: {},\n          showDotsSize: {},\n        },\n      },\n      {\n        idAttributes: [\"componentId\"],\n        field: \"x\",\n        optional: false,\n        componentTypes: [\"TemporalDimension\", \"TemporalEntityDimension\"],\n        filters: true,\n      },\n      {\n        idAttributes: [\"componentId\"],\n        field: \"segment\",\n        optional: true,\n        componentTypes: SEGMENT_ENABLED_COMPONENTS,\n        filters: true,\n        sorting: LINE_SEGMENT_SORTING,\n        onChange: (id, options) => {\n          defaultSegmentOnChange(id, options);\n          delete options.chartConfig.fields.y.customDomain;\n        },\n        onDelete: ({ chartConfig }) => {\n          delete chartConfig.fields.y.customDomain;\n        },\n        options: {\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          useAbbreviations: {},\n        },\n      },\n    ],\n    interactiveFilters: [\"legend\", \"timeRange\"],\n  },\n  map: {\n    chartType: \"map\",\n    encodings: [\n      // Should this even be an encoding when it's not mapped to a component?\n      {\n        idAttributes: [],\n        field: \"baseLayer\",\n        optional: true,\n        componentTypes: [],\n        filters: false,\n      },\n      {\n        idAttributes: [\"componentId\", \"color.componentId\"],\n        field: \"areaLayer\",\n        optional: true,\n        componentTypes: [\"GeoShapesDimension\"],\n        exclusive: false,\n        filters: true,\n        onChange: onMapFieldChange,\n        options: {\n          colorComponent: {\n            componentTypes: [\n              \"NumericalMeasure\",\n              \"OrdinalMeasure\",\n              \"TemporalOrdinalDimension\",\n            ],\n            optional: false,\n            enableUseAbbreviations: true,\n            onComponentIdChange: onColorComponentIdChange,\n            onScaleTypeChange: onColorComponentScaleTypeChange,\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        idAttributes: [\"componentId\", \"color.componentId\"],\n        field: \"symbolLayer\",\n        optional: true,\n        componentTypes: [\"GeoCoordinatesDimension\", \"GeoShapesDimension\"],\n        exclusive: false,\n        filters: true,\n        onChange: onMapFieldChange,\n        options: {\n          colorComponent: {\n            componentTypes: [\n              \"NumericalMeasure\",\n              \"OrdinalMeasure\",\n              \"GeoCoordinatesDimension\",\n              \"GeoShapesDimension\",\n              \"NominalDimension\",\n              \"OrdinalDimension\",\n              \"TemporalOrdinalDimension\",\n            ],\n            optional: true,\n            enableUseAbbreviations: true,\n            onComponentIdChange: onColorComponentIdChange,\n            onScaleTypeChange: onColorComponentScaleTypeChange,\n          },\n          size: {\n            componentTypes: [\"NumericalMeasure\"],\n            optional: true,\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        idAttributes: [],\n        field: \"customLayers\",\n        optional: true,\n        componentTypes: [],\n        filters: false,\n      },\n      ANIMATION_FIELD_SPEC,\n    ],\n    interactiveFilters: [\"animation\"],\n  },\n  pie: {\n    chartType: \"pie\",\n    encodings: [\n      {\n        idAttributes: [\"componentId\"],\n        field: \"y\",\n        optional: false,\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        options: {\n          showValues: {},\n          convertUnit: {},\n        },\n      },\n      {\n        idAttributes: [\"componentId\"],\n        field: \"segment\",\n        optional: false,\n        componentTypes: SEGMENT_ENABLED_COMPONENTS,\n        filters: true,\n        sorting: PIE_SEGMENT_SORTING,\n        onChange: defaultSegmentOnChange,\n        options: {\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          useAbbreviations: {},\n        },\n      },\n      ANIMATION_FIELD_SPEC,\n    ],\n    interactiveFilters: [\"legend\", \"animation\"],\n  },\n  scatterplot: {\n    chartType: \"scatterplot\",\n    encodings: [\n      {\n        idAttributes: [\"componentId\"],\n        field: \"x\",\n        optional: false,\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        options: {\n          convertUnit: {},\n        },\n      },\n      {\n        idAttributes: [\"componentId\"],\n        field: \"y\",\n        optional: false,\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        options: {\n          convertUnit: {},\n        },\n      },\n      {\n        idAttributes: [\"componentId\"],\n        field: \"segment\",\n        optional: false,\n        componentTypes: SEGMENT_ENABLED_COMPONENTS,\n        filters: true,\n        onChange: defaultSegmentOnChange,\n        options: {\n          colorPalette: {\n            type: \"single\",\n            paletteId: \"category10\",\n            color: schemeCategory10[0],\n          },\n          useAbbreviations: {},\n        },\n      },\n      ANIMATION_FIELD_SPEC,\n    ],\n    interactiveFilters: [\"legend\", \"animation\"],\n  },\n  table: {\n    // TODO: Add abbreviations here.\n    chartType: \"table\",\n    encodings: [],\n    interactiveFilters: [],\n  },\n  comboLineSingle: {\n    chartType: \"comboLineSingle\",\n    encodings: [\n      {\n        idAttributes: [\"componentIds\"],\n        field: \"y\",\n        optional: false,\n        // TODO: maybe we should even create the components here?\n        customComponent: true,\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        options: {\n          componentIds: {\n            onChange: (ids, options) => {\n              const { chartConfig } = options;\n              const { fields } = chartConfig;\n              const { color } = fields;\n              const palette = getPalette({ paletteId: color.paletteId });\n              const newColorMapping = Object.fromEntries(\n                ids.map((id, i) => [id, color.colorMapping[i] ?? palette[i]])\n              );\n              chartConfig.fields.color.colorMapping = newColorMapping;\n            },\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        idAttributes: [\"componentId\"],\n        field: \"x\",\n        optional: false,\n        componentTypes: [\"TemporalDimension\", \"TemporalEntityDimension\"],\n        filters: true,\n      },\n    ],\n    interactiveFilters: [],\n  },\n  comboLineDual: {\n    chartType: \"comboLineDual\",\n    encodings: [\n      {\n        field: \"y\",\n        idAttributes: [\"leftAxisComponentId\", \"rightAxisComponentId\"],\n        optional: false,\n        customComponent: true,\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        options: {\n          leftAxisComponentId: {\n            onChange: (id, options) => {\n              const { chartConfig } = options;\n              const { fields } = chartConfig;\n              const { y, color } = fields;\n              chartConfig.fields.color.colorMapping = {\n                [id]: color.colorMapping[y.leftAxisComponentId],\n                [y.rightAxisComponentId]:\n                  color.colorMapping[y.rightAxisComponentId],\n              };\n            },\n          },\n          rightAxisComponentId: {\n            onChange: (id, options) => {\n              const { chartConfig } = options;\n              const { fields } = chartConfig;\n              const { y, color } = fields;\n              chartConfig.fields.color.colorMapping = {\n                [y.leftAxisComponentId]:\n                  color.colorMapping[y.leftAxisComponentId],\n                [id]: color.colorMapping[y.rightAxisComponentId],\n              };\n            },\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        idAttributes: [\"componentId\"],\n        field: \"x\",\n        optional: false,\n        componentTypes: [\"TemporalDimension\", \"TemporalEntityDimension\"],\n        filters: true,\n      },\n    ],\n    interactiveFilters: [],\n  },\n  comboLineColumn: {\n    chartType: \"comboLineColumn\",\n    encodings: [\n      {\n        field: \"y\",\n        optional: false,\n        customComponent: true,\n        idAttributes: [\"lineComponentId\", \"columnComponentId\"],\n        componentTypes: [\"NumericalMeasure\"],\n        filters: false,\n        options: {\n          lineComponentId: {\n            onChange: (id, options) => {\n              const { chartConfig } = options;\n              const { fields } = chartConfig;\n              const { y, color } = fields;\n              const lineColor = color.colorMapping[y.lineComponentId];\n              const columnColor = color.colorMapping[y.columnComponentId];\n\n              chartConfig.fields.color.colorMapping =\n                y.lineAxisOrientation === \"left\"\n                  ? { [id]: lineColor, [y.columnComponentId]: columnColor }\n                  : { [y.columnComponentId]: columnColor, [id]: lineColor };\n            },\n          },\n          columnComponentId: {\n            onChange: (id, options) => {\n              const { chartConfig } = options;\n              const { fields } = chartConfig;\n              const { y, color } = fields;\n              const columnColor = color.colorMapping[y.columnComponentId];\n              const lineColor = color.colorMapping[y.lineComponentId];\n\n              chartConfig.fields.color.colorMapping =\n                y.lineAxisOrientation === \"left\"\n                  ? { [y.lineComponentId]: lineColor, [id]: columnColor }\n                  : { [id]: columnColor, [y.lineComponentId]: lineColor };\n            },\n          },\n          lineAxisOrientation: {\n            onChange: (_, options) => {\n              const { chartConfig } = options;\n              const { fields } = chartConfig;\n              const { y, color } = fields;\n              const lineAxisLeft = y.lineAxisOrientation === \"left\";\n              // Need the correct order to not enable \"Reset color palette\" button.\n              const firstId = lineAxisLeft\n                ? y.columnComponentId\n                : y.lineComponentId;\n              const secondId = lineAxisLeft\n                ? y.lineComponentId\n                : y.columnComponentId;\n\n              chartConfig.fields.color.colorMapping = {\n                [firstId]: color.colorMapping[secondId],\n                [secondId]: color.colorMapping[firstId],\n              };\n            },\n          },\n          convertUnit: {},\n        },\n      },\n      {\n        field: \"x\",\n        idAttributes: [\"componentId\"],\n        optional: false,\n        componentTypes: [\"TemporalDimension\", \"TemporalEntityDimension\"],\n        filters: true,\n      },\n    ],\n    interactiveFilters: [],\n  },\n};\n\nexport const getChartFieldChangeSideEffect = (\n  chartConfig: ChartConfig,\n  field: EncodingFieldType\n): OnEncodingChange | undefined => {\n  const chartSpec = getChartSpec(chartConfig);\n  const encoding = chartSpec.encodings.find((d) => d.field === field);\n\n  return encoding?.onChange;\n};\n\nexport const getChartFieldDeleteSideEffect = (\n  chartConfig: ChartConfig,\n  field: EncodingFieldType\n): EncodingSpec[\"onDelete\"] | undefined => {\n  const chartSpec = getChartSpec(chartConfig);\n  const encoding = chartSpec.encodings.find((d) => d.field === field);\n\n  return encoding?.onDelete;\n};\n\nexport const getChartFieldOptionChangeSideEffect = (\n  chartConfig: ChartConfig,\n  field: EncodingFieldType,\n  path: string\n): OnEncodingOptionChange<any> | undefined => {\n  const chartSpec = getChartSpec(chartConfig);\n  const encoding = chartSpec.encodings.find((d) => d.field === field);\n\n  switch (`${field}.${path}`) {\n    case \"segment.type\":\n      return get(encoding, \"options.chartSubType.onChange\");\n    case \"areaLayer.color.componentId\":\n    case \"symbolLayer.color.componentId\":\n      return get(encoding, \"options.colorComponent.onComponentIdChange\");\n    case \"areaLayer.color.scaleType\":\n    case \"symbolLayer.color.scaleType\":\n      return get(encoding, \"options.colorComponent.onScaleTypeChange\");\n    case \"y.componentIds\":\n      return get(encoding, \"options.componentIds.onChange\");\n    case \"y.lineAxisOrientation\":\n      return get(encoding, \"options.lineAxisOrientation.onChange\");\n    case \"y.leftAxisComponentId\":\n      return get(encoding, \"options.leftAxisComponentId.onChange\");\n    case \"y.rightAxisComponentId\":\n      return get(encoding, \"options.rightAxisComponentId.onChange\");\n    case \"y.lineComponentId\":\n      return get(encoding, \"options.lineComponentId.onChange\");\n    case \"y.columnComponentId\":\n      return get(encoding, \"options.columnComponentId.onChange\");\n  }\n};\n","import { t } from \"@lingui/macro\";\nimport { ascending, descending, group, rollup, rollups } from \"d3-array\";\nimport produce from \"immer\";\nimport get from \"lodash/get\";\nimport mapValues from \"lodash/mapValues\";\nimport sortBy from \"lodash/sortBy\";\n\nimport {\n  AREA_SEGMENT_SORTING,\n  COLUMN_SEGMENT_SORTING,\n  disableStacked,\n  EncodingFieldType,\n  PIE_SEGMENT_SORTING,\n} from \"@/charts/chart-config-ui-options\";\nimport {\n  DEFAULT_FIXED_COLOR_FIELD,\n  getDefaultCategoricalColorField,\n  getDefaultNumericalColorField,\n} from \"@/charts/map/constants\";\nimport {\n  ChartConfigsAdjusters,\n  FieldAdjuster,\n  InteractiveFiltersAdjusters,\n} from \"@/config-adjusters\";\nimport {\n  AreaSegmentField,\n  canBeNormalized,\n  ChartConfig,\n  ChartSegmentField,\n  ChartType,\n  ColorField,\n  ColumnSegmentField,\n  ComboChartType,\n  ComboLineColumnFields,\n  ComboLineSingleFields,\n  Cube,\n  Filters,\n  GenericChartConfig,\n  GenericField,\n  GenericFields,\n  InteractiveFiltersConfig,\n  isColorInConfig,\n  isSegmentInConfig,\n  LineSegmentField,\n  MapAreaLayer,\n  MapConfig,\n  MapSymbolLayer,\n  MeasuresColorField,\n  Meta,\n  PieSegmentField,\n  RegularChartType,\n  ScatterPlotSegmentField,\n  SegmentColorField,\n  ShowValuesSegmentFieldExtension,\n  SingleColorField,\n  SortingOrder,\n  SortingType,\n  TableColumn,\n  TableFields,\n} from \"@/config-types\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport {\n  Component,\n  Dimension,\n  DimensionType,\n  DimensionValue,\n  GeoCoordinatesDimension,\n  GeoShapesDimension,\n  getCategoricalDimensions,\n  getGeoDimensions,\n  HierarchyValue,\n  isGeoDimension,\n  isGeoShapesDimension,\n  isNumericalMeasure,\n  isOrdinalMeasure,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  Measure,\n  NumericalMeasure,\n  SEGMENT_ENABLED_COMPONENTS,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport {\n  DEFAULT_CATEGORICAL_PALETTE_ID,\n  getDefaultCategoricalPaletteId,\n} from \"@/palettes\";\nimport { theme } from \"@/themes/theme\";\nimport { bfs } from \"@/utils/bfs\";\nimport { CHART_CONFIG_VERSION } from \"@/utils/chart-config/constants\";\nimport { createId } from \"@/utils/create-id\";\nimport { isMultiHierarchyNode } from \"@/utils/hierarchy\";\nimport { unreachableError } from \"@/utils/unreachable\";\n\nconst chartTypes: ChartType[] = [\n  \"column\",\n  \"bar\",\n  \"line\",\n  \"area\",\n  \"scatterplot\",\n  \"pie\",\n  \"table\",\n  \"map\",\n  \"comboLineSingle\",\n  \"comboLineDual\",\n  \"comboLineColumn\",\n];\n\nexport const regularChartTypes: RegularChartType[] = [\n  \"column\",\n  \"bar\",\n  \"line\",\n  \"area\",\n  \"scatterplot\",\n  \"pie\",\n  \"table\",\n  \"map\",\n];\n\nconst comboDifferentUnitChartTypes: ComboChartType[] = [\n  \"comboLineDual\",\n  \"comboLineColumn\",\n];\n\nconst comboSameUnitChartTypes: ComboChartType[] = [\"comboLineSingle\"];\n\nexport const comboChartTypes: ComboChartType[] = [\n  ...comboSameUnitChartTypes,\n  ...comboDifferentUnitChartTypes,\n];\n\ntype ChartOrder = { [k in ChartType]: number };\nfunction getChartTypeOrder({ cubeCount }: { cubeCount: number }): ChartOrder {\n  const multiCubeBoost = cubeCount > 1 ? -100 : 0;\n  return {\n    column: 0,\n    bar: 1,\n    line: 2,\n    area: 3,\n    scatterplot: 4,\n    pie: 5,\n    map: 6,\n    table: 7,\n    comboLineSingle: 8 + multiCubeBoost,\n    comboLineDual: 9 + multiCubeBoost,\n    comboLineColumn: 10 + multiCubeBoost,\n  };\n}\n\n/**\n * Finds the \"best\" dimension based on a preferred type (e.g. TemporalDimension) and Key Dimension\n *\n * @param dimensions\n * @param preferredType\n */\nconst findPreferredDimension = (\n  dimensions: Component[],\n  preferredTypes?: DimensionType[]\n) => {\n  const dim =\n    preferredTypes\n      ?.map((preferredType) =>\n        dimensions.find(\n          (d) => d.__typename === preferredType && d.isKeyDimension\n        )\n      )\n      .filter(truthy)[0] ??\n    dimensions.find((d) => d.isKeyDimension) ??\n    dimensions[0];\n\n  if (!dim) {\n    throw Error(\"No dimension found for initial config\");\n  }\n\n  return dim;\n};\n\nconst getInitialInteractiveFiltersConfig = (options?: {\n  timeRangeComponentId?: string;\n}): InteractiveFiltersConfig => {\n  const { timeRangeComponentId = \"\" } = options ?? {};\n\n  return {\n    legend: {\n      active: false,\n      componentId: \"\",\n    },\n    timeRange: {\n      active: false,\n      componentId: timeRangeComponentId,\n      presets: {\n        type: \"range\",\n        from: \"\",\n        to: \"\",\n      },\n    },\n    dataFilters: {\n      active: false,\n      componentIds: [],\n      defaultValueOverrides: {},\n      filterTypes: {},\n      defaultOpen: true,\n    },\n    calculation: {\n      active: false,\n      type: \"identity\",\n    },\n  };\n};\n\ntype SortingOption = {\n  sortingType: SortingType;\n  sortingOrder: SortingOrder;\n};\n\nexport const DEFAULT_SORTING: SortingOption = {\n  sortingType: \"byAuto\",\n  sortingOrder: \"asc\",\n};\n\n/**\n * Finds bottommost layer for the first hierarchy\n */\nconst findBottommostLayers = (dimension: Dimension) => {\n  const leaves = [] as HierarchyValue[];\n  let hasSeenMultiHierarchyNode = false;\n  bfs(dimension?.hierarchy as HierarchyValue[], (node) => {\n    if (isMultiHierarchyNode(node)) {\n      if (hasSeenMultiHierarchyNode) {\n        return bfs.IGNORE;\n      }\n\n      hasSeenMultiHierarchyNode = true;\n    }\n\n    if ((!node.children || node.children.length === 0) && node.hasValue) {\n      leaves.push(node);\n    }\n  });\n\n  return leaves;\n};\n\nconst makeInitialFiltersForArea = (dimension: Dimension) => {\n  const filters: Filters = {};\n\n  // Setting the filters so that bottommost areas are shown first\n  // @ts-ignore\n  if (dimension?.hierarchy) {\n    const leaves = findBottommostLayers(dimension);\n    if (leaves.length > 0) {\n      filters[dimension.id] = {\n        type: \"multi\",\n        values: Object.fromEntries(leaves.map((x) => [x.value, true])),\n      };\n    }\n  }\n\n  return filters;\n};\n\nexport const initializeMapLayerField = ({\n  chartConfig,\n  field,\n  componentId,\n  dimensions,\n  measures,\n}: {\n  chartConfig: MapConfig;\n  field: EncodingFieldType;\n  componentId: string;\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  if (field === \"areaLayer\") {\n    chartConfig.fields.areaLayer = getInitialAreaLayer({\n      component: dimensions\n        .filter(isGeoShapesDimension)\n        .find((d) => d.id === componentId)!,\n      measure: measures[0],\n    });\n  } else if (field === \"symbolLayer\") {\n    chartConfig.fields.symbolLayer = getInitialSymbolLayer({\n      component: dimensions\n        .filter(isGeoDimension)\n        .find((d) => d.id === componentId)!,\n      measure: measures.find(isNumericalMeasure),\n    });\n  }\n};\n\nconst getInitialAreaLayer = ({\n  component,\n  measure,\n}: {\n  component: GeoShapesDimension;\n  measure: Measure;\n}): MapAreaLayer => {\n  const paletteId = getDefaultCategoricalPaletteId(measure);\n\n  return {\n    componentId: component.id,\n    color: isNumericalMeasure(measure)\n      ? getDefaultNumericalColorField({\n          id: measure.id,\n        })\n      : getDefaultCategoricalColorField({\n          id: measure.id,\n          paletteId,\n          dimensionValues: measure.values,\n        }),\n  };\n};\n\nconst getInitialSymbolLayer = ({\n  component,\n  measure,\n}: {\n  component: GeoShapesDimension | GeoCoordinatesDimension;\n  measure: NumericalMeasure | undefined;\n}): MapSymbolLayer => {\n  return {\n    componentId: component.id,\n    measureId: measure?.id ?? FIELD_VALUE_NONE,\n    color: DEFAULT_FIXED_COLOR_FIELD,\n  };\n};\n\nconst META: Meta = {\n  title: {\n    en: \"\",\n    de: \"\",\n    fr: \"\",\n    it: \"\",\n  },\n  description: {\n    en: \"\",\n    de: \"\",\n    fr: \"\",\n    it: \"\",\n  },\n  label: {\n    en: \"\",\n    de: \"\",\n    fr: \"\",\n    it: \"\",\n  },\n};\n\ntype GetInitialConfigOptions = {\n  key?: string;\n  iris: {\n    iri: string;\n    joinBy?: string[];\n  }[];\n  chartType: ChartType;\n  dimensions: Dimension[];\n  measures: Measure[];\n  meta?: Meta;\n};\n\nexport const getInitialConfig = (\n  options: GetInitialConfigOptions\n): ChartConfig => {\n  const { key, iris, chartType, dimensions, measures, meta } = options;\n  const getGenericConfig = (filters?: Filters): GenericChartConfig => {\n    const newConfig = {\n      key: key ?? createId(),\n      version: CHART_CONFIG_VERSION,\n      meta: meta ?? META,\n      // Technically, we should scope filters per cube; but as we only set initial\n      // filters for area charts, and we can only have multi-cubes for combo charts,\n      // we can ignore the filters scoping for now.\n      cubes: iris.map(({ iri, joinBy }) => {\n        if (joinBy) {\n          return {\n            iri,\n            filters: filters ?? {},\n            joinBy,\n          };\n        } else {\n          // We need to completely remove the joinBy if not needed to prevent\n          // implicit conversion to null when saving / retrieving the config\n          // from the backend.\n          return {\n            iri,\n            filters: filters ?? {},\n          };\n        }\n      }),\n      interactiveFiltersConfig: getInitialInteractiveFiltersConfig(),\n      annotations: [],\n      limits: {},\n      conversionUnitsByComponentId: {},\n      activeField: undefined,\n    };\n\n    return newConfig;\n  };\n  const numericalMeasures = measures.filter(isNumericalMeasure);\n  const temporalDimensions = dimensions.filter(\n    (d) => isTemporalDimension(d) || isTemporalEntityDimension(d)\n  );\n\n  switch (chartType) {\n    case \"area\":\n      const areaXComponentId = temporalDimensions[0].id;\n\n      return {\n        ...getGenericConfig(),\n        chartType,\n        interactiveFiltersConfig: getInitialInteractiveFiltersConfig({\n          timeRangeComponentId: areaXComponentId,\n        }),\n        fields: {\n          x: { componentId: areaXComponentId },\n          y: { componentId: numericalMeasures[0].id, imputationType: \"none\" },\n          color: {\n            type: \"single\",\n            paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n            color: theme.palette.primary.main,\n          },\n        },\n      };\n\n    case \"column\":\n      const columnXComponentId = findPreferredDimension(\n        sortBy(dimensions, (d) => (isGeoDimension(d) ? 1 : -1)),\n        [\n          \"TemporalDimension\",\n          \"TemporalEntityDimension\",\n          \"TemporalOrdinalDimension\",\n        ]\n      ).id;\n\n      return {\n        ...getGenericConfig(),\n        chartType,\n        interactiveFiltersConfig: getInitialInteractiveFiltersConfig({\n          timeRangeComponentId: columnXComponentId,\n        }),\n        fields: {\n          x: {\n            componentId: columnXComponentId,\n            sorting: DEFAULT_SORTING,\n          },\n          y: { componentId: numericalMeasures[0].id },\n          color: {\n            type: \"single\",\n            paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n            color: theme.palette.primary.main,\n          },\n        },\n      };\n\n    case \"bar\":\n      const barXComponentId = findPreferredDimension(\n        sortBy(dimensions, (d) => (isGeoDimension(d) ? 1 : -1)),\n        [\n          \"TemporalDimension\",\n          \"TemporalEntityDimension\",\n          \"TemporalOrdinalDimension\",\n        ]\n      ).id;\n\n      return {\n        ...getGenericConfig(),\n        chartType,\n        interactiveFiltersConfig: getInitialInteractiveFiltersConfig({\n          timeRangeComponentId: barXComponentId,\n        }),\n        fields: {\n          x: { componentId: numericalMeasures[0].id },\n          y: {\n            componentId: barXComponentId,\n            sorting: DEFAULT_SORTING,\n          },\n          color: {\n            type: \"single\",\n            paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n            color: theme.palette.primary.main,\n          },\n        },\n      };\n    case \"line\":\n      const lineXComponentId = temporalDimensions[0].id;\n\n      return {\n        ...getGenericConfig(),\n        chartType,\n        interactiveFiltersConfig: getInitialInteractiveFiltersConfig({\n          timeRangeComponentId: lineXComponentId,\n        }),\n        fields: {\n          x: { componentId: lineXComponentId },\n          y: { componentId: numericalMeasures[0].id },\n          color: {\n            type: \"single\",\n            paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n            color: theme.palette.primary.main,\n          },\n        },\n      };\n    case \"map\":\n      const geoDimensions = getGeoDimensions(dimensions);\n      const geoShapesDimensions = geoDimensions.filter(isGeoShapesDimension);\n      const areaDimension = geoShapesDimensions[0];\n      const showAreaLayer = geoShapesDimensions.length > 0;\n      const showSymbolLayer = !showAreaLayer;\n\n      return {\n        ...getGenericConfig(makeInitialFiltersForArea(areaDimension)),\n        chartType,\n        baseLayer: {\n          show: true,\n          locked: false,\n          bbox: undefined,\n          customLayers: [],\n        },\n        fields: {\n          ...(showAreaLayer\n            ? {\n                areaLayer: getInitialAreaLayer({\n                  component: areaDimension,\n                  measure: measures[0],\n                }),\n              }\n            : {}),\n          ...(showSymbolLayer\n            ? {\n                symbolLayer: getInitialSymbolLayer({\n                  component: geoDimensions[0],\n                  measure: numericalMeasures[0],\n                }),\n              }\n            : {}),\n        },\n      };\n    case \"pie\":\n      const pieSegmentComponent =\n        getCategoricalDimensions(dimensions)[0] ??\n        getGeoDimensions(dimensions)[0];\n      const piePalette = getDefaultCategoricalPaletteId(pieSegmentComponent);\n\n      return {\n        ...getGenericConfig(),\n        chartType,\n        fields: {\n          y: { componentId: numericalMeasures[0].id },\n          segment: {\n            componentId: pieSegmentComponent.id,\n            sorting: { sortingType: \"byMeasure\", sortingOrder: \"asc\" },\n            showValuesMapping: {},\n          },\n          color: {\n            type: \"segment\",\n            paletteId: piePalette,\n            colorMapping: mapValueIrisToColor({\n              paletteId: piePalette,\n              dimensionValues: pieSegmentComponent.values,\n            }),\n          },\n        },\n      };\n    case \"scatterplot\":\n      const scatterplotSegmentComponent =\n        getCategoricalDimensions(dimensions)[0] ||\n        getGeoDimensions(dimensions)[0];\n      const scatterplotPalette = getDefaultCategoricalPaletteId(\n        scatterplotSegmentComponent\n      );\n\n      return {\n        ...getGenericConfig(),\n        chartType: \"scatterplot\",\n        fields: {\n          x: { componentId: numericalMeasures[0].id },\n          y: {\n            componentId:\n              numericalMeasures.length > 1\n                ? numericalMeasures[1].id\n                : numericalMeasures[0].id,\n          },\n          ...(scatterplotSegmentComponent\n            ? {\n                color: {\n                  type: \"segment\",\n                  paletteId: scatterplotPalette,\n                  colorMapping: mapValueIrisToColor({\n                    paletteId: scatterplotPalette,\n                    dimensionValues: scatterplotSegmentComponent.values,\n                  }),\n                },\n                segment: {\n                  componentId: scatterplotSegmentComponent.id,\n                  showValuesMapping: {},\n                },\n              }\n            : {\n                color: {\n                  type: \"single\",\n                  paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n                  color: theme.palette.primary.main,\n                },\n              }),\n        },\n      };\n    case \"table\":\n      const allDimensionsSorted = [...dimensions, ...measures].sort((a, b) =>\n        ascending(a.order ?? Infinity, b.order ?? Infinity)\n      );\n\n      return {\n        ...getGenericConfig(),\n        chartType,\n        settings: {\n          showSearch: true,\n          showAllRows: false,\n        },\n        links: {\n          enabled: false,\n          baseUrl: \"\",\n          componentId: \"\",\n          targetComponentId: \"\",\n        },\n        sorting: [],\n        fields: Object.fromEntries<TableColumn>(\n          allDimensionsSorted.map((d, i) => [\n            d.id,\n            {\n              componentId: d.id,\n              componentType: d.__typename,\n              index: i,\n              isGroup: false,\n              isHidden: false,\n              columnStyle: {\n                textStyle: \"regular\",\n                type: \"text\",\n                textColor: theme.palette.monochrome[600],\n                columnColor: \"#fff\",\n              },\n            },\n          ])\n        ) as TableFields,\n      };\n    case \"comboLineSingle\": {\n      // It's guaranteed by getEnabledChartTypes that there are at least two units.\n      const mostCommonUnit = rollups(\n        numericalMeasures.filter((d) => d.unit),\n        (v) => v.length,\n        (d) => d.unit\n      ).sort((a, b) => descending(a[1], b[1]))[0][0];\n      const yComponentIds = numericalMeasures\n        .filter((d) => d.unit === mostCommonUnit)\n        .map((d) => d.id);\n\n      return {\n        ...getGenericConfig(),\n        chartType: \"comboLineSingle\",\n        interactiveFiltersConfig: getInitialInteractiveFiltersConfig({\n          timeRangeComponentId: temporalDimensions[0].id,\n        }),\n        fields: {\n          x: { componentId: temporalDimensions[0].id },\n          // Use all measures with the most common unit.\n          y: {\n            componentIds: yComponentIds,\n          },\n          color: {\n            type: \"measures\",\n            paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n            colorMapping: mapValueIrisToColor({\n              paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n              dimensionValues: yComponentIds.map((id) => ({\n                value: id,\n                label: id,\n              })) as DimensionValue[],\n            }),\n          },\n        },\n      };\n    }\n    case \"comboLineDual\": {\n      // It's guaranteed by getEnabledChartTypes that there are at least two units.\n      const [firstUnit, secondUnit] = Array.from(\n        new Set(numericalMeasures.filter((d) => d.unit).map((d) => d.unit))\n      );\n      const leftAxisComponentId = numericalMeasures.find(\n        (d) => d.unit === firstUnit\n      )!.id;\n      const rightAxisComponentId = numericalMeasures.find(\n        (d) => d.unit === secondUnit\n      )!.id;\n\n      return {\n        ...getGenericConfig(),\n        chartType: \"comboLineDual\",\n        interactiveFiltersConfig: getInitialInteractiveFiltersConfig({\n          timeRangeComponentId: temporalDimensions[0].id,\n        }),\n        fields: {\n          x: { componentId: temporalDimensions[0].id },\n          y: {\n            leftAxisComponentId,\n            rightAxisComponentId,\n          },\n          color: {\n            type: \"measures\",\n            paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n            colorMapping: mapValueIrisToColor({\n              paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n              dimensionValues: [leftAxisComponentId, rightAxisComponentId].map(\n                (id) => ({\n                  value: id,\n                  label: id,\n                })\n              ),\n            }),\n          },\n        },\n      };\n    }\n    case \"comboLineColumn\": {\n      // It's guaranteed by getEnabledChartTypes that there are at least two units.\n      const [firstUnit, secondUnit] = Array.from(\n        new Set(numericalMeasures.filter((d) => d.unit).map((d) => d.unit))\n      );\n      const lineComponentId = numericalMeasures.find(\n        (d) => d.unit === firstUnit\n      )!.id;\n      const columnComponentId = numericalMeasures.find(\n        (d) => d.unit === secondUnit\n      )!.id;\n\n      return {\n        ...getGenericConfig(),\n        chartType: \"comboLineColumn\",\n        interactiveFiltersConfig: getInitialInteractiveFiltersConfig({\n          timeRangeComponentId: temporalDimensions[0].id,\n        }),\n        fields: {\n          x: { componentId: temporalDimensions[0].id },\n          y: {\n            lineComponentId,\n            lineAxisOrientation: \"right\",\n            columnComponentId,\n          },\n          color: {\n            type: \"measures\",\n            paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n            colorMapping: mapValueIrisToColor({\n              paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n              dimensionValues: [lineComponentId, columnComponentId].map(\n                (id) => ({\n                  value: id,\n                  label: id,\n                })\n              ),\n            }),\n          },\n        },\n      };\n    }\n\n    // This code *should* be unreachable! If it's not, it means we haven't checked\n    // all cases (and we should get a TS error).\n    default:\n      throw unreachableError(chartType);\n  }\n};\n\nexport const getChartConfigAdjustedToChartType = ({\n  chartConfig,\n  newChartType,\n  dimensions,\n  measures,\n  isAddingNewCube,\n}: {\n  chartConfig: ChartConfig;\n  newChartType: ChartType;\n  dimensions: Dimension[];\n  measures: Measure[];\n  isAddingNewCube?: boolean;\n}): ChartConfig => {\n  const oldChartType = chartConfig.chartType;\n  const initialConfig = getInitialConfig({\n    key: chartConfig.key,\n    chartType: newChartType,\n    iris: chartConfig.cubes.map(({ iri }) => ({ iri })),\n    dimensions,\n    measures,\n    meta: chartConfig.meta,\n  });\n  const { interactiveFiltersConfig, ...rest } = chartConfig;\n\n  return getAdjustedChartConfig({\n    path: \"\",\n    // Make sure interactiveFiltersConfig is passed as the last item, so that\n    // it can be adjusted based on other, already adjusted fields.\n    field: {\n      ...rest,\n      interactiveFiltersConfig,\n    },\n    adjusters: chartConfigsAdjusters[newChartType],\n    pathOverrides: chartConfigsPathOverrides[newChartType][oldChartType],\n    oldChartConfig: chartConfig,\n    newChartConfig: initialConfig,\n    dimensions,\n    measures,\n    isAddingNewCube,\n  });\n};\n\nconst getAdjustedChartConfig = ({\n  path,\n  field,\n  adjusters,\n  pathOverrides,\n  oldChartConfig,\n  newChartConfig,\n  dimensions,\n  measures,\n  isAddingNewCube,\n}: {\n  path: string;\n  field: Object;\n  adjusters: ChartConfigAdjusters;\n  pathOverrides: ChartConfigPathOverrides;\n  oldChartConfig: ChartConfig;\n  newChartConfig: ChartConfig;\n  dimensions: Dimension[];\n  measures: Measure[];\n  isAddingNewCube?: boolean;\n}) => {\n  // For filters & segments we can't reach a primitive level as we need to\n  // pass the whole object. Table fields have an [id: TableColumn] structure,\n  // so we also pass a whole field in such case (used in segments).\n  const isConfigLeaf = (path: string, configValue: any) => {\n    if (typeof configValue !== \"object\" || Array.isArray(configValue)) {\n      return true;\n    }\n\n    switch (path) {\n      case \"fields\":\n        return (\n          oldChartConfig.chartType === \"table\" &&\n          isSegmentInConfig(newChartConfig)\n        );\n      case \"filters\":\n      case \"fields.color\":\n      case \"fields.segment\":\n      case \"fields.animation\":\n      case \"interactiveFiltersConfig.calculation\":\n      case \"interactiveFiltersConfig.dataFilters\":\n      case \"interactiveFiltersConfig.legend\":\n      case \"limits\":\n      case \"conversionUnitsByComponentId\":\n        return true;\n      default:\n        return false;\n    }\n  };\n\n  const go = ({ path, field }: { path: string; field: Object }) => {\n    for (const [k, v] of Object.entries(field)) {\n      const newPath = path === \"\" ? k : `${path}.${k}`;\n\n      if (v !== undefined) {\n        const overrides = pathOverrides?.[newPath];\n\n        if (isConfigLeaf(newPath, v) || overrides) {\n          if (overrides) {\n            for (const override of overrides) {\n              const getChartConfigWithAdjustedField: FieldAdjuster<\n                ChartConfig,\n                unknown\n              > = get(adjusters, override.path);\n\n              if (getChartConfigWithAdjustedField) {\n                newChartConfig = getChartConfigWithAdjustedField({\n                  oldValue: override.oldValue ? override.oldValue(v) : v,\n                  newChartConfig,\n                  oldChartConfig,\n                  dimensions,\n                  measures,\n                  isAddingNewCube,\n                });\n              }\n            }\n          } else {\n            const getChartConfigWithAdjustedField: FieldAdjuster<\n              ChartConfig,\n              unknown\n            > = get(adjusters, newPath);\n\n            if (getChartConfigWithAdjustedField) {\n              newChartConfig = getChartConfigWithAdjustedField({\n                oldValue: v,\n                newChartConfig,\n                oldChartConfig,\n                dimensions,\n                measures,\n                isAddingNewCube,\n              });\n            }\n          }\n        } else {\n          go({ path: newPath, field: v });\n        }\n      }\n    }\n\n    return newChartConfig;\n  };\n\n  return go({ path, field });\n};\n\nconst interactiveFiltersAdjusters: InteractiveFiltersAdjusters = {\n  legend: ({ oldValue, oldChartConfig, newChartConfig }) => {\n    if ((oldChartConfig.fields as any).segment !== undefined) {\n      return produce(newChartConfig, (draft) => {\n        draft.interactiveFiltersConfig.legend = oldValue;\n      });\n    }\n\n    return newChartConfig;\n  },\n  timeRange: {\n    active: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.interactiveFiltersConfig.timeRange.active = oldValue;\n      });\n    },\n    componentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.interactiveFiltersConfig.timeRange.componentId = oldValue;\n      });\n    },\n    presets: {\n      type: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          draft.interactiveFiltersConfig.timeRange.presets.type = oldValue;\n        });\n      },\n      from: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          draft.interactiveFiltersConfig.timeRange.presets.from = oldValue;\n        });\n      },\n      to: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          draft.interactiveFiltersConfig.timeRange.presets.to = oldValue;\n        });\n      },\n    },\n  },\n  dataFilters: ({ oldValue, newChartConfig, oldChartConfig }) => {\n    return produce(newChartConfig, (draft) => {\n      const oldComponentIds = oldValue.componentIds ?? [];\n\n      // Do not migrate filters from table, as they have different types anyway.\n      if (oldChartConfig.chartType === \"table\") {\n        draft.interactiveFiltersConfig.dataFilters = {\n          active: false,\n          componentIds: [],\n          defaultValueOverrides: {},\n          defaultOpen: true,\n          filterTypes: {},\n        };\n        return;\n      }\n\n      if (oldComponentIds.length > 0) {\n        const fieldComponentIds = Object.values<GenericField>(\n          // @ts-ignore - we are only interested in component ids.\n          draft.fields\n        ).map((d) => d.componentId);\n        // Remove component ids that are not in the new chart config, as they\n        // can't be used as interactive data filters then.\n        const validComponentIds = oldComponentIds.filter(\n          (d) => !fieldComponentIds.includes(d)\n        );\n\n        const newDefaultValueOverrides = {\n          ...oldValue.defaultValueOverrides,\n        };\n        const removedComponentIds = oldComponentIds.filter(\n          (d) => !validComponentIds.includes(d)\n        );\n        removedComponentIds.forEach((id) => {\n          delete newDefaultValueOverrides[id];\n        });\n\n        draft.interactiveFiltersConfig.dataFilters.active =\n          validComponentIds.length > 0;\n        draft.interactiveFiltersConfig.dataFilters.componentIds =\n          validComponentIds;\n        draft.interactiveFiltersConfig.dataFilters.defaultValueOverrides =\n          newDefaultValueOverrides;\n      } else {\n        draft.interactiveFiltersConfig.dataFilters = oldValue;\n      }\n    });\n  },\n  calculation: ({ oldValue, newChartConfig }) => {\n    return produce(newChartConfig, (draft) => {\n      if (canBeNormalized(newChartConfig)) {\n        draft.interactiveFiltersConfig.calculation = oldValue;\n      } else {\n        draft.interactiveFiltersConfig.calculation = {\n          active: false,\n          type: \"identity\",\n        };\n      }\n    });\n  },\n};\n\nconst chartConfigsAdjusters: ChartConfigsAdjusters = {\n  column: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          // When switching from a bar chart or scatterplot, x is a measure.\n          if (dimensions.find((d) => d.id === oldValue)) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.x.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n      },\n      y: {\n        componentId: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.componentId = oldValue;\n          });\n        },\n        showValues: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.showValues = oldValue;\n          });\n        },\n        customDomain: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.customDomain = oldValue;\n          });\n        },\n      },\n      color: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          // Segment color type is migrated in tandem with the segment field below.\n          if (oldValue.type !== \"segment\") {\n            draft.fields.color = getSingleColorField({\n              oldColorField: oldValue,\n            });\n          }\n        });\n      },\n      segment: ({\n        oldValue,\n        oldChartConfig,\n        newChartConfig,\n        dimensions,\n        measures,\n      }) => {\n        let newSegment: ColumnSegmentField;\n        let newColor: ColorField;\n\n        const yMeasure = measures.find(\n          (d) => d.id === newChartConfig.fields.y.componentId\n        );\n\n        // When switching from a table chart, a whole fields object is passed as oldValue.\n        if (oldChartConfig.chartType === \"table\") {\n          const maybeSegmentAndColorFields =\n            convertTableFieldsToSegmentAndColorFields({\n              fields: oldValue as TableFields,\n              dimensions,\n              measures,\n            });\n\n          if (maybeSegmentAndColorFields) {\n            newSegment = {\n              ...maybeSegmentAndColorFields.segment,\n              sorting: DEFAULT_SORTING,\n              type: disableStacked(yMeasure) ? \"grouped\" : \"stacked\",\n              showValuesMapping: {},\n            };\n            newColor = maybeSegmentAndColorFields.color;\n          }\n          // Otherwise we are dealing with a segment field. We shouldn't take\n          // the segment from oldValue if the component has already been used as\n          // x axis.\n        } else if (\n          newChartConfig.fields.x.componentId !== oldValue.componentId\n        ) {\n          const oldSegment = oldValue as Exclude<typeof oldValue, TableFields>;\n          const oldColor: ColorField | undefined = isColorInConfig(\n            oldChartConfig\n          )\n            ? oldChartConfig.fields.color\n            : undefined;\n          const segmentDimension = dimensions.find(\n            (d) => d.id === oldValue.componentId\n          );\n          newSegment = {\n            ...oldSegment,\n            showValuesMapping: oldSegment.showValuesMapping ?? {},\n            // We could encounter byMeasure sorting type (Pie chart); we should\n            // switch to byTotalSize sorting then.\n            sorting: adjustSegmentSorting({\n              segment: oldSegment,\n              acceptedValues: COLUMN_SEGMENT_SORTING.map((d) => d.sortingType),\n              defaultValue: \"byTotalSize\",\n            }),\n            type: disableStacked(yMeasure) ? \"grouped\" : \"stacked\",\n          };\n          newColor = getSegmentColorField({\n            oldColorField: oldColor,\n            segmentDimension,\n          });\n        }\n\n        return produce(newChartConfig, (draft) => {\n          if (newSegment && newColor?.type === \"segment\") {\n            draft.fields.segment = newSegment;\n            draft.fields.color = newColor;\n          }\n        });\n      },\n      animation: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          // Temporal dimension could be used as X axis, in this case we need to\n          // remove the animation.\n          if (newChartConfig.fields.x.componentId !== oldValue?.componentId) {\n            draft.fields.animation = oldValue;\n          }\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  bar: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, measures }) => {\n          if (measures.find((d) => d.id === oldValue)) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.x.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n        showValues: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.x.showValues = oldValue;\n          });\n        },\n        customDomain: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.x.customDomain = oldValue;\n          });\n        },\n      },\n      y: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          // For most charts, y is a measure.\n          if (dimensions.find((d) => d.id === oldValue)) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.y.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n      },\n      color: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          // Segment color type is migrated in tandem with the segment field below.\n          if (oldValue.type !== \"segment\") {\n            draft.fields.color = getSingleColorField({\n              oldColorField: oldValue,\n            });\n          }\n        });\n      },\n      segment: ({\n        oldValue,\n        oldChartConfig,\n        newChartConfig,\n        dimensions,\n        measures,\n      }) => {\n        let newSegment: ColumnSegmentField;\n        let newColor: ColorField;\n\n        const xMeasure = measures.find(\n          (d) => d.id === newChartConfig.fields.x.componentId\n        );\n\n        // When switching from a table chart, a whole fields object is passed as oldValue.\n        if (oldChartConfig.chartType === \"table\") {\n          const maybeSegmentAndColorFields =\n            convertTableFieldsToSegmentAndColorFields({\n              fields: oldValue as TableFields,\n              dimensions,\n              measures,\n            });\n\n          if (maybeSegmentAndColorFields) {\n            newSegment = {\n              ...maybeSegmentAndColorFields.segment,\n              sorting: DEFAULT_SORTING,\n              type: disableStacked(xMeasure) ? \"grouped\" : \"stacked\",\n            };\n            newColor = maybeSegmentAndColorFields.color;\n          }\n          // Otherwise we are dealing with a segment field. We shouldn't take\n          // the segment from oldValue if the component has already been used as\n          // y axis.\n        } else if (\n          newChartConfig.fields.y.componentId !== oldValue.componentId\n        ) {\n          const oldSegment = oldValue as Exclude<typeof oldValue, TableFields>;\n          const oldColor: ColorField | undefined = isColorInConfig(\n            oldChartConfig\n          )\n            ? oldChartConfig.fields.color\n            : undefined;\n          const segmentDimension = dimensions.find(\n            (d) => d.id === oldValue.componentId\n          );\n          newSegment = {\n            ...oldSegment,\n            // We could encounter byMeasure sorting type (Pie chart); we should\n            // switch to byTotalSize sorting then.\n            sorting: adjustSegmentSorting({\n              segment: oldSegment,\n              acceptedValues: COLUMN_SEGMENT_SORTING.map((d) => d.sortingType),\n              defaultValue: \"byTotalSize\",\n            }),\n            type: disableStacked(xMeasure) ? \"grouped\" : \"stacked\",\n          };\n          newColor = getSegmentColorField({\n            oldColorField: oldColor,\n            segmentDimension,\n          });\n        }\n\n        return produce(newChartConfig, (draft) => {\n          if (newSegment && newColor?.type === \"segment\") {\n            draft.fields.segment = newSegment;\n            draft.fields.color = newColor;\n          }\n        });\n      },\n      animation: ({ oldValue, newChartConfig }) => {\n        if (newChartConfig.chartType !== \"bar\") {\n          return produce(newChartConfig, (draft) => {\n            if (newChartConfig.fields.x.componentId !== oldValue?.componentId) {\n              draft.fields.animation = oldValue;\n            }\n          });\n        }\n        return produce(newChartConfig, (draft) => {\n          // Temporal dimension could be used as Y axis, in this case we need to\n          // remove the animation.\n          if (newChartConfig.fields.y.componentId !== oldValue?.componentId) {\n            draft.fields.animation = oldValue;\n          }\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  line: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType = \"circle\", ...rest }) => ({\n            ...rest,\n            symbolType,\n          }))\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          const ok = dimensions.find(\n            (d) => isTemporalDimension(d) && d.id === oldValue\n          );\n\n          if (ok) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.x.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n      },\n      y: {\n        componentId: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.componentId = oldValue;\n          });\n        },\n        showValues: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.showValues = oldValue;\n          });\n        },\n        customDomain: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.customDomain = oldValue;\n          });\n        },\n      },\n      color: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          // Segment color type is migrated in tandem with the segment field below.\n          if (oldValue.type !== \"segment\") {\n            draft.fields.color = getSingleColorField({\n              oldColorField: oldValue,\n            });\n          }\n        });\n      },\n      segment: ({\n        oldValue,\n        oldChartConfig,\n        newChartConfig,\n        dimensions,\n        measures,\n      }) => {\n        let newSegment: LineSegmentField;\n        let newColor: ColorField;\n\n        if (oldChartConfig.chartType === \"table\") {\n          const maybeSegmentAndColorFields =\n            convertTableFieldsToSegmentAndColorFields({\n              fields: oldValue as TableFields,\n              dimensions,\n              measures,\n            });\n\n          if (maybeSegmentAndColorFields) {\n            newSegment = maybeSegmentAndColorFields.segment;\n            newColor = maybeSegmentAndColorFields.color;\n          }\n        } else {\n          const oldSegment = oldValue as Exclude<typeof oldValue, TableFields>;\n          const oldColor: ColorField | undefined = isColorInConfig(\n            oldChartConfig\n          )\n            ? oldChartConfig.fields.color\n            : undefined;\n          const segmentDimension = dimensions.find(\n            (d) => d.id === oldValue.componentId\n          );\n\n          if (!isTemporalDimension(segmentDimension)) {\n            newSegment = {\n              componentId: oldSegment.componentId,\n              sorting:\n                \"sorting\" in oldSegment &&\n                oldSegment.sorting &&\n                \"sortingOrder\" in oldSegment.sorting\n                  ? (oldSegment.sorting ?? DEFAULT_FIXED_COLOR_FIELD)\n                  : DEFAULT_SORTING,\n              showValuesMapping: oldSegment.showValuesMapping,\n            };\n            newColor = getSegmentColorField({\n              oldColorField: oldColor,\n              segmentDimension,\n            });\n          }\n        }\n\n        return produce(newChartConfig, (draft) => {\n          if (newSegment && newColor?.type === \"segment\") {\n            draft.fields.segment = newSegment;\n            draft.fields.color = newColor;\n          }\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  area: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType = \"circle\", ...rest }) => ({\n            ...rest,\n            symbolType,\n          }))\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          const ok = dimensions.find(\n            (d) => isTemporalDimension(d) && d.id === oldValue\n          );\n\n          if (ok) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.x.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n      },\n      y: {\n        componentId: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.componentId = oldValue;\n          });\n        },\n        showValues: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.showValues = oldValue;\n          });\n        },\n        customDomain: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.customDomain = oldValue;\n          });\n        },\n      },\n      color: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          // Segment color type is migrated in tandem with the segment field below.\n          if (oldValue.type !== \"segment\") {\n            draft.fields.color = getSingleColorField({\n              oldColorField: oldValue,\n            });\n          }\n        });\n      },\n      segment: ({\n        oldValue,\n        oldChartConfig,\n        newChartConfig,\n        dimensions,\n        measures,\n      }) => {\n        const yMeasure = measures.find(\n          (d) => d.id === newChartConfig.fields.y.componentId\n        );\n\n        if (disableStacked(yMeasure)) {\n          return produce(newChartConfig, (draft) => {\n            delete draft.fields.segment;\n          });\n        }\n\n        let newSegment: AreaSegmentField;\n        let newColor: ColorField;\n\n        if (oldChartConfig.chartType === \"table\") {\n          const maybeSegmentAndColorFields =\n            convertTableFieldsToSegmentAndColorFields({\n              fields: oldValue as TableFields,\n              dimensions,\n              measures,\n            });\n\n          if (maybeSegmentAndColorFields) {\n            newSegment = {\n              ...maybeSegmentAndColorFields.segment,\n              sorting: DEFAULT_SORTING,\n            };\n            newColor = maybeSegmentAndColorFields.color;\n          }\n        } else {\n          const oldSegment = oldValue as Exclude<typeof oldValue, TableFields>;\n          const oldColor: ColorField | undefined = isColorInConfig(\n            oldChartConfig\n          )\n            ? oldChartConfig.fields.color\n            : undefined;\n          const segmentDimension = dimensions.find(\n            (d) => d.id === oldValue.componentId\n          );\n\n          if (!isTemporalDimension(segmentDimension)) {\n            newSegment = {\n              componentId: oldSegment.componentId,\n              sorting: adjustSegmentSorting({\n                segment: oldSegment,\n                acceptedValues: AREA_SEGMENT_SORTING.map((d) => d.sortingType),\n                defaultValue: \"byTotalSize\",\n              }),\n              showValuesMapping: oldSegment.showValuesMapping,\n            };\n            newColor = getSegmentColorField({\n              oldColorField: oldColor,\n              segmentDimension,\n            });\n          }\n        }\n\n        return produce(newChartConfig, (draft) => {\n          if (newSegment && newColor?.type === \"segment\") {\n            draft.fields.segment = newSegment;\n            draft.fields.color = newColor;\n          }\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  scatterplot: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, measures }) => {\n          const numericalMeasures = measures.filter(isNumericalMeasure);\n\n          // If there is only one numerical measure then x & y are already filled correctly.\n          if (numericalMeasures.length > 1) {\n            if (numericalMeasures.map((d) => d.id).includes(oldValue)) {\n              return produce(newChartConfig, (draft) => {\n                draft.fields.x.componentId = oldValue;\n              });\n            }\n          }\n\n          return newChartConfig;\n        },\n      },\n      y: {\n        componentId: ({ oldValue, newChartConfig, measures }) => {\n          const numericalMeasures = measures.filter(isNumericalMeasure);\n\n          // If there is only one numerical measure then x & y are already filled correctly.\n          if (numericalMeasures.length > 1) {\n            if (\n              numericalMeasures.map((d) => d.id).includes(oldValue) &&\n              newChartConfig.fields.x.componentId !== oldValue\n            ) {\n              return produce(newChartConfig, (draft) => {\n                draft.fields.y.componentId = oldValue;\n              });\n            } else {\n              const newMeasure = numericalMeasures.find(\n                (d) => d.id !== newChartConfig.fields.x.componentId\n              );\n\n              if (newMeasure) {\n                return produce(newChartConfig, (draft) => {\n                  draft.fields.y.componentId = newMeasure.id;\n                });\n              }\n            }\n          }\n\n          return newChartConfig;\n        },\n      },\n      color: ({ oldValue, oldChartConfig, newChartConfig, dimensions }) => {\n        return produce(newChartConfig, (draft) => {\n          if (oldValue.type === \"single\") {\n            const oldColor: ColorField | undefined = isColorInConfig(\n              oldChartConfig\n            )\n              ? oldChartConfig.fields.color\n              : undefined;\n            const segmentDimension = dimensions.find(\n              (d) => d.id === newChartConfig.fields.segment?.componentId\n            );\n\n            draft.fields.color = getSegmentColorField({\n              oldColorField: oldColor,\n              segmentDimension,\n            });\n          }\n        });\n      },\n      segment: ({\n        oldValue,\n        oldChartConfig,\n        newChartConfig,\n        dimensions,\n        measures,\n      }) => {\n        let newSegment: ScatterPlotSegmentField;\n        let newColor: ColorField;\n        const oldColor: ColorField | undefined = isColorInConfig(oldChartConfig)\n          ? oldChartConfig.fields.color\n          : undefined;\n        const segmentDimension = dimensions.find(\n          (d) => d.id === oldValue.componentId\n        );\n\n        if (oldChartConfig.chartType === \"table\") {\n          const maybeSegmentAndColorFields =\n            convertTableFieldsToSegmentAndColorFields({\n              fields: oldValue as TableFields,\n              dimensions,\n              measures,\n            });\n\n          if (maybeSegmentAndColorFields) {\n            newSegment = maybeSegmentAndColorFields.segment;\n            newColor = maybeSegmentAndColorFields.color;\n          }\n        } else {\n          const oldSegment = oldValue as Exclude<typeof oldValue, TableFields>;\n          newSegment = {\n            componentId: oldSegment.componentId,\n            showValuesMapping: oldSegment.showValuesMapping,\n          };\n          newColor = getSegmentColorField({\n            oldColorField: oldColor,\n            segmentDimension,\n          });\n        }\n\n        return produce(newChartConfig, (draft) => {\n          if (newSegment && newColor?.type === \"segment\") {\n            draft.fields.segment = newSegment;\n            draft.fields.color = newColor;\n          }\n        });\n      },\n      animation: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          draft.fields.animation = oldValue;\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  pie: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      y: {\n        componentId: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.componentId = oldValue;\n          });\n        },\n        showValues: ({ oldValue, newChartConfig }) => {\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y.showValues = oldValue;\n          });\n        },\n      },\n      color: ({ oldValue, oldChartConfig, newChartConfig, dimensions }) => {\n        return produce(newChartConfig, (draft) => {\n          if (oldValue.type === \"single\") {\n            const oldColor: ColorField | undefined = isColorInConfig(\n              oldChartConfig\n            )\n              ? oldChartConfig.fields.color\n              : undefined;\n            const segmentDimension = dimensions.find(\n              (d) => d.id === newChartConfig.fields.segment.componentId\n            );\n\n            draft.fields.color = getSegmentColorField({\n              oldColorField: oldColor,\n              segmentDimension,\n            });\n          }\n        });\n      },\n      segment: ({\n        oldValue,\n        oldChartConfig,\n        newChartConfig,\n        dimensions,\n        measures,\n      }) => {\n        let newSegment: PieSegmentField;\n        let newColor: ColorField;\n\n        if (oldChartConfig.chartType === \"table\") {\n          const maybeSegmentAndColorFields =\n            convertTableFieldsToSegmentAndColorFields({\n              fields: oldValue as TableFields,\n              dimensions,\n              measures,\n            });\n\n          if (maybeSegmentAndColorFields) {\n            newSegment = {\n              ...maybeSegmentAndColorFields.segment,\n              sorting: DEFAULT_SORTING,\n            };\n            newColor = maybeSegmentAndColorFields.color;\n          }\n        } else {\n          const oldSegment = oldValue as Exclude<typeof oldValue, TableFields>;\n          const oldColor: ColorField | undefined = isColorInConfig(\n            oldChartConfig\n          )\n            ? oldChartConfig.fields.color\n            : undefined;\n          const segmentDimension = dimensions.find(\n            (d) => d.id === oldSegment.componentId\n          );\n          newSegment = {\n            componentId: oldSegment.componentId,\n            sorting: adjustSegmentSorting({\n              segment: oldSegment,\n              acceptedValues: PIE_SEGMENT_SORTING.map((d) => d.sortingType),\n              defaultValue: \"byMeasure\",\n            }),\n            showValuesMapping: oldSegment.showValuesMapping,\n          };\n          newColor = getSegmentColorField({\n            oldColorField: oldColor,\n            segmentDimension,\n          });\n        }\n\n        return produce(newChartConfig, (draft) => {\n          if (newSegment && newColor?.type === \"segment\") {\n            draft.fields.segment = newSegment;\n            draft.fields.color = newColor;\n          }\n        });\n      },\n      animation: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          draft.fields.animation = oldValue;\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  table: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue.map((cube) => ({\n          ...cube,\n          filters: Object.fromEntries(\n            Object.entries(cube.filters).filter(\n              ([_, value]) => value.type !== \"range\"\n            )\n          ),\n        }));\n      });\n    },\n    fields: ({ oldValue, newChartConfig }) => {\n      for (const componentId of Object.keys(newChartConfig.fields)) {\n        if (componentId === oldValue.componentId) {\n          return produce(newChartConfig, (draft) => {\n            draft.fields[componentId].isGroup = true;\n          });\n        }\n      }\n\n      return newChartConfig;\n    },\n  },\n  map: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        // Filters have been reset by the initial config of the map.\n        // We need to set them back to their old value, taking care not\n        // to override the filters that have been set by the initial config\n        // of the map.\n        for (const oldCube of oldValue) {\n          const cube = draft.cubes.find((d) => d.iri === oldCube.iri) as Cube;\n\n          for (const [id, value] of Object.entries(oldCube.filters)) {\n            if (cube.filters[id] === undefined) {\n              cube.filters[id] = value;\n            }\n          }\n\n          if (oldCube.joinBy !== undefined) {\n            cube.joinBy = oldCube.joinBy;\n          }\n        }\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      areaLayer: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          const areaDimension = dimensions.find(\n            (d) => d.__typename === \"GeoShapesDimension\" && d.id === oldValue\n          );\n\n          if (areaDimension) {\n            return produce(newChartConfig, (draft) => {\n              if (draft.fields.areaLayer) {\n                draft.fields.areaLayer.componentId = oldValue;\n              }\n            });\n          }\n\n          return newChartConfig;\n        },\n        color: {\n          componentId: ({ oldValue, newChartConfig }) => {\n            return produce(newChartConfig, (draft) => {\n              if (draft.fields.areaLayer) {\n                draft.fields.areaLayer.color.componentId = oldValue;\n              }\n\n              if (draft.fields.symbolLayer) {\n                draft.fields.symbolLayer.measureId = oldValue;\n              }\n            });\n          },\n        },\n      },\n      animation: ({ oldValue, newChartConfig }) => {\n        return produce(newChartConfig, (draft) => {\n          draft.fields.animation = oldValue;\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  comboLineSingle: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          const ok = dimensions.find(\n            (d) => isTemporalDimension(d) && d.id === oldValue\n          );\n\n          if (ok) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.x.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n      },\n      y: {\n        componentIds: ({\n          oldValue,\n          newChartConfig,\n          oldChartConfig,\n          measures,\n        }) => {\n          const numericalMeasures = measures.filter(\n            (d) => isNumericalMeasure(d) && d.unit\n          );\n          const { unit } =\n            numericalMeasures.find((d) => d.id === oldValue) ??\n            numericalMeasures[0];\n          const componentIds = numericalMeasures\n            .filter((d) => d.unit === unit)\n            .map((d) => d.id);\n          const paletteId = isColorInConfig(oldChartConfig)\n            ? (oldChartConfig.fields.color.paletteId ??\n              DEFAULT_CATEGORICAL_PALETTE_ID)\n            : DEFAULT_CATEGORICAL_PALETTE_ID;\n\n          return produce(newChartConfig, (draft) => {\n            draft.fields.y = {\n              componentIds,\n            };\n            draft.fields.color = {\n              type: \"measures\",\n              paletteId: paletteId,\n              colorMapping: mapValueIrisToColor({\n                paletteId,\n                dimensionValues: componentIds.map((id) => ({\n                  value: id,\n                  label: id,\n                })),\n              }),\n            };\n          });\n        },\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  comboLineDual: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          const ok = dimensions.find(\n            (d) => isTemporalDimension(d) && d.id === oldValue\n          );\n\n          if (ok) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.x.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n      },\n      y: ({ newChartConfig, oldChartConfig, measures, isAddingNewCube }) => {\n        const numericalMeasures = measures.filter(isNumericalMeasure);\n        const numericalMeasureIds = numericalMeasures.map((d) => d.id);\n        let leftMeasure = numericalMeasures.find(\n          (d) => d.id === numericalMeasureIds[0]\n        ) as NumericalMeasure;\n        let rightMeasureId: string | undefined;\n        const getLeftMeasure = (preferredId: string) => {\n          const preferredLeftMeasure = numericalMeasures.find(\n            (d) => d.id === preferredId\n          ) as NumericalMeasure;\n\n          if (isAddingNewCube) {\n            const rightMeasure = numericalMeasures.find(\n              (d) => d.id === rightMeasureId\n            );\n            const overrideLeftMeasure = numericalMeasures.find(\n              (d) =>\n                d.cubeIri !== rightMeasure?.cubeIri &&\n                d.unit !== rightMeasure?.unit\n            );\n\n            return overrideLeftMeasure ?? preferredLeftMeasure;\n          } else {\n            return preferredLeftMeasure;\n          }\n        };\n\n        switch (oldChartConfig.chartType) {\n          case \"comboLineColumn\": {\n            const {\n              lineComponentId: lineId,\n              lineAxisOrientation: lineOrientation,\n              columnComponentId: columnId,\n            } = oldChartConfig.fields.y;\n            const leftAxisId = lineOrientation === \"left\" ? lineId : columnId;\n            rightMeasureId = lineOrientation === \"left\" ? columnId : lineId;\n            leftMeasure = getLeftMeasure(leftAxisId);\n            break;\n          }\n          case \"comboLineSingle\": {\n            leftMeasure = getLeftMeasure(\n              oldChartConfig.fields.y.componentIds[0]\n            );\n            break;\n          }\n          case \"area\":\n          case \"column\":\n          case \"line\":\n          case \"pie\":\n          case \"scatterplot\": {\n            leftMeasure = getLeftMeasure(oldChartConfig.fields.y.componentId);\n            break;\n          }\n          case \"map\": {\n            const { areaLayer, symbolLayer } = oldChartConfig.fields;\n            const leftAxisId =\n              areaLayer?.color.componentId ?? symbolLayer?.measureId;\n\n            if (leftAxisId) {\n              leftMeasure = getLeftMeasure(leftAxisId);\n            }\n\n            break;\n          }\n          case \"bar\": {\n            leftMeasure = getLeftMeasure(oldChartConfig.fields.x.componentId);\n            break;\n          }\n          case \"comboLineDual\":\n          case \"table\":\n            break;\n          default:\n            const _exhaustiveCheck: never = oldChartConfig;\n            return _exhaustiveCheck;\n        }\n\n        const rightMeasure = numericalMeasures.find((d) =>\n          rightMeasureId ? d.id === rightMeasureId : d.unit !== leftMeasure.unit\n        ) as NumericalMeasure;\n        rightMeasureId = rightMeasure.id;\n        leftMeasure = getLeftMeasure(leftMeasure.id);\n\n        const paletteId = isColorInConfig(oldChartConfig)\n          ? (oldChartConfig.fields.color.paletteId ??\n            DEFAULT_CATEGORICAL_PALETTE_ID)\n          : DEFAULT_CATEGORICAL_PALETTE_ID;\n\n        return produce(newChartConfig, (draft) => {\n          draft.fields.y = {\n            leftAxisComponentId: leftMeasure.id,\n            rightAxisComponentId: rightMeasureId as string,\n          };\n          draft.fields.color = {\n            type: \"measures\",\n            paletteId: paletteId,\n            colorMapping: mapValueIrisToColor({\n              paletteId,\n              dimensionValues: [leftMeasure.id, rightMeasureId].map((id) => ({\n                value: id,\n                label: id,\n              })) as DimensionValue[],\n            }),\n          };\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n  comboLineColumn: {\n    cubes: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.cubes = oldValue;\n      });\n    },\n    annotations: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.annotations = oldValue;\n      });\n    },\n    limits: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.limits = mapValues(oldValue, (limits) =>\n          limits.map(({ symbolType, ...rest }) => rest)\n        );\n      });\n    },\n    conversionUnitsByComponentId: ({ oldValue, newChartConfig }) => {\n      return produce(newChartConfig, (draft) => {\n        draft.conversionUnitsByComponentId = oldValue;\n      });\n    },\n    fields: {\n      x: {\n        componentId: ({ oldValue, newChartConfig, dimensions }) => {\n          const ok = dimensions.find(\n            (d) => isTemporalDimension(d) && d.id === oldValue\n          );\n\n          if (ok) {\n            return produce(newChartConfig, (draft) => {\n              draft.fields.x.componentId = oldValue;\n            });\n          }\n\n          return newChartConfig;\n        },\n      },\n      y: ({ newChartConfig, oldChartConfig, measures }) => {\n        const numericalMeasures = measures.filter(isNumericalMeasure);\n        const numericalMeasureIds = numericalMeasures.map((d) => d.id);\n        let leftMeasure = numericalMeasures.find(\n          (d) => d.id === numericalMeasureIds[0]\n        ) as NumericalMeasure;\n        let rightMeasureId: string;\n        const getMeasure = (id: string) => {\n          return numericalMeasures.find((d) => d.id === id) as NumericalMeasure;\n        };\n\n        switch (oldChartConfig.chartType) {\n          case \"comboLineDual\": {\n            const leftAxisId = oldChartConfig.fields.y.leftAxisComponentId;\n            leftMeasure = getMeasure(leftAxisId);\n            rightMeasureId = oldChartConfig.fields.y.rightAxisComponentId;\n            break;\n          }\n          case \"comboLineSingle\": {\n            leftMeasure = getMeasure(oldChartConfig.fields.y.componentIds[0]);\n            break;\n          }\n          case \"area\":\n          case \"column\":\n          case \"line\":\n          case \"pie\":\n          case \"scatterplot\": {\n            leftMeasure = getMeasure(oldChartConfig.fields.y.componentId);\n            break;\n          }\n          case \"map\": {\n            const { areaLayer, symbolLayer } = oldChartConfig.fields;\n            const leftAxisId =\n              areaLayer?.color.componentId ?? symbolLayer?.measureId;\n\n            if (leftAxisId) {\n              leftMeasure = getMeasure(leftAxisId);\n            }\n\n            break;\n          }\n          case \"bar\": {\n            leftMeasure = getMeasure(oldChartConfig.fields.x.componentId);\n            break;\n          }\n          case \"comboLineColumn\":\n          case \"table\":\n            break;\n          default:\n            const _exhaustiveCheck: never = oldChartConfig;\n            return _exhaustiveCheck;\n        }\n\n        const rightMeasure = numericalMeasures.find((d) =>\n          rightMeasureId ? d.id === rightMeasureId : d.unit !== leftMeasure.unit\n        ) as NumericalMeasure;\n        const lineComponentId = rightMeasure.id;\n\n        const paletteId = isColorInConfig(oldChartConfig)\n          ? (oldChartConfig.fields.color.paletteId ??\n            DEFAULT_CATEGORICAL_PALETTE_ID)\n          : DEFAULT_CATEGORICAL_PALETTE_ID;\n\n        return produce(newChartConfig, (draft) => {\n          draft.fields.y = {\n            columnComponentId: leftMeasure.id,\n            lineComponentId,\n            lineAxisOrientation: \"right\",\n          };\n          draft.fields.color = {\n            type: \"measures\",\n            paletteId: paletteId,\n            colorMapping: mapValueIrisToColor({\n              paletteId,\n              dimensionValues: [leftMeasure.id, lineComponentId].map((id) => ({\n                value: id,\n                label: id,\n              })) as DimensionValue[],\n            }),\n          };\n        });\n      },\n    },\n    interactiveFiltersConfig: interactiveFiltersAdjusters,\n  },\n};\ntype ChartConfigAdjusters = (typeof chartConfigsAdjusters)[ChartType];\n\n// Needed to correctly retain chart options when switching to maps and tables.\nconst chartConfigsPathOverrides: {\n  [newChartType in ChartType]: {\n    [oldChartType in ChartType]?: {\n      [oldFieldToOverride: string]: {\n        path: string;\n        oldValue?: (d: any) => any;\n      }[];\n    };\n  };\n} = {\n  column: {\n    bar: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.x.showValues\": [{ path: \"fields.y.showValues\" }],\n      \"fields.x.customDomain\": [{ path: \"fields.y.customDomain\" }],\n      \"fields.y.componentId\": [{ path: \"fields.x.componentId\" }],\n    },\n    map: {\n      \"fields.areaLayer.componentId\": [{ path: \"fields.x.componentId\" }],\n      \"fields.areaLayer.color.componentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    table: {\n      fields: [{ path: \"fields.segment\" }],\n    },\n    comboLineSingle: {\n      \"fields.y.componentIds\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineSingleFields[\"y\"][\"componentIds\"]) => d[0],\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    comboLineColumn: {\n      \"fields.y\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineColumnFields[\"y\"]) => {\n            return d.lineAxisOrientation === \"left\"\n              ? d.lineComponentId\n              : d.columnComponentId;\n          },\n        },\n      ],\n    },\n  },\n  bar: {\n    column: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.y.componentId\": [{ path: \"fields.x.componentId\" }],\n      \"fields.y.showValues\": [{ path: \"fields.x.showValues\" }],\n      \"fields.y.customDomain\": [{ path: \"fields.x.customDomain\" }],\n    },\n    line: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.y.componentId\": [{ path: \"fields.x.componentId\" }],\n      \"fields.y.showValues\": [{ path: \"fields.x.showValues\" }],\n      \"fields.y.customDomain\": [{ path: \"fields.x.customDomain\" }],\n    },\n    area: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.y.componentId\": [{ path: \"fields.x.componentId\" }],\n      \"fields.y.showValues\": [{ path: \"fields.x.showValues\" }],\n      \"fields.y.customDomain\": [{ path: \"fields.x.customDomain\" }],\n    },\n    pie: {\n      \"fields.y.componentId\": [{ path: \"fields.x.componentId\" }],\n      \"fields.y.showValues\": [{ path: \"fields.x.showValues\" }],\n    },\n    map: {\n      \"fields.areaLayer.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.areaLayer.color.componentId\": [{ path: \"fields.x.componentId\" }],\n    },\n    table: {\n      fields: [{ path: \"fields.segment\" }],\n    },\n    comboLineSingle: {\n      \"fields.y.componentIds\": [\n        {\n          path: \"fields.x.componentId\",\n          oldValue: (d: ComboLineSingleFields[\"y\"][\"componentIds\"]) => d[0],\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [{ path: \"fields.x.componentId\" }],\n    },\n    comboLineColumn: {\n      \"fields.y\": [\n        {\n          path: \"fields.x.componentId\",\n          oldValue: (d: ComboLineColumnFields[\"y\"]) => {\n            return d.lineAxisOrientation === \"left\"\n              ? d.lineComponentId\n              : d.columnComponentId;\n          },\n        },\n      ],\n    },\n  },\n  line: {\n    bar: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.x.showValues\": [{ path: \"fields.y.showValues\" }],\n      \"fields.x.customDomain\": [{ path: \"fields.y.customDomain\" }],\n      \"fields.y.componentId\": [{ path: \"fields.x.componentId\" }],\n    },\n    map: {\n      \"fields.areaLayer.color.componentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    table: {\n      fields: [{ path: \"fields.segment\" }],\n    },\n    comboLineSingle: {\n      \"fields.y.componentIds\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineSingleFields[\"y\"][\"componentIds\"]) => d[0],\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    comboLineColumn: {\n      \"fields.y\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineColumnFields[\"y\"]) => {\n            return d.lineAxisOrientation === \"left\"\n              ? d.lineComponentId\n              : d.columnComponentId;\n          },\n        },\n      ],\n    },\n  },\n  area: {\n    bar: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.x.showValues\": [{ path: \"fields.y.showValues\" }],\n      \"fields.x.customDomain\": [{ path: \"fields.y.customDomain\" }],\n      \"fields.y.componentId\": [{ path: \"fields.x.componentId\" }],\n    },\n    map: {\n      \"fields.areaLayer.color.componentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    table: {\n      fields: [{ path: \"fields.segment\" }],\n    },\n    comboLineSingle: {\n      \"fields.y.componentIds\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineSingleFields[\"y\"][\"componentIds\"]) => d[0],\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    comboLineColumn: {\n      \"fields.y\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineColumnFields[\"y\"]) => {\n            return d.lineAxisOrientation === \"left\"\n              ? d.lineComponentId\n              : d.columnComponentId;\n          },\n        },\n      ],\n    },\n  },\n  scatterplot: {\n    map: {\n      \"fields.areaLayer.color.componentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    table: {\n      fields: [{ path: \"fields.segment\" }],\n    },\n    comboLineSingle: {\n      \"fields.y.componentIds\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineSingleFields[\"y\"][\"componentIds\"]) => d[0],\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    comboLineColumn: {\n      \"fields.y\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineColumnFields[\"y\"]) => {\n            return d.lineAxisOrientation === \"left\"\n              ? d.lineComponentId\n              : d.columnComponentId;\n          },\n        },\n      ],\n    },\n  },\n  pie: {\n    bar: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentId\" }],\n      \"fields.x.showValues\": [{ path: \"fields.y.showValues\" }],\n      // We want to avoid running the logic for the y component twice.\n      \"fields.y.componentId\": [{ path: \"SKIP\" }],\n    },\n    map: {\n      \"fields.areaLayer.componentId\": [{ path: \"fields.segment.componentId\" }],\n      \"fields.areaLayer.color.componentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    table: {\n      fields: [{ path: \"fields.segment\" }],\n    },\n    comboLineSingle: {\n      \"fields.y.componentIds\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineSingleFields[\"y\"][\"componentIds\"]) => d[0],\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [{ path: \"fields.y.componentId\" }],\n    },\n    comboLineColumn: {\n      \"fields.y\": [\n        {\n          path: \"fields.y.componentId\",\n          oldValue: (d: ComboLineColumnFields[\"y\"]) => {\n            return d.lineAxisOrientation === \"left\"\n              ? d.lineComponentId\n              : d.columnComponentId;\n          },\n        },\n      ],\n    },\n  },\n  table: {\n    column: {\n      \"fields.segment\": [{ path: \"fields\" }],\n    },\n    line: {\n      \"fields.segment\": [{ path: \"fields\" }],\n    },\n    area: {\n      \"fields.segment\": [{ path: \"fields\" }],\n    },\n    scatterplot: {\n      \"fields.segment\": [{ path: \"fields\" }],\n    },\n    pie: {\n      \"fields.segment\": [{ path: \"fields\" }],\n    },\n  },\n  map: {\n    column: {\n      \"fields.x.componentId\": [{ path: \"fields.areaLayer.componentId\" }],\n      \"fields.y.componentId\": [{ path: \"fields.areaLayer.color.componentId\" }],\n    },\n    bar: {\n      \"fields.x.componentId\": [{ path: \"fields.areaLayer.color.componentId\" }],\n      \"fields.y.componentId\": [{ path: \"fields.areaLayer.componentId\" }],\n    },\n    line: {\n      \"fields.y.componentId\": [{ path: \"fields.areaLayer.color.componentId\" }],\n    },\n    area: {\n      \"fields.y.componentId\": [{ path: \"fields.areaLayer.color.componentId\" }],\n    },\n    scatterplot: {\n      \"fields.y.componentId\": [{ path: \"fields.areaLayer.color.componentId\" }],\n    },\n    pie: {\n      \"fields.x.componentId\": [{ path: \"fields.areaLayer.componentId\" }],\n      \"fields.y.componentId\": [{ path: \"fields.areaLayer.color.componentId\" }],\n    },\n    comboLineSingle: {\n      \"fields.y.componentIds\": [\n        {\n          path: \"fields.areaLayer.color.componentId\",\n          oldValue: (d: ComboLineSingleFields[\"y\"][\"componentIds\"]) => d[0],\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [\n        { path: \"fields.areaLayer.color.componentId\" },\n      ],\n    },\n    comboLineColumn: {\n      \"fields.y\": [\n        {\n          path: \"fields.areaLayer.color.componentId\",\n          oldValue: (d: ComboLineColumnFields[\"y\"]) => {\n            return d.lineAxisOrientation === \"left\"\n              ? d.lineComponentId\n              : d.columnComponentId;\n          },\n        },\n      ],\n    },\n  },\n  comboLineSingle: {\n    column: {\n      \"fields.y.componentId\": [{ path: \"fields.y.componentIds\" }],\n    },\n    bar: {\n      \"fields.x.componentId\": [{ path: \"fields.y.componentIds\" }],\n    },\n    line: {\n      \"fields.y.componentId\": [{ path: \"fields.y.componentIds\" }],\n    },\n    area: {\n      \"fields.y.componentId\": [{ path: \"fields.y.componentIds\" }],\n    },\n    scatterplot: {\n      \"fields.y.componentId\": [{ path: \"fields.y.componentIds\" }],\n    },\n    pie: {\n      \"fields.y.componentId\": [{ path: \"fields.y.componentIds\" }],\n    },\n    map: {\n      \"fields.areaLayer.color.componentId\": [\n        {\n          path: \"fields.y.componentIds\",\n        },\n      ],\n    },\n    comboLineDual: {\n      \"fields.y.leftAxisComponentId\": [\n        {\n          path: \"fields.y.componentIds\",\n        },\n      ],\n    },\n    comboLineColumn: {\n      \"fields.y.lineComponentId\": [{ path: \"fields.y.componentIds\" }],\n    },\n  },\n  comboLineDual: {\n    column: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    bar: {\n      \"fields.x\": [{ path: \"fields.y\" }],\n    },\n    line: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    area: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    scatterplot: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    pie: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    map: {\n      \"fields.areaLayer\": [{ path: \"fields.y\" }],\n    },\n    comboLineSingle: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    comboLineColumn: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n  },\n  comboLineColumn: {\n    column: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    bar: {\n      \"fields.x\": [{ path: \"fields.y\" }],\n    },\n    line: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    area: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    scatterplot: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    pie: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    map: {\n      \"fields.areaLayer\": [{ path: \"fields.y\" }],\n    },\n    comboLineSingle: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n    comboLineDual: {\n      \"fields.y\": [{ path: \"fields.y\" }],\n    },\n  },\n};\ntype ChartConfigPathOverrides =\n  (typeof chartConfigsPathOverrides)[ChartType][ChartType];\n\nconst adjustSegmentSorting = ({\n  segment,\n  acceptedValues,\n  defaultValue,\n}: {\n  segment: ChartSegmentField;\n  acceptedValues: SortingType[];\n  defaultValue: SortingType;\n}): SortingOption => {\n  const sorting = (segment as any).sorting as SortingOption | undefined;\n  const sortingType = sorting?.sortingType;\n  const newSorting = sorting\n    ? sortingType && acceptedValues.includes(sortingType)\n      ? sorting\n      : { ...sorting, sortingType: defaultValue }\n    : DEFAULT_SORTING;\n\n  return newSorting;\n};\n\nconst categoricalEnabledChartTypes: RegularChartType[] = [\n  \"column\",\n  \"bar\",\n  \"pie\",\n];\nconst geoEnabledChartTypes: RegularChartType[] = [\n  \"column\",\n  \"bar\",\n  \"map\",\n  \"pie\",\n];\nconst multipleNumericalMeasuresEnabledChartTypes: RegularChartType[] = [\n  \"scatterplot\",\n];\nconst timeEnabledChartTypes: RegularChartType[] = [\n  \"area\",\n  \"column\",\n  \"bar\",\n  \"line\",\n];\n\nexport const getEnabledChartTypes = ({\n  dimensions,\n  measures,\n  cubeCount,\n}: {\n  dimensions: Dimension[];\n  measures: Measure[];\n  cubeCount: number;\n}) => {\n  const numericalMeasures = measures.filter(isNumericalMeasure);\n  const ordinalMeasures = measures.filter(isOrdinalMeasure);\n  const categoricalDimensions = getCategoricalDimensions(dimensions);\n  const geoDimensions = getGeoDimensions(dimensions);\n  const temporalDimensions = dimensions.filter(\n    (d) => isTemporalDimension(d) || isTemporalEntityDimension(d)\n  );\n\n  const possibleChartTypesDict = Object.fromEntries(\n    chartTypes.map((chartType) => [\n      chartType,\n      {\n        enabled: chartType === \"table\",\n        message: undefined,\n      },\n    ])\n  ) as Record<\n    ChartType,\n    {\n      enabled: boolean;\n      message: string | undefined;\n    }\n  >;\n  const enableChartType = (chartType: ChartType) => {\n    possibleChartTypesDict[chartType] = {\n      enabled: true,\n      message: undefined,\n    };\n  };\n  const enableChartTypes = (chartTypes: ChartType[]) => {\n    for (const chartType of chartTypes) {\n      enableChartType(chartType);\n    }\n  };\n  const maybeDisableChartType = (chartType: ChartType, message: string) => {\n    if (\n      !possibleChartTypesDict[chartType].enabled &&\n      !possibleChartTypesDict[chartType].message\n    ) {\n      possibleChartTypesDict[chartType] = {\n        enabled: false,\n        message,\n      };\n    }\n  };\n  const maybeDisableChartTypes = (chartTypes: ChartType[], message: string) => {\n    for (const chartType of chartTypes) {\n      maybeDisableChartType(chartType, message);\n    }\n  };\n\n  if (numericalMeasures.length > 0) {\n    if (categoricalDimensions.length > 0) {\n      enableChartTypes(categoricalEnabledChartTypes);\n    } else {\n      maybeDisableChartTypes(\n        categoricalEnabledChartTypes,\n        t({\n          id: \"controls.chart.disabled.categorical\",\n          message: \"At least one categorical dimension is required.\",\n        })\n      );\n    }\n\n    if (geoDimensions.length > 0) {\n      enableChartTypes(geoEnabledChartTypes);\n    } else {\n      maybeDisableChartTypes(\n        geoEnabledChartTypes,\n        t({\n          id: \"controls.chart.disabled.geographical\",\n          message: \"At least one geographical dimension is required.\",\n        })\n      );\n    }\n\n    if (numericalMeasures.length > 1) {\n      enableChartTypes(multipleNumericalMeasuresEnabledChartTypes);\n\n      if (temporalDimensions.length > 0) {\n        const measuresWithUnit = numericalMeasures.filter((d) => d.unit);\n        const uniqueUnits = Array.from(\n          new Set(measuresWithUnit.map((d) => d.unit))\n        );\n\n        if (uniqueUnits.length > 1) {\n          enableChartTypes(comboDifferentUnitChartTypes);\n        } else {\n          maybeDisableChartTypes(\n            comboDifferentUnitChartTypes,\n            t({\n              id: \"controls.chart.disabled.different-unit\",\n              message:\n                \"At least two numerical measures with different units are required.\",\n            })\n          );\n        }\n\n        const unitCounts = rollup(\n          measuresWithUnit,\n          (v) => v.length,\n          (d) => d.unit\n        );\n\n        if (Array.from(unitCounts.values()).some((d) => d > 1)) {\n          enableChartTypes(comboSameUnitChartTypes);\n        } else {\n          maybeDisableChartTypes(\n            comboSameUnitChartTypes,\n            t({\n              id: \"controls.chart.disabled.same-unit\",\n              message:\n                \"At least two numerical measures with the same unit are required.\",\n            })\n          );\n        }\n      } else {\n        maybeDisableChartTypes(\n          comboChartTypes,\n          t({\n            id: \"controls.chart.disabled.temporal\",\n            message: \"At least one temporal dimension is required.\",\n          })\n        );\n      }\n    } else {\n      maybeDisableChartTypes(\n        [...multipleNumericalMeasuresEnabledChartTypes, ...comboChartTypes],\n        t({\n          id: \"controls.chart.disabled.multiple-measures\",\n          message: \"At least two numerical measures are required.\",\n        })\n      );\n    }\n\n    if (temporalDimensions.length > 0) {\n      enableChartTypes(timeEnabledChartTypes);\n    } else {\n      maybeDisableChartTypes(\n        timeEnabledChartTypes,\n        t({\n          id: \"controls.chart.disabled.temporal\",\n          message: \"At least one temporal dimension is required.\",\n        })\n      );\n    }\n  } else {\n    maybeDisableChartTypes(\n      chartTypes.filter((d) => d !== \"table\"),\n      t({\n        id: \"controls.chart.disabled.numerical\",\n        message: \"At least one numerical measure is required.\",\n      })\n    );\n  }\n\n  if (ordinalMeasures.length > 0 && geoDimensions.length > 0) {\n    enableChartType(\"map\");\n  } else {\n    maybeDisableChartType(\n      \"map\",\n      \"At least one ordinal measure and one geographical dimension are required.\"\n    );\n  }\n\n  const chartTypesOrder = getChartTypeOrder({ cubeCount });\n  const enabledChartTypes = chartTypes\n    .filter((d) => possibleChartTypesDict[d].enabled)\n    .sort((a, b) => chartTypesOrder[a] - chartTypesOrder[b]);\n\n  return {\n    enabledChartTypes,\n    possibleChartTypesDict,\n  };\n};\n\nexport const getFieldComponentIds = (fields: ChartConfig[\"fields\"]) => {\n  return new Set(\n    Object.values(fields).flatMap((f) =>\n      f?.componentId ? [f.componentId] : []\n    )\n  );\n};\n\nexport const getGroupedFieldIds = (fields: GenericFields) => {\n  return new Set(\n    Object.values(fields).flatMap((f) =>\n      f && (f as $IntentionalAny).isGroup ? [f.componentId] : []\n    )\n  );\n};\n\nexport const getHiddenFieldIds = (fields: GenericFields) => {\n  return new Set(\n    Object.values(fields).flatMap((f) =>\n      f && (f as $IntentionalAny).isHidden ? [f.componentId] : []\n    )\n  );\n};\n\nexport const getFieldComponentId = (\n  fields: ChartConfig[\"fields\"],\n  field: string\n): string | undefined => {\n  // Multi axis charts have multiple component ids in the y field.\n  return (fields as $IntentionalAny)[field]?.componentId;\n};\n\nconst getSingleColorField = ({\n  oldColorField,\n}: {\n  oldColorField: SingleColorField | MeasuresColorField;\n}): SingleColorField => {\n  return {\n    type: \"single\",\n    paletteId: oldColorField.paletteId,\n    color:\n      oldColorField.type === \"single\"\n        ? oldColorField.color\n        : Object.values(oldColorField.colorMapping)[0],\n  };\n};\n\nconst getSegmentColorField = ({\n  oldColorField,\n  segmentDimension,\n}: {\n  oldColorField?: ColorField;\n  segmentDimension?: Dimension;\n}): SegmentColorField => {\n  const paletteId = oldColorField?.paletteId ?? DEFAULT_CATEGORICAL_PALETTE_ID;\n\n  return {\n    type: \"segment\",\n    paletteId,\n    colorMapping: mapValueIrisToColor({\n      paletteId,\n      dimensionValues: segmentDimension?.values ?? [],\n      colorMapping:\n        oldColorField?.type === \"segment\"\n          ? oldColorField.colorMapping\n          : undefined,\n    }),\n  };\n};\n\nconst convertTableFieldsToSegmentAndColorFields = ({\n  fields,\n  dimensions,\n  measures,\n}: {\n  fields: TableFields;\n  dimensions: Dimension[];\n  measures: Measure[];\n}):\n  | {\n      segment: GenericField & ShowValuesSegmentFieldExtension;\n      color: ColorField;\n    }\n  | undefined => {\n  const groupedColumns = group(Object.values(fields), (d) => d.isGroup)\n    .get(true)\n    ?.filter((d) => SEGMENT_ENABLED_COMPONENTS.includes(d.componentType))\n    .sort((a, b) => a.index - b.index);\n  const component = groupedColumns?.[0];\n\n  if (!component) {\n    return;\n  }\n\n  const { componentId } = component;\n  const actualComponent = [...dimensions, ...measures].find(\n    (d) => d.id === componentId\n  ) as Component;\n  const paletteId = getDefaultCategoricalPaletteId(actualComponent);\n\n  return {\n    segment: {\n      componentId,\n      showValuesMapping: {},\n    },\n    color: {\n      type: \"segment\",\n      paletteId: paletteId,\n      colorMapping: mapValueIrisToColor({\n        paletteId: paletteId,\n        dimensionValues: actualComponent.values,\n      }),\n    },\n  };\n};\n\nexport const getChartSymbol = (\n  chartType: ChartType\n): \"square\" | \"line\" | \"circle\" => {\n  switch (chartType) {\n    case \"area\":\n    case \"column\":\n    case \"bar\":\n    case \"comboLineColumn\":\n    case \"pie\":\n    case \"map\":\n    case \"table\":\n      return \"square\";\n    case \"comboLineDual\":\n    case \"comboLineSingle\":\n    case \"line\":\n      return \"line\";\n    case \"scatterplot\":\n      return \"circle\";\n    default:\n      const _exhaustiveCheck: never = chartType;\n      return _exhaustiveCheck;\n  }\n};\n","import { schemeCategory10 } from \"d3-scale-chromatic\";\n\nimport {\n  CategoricalColorField,\n  FixedColorField,\n  NumericalColorField,\n  PaletteType,\n} from \"@/config-types\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport { DimensionValue } from \"@/domain/data\";\n\nexport const DEFAULT_FIXED_COLOR_FIELD_OPACITY = 80;\n\nexport const DEFAULT_OTHER_COLOR_FIELD_OPACITY = 100;\n\nexport const DEFAULT_FIXED_COLOR_FIELD: FixedColorField = {\n  type: \"fixed\",\n  value: schemeCategory10[0],\n  opacity: DEFAULT_FIXED_COLOR_FIELD_OPACITY,\n};\n\nexport const getDefaultCategoricalColorField = ({\n  id,\n  paletteId,\n  dimensionValues,\n}: {\n  id: string;\n  paletteId: string;\n  dimensionValues: DimensionValue[];\n}): CategoricalColorField => ({\n  type: \"categorical\",\n  componentId: id,\n  paletteId,\n  colorMapping: mapValueIrisToColor({\n    paletteId,\n    dimensionValues,\n  }),\n  opacity: DEFAULT_OTHER_COLOR_FIELD_OPACITY,\n});\n\nexport const getDefaultNumericalColorField = ({\n  id,\n  colorPalette = {\n    type: \"sequential\",\n    paletteId: \"oranges\",\n    name: \"oranges\",\n  },\n}: {\n  id: string;\n  colorPalette?: PaletteType;\n}): NumericalColorField => ({\n  type: \"numerical\",\n  componentId: id,\n  paletteId: colorPalette.paletteId,\n  scaleType: \"continuous\",\n  interpolationType: \"linear\",\n  opacity: 100,\n});\n\nexport const DEFAULT_COLOR = [222, 222, 222, 125];\n\nexport const FLY_TO_DURATION = 500;\n\nexport const RESET_DURATION = 1500;\n","/**\n * We need to access the map from the map controls. Until we have a good solution\n * for sibling components, we use a global non-observable ref.\n */\nlet map: mapboxgl.Map | null = null;\n\nconst getMap = () => {\n  return map;\n};\n\nconst setMap = (d: mapboxgl.Map | null) => {\n  map = d;\n};\n\nexport { getMap, setMap };\n","import { _WMSLayer as DeckGLWMSLayer } from \"@deck.gl/geo-layers\";\nimport { XMLParser } from \"fast-xml-parser\";\nimport uniq from \"lodash/uniq\";\n\nimport { isRemoteLayerCRSSupported } from \"@/charts/map/wms-wmts-endpoint-utils\";\nimport { maybeArray, parseCrs } from \"@/charts/map/wms-wmts-parse-utils\";\nimport { WMSCustomLayer } from \"@/config-types\";\n\ntype WMSData = {\n  WMS_Capabilities: {\n    Capability: {\n      Layer: {\n        Layer: WMSLayer[];\n        Attribution: {\n          Title: string;\n        };\n      };\n      Request: {\n        GetMap: {\n          DCPType: {\n            HTTP: {\n              Get: {\n                OnlineResource: {\n                  \"xlink:href\": string;\n                };\n              };\n            };\n          };\n        };\n      };\n    };\n    Service: {\n      OnlineResource: {\n        \"xlink:href\": string;\n      };\n      Title: string;\n    };\n  };\n};\n\ntype WMSLayer = {\n  Abstract?: string;\n  Name: string;\n  Title: string;\n  Style?: {\n    LegendURL: {\n      OnlineResource: {\n        \"xlink:href\": string;\n        width: number;\n        height: number;\n      };\n    };\n    \"ows:Identifier\": string;\n    \"ows:Title\": string;\n  };\n  Layer?: WMSLayer[];\n  CRS: string[] | string;\n};\n\nexport type RemoteWMSLayer = {\n  /** id not unique */\n  id: string;\n  /** path should be unique */\n  path: string;\n  title: string;\n  description?: string;\n  legendUrl?: string;\n  availableDimensionValues?: (string | number)[];\n  defaultDimensionValue?: string | number;\n  endpoint: string;\n  type: \"wms\";\n  children?: RemoteWMSLayer[];\n  dataUrl: string;\n  crs: string[];\n  attribution: string;\n};\n\nconst parseWMSLayer = (\n  layer: WMSLayer,\n  parentAttributes: {\n    endpoint: string;\n    dataUrl: string;\n    attribution: string;\n    crs: string[];\n  },\n  parentPath = \"\"\n): RemoteWMSLayer => {\n  const currentPath = `${parentPath ?? parentAttributes.endpoint}/${layer.Name ?? layer.Title}`;\n  const layerCrs = (maybeArray(layer.CRS) ?? []).map((c) => parseCrs(c));\n\n  /**\n   *  CRS is inherited with behavior \"add\", see Table 7  Inheritance of Layer properties from the spec\n   * @see https://www.ogc.org/standards/wms/ \"OpenGIS Web Map Service (WMS) Implementation Specification\"\n   */\n  const crs = uniq([...parentAttributes.crs, ...layerCrs]);\n\n  const res: RemoteWMSLayer = {\n    // Non unique across layers\n    id: layer.Name,\n    // Unique across layers\n    path: `${currentPath}`,\n    title: layer.Title,\n    description: layer.Abstract ?? \"\",\n    legendUrl: layer.Style?.LegendURL.OnlineResource[\"xlink:href\"],\n    type: \"wms\",\n    ...parentAttributes,\n    crs,\n  };\n\n  if (layer.Layer) {\n    const children = maybeArray(layer.Layer)?.map((l) =>\n      parseWMSLayer(l, parentAttributes, currentPath)\n    );\n    res.children = children;\n  }\n\n  // Hoist single children with same id as parent, this is for UI purposes\n  if (res.children?.length === 1 && res.children[0]!.id === res.id) {\n    return res.children[0];\n  }\n  return res;\n};\n\nexport const DEFAULT_WMS_URL =\n  \"https://wms.geo.admin.ch/?REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.3.0\";\n\nexport const parseWMSContent = (content: string, endpoint: string) => {\n  const parser = new XMLParser({\n    ignoreAttributes: false,\n    attributeNamePrefix: \"\",\n    parseAttributeValue: true,\n  });\n\n  const wmsData = parser.parse(content) as WMSData;\n  const dataUrl =\n    wmsData.WMS_Capabilities.Capability.Request.GetMap.DCPType.HTTP.Get\n      .OnlineResource[\"xlink:href\"];\n  const attribution =\n    wmsData.WMS_Capabilities.Capability.Layer.Attribution?.Title ??\n    wmsData.WMS_Capabilities.Service.Title;\n\n  const layers = Array.isArray(wmsData.WMS_Capabilities.Capability.Layer.Layer)\n    ? wmsData.WMS_Capabilities.Capability.Layer.Layer\n    : [wmsData.WMS_Capabilities.Capability.Layer.Layer];\n  return layers.map((l) =>\n    parseWMSLayer(l, {\n      endpoint,\n      dataUrl,\n      attribution,\n      crs: [],\n    })\n  );\n};\n\nexport const getWMSTile = ({\n  wmsLayer,\n  customLayer,\n  beforeId,\n}: {\n  wmsLayer?: RemoteWMSLayer;\n  customLayer?: WMSCustomLayer | RemoteWMSLayer;\n  beforeId?: string;\n}) => {\n  if (!customLayer) {\n    return;\n  }\n\n  if (!wmsLayer) {\n    return;\n  }\n\n  if (!isRemoteLayerCRSSupported(wmsLayer)) {\n    console.warn(\n      `WMS layer ${wmsLayer.id} is not supported in this map projection`\n    );\n    return;\n  }\n\n  return new DeckGLWMSLayer({\n    id: `wms-layer-${customLayer.id}`,\n    beforeId,\n    data: `${wmsLayer.dataUrl.replace(/\\?$/, \"\")}`,\n    loadOptions: {\n      fetch: (url: string) => {\n        const parsedUrl = new URL(url);\n        parsedUrl.searchParams.set(\"TRANSPARENT\", \"TRUE\");\n        return fetch(parsedUrl.toString());\n      },\n    },\n    serviceType: \"wms\",\n    layers: [wmsLayer.id],\n  });\n};\n","import groupBy from \"lodash/groupBy\";\nimport sortBy from \"lodash/sortBy\";\nimport { useCallback } from \"react\";\n\nimport { parseWMSContent, RemoteWMSLayer } from \"@/charts/map/wms-utils\";\nimport { parseWMTSContent, RemoteWMTSLayer } from \"@/charts/map/wmts-utils\";\nimport { WMSCustomLayer, WMTSCustomLayer } from \"@/config-types\";\nimport { Locale } from \"@/locales/locales\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { visitHierarchy } from \"@/rdf/tree-utils\";\nimport { useFetchData } from \"@/utils/use-fetch-data\";\n\n/** Logic taken from GeoAdmin\n *\n * @see https://github.com/geoadmin/web-mapviewer/blob/develop/packages/mapviewer/src/api/layers/layers-external.api.js#L125\n */\n\n/**\n * Checks if the URL is a WMS url\n *\n * @param {string} url\n * @returns {boolean}\n */\nfunction isWmsUrl(url: string) {\n  return /(wms|map=|\\.map)/i.test(url);\n}\n\n/**\n * Checks if the URL is a WMTS url\n *\n * @param {string} urlreturn SetWmsUrlParameters(new URL(provider), language)\n * @returns {boolean}\n */\nfunction isWmtsUrl(url: string) {\n  return /wmts/i.test(url);\n}\n\nexport const guessUrlType = (url: string) => {\n  if (isWmtsUrl(url)) {\n    return \"wmts\";\n  }\n  if (isWmsUrl(url)) {\n    return \"wms\";\n  }\n  // Default must be coherent with the default in guessExternalLayerUrl\n  return \"wms\";\n};\n\n/**\n * Guess the provider URL type and return URL with correct parameters if needed\n *\n * @param {string} provider Base url of the provider\n * @param {string} language Current viewer language\n * @returns {URL} Url object with backend parameters (eg. SERVICE=WMS, ...)\n */\nfunction guessExternalLayerUrl(provider: string, language: string) {\n  if (isWmtsUrl(provider)) {\n    return {\n      type: \"wmts\" as const,\n      url: setWmtsGetCapParams(new URL(provider), language),\n    };\n  }\n  if (isWmsUrl(provider)) {\n    return {\n      type: \"wms\" as const,\n      url: setWmsGetCapParams(new URL(provider), language),\n    };\n  }\n  // By default if the URL service type cannot be guessed we use WMS\n  return {\n    type: \"wms\",\n    url: setWmsGetCapParams(new URL(provider), language),\n  };\n}\n\n/**\n * Sets the WMTS GetCapabilities url parameters\n *\n * @param {URL} url Url to set\n * @param {string} language Language to use\n * @returns {URL} Url with wmts parameters\n */\nfunction setWmtsGetCapParams(url: URL, language: string) {\n  // Set mandatory parameters\n  url.searchParams.set(\"SERVICE\", \"WMTS\");\n  url.searchParams.set(\"REQUEST\", \"GetCapabilities\");\n  // Set optional parameter\n  if (language) {\n    url.searchParams.set(\"lang\", language);\n  }\n  return url;\n}\n\nfunction setWmsGetCapParams(url: URL, language: string) {\n  // Mandatory params\n  url.searchParams.set(\"SERVICE\", \"WMS\");\n  url.searchParams.set(\"REQUEST\", \"GetCapabilities\");\n  // Currently openlayers only supports version 1.3.0 !\n  url.searchParams.set(\"VERSION\", \"1.3.0\");\n  // Optional params\n  url.searchParams.set(\"FORMAT\", \"text/xml\");\n  if (language) {\n    url.searchParams.set(\"lang\", language);\n  }\n  return url;\n}\n\nconst fetchWMSorWMSLayersFromEndpoint = async (\n  endpoint: string,\n  locale: Locale\n): Promise<(RemoteWMTSLayer | RemoteWMSLayer)[]> => {\n  const { url, type } = guessExternalLayerUrl(endpoint, locale);\n\n  try {\n    const resp = await fetch(url);\n    const text = await resp.text();\n\n    return type === \"wmts\"\n      ? parseWMTSContent(text, endpoint)\n      : parseWMSContent(text, endpoint);\n  } catch {\n    console.error(\n      `Error fetching WMTS layers from endpoint ${endpoint}`,\n      endpoint\n    );\n    return [];\n  }\n};\n\nexport const getLayerKey = ({\n  type,\n  id,\n}: WMTSCustomLayer | WMSCustomLayer | RemoteWMSLayer | RemoteWMTSLayer) => {\n  return `${type}-${id}`;\n};\n\nconst indexByKey = ({\n  wmsLayers,\n  wmtsLayers,\n}: {\n  wmsLayers: RemoteWMSLayer[];\n  wmtsLayers: RemoteWMTSLayer[];\n}): Record<string, RemoteWMSLayer | RemoteWMTSLayer> => {\n  const layersByKey: Record<string, RemoteWMSLayer | RemoteWMTSLayer> = {};\n  visitHierarchy(wmsLayers ?? [], (layer) => {\n    layersByKey[getLayerKey(layer)] = layer;\n  });\n  visitHierarchy(wmtsLayers ?? [], (layer) => {\n    layersByKey[getLayerKey(layer)] = layer;\n  });\n  return layersByKey;\n};\n\n/**\n * Right now we only support EPSG:3857 (same as CRS:84) for remote layers\n * Maybe we could support other projections system but not sure if\n * DeckGL TileLayer could support it or if we should tweak projection\n * when querying or when displaying.\n * @see https://github.com/visgl/deck.gl/discussions/6885#discussioncomment-2703052\n */\nexport const isCRSSupported = (crs: string | undefined) => {\n  return crs && crs.includes(\"EPSG:3857\");\n};\n\nexport const isRemoteLayerCRSSupported = (\n  layer: RemoteWMSLayer | RemoteWMTSLayer\n) => {\n  return (\n    layer.crs &&\n    layer.crs.length > 0 &&\n    layer.crs.some((crs) => isCRSSupported(crs))\n  );\n};\n\nconst DEFAULT_DATA = {\n  wmts: [],\n  wms: [],\n  byKey: {},\n};\n\nexport const useWMTSorWMSLayers = (\n  endpoints: string[],\n  { pause }: { pause?: boolean } = { pause: false }\n) => {\n  const locale = useLocale();\n  const queryFn = useCallback(async () => {\n    const allLayers = (\n      await Promise.all(\n        endpoints.map((endpoint) =>\n          fetchWMSorWMSLayersFromEndpoint(endpoint, locale)\n        )\n      )\n    ).flat();\n    const { wmts = [], wms = [] } = groupBy(allLayers, (x) => x.type);\n    const byKey = indexByKey({\n      wmsLayers: wms as RemoteWMSLayer[],\n      wmtsLayers: wmts as RemoteWMTSLayer[],\n    });\n\n    // Don't know why I need to \"as\" since the groupBy is correctly discriminating on type ?\n    return {\n      wmts: wmts as RemoteWMTSLayer[],\n      wms: wms as RemoteWMSLayer[],\n      byKey,\n    };\n  }, [endpoints, locale]);\n\n  return useFetchData<{\n    wmts: RemoteWMTSLayer[];\n    wms: RemoteWMSLayer[];\n    byKey: Record<string, RemoteWMSLayer | RemoteWMTSLayer>;\n  }>({\n    queryKey: [\"custom-layers\", ...sortBy(endpoints), locale],\n    queryFn,\n    options: {\n      pause: pause || !endpoints.length,\n      defaultData: DEFAULT_DATA,\n    },\n  });\n};\n\nexport const makeKey = (\n  layer: RemoteWMSLayer | RemoteWMTSLayer | WMSCustomLayer | WMTSCustomLayer\n) => {\n  return `${layer.endpoint}/${layer.id}`;\n};\n","export const maybeArray = <T>(x: undefined | T | T[]): undefined | T[] => {\n  if (x === undefined) {\n    return undefined;\n  } else if (Array.isArray(x)) {\n    return x;\n  } else {\n    return [x];\n  }\n};\n\nexport const parseCrs = (crs: string) => {\n  // parses the label (CRS:84) or URL style (urn:ogc:def:crs:EPSG::3857) of CRS\n  // into namespace:number format\n  const urn = /urn:ogc:def:crs:(?<namespace>.*):(?<version>[^:]*)?:(?<id>\\d+)/;\n  const label = /(?<namespace>.*):(?<id>\\d+)/;\n  const match = crs.match(urn) ?? crs.match(label);\n  if (match?.groups) {\n    const { namespace, id } = match.groups;\n    return `${namespace}:${id}`;\n  }\n  return crs;\n};\n","import { TileLayer } from \"@deck.gl/geo-layers\";\nimport { BitmapLayer } from \"@deck.gl/layers\";\nimport { XMLParser } from \"fast-xml-parser\";\nimport uniq from \"lodash/uniq\";\n\nimport {\n  isCRSSupported,\n  isRemoteLayerCRSSupported,\n} from \"@/charts/map/wms-wmts-endpoint-utils\";\nimport { maybeArray, parseCrs } from \"@/charts/map/wms-wmts-parse-utils\";\nimport { WMTSCustomLayer } from \"@/config-types\";\n\ntype WMTSData = {\n  Capabilities: {\n    Contents: {\n      Layer: WMTSLayer[];\n      TileMatrixSet?: {\n        \"ows:Identifier\": string;\n        \"ows:SupportedCRS\": string[] | string;\n        TileMatrix: {\n          \"ows:Identifier\": string;\n          ScaleDenominator: number;\n          TopLeftCorner: string;\n          TileWidth: number;\n          TileHeight: number;\n          MatrixWidth: number;\n          MatrixHeight: number;\n        }[];\n      };\n    };\n    \"ows:ServiceProvider\": {\n      \"ows:ProviderName\": string;\n    };\n    \"ows:OperationsMetadata\": {\n      \"ows:Operation\": {\n        name: string;\n        \"ows:DCP\": {\n          \"ows:HTTP\": {\n            \"ows:Get\": {\n              \"xlink:href\": string;\n            };\n          };\n        };\n      }[];\n    };\n  };\n};\n\ntype WMTSLayer = {\n  Dimension: {\n    Default: string | number;\n    Value: string | number | (string | number)[];\n    \"ows:Identifier\": string;\n  };\n  Format: string;\n  ResourceURL: {\n    format: string;\n    resourceType: string;\n    template: string;\n  };\n  Style: {\n    LegendURL?: {\n      format: string;\n      \"xlink:href\": string;\n    };\n    \"ows:Identifier\": string;\n    \"ows:Title\": string;\n  };\n  TileMatrixSetLink: {\n    TileMatrixSet: string;\n  };\n  \"ows:Abstract\": string;\n  \"ows:Identifier\": string;\n  \"ows:Metadata\": {\n    \"xlink:href\": string;\n  };\n  \"ows:Title\": string;\n  \"ows:WGS84BoundingBox\": {\n    \"ows:LowerCorner\": string;\n    \"ows:UpperCorner\": string;\n  };\n  Layer?: WMTSLayer[];\n};\n\nexport type RemoteWMTSLayer = {\n  id: string;\n  // Path is there to mirror WMS layer, but\n  // not sure this is necessary since I haven't seen nested layers\n  path: string;\n  url: string;\n  title: string;\n  description?: string;\n  legendUrl?: string;\n  dimensionIdentifier: string | undefined;\n  availableDimensionValues: (string | number)[] | undefined;\n  defaultDimensionValue: string | number;\n  endpoint: string;\n  type: \"wmts\";\n  children?: RemoteWMTSLayer[];\n  attribution: string;\n  tileMatrixSets?: TileMatrixSet[] | undefined;\n  crs: string[];\n};\n\ntype TileMatrix = {\n  id: string;\n  scaleDenominator: number;\n  topLeftCorner: [number, number];\n  tileWidth: number;\n  tileHeight: number;\n  matrixWidth: number;\n  matrixHeight: number;\n};\n\ntype TileMatrixSet = {\n  id: string;\n  supportedCRS: string[];\n  tileMatrixes: TileMatrix[];\n};\n\nconst parseTileMatrixSets = (\n  _tileMatrixSet: WMTSData[\"Capabilities\"][\"Contents\"][\"TileMatrixSet\"]\n): TileMatrixSet[] | null => {\n  if (!_tileMatrixSet) {\n    return null;\n  }\n  const tileMatrixSet = Array.isArray(_tileMatrixSet)\n    ? _tileMatrixSet\n    : [_tileMatrixSet];\n\n  const parsedTileMatrixSet = (\n    item: NonNullable<WMTSData[\"Capabilities\"][\"Contents\"][\"TileMatrixSet\"]>\n  ) => {\n    const [x, y] = item.TileMatrix[0].TopLeftCorner.split(\" \").map(Number);\n    const tileMatrixes = Array.isArray(item.TileMatrix)\n      ? item.TileMatrix\n      : [item.TileMatrix];\n    return {\n      id: item[\"ows:Identifier\"],\n      supportedCRS: (maybeArray(item[\"ows:SupportedCRS\"]) ?? []).map((crs) =>\n        parseCrs(crs)\n      ),\n      tileMatrixes: tileMatrixes.map((tm) => ({\n        id: tm[\"ows:Identifier\"],\n        scaleDenominator: tm.ScaleDenominator,\n        topLeftCorner: [x, y] as [number, number],\n        tileWidth: tm.TileWidth,\n        tileHeight: tm.TileHeight,\n        matrixWidth: tm.MatrixWidth,\n        matrixHeight: tm.MatrixHeight,\n      })),\n    };\n  };\n\n  return tileMatrixSet.map(parsedTileMatrixSet);\n};\n\nconst parseWMTSLayer = (\n  layer: WMTSLayer,\n  attributes: {\n    endpoint: string;\n    attribution: string;\n  },\n  tileMatrixById: Record<string, TileMatrixSet> = {},\n  getTileUrl: string | undefined\n): RemoteWMTSLayer => {\n  const tileMatrixSetLinks = maybeArray(layer.TileMatrixSetLink) ?? [];\n  const tileMatrixSets = tileMatrixSetLinks.map(\n    (tl) => tileMatrixById[tl.TileMatrixSet]\n  );\n  const res: RemoteWMTSLayer = {\n    id: layer[\"ows:Identifier\"],\n    path: layer[\"ows:Identifier\"],\n    url: layer.ResourceURL.template || getTileUrl || attributes.endpoint,\n    title: layer[\"ows:Title\"],\n    description: layer[\"ows:Abstract\"],\n    legendUrl: layer.Style.LegendURL?.[\"xlink:href\"],\n    /** @patrick: Not sure why but dimension can be missing (see zh.wmts.xml) */\n    dimensionIdentifier: layer.Dimension?.[\"ows:Identifier\"],\n    availableDimensionValues: layer.Dimension\n      ? Array.isArray(layer.Dimension.Value)\n        ? layer.Dimension.Value\n        : [layer.Dimension.Value]\n      : undefined,\n    defaultDimensionValue: layer.Dimension?.Default,\n    type: \"wmts\",\n    tileMatrixSets: tileMatrixSets,\n    crs: uniq(\n      tileMatrixSets\n        .map((ts) => (ts?.supportedCRS ?? []).map((crs) => parseCrs(crs)))\n        .flat()\n    ),\n    ...attributes,\n  };\n\n  // No children at Layer level, if we want to support it, we need to do this\n  // via the Themes property\n  // @see https://portal.ogc.org/files/?artifact_id=35326\n  // Section7.1.1.1.3\n\n  return res;\n};\n\nconst mapArrayOrUnique = <T, I>(arr: T | T[], cb: (item: T) => I): I[] => {\n  if (Array.isArray(arr)) {\n    return arr.map(cb);\n  }\n  return [cb(arr)];\n};\n\nconst formatGetTileUrl = (url: string) => {\n  /**\n   * We use TileMatrixNamespaced here since when replaced in getDataUrl, we need to have the tileMatrix with the\n   * namespace.\n   * - This is for the getTile case (layer without resourceUrl).\n   * - When layer:resourceUrl is used, we do not need the namespace.\n   */\n  return `${url.endsWith(\"?\") ? url : `${url}?`}Service=WMTS&Request=GetTile&Transparent=true&Version=1.0.0&Format=image/png&tileMatrixSet={TileMatrixSet}&tileMatrix={TileMatrixNamespaced}&tileRow={TileRow}&tileCol={TileCol}&layer={Layer}`;\n};\n\nexport const parseWMTSContent = (content: string, endpoint: string) => {\n  const parser = new XMLParser({\n    ignoreAttributes: false,\n    attributeNamePrefix: \"\",\n    parseAttributeValue: true,\n  });\n  const parsed = parser.parse(content) as WMTSData;\n  const attributes = {\n    endpoint,\n    attribution:\n      parsed.Capabilities[\"ows:ServiceProvider\"]?.[\"ows:ProviderName\"],\n  };\n  const getTileOperation = parsed.Capabilities[\"ows:OperationsMetadata\"]?.[\n    \"ows:Operation\"\n  ]?.find((operation) => operation[\"name\"] === \"GetTile\");\n  const getTileUrlRaw =\n    getTileOperation?.[\"ows:DCP\"]?.[\"ows:HTTP\"]?.[\"ows:Get\"]?.[\"xlink:href\"];\n  const getTileUrl = getTileUrlRaw\n    ? formatGetTileUrl(getTileUrlRaw)\n    : undefined;\n\n  const tileMatrixSets = parseTileMatrixSets(\n    parsed.Capabilities.Contents.TileMatrixSet\n  );\n  const tileMatrixById = tileMatrixSets\n    ? Object.fromEntries(\n        tileMatrixSets.map((tileMatrix) => [tileMatrix.id, tileMatrix])\n      )\n    : {};\n  const Layer = parsed.Capabilities.Contents.Layer;\n  return mapArrayOrUnique(Layer, (l) =>\n    parseWMTSLayer(l, attributes, tileMatrixById, getTileUrl)\n  );\n};\n\nexport const DEFAULT_WMTS_URL =\n  \"https://wmts.geo.admin.ch/EPSG/3857/1.0.0/WMTSCapabilities.xml\";\n\nexport const getWMTSTile = ({\n  wmtsLayer,\n  customLayer,\n  beforeId,\n  value,\n}: {\n  wmtsLayer?: RemoteWMTSLayer;\n  customLayer?: WMTSCustomLayer | RemoteWMTSLayer;\n  beforeId?: string;\n  value?: number | string;\n}) => {\n  const url = customLayer?.url ?? customLayer?.endpoint;\n  if (customLayer && customLayer.url === \"undefined\") {\n    console.warn(\"No url on layer, defaulted to endpoint\");\n    return;\n  }\n  if (!customLayer) {\n    console.warn(\"No custom layer found\");\n    return;\n  }\n\n  if (!wmtsLayer) {\n    console.warn(\"No wmts layer\");\n    return;\n  }\n\n  if (!url) {\n    console.warn(\"No url found\");\n    return;\n  }\n\n  if (!isRemoteLayerCRSSupported(wmtsLayer)) {\n    console.warn(\n      `The WMTS layer ${wmtsLayer.id} does not have a supported CRS, skipping layer.`\n    );\n    return;\n  }\n\n  const espg3857TileMatrixSet = wmtsLayer.tileMatrixSets?.find((tms) => {\n    return tms.supportedCRS.some((crs) => isCRSSupported(crs));\n  });\n\n  const tileLayerDataUrl = getWMTSLayerData(url, {\n    tileMatrixSetId: espg3857TileMatrixSet?.id,\n    identifier: wmtsLayer.dimensionIdentifier,\n    layerId: wmtsLayer.id,\n    value: getWMTSLayerValue({\n      availableDimensionValues: wmtsLayer.availableDimensionValues ?? [],\n      defaultDimensionValue: wmtsLayer.defaultDimensionValue,\n      customLayer,\n      value,\n    }),\n  });\n  return new TileLayer({\n    id: `tile-layer-${url}-${wmtsLayer.id}`,\n    beforeId,\n    data: tileLayerDataUrl,\n    tileSize: 256,\n    renderSubLayers: (props) => {\n      const { boundingBox } = props.tile;\n      return new BitmapLayer(props, {\n        data: undefined,\n        image: props.data,\n        bounds: [\n          boundingBox[0][0],\n          boundingBox[0][1],\n          boundingBox[1][0],\n          boundingBox[1][1],\n        ],\n      });\n    },\n  });\n};\n\nconst getWMTSLayerData = (\n  url: string,\n  {\n    identifier,\n    value,\n    tileMatrixSetId,\n    layerId,\n  }: {\n    identifier: string | undefined;\n    value: string | number;\n    tileMatrixSetId?: TileMatrixSet[\"id\"];\n    layerId?: string;\n  }\n) => {\n  const identifierReplaced = identifier\n    ? url.replace(`{${identifier}}`, `${value}`)\n    : url;\n  return identifierReplaced\n    .replace(`{TileMatrixSet}`, tileMatrixSetId ?? \"{TileMatrixSet}\")\n    .replace(\n      \"{TileMatrixNamespaced}\",\n      tileMatrixSetId ? `${tileMatrixSetId}:{z}` : \"{z}\"\n    )\n    .replace(`{Layer}`, layerId ?? \"{Layer}\")\n    .replace(\"{TileMatrix}\", \"{z}\")\n    .replace(\"{TileCol}\", \"{x}\")\n    .replace(\"{TileRow}\", \"{y}\");\n};\n\nexport const getWMTSLayerValue = ({\n  availableDimensionValues,\n  defaultDimensionValue,\n  customLayer,\n  value,\n}: {\n  availableDimensionValues: (string | number)[];\n  defaultDimensionValue: string | number;\n  customLayer?: WMTSCustomLayer | RemoteWMTSLayer;\n  value?: string | number;\n}) => {\n  if (\n    !customLayer ||\n    (customLayer &&\n      \"syncTemporalFilters\" in customLayer &&\n      !customLayer.syncTemporalFilters)\n  ) {\n    return defaultDimensionValue;\n  }\n\n  return value && availableDimensionValues.includes(value)\n    ? value\n    : defaultDimensionValue;\n};\n","import { bisector } from \"d3-array\";\n\nexport function makeGetClosestDatesFromDateRange<T>(\n  sortedData: T[],\n  getDate: (d: T) => Date\n) {\n  return (from: Date, to: Date) => {\n    if (sortedData.length === 0) {\n      return [from, to] as [Date, Date];\n    }\n\n    const fromTime = from.getTime();\n    const toTime = to.getTime();\n\n    const bisectDateLeft = bisector((d: T, date: Date) => {\n      return getDate(d).getTime() - date.getTime();\n    }).left;\n\n    const startIndex = bisectDateLeft(sortedData, from, 1);\n    const dStartLeft = sortedData[startIndex - 1];\n    const dStartRight = sortedData[startIndex] ?? dStartLeft;\n    const startClosestDatum =\n      fromTime - getDate(dStartLeft).getTime() >\n      getDate(dStartRight).getTime() - fromTime\n        ? dStartRight\n        : dStartLeft;\n\n    const bisectDateRight = bisector((d: T, date: Date) => {\n      return getDate(d).getTime() - date.getTime();\n    }).right;\n    const endIndex = bisectDateRight(sortedData, to, 1);\n    const dEndLeft = sortedData[endIndex - 1];\n    const dEndRight = sortedData[endIndex] ?? dEndLeft;\n    const endClosestDatum =\n      toTime - getDate(dEndLeft).getTime() >\n      getDate(dEndRight).getTime() - toTime\n        ? dEndRight\n        : dEndLeft;\n\n    return [getDate(startClosestDatum), getDate(endClosestDatum)] as [\n      Date,\n      Date,\n    ];\n  };\n}\n","import { Filters, SingleFilters } from \"@/config-types\";\nimport { isJoinById } from \"@/graphql/join\";\n\nexport type PreparedFilter = {\n  cubeIri: string;\n  interactiveFilters: Filters;\n  unmappedFilters: SingleFilters;\n  mappedFilters: Filters;\n  componentIdResolution: Record<string, string>;\n};\n\nexport type GroupedPreparedFilter = {\n  dimensionId: string;\n  entries: GroupedPreparedFilterEntry[];\n};\n\nexport type GroupedPreparedFilterEntry = {\n  cubeIri: string;\n  resolvedDimensionId: string;\n  interactiveFilters: Filters;\n  componentIdResolution: Record<string, string>;\n};\n\nexport const groupPreparedFiltersByDimension = (\n  preparedFilters: PreparedFilter[],\n  componentIds: string[]\n): GroupedPreparedFilter[] => {\n  const groups: Record<string, GroupedPreparedFilterEntry[]> = {};\n\n  for (const preparedFilter of preparedFilters) {\n    for (const id of componentIds) {\n      const resolved = preparedFilter.componentIdResolution[id];\n\n      if (isJoinById(id)) {\n        if (!resolved) {\n          continue;\n        }\n\n        groups[id] = groups[id] ?? [];\n        groups[id].push({\n          cubeIri: preparedFilter.cubeIri,\n          resolvedDimensionId: resolved,\n          interactiveFilters: preparedFilter.interactiveFilters,\n          componentIdResolution: preparedFilter.componentIdResolution,\n        });\n      } else {\n        if (resolved === id) {\n          groups[id] = groups[id] ?? [];\n          groups[id].push({\n            cubeIri: preparedFilter.cubeIri,\n            resolvedDimensionId: id,\n            interactiveFilters: preparedFilter.interactiveFilters,\n            componentIdResolution: preparedFilter.componentIdResolution,\n          });\n        }\n      }\n    }\n  }\n\n  return Object.entries(groups).map(([dimensionId, entries]) => ({\n    dimensionId,\n    entries,\n  }));\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Button, SelectChangeEvent, Typography } from \"@mui/material\";\nimport isEmpty from \"lodash/isEmpty\";\nimport isEqual from \"lodash/isEqual\";\nimport mapValues from \"lodash/mapValues\";\nimport pickBy from \"lodash/pickBy\";\nimport { ChangeEvent, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useClient } from \"urql\";\n\nimport {\n  groupPreparedFiltersByDimension,\n  PreparedFilter,\n} from \"@/charts/shared/chart-data-filters/group-filters\";\nimport { useQueryFilters } from \"@/charts/shared/chart-helpers\";\nimport { useLoadingState } from \"@/charts/shared/chart-loading-state\";\nimport {\n  getPossibleFiltersQueryVariables,\n  skipPossibleFiltersQuery,\n} from \"@/charts/shared/possible-filters\";\nimport { Flex } from \"@/components/flex\";\nimport { Select } from \"@/components/form\";\nimport { OpenMetadataPanelWrapper } from \"@/components/metadata-panel\";\nimport { MultiSelect } from \"@/components/multi-select\";\nimport { SelectTree, Tree } from \"@/components/select-tree\";\nimport { isTableConfig } from \"@/config-types\";\nimport {\n  areDataFiltersActive,\n  ChartConfig,\n  DashboardFiltersConfig,\n  DataSource,\n  Filters,\n  getFiltersByMappingStatus,\n  SingleFilters,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { FieldLabel, LoadingIndicator } from \"@/configurator/components/field\";\nimport {\n  canRenderDatePickerField,\n  DatePickerField,\n} from \"@/configurator/components/field-date-picker\";\nimport { getOrderedTableColumns } from \"@/configurator/components/ui-helpers\";\nimport { extractDataPickerOptionsFromDimension } from \"@/configurator/components/ui-helpers\";\nimport { Option } from \"@/configurator/config-form\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { Dimension, HierarchyValue, TemporalDimension } from \"@/domain/data\";\nimport { useTimeFormatLocale } from \"@/formatters\";\nimport { getResolvedJoinById, isJoinById } from \"@/graphql/join\";\nimport {\n  PossibleFiltersDocument,\n  PossibleFiltersQuery,\n  PossibleFiltersQueryVariables,\n} from \"@/graphql/query-hooks\";\nimport { Icon } from \"@/icons\";\nimport {\n  useChartInteractiveFilters,\n  useInteractiveFiltersGetState,\n} from \"@/stores/interactive-filters\";\nimport { assert } from \"@/utils/assert\";\nimport { hierarchyToOptions } from \"@/utils/hierarchy\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const useChartDataFiltersState = ({\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n}: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n}) => {\n  const dataFiltersConfig = chartConfig.interactiveFiltersConfig.dataFilters;\n  const active = dataFiltersConfig.active;\n  const defaultOpen = dataFiltersConfig.defaultOpen;\n  const configComponentIds = dataFiltersConfig.componentIds;\n\n  const componentIds = useMemo(() => {\n    const excludeDashboardFilters = (id: string) => {\n      return !dashboardFilters?.dataFilters.componentIds.includes(id);\n    };\n\n    if (isTableConfig(chartConfig)) {\n      const orderedIds = getOrderedTableColumns(chartConfig.fields).map(\n        (c) => c.componentId\n      );\n\n      return orderedIds.filter(\n        (id) => configComponentIds.includes(id) && excludeDashboardFilters(id)\n      );\n    }\n\n    return configComponentIds.filter(excludeDashboardFilters);\n  }, [chartConfig, configComponentIds, dashboardFilters]);\n  const [open, setOpen] = useState(!!defaultOpen);\n\n  useEffect(() => {\n    setOpen(!!defaultOpen);\n  }, [active, defaultOpen]);\n\n  const { loading } = useLoadingState();\n  const queryFilters = useQueryFilters({\n    chartConfig,\n    dashboardFilters,\n    componentIds,\n  });\n  const preparedFilters = useMemo(() => {\n    return chartConfig.cubes.map((cube) => {\n      const cubeQueryFilters = queryFilters.find((d) => d.iri === cube.iri);\n      assert(cubeQueryFilters, \"Cube query filters not found.\");\n      const filtersByMappingStatus = getFiltersByMappingStatus(chartConfig, {\n        cubeIri: cube.iri,\n        joinByIds: componentIds.filter(isJoinById),\n      });\n      const { unmappedFilters, mappedFilters } = filtersByMappingStatus;\n      const unmappedKeys = Object.keys(unmappedFilters);\n      const filters = cubeQueryFilters.filters ?? {};\n      const unmappedEntries = Object.entries(filters).filter(\n        ([unmappedComponentId]) => unmappedKeys.includes(unmappedComponentId)\n      );\n      const cubeComponentIds = [\n        ...Object.keys(filters),\n        ...Object.keys(chartConfig.fields),\n        ...Object.values(chartConfig.fields).map((field) => field.componentId),\n      ].filter(Boolean);\n\n      const componentIdPairs = componentIds\n        .map((originalId) => {\n          const resolvedId = isJoinById(originalId)\n            ? (getResolvedJoinById(cube, originalId) ?? originalId)\n            : originalId;\n\n          return { originalId, resolvedId };\n        })\n        .filter(({ resolvedId, originalId }) => {\n          return resolvedId === originalId\n            ? cubeComponentIds.includes(resolvedId)\n            : true;\n        });\n\n      const componentIdResolution = Object.fromEntries(\n        componentIdPairs.map(({ originalId, resolvedId }) => [\n          originalId,\n          resolvedId,\n        ])\n      );\n\n      const interactiveFiltersList = componentIdPairs.map(\n        ({ originalId, resolvedId }) => {\n          const existingEntry = unmappedEntries.find(\n            ([unmappedComponentId]) => unmappedComponentId === resolvedId\n          );\n\n          if (existingEntry) {\n            return [originalId, existingEntry[1]];\n          }\n\n          return [originalId, undefined];\n        }\n      );\n\n      return {\n        cubeIri: cube.iri,\n        interactiveFilters: Object.fromEntries(interactiveFiltersList),\n        unmappedFilters: Object.fromEntries(unmappedEntries) as SingleFilters,\n        mappedFilters,\n        componentIdResolution,\n      };\n    });\n  }, [chartConfig, componentIds, queryFilters]);\n  const groupedPreparedFilters = useMemo(() => {\n    return groupPreparedFiltersByDimension(preparedFilters, componentIds);\n  }, [preparedFilters, componentIds]);\n  const { error } = useEnsurePossibleInteractiveFilters({\n    dataSource,\n    chartConfig,\n    preparedFilters,\n    dashboardFilters,\n  });\n\n  return {\n    open,\n    setOpen,\n    defaultOpen,\n    dataSource,\n    chartConfig,\n    loading,\n    error,\n    preparedFilters,\n    groupedPreparedFilters,\n    componentIds,\n  };\n};\n\nexport const ChartDataFiltersToggle = ({\n  open,\n  setOpen,\n  defaultOpen,\n  loading,\n  error,\n  componentIds,\n}: ReturnType<typeof useChartDataFiltersState>) => {\n  return error ? (\n    <Typography variant=\"body2\" color=\"error\">\n      <Trans id=\"controls.section.data.filters.possible-filters-error\">\n        An error happened while fetching possible filters, please retry later or\n        reload the page.\n      </Trans>\n    </Typography>\n  ) : defaultOpen ? null : (\n    <Flex sx={{ flexDirection: \"column\", width: \"100%\" }}>\n      <Flex\n        sx={{\n          alignItems: \"flex-start\",\n          gap: 3,\n          minHeight: 20,\n        }}\n      >\n        {componentIds && componentIds.length > 0 && (\n          <Button\n            variant=\"text\"\n            color=\"primary\"\n            size=\"sm\"\n            endIcon={\n              <Icon\n                name=\"plus\"\n                size={16}\n                style={{\n                  transform: open ? \"rotate(45deg)\" : \"rotate(0deg)\",\n                  transition: \"transform 0.2s ease-in-out\",\n                }}\n              />\n            }\n            sx={{\n              display: \"flex\",\n              alignItems: \"center\",\n              minWidth: \"fit-content\",\n              minHeight: 0,\n              ml: -2,\n              px: 2,\n              py: 1,\n            }}\n            onClick={() => setOpen((prev) => !prev)}\n          >\n            {loading && (\n              <span style={{ marginTop: \"0.1rem\", marginRight: \"0.5rem\" }}>\n                <LoadingIndicator />\n              </span>\n            )}\n            <Typography variant=\"body2\">\n              {open ? (\n                <Trans id=\"interactive.data.filters.hide\">Hide Filters</Trans>\n              ) : (\n                <Trans id=\"interactive.data.filters.show\">Show Filters</Trans>\n              )}\n            </Typography>\n          </Button>\n        )}\n      </Flex>\n    </Flex>\n  );\n};\n\n// We need to include filters that are not interactive filters, to only\n// show values that make sense in the context of the current filters.\nexport const getInteractiveQueryFilters = ({\n  filters,\n  interactiveFilters,\n}: {\n  filters: Filters;\n  interactiveFilters: Filters;\n}) => {\n  const nonInteractiveFilters = pickBy(\n    filters,\n    (_, componentId) => !(componentId in interactiveFilters)\n  );\n  let i = 0;\n\n  return mapValues({ ...nonInteractiveFilters, ...interactiveFilters }, (v) => {\n    if (v === undefined) {\n      return {\n        type: \"single\" as const,\n        value: FIELD_VALUE_NONE,\n        position: i++,\n      };\n    }\n\n    return { ...v, position: i++ };\n  });\n};\n\nexport type DataFilterGenericDimensionProps = {\n  configFilter?: Filters[string];\n  dimension: Dimension;\n  value: string;\n  values?: string[];\n  isMulti?: boolean;\n  onChange: (e: SelectChangeEvent<unknown>) => void;\n  onMultiChange?: (values: string[]) => void;\n  options?: Array<{ label: string; value: string }>;\n  disabled: boolean;\n};\n\nexport const DataFilterGenericDimension = ({\n  configFilter,\n  dimension,\n  value,\n  values = [],\n  isMulti = false,\n  onChange,\n  onMultiChange,\n  options: _options,\n  disabled,\n}: DataFilterGenericDimensionProps) => {\n  const { label, isKeyDimension } = dimension;\n  const noneLabel = t({\n    id: \"controls.dimensionvalue.select\",\n    message: \"Select filter\",\n  });\n  const clearSelectionLabel = t({\n    id: \"controls.clear-selection\",\n    message: \"Clear selection\",\n  });\n  const options: Option[] = _options ?? dimension.values;\n  const allOptions: Option[] = useMemo(() => {\n    const clearSelectionOption = {\n      value: FIELD_VALUE_NONE,\n      label: clearSelectionLabel,\n      isNoneValue: true,\n    };\n\n    if (isMulti && onMultiChange) {\n      if (!configFilter) {\n        return [clearSelectionOption, ...options];\n      }\n\n      if (configFilter.type === \"multi\") {\n        return [\n          clearSelectionOption,\n          ...options.filter((d) => configFilter.values[d.value]),\n        ];\n      }\n    }\n\n    return isKeyDimension\n      ? options\n      : [\n          { value: FIELD_VALUE_NONE, label: noneLabel, isNoneValue: true },\n          ...options,\n        ];\n  }, [\n    clearSelectionLabel,\n    isMulti,\n    onMultiChange,\n    isKeyDimension,\n    options,\n    noneLabel,\n    configFilter,\n  ]);\n\n  const fieldLabel = (\n    <FieldLabel\n      label={\n        <OpenMetadataPanelWrapper component={dimension}>\n          {label}\n        </OpenMetadataPanelWrapper>\n      }\n    />\n  );\n\n  if (isMulti && onMultiChange) {\n    const displayValues = values.filter((value) => value !== FIELD_VALUE_NONE);\n\n    return (\n      <MultiSelect\n        id=\"dataFilterBaseDimension\"\n        label={fieldLabel}\n        options={allOptions}\n        value={displayValues}\n        onChange={onMultiChange}\n        size=\"sm\"\n        disabled={disabled}\n        placeholder={noneLabel}\n      />\n    );\n  }\n\n  return (\n    <Select\n      id=\"dataFilterBaseDimension\"\n      size=\"sm\"\n      label={fieldLabel}\n      options={allOptions}\n      value={value}\n      onChange={onChange}\n      disabled={disabled}\n    />\n  );\n};\n\nexport const DataFilterHierarchyDimension = ({\n  configFilter,\n  dimension,\n  value,\n  values = [],\n  isMulti = false,\n  onChange,\n  onMultiChange,\n  hierarchy,\n  disabled,\n}: {\n  configFilter?: Filters[string];\n  dimension: Dimension;\n  value: string;\n  values?: string[];\n  isMulti?: boolean;\n  onChange: (e: { target: { value: string } }) => void;\n  onMultiChange?: (values: string[]) => void;\n  hierarchy?: HierarchyValue[];\n  disabled: boolean;\n}) => {\n  const { label, isKeyDimension, values: dimensionValues } = dimension;\n  const noneLabel = t({\n    id: \"controls.dimensionvalue.select\",\n    message: \"Select filter\",\n  });\n  const options: Tree = useMemo(() => {\n    const noneOption = {\n      value: FIELD_VALUE_NONE,\n      label: noneLabel,\n      isNoneValue: true,\n      hasValue: true,\n    };\n\n    const opts = (\n      hierarchy\n        ? hierarchyToOptions(\n            hierarchy,\n            dimensionValues.map((d) => d.value)\n          )\n        : dimensionValues\n    ) as {\n      label: string;\n      value: string;\n      isNoneValue?: boolean;\n      hasValue: boolean;\n    }[];\n\n    if (!configFilter) {\n      return [noneOption, ...opts];\n    }\n\n    if (configFilter.type === \"multi\") {\n      const filteredOptions = filterTreeRecursively(opts, configFilter);\n      return [noneOption, ...filteredOptions];\n    }\n\n    if (!isKeyDimension || configFilter.type !== \"single\") {\n      opts.unshift(noneOption);\n    }\n\n    return opts;\n  }, [noneLabel, hierarchy, dimensionValues, configFilter, isKeyDimension]);\n\n  const handleChange = useEvent(\n    (e: { target: { value: string | string[] } }) => {\n      if (isMulti && onMultiChange && Array.isArray(e.target.value)) {\n        onMultiChange(e.target.value);\n      } else if (!isMulti && typeof e.target.value === \"string\") {\n        onChange({ target: { value: e.target.value } });\n      }\n    }\n  );\n\n  const displayValues = isMulti\n    ? values.filter((value) => value !== FIELD_VALUE_NONE)\n    : [];\n  const displayValue = isMulti ? displayValues : value;\n\n  return (\n    <SelectTree\n      value={displayValue}\n      options={options}\n      onChange={handleChange}\n      isMulti={isMulti}\n      label={\n        <FieldLabel\n          label={\n            <OpenMetadataPanelWrapper component={dimension}>\n              {label}\n            </OpenMetadataPanelWrapper>\n          }\n        />\n      }\n      disabled={disabled}\n    />\n  );\n};\n\nexport const DataFilterTemporalDimension = ({\n  configFilter,\n  dimension,\n  value,\n  onChange,\n  disabled,\n}: {\n  configFilter?: Filters[string];\n  dimension: TemporalDimension;\n  value: string;\n  onChange: (\n    e: SelectChangeEvent<unknown> | ChangeEvent<HTMLSelectElement>\n  ) => void;\n  disabled: boolean;\n}) => {\n  const { label, timeUnit, timeFormat } = dimension;\n  const formatLocale = useTimeFormatLocale();\n  const formatDate = formatLocale.format(timeFormat);\n  const parseDate = formatLocale.parse(timeFormat);\n\n  const { minDate, maxDate, options, optionValues } = useMemo(() => {\n    return extractDataPickerOptionsFromDimension({\n      dimension,\n      parseDate,\n    });\n  }, [dimension, parseDate]);\n\n  return canRenderDatePickerField(timeUnit) ? (\n    <DatePickerField\n      name={`interactive-date-picker-${dimension.id}`}\n      label={\n        <FieldLabel\n          label={\n            <OpenMetadataPanelWrapper component={dimension}>\n              {label}\n            </OpenMetadataPanelWrapper>\n          }\n        />\n      }\n      value={parseDate(value) as Date}\n      onChange={onChange}\n      isDateDisabled={(d) => !optionValues.includes(formatDate(d))}\n      timeUnit={timeUnit}\n      dateFormat={formatDate}\n      minDate={minDate}\n      maxDate={maxDate}\n      disabled={disabled}\n      parseDate={parseDate}\n      showClearButton={configFilter?.type !== \"single\"}\n    />\n  ) : (\n    <DataFilterGenericDimension\n      configFilter={configFilter}\n      dimension={dimension}\n      options={options}\n      value={value}\n      onChange={onChange}\n      disabled={disabled}\n    />\n  );\n};\n\n/**\n * This runs every time the state changes and it ensures that the selected interactive\n * filters return at least 1 observation. Otherwise they are reloaded.\n *\n * This behavior is disabled when the dashboard filters are active.\n */\nconst useEnsurePossibleInteractiveFilters = ({\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n  preparedFilters,\n}: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  preparedFilters?: PreparedFilter[];\n}) => {\n  const [, dispatch] = useConfiguratorState();\n  const loadingState = useLoadingState();\n  const [error, setError] = useState<Error>();\n  const lastFilters = useRef<Record<string, Filters>>({});\n  const client = useClient();\n  const getInteractiveFiltersState = useInteractiveFiltersGetState();\n  const setDataFilters = useChartInteractiveFilters((d) => d.setDataFilters);\n  const filtersByCubeIri = useMemo(() => {\n    return preparedFilters?.reduce<Record<string, PreparedFilter>>((acc, d) => {\n      acc[d.cubeIri] = d;\n      return acc;\n    }, {});\n  }, [preparedFilters]);\n\n  const dataFiltersActive = areDataFiltersActive(dashboardFilters);\n\n  useEffect(() => {\n    const run = async () => {\n      if (!filtersByCubeIri || dataFiltersActive) {\n        return;\n      }\n\n      chartConfig.cubes.forEach(async (cube) => {\n        const { mappedFilters, unmappedFilters, interactiveFilters } =\n          filtersByCubeIri[cube.iri];\n\n        if (\n          skipPossibleFiltersQuery(\n            lastFilters.current[cube.iri],\n            unmappedFilters\n          )\n        ) {\n          return;\n        }\n\n        lastFilters.current[cube.iri] = unmappedFilters;\n        loadingState.set(\"possible-interactive-filters\", true);\n        const variables = getPossibleFiltersQueryVariables({\n          cubeIri: cube.iri,\n          dataSource,\n          unmappedFilters,\n        });\n        const { data, error } = await client\n          .query<\n            PossibleFiltersQuery,\n            PossibleFiltersQueryVariables\n          >(PossibleFiltersDocument, variables)\n          .toPromise();\n\n        if (error || !data) {\n          setError(error);\n          loadingState.set(\"possible-interactive-filters\", false);\n          console.error(\"Could not fetch possible filters\", error);\n\n          return;\n        }\n\n        setError(undefined);\n        loadingState.set(\"possible-interactive-filters\", false);\n\n        const filters = Object.assign(\n          Object.fromEntries(\n            data.possibleFilters.map((d) => {\n              const interactiveFilter = interactiveFilters[d.id];\n              return [\n                d.id,\n                {\n                  type: d.type,\n                  value:\n                    // We want to keep the none filter without overriding them.\n                    interactiveFilter?.type === \"single\" &&\n                    interactiveFilter.value === FIELD_VALUE_NONE\n                      ? FIELD_VALUE_NONE\n                      : d.value,\n                },\n              ];\n            })\n          ) as Filters,\n          mappedFilters\n        );\n\n        // We need to get the values dynamically, as they can get updated by\n        // useSyncInteractiveFilters and this callback runs with old value.\n        const dataFilters = { ...getInteractiveFiltersState().dataFilters };\n        const filtersToUpdate = Object.fromEntries(\n          Object.entries(filters).filter(\n            ([k, v]) => k in dataFilters && v.type === \"single\"\n          )\n        );\n\n        if (\n          !isEqual(filtersToUpdate, interactiveFilters) &&\n          !isEmpty(filtersToUpdate)\n        ) {\n          for (const [k, v] of Object.entries(filters)) {\n            if (k in dataFilters && v.type === \"single\") {\n              dataFilters[k] = v;\n            }\n          }\n\n          setDataFilters(dataFilters);\n        }\n      });\n    };\n\n    run();\n  }, [\n    client,\n    dispatch,\n    chartConfig.fields,\n    chartConfig.cubes,\n    dataSource,\n    setDataFilters,\n    loadingState,\n    filtersByCubeIri,\n    getInteractiveFiltersState,\n    dataFiltersActive,\n  ]);\n\n  return { error };\n};\n\nconst filterTreeRecursively = (\n  options: Tree,\n  configFilter: Filters[string]\n): Tree => {\n  if (!configFilter || configFilter.type !== \"multi\") {\n    return options;\n  }\n\n  const shouldIncludeNode = (node: Tree[number]): boolean => {\n    if (configFilter.values[node.value]) {\n      return true;\n    }\n\n    if (node.children && node.children.length > 0) {\n      return node.children.some(shouldIncludeNode);\n    }\n\n    return false;\n  };\n\n  const filterNode = (node: Tree[number]): Tree[number] | null => {\n    if (shouldIncludeNode(node)) {\n      const filteredChildren = node.children\n        ? node.children\n            .map(filterNode)\n            .filter((child): child is Tree[number] => child !== null)\n        : undefined;\n\n      return {\n        ...node,\n        children: filteredChildren,\n        selectable: configFilter\n          ? !!configFilter.values[node.value]\n          : !!node.hasValue,\n      };\n    }\n\n    return null;\n  };\n\n  return options\n    .map(filterNode)\n    .filter((node): node is Tree[number] => node !== null);\n};\n","import { useCallback, useMemo } from \"react\";\n\nimport { DimensionValue, Observation, ObservationValue } from \"@/domain/data\";\n\nexport const useMaybeAbbreviations = ({\n  useAbbreviations,\n  dimensionId,\n  dimensionValues,\n}: {\n  useAbbreviations: boolean | undefined;\n  dimensionId: string | undefined;\n  dimensionValues: DimensionValue[] | undefined;\n}) => {\n  const { valueLookup, labelLookup, abbreviationOrLabelLookup } =\n    useMemo(() => {\n      const values = dimensionValues ?? [];\n\n      const valueLookup = new Map<\n        NonNullable<ObservationValue>,\n        DimensionValue\n      >();\n      const labelLookup = new Map<string, DimensionValue>();\n\n      for (const d of values) {\n        valueLookup.set(d.value, d);\n        labelLookup.set(d.label, d);\n      }\n\n      const abbreviationOrLabelLookup = new Map(\n        Array.from(labelLookup, ([k, v]) => [\n          useAbbreviations ? v.alternateName ?? k : k,\n          v,\n        ])\n      );\n\n      return {\n        valueLookup,\n        labelLookup,\n        abbreviationOrLabelLookup,\n      };\n    }, [dimensionValues, useAbbreviations]);\n\n  const getAbbreviationOrLabelByValue = useCallback(\n    (d: Observation) => {\n      if (!dimensionId) {\n        return \"\";\n      }\n\n      const value = d[`${dimensionId}/__iri__`] as string | undefined;\n      const label = d[dimensionId] as string | undefined;\n\n      if (value === undefined && label === undefined) {\n        return \"\";\n      }\n\n      const lookedUpObservation =\n        (value ? valueLookup.get(value) : null) ??\n        (label ? labelLookup.get(label) : null);\n\n      const lookedUpLabel = lookedUpObservation?.label ?? \"\";\n\n      return useAbbreviations\n        ? lookedUpObservation?.alternateName ?? lookedUpLabel\n        : lookedUpLabel;\n    },\n    [dimensionId, valueLookup, labelLookup, useAbbreviations]\n  );\n\n  return {\n    abbreviationOrLabelLookup,\n    getAbbreviationOrLabelByValue,\n  };\n};\n","import { useCallback, useMemo } from \"react\";\n\nimport { Observation } from \"@/domain/data\";\n\n/** Use this hook to be able to retrieve observation values and labels,\n * where the value is the id if present, otherwise the label.\n *\n * @param data The data to retrieve the labels from.\n * @param getLabel A function that returns the label (or abbreviation) for a given observation.\n * @param componentId The id of the component to extract value / label for.\n */\nexport const useObservationLabels = (\n  data: Observation[],\n  getLabel: (d: Observation) => string,\n  componentId?: string\n) => {\n  const getId = useCallback(\n    (d: Observation) => {\n      const id = d[`${componentId}/__iri__`] as string | undefined;\n      return id;\n    },\n    [componentId]\n  );\n\n  const lookup = useMemo(() => {\n    const lookup = new Map<string, string>();\n    data.forEach((d) => {\n      const id = getId(d);\n      const label = getLabel(d);\n      lookup.set(id ?? label, label);\n    });\n\n    return lookup;\n  }, [data, getId, getLabel]);\n\n  const getValue = useCallback(\n    (d: Observation) => {\n      return getId(d) ?? getLabel(d);\n    },\n    [getId, getLabel]\n  );\n\n  const getLookupLabel = useCallback(\n    (d: string) => {\n      return lookup.get(d) ?? d;\n    },\n    [lookup]\n  );\n\n  return {\n    getValue,\n    getLabel: getLookupLabel,\n  };\n};\n","import { InternMap, sum } from \"d3-array\";\nimport omitBy from \"lodash/omitBy\";\nimport uniq from \"lodash/uniq\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { useMaybeAbbreviations } from \"@/charts/shared/abbreviations\";\nimport {\n  imputeTemporalLinearSeries,\n  interpolateZerosValue,\n} from \"@/charts/shared/imputation\";\nimport { useObservationLabels } from \"@/charts/shared/observation-labels\";\nimport {\n  AnimationField,\n  ChartConfig,\n  Filters,\n  ImputationType,\n  InteractiveFiltersConfig,\n  InteractiveFiltersDataConfig,\n  InteractiveFiltersLegend,\n  InteractiveFiltersTimeRange,\n  isAnimationInConfig,\n  MapConfig,\n} from \"@/config-types\";\nimport { getChartConfigFilters } from \"@/config-utils\";\nimport {\n  CategoricalColorField,\n  ComboChartConfig,\n  DashboardFiltersConfig,\n  GenericField,\n  isComboChartConfig,\n  NumericalColorField,\n} from \"@/configurator\";\nimport { parseDate } from \"@/configurator/components/ui-helpers\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport {\n  Component,\n  Dimension,\n  DimensionValue,\n  getTemporalEntityValue,\n  Observation,\n  ObservationValue,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport {\n  getOriginalIds,\n  getResolvedJoinById,\n  isJoinById,\n} from \"@/graphql/join\";\nimport { DataCubeObservationFilter } from \"@/graphql/resolver-types\";\nimport {\n  InteractiveFiltersState,\n  useChartInteractiveFilters,\n} from \"@/stores/interactive-filters\";\n\n// Prepare filters used in data query:\n// - merges publisher data filters, interactive data filters, and dashboard filters\n//   if applicable\n// - removes none values since they should not be sent as part of the GraphQL query\nexport const prepareCubeQueryFilters = ({\n  chartConfig,\n  cubeFilters,\n  animationField,\n  interactiveFiltersConfig,\n  dashboardFilters,\n  interactiveDataFilters,\n}: {\n  chartConfig: ChartConfig;\n  cubeFilters: Filters;\n  animationField: AnimationField | undefined;\n  interactiveFiltersConfig: InteractiveFiltersConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  interactiveDataFilters: InteractiveFiltersState[\"dataFilters\"];\n}): Filters => {\n  const queryFilters = { ...cubeFilters };\n  const dashboardFiltersComponentIds =\n    dashboardFilters?.dataFilters.componentIds ?? [];\n\n  for (const [k, v] of Object.entries(\n    dashboardFilters?.dataFilters.filters ?? {}\n  )) {\n    if (\n      k in cubeFilters &&\n      dashboardFiltersComponentIds.includes(k) &&\n      animationField?.componentId !== k\n    ) {\n      queryFilters[k] = v;\n    }\n  }\n\n  const resolvedInteractiveFiltersConfigComponentIds =\n    interactiveFiltersConfig.dataFilters.componentIds.flatMap((k) =>\n      isJoinById(k) ? getOriginalIds(k, chartConfig) : [k]\n    );\n\n  for (const [k, v] of Object.entries(interactiveDataFilters)) {\n    const interactiveActiveForKey =\n      interactiveFiltersConfig.dataFilters.active &&\n      resolvedInteractiveFiltersConfigComponentIds.includes(k);\n\n    const hasFilterValue =\n      (v.type === \"single\" && v.value !== FIELD_VALUE_NONE) ||\n      (v.type === \"multi\" && Object.keys(v.values).length > 0);\n\n    const shouldApplyInteractiveFilter =\n      interactiveActiveForKey ||\n      (resolvedInteractiveFiltersConfigComponentIds.includes(k) &&\n        hasFilterValue);\n\n    if (\n      (shouldApplyInteractiveFilter ||\n        dashboardFiltersComponentIds.includes(k)) &&\n      animationField?.componentId !== k\n    ) {\n      if (v.type === \"single\" && v.value === FIELD_VALUE_NONE) {\n        if (!(k in cubeFilters) || cubeFilters[k].type !== \"multi\") {\n          delete queryFilters[k];\n        }\n      } else if (v.type === \"multi\" && Object.keys(v.values).length === 0) {\n        if (!(k in cubeFilters) || cubeFilters[k].type !== \"multi\") {\n          delete queryFilters[k];\n        }\n      } else {\n        queryFilters[k] = v;\n      }\n    }\n  }\n\n  return omitBy(\n    queryFilters,\n    (v) => v.type === \"single\" && v.value === FIELD_VALUE_NONE\n  );\n};\n\nexport const useQueryFilters = ({\n  chartConfig,\n  dashboardFilters,\n  componentIds,\n}: {\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  componentIds?: string[];\n}): DataCubeObservationFilter[] => {\n  const chartInteractiveFilters = useChartInteractiveFilters(\n    (d) => d.dataFilters\n  );\n  const resolvedChartInteractiveFilters = useMemo(() => {\n    return Object.fromEntries(\n      Object.entries(chartInteractiveFilters).flatMap(([k, v]) => {\n        const resolvedIds = isJoinById(k)\n          ? getOriginalIds(k, chartConfig)\n          : [k];\n        return resolvedIds.map((id) => [id, v]);\n      })\n    );\n  }, [chartInteractiveFilters, chartConfig]);\n  const animationField = isAnimationInConfig(chartConfig)\n    ? chartConfig.fields.animation\n    : undefined;\n\n  return useMemo(() => {\n    return chartConfig.cubes.map((cube) => {\n      const rawCubeFilters = getChartConfigFilters(chartConfig.cubes, {\n        cubeIri: cube.iri,\n      });\n      const cubeFilters = Object.fromEntries(\n        Object.entries(rawCubeFilters).map(([key, value]) => [\n          isJoinById(key) ? (getResolvedJoinById(cube, key) ?? key) : key,\n          value,\n        ])\n      );\n      const cubeComponentIds = [\n        ...Object.keys(cubeFilters),\n        ...Object.keys(chartConfig.fields),\n        ...Object.values(chartConfig.fields).map((field) => field.componentId),\n      ]\n        .filter(truthy)\n        .map((id) =>\n          isJoinById(id) ? (getResolvedJoinById(cube, id) ?? id) : id\n        );\n      const cubeInteractiveDataFilters = Object.fromEntries(\n        Object.entries(resolvedChartInteractiveFilters).filter(\n          ([componentId]) => cubeComponentIds.includes(componentId)\n        )\n      );\n\n      const preparedFilters = prepareCubeQueryFilters({\n        chartConfig,\n        cubeFilters,\n        animationField,\n        interactiveFiltersConfig: chartConfig.interactiveFiltersConfig,\n        dashboardFilters,\n        interactiveDataFilters: cubeInteractiveDataFilters,\n      });\n\n      return {\n        iri: cube.iri,\n        componentIds,\n        filters: preparedFilters,\n        joinBy: cube.joinBy,\n      } satisfies DataCubeObservationFilter;\n    });\n  }, [\n    chartConfig,\n    resolvedChartInteractiveFilters,\n    animationField,\n    dashboardFilters,\n    componentIds,\n  ]);\n};\n\ntype IFKey = keyof NonNullable<InteractiveFiltersConfig>;\n\nconst getChartConfigFilterComponentIds = ({ cubes }: ChartConfig) => {\n  return Object.keys(getChartConfigFilters(cubes)).filter(\n    (d) => !isJoinById(d)\n  );\n};\n\nconst getMapChartConfigAdditionalFieldIds = ({ fields }: MapConfig) => {\n  const { areaLayer, symbolLayer } = fields;\n  const additionalFields = [];\n\n  if (areaLayer) {\n    additionalFields.push(areaLayer.color.componentId);\n  }\n\n  if (symbolLayer) {\n    if (symbolLayer.measureId !== FIELD_VALUE_NONE) {\n      additionalFields.push(symbolLayer.measureId);\n    }\n\n    if ([\"categorical\", \"numerical\"].includes(symbolLayer.color.type)) {\n      additionalFields.push(\n        (symbolLayer.color as CategoricalColorField | NumericalColorField)\n          .componentId\n      );\n    }\n  }\n\n  return additionalFields;\n};\n\nconst getComboChartComponentIds = (chartConfig: ComboChartConfig) => {\n  switch (chartConfig.chartType) {\n    case \"comboLineSingle\":\n      return chartConfig.fields.y.componentIds;\n    case \"comboLineDual\":\n      return [\n        chartConfig.fields.y.leftAxisComponentId,\n        chartConfig.fields.y.rightAxisComponentId,\n      ];\n    case \"comboLineColumn\":\n      return [\n        chartConfig.fields.y.columnComponentId,\n        chartConfig.fields.y.lineComponentId,\n      ];\n    default:\n      const _exhaustiveCheck: never = chartConfig;\n      return _exhaustiveCheck;\n  }\n};\n\nexport const extractChartConfigsComponentIds = (\n  chartConfigs: ChartConfig[]\n) => {\n  return uniq(\n    chartConfigs\n      .map((chartConfig) => extractChartConfigComponentIds({ chartConfig }))\n      .flat()\n  );\n};\n\nexport const extractChartConfigComponentIds = ({\n  chartConfig,\n  includeFilters = true,\n}: {\n  chartConfig: ChartConfig;\n  includeFilters?: boolean;\n}): string[] => {\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const fieldIds = Object.values<GenericField>(\n    // @ts-ignore - we are only interested in component ids\n    fields\n  ).map((field) => field.componentId);\n  const additionalFieldIds =\n    chartConfig.chartType === \"map\"\n      ? getMapChartConfigAdditionalFieldIds(chartConfig)\n      : isComboChartConfig(chartConfig)\n        ? getComboChartComponentIds(chartConfig)\n        : [];\n  const filterIds = includeFilters\n    ? getChartConfigFilterComponentIds(chartConfig)\n    : [];\n  const IFKeys = interactiveFiltersConfig\n    ? (Object.keys(interactiveFiltersConfig) as IFKey[])\n    : [];\n  const IFIris: string[] = [];\n\n  if (interactiveFiltersConfig) {\n    IFKeys.forEach((k) => {\n      const v = interactiveFiltersConfig[k];\n      switch (k) {\n        case \"legend\": {\n          const legend = v as InteractiveFiltersLegend;\n          if (legend.active) {\n            IFIris.push(legend.componentId);\n          }\n          break;\n        }\n        case \"timeRange\": {\n          const timeRange = v as InteractiveFiltersTimeRange;\n          if (timeRange.active) {\n            IFIris.push(timeRange.componentId);\n          }\n          break;\n        }\n        case \"dataFilters\": {\n          const dataFilters = v as InteractiveFiltersDataConfig;\n          if (dataFilters.active) {\n            IFIris.push(...dataFilters.componentIds);\n          }\n          break;\n        }\n        case \"calculation\":\n          break;\n        default:\n          const _exhaustiveCheck: never = k;\n          return _exhaustiveCheck;\n      }\n    });\n  }\n\n  return (\n    uniq(\n      [...fieldIds, ...additionalFieldIds, ...filterIds, ...IFIris].filter(\n        Boolean\n      )\n    )\n      .flatMap((id) =>\n        isJoinById(id) ? getOriginalIds(id, chartConfig) : [id]\n      )\n      .filter((id) => !isJoinById(id))\n      // Important so the order is consistent when querying.\n      .sort()\n  );\n};\n\nexport const extractChartConfigUsedComponents = (\n  chartConfig: ChartConfig,\n  { components }: { components: Component[] }\n) => {\n  const componentIds = extractChartConfigComponentIds({\n    chartConfig,\n    includeFilters: false,\n  });\n\n  return componentIds\n    .map((id) => components.find((component) => component.id === id))\n    .filter(truthy); // exclude potential joinBy components\n};\n\n/** Use to remove missing values from chart data. */\nexport const usePlottableData = (\n  data: Observation[],\n  {\n    getX,\n    getY,\n  }: {\n    getX?: (d: Observation) => unknown | null;\n    getY?: (d: Observation) => unknown | null;\n  }\n) => {\n  const isPlottable = useCallback(\n    (d: Observation) => {\n      for (const p of [getX, getY].filter(truthy)) {\n        const v = p(d);\n        if (v === undefined || v === null) {\n          return false;\n        }\n      }\n      return true;\n    },\n    [getX, getY]\n  );\n\n  return useMemo(() => data.filter(isPlottable), [data, isPlottable]);\n};\n\nexport const useDimensionWithAbbreviations = (\n  dimension: Dimension | undefined,\n  {\n    observations,\n    field,\n  }: {\n    observations: Observation[];\n    field?: GenericField;\n  }\n) => {\n  const { getAbbreviationOrLabelByValue, abbreviationOrLabelLookup } =\n    useMaybeAbbreviations({\n      useAbbreviations: field?.useAbbreviations,\n      dimensionId: dimension?.id,\n      dimensionValues: dimension?.values,\n    });\n\n  const { getValue, getLabel } = useObservationLabels(\n    observations,\n    getAbbreviationOrLabelByValue,\n    dimension?.id\n  );\n\n  return {\n    getAbbreviationOrLabelByValue,\n    abbreviationOrLabelLookup,\n    getValue,\n    getLabel,\n  };\n};\n\nconst makeUseParsedVariable =\n  <T extends unknown>(parser: (d: ObservationValue) => T) =>\n  (key: string) => {\n    return useCallback((d: Observation) => parser(d[key]), [key]);\n  };\n\nexport const parseOptionalNumericVariable = (d: ObservationValue) => {\n  return d !== null ? +d : null;\n};\nexport const useOptionalNumericVariable = makeUseParsedVariable(\n  parseOptionalNumericVariable\n);\n\nexport const parseStringVariable = (d: ObservationValue) => {\n  return d !== null ? `${d}` : \"\";\n};\nexport const useStringVariable = makeUseParsedVariable(parseStringVariable);\n\nexport const useTemporalVariable = makeUseParsedVariable((x) =>\n  parseDate(`${x}`)\n);\n\nexport const useTemporalEntityVariable = (\n  dimensionValues: DimensionValue[]\n) => {\n  const indexedValues = useMemo(() => {\n    return new Map(dimensionValues.map((d) => [d.label, d]));\n  }, [dimensionValues]);\n\n  return useCallback(\n    (key: string) => {\n      return (d: Observation) => {\n        const label = d[key];\n        const dimensionValue = indexedValues.get(`${label}`);\n        const value = dimensionValue\n          ? getTemporalEntityValue(dimensionValue)\n          : undefined;\n\n        return parseDate(`${value}`);\n      };\n    },\n    [indexedValues]\n  );\n};\n\nexport const getSegment =\n  (segmentKey: string | undefined) =>\n  (d: Observation): string =>\n    segmentKey ? `${d[segmentKey]}` : \"segment\";\n\n// Stacking helpers.\n// Modified from d3 source code to treat 0s as positive values and stack them correctly\n// in area charts.\nexport const stackOffsetDivergingPositiveZeros = (\n  series: any,\n  order: any\n): void => {\n  const n = series.length;\n\n  if (!(n > 0)) return;\n\n  for (let i, j = 0, d, dy, yp, yn, m = series[order[0]].length; j < m; ++j) {\n    for (yp = yn = 0, i = 0; i < n; ++i) {\n      if ((dy = (d = series[order[i]][j])[1] - d[0]) >= 0) {\n        (d[0] = yp), (d[1] = yp += dy);\n      } else {\n        (d[1] = yn), (d[0] = yn += dy);\n      }\n    }\n  }\n};\n\n// Helper to pivot a dataset to a wider format.\n// Currently, imputation is only applicable to temporal charts (specifically, stacked area charts).\nexport const getWideData = ({\n  dataGrouped,\n  key,\n  getAxisValue,\n  allSegments,\n  getSegment,\n  imputationType = \"none\",\n}: {\n  dataGrouped: InternMap<string, Array<Observation>>;\n  key: string;\n  getAxisValue: (d: Observation) => number | null;\n  allSegments?: Array<string>;\n  getSegment: (d: Observation) => string;\n  imputationType?: ImputationType;\n}) => {\n  switch (imputationType) {\n    case \"linear\":\n      if (allSegments) {\n        const dataGroupedEntries = [...dataGrouped.entries()];\n        const dataGroupedWithImputedValues: Array<{\n          [key: string]: number;\n        }> = Array.from({ length: dataGrouped.size }, () => ({}));\n\n        for (const segment of allSegments) {\n          const imputedSeriesValues = imputeTemporalLinearSeries({\n            dataSortedByX: dataGroupedEntries.map(([date, values]) => {\n              const observation = values.find((d) => getSegment(d) === segment);\n\n              return {\n                date: new Date(date),\n                value: observation ? getAxisValue(observation) : null,\n              };\n            }),\n          });\n\n          for (let i = 0; i < imputedSeriesValues.length; i++) {\n            dataGroupedWithImputedValues[i][segment] =\n              imputedSeriesValues[i].value;\n          }\n        }\n\n        return getBaseWideData({\n          dataGrouped,\n          key,\n          getAxisValue,\n          getSegment,\n          getOptionalObservationProps: (i) => {\n            return allSegments.map((d) => {\n              return {\n                [d]: dataGroupedWithImputedValues[i][d],\n              };\n            });\n          },\n        });\n      }\n    case \"zeros\":\n      if (allSegments) {\n        return getBaseWideData({\n          dataGrouped,\n          key,\n          getAxisValue,\n          getSegment,\n          getOptionalObservationProps: () => {\n            return allSegments.map((d) => {\n              return {\n                [d]: interpolateZerosValue(),\n              };\n            });\n          },\n        });\n      }\n    case \"none\":\n    default:\n      return getBaseWideData({\n        dataGrouped,\n        key,\n        getAxisValue,\n        getSegment,\n      });\n  }\n};\n\nconst getBaseWideData = ({\n  dataGrouped,\n  key,\n  getAxisValue,\n  getSegment,\n  getOptionalObservationProps = () => [],\n}: {\n  dataGrouped: InternMap<string, Array<Observation>>;\n  key: string;\n  getAxisValue: (d: Observation) => number | null;\n  getSegment: (d: Observation) => string;\n  getOptionalObservationProps?: (\n    datumIndex: number\n  ) => Array<{ [key: string]: number }>;\n}): Array<Observation> => {\n  const wideData = [];\n  const dataGroupedByXEntries = [...dataGrouped.entries()];\n\n  for (let i = 0; i < dataGrouped.size; i++) {\n    const [k, v] = dataGroupedByXEntries[i];\n\n    const observation: Observation = Object.assign(\n      {\n        [key]: k,\n        [`${key}/__iri__`]: v[0][`${key}/__iri__`],\n        total: sum(v, getAxisValue),\n      },\n      ...getOptionalObservationProps(i),\n      ...v\n        // Sorting the values in case of multiple values for the same segment\n        // (desired behavior for getting the domain when time slider is active).\n        .sort((a, b) => {\n          return (getAxisValue(a) ?? 0) - (getAxisValue(b) ?? 0);\n        })\n        .map((d) => {\n          return {\n            [getSegment(d)]: getAxisValue(d),\n          };\n        })\n    );\n\n    wideData.push(observation);\n  }\n\n  return wideData;\n};\n\nconst getIdentityId = (id: string) => `${id}/__identity__`;\nexport const useGetIdentityY = (id: string) => {\n  return useCallback(\n    (d: Observation) => {\n      return (d[getIdentityId(id)] as number | null) ?? null;\n    },\n    [id]\n  );\n};\nexport const useGetIdentityX = (id: string) => {\n  return useCallback(\n    (d: Observation) => {\n      return (d[getIdentityId(id)] as number | null) ?? null;\n    },\n    [id]\n  );\n};\n\nexport const normalizeData = (\n  sortedData: Observation[],\n  {\n    key,\n    getAxisValue,\n    getTotalGroupValue,\n  }: {\n    key: string;\n    getAxisValue: (d: Observation) => number | null;\n    getTotalGroupValue: (d: Observation) => number;\n  }\n): Observation[] => {\n  return sortedData.map((d) => {\n    const totalGroupValue = getTotalGroupValue(d);\n    const axisValue = getAxisValue(d);\n\n    return {\n      ...d,\n      [key]: 100 * (axisValue ? axisValue / totalGroupValue : (axisValue ?? 0)),\n      [getIdentityId(key)]: axisValue,\n    };\n  });\n};\n\nconst SlugRe = /\\W+/g;\nexport const getSlugifiedId = (id: string) => id.replace(SlugRe, \"_\");\n\nexport const getLabelWithUnit = (component: Component) => {\n  return component.unit\n    ? `${component.label} (${component.unit})`\n    : component.label;\n};\n\nexport const checkForMissingValuesInSegments = (\n  dataGroupedByX: InternMap<string, Observation[]>,\n  segments: Array<string>\n): boolean => {\n  for (const value of dataGroupedByX.values()) {\n    if (value.length !== segments.length) {\n      return true;\n    }\n  }\n\n  return false;\n};\n","import { createContext, PropsWithChildren, useContext, useMemo } from \"react\";\nimport { useSyncExternalStore } from \"use-sync-external-store/shim\";\n\nimport { Observable } from \"@/utils/observables\";\n\nclass LoadingState extends Observable {\n  public loading: boolean = false;\n  private map: Record<string, boolean> = {};\n\n  constructor() {\n    super();\n  }\n\n  public getUpdateKey = () => {\n    return JSON.stringify(this.map);\n  };\n\n  set(iri: string, loading: boolean) {\n    this.map[iri] = loading;\n    this.resolveState();\n  }\n\n  private resolveState() {\n    const _loading = this.loading;\n    this.loading = Object.values(this.map).some((d) => d);\n\n    if (!this.loading) {\n      this.map = {};\n    }\n\n    if (_loading !== this.loading) {\n      this.notify();\n    }\n  }\n}\n\nconst LoadingStateContext = createContext<LoadingState | undefined>(undefined);\n\n/** Used to consolidate loading state across different components.\n *\n * It was primarily implemented to avoid being in \"data loaded\" state,\n * which displays a `<NoDataHint>`, when interactive filters are still\n * being fetched.\n */\nexport const useLoadingState = () => {\n  const ctx = useContext(LoadingStateContext);\n\n  if (!ctx) {\n    throw Error(\n      \"useLoadingState must be called inside a LoadingStateContext.Provider!\"\n    );\n  }\n\n  useSyncExternalStore(ctx.subscribe, ctx.getUpdateKey);\n\n  return ctx;\n};\n\nexport const LoadingStateProvider = (props: PropsWithChildren<{}>) => {\n  const loadingState = useMemo(() => new LoadingState(), []);\n\n  return <LoadingStateContext.Provider value={loadingState} {...props} />;\n};\n","import { max, min } from \"d3-array\";\nimport { ScaleTime } from \"d3-scale\";\nimport get from \"lodash/get\";\nimport overEvery from \"lodash/overEvery\";\nimport uniq from \"lodash/uniq\";\nimport uniqBy from \"lodash/uniqBy\";\nimport { createContext, useCallback, useContext, useMemo } from \"react\";\n\nimport { AreasState } from \"@/charts/area/areas-state\";\nimport { GroupedBarsState } from \"@/charts/bar/bars-grouped-state\";\nimport { StackedBarsState } from \"@/charts/bar/bars-stacked-state\";\nimport { BarsState } from \"@/charts/bar/bars-state\";\nimport { GroupedColumnsState } from \"@/charts/column/columns-grouped-state\";\nimport { StackedColumnsState } from \"@/charts/column/columns-stacked-state\";\nimport { ColumnsState } from \"@/charts/column/columns-state\";\nimport { ComboLineColumnState } from \"@/charts/combo/combo-line-column-state\";\nimport { ComboLineDualState } from \"@/charts/combo/combo-line-dual-state\";\nimport { ComboLineSingleState } from \"@/charts/combo/combo-line-single-state\";\nimport { LinesState } from \"@/charts/line/lines-state\";\nimport { MapState } from \"@/charts/map/map-state\";\nimport { PieState } from \"@/charts/pie/pie-state\";\nimport { ScatterplotState } from \"@/charts/scatterplot/scatterplot-state\";\nimport {\n  getLabelWithUnit,\n  useDimensionWithAbbreviations,\n  useOptionalNumericVariable,\n  useStringVariable,\n  useTemporalEntityVariable,\n  useTemporalVariable,\n} from \"@/charts/shared/chart-helpers\";\nimport { DimensionsById, MeasuresById } from \"@/charts/shared/chart-props\";\nimport { Bounds } from \"@/charts/shared/use-size\";\nimport { TableChartState } from \"@/charts/table/table-state\";\nimport { useLimits } from \"@/config-utils\";\nimport {\n  AreaFields,\n  BarFields,\n  ChartConfig,\n  ChartSegmentField,\n  ChartType,\n  ColumnFields,\n  GenericField,\n  getAnimationField,\n  hasChartConfigs,\n  InteractiveFiltersConfig,\n  LineFields,\n  PieFields,\n  ScatterPlotFields,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport {\n  parseDate,\n  useErrorMeasure,\n  useErrorRange,\n  useErrorVariable,\n} from \"@/configurator/components/ui-helpers\";\nimport {\n  Dimension,\n  DimensionValue,\n  GeoCoordinatesDimension,\n  GeoShapesDimension,\n  isNumericalMeasure,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  Measure,\n  NumericalMeasure,\n  Observation,\n  TemporalDimension,\n  TemporalEntityDimension,\n} from \"@/domain/data\";\nimport { Has } from \"@/domain/types\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { RelatedDimensionType } from \"@/graphql/query-hooks\";\nimport { ScaleType, TimeUnit } from \"@/graphql/resolver-types\";\nimport { Limit } from \"@/rdf/limits\";\nimport {\n  useChartInteractiveFilters,\n  useDashboardInteractiveFilters,\n} from \"@/stores/interactive-filters\";\n\nexport type ChartState =\n  | AreasState\n  | ColumnsState\n  | StackedColumnsState\n  | GroupedColumnsState\n  | BarsState\n  | StackedBarsState\n  | GroupedBarsState\n  | ComboLineSingleState\n  | ComboLineColumnState\n  | ComboLineDualState\n  | LinesState\n  | MapState\n  | PieState\n  | ScatterplotState\n  | TableChartState\n  | undefined;\n\nexport type CommonChartState = {\n  chartType: ChartType;\n  chartData: Observation[];\n  allData: Observation[];\n  bounds: Bounds;\n  interactiveFiltersConfig: InteractiveFiltersConfig;\n};\n\nexport type ColorsChartState = Has<ChartState, \"colors\">;\nexport const ChartContext = createContext<ChartState>(undefined);\n\nexport const useChartState = () => {\n  const ctx = useContext(ChartContext);\n  if (ctx === undefined) {\n    throw Error(\n      \"You need to wrap your component in <ChartContext.Provider /> to useChartState()\"\n    );\n  }\n  return ctx;\n};\n\nexport type ChartWithInteractiveXTimeRangeState =\n  | AreasState\n  | ColumnsState\n  | LinesState\n  | ComboLineSingleState\n  | ComboLineColumnState\n  | ComboLineDualState\n  | TableChartState;\n\nexport type ChartWithInteractiveYTimeRangeState = BarsState;\n\nexport type NumericalValueGetter = (d: Observation) => number | null;\n\nexport type StringValueGetter = (d: Observation) => string;\n\nexport type TemporalValueGetter = (d: Observation) => Date;\n\nexport type RenderingVariables = {\n  /** Optionally provide an option to pass a segment to the key.\n   * This is useful for stacked charts, where we can't easily\n   * access the segment value from the data.\n   */\n  getRenderingKey: (d: Observation, segment?: string) => string;\n};\n\n/** Generally, each chart should use sorted data, according to its own needs.\n * Usually it means sorting by X axis.\n */\nexport type SortingVariables<T = undefined> = T extends undefined\n  ? {\n      sortData: (data: Observation[]) => Observation[];\n    }\n  : {\n      sortData: (data: Observation[], options: T) => Observation[];\n    };\n\nexport type BaseVariables = {\n  interactiveFiltersConfig: InteractiveFiltersConfig;\n};\n\nexport const useBaseVariables = (chartConfig: ChartConfig): BaseVariables => {\n  return {\n    interactiveFiltersConfig: chartConfig.interactiveFiltersConfig,\n  };\n};\n\nexport type BandYVariables = {\n  yAxisLabel: string;\n  yDimension: Dimension;\n  getY: StringValueGetter;\n  getYLabel: (d: string) => string;\n  getYAbbreviationOrLabel: (d: Observation) => string;\n  yTimeUnit: TimeUnit | undefined;\n  getYAsDate: TemporalValueGetter;\n  formatYDate: (d: Date | string) => string;\n};\n\nexport const useBandYVariables = (\n  y: GenericField,\n  {\n    dimensionsById,\n    observations,\n  }: {\n    dimensionsById: DimensionsById;\n    observations: Observation[];\n  }\n): BandYVariables => {\n  const yDimension = dimensionsById[y.componentId];\n  if (!yDimension) {\n    throw Error(`No dimension <${y.componentId}> in cube! (useBandXVariables)`);\n  }\n\n  const yTimeUnit =\n    isTemporalDimension(yDimension) || isTemporalEntityDimension(yDimension)\n      ? yDimension.timeUnit\n      : undefined;\n  const timeFormatUnit = useTimeFormatUnit();\n  const formatYDate = useCallback(\n    (d: Date | string) => {\n      if (yTimeUnit) {\n        return timeFormatUnit(d, yTimeUnit);\n      }\n\n      if (typeof d === \"string\") {\n        return d;\n      }\n\n      return d.toISOString();\n    },\n    [timeFormatUnit, yTimeUnit]\n  );\n\n  const {\n    getAbbreviationOrLabelByValue: getYAbbreviationOrLabel,\n    getValue: getY,\n    getLabel: getYLabel,\n  } = useDimensionWithAbbreviations(yDimension, {\n    observations,\n    field: y,\n  });\n\n  const getYAsDate = useTemporalVariable(y.componentId);\n  const getYTemporalEntity = useTemporalEntityVariable(\n    dimensionsById[y.componentId].values\n  )(y.componentId);\n\n  const yAxisLabel = getLabelWithUnit(yDimension);\n\n  return {\n    yAxisLabel,\n    yDimension,\n    getY,\n    getYLabel,\n    getYAbbreviationOrLabel,\n    yTimeUnit,\n    getYAsDate: isTemporalEntityDimension(yDimension)\n      ? getYTemporalEntity\n      : getYAsDate,\n    formatYDate,\n  };\n};\n\nexport type BandXVariables = {\n  xAxisLabel: string;\n  xDimension: Dimension;\n  getX: StringValueGetter;\n  getXLabel: (d: string) => string;\n  getXAbbreviationOrLabel: (d: Observation) => string;\n  xTimeUnit: TimeUnit | undefined;\n  getXAsDate: TemporalValueGetter;\n  formatXDate: (d: Date | string) => string;\n};\n\nexport const useBandXVariables = (\n  x: GenericField,\n  {\n    dimensionsById,\n    observations,\n  }: {\n    dimensionsById: DimensionsById;\n    observations: Observation[];\n  }\n): BandXVariables => {\n  const xDimension = dimensionsById[x.componentId];\n  if (!xDimension) {\n    throw Error(`No dimension <${x.componentId}> in cube! (useBandXVariables)`);\n  }\n\n  const {\n    getAbbreviationOrLabelByValue: getXAbbreviationOrLabel,\n    getValue: getX,\n    getLabel: getXLabel,\n  } = useDimensionWithAbbreviations(xDimension, {\n    observations,\n    field: x,\n  });\n\n  const getXAsDate = useTemporalVariable(x.componentId);\n  const getXTemporalEntity = useTemporalEntityVariable(\n    dimensionsById[x.componentId].values\n  )(x.componentId);\n\n  const xAxisLabel = getLabelWithUnit(xDimension);\n\n  const xTimeUnit =\n    isTemporalDimension(xDimension) || isTemporalEntityDimension(xDimension)\n      ? xDimension.timeUnit\n      : undefined;\n  const timeFormatUnit = useTimeFormatUnit();\n  const formatXDate = useCallback(\n    (d: Date | string) => {\n      if (xTimeUnit) {\n        return timeFormatUnit(d, xTimeUnit);\n      }\n\n      if (typeof d === \"string\") {\n        return d;\n      }\n\n      return d.toISOString();\n    },\n    [timeFormatUnit, xTimeUnit]\n  );\n\n  return {\n    xAxisLabel,\n    xDimension,\n    getX,\n    getXLabel,\n    getXAbbreviationOrLabel,\n    xTimeUnit,\n    getXAsDate: isTemporalEntityDimension(xDimension)\n      ? getXTemporalEntity\n      : getXAsDate,\n    formatXDate,\n  };\n};\n\nexport type TemporalXVariables = {\n  xDimension: TemporalDimension | TemporalEntityDimension;\n  getX: TemporalValueGetter;\n  getXAsString: StringValueGetter;\n  xAxisLabel: string;\n};\n\nexport const useTemporalXVariables = (\n  x: GenericField,\n  { dimensionsById }: { dimensionsById: DimensionsById }\n): TemporalXVariables => {\n  const xDimension = dimensionsById[x.componentId];\n  if (!xDimension) {\n    throw Error(\n      `No dimension <${x.componentId}> in cube! (useTemporalXVariables)`\n    );\n  }\n\n  if (\n    !isTemporalDimension(xDimension) &&\n    !isTemporalEntityDimension(xDimension)\n  ) {\n    throw Error(`Dimension <${x.componentId}> is not temporal!`);\n  }\n\n  const getXTemporal = useTemporalVariable(x.componentId);\n  const dimensionValues = dimensionsById[x.componentId].values;\n  const relatedLimitValues = dimensionsById[x.componentId].relatedLimitValues;\n  const values = uniqBy(\n    [...dimensionValues, ...relatedLimitValues],\n    (d) => d.value\n  );\n  const getXTemporalEntity = useTemporalEntityVariable(values)(x.componentId);\n  const getXAsString = useStringVariable(x.componentId);\n\n  const xAxisLabel = getLabelWithUnit(xDimension);\n\n  return {\n    xAxisLabel,\n    xDimension,\n    getX: isTemporalDimension(xDimension) ? getXTemporal : getXTemporalEntity,\n    getXAsString,\n  };\n};\n\nexport type TemporalMaybeXVariables = {\n  xDimension: TemporalDimension | TemporalEntityDimension | undefined;\n  getX: TemporalValueGetter;\n};\n\nexport const useTemporalMaybeXVariables = (\n  { componentId = \"\" }: { componentId: string | undefined },\n  { dimensionsById }: { dimensionsById: DimensionsById }\n): TemporalMaybeXVariables => {\n  const xDimension = dimensionsById[componentId];\n\n  if (\n    xDimension &&\n    !isTemporalDimension(xDimension) &&\n    !isTemporalEntityDimension(xDimension)\n  ) {\n    throw Error(`Dimension <${componentId}> is not temporal!`);\n  }\n\n  const getXTemporal = useTemporalVariable(componentId);\n  const dimensionValues = dimensionsById[componentId]?.values ?? [];\n  const relatedLimitValues =\n    dimensionsById[componentId]?.relatedLimitValues ?? [];\n  const values = uniqBy(\n    [...dimensionValues, ...relatedLimitValues],\n    (d) => d.value\n  );\n  const getXTemporalEntity = useTemporalEntityVariable(values)(componentId);\n\n  return {\n    xDimension,\n    getX: isTemporalDimension(xDimension) ? getXTemporal : getXTemporalEntity,\n  };\n};\n\nexport const shouldUseDynamicMinScaleValue = (scaleType?: ScaleType) => {\n  return scaleType === ScaleType.Interval;\n};\n\nexport type NumericalXVariables = {\n  xMeasure: NumericalMeasure;\n  getX: NumericalValueGetter;\n  xAxisLabel: string;\n  /** Depending on xMeasure's scale type, it can either be 0 or dynamically\n   * based on available data. */\n  getMinX: (data: Observation[], getX: NumericalValueGetter) => number;\n};\n\nexport const useNumericalXVariables = (\n  chartType: \"scatterplot\" | \"bar\",\n  x: ScatterPlotFields[\"x\"] | BarFields[\"x\"],\n  { measuresById }: { measuresById: MeasuresById }\n): NumericalXVariables => {\n  const xMeasure = measuresById[x.componentId];\n  if (!xMeasure) {\n    throw Error(\n      `No dimension <${x.componentId}> in cube! (useNumericalXVariables)`\n    );\n  }\n\n  if (!isNumericalMeasure(xMeasure)) {\n    throw Error(`Measure <${x.componentId}> is not numerical!`);\n  }\n\n  const getX = useOptionalNumericVariable(x.componentId);\n  const xAxisLabel = getLabelWithUnit(xMeasure);\n  const getMinX = useCallback(\n    (data: Observation[], _getX: NumericalValueGetter) => {\n      switch (chartType) {\n        case \"bar\":\n          return Math.min(0, min(data, _getX) ?? 0);\n        case \"scatterplot\":\n          return shouldUseDynamicMinScaleValue(xMeasure.scaleType)\n            ? (min(data, _getX) ?? 0)\n            : Math.min(0, min(data, _getX) ?? 0);\n        default:\n          const _exhaustiveCheck: never = chartType;\n          return _exhaustiveCheck;\n      }\n    },\n    [chartType, xMeasure.scaleType]\n  );\n\n  return {\n    xMeasure,\n    getX,\n    xAxisLabel,\n    getMinX,\n  };\n};\n\nexport type NumericalYVariables = {\n  yMeasure: NumericalMeasure;\n  getY: NumericalValueGetter;\n  yAxisLabel: string;\n  /** Depending on yMeasure's scale type, it can either be 0 or dynamically\n   * based on available data. */\n  getMinY: (data: Observation[], getY: NumericalValueGetter) => number;\n};\n\nexport const useNumericalYVariables = (\n  // Combo charts have their own logic for y scales.\n  chartType: \"area\" | \"column\" | \"line\" | \"pie\" | \"scatterplot\",\n  y:\n    | AreaFields[\"y\"]\n    | ColumnFields[\"y\"]\n    | LineFields[\"y\"]\n    | PieFields[\"y\"]\n    | ScatterPlotFields[\"y\"],\n  { measuresById }: { measuresById: MeasuresById }\n): NumericalYVariables => {\n  const yMeasure = measuresById[y.componentId];\n\n  if (!yMeasure) {\n    throw Error(\n      `No dimension <${y.componentId}> in cube! (useNumericalYVariables)`\n    );\n  }\n\n  if (!isNumericalMeasure(yMeasure)) {\n    throw Error(`Measure <${y.componentId}> is not numerical!`);\n  }\n\n  const getY = useOptionalNumericVariable(y.componentId);\n  const yAxisLabel = getLabelWithUnit(yMeasure);\n  const getMinY = useCallback(\n    (data: Observation[], _getY: NumericalValueGetter) => {\n      switch (chartType) {\n        case \"area\":\n        case \"column\":\n        case \"pie\":\n          return Math.min(0, min(data, _getY) ?? 0);\n        case \"line\":\n        case \"scatterplot\":\n          return shouldUseDynamicMinScaleValue(yMeasure.scaleType)\n            ? (min(data, _getY) ?? 0)\n            : Math.min(0, min(data, _getY) ?? 0);\n        default:\n          const _exhaustiveCheck: never = chartType;\n          return _exhaustiveCheck;\n      }\n    },\n    [chartType, yMeasure.scaleType]\n  );\n\n  return {\n    yMeasure,\n    getY,\n    yAxisLabel,\n    getMinY,\n  };\n};\n\nexport type NumericalYErrorVariables = {\n  showYUncertainty: boolean;\n  getYErrorPresent: (d: Observation) => boolean;\n  getYErrorRange: null | ((d: Observation) => [number, number]);\n  getFormattedYUncertainty: (d: Observation) => string | undefined;\n};\n\nexport type NumericalXErrorVariables = {\n  showXUncertainty: boolean;\n  getXErrorPresent: (d: Observation) => boolean;\n  getXErrorRange: null | ((d: Observation) => [number, number]);\n  getFormattedXUncertainty: (d: Observation) => string | undefined;\n};\n\nexport const useNumericalYErrorVariables = (\n  y: GenericField,\n  {\n    getValue,\n    dimensions,\n    measures,\n  }: {\n    getValue: NumericalYVariables[\"getY\"];\n    dimensions: Dimension[];\n    measures: Measure[];\n  }\n): NumericalYErrorVariables => {\n  const showYStandardError = get(y, [\"showStandardError\"], true);\n  const yStandardErrorMeasure = useErrorMeasure(y.componentId, {\n    dimensions,\n    measures,\n    type: RelatedDimensionType.StandardError,\n  });\n  const getYStandardError = useErrorVariable(yStandardErrorMeasure);\n\n  const showYConfidenceInterval = get(y, [\"showConfidenceInterval\"], true);\n  const yConfidenceIntervalUpperMeasure = useErrorMeasure(y.componentId, {\n    dimensions,\n    measures,\n    type: RelatedDimensionType.ConfidenceUpperBound,\n  });\n  const getYConfidenceIntervalUpper = useErrorVariable(\n    yConfidenceIntervalUpperMeasure\n  );\n  const yConfidenceIntervalLowerMeasure = useErrorMeasure(y.componentId, {\n    dimensions,\n    measures,\n    type: RelatedDimensionType.ConfidenceLowerBound,\n  });\n  const getYConfidenceIntervalLower = useErrorVariable(\n    yConfidenceIntervalLowerMeasure\n  );\n\n  const getYErrorPresent = useCallback(\n    (d: Observation) => {\n      return (\n        (showYStandardError && getYStandardError?.(d) !== null) ||\n        (showYConfidenceInterval &&\n          getYConfidenceIntervalUpper?.(d) !== null &&\n          getYConfidenceIntervalLower?.(d) !== null)\n      );\n    },\n    [\n      showYStandardError,\n      getYStandardError,\n      showYConfidenceInterval,\n      getYConfidenceIntervalUpper,\n      getYConfidenceIntervalLower,\n    ]\n  );\n  const getYErrorRange = useErrorRange(\n    showYStandardError && yStandardErrorMeasure\n      ? yStandardErrorMeasure\n      : yConfidenceIntervalUpperMeasure,\n    showYStandardError && yStandardErrorMeasure\n      ? yStandardErrorMeasure\n      : yConfidenceIntervalLowerMeasure,\n    getValue\n  );\n  const getFormattedYUncertainty = useCallback(\n    (d: Observation) => {\n      if (\n        showYStandardError &&\n        getYStandardError &&\n        getYStandardError(d) !== null\n      ) {\n        const sd = getYStandardError(d);\n        const unit = yStandardErrorMeasure?.unit ?? \"\";\n        return `  ${sd}${unit}`;\n      }\n\n      if (\n        showYConfidenceInterval &&\n        getYConfidenceIntervalUpper &&\n        getYConfidenceIntervalLower &&\n        getYConfidenceIntervalUpper(d) !== null &&\n        getYConfidenceIntervalLower(d) !== null\n      ) {\n        const cil = getYConfidenceIntervalLower(d);\n        const ciu = getYConfidenceIntervalUpper(d);\n        const unit = yConfidenceIntervalUpperMeasure?.unit ?? \"\";\n        return `, [-${cil}${unit}, +${ciu}${unit}]`;\n      }\n    },\n    [\n      showYStandardError,\n      getYStandardError,\n      showYConfidenceInterval,\n      getYConfidenceIntervalUpper,\n      getYConfidenceIntervalLower,\n      yStandardErrorMeasure?.unit,\n      yConfidenceIntervalUpperMeasure?.unit,\n    ]\n  );\n\n  return {\n    showYUncertainty:\n      (showYStandardError && !!yStandardErrorMeasure) ||\n      (showYConfidenceInterval &&\n        !!yConfidenceIntervalUpperMeasure &&\n        !!yConfidenceIntervalLowerMeasure),\n    getYErrorPresent,\n    getYErrorRange,\n    getFormattedYUncertainty,\n  };\n};\n\nexport const useNumericalXErrorVariables = (\n  x: GenericField,\n  {\n    getValue,\n    dimensions,\n    measures,\n  }: {\n    getValue: NumericalXVariables[\"getX\"];\n    dimensions: Dimension[];\n    measures: Measure[];\n  }\n): NumericalXErrorVariables => {\n  const showXStandardError = get(x, [\"showStandardError\"], true);\n  const xStandardErrorMeasure = useErrorMeasure(x.componentId, {\n    dimensions,\n    measures,\n    type: RelatedDimensionType.StandardError,\n  });\n  const getXStandardError = useErrorVariable(xStandardErrorMeasure);\n\n  const showXConfidenceInterval = get(x, [\"showConfidenceInterval\"], true);\n  const xConfidenceIntervalUpperMeasure = useErrorMeasure(x.componentId, {\n    dimensions,\n    measures,\n    type: RelatedDimensionType.ConfidenceUpperBound,\n  });\n  const getXConfidenceIntervalUpper = useErrorVariable(\n    xConfidenceIntervalUpperMeasure\n  );\n  const xConfidenceIntervalLowerMeasure = useErrorMeasure(x.componentId, {\n    dimensions,\n    measures,\n    type: RelatedDimensionType.ConfidenceLowerBound,\n  });\n  const getXConfidenceIntervalLower = useErrorVariable(\n    xConfidenceIntervalLowerMeasure\n  );\n\n  const getXErrorPresent = useCallback(\n    (d: Observation) => {\n      return (\n        (showXStandardError && getXStandardError?.(d) !== null) ||\n        (showXConfidenceInterval &&\n          getXConfidenceIntervalUpper?.(d) !== null &&\n          getXConfidenceIntervalLower?.(d) !== null)\n      );\n    },\n    [\n      showXStandardError,\n      getXStandardError,\n      showXConfidenceInterval,\n      getXConfidenceIntervalUpper,\n      getXConfidenceIntervalLower,\n    ]\n  );\n  const getXErrorRange = useErrorRange(\n    showXStandardError && xStandardErrorMeasure\n      ? xStandardErrorMeasure\n      : xConfidenceIntervalUpperMeasure,\n    showXStandardError && xStandardErrorMeasure\n      ? xStandardErrorMeasure\n      : xConfidenceIntervalLowerMeasure,\n    getValue\n  );\n  const getFormattedXUncertainty = useCallback(\n    (d: Observation) => {\n      if (\n        showXStandardError &&\n        getXStandardError &&\n        getXStandardError(d) !== null\n      ) {\n        const sd = getXStandardError(d);\n        const unit = xStandardErrorMeasure?.unit ?? \"\";\n        return `  ${sd}${unit}`;\n      }\n\n      if (\n        showXConfidenceInterval &&\n        getXConfidenceIntervalUpper &&\n        getXConfidenceIntervalLower &&\n        getXConfidenceIntervalUpper(d) !== null &&\n        getXConfidenceIntervalLower(d) !== null\n      ) {\n        const cil = getXConfidenceIntervalLower(d);\n        const ciu = getXConfidenceIntervalUpper(d);\n        const unit = xConfidenceIntervalUpperMeasure?.unit ?? \"\";\n        return `, [-${cil}${unit}, +${ciu}${unit}]`;\n      }\n    },\n    [\n      showXStandardError,\n      getXStandardError,\n      showXConfidenceInterval,\n      getXConfidenceIntervalUpper,\n      getXConfidenceIntervalLower,\n      xStandardErrorMeasure?.unit,\n      xConfidenceIntervalUpperMeasure?.unit,\n    ]\n  );\n\n  return {\n    showXUncertainty:\n      (showXStandardError && !!xStandardErrorMeasure) ||\n      (showXConfidenceInterval &&\n        !!xConfidenceIntervalUpperMeasure &&\n        !!xConfidenceIntervalLowerMeasure),\n    getXErrorPresent,\n    getXErrorRange,\n    getFormattedXUncertainty,\n  };\n};\n\nexport type SegmentVariables = {\n  segmentDimension: Dimension | undefined;\n  segmentsByAbbreviationOrLabel: Map<string, DimensionValue>;\n  getSegment: StringValueGetter;\n  getSegmentAbbreviationOrLabel: StringValueGetter;\n  getSegmentLabel: (d: string) => string;\n  showValuesBySegmentMapping: ChartSegmentField[\"showValuesMapping\"];\n};\n\nexport const useSegmentVariables = (\n  segment: ChartSegmentField | undefined,\n  {\n    dimensionsById,\n    observations,\n  }: {\n    dimensionsById: DimensionsById;\n    observations: Observation[];\n  }\n): SegmentVariables => {\n  const segmentDimension = dimensionsById[segment?.componentId ?? \"\"];\n  const {\n    getAbbreviationOrLabelByValue: getSegmentAbbreviationOrLabel,\n    abbreviationOrLabelLookup: segmentsByAbbreviationOrLabel,\n    getValue: getSegment,\n    getLabel: getSegmentLabel,\n  } = useDimensionWithAbbreviations(segmentDimension, {\n    observations,\n    field: segment,\n  });\n\n  return {\n    segmentDimension,\n    segmentsByAbbreviationOrLabel,\n    getSegment,\n    getSegmentAbbreviationOrLabel,\n    getSegmentLabel,\n    showValuesBySegmentMapping: segment?.showValuesMapping ?? {},\n  };\n};\n\nexport type InteractiveFiltersVariables = {\n  getTimeRangeDate: (d: Observation) => Date;\n};\n\nexport const useInteractiveFiltersVariables = (\n  interactiveFiltersConfig: ChartConfig[\"interactiveFiltersConfig\"],\n  { dimensionsById }: { dimensionsById: DimensionsById }\n): InteractiveFiltersVariables => {\n  const id = interactiveFiltersConfig.timeRange.componentId;\n  const dimension = dimensionsById[id];\n  const getTimeRangeDate = useTemporalVariable(id);\n  const dimensionValues = dimension?.values ?? [];\n  const relatedLimitValues = dimension?.relatedLimitValues ?? [];\n  const values = uniqBy(\n    [...dimensionValues, ...relatedLimitValues],\n    (d) => d.value\n  );\n  const getTimeRangeEntityDate = useTemporalEntityVariable(values)(id);\n\n  return {\n    getTimeRangeDate: isTemporalDimension(dimension)\n      ? getTimeRangeDate\n      : getTimeRangeEntityDate,\n  };\n};\n\nexport type AreaLayerVariables = {\n  areaLayerDimension: GeoShapesDimension | undefined;\n};\n\nexport type SymbolLayerVariables = {\n  symbolLayerDimension:\n    | GeoShapesDimension\n    | GeoCoordinatesDimension\n    | undefined;\n  getSymbol: StringValueGetter;\n  getSymbolLabel: (d: string) => string;\n};\n\nexport type LimitsVariables = {\n  minLimitValue: number | undefined;\n  maxLimitValue: number | undefined;\n};\n\nexport const useLimitsVariables = (limits: ReturnType<typeof useLimits>) => {\n  const values = limits.limits.flatMap((d) => {\n    switch (d.measureLimit.type) {\n      case \"single\":\n        return d.measureLimit.value;\n      case \"value-range\":\n        return [d.measureLimit.min, d.measureLimit.max];\n      case \"time-range\":\n        return [d.measureLimit.value];\n      default:\n        const _exhaustiveCheck: never = d.measureLimit;\n        return _exhaustiveCheck;\n    }\n  });\n\n  return {\n    minLimitValue: min(values),\n    maxLimitValue: max(values),\n  };\n};\n\nexport type ChartStateData = {\n  /** Data with all interactive filters applied, used to draw the shapes. */\n  chartData: Observation[];\n  /** Data with color legend and time range filters applied, used to compute the scales.\n   * As time slider filter is not applied to it, it holds the information about all\n   * potential scale values and makes it possible to fix the scales when animating\n   * the charts. */\n  scalesData: Observation[];\n  /** Data with time range filter applied. Needed to hold the information about all\n   * color values that can be used in a chart, to save unchecked color legend items\n   * from being removed. */\n  segmentData: Observation[];\n  /** Data to be used for interactive time range slider domain. */\n  timeRangeData: Observation[];\n  /** Data used to compute the axes padding. */\n  paddingData: Observation[];\n  /** Full dataset, needed to show the timeline when using time slider.\n   * We can't use `scalesData` here, due to the fact the the `useChartData` hook gets\n   * re-rendered and prevents the timeline from working it such case. */\n  allData: Observation[];\n};\n\ntype ValuePredicate = (v: any) => boolean;\n\n/** Prepares the data to be used in charts, taking interactive filters into account. */\nexport const useChartData = (\n  observations: Observation[],\n  {\n    sortData,\n    chartConfig,\n    timeRangeDimensionId,\n    axisDimensionId,\n    limits,\n    getAxisValueAsDate,\n    getSegmentAbbreviationOrLabel,\n    getTimeRangeDate,\n  }: {\n    sortData?: (data: Observation[]) => Observation[];\n    chartConfig: ChartConfig;\n    timeRangeDimensionId: string | undefined;\n    axisDimensionId?: string;\n    limits?: Limit[];\n    getAxisValueAsDate?: (d: Observation) => Date;\n    getSegmentAbbreviationOrLabel?: (d: Observation) => string;\n    getTimeRangeDate?: (d: Observation) => Date;\n  }\n): ChartStateData => {\n  const { interactiveFiltersConfig } = chartConfig;\n  const allData = useMemo(() => {\n    let allData = observations;\n\n    if (axisDimensionId && limits) {\n      const dimensionValuesObservations = limits\n        .flatMap((limit) => limit.related)\n        .filter((limit) => limit.dimensionId === axisDimensionId)\n        .map((d) => ({\n          [axisDimensionId]: d.label,\n        }));\n      const axisObservationValues = uniq(\n        observations.map((o) => o[axisDimensionId])\n      );\n      allData = [\n        ...observations,\n        ...dimensionValuesObservations.filter(\n          (d) => !axisObservationValues.includes(d[axisDimensionId])\n        ),\n      ];\n    }\n\n    return sortData ? sortData(allData) : observations;\n  }, [axisDimensionId, limits, observations, sortData]);\n\n  const categories = useChartInteractiveFilters((d) => d.categories);\n  const timeRange = useChartInteractiveFilters((d) => d.timeRange);\n  const timeSlider = useChartInteractiveFilters((d) => d.timeSlider);\n\n  // time range\n  const interactiveTimeRange = interactiveFiltersConfig.timeRange;\n  const timeRangeFromTime = interactiveTimeRange.presets.from\n    ? parseDate(interactiveTimeRange.presets.from).getTime()\n    : undefined;\n  const timeRangeToTime = interactiveTimeRange.presets.to\n    ? parseDate(interactiveTimeRange.presets.to).getTime()\n    : undefined;\n  const timeRangeFilters = useMemo(() => {\n    const timeRangeFilter: ValuePredicate | null =\n      getTimeRangeDate && timeRangeFromTime && timeRangeToTime\n        ? (d: Observation) => {\n            const time = getTimeRangeDate(d).getTime();\n            return time >= timeRangeFromTime && time <= timeRangeToTime;\n          }\n        : null;\n\n    return timeRangeFilter ? [timeRangeFilter] : [];\n  }, [timeRangeFromTime, timeRangeToTime, getTimeRangeDate]);\n\n  // interactive time range\n  const interactiveFromTime = timeRange.from?.getTime();\n  const interactiveToTime = timeRange.to?.getTime();\n  const [{ dashboardFilters }] = useConfiguratorState(hasChartConfigs);\n  const { potentialTimeRangeFilterIds } = useDashboardInteractiveFilters();\n  const interactiveTimeRangeFilters = useMemo(() => {\n    const interactiveTimeRangeFilter: ValuePredicate | null =\n      getAxisValueAsDate &&\n      interactiveFromTime &&\n      interactiveToTime &&\n      (interactiveTimeRange?.active ||\n        (dashboardFilters?.timeRange.active &&\n          timeRangeDimensionId &&\n          potentialTimeRangeFilterIds.includes(timeRangeDimensionId)))\n        ? (d: Observation) => {\n            const time = getAxisValueAsDate(d).getTime();\n            return time >= interactiveFromTime && time <= interactiveToTime;\n          }\n        : null;\n\n    return interactiveTimeRangeFilter ? [interactiveTimeRangeFilter] : [];\n  }, [\n    getAxisValueAsDate,\n    interactiveFromTime,\n    interactiveToTime,\n    interactiveTimeRange?.active,\n    dashboardFilters?.timeRange.active,\n    timeRangeDimensionId,\n    potentialTimeRangeFilterIds,\n  ]);\n\n  // interactive time slider\n  const animationField = getAnimationField(chartConfig);\n  const dynamicScales = animationField?.dynamicScales ?? true;\n  const animationComponentId = animationField?.componentId ?? \"\";\n  const getAnimationDate = useTemporalVariable(animationComponentId);\n  const getAnimationOrdinalDate = useStringVariable(animationComponentId);\n  const interactiveTimeSliderFilters = useMemo(() => {\n    const interactiveTimeSliderFilter: ValuePredicate | null =\n      animationField?.componentId && timeSlider.value\n        ? (d: Observation) => {\n            if (timeSlider.type === \"interval\") {\n              return (\n                getAnimationDate(d).getTime() === timeSlider.value!.getTime()\n              );\n            }\n\n            const ordinalDate = getAnimationOrdinalDate(d);\n            return ordinalDate === timeSlider.value!;\n          }\n        : null;\n\n    return interactiveTimeSliderFilter ? [interactiveTimeSliderFilter] : [];\n  }, [\n    animationField?.componentId,\n    timeSlider.type,\n    timeSlider.value,\n    getAnimationDate,\n    getAnimationOrdinalDate,\n  ]);\n\n  // interactive legend\n  const interactiveLegendFilters = useMemo(() => {\n    const legendItems = Object.keys(categories);\n    const interactiveLegendFilter: ValuePredicate | null =\n      interactiveFiltersConfig.legend.active && getSegmentAbbreviationOrLabel\n        ? (d: Observation) => {\n            return !legendItems.includes(getSegmentAbbreviationOrLabel(d));\n          }\n        : null;\n\n    return interactiveLegendFilter ? [interactiveLegendFilter] : [];\n  }, [\n    categories,\n    getSegmentAbbreviationOrLabel,\n    interactiveFiltersConfig.legend.active,\n  ]);\n\n  const chartData = useMemo(() => {\n    return allData.filter(\n      overEvery([\n        ...interactiveLegendFilters,\n        ...interactiveTimeRangeFilters,\n        ...interactiveTimeSliderFilters,\n      ])\n    );\n  }, [\n    allData,\n    interactiveLegendFilters,\n    interactiveTimeRangeFilters,\n    interactiveTimeSliderFilters,\n  ]);\n\n  const scalesData = useMemo(() => {\n    if (dynamicScales) {\n      return chartData;\n    } else {\n      return allData.filter(\n        overEvery([...interactiveLegendFilters, ...interactiveTimeRangeFilters])\n      );\n    }\n  }, [\n    dynamicScales,\n    chartData,\n    allData,\n    interactiveLegendFilters,\n    interactiveTimeRangeFilters,\n  ]);\n\n  const segmentData = useMemo(() => {\n    return allData.filter(overEvery(interactiveTimeRangeFilters));\n  }, [allData, interactiveTimeRangeFilters]);\n\n  const timeRangeData = useMemo(() => {\n    return allData.filter(overEvery(timeRangeFilters));\n  }, [allData, timeRangeFilters]);\n\n  const paddingData = useMemo(() => {\n    if (dynamicScales) {\n      return chartData;\n    } else {\n      return allData.filter(overEvery(interactiveLegendFilters));\n    }\n  }, [dynamicScales, chartData, allData, interactiveLegendFilters]);\n\n  return {\n    allData,\n    chartData,\n    scalesData,\n    segmentData,\n    timeRangeData,\n    paddingData,\n  };\n};\n\n// TODO: base this on UI encodings?\nexport type InteractiveXTimeRangeState = {\n  xScaleTimeRange: ScaleTime<number, number>;\n};\n\nexport type InteractiveYTimeRangeState = {\n  yScaleTimeRange: ScaleTime<number, number>;\n};\n","import { t } from \"@lingui/macro\";\nimport { useCallback } from \"react\";\n\nimport { Switch } from \"@/components/form\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\n\nexport const CalculationToggle = () => {\n  const calculation = useChartInteractiveFilters((d) => d.calculation);\n  const setCalculationType = useChartInteractiveFilters(\n    (d) => d.setCalculationType\n  );\n\n  const onChange = useCallback(() => {\n    setCalculationType(calculation.type === \"percent\" ? \"identity\" : \"percent\");\n  }, [calculation.type, setCalculationType]);\n\n  return (\n    <Switch\n      label={t({\n        id: \"controls.calculation.show-in-percentage\",\n        message: \"Show in %\",\n      })}\n      checked={calculation.type === \"percent\"}\n      onChange={onChange}\n    />\n  );\n};\n","import { Box, BoxProps } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { select } from \"d3-selection\";\nimport { ReactNode, useEffect, useRef } from \"react\";\n\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { CalculationToggle } from \"@/charts/shared/interactive-filter-calculation-toggle\";\nimport { useObserverRef } from \"@/charts/shared/use-size\";\nimport { useEmbedQueryParams } from \"@/components/embed-params\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  hasChartConfigs,\n  isLayoutingFreeCanvas,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { useTransitionStore } from \"@/stores/transition\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nexport const useStyles = makeStyles<{}, {}, \"chartContainer\">(() => ({\n  chartContainer: {\n    overflow: \"hidden\",\n    position: \"relative\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    width: \"100%\",\n    flexGrow: 1,\n  },\n}));\n\nexport const ChartContainer = ({ children }: { children: ReactNode }) => {\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const chartConfig = getChartConfig(state);\n  const isFreeCanvas = isLayoutingFreeCanvas(state);\n  const ref = useObserverRef();\n  const { bounds } = useChartState();\n  const classes = useStyles();\n\n  return (\n    <div\n      // Re-mount to prevent issues with useSize hook when switching between\n      // chart types (that might have different sizes).\n      key={chartConfig.chartType}\n      ref={ref}\n      aria-hidden=\"true\"\n      className={classes.chartContainer}\n      style={{\n        height: isFreeCanvas ? \"initial\" : bounds.height,\n        overflow: \"auto\",\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n\nexport const CHART_SVG_ID = \"chart-svg\";\n\nexport const ChartSvg = ({ children }: { children: ReactNode }) => {\n  const ref = useRef<SVGSVGElement>(null);\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const { bounds, interactiveFiltersConfig } = useChartState();\n  const { width, margins, chartHeight } = bounds;\n\n  useEffect(() => {\n    if (ref.current) {\n      // Initialize height on mount.\n      if (!ref.current.getAttribute(\"height\")) {\n        ref.current.setAttribute(\n          \"height\",\n          `${chartHeight + margins.bottom + margins.top}`\n        );\n      }\n\n      const sel = select(ref.current);\n      (enableTransition\n        ? sel.transition().duration(transitionDuration)\n        : sel\n      ).attr(\"height\", `${chartHeight + margins.bottom + margins.top}`);\n    }\n  }, [\n    chartHeight,\n    margins.bottom,\n    margins.top,\n    enableTransition,\n    transitionDuration,\n  ]);\n\n  return (\n    <svg\n      ref={ref}\n      id={CHART_SVG_ID}\n      width={width}\n      style={{ position: \"absolute\", left: 0, top: 0 }}\n    >\n      {interactiveFiltersConfig.calculation.active && (\n        <foreignObject\n          {...DISABLE_SCREENSHOT_ATTR}\n          width={width - margins.right}\n          y={0}\n          height={26}\n          style={{ display: \"flex\" }}\n        >\n          <CalculationToggle />\n        </foreignObject>\n      )}\n      {children}\n    </svg>\n  );\n};\n\nexport const ChartControlsContainer = (props: BoxProps) => {\n  const { sx, ...rest } = props;\n  const { embedParams } = useEmbedQueryParams();\n\n  return (\n    <Box\n      sx={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        gap: 4,\n        mt: 2,\n        mb: embedParams.optimizeSpace ? 3 : 4,\n        ...sx,\n      }}\n      {...rest}\n    />\n  );\n};\n","import { interpolate } from \"d3-interpolate\";\n\nimport { ChartConfig, isAreaConfig } from \"@/config-types\";\n\nexport const interpolateZerosValue = () => {\n  return 0;\n};\n\nexport const interpolateTemporalLinearValue = ({\n  previousValue,\n  nextValue,\n  previousTime,\n  currentTime,\n  nextTime,\n}: {\n  previousValue: number;\n  nextValue: number;\n  previousTime: number;\n  currentTime: number;\n  nextTime: number;\n}) => {\n  return interpolate(\n    previousValue,\n    nextValue\n  )((currentTime - previousTime) / (nextTime - previousTime));\n};\n\ninterface TemporalSeriesBeforeImputationEntry {\n  date: Date;\n  value: number | null;\n}\n\ninterface TemporalSeriesAfterImputationEntry {\n  date: Date;\n  value: number;\n}\n\nexport const imputeTemporalLinearSeries = ({\n  dataSortedByX,\n}: {\n  dataSortedByX: Array<TemporalSeriesBeforeImputationEntry>;\n}): Array<TemporalSeriesAfterImputationEntry> => {\n  const presentDataIndexes = [];\n  const missingDataIndexes = [];\n\n  for (let i = 0; i < dataSortedByX.length; i++) {\n    if (dataSortedByX[i].value !== null) {\n      presentDataIndexes.push(i);\n    } else {\n      missingDataIndexes.push(i);\n    }\n  }\n\n  for (const missingDataIndex of missingDataIndexes) {\n    const nextPresentDataIndex = presentDataIndexes.findIndex(\n      (d) => d > missingDataIndex\n    );\n\n    if (nextPresentDataIndex) {\n      const previousPresentDataIndex = nextPresentDataIndex - 1;\n\n      if (previousPresentDataIndex >= 0) {\n        const previous =\n          dataSortedByX[presentDataIndexes[previousPresentDataIndex]];\n        const next = dataSortedByX[presentDataIndexes[nextPresentDataIndex]];\n\n        dataSortedByX[missingDataIndex] = {\n          date: dataSortedByX[missingDataIndex].date,\n          value: interpolateTemporalLinearValue({\n            previousValue: previous.value!,\n            nextValue: next.value!,\n            previousTime: previous.date.getTime(),\n            nextTime: next.date.getTime(),\n            currentTime: dataSortedByX[missingDataIndex].date.getTime(),\n          }),\n        };\n\n        continue;\n      }\n    }\n\n    dataSortedByX[missingDataIndex] = {\n      date: dataSortedByX[missingDataIndex].date,\n      value: 0,\n    };\n  }\n\n  return dataSortedByX as Array<TemporalSeriesAfterImputationEntry>;\n};\n\nexport const isUsingImputation = (chartConfig: ChartConfig): boolean => {\n  if (isAreaConfig(chartConfig)) {\n    const imputationType = chartConfig.fields.y.imputationType || \"\";\n\n    return [\"zeros\", \"linear\"].includes(imputationType);\n  }\n\n  return false;\n};\n","import { ascending } from \"d3-array\";\n\nimport { HierarchyValue } from \"@/domain/data\";\n\nexport const getLegendGroups = ({\n  title,\n  values,\n  sort,\n}: {\n  title?: string;\n  values: string[];\n  sort: boolean;\n}) => {\n  const groupsMap = new Map<HierarchyValue[], string[]>();\n  groupsMap.set(title ? [{ label: title } as HierarchyValue] : [], values);\n  const groups = Array.from(groupsMap.entries());\n\n  if (sort) {\n    // Re-sort hierarchy groups against the label order that we have received\n    const valueOrder = Object.fromEntries(values.map((x, i) => [x, i]));\n    groups.forEach(([_, entries]) => {\n      entries.sort((a, b) => ascending(valueOrder[a], valueOrder[b]));\n    });\n  }\n\n  return groups;\n};\n","import { t } from \"@lingui/macro\";\nimport { Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport orderBy from \"lodash/orderBy\";\nimport { memo, useCallback, useMemo } from \"react\";\n\nimport { ColorsChartState, useChartState } from \"@/charts/shared/chart-state\";\nimport { rgbArrayToHex } from \"@/charts/shared/colors\";\nimport { getLegendGroups } from \"@/charts/shared/legend-color-helpers\";\nimport { Flex } from \"@/components/flex\";\nimport { Checkbox, CheckboxProps } from \"@/components/form\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport { OpenMetadataPanelWrapper } from \"@/components/metadata-panel\";\nimport { useChartConfigFilters, useLimits } from \"@/config-utils\";\nimport {\n  AreaConfig,\n  BarConfig,\n  ChartConfig,\n  ColumnConfig,\n  GenericField,\n  isSegmentInConfig,\n  LineConfig,\n  MapConfig,\n  PieConfig,\n  ScatterPlotConfig,\n  useReadOnlyConfiguratorState,\n} from \"@/configurator\";\nimport {\n  Component,\n  isOrdinalDimension,\n  isOrdinalMeasure,\n  Measure,\n  Observation,\n} from \"@/domain/data\";\nimport { useFormatNumber } from \"@/formatters\";\nimport SvgIcChevronRight from \"@/icons/components/IcChevronRight\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\nimport { interlace } from \"@/utils/interlace\";\nimport { makeDimensionValueSorters } from \"@/utils/sorting-values\";\nimport { useEvent } from \"@/utils/use-event\";\n\nimport { DimensionsById } from \"./chart-props\";\n\nexport type LegendSymbol =\n  | \"square\"\n  | \"line\"\n  | \"dashed-line\"\n  | \"circle\"\n  | \"cross\"\n  | \"triangle\";\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  legendContainer: {\n    position: \"relative\",\n    justifyContent: \"flex-start\",\n    alignItems: \"flex-start\",\n    flexWrap: \"wrap\",\n    minHeight: \"20px\",\n    gap: \"1rem 1.5rem\",\n    display: \"grid\",\n    gridTemplateColumns: \"repeat(auto-fill, minmax(300px, 1fr))\",\n    gridAutoFlow: \"row dense\",\n  },\n  legendContainerNoGroups: {\n    gridTemplateColumns: \"1fr\",\n    \"& $legendGroup\": {\n      flexDirection: \"row\",\n    },\n  },\n  legendGroup: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    columnGap: theme.spacing(3),\n    rowGap: theme.spacing(2),\n    flexDirection: \"column\",\n  },\n  groupHeader: {\n    marginBottom: theme.spacing(1),\n    flexWrap: \"wrap\",\n  },\n}));\n\nconst useLegendGroups = ({\n  chartConfig,\n  title,\n  values,\n}: {\n  chartConfig: ChartConfig;\n  title?: string;\n  values: string[];\n}) => {\n  const configState = useReadOnlyConfiguratorState();\n\n  if (\n    configState.state === \"INITIAL\" ||\n    configState.state === \"SELECTING_DATASET\"\n  ) {\n    throw Error(`Cannot call useLegendGroups from state ${configState.state}`);\n  }\n\n  const segmentField = (\n    isSegmentInConfig(chartConfig) ? chartConfig.fields.segment : null\n  ) as GenericField | null | undefined;\n\n  return useMemo(() => {\n    return getLegendGroups({\n      title,\n      values,\n      sort: !!(segmentField && \"sorting\" in segmentField),\n    });\n  }, [title, values, segmentField]);\n};\n\nexport const LegendColor = memo(function LegendColor({\n  chartConfig,\n  symbol,\n  getLegendItemDimension,\n  interactive,\n  showTitle,\n  dimensionsById,\n  limits,\n}: {\n  chartConfig:\n    | AreaConfig\n    | BarConfig\n    | ColumnConfig\n    | LineConfig\n    | PieConfig\n    | ScatterPlotConfig;\n  symbol: LegendSymbol;\n  /** If the legend is based on measures, this function can be used to get the\n   * corresponding measure to open the metadata panel.\n   **/\n  getLegendItemDimension?: (dimensionLabel: string) => Measure | undefined;\n  interactive?: boolean;\n  showTitle?: boolean;\n  dimensionsById?: DimensionsById;\n  limits?: ReturnType<typeof useLimits>;\n}) {\n  const { colors, getColorLabel } = useChartState() as ColorsChartState;\n  const values =\n    chartConfig.fields.color.type === \"segment\" ? colors.domain() : [];\n  const groups = useLegendGroups({ chartConfig, values });\n  const segmentComponent =\n    isSegmentInConfig(chartConfig) &&\n    chartConfig.fields.segment &&\n    dimensionsById\n      ? dimensionsById[chartConfig.fields.segment.componentId]\n      : null;\n\n  return (\n    <div>\n      {showTitle && segmentComponent && (\n        <OpenMetadataPanelWrapper component={segmentComponent}>\n          <Typography\n            data-testid=\"legendTitle\"\n            component=\"div\"\n            variant=\"caption\"\n          >\n            {segmentComponent.label}\n          </Typography>\n        </OpenMetadataPanelWrapper>\n      )}\n      <LegendColorContent\n        groups={groups}\n        limits={limits?.limits.map(\n          ({ configLimit, measureLimit, limitUnit }) => {\n            let values: number[] = [];\n\n            switch (measureLimit.type) {\n              case \"single\":\n                values = [measureLimit.value];\n                break;\n              case \"value-range\":\n                values = [measureLimit.min, measureLimit.max];\n                break;\n              case \"time-range\":\n                values = [measureLimit.value];\n                break;\n              default:\n                const _exhaustiveCheck: never = measureLimit;\n                return _exhaustiveCheck;\n            }\n\n            return {\n              label: measureLimit.name,\n              values,\n              color: configLimit.color,\n              symbol: !configLimit.symbolType\n                ? configLimit.lineType === \"dashed\"\n                  ? \"dashed-line\"\n                  : \"line\"\n                : configLimit.symbolType,\n              unit: limitUnit,\n            };\n          }\n        )}\n        getColor={colors}\n        getLabel={getColorLabel}\n        getItemDimension={getLegendItemDimension}\n        symbol={symbol}\n        interactive={interactive}\n        numberOfOptions={values.length}\n      />\n    </div>\n  );\n});\n\nconst removeOpacity = (rgb: number[]) => rgb.slice(0, 3);\n\nexport const MapLegendColor = memo(function LegendColor({\n  component,\n  getColor,\n  useAbbreviations,\n  chartConfig,\n  observations,\n}: {\n  component: Component;\n  getColor: (d: Observation) => number[];\n  useAbbreviations: boolean;\n  chartConfig: MapConfig;\n  observations: Observation[];\n}) {\n  const filters = useChartConfigFilters(chartConfig);\n  const dimensionFilter = filters[component.id];\n  const sortedValues = useMemo(() => {\n    const sorters = makeDimensionValueSorters(component, {\n      sorting: { sortingType: \"byAuto\", sortingOrder: \"asc\" },\n      dimensionFilter,\n    });\n    return orderBy(\n      component.values,\n      sorters.map((s) => (d) => s(d.label))\n    );\n  }, [component, dimensionFilter]);\n  const getLabel = useCallback(\n    (d: string) => {\n      if (useAbbreviations) {\n        const v = component.values.find((v) => v.value === d);\n        return (v?.alternateName || v?.label) as string;\n      } else {\n        return component.values.find((v) => v.value === d)?.label as string;\n      }\n    },\n    [component, useAbbreviations]\n  );\n  const legendValues = useMemo(() => {\n    const observationLabels = new Set(observations.map((o) => o[component.id]));\n    const sortedStringValues = sortedValues.map((d) => `${d.value}`);\n    // If the component is a measure or an ordinal dimension, we want to show all\n    // values for comparison purposes\n    return isOrdinalDimension(component) || isOrdinalMeasure(component)\n      ? sortedStringValues\n      : sortedStringValues.filter((v) => observationLabels.has(getLabel(v)));\n  }, [observations, sortedValues, component, getLabel]);\n  const groups = useLegendGroups({\n    chartConfig,\n    title: component.label,\n    values: legendValues,\n  });\n\n  return (\n    <LegendColorContent\n      groups={groups}\n      getColor={(v) => {\n        const label = getLabel(v);\n        const rgb = getColor({ [component.id]: label });\n        return rgbArrayToHex(removeOpacity(rgb));\n      }}\n      getLabel={getLabel}\n      symbol=\"circle\"\n      numberOfOptions={sortedValues.length}\n    />\n  );\n});\n\nconst LegendColorContent = ({\n  groups,\n  limits,\n  getColor,\n  getLabel,\n  getItemDimension,\n  symbol,\n  interactive,\n  numberOfOptions,\n}: {\n  groups: ReturnType<typeof useLegendGroups>;\n  limits?: {\n    label: string;\n    values: number[];\n    color: string;\n    symbol: LegendSymbol;\n    unit?: string;\n  }[];\n  getColor: (d: string) => string;\n  getLabel: (d: string) => string;\n  getItemDimension?: (dimensionLabel: string) => Measure | undefined;\n  symbol: LegendSymbol;\n  interactive?: boolean;\n  numberOfOptions: number;\n}) => {\n  const classes = useStyles();\n  const categories = useChartInteractiveFilters((d) => d.categories);\n  const addCategory = useChartInteractiveFilters((d) => d.addCategory);\n  const removeCategory = useChartInteractiveFilters((d) => d.removeCategory);\n  const activeInteractiveFilters = useMemo(() => {\n    return new Set(Object.keys(categories));\n  }, [categories]);\n\n  const soleItemChecked = activeInteractiveFilters.size === numberOfOptions - 1;\n\n  const handleToggle: CheckboxProps[\"onChange\"] = useEvent((e) => {\n    const disabled = soleItemChecked && !e.target.checked;\n    const item = e.target.value;\n\n    if (activeInteractiveFilters.has(item)) {\n      removeCategory(item);\n    } else if (!disabled) {\n      addCategory(item);\n    }\n  });\n\n  const formatNumber = useFormatNumber({ decimals: \"auto\" });\n\n  return (\n    <Flex\n      className={clsx(\n        classes.legendContainer,\n        groups.length === 1 && classes.legendContainerNoGroups\n      )}\n    >\n      {groups\n        ? groups.map(([g, colorValues], i) => {\n            const key = g.map((n) => n.label).join(\" > \");\n            const isLastGroup = i === groups.length - 1;\n            const headerLabelsArray = g.map((d) => d.label);\n\n            return (\n              <div\n                key={key}\n                className={classes.legendGroup}\n                data-testid=\"colorLegend\"\n              >\n                {headerLabelsArray.length > 0 ? (\n                  <Typography\n                    variant=\"h5\"\n                    display=\"flex\"\n                    alignItems=\"center\"\n                    className={classes.groupHeader}\n                  >\n                    {interlace(\n                      g.map((n) => n.label),\n                      (chevronKey) => (\n                        <SvgIcChevronRight key={chevronKey} />\n                      )\n                    )}\n                  </Typography>\n                ) : null}\n                {colorValues.map((value, i) => {\n                  const key = `${value}-${i}`;\n                  const label = getLabel(value);\n                  const active = !activeInteractiveFilters.has(label);\n\n                  return (\n                    <LegendItem\n                      key={key}\n                      label={label}\n                      color={getColor(value)}\n                      dimension={getItemDimension?.(label)}\n                      symbol={symbol}\n                      interactive={interactive}\n                      onToggle={handleToggle}\n                      checked={interactive && active}\n                      disabled={soleItemChecked && active}\n                    />\n                  );\n                })}\n                {isLastGroup && limits\n                  ? limits.map(({ label, values, color, symbol, unit }, i) => (\n                      <LegendItem\n                        key={i}\n                        label={`${label}: ${values.map(formatNumber).join(\"-\")}${unit ? ` ${unit}` : \"\"}`}\n                        color={color}\n                        symbol={symbol}\n                      />\n                    ))\n                  : null}\n              </div>\n            );\n          })\n        : null}\n    </Flex>\n  );\n};\n\nconst LegendIcon = ({\n  symbol,\n  size,\n  fill,\n}: {\n  symbol: LegendSymbol;\n  size: number;\n  fill: string;\n}) => {\n  let node: JSX.Element;\n\n  switch (symbol) {\n    case \"circle\":\n      node = <circle cx={0.5} cy={0.5} r={0.5} fill={fill} />;\n      break;\n    case \"square\":\n      node = <rect width={1} height={1} fill={fill} />;\n      break;\n    case \"cross\":\n      node = (\n        <g fill={fill} transform=\"translate(0 0.05) rotate(45 0.5 0.5)\">\n          <rect x={0.45} y={0} width={0.1} height={1} />\n          <rect x={0} y={0.45} width={1} height={0.1} />\n        </g>\n      );\n      break;\n    case \"line\":\n      node = (\n        <line\n          x1={0}\n          x2={1}\n          y1={0.5}\n          y2={0.5}\n          stroke={fill}\n          strokeWidth={2.5}\n          vectorEffect=\"non-scaling-stroke\"\n        />\n      );\n      break;\n    case \"dashed-line\":\n      node = (\n        <line\n          x1={0}\n          x2={1}\n          y1={0.5}\n          y2={0.5}\n          stroke={fill}\n          strokeWidth={2.5}\n          vectorEffect=\"non-scaling-stroke\"\n          strokeDashoffset=\"3\"\n          strokeDasharray=\"2 2\"\n        />\n      );\n      break;\n    case \"triangle\":\n      node = (\n        <polygon\n          points=\"0.5,0.1339746 0.0669873,0.8660254 0.9330127,0.8660254\"\n          transform=\"translate(0 0.05)\"\n          fill={fill}\n        />\n      );\n      break;\n    default:\n      const _exhaustiveCheck: never = symbol;\n      return _exhaustiveCheck;\n  }\n\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox=\"0 0 1 1\"\n      style={{ minWidth: size, minHeight: size }}\n    >\n      {node}\n    </svg>\n  );\n};\n\nexport const LegendItem = ({\n  label,\n  color,\n  dimension,\n  symbol,\n  interactive,\n  onToggle,\n  checked,\n  disabled,\n  smaller,\n}: {\n  label: string;\n  color: string;\n  dimension?: Measure;\n  symbol: LegendSymbol;\n  interactive?: boolean;\n  onToggle?: CheckboxProps[\"onChange\"];\n  checked?: boolean;\n  disabled?: boolean;\n  smaller?: boolean;\n}) => {\n  const labelNode = (\n    <Typography\n      variant={smaller ? \"caption\" : \"body3\"}\n      style={{ wordBreak: \"break-word\" }}\n    >\n      {label}\n    </Typography>\n  );\n\n  return interactive && onToggle ? (\n    <MaybeTooltip\n      title={\n        disabled\n          ? t({\n              id: \"controls.filters.interactive.color.min-1-filter\",\n              message: \"At least one filter must be selected.\",\n            })\n          : undefined\n      }\n    >\n      <div>\n        <Checkbox\n          name={label}\n          label={label}\n          value={label}\n          checked={checked ?? true}\n          onChange={onToggle}\n          color={color}\n          size={smaller ? \"sm\" : \"md\"}\n        />\n      </div>\n    </MaybeTooltip>\n  ) : (\n    <Flex\n      data-testid=\"legendItem\"\n      sx={{ alignItems: \"center\", gap: smaller ? 1 : 2 }}\n    >\n      <LegendIcon symbol={symbol} size={smaller ? 8 : 12} fill={color} />\n      {dimension ? (\n        <OpenMetadataPanelWrapper component={dimension}>\n          {labelNode}\n        </OpenMetadataPanelWrapper>\n      ) : (\n        labelNode\n      )}\n    </Flex>\n  );\n};\n","import isEqual from \"lodash/isEqual\";\n\ntype Value = Record<string, unknown>;\n\nexport const orderedIsEqual = (obj1: Value, obj2: Value) => {\n  return isEqual(Object.keys(obj1), Object.keys(obj2)) && isEqual(obj1, obj2);\n};\n","import isEmpty from \"lodash/isEmpty\";\n\nimport { DataSource, Filters, SingleFilters } from \"@/config-types\";\nimport { PossibleFiltersQueryVariables } from \"@/graphql/query-hooks\";\nimport { orderedIsEqual } from \"@/utils/ordered-is-equal\";\n\n/** Used to make urql re-query when order of filters changes. */\nconst getPossibleFiltersQueryKey = (unmappedFilters: SingleFilters) => {\n  return Object.keys(unmappedFilters).join(\", \");\n};\n\nexport const getPossibleFiltersQueryVariables = (props: {\n  cubeIri: string;\n  dataSource: DataSource;\n  unmappedFilters: SingleFilters;\n}): PossibleFiltersQueryVariables => {\n  const { cubeIri, dataSource, unmappedFilters } = props;\n  const filterKey = getPossibleFiltersQueryKey(unmappedFilters);\n  return {\n    sourceType: dataSource.type,\n    sourceUrl: dataSource.url,\n    cubeFilter: {\n      iri: cubeIri,\n      filters: unmappedFilters,\n    },\n    // @ts-ignore\n    filterKey,\n  };\n};\n\nexport const skipPossibleFiltersQuery = (\n  oldFilters: Filters | undefined,\n  newFilters: SingleFilters\n) => {\n  return (\n    (oldFilters && orderedIsEqual(oldFilters, newFilters)) ||\n    isEmpty(newFilters)\n  );\n};\n","import { group, sum } from \"d3-array\";\nimport { NumberValue, ScaleLinear, scaleLinear } from \"d3-scale\";\nimport { Series } from \"d3-shape\";\n\nimport {\n  NumericalValueGetter,\n  StringValueGetter,\n} from \"@/charts/shared/chart-state\";\nimport { NumericalMeasure, Observation } from \"@/domain/data\";\nimport { formatNumberWithUnit } from \"@/formatters\";\n\nconst NORMALIZED_VALUE_DOMAIN = [0, 100];\n\nexport const getStackedYScale = (\n  data: Observation[],\n  {\n    normalize,\n    getX,\n    getY,\n    getTime,\n    minLimitValue,\n    maxLimitValue,\n    customDomain,\n  }: {\n    normalize: boolean;\n    getX: StringValueGetter;\n    getY: NumericalValueGetter;\n    getTime?: StringValueGetter;\n    minLimitValue?: number;\n    maxLimitValue?: number;\n    customDomain?: [number, number];\n  }\n): ScaleLinear<number, number> => {\n  const yScale = scaleLinear();\n\n  if (normalize) {\n    // We don't allow overwriting of 100% mode.\n    yScale.domain(NORMALIZED_VALUE_DOMAIN);\n  } else {\n    if (customDomain) {\n      return yScale.domain(customDomain);\n    }\n\n    const grouped = group(data, (d) => getX(d) + getTime?.(d));\n    let yMin = 0;\n    let yMax = 0;\n\n    for (const [, v] of grouped) {\n      const values = v.map(getY).filter((d) => d !== null) as number[];\n      const newYMin = sum(values.filter((d) => d < 0));\n      const newYMax = sum(values.filter((d) => d >= 0));\n\n      if (yMin === undefined || newYMin < yMin) {\n        yMin = newYMin;\n      }\n\n      if (yMax === undefined || newYMax > yMax) {\n        yMax = newYMax;\n      }\n    }\n\n    yScale\n      .domain([\n        minLimitValue !== undefined ? Math.min(minLimitValue, yMin) : yMin,\n        maxLimitValue !== undefined ? Math.max(maxLimitValue, yMax) : yMax,\n      ])\n      .nice();\n  }\n\n  return yScale;\n};\n\nexport const getStackedXScale = (\n  data: Observation[],\n  {\n    normalize,\n    getX,\n    getY,\n    getTime,\n    customDomain,\n  }: {\n    normalize: boolean;\n    getY: StringValueGetter;\n    getX: NumericalValueGetter;\n    getTime?: StringValueGetter;\n    customDomain?: [number, number];\n  }\n): ScaleLinear<number, number> => {\n  const xScale = scaleLinear();\n\n  if (normalize) {\n    // We don't allow overwriting of 100% mode.\n    xScale.domain(NORMALIZED_VALUE_DOMAIN);\n  } else {\n    if (customDomain) {\n      return xScale.domain(customDomain);\n    }\n\n    const grouped = group(data, (d) => getY(d) + getTime?.(d));\n    let xMin = 0;\n    let xMax = 0;\n\n    for (const [, v] of grouped) {\n      const values = v.map(getX).filter((d) => d !== null) as number[];\n      const newXMin = sum(values.filter((d) => d < 0));\n      const newXMax = sum(values.filter((d) => d >= 0));\n\n      if (xMin === undefined || newXMin < xMin) {\n        xMin = newXMin;\n      }\n\n      if (xMax === undefined || newXMax > xMax) {\n        xMax = newXMax;\n      }\n    }\n\n    xScale.domain([xMin, xMax]).nice();\n  }\n\n  return xScale;\n};\n\nexport const getStackedTooltipValueFormatter = ({\n  normalize,\n  measureId,\n  measureUnit,\n  formatters,\n  formatNumber,\n}: {\n  normalize: boolean;\n  measureId: string;\n  measureUnit: NumericalMeasure[\"unit\"];\n  formatters: { [k: string]: (s: any) => string };\n  formatNumber: (d: NumberValue | null | undefined) => string;\n}) => {\n  return (d: number | null, dIdentity: number | null) => {\n    if (d === null && dIdentity === null) {\n      return \"-\";\n    }\n\n    const format = formatters[measureId] ?? formatNumber;\n\n    if (normalize) {\n      const rounded = Math.round(d as number);\n      const fValue = formatNumberWithUnit(dIdentity, format, measureUnit);\n\n      return `${rounded}% (${fValue})`;\n    }\n\n    return formatNumberWithUnit(d, format, measureUnit);\n  };\n};\n\nexport const getStackedPosition = <T extends { [key: string]: any }>({\n  observation,\n  series,\n  key,\n  getAxisValue,\n  measureScale,\n  fallbackMeasureValue,\n  segment,\n}: {\n  observation: Observation;\n  series: Series<T, string>[];\n  key: string;\n  getAxisValue: (d: Observation) => string;\n  measureScale: ScaleLinear<number, number>;\n  fallbackMeasureValue: number;\n  segment: string;\n}) => {\n  const axisValue = getAxisValue(observation);\n  const segmentSeries = series.find((s) => s.key === segment);\n  const seriesPoint = segmentSeries?.find((s) => s.data[key] === axisValue);\n\n  if (!seriesPoint) {\n    return fallbackMeasureValue;\n  }\n\n  const [y0, y1] = seriesPoint;\n\n  return measureScale(series.length === 1 ? y1 : (y0 + y1) * 0.5);\n};\n","import { t } from \"@lingui/macro\";\nimport { ascending, descending } from \"d3-array\";\nimport { TimeLocaleObject } from \"d3-time-format\";\nimport uniqBy from \"lodash/uniqBy\";\nimport { useMemo } from \"react\";\n\nimport {\n  hasChartConfigs,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport {\n  Dimension,\n  getTemporalEntityValue,\n  isTemporalDimensionWithTimeUnit,\n  isTemporalEntityDimension,\n  TemporalDimension,\n  TemporalEntityDimension,\n} from \"@/domain/data\";\nimport { useTimeFormatLocale } from \"@/formatters\";\nimport { useConfigsCubeComponents } from \"@/graphql/hooks\";\nimport { stringifyComponentId } from \"@/graphql/make-component-id\";\nimport { TimeUnit } from \"@/graphql/query-hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { timeUnitFormats, timeUnitOrder } from \"@/rdf/mappings\";\nimport { useDashboardInteractiveFilters } from \"@/stores/interactive-filters\";\n\n/** Hook to get combined temporal dimension. Useful for shared dashboard filters. */\nexport const useCombinedTemporalDimension = () => {\n  const locale = useLocale();\n  const formatLocale = useTimeFormatLocale();\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const { potentialTimeRangeFilterIds } = useDashboardInteractiveFilters();\n  const [{ data }] = useConfigsCubeComponents({\n    variables: {\n      state,\n      locale,\n    },\n  });\n\n  return useMemo(() => {\n    return getCombinedTemporalDimension({\n      formatLocale,\n      dimensions: data?.dataCubesComponents.dimensions ?? [],\n      potentialTimeRangeFilterIds,\n    });\n  }, [\n    data?.dataCubesComponents.dimensions,\n    formatLocale,\n    potentialTimeRangeFilterIds,\n  ]);\n};\n\nexport const getCombinedTemporalDimension = ({\n  formatLocale,\n  dimensions,\n  potentialTimeRangeFilterIds,\n}: {\n  formatLocale: TimeLocaleObject;\n  dimensions: Dimension[];\n  potentialTimeRangeFilterIds: string[];\n}) => {\n  const timeUnitDimensions = dimensions.filter(\n    (dimension) =>\n      isTemporalDimensionWithTimeUnit(dimension) &&\n      potentialTimeRangeFilterIds.includes(dimension.id)\n  ) as (TemporalDimension | TemporalEntityDimension)[];\n  // We want to use lowest time unit for combined dimension filtering,\n  // so in case we have year and day, we'd filter both by day\n  const timeUnit = timeUnitDimensions.sort((a, b) =>\n    descending(\n      timeUnitOrder.get(a.timeUnit) ?? 0,\n      timeUnitOrder.get(b.timeUnit) ?? 0\n    )\n  )[0]?.timeUnit as TimeUnit;\n  const timeFormat = timeUnitFormats.get(timeUnit) as string;\n  const values = timeUnitDimensions.flatMap((dimension) => {\n    const formatDate = formatLocale.format(timeFormat);\n    const parseDate = formatLocale.parse(dimension.timeFormat);\n    // Standardize values to have same date format\n    const temporalEntity = isTemporalEntityDimension(dimension);\n    return dimension.values.map((dv) => {\n      const date = parseDate(\n        `${temporalEntity ? getTemporalEntityValue(dv) : dv.value}`\n      ) as Date;\n      const dateString = formatDate(date);\n      return {\n        ...dv,\n        value: dateString,\n        label: dateString,\n      };\n    });\n  });\n  const combinedDimension: TemporalDimension = {\n    __typename: \"TemporalDimension\",\n    cubeIri: \"all\",\n    id: stringifyComponentId({\n      unversionedCubeIri: \"all\",\n      unversionedComponentIri: \"combined-date-filter\",\n    }),\n    label: t({\n      id: \"controls.section.shared-filters.date\",\n      message: \"Date\",\n    }),\n    isKeyDimension: true,\n    isNumerical: false,\n    values: uniqBy(values, \"value\").sort((a, b) => ascending(a.value, b.value)),\n    relatedLimitValues: [],\n    timeUnit,\n    timeFormat,\n  };\n\n  return combinedDimension;\n};\n","import {\n  createContext,\n  ReactNode,\n  useContext,\n  useEffect,\n  useMemo,\n} from \"react\";\n\nimport { useTransitionStore } from \"@/stores/transition\";\nimport { INIT_SIZE, useResizeObserver } from \"@/utils/use-resize-observer\";\nimport { useTimedPrevious } from \"@/utils/use-timed-previous\";\n\nexport type Margins = {\n  top: number;\n  right: number;\n  bottom: number;\n  left: number;\n};\n\nexport type Bounds = {\n  width: number;\n  height: number;\n  margins: Margins;\n  chartWidth: number;\n  chartHeight: number;\n  aspectRatio: number;\n};\n\nconst RESIZE_DELAY = 500;\n\nexport const CHART_RESIZE_EVENT_TYPE = \"VISUALIZE-CHART-RESIZE\";\n\nexport const Observer = ({ children }: { children: ReactNode }) => {\n  const [ref, width, height] = useResizeObserver<HTMLDivElement>();\n  const prevWidth = useTimedPrevious(width, RESIZE_DELAY);\n  const prevHeight = useTimedPrevious(height, RESIZE_DELAY);\n  const isResizing =\n    prevWidth !== width ||\n    prevHeight !== height ||\n    (width === INIT_SIZE && height === INIT_SIZE);\n  const brushing = useTransitionStore((state) => state.brushing);\n  const setEnableTransition = useTransitionStore((state) => state.setEnable);\n  useEffect(() => {\n    if (!brushing) {\n      setEnableTransition(!isResizing);\n    }\n  }, [brushing, isResizing, setEnableTransition]);\n\n  const size = useMemo(\n    () => ({\n      width,\n      height,\n      ref,\n    }),\n    [width, height, ref]\n  );\n\n  return (\n    <ChartObserverContext.Provider value={size}>\n      {children}\n    </ChartObserverContext.Provider>\n  );\n};\n\nconst ChartObserverContext = createContext(\n  undefined as\n    | undefined\n    | {\n        width: number;\n        height: number;\n        ref: (node: HTMLDivElement) => void;\n      }\n);\n\nexport const useSize = () => {\n  const ctx = useContext(ChartObserverContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need to wrap your component in <ChartObserverContextProvider /> to useSize()\"\n    );\n  }\n\n  return { width: ctx.width, height: ctx.height };\n};\n\nexport const useObserverRef = () => {\n  const ctx = useContext(ChartObserverContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need to wrap your component in <ChartObserverContextProvider /> to useObserverRef()\"\n    );\n  }\n\n  return ctx.ref;\n};\n","import { Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { ReactNode } from \"react\";\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n    gap: theme.spacing(2),\n    height: \"fit-content\",\n    marginTop: \"-0.33rem\",\n  },\n}));\n\nexport const ActionElementsContainer = ({\n  children,\n}: {\n  children: ReactNode;\n}) => {\n  const classes = useStyles();\n\n  return <div className={classes.root}>{children}</div>;\n};\n","import { Button, ButtonProps } from \"@mui/material\";\nimport { ComponentProps } from \"react\";\n\nimport { Icon } from \"@/icons\";\n\nexport const AddButton = (props: Omit<ButtonProps, \"startIcon\">) => {\n  return (\n    <Button size=\"sm\" startIcon={<Icon name=\"plus\" size={20} />} {...props} />\n  );\n};\n\nexport const ConfiguratorAddButton = (\n  props: ComponentProps<typeof AddButton>\n) => {\n  const { sx, ...rest } = props;\n\n  return (\n    <AddButton\n      size=\"sm\"\n      variant=\"outlined\"\n      sx={{ width: \"fit-content\", mt: 4, ...sx }}\n      {...rest}\n    />\n  );\n};\n","import { Menu, paperClasses, styled } from \"@mui/material\";\n\nconst commonBeforeStyles: Partial<CSSStyleDeclaration> = {\n  content: '\" \"',\n  position: \"absolute\",\n  display: \"block\",\n  width: \"10px\",\n  height: \"10px\",\n  margin: \"auto\",\n  background: \"white\",\n  transform: \"rotate(45deg)\",\n};\n\nexport const ArrowMenuTopCenter = styled(Menu)({\n  [`& .${paperClasses.root}`]: {\n    overflow: \"visible\",\n    \"&:before\": {\n      ...commonBeforeStyles,\n      top: -5,\n      left: \"0%\",\n      right: 0,\n    },\n  },\n});\n\nexport const ArrowMenuBottomCenter = styled(Menu)({\n  [`& .${paperClasses.root}`]: {\n    overflow: \"visible\",\n    \"&:before\": {\n      ...commonBeforeStyles,\n      bottom: -5,\n      left: \"0%\",\n      right: 0,\n    },\n  },\n});\n\nexport const ArrowMenuTopBottom = styled(Menu)({\n  [`& .${paperClasses.root}`]: {\n    overflow: \"visible\",\n    \"&:before\": {\n      ...commonBeforeStyles,\n      top: -5,\n      left: \"0%\",\n      right: 0,\n    },\n  },\n});\n\nexport const ArrowMenuBottomTop = styled(Menu)({\n  [`& .${paperClasses.root}`]: {\n    overflow: \"visible\",\n    \"&:before\": {\n      ...commonBeforeStyles,\n      bottom: -5,\n      left: 0,\n      right: \"0%\",\n    },\n  },\n});\n","import { Box, SxProps, Theme } from \"@mui/material\";\n\nimport { DataTablePreview } from \"@/browse/ui/data-table-preview\";\nimport {\n  extractChartConfigComponentIds,\n  useQueryFilters,\n} from \"@/charts/shared/chart-helpers\";\nimport { Loading } from \"@/components/hint\";\nimport {\n  ChartConfig,\n  DashboardFiltersConfig,\n  DataSource,\n} from \"@/config-types\";\nimport {\n  useDataCubesComponentsQuery,\n  useDataCubesMetadataQuery,\n  useDataCubesObservationsQuery,\n} from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const ChartDataTablePreview = ({\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n  sx,\n}: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  sx?: SxProps<Theme>;\n}) => {\n  const locale = useLocale();\n  const componentIds = extractChartConfigComponentIds({ chartConfig });\n  const commonQueryVariables = {\n    sourceType: dataSource.type,\n    sourceUrl: dataSource.url,\n    locale,\n  };\n  const [{ data: metadataData }] = useDataCubesMetadataQuery({\n    variables: {\n      ...commonQueryVariables,\n      cubeFilters: chartConfig.cubes.map((cube) => ({ iri: cube.iri })),\n    },\n  });\n  const [{ data: componentsData, fetching: fetchingComponents }] =\n    useDataCubesComponentsQuery({\n      chartConfig,\n      variables: {\n        ...commonQueryVariables,\n        cubeFilters: chartConfig.cubes.map((cube) => ({\n          iri: cube.iri,\n          componentIds,\n          joinBy: cube.joinBy,\n        })),\n      },\n    });\n  const queryFilters = useQueryFilters({\n    chartConfig,\n    dashboardFilters,\n    componentIds,\n  });\n  const [{ data: observationsData }] = useDataCubesObservationsQuery({\n    chartConfig,\n    variables: {\n      ...commonQueryVariables,\n      cubeFilters: queryFilters,\n    },\n    pause: fetchingComponents,\n  });\n\n  return metadataData?.dataCubesMetadata &&\n    componentsData?.dataCubesComponents &&\n    observationsData?.dataCubesObservations ? (\n    <Box sx={{ maxHeight: 600, overflow: \"auto\", ...sx }}>\n      <DataTablePreview\n        title={metadataData.dataCubesMetadata.map((d) => d.title).join(\", \")}\n        dimensions={componentsData.dataCubesComponents.dimensions}\n        measures={componentsData.dataCubesComponents.measures}\n        observations={observationsData.dataCubesObservations.data}\n        linkToMetadataPanel\n      />\n    </Box>\n  ) : (\n    <Loading />\n  );\n};\n","import { ReactNode } from \"react\";\nimport { ErrorBoundary } from \"react-error-boundary\";\n\nimport { ChartUnexpectedError } from \"@/components/hint\";\n\nexport const ChartErrorBoundary = ({\n  children,\n  resetKeys,\n}: {\n  children: ReactNode;\n  resetKeys?: unknown[];\n}) => {\n  return (\n    <ErrorBoundary\n      FallbackComponent={ChartUnexpectedError}\n      resetKeys={resetKeys}\n    >\n      {children}\n    </ErrorBoundary>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\nimport { Fragment, useMemo } from \"react\";\n\nimport {\n  extractChartConfigComponentIds,\n  useQueryFilters,\n} from \"@/charts/shared/chart-helpers\";\nimport { OpenMetadataPanelWrapper } from \"@/components/metadata-panel\";\nimport {\n  ChartConfig,\n  DashboardFiltersConfig,\n  DataSource,\n  FilterValue,\n  getAnimationField,\n} from \"@/configurator\";\nimport {\n  Component,\n  isTemporalDimension,\n  isTemporalOrdinalDimension,\n} from \"@/domain/data\";\nimport { isMostRecentValue } from \"@/domain/most-recent-value\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\n\nexport const ChartFiltersList = ({\n  cubeIri,\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n  components,\n}: {\n  cubeIri: string;\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  components: Component[];\n}) => {\n  const locale = useLocale();\n  const timeFormatUnit = useTimeFormatUnit();\n  const timeSlider = useChartInteractiveFilters((d) => d.timeSlider);\n  const animationField = getAnimationField(chartConfig);\n  const queryFilters = useQueryFilters({\n    chartConfig,\n    dashboardFilters,\n    componentIds: extractChartConfigComponentIds({ chartConfig }),\n  });\n  const cubeQueryFilters = useMemo(() => {\n    return queryFilters.filter((d) => d.iri === cubeIri);\n  }, [queryFilters, cubeIri]);\n  // TODO: Refactor to somehow access current filter labels instead of fetching them again\n  const [{ data, fetching }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => {\n        const f = cubeQueryFilters.find((f) => f.iri === cube.iri);\n        return {\n          iri: f?.iri ?? cube.iri,\n          componentIds: f?.componentIds,\n          filters: f?.filters,\n          joinBy: f?.joinBy,\n          loadValues: true,\n        };\n      }),\n    },\n  });\n  const allFilters = useMemo(() => {\n    if (!data?.dataCubesComponents || components.length === 0) {\n      return [];\n    }\n\n    return queryFilters.flatMap((filter) => {\n      const namedFilters = Object.entries<FilterValue>(\n        filter.filters ?? {}\n      ).flatMap(([id, f]) => {\n        if (f?.type !== \"single\") {\n          return [];\n        }\n\n        const dimension = data.dataCubesComponents.dimensions.find(\n          (d) =>\n            d.id === id && d.cubeIri === filter.iri && d.cubeIri === cubeIri\n        );\n\n        if (!dimension) {\n          return [];\n        }\n\n        const filterValue = isMostRecentValue(f.value)\n          ? dimension.values[dimension.values.length - 1].value\n          : f.value;\n        const value = isTemporalDimension(dimension)\n          ? {\n              value: filterValue,\n              label: timeFormatUnit(`${filterValue}`, dimension.timeUnit),\n            }\n          : dimension.values.find((d) => d.value === filterValue);\n\n        return [{ dimension, value }];\n      });\n\n      if (animationField) {\n        const dimension = components.find(\n          (d) => d.id === animationField.componentId\n        );\n\n        if (timeSlider.value) {\n          if (\n            timeSlider.type === \"interval\" &&\n            isTemporalDimension(dimension)\n          ) {\n            namedFilters.push({\n              dimension,\n              value: {\n                value: `${timeSlider.value}`,\n                label: timeFormatUnit(timeSlider.value, dimension.timeUnit),\n              },\n            });\n          }\n\n          if (\n            timeSlider.type === \"ordinal\" &&\n            timeSlider.value &&\n            isTemporalOrdinalDimension(dimension)\n          ) {\n            namedFilters.push({\n              dimension,\n              value: {\n                value: timeSlider.value,\n                label: timeSlider.value,\n              },\n            });\n          }\n        }\n      }\n\n      return namedFilters;\n    });\n  }, [\n    data?.dataCubesComponents,\n    components,\n    queryFilters,\n    animationField,\n    timeFormatUnit,\n    cubeIri,\n    timeSlider.value,\n    timeSlider.type,\n  ]);\n\n  return fetching ? (\n    <Typography component=\"div\" variant=\"caption\">\n      <Trans id=\"controls.section.data.filters\">Filters</Trans>:{\" \"}\n      <Trans id=\"hint.loading.data\">Loading data...</Trans>\n    </Typography>\n  ) : allFilters.length ? (\n    <Typography\n      component=\"div\"\n      variant=\"caption\"\n      data-testid=\"chart-filters-list\"\n    >\n      <Typography component=\"span\" variant=\"inherit\" sx={{ mr: 1 }}>\n        <Trans id=\"controls.section.data.filters\">Filters</Trans>:\n      </Typography>\n      {allFilters.map(({ dimension, value }, i) => (\n        <Fragment key={dimension.id}>\n          <span>\n            <OpenMetadataPanelWrapper component={dimension}>\n              <span>{dimension.label}</span>\n            </OpenMetadataPanelWrapper>\n            {\": \"}\n          </span>\n          <span>{value && value.label}</span>\n          {i < allFilters.length - 1 && \", \"}\n        </Fragment>\n      ))}\n    </Typography>\n  ) : null;\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, Link, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport uniqBy from \"lodash/uniqBy\";\nimport { ComponentProps, ReactNode, useMemo } from \"react\";\n\nimport { extractChartConfigUsedComponents } from \"@/charts/shared/chart-helpers\";\nimport { LegendItem } from \"@/charts/shared/legend-color\";\nimport { ChartFiltersList } from \"@/components/chart-filters-list\";\nimport { Flex } from \"@/components/flex\";\nimport {\n  MetadataPanel,\n  OpenMetadataPanelWrapper,\n} from \"@/components/metadata-panel\";\nimport {\n  ChartConfig,\n  ComboLineColumnConfig,\n  ComboLineDualConfig,\n  ComboLineSingleConfig,\n  DashboardFiltersConfig,\n  DataSource,\n  isComboChartConfig,\n} from \"@/configurator\";\nimport { Component, Measure } from \"@/domain/data\";\nimport { useTimeFormatLocale } from \"@/formatters\";\nimport { useDataCubesMetadataQuery } from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nexport const useFootnotesStyles = makeStyles<Theme, { useMarginTop: boolean }>(\n  (theme) => ({\n    actions: {\n      marginTop: ({ useMarginTop }) => (useMarginTop ? theme.spacing(2) : 0),\n      \"--column-gap\": \"16px\",\n      columnGap: \"var(--column-gap)\",\n      rowGap: 1,\n      display: \"flex\",\n      flexDirection: \"row\",\n      alignItems: \"center\",\n      flexWrap: \"wrap\",\n      overflow: \"hidden\",\n      fontSize: theme.typography.caption.fontSize,\n      \"& > button\": {\n        minWidth: \"auto\",\n      },\n    },\n  })\n);\n\nexport const CHART_FOOTNOTES_CLASS_NAME = \"chart-footnotes\";\n\nexport const ChartFootnotes = ({\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n  components,\n  showVisualizeLink = false,\n  hideFilters,\n  hideMetadata,\n  configKey,\n  metadataPanelProps,\n}: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  components: Component[];\n  showVisualizeLink?: boolean;\n  hideFilters?: boolean;\n  hideMetadata?: boolean;\n  configKey?: string;\n  metadataPanelProps?: Omit<\n    ComponentProps<typeof MetadataPanel>,\n    \"dataSource\" | \"chartConfig\" | \"dashboardFilters\"\n  >;\n}) => {\n  const locale = useLocale();\n  const usedComponents = useMemo(() => {\n    return extractChartConfigUsedComponents(chartConfig, { components });\n  }, [chartConfig, components]);\n  const [{ data }] = useDataCubesMetadataQuery({\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters: uniqBy(\n        usedComponents.map((component) => ({ iri: component.cubeIri })),\n        \"iri\"\n      ),\n    },\n    pause: !usedComponents.length,\n  });\n  const formatLocale = useTimeFormatLocale();\n  const hideLegend = !shouldShowChartFootnotesLegend(chartConfig);\n\n  return (\n    <Box\n      className={CHART_FOOTNOTES_CLASS_NAME}\n      sx={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        mt: 1,\n        \"& > :not(:last-child)\": { mb: 3 },\n      }}\n    >\n      {data?.dataCubesMetadata.map((metadata) => {\n        const hide = hideLegend && hideMetadata && hideFilters;\n\n        return hide ? null : (\n          <div key={metadata.iri}>\n            <ChartFootnotesLegend\n              chartConfig={chartConfig}\n              components={components}\n              cubeIri={metadata.iri}\n            />\n            {hideFilters ? null : (\n              <ChartFiltersList\n                dataSource={dataSource}\n                chartConfig={chartConfig}\n                dashboardFilters={dashboardFilters}\n                components={components}\n                cubeIri={metadata.iri}\n              />\n            )}\n            {hideMetadata ? null : (\n              <>\n                <Typography variant=\"caption\">\n                  <OpenMetadataPanelWrapper>\n                    <Trans id=\"dataset.footnotes.dataset\">Dataset</Trans>\n                  </OpenMetadataPanelWrapper>\n                  : {metadata.title}\n                </Typography>\n                {metadata.dateModified ? (\n                  <Typography variant=\"caption\">\n                    {\", \"}\n                    <Trans id=\"dataset.footnotes.updated\">\n                      Latest data update\n                    </Trans>\n                    :{\" \"}\n                    {formatLocale.format(\"%d.%m.%Y %H:%M\")(\n                      new Date(metadata.dateModified)\n                    )}\n                  </Typography>\n                ) : null}\n              </>\n            )}\n          </div>\n        );\n      })}\n      <Flex justifyContent=\"space-between\" alignItems=\"center\">\n        {metadataPanelProps ? (\n          <MetadataPanel\n            dataSource={dataSource}\n            chartConfig={chartConfig}\n            dashboardFilters={dashboardFilters}\n            {...metadataPanelProps}\n            smallerToggle\n          />\n        ) : null}\n        {showVisualizeLink && configKey ? (\n          <VisualizeLink\n            configKey={configKey}\n            createdWith={t({ id: \"metadata.link.created.with\" })}\n          />\n        ) : null}\n      </Flex>\n    </Box>\n  );\n};\n\nconst shouldShowChartFootnotesLegend = (chartConfig: ChartConfig) => {\n  return isComboChartConfig(chartConfig);\n};\n\nconst ChartFootnotesLegend = ({\n  chartConfig,\n  components,\n  cubeIri,\n}: {\n  chartConfig: ChartConfig;\n  components: Component[];\n  cubeIri: string;\n}) => {\n  if (!shouldShowChartFootnotesLegend(chartConfig)) {\n    return null;\n  }\n\n  switch (chartConfig.chartType) {\n    case \"comboLineColumn\": {\n      return (\n        <ChartFootnotesComboLineColumn\n          chartConfig={chartConfig}\n          components={components}\n          cubeIri={cubeIri}\n        />\n      );\n    }\n    case \"comboLineDual\": {\n      return (\n        <ChartFootnotesComboLineDual\n          chartConfig={chartConfig}\n          components={components}\n          cubeIri={cubeIri}\n        />\n      );\n    }\n    case \"comboLineSingle\": {\n      return (\n        <ChartFootnotesComboLineSingle\n          chartConfig={chartConfig}\n          components={components}\n          cubeIri={cubeIri}\n        />\n      );\n    }\n    default:\n      return null;\n  }\n};\n\nconst ChartFootnotesLegendContainer = ({\n  children,\n}: {\n  children: ReactNode;\n}) => {\n  return (\n    <Flex sx={{ flexWrap: \"wrap\", rowGap: 1, columnGap: 3, mb: 1 }}>\n      {children}\n    </Flex>\n  );\n};\n\nconst ChartFootnotesComboLineColumn = ({\n  chartConfig,\n  components,\n  cubeIri,\n}: {\n  chartConfig: ComboLineColumnConfig;\n  components: Component[];\n  cubeIri: string;\n}) => {\n  const {\n    y: { columnComponentId, lineComponentId, lineAxisOrientation },\n  } = chartConfig.fields;\n  const columnAxisComponent = components.find(\n    (d) => d.id === columnComponentId && d.cubeIri === cubeIri\n  );\n  const lineAxisComponent = components.find(\n    (d) => d.id === lineComponentId && d.cubeIri === cubeIri\n  );\n  const firstComponent =\n    lineAxisOrientation === \"left\" ? lineAxisComponent : columnAxisComponent;\n  const secondComponent =\n    lineAxisOrientation === \"left\" ? columnAxisComponent : lineAxisComponent;\n\n  return firstComponent || secondComponent ? (\n    <ChartFootnotesLegendContainer>\n      {firstComponent && (\n        <LegendItem\n          label={firstComponent.label}\n          color={chartConfig.fields.color.colorMapping[firstComponent.id]}\n          symbol={lineAxisOrientation === \"left\" ? \"line\" : \"square\"}\n          dimension={firstComponent as Measure}\n          smaller\n        />\n      )}\n      {secondComponent && (\n        <LegendItem\n          label={secondComponent.label}\n          color={chartConfig.fields.color.colorMapping[secondComponent.id]}\n          symbol={lineAxisOrientation === \"left\" ? \"square\" : \"line\"}\n          dimension={secondComponent as Measure}\n          smaller\n        />\n      )}\n    </ChartFootnotesLegendContainer>\n  ) : null;\n};\n\nconst ChartFootnotesComboLineDual = ({\n  chartConfig,\n  components,\n  cubeIri,\n}: {\n  chartConfig: ComboLineDualConfig;\n  components: Component[];\n  cubeIri: string;\n}) => {\n  const {\n    y: { leftAxisComponentId, rightAxisComponentId },\n  } = chartConfig.fields;\n  const leftAxisComponent = components.find(\n    (d) => d.id === leftAxisComponentId && d.cubeIri === cubeIri\n  );\n  const rightAxisComponent = components.find(\n    (d) => d.id === rightAxisComponentId && d.cubeIri === cubeIri\n  );\n\n  return leftAxisComponent || rightAxisComponent ? (\n    <ChartFootnotesLegendContainer>\n      {leftAxisComponent && (\n        <LegendItem\n          label={leftAxisComponent.label}\n          color={chartConfig.fields.color.colorMapping[leftAxisComponent.id]}\n          symbol=\"line\"\n          dimension={leftAxisComponent as Measure}\n          smaller\n        />\n      )}\n      {rightAxisComponent && (\n        <LegendItem\n          label={rightAxisComponent.label}\n          color={chartConfig.fields.color.colorMapping[rightAxisComponent.id]}\n          symbol=\"line\"\n          dimension={rightAxisComponent as Measure}\n          smaller\n        />\n      )}\n    </ChartFootnotesLegendContainer>\n  ) : null;\n};\n\nconst ChartFootnotesComboLineSingle = ({\n  chartConfig,\n  components,\n  cubeIri,\n}: {\n  chartConfig: ComboLineSingleConfig;\n  components: Component[];\n  cubeIri: string;\n}) => {\n  const {\n    y: { componentIds },\n  } = chartConfig.fields;\n\n  return componentIds.length ? (\n    <ChartFootnotesLegendContainer>\n      {componentIds.map((id) => {\n        const component = components.find(\n          (d) => d.id === id && d.cubeIri === cubeIri\n        );\n\n        return component ? (\n          <LegendItem\n            key={component.id}\n            label={component.label}\n            color={chartConfig.fields.color.colorMapping[component.id]}\n            symbol=\"line\"\n            dimension={component as Measure}\n            smaller\n          />\n        ) : null;\n      })}\n    </ChartFootnotesLegendContainer>\n  ) : null;\n};\n\nexport const VisualizeLink = ({\n  createdWith,\n  configKey,\n}: {\n  createdWith: ReactNode;\n  configKey: string;\n}) => {\n  const locale = useLocale();\n\n  return (\n    <Typography variant=\"caption\" color=\"grey.600\" {...DISABLE_SCREENSHOT_ATTR}>\n      {createdWith}\n      <Link\n        href={`https://visualize.admin.ch/${locale}/v/${configKey}`}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        sx={{ \"&:hover\": { textDecoration: \"none\" } }}\n      >\n        {\" \"}\n        visualize.admin.ch\n      </Link>\n    </Typography>\n  );\n};\n","import clsx from \"clsx\";\nimport { fold } from \"fp-ts/lib/Either\";\nimport { pipe } from \"fp-ts/lib/function\";\nimport { Layouts } from \"react-grid-layout\";\n\nimport { ChartPanelLayoutTypeProps } from \"@/components/chart-panel\";\nimport {\n  ChartGridLayout,\n  FREE_CANVAS_BREAKPOINTS,\n} from \"@/components/react-grid\";\nimport { hasChartConfigs, ReactGridLayoutsType } from \"@/configurator\";\nimport { useConfiguratorState } from \"@/src\";\nimport { assert } from \"@/utils/assert\";\n\nexport const chartPanelLayoutGridClasses = {\n  root: \"chart-panel-grid-layout\",\n  dragHandle: \"chart-panel-grid-layout-drag-handle\",\n};\n\nconst decodeLayouts = (layouts: Layouts) => {\n  return pipe(\n    ReactGridLayoutsType.decode(layouts),\n    fold(\n      (err) => {\n        console.error(\"Error while decoding react-grid-layout\", err);\n        return undefined;\n      },\n      (d) => {\n        return d;\n      }\n    )\n  );\n};\n\nexport const ChartPanelLayoutCanvas = ({\n  blocks,\n  renderBlock,\n  className,\n}: ChartPanelLayoutTypeProps) => {\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const layout = state.layout;\n  assert(\n    layout.type === \"dashboard\" && layout.layout === \"canvas\",\n    \"ChartPanelLayoutGrid should be rendered only for dashboard layout with canvas\"\n  );\n  const handleChangeLayouts = (layouts: Layouts) => {\n    assert(\n      layout.type === \"dashboard\" && layout.layout === \"canvas\",\n      \"ChartPanelLayoutGrid should be rendered only for dashboard layout with canvas\"\n    );\n\n    const parsedLayouts = decodeLayouts(layouts);\n\n    if (!parsedLayouts) {\n      return;\n    }\n\n    dispatch({\n      type: \"LAYOUT_CHANGED\",\n      value: {\n        ...layout,\n        layouts: parsedLayouts,\n      },\n    });\n  };\n\n  return (\n    <ChartGridLayout\n      key={state.state}\n      className={clsx(chartPanelLayoutGridClasses.root, className)}\n      layouts={layout.layouts}\n      resize={state.state === \"LAYOUTING\"}\n      draggableHandle={`.${chartPanelLayoutGridClasses.dragHandle}`}\n      onLayoutChange={(_, allLayouts) => handleChangeLayouts(allLayouts)}\n      breakpoints={FREE_CANVAS_BREAKPOINTS}\n    >\n      {blocks.map(renderBlock)}\n    </ChartGridLayout>\n  );\n};\n","import { Box, useMediaQuery } from \"@mui/material\";\nimport { useMemo } from \"react\";\n\nimport { ChartPanelLayoutTypeProps } from \"@/components/chart-panel\";\nimport classes from \"@/components/chart-panel-layout-tall.module.css\";\nimport { LayoutBlock } from \"@/config-types\";\nimport { useTheme } from \"@/themes\";\n\nexport const ChartPanelLayoutTall = ({\n  blocks,\n  renderBlock,\n}: ChartPanelLayoutTypeProps) => {\n  const rows = useMemo(() => {\n    return getChartPanelLayoutTallRows({ blocks, renderBlock });\n  }, [blocks, renderBlock]);\n\n  return (\n    <>\n      {rows.map((row, i) => (\n        <ChartPanelLayoutTallRow key={i} row={row} />\n      ))}\n    </>\n  );\n};\n\nconst ChartPanelLayoutTallRow = ({ row }: { row: ChartPanelLayoutTallRow }) => {\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"md\"));\n\n  switch (row.type) {\n    case \"wide\":\n      return row.renderBlock(row.block);\n    case \"narrow\":\n      if (isMobile) {\n        return <>{row.blocks.map(row.renderBlock)}</>;\n      }\n\n      return (\n        <Box className={classes.root}>{row.blocks.map(row.renderBlock)}</Box>\n      );\n  }\n};\ntype ChartPanelLayoutTallRow = {\n  renderBlock: (block: LayoutBlock) => JSX.Element;\n} & (\n  | {\n      type: \"wide\";\n      block: LayoutBlock;\n    }\n  | {\n      type: \"narrow\";\n      blocks: [LayoutBlock] | [LayoutBlock, LayoutBlock];\n    }\n);\n\nconst getChartPanelLayoutTallRows = ({\n  blocks,\n  renderBlock,\n}: ChartPanelLayoutTypeProps): ChartPanelLayoutTallRow[] => {\n  const rows: ChartPanelLayoutTallRow[] = [];\n\n  for (let i = 0; i < blocks.length; i += 1) {\n    if (i % 3 === 0) {\n      rows.push({\n        type: \"wide\",\n        block: blocks[i],\n        renderBlock,\n      });\n    }\n\n    if (i % 3 === 1) {\n      const block = blocks[i];\n      const nextBlock = blocks[i + 1];\n      rows.push({\n        type: \"narrow\",\n        blocks: nextBlock ? [block, nextBlock] : [block],\n        renderBlock,\n      });\n    }\n  }\n\n  return rows;\n};\n","import { ChartPanelLayoutTypeProps } from \"@/components/chart-panel\";\n\nexport const ChartPanelLayoutVertical = ({\n  blocks,\n  renderBlock,\n}: ChartPanelLayoutTypeProps) => {\n  return <>{blocks.map(renderBlock)}</>;\n};\n","import { Box, BoxProps, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport { forwardRef, HTMLProps, PropsWithChildren } from \"react\";\n\nimport {\n  ChartPanelLayoutCanvas,\n  chartPanelLayoutGridClasses,\n} from \"@/components/chart-panel-layout-grid\";\nimport { ChartPanelLayoutTall } from \"@/components/chart-panel-layout-tall\";\nimport { ChartPanelLayoutVertical } from \"@/components/chart-panel-layout-vertical\";\nimport { ChartSelectionTabs } from \"@/components/chart-selection-tabs\";\nimport { DashboardInteractiveFilters } from \"@/components/dashboard-interactive-filters\";\nimport { useSyncTextBlockHeight } from \"@/components/text-block\";\nimport { Layout, LayoutDashboard } from \"@/config-types\";\nimport { hasChartConfigs, LayoutBlock } from \"@/configurator\";\nimport { useConfiguratorState } from \"@/src\";\n\nconst useStyles = makeStyles<\n  Theme,\n  { freeCanvas?: boolean; isEditing?: boolean }\n>((theme) => ({\n  panelLayout: {\n    containerType: \"inline-size\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: theme.spacing(4),\n  },\n  chartWrapper: {\n    display: ({ freeCanvas }) => (freeCanvas ? \"flex\" : \"contents\"),\n    flexDirection: \"column\",\n    overflow: \"hidden\",\n    [`.${chartPanelLayoutGridClasses.root} &`]: {\n      transition: theme.transitions.create([\"box-shadow\"], {\n        duration: theme.transitions.duration.shortest,\n      }),\n    },\n    [`.${chartPanelLayoutGridClasses.root} &:has(.${chartPanelLayoutGridClasses.dragHandle}:hover)`]:\n      {\n        boxShadow: theme.shadows[6],\n      },\n  },\n  chartWrapperInner: {\n    display: ({ freeCanvas, isEditing }) =>\n      isEditing || !freeCanvas ? \"contents\" : \"flex\",\n    flexDirection: \"column\",\n    width: \"auto\",\n    height: \"100%\",\n  },\n}));\n\nexport const getChartWrapperId = (chartKey: string) =>\n  `chart-wrapper-${chartKey}`;\n\nexport type ChartWrapperProps = BoxProps & {\n  editing?: boolean;\n  layout?: Layout;\n  chartKey: string;\n};\n\nexport const ChartWrapper = forwardRef<HTMLDivElement, ChartWrapperProps>(\n  (props, ref) => {\n    const { children, editing, layout, ...rest } = props;\n    const classes = useStyles({\n      freeCanvas: layout?.type === \"dashboard\" && layout.layout === \"canvas\",\n      isEditing: editing,\n    });\n\n    return (\n      <Box\n        ref={ref}\n        {...rest}\n        id={getChartWrapperId(props.chartKey)}\n        className={clsx(classes.chartWrapper, props.className)}\n      >\n        {(editing || layout?.type === \"tab\") && <ChartSelectionTabs />}\n        <Box\n          className={classes.chartWrapperInner}\n          sx={{ minHeight: [150, 300, 500] }}\n        >\n          {children}\n        </Box>\n      </Box>\n    );\n  }\n);\n\ntype ChartPanelLayoutProps = PropsWithChildren<{\n  layoutType: LayoutDashboard[\"layout\"];\n  renderBlock: (block: LayoutBlock) => JSX.Element;\n}> &\n  HTMLProps<HTMLDivElement>;\n\nexport type ChartPanelLayoutTypeProps = {\n  blocks: LayoutBlock[];\n  renderBlock: (block: LayoutBlock) => JSX.Element;\n  className?: string;\n};\n\nconst Wrappers: Record<\n  LayoutDashboard[\"layout\"],\n  (props: ChartPanelLayoutTypeProps) => JSX.Element\n> = {\n  vertical: ChartPanelLayoutVertical,\n  tall: ChartPanelLayoutTall,\n  canvas: ChartPanelLayoutCanvas,\n};\n\nexport const ChartPanelLayout = ({\n  children,\n  renderBlock,\n  className,\n  layoutType,\n  ...rest\n}: ChartPanelLayoutProps) => {\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const classes = useStyles({});\n  const Wrapper = Wrappers[layoutType];\n  const { layout } = state;\n  const { blocks } = layout;\n  useSyncTextBlockHeight();\n\n  return (\n    <div className={clsx(classes.panelLayout, className)} {...rest}>\n      {state.layout.type === \"dashboard\" ? (\n        <DashboardInteractiveFilters\n          // We want to completely remount this component if chartConfigs change\n          key={state.chartConfigs.map((x) => x.key).join(\",\")}\n        />\n      ) : null}\n      <Wrapper blocks={blocks} renderBlock={renderBlock} />\n    </div>\n  );\n};\n","import { TabList, TabListProps } from \"@mui/lab\";\nimport { styled, Tab, TabProps, tabsClasses } from \"@mui/material\";\n\nexport const VisualizeTabList = styled(TabList)<TabListProps>(({ theme }) => {\n  return {\n    border: \"none !important\",\n    [`& .${tabsClasses.indicator}`]: {\n      display: \"none\",\n    },\n    [`& .${tabsClasses.scrollButtons}`]: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n    },\n\n    // Use before so that bottom border of tabs can go \"over\" the tab list\n    // bottom border\n    \"&:before\": {\n      content: '\" \"',\n      display: \"block\",\n      position: \"absolute\",\n      bottom: 0,\n      left: 0,\n      right: 0,\n      margin: \"auto\",\n      borderBottom: `1px solid ${theme.palette.divider}`,\n    },\n  };\n  // Need to do the type assertion otherwise we cannot use the \"component\" prop down the line\n}) as typeof TabList;\n\nexport const VisualizeTab = styled(Tab)<TabProps>(({ theme }) => {\n  return {\n    marginRight: theme.spacing(2),\n    background: theme.palette.background.paper,\n    border: `1px solid ${theme.palette.divider}`,\n    position: \"relative\",\n    top: 0,\n    zIndex: 1,\n    \"&.Mui-selected\": {\n      borderBottomColor: theme.palette.background.paper,\n    },\n    minWidth: \"fit-content\",\n    padding: theme.spacing(0, 2),\n  };\n  // Need to do the type assertion otherwise we cannot use the \"component\" prop down the line\n}) as typeof Tab;\n","export { defaultLocale, i18n, locales, parseLocaleString } from \"./locales\";\nexport { LocaleProvider, useLocale } from \"./use-locale\";\n","import { t, Trans } from \"@lingui/macro\";\nimport { TabContext } from \"@mui/lab\";\nimport {\n  Button,\n  Divider,\n  Stack,\n  tabClasses,\n  Theme,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport {\n  createContext,\n  Dispatch,\n  type MouseEvent,\n  PropsWithChildren,\n  ReactNode,\n  useContext,\n  useEffect,\n  useState,\n} from \"react\";\nimport { DragDropContext, Draggable, Droppable } from \"react-beautiful-dnd\";\n\nimport { AddButton } from \"@/components/add-button\";\nimport { ArrowMenuTopCenter } from \"@/components/arrow-menu\";\nimport { DuplicateChartMenuActionItem } from \"@/components/chart-shared\";\nimport { DragHandle } from \"@/components/drag-handle\";\nimport { Flex } from \"@/components/flex\";\nimport { MenuActionItem } from \"@/components/menu-action-item\";\nimport { VisualizeTab, VisualizeTabList } from \"@/components/tabs\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ChartConfig,\n  ChartType,\n  ConfiguratorStatePublished,\n  ConfiguratorStateWithChartConfigs,\n  hasChartConfigs,\n  isConfiguring,\n  isLayouting,\n  isPublished,\n  isPublishing,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { useSearchDatasetPanelStore } from \"@/configurator/components/add-new-dataset-panel\";\nimport { ChartTypeSelector } from \"@/configurator/components/chart-type-selector\";\nimport { getIconName } from \"@/configurator/components/ui-helpers\";\nimport { Icon, IconName } from \"@/icons\";\nimport { useLocale } from \"@/locales\";\nimport { useEvent } from \"@/utils/use-event\";\n\ntype TabsState = {\n  popoverOpen: boolean;\n  popoverType: \"edit\" | \"add\";\n  activeChartKey: string;\n};\n\nconst TABS_STATE: TabsState = {\n  popoverOpen: false,\n  popoverType: \"add\",\n  activeChartKey: \"\",\n};\n\nconst TabsStateContext = createContext<\n  [TabsState, Dispatch<TabsState>] | undefined\n>(undefined);\n\nconst useTabsState = () => {\n  const ctx = useContext(TabsStateContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need to wrap your component in <TabsStateProvider /> to useTabsState()\"\n    );\n  }\n\n  return ctx;\n};\n\nconst TabsStateProvider = (props: PropsWithChildren<{}>) => {\n  const { children } = props;\n  const [state, dispatch] = useState<TabsState>(TABS_STATE);\n\n  return (\n    <TabsStateContext.Provider value={[state, dispatch]}>\n      {children}\n    </TabsStateContext.Provider>\n  );\n};\n\nexport const ChartSelectionTabs = () => {\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const editable =\n    isConfiguring(state) || isLayouting(state) || isPublishing(state);\n  const locale = useLocale();\n\n  if (!editable && state.chartConfigs.length === 1) {\n    return null;\n  }\n\n  const chartConfig = getChartConfig(state);\n  const data: TabDatum[] = state.chartConfigs.map(\n    ({ key, chartType, meta }) => {\n      return {\n        key,\n        chartType,\n        active: key === chartConfig.key,\n        label: meta.label[locale] !== \"\" ? meta.label[locale] : undefined,\n      };\n    }\n  );\n\n  return (\n    <TabsStateProvider>\n      {editable ? (\n        <TabsEditable state={state} chartConfig={chartConfig} data={data} />\n      ) : (\n        <TabsFixed data={data} />\n      )}\n    </TabsStateProvider>\n  );\n};\n\ntype TabsEditableProps = {\n  state: Exclude<ConfiguratorStateWithChartConfigs, ConfiguratorStatePublished>;\n  chartConfig: ChartConfig;\n  data: TabDatum[];\n};\n\nconst TabsEditable = (props: TabsEditableProps) => {\n  const { state, chartConfig, data } = props;\n  const [, dispatch] = useConfiguratorState();\n  const isConfiguringChart = isConfiguring(state);\n  const [tabsState, setTabsState] = useTabsState();\n  const [popoverAnchorEl, setPopoverAnchorEl] = useState<HTMLElement | null>(\n    null\n  );\n\n  const handleClose = useEvent(() => {\n    setPopoverAnchorEl(null);\n    setTabsState({\n      popoverOpen: false,\n      popoverType: tabsState.popoverType,\n      activeChartKey: tabsState.activeChartKey,\n    });\n  });\n\n  useEffect(() => {\n    handleClose();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.activeChartKey]);\n\n  const { open: openAddDatasetPanel } = useSearchDatasetPanelStore();\n\n  const switchChart = (key: string) => {\n    dispatch({\n      type: \"SWITCH_ACTIVE_CHART\",\n      value: key,\n    });\n  };\n\n  return (\n    <>\n      <TabsInner\n        data={data}\n        addable={isConfiguringChart}\n        editable={isConfiguringChart}\n        draggable={state.chartConfigs.length > 1}\n        onChartAdd={(e) => {\n          setPopoverAnchorEl(e.currentTarget);\n          setTabsState({\n            popoverOpen: true,\n            popoverType: \"add\",\n            activeChartKey: tabsState.activeChartKey,\n          });\n        }}\n        onChartEdit={(e, key) => {\n          setPopoverAnchorEl(e.currentTarget);\n          setTabsState({\n            popoverOpen: true,\n            popoverType: \"edit\",\n            activeChartKey: key,\n          });\n        }}\n        onChartSwitch={switchChart}\n      />\n\n      {tabsState.popoverType === \"add\" ? (\n        <ArrowMenuTopCenter\n          id=\"chart-selection-popover\"\n          open={tabsState.popoverOpen}\n          anchorEl={popoverAnchorEl}\n          anchorOrigin={{\n            horizontal: \"center\",\n            vertical: \"bottom\",\n          }}\n          transformOrigin={{\n            horizontal: \"center\",\n            vertical: \"top\",\n          }}\n          onClose={handleClose}\n          PaperProps={{\n            sx: {\n              width: \"calc(320px + 2rem)\",\n              mt: 3,\n              py: \"1rem\",\n              \"& > .MuiList-root\": {\n                py: 0,\n              },\n            },\n          }}\n        >\n          <Stack\n            divider={<Divider sx={{ mx: \"1.5rem\" }} />}\n            gap=\"0.5rem\"\n            direction=\"column\"\n          >\n            <Stack direction=\"column\" gap=\"0.5rem\" m=\"1rem\">\n              <Typography variant=\"body3\" textAlign=\"center\" gutterBottom>\n                <Trans id=\"chart-selection-tabs.add-chart-same-dataset.caption\">\n                  Add chart based on the same dataset\n                </Trans>\n              </Typography>\n              <ChartTypeSelector\n                state={state}\n                type=\"add\"\n                showHelp={false}\n                showComparisonCharts={false}\n                chartKey={tabsState.activeChartKey ?? chartConfig.key}\n                sx={{ pb: 3 }}\n              />\n            </Stack>\n            <Stack direction=\"column\" gap=\"0.5rem\" mx=\"1.5rem\" my=\"1rem\">\n              <Typography variant=\"body3\" textAlign=\"center\" gutterBottom>\n                <Trans id=\"chart-selection-tabs.add-chart-different-dataset.caption\">\n                  Add chart based on a different dataset\n                </Trans>\n              </Typography>\n              <Button\n                fullWidth\n                onClick={() => {\n                  setTabsState({ ...tabsState, popoverOpen: false });\n                  openAddDatasetPanel();\n                }}\n                sx={{ justifyContent: \"center\" }}\n              >\n                <Trans id=\"chart-selection-tabs.add-chart-different-dataset.button\">\n                  Select dataset\n                </Trans>\n              </Button>\n            </Stack>\n          </Stack>\n        </ArrowMenuTopCenter>\n      ) : null}\n\n      {tabsState.popoverType === \"edit\" ? (\n        <ArrowMenuTopCenter\n          id=\"chart-selection-popover\"\n          open={tabsState.popoverOpen}\n          anchorEl={popoverAnchorEl}\n          anchorOrigin={{\n            horizontal: \"center\",\n            vertical: \"bottom\",\n          }}\n          transformOrigin={{\n            horizontal: \"center\",\n            vertical: \"top\",\n          }}\n          onClose={handleClose}\n        >\n          {isConfiguringChart && (\n            <MenuActionItem\n              as=\"menuitem\"\n              type=\"button\"\n              leadingIconName=\"text\"\n              label={\n                <Trans id=\"chart-controls.edit-tab-label\">Edit tab label</Trans>\n              }\n              onClick={() => {\n                switchChart(tabsState.activeChartKey);\n                dispatch({\n                  type: \"CHART_ACTIVE_FIELD_CHANGE\",\n                  value: \"label\",\n                });\n                handleClose();\n              }}\n            />\n          )}\n          <DuplicateChartMenuActionItem\n            chartConfig={getChartConfig(state, tabsState.activeChartKey)}\n            onSuccess={handleClose}\n          />\n\n          {state.chartConfigs.length > 1 && (\n            <MenuActionItem\n              as=\"menuitem\"\n              type=\"button\"\n              leadingIconName=\"trash\"\n              label={<Trans id=\"chart-controls.delete\">Delete</Trans>}\n              color=\"red\"\n              requireConfirmation\n              confirmationTitle={t({\n                id: \"chat-preview.delete.title\",\n                message: \"Delete chart?\",\n              })}\n              confirmationText={t({\n                id: \"chat-preview.delete.confirmation\",\n                message: \"Are you sure you want to delete this chart?\",\n              })}\n              onClick={() => {\n                dispatch({\n                  type: \"CHART_CONFIG_REMOVE\",\n                  value: {\n                    chartKey: tabsState.activeChartKey,\n                  },\n                });\n                handleClose();\n              }}\n            />\n          )}\n        </ArrowMenuTopCenter>\n      ) : null}\n    </>\n  );\n};\n\ntype TabDatum = {\n  key: string;\n  chartType: ChartType;\n  active: boolean;\n  label?: string | undefined;\n};\n\nconst TabsFixed = ({ data }: { data: TabDatum[] }) => {\n  const [, dispatch] = useConfiguratorState(isPublished);\n\n  return (\n    <TabsInner\n      data={data}\n      addable={false}\n      editable={false}\n      draggable={false}\n      onChartSwitch={(key) => {\n        dispatch({\n          type: \"SWITCH_ACTIVE_CHART\",\n          value: key,\n        });\n      }}\n    />\n  );\n};\n\n/**\n * The Tabs component clones its children adding extra properties, expecting that we use Tab components.\n * Since we either use a Draggable or a div, we must not forward directly the properties.\n * Forwarding the props directly to a DOM node would result in for example \"textColor\" not being a valid HTML prop.\n */\nconst PassthroughTab = ({\n  children,\n  value: _value,\n}: {\n  children: ReactNode;\n  value?: string;\n}) => {\n  return <>{children}</>;\n};\n\nconst useTabsInnerStyles = makeStyles<Theme>((theme) => ({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n  },\n  tab: {\n    zIndex: 1,\n    maxWidth: \"auto\",\n  },\n  tabList: {\n    top: 1,\n    border: \"1px solid\",\n    borderColor: theme.palette.divider,\n    borderTop: 0,\n    borderBottom: 0,\n    position: \"relative\",\n    \"--bg\": theme.palette.background.paper,\n    \"--cut-off-width\": \"1rem\",\n\n    [`& .${tabClasses.root}`]: {\n      maxWidth: \"max-content\",\n    },\n  },\n  scrollButton: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: \"2.5rem\",\n    minWidth: \"2.5rem\",\n    padding: 0,\n    minHeight: 0,\n    color: theme.palette.text.primary,\n    \"&:hover\": {\n      backgroundColor: \"transparent\",\n    },\n    \"& > svg\": {\n      pointerEvents: \"none\",\n    },\n  },\n}));\n\nconst TabsInner = ({\n  data,\n  addable,\n  editable,\n  draggable,\n  onChartEdit,\n  onChartAdd,\n  onChartSwitch,\n}: {\n  data: TabDatum[];\n  addable: boolean;\n  editable: boolean;\n  draggable: boolean;\n  onChartAdd?: (e: MouseEvent<HTMLElement>) => void;\n  onChartEdit?: (e: MouseEvent<HTMLElement>, key: string) => void;\n  onChartSwitch?: (key: string) => void;\n}) => {\n  const classes = useTabsInnerStyles();\n  const [_, dispatch] = useConfiguratorState(hasChartConfigs);\n  const activeTabIndex = data.findIndex((x) => x.active);\n\n  return (\n    <div className={classes.root}>\n      <TabContext value={`${activeTabIndex}`}>\n        <DragDropContext\n          onDragEnd={(d) => {\n            if (d.destination && d.source.index !== d.destination.index) {\n              dispatch({\n                type: \"CHART_CONFIG_REORDER\",\n                value: {\n                  oldIndex: d.source.index,\n                  newIndex: d.destination.index,\n                },\n              });\n            }\n          }}\n        >\n          <Droppable droppableId=\"droppable\" direction=\"horizontal\">\n            {(provided) => (\n              <VisualizeTabList\n                ref={provided.innerRef}\n                variant=\"scrollable\"\n                className={classes.tabList}\n                ScrollButtonComponent={({ direction, disabled, onClick }) => (\n                  <Button\n                    className={classes.scrollButton}\n                    onClick={onClick}\n                    style={{ cursor: disabled ? \"auto\" : \"pointer\" }}\n                    variant=\"text\"\n                  >\n                    <Icon\n                      name={\n                        direction === \"left\" ? \"chevronLeft\" : \"chevronRight\"\n                      }\n                    />\n                  </Button>\n                )}\n              >\n                {data.map((d, i) => (\n                  <PassthroughTab key={d.key} value={`${i}`}>\n                    <Draggable draggableId={d.key} index={i}>\n                      {(provided, snapshot) => {\n                        const { style } = provided.draggableProps;\n                        // Limit the drag movement to the x-axis.\n                        const transform = style?.transform\n                          ? `${style.transform.split(\",\")[0]}, 0px)`\n                          : undefined;\n\n                        return (\n                          <VisualizeTab\n                            ref={provided.innerRef}\n                            {...provided.draggableProps}\n                            {...provided.dragHandleProps}\n                            style={{ ...style, transform, opacity: 1 }}\n                            component=\"div\"\n                            key={d.key}\n                            value={`${i}`}\n                            data-testid=\"chart-selection-tab\"\n                            className={clsx(\n                              classes.tab,\n                              // We need to add the \"selected\" class ourselves since we are wrapping\n                              // the tabs by Draggable.\n                              i === activeTabIndex ? \"Mui-selected\" : \"\"\n                            )}\n                            sx={{\n                              px: 0,\n                              minWidth: d.label ? 180 : 0,\n                            }}\n                            label={\n                              <TabContent\n                                iconName={getIconName(d.chartType)}\n                                chartKey={d.key}\n                                editable={editable}\n                                draggable={draggable}\n                                active={d.active}\n                                label={d.label}\n                                dragging={snapshot.isDragging}\n                                onChevronDownClick={(e) => {\n                                  onChartEdit?.(e, d.key);\n                                }}\n                                onSwitchClick={() => {\n                                  onChartSwitch?.(d.key);\n                                }}\n                              />\n                            }\n                          />\n                        );\n                      }}\n                    </Draggable>\n                  </PassthroughTab>\n                ))}\n                <PassthroughTab>\n                  <div style={{ opacity: 0 }}>{provided.placeholder}</div>\n                </PassthroughTab>\n              </VisualizeTabList>\n            )}\n          </Droppable>\n        </DragDropContext>\n      </TabContext>\n      {addable && (\n        <AddButton onClick={onChartAdd}>\n          <Trans id=\"chart-selection-tabs.add-chart\">Add chart</Trans>\n        </AddButton>\n      )}\n    </div>\n  );\n};\n\nexport const useIconStyles = makeStyles<\n  Theme,\n  { active: boolean | undefined; dragging: boolean | undefined }\n>(({ palette, spacing }) => ({\n  root: {\n    \"--bg\": palette.background.paper,\n    backgroundColor: \"var(--bg)\",\n    alignItems: \"center\",\n    padding: spacing(4),\n    borderTopLeftRadius: spacing(1),\n    borderTopRightRadius: spacing(1),\n    cursor: \"default\",\n    textTransform: \"none\",\n    width: \"100%\",\n    justifyContent: \"stretch\",\n  },\n  label: {\n    flexShrink: 1,\n    flexGrow: 1,\n    marginLeft: \"-0.5rem\",\n    color: \"inherit\",\n    flexWrap: \"nowrap\",\n    whiteSpace: \"nowrap\",\n    minWidth: 0,\n    maxWidth: 400,\n    overflow: \"hidden\",\n    minHeight: \"100%\",\n    position: \"relative\",\n    display: \"flex\",\n    cursor: \"pointer\",\n    alignItems: \"center\",\n    marginRight: \"0.15rem\",\n\n    \"&:after\": {\n      content: '\" \"',\n      position: \"absolute\",\n      right: 0,\n      top: 0,\n      bottom: 0,\n      height: \"auto\",\n      width: \"10px\",\n      backgroundImage:\n        \"linear-gradient(to right, rgba(255, 255, 255, 0), var(--bg))\",\n    },\n  },\n  chartIconWrapper: {\n    minWidth: \"fit-content\",\n    display: \"flex\",\n    alignItems: \"center\",\n    gap: spacing(2),\n  },\n  editIconWrapper: {\n    padding: 0,\n    minWidth: \"fit-content\",\n    transition: \"0.125s ease color\",\n\n    \"&:hover\": {\n      background: \"transparent\",\n    },\n  },\n  dragIconWrapper: {\n    width: 24,\n    height: 24,\n    color: palette.grey[500],\n    cursor: \"grab\",\n  },\n}));\n\nconst TabContent = (props: {\n  iconName: IconName;\n  chartKey: string;\n  editable?: boolean;\n  draggable?: boolean;\n  active?: boolean;\n  dragging?: boolean;\n  label?: string;\n  onChevronDownClick?: (\n    e: MouseEvent<HTMLElement>,\n    activeChartKey: string\n  ) => void;\n  onSwitchClick?: () => void;\n}) => {\n  const {\n    iconName,\n    chartKey,\n    editable,\n    draggable,\n    active,\n    label,\n    dragging,\n    onChevronDownClick,\n    onSwitchClick,\n  } = props;\n  const classes = useIconStyles({ active, dragging });\n  const [_, dispatch] = useConfiguratorState();\n  const showAddLabel = editable && !label;\n  const addLabel = t({\n    id: \"chart-selection-tabs.no-label\",\n    message: \"No label\",\n  });\n\n  return (\n    <Flex sx={{ alignItems: \"center\", gap: 2, p: 2, pl: 4 }}>\n      <Button\n        variant=\"text\"\n        onClick={() => {\n          onSwitchClick?.();\n\n          if (editable) {\n            dispatch({\n              type: \"CHART_ACTIVE_FIELD_CHANGE\",\n              value: undefined,\n            });\n          }\n        }}\n        sx={{ alignItems: \"center\", gap: 2 }}\n      >\n        <Icon name={iconName} />\n        <Typography\n          variant=\"caption\"\n          sx={{\n            color: (t) =>\n              label || !editable\n                ? \"inherit\"\n                : `${t.palette.text.secondary} !important`,\n          }}\n        >\n          {label || showAddLabel ? label || `[ ${addLabel} ]` : null}\n        </Typography>\n      </Button>\n      {editable && (\n        <Button\n          variant=\"text\"\n          onClick={(e) => onChevronDownClick?.(e, chartKey)}\n          className={classes.editIconWrapper}\n        >\n          <Icon name=\"chevronDown\" />\n        </Button>\n      )}\n      {draggable && <DragHandle dragging={dragging} />}\n    </Flex>\n  );\n};\n","import orderBy from \"lodash/orderBy\";\nimport { useMemo } from \"react\";\n\nimport { Dimension, DimensionValue } from \"@/domain/data\";\nimport { VISUALIZE_MOST_RECENT_VALUE } from \"@/domain/most-recent-value\";\nimport { makeDimensionValueSorters } from \"@/utils/sorting-values\";\n\nexport const resolveMostRecentValue = (\n  value: DimensionValue[\"value\"] | null | undefined,\n  dimension: Dimension | undefined\n) => {\n  if (value === VISUALIZE_MOST_RECENT_VALUE && dimension?.values.length) {\n    const sorters = makeDimensionValueSorters(dimension);\n    const sortedValues = orderBy(\n      dimension.values,\n      sorters.map((s) => (dv) => s(dv.label))\n    );\n    return sortedValues[sortedValues.length - 1]?.value;\n  }\n  return value;\n};\n\nexport const useResolveMostRecentValue = (\n  value: DimensionValue[\"value\"] | null | undefined,\n  dimension: Dimension | undefined\n) => {\n  return useMemo(() => {\n    return resolveMostRecentValue(value, dimension);\n  }, [value, dimension]);\n};\n","import { SelectChangeEvent } from \"@mui/material\";\nimport { useEffect, useMemo } from \"react\";\n\nimport {\n  DataFilterGenericDimension,\n  DataFilterHierarchyDimension,\n  DataFilterTemporalDimension,\n  getInteractiveQueryFilters,\n} from \"@/charts/shared/chart-data-filters\";\nimport { GroupedPreparedFilterEntry } from \"@/charts/shared/chart-data-filters/group-filters\";\nimport { useLoadingState } from \"@/charts/shared/chart-loading-state\";\nimport { Flex } from \"@/components/flex\";\nimport { Loading } from \"@/components/hint\";\nimport {\n  ChartConfig,\n  DataSource,\n  Filters,\n  FilterValueMulti,\n  FilterValueSingle,\n} from \"@/config-types\";\nimport { getChartConfigFilters } from \"@/config-utils\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { isTemporalDimension } from \"@/domain/data\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport {\n  DataFilters,\n  useChartInteractiveFilters,\n} from \"@/stores/interactive-filters\";\nimport { useResolveMostRecentValue } from \"@/utils/most-recent-value\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const ChartDataFilter = ({\n  dimensionId,\n  dataSource,\n  chartConfig,\n  dataFilters,\n  filters,\n  disabled,\n}: {\n  dimensionId: string;\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dataFilters: DataFilters;\n  filters: GroupedPreparedFilterEntry[];\n  disabled: boolean;\n}) => {\n  const locale = useLocale();\n  const chartLoadingState = useLoadingState();\n  const updateDataFilter = useChartInteractiveFilters(\n    (d) => d.updateDataFilter\n  );\n  const setMultiDataFilter = useChartInteractiveFilters(\n    (d) => d.setMultiDataFilter\n  );\n  const perCube = useMemo(() => {\n    return filters.map((f) => {\n      const cubeFilters = getChartConfigFilters(chartConfig.cubes, {\n        cubeIri: f.cubeIri,\n      });\n      const interactiveFiltersResolved = Object.fromEntries(\n        Object.entries(f.interactiveFilters).map(([k, v]) => [\n          f.componentIdResolution[k] ?? k,\n          v,\n        ])\n      ) as Filters;\n      const interactiveQueryFilters = getInteractiveQueryFilters({\n        filters: cubeFilters,\n        interactiveFilters: interactiveFiltersResolved,\n      });\n      const resolvedQueryFilters = Object.fromEntries(\n        Object.entries(interactiveQueryFilters).map(([k, v]) => [\n          f.componentIdResolution[k] ?? k,\n          v,\n        ])\n      );\n      return {\n        cubeIri: f.cubeIri,\n        resolvedDimensionId: f.resolvedDimensionId,\n        resolvedQueryFilters,\n      };\n    });\n  }, [filters, chartConfig.cubes]);\n\n  const filterKeys = useMemo(() => {\n    return perCube\n      .map((d) => {\n        return Object.entries(d.resolvedQueryFilters)\n          .map(([k, v]) => `${k}: ${JSON.stringify(v)}`)\n          .join(\",\");\n      })\n      .join(\" | \");\n  }, [perCube]);\n\n  const [{ data, fetching }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters: perCube.map((d) => ({\n        iri: d.cubeIri,\n        componentIds: [d.resolvedDimensionId],\n        filters: d.resolvedQueryFilters,\n        loadValues: true,\n      })),\n      // This is important for urql not to think that filters\n      // are the same  while the order of the keys has changed.\n      // If this is not present, we'll have outdated dimension\n      // values after we change the filter order.\n      // @ts-ignore\n      filterKeys,\n    },\n    keepPreviousData: true,\n  });\n\n  const dimension = data?.dataCubesComponents.dimensions[0];\n\n  const hierarchy = dimension?.hierarchy;\n\n  const setDataFilter = useEvent(\n    (\n      e: SelectChangeEvent<unknown> | { target: { value: string | string[] } }\n    ) => {\n      const value = e.target.value as string | string[];\n\n      if (Array.isArray(value)) {\n        setMultiDataFilter(dimensionId, value);\n      } else {\n        updateDataFilter(dimensionId, value);\n      }\n    }\n  );\n\n  const handleMultiChange = useEvent((values: string[]) => {\n    setMultiDataFilter(dimensionId, values);\n  });\n\n  const configFilter = useMemo(() => {\n    if (!dimension) {\n      return undefined;\n    }\n\n    const cubeFilters = getChartConfigFilters(chartConfig.cubes, {\n      cubeIri: dimension.cubeIri,\n      joined: true,\n    });\n\n    return cubeFilters[dimensionId];\n  }, [dimension, chartConfig.cubes, dimensionId]);\n\n  const configFilterValue =\n    configFilter && configFilter.type === \"single\"\n      ? configFilter.value\n      : undefined;\n  const dataFilterValue = dimension\n    ? dataFilters[dimensionId]?.type === \"single\"\n      ? (dataFilters[dimensionId] as FilterValueSingle).value\n      : null\n    : null;\n\n  const dataFilterValues = dimension\n    ? dataFilters[dimensionId]?.type === \"multi\"\n      ? Object.keys(\n          (dataFilters[dimensionId] as FilterValueMulti | undefined)?.values ??\n            {}\n        )\n      : dataFilters[dimensionId]?.type === \"single\"\n        ? [(dataFilters[dimensionId] as FilterValueSingle).value as string]\n        : []\n    : [];\n\n  const filterType =\n    chartConfig.interactiveFiltersConfig.dataFilters.filterTypes[dimensionId] ??\n    (configFilter?.type === \"multi\" ? \"multi\" : \"single\");\n\n  const isMultiFilter = filterType === \"multi\";\n\n  const resolvedDataFilterValue = useResolveMostRecentValue(\n    dataFilterValue,\n    dimension\n  );\n  const resolvedConfigFilterValue = useResolveMostRecentValue(\n    configFilterValue,\n    dimension\n  );\n  const value =\n    resolvedDataFilterValue ?? resolvedConfigFilterValue ?? FIELD_VALUE_NONE;\n\n  const multiValue = isMultiFilter\n    ? dataFilterValues\n    : [value].filter((v) => v !== FIELD_VALUE_NONE).map((v) => String(v));\n\n  useEffect(() => {\n    const values = dimension?.values.map((d) => d.value) ?? [];\n\n    if (isMultiFilter) {\n      chartLoadingState.set(`interactive-filter-${dimensionId}`, fetching);\n      return;\n    }\n\n    // We only want to disable loading state when the filter is actually valid.\n    // It can be invalid when the application is ensuring possible filters.\n    if (\n      (resolvedDataFilterValue && values.includes(resolvedDataFilterValue)) ||\n      resolvedDataFilterValue === FIELD_VALUE_NONE ||\n      !configFilter\n    ) {\n      updateDataFilter(\n        dimensionId,\n        resolvedDataFilterValue ? resolvedDataFilterValue : FIELD_VALUE_NONE\n      );\n      chartLoadingState.set(`interactive-filter-${dimensionId}`, fetching);\n    } else if (fetching || values.length === 0) {\n      chartLoadingState.set(`interactive-filter-${dimensionId}`, fetching);\n    }\n  }, [\n    chartLoadingState,\n    dataFilterValue,\n    dimension?.values,\n    dimensionId,\n    fetching,\n    setDataFilter,\n    configFilterValue,\n    updateDataFilter,\n    configFilter,\n    resolvedDataFilterValue,\n    isMultiFilter,\n  ]);\n\n  return dimension ? (\n    <Flex\n      sx={{\n        mr: 3,\n        width: \"100%\",\n        flex: \"1 1 100%\",\n        \":last-of-type\": {\n          mr: 0,\n        },\n        \" > div\": { width: \"100%\" },\n      }}\n    >\n      {isTemporalDimension(dimension) ? (\n        <DataFilterTemporalDimension\n          configFilter={configFilter}\n          value={value as string}\n          dimension={dimension}\n          onChange={setDataFilter}\n          disabled={disabled}\n        />\n      ) : hierarchy ? (\n        <DataFilterHierarchyDimension\n          configFilter={configFilter}\n          dimension={dimension}\n          onChange={setDataFilter}\n          onMultiChange={handleMultiChange}\n          hierarchy={hierarchy}\n          value={value as string}\n          values={multiValue}\n          isMulti={isMultiFilter}\n          disabled={disabled}\n        />\n      ) : (\n        <DataFilterGenericDimension\n          configFilter={configFilter}\n          dimension={dimension}\n          onChange={setDataFilter}\n          value={value as string}\n          values={multiValue}\n          isMulti={isMultiFilter}\n          onMultiChange={handleMultiChange}\n          disabled={disabled}\n        />\n      )}\n    </Flex>\n  ) : (\n    <Loading />\n  );\n};\n","import { Box } from \"@mui/material\";\n\nimport { useChartDataFiltersState } from \"@/charts/shared/chart-data-filters\";\nimport { ChartDataFilter } from \"@/charts/shared/chart-data-filters/filter\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\n\nexport const ChartDataFiltersList = ({\n  open,\n  dataSource,\n  chartConfig,\n  loading,\n  groupedPreparedFilters,\n  componentIds,\n}: ReturnType<typeof useChartDataFiltersState>) => {\n  const dataFilters = useChartInteractiveFilters((d) => d.dataFilters);\n\n  return componentIds && componentIds.length > 0 ? (\n    <Box\n      data-testid=\"published-chart-interactive-filters\"\n      sx={{\n        display: open ? \"grid\" : \"none\",\n        columnGap: 3,\n        rowGap: 2,\n        gridTemplateColumns: \"repeat(auto-fit, minmax(240px, 1fr))\",\n      }}\n    >\n      {groupedPreparedFilters.map(({ dimensionId, entries }) => (\n        <ChartDataFilter\n          key={dimensionId}\n          filters={entries}\n          dimensionId={dimensionId}\n          dataSource={dataSource}\n          chartConfig={chartConfig}\n          dataFilters={dataFilters}\n          disabled={loading}\n        />\n      ))}\n    </Box>\n  ) : null;\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  IconButton,\n  Theme,\n  ThemeProvider,\n  useEventCallback,\n  useTheme,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { select } from \"d3-selection\";\nimport deburr from \"lodash/deburr\";\nimport uniqBy from \"lodash/uniqBy\";\nimport {\n  ComponentProps,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { createRoot } from \"react-dom/client\";\n\nimport {\n  ChartDataFiltersToggle,\n  useChartDataFiltersState,\n} from \"@/charts/shared/chart-data-filters\";\nimport { ChartDataFiltersList } from \"@/charts/shared/chart-data-filters/filters-list\";\nimport { extractChartConfigUsedComponents } from \"@/charts/shared/chart-helpers\";\nimport { ArrowMenuTopBottom } from \"@/components/arrow-menu\";\nimport {\n  CHART_FOOTNOTES_CLASS_NAME,\n  VisualizeLink,\n} from \"@/components/chart-footnotes\";\nimport { chartPanelLayoutGridClasses } from \"@/components/chart-panel-layout-grid\";\nimport {\n  TABLE_PREVIEW_WRAPPER_CLASS_NAME,\n  useChartTablePreview,\n} from \"@/components/chart-table-preview\";\nimport { useChartWithFiltersClasses } from \"@/components/chart-with-filters\";\nimport { MenuActionItem } from \"@/components/menu-action-item\";\nimport { MetadataPanel } from \"@/components/metadata-panel\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ChartConfig,\n  DashboardFiltersConfig,\n  DataSource,\n  hasChartConfigs,\n  isConfiguring,\n  isPublished,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { timeUnitToFormatter } from \"@/configurator/components/ui-helpers\";\nimport { Component } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { useDataCubesMetadataQuery } from \"@/graphql/hooks\";\nimport { getChartIcon, Icon } from \"@/icons\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { animationFrame } from \"@/utils/animation-frame\";\nimport { createId } from \"@/utils/create-id\";\nimport {\n  DISABLE_SCREENSHOT_ATTR,\n  useScreenshot,\n  UseScreenshotProps,\n} from \"@/utils/use-screenshot\";\n\nexport const CHART_GRID_ROW_COUNT = 7;\n\n/** Generic styles shared between `ChartPreview` and `ChartPublished`. */\nexport const useChartStyles = makeStyles<Theme, { removeBorder?: boolean }>(\n  (theme) => ({\n    root: {\n      flexGrow: 1,\n      minWidth: 0,\n      padding: theme.spacing(8),\n      backgroundColor: theme.palette.background.paper,\n      border: ({ removeBorder }) =>\n        removeBorder ? \"none\" : `1px solid ${theme.palette.divider}`,\n\n      [`.${chartPanelLayoutGridClasses.root} &`]: {\n        display: \"flex\",\n        flexDirection: \"column\",\n      },\n\n      // Make sure that all children have min-width: 0 and max-width: 100%\n      // to prevent overflow issues.\n      \"& > *\": {\n        minWidth: 0,\n        maxWidth: \"100%\",\n      },\n    },\n    editing: {\n      display: \"flex\",\n      flexDirection: \"column\",\n    },\n    pastEditing: {\n      display: \"grid\",\n      gridTemplateRows: \"subgrid\",\n      /** Should stay in sync with the number of rows contained in a chart */\n      gridRow: `span ${CHART_GRID_ROW_COUNT}`,\n    },\n  })\n);\n\nexport const ChartControls = ({\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n  metadataPanelProps,\n}: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  metadataPanelProps?: Omit<\n    ComponentProps<typeof MetadataPanel>,\n    \"dataSource\" | \"chartConfig\" | \"dashboardFilters\"\n  >;\n}) => {\n  const chartDataFilters = chartConfig.interactiveFiltersConfig.dataFilters;\n  const dashboardDataFilters = dashboardFilters?.dataFilters;\n  const showFilters =\n    chartDataFilters.active &&\n    chartDataFilters.componentIds.some(\n      (id) => !dashboardDataFilters?.componentIds.includes(id)\n    );\n  const chartFiltersState = useChartDataFiltersState({\n    dataSource,\n    chartConfig,\n    dashboardFilters,\n  });\n\n  return showFilters || metadataPanelProps ? (\n    <Box\n      {...DISABLE_SCREENSHOT_ATTR}\n      sx={{\n        display: \"grid\",\n        gridTemplateAreas: `\n    \"filtersToggle metadataToggle\"\n    \"filtersList filtersList\"`,\n        mt: 4,\n      }}\n    >\n      <Box sx={{ gridArea: \"filtersToggle\" }}>\n        {showFilters && <ChartDataFiltersToggle {...chartFiltersState} />}\n      </Box>\n      {metadataPanelProps ? (\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"flex-end\",\n            gridArea: \"metadataToggle\",\n          }}\n        >\n          <MetadataPanel\n            dataSource={dataSource}\n            chartConfig={chartConfig}\n            dashboardFilters={dashboardFilters}\n            {...metadataPanelProps}\n          />\n        </div>\n      ) : null}\n      <Box sx={{ gridArea: \"filtersList\" }}>\n        {showFilters && <ChartDataFiltersList {...chartFiltersState} />}\n      </Box>\n    </Box>\n  ) : (\n    <span style={{ height: 1 }} />\n  );\n};\n\nexport const ChartMoreButton = ({\n  configKey,\n  chartKey,\n  chartWrapperNode,\n  components,\n  disableDatabaseRelatedActions,\n}: {\n  configKey?: string;\n  chartKey: string;\n  chartWrapperNode?: HTMLElement | null;\n  components: Component[];\n  disableDatabaseRelatedActions?: boolean;\n}) => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const [anchor, setAnchor] = useState<HTMLElement | null>(null);\n  const handleClose = useEventCallback(() => setAnchor(null));\n  const chartConfig = getChartConfig(state, chartKey);\n  const { setIsTableRaw } = useChartTablePreview();\n\n  // Reset back to chart view when switching chart type.\n  useEffect(() => {\n    setIsTableRaw(false);\n  }, [chartConfig.chartType, setIsTableRaw]);\n\n  const disableButton =\n    isPublished(state) &&\n    state.layout.type === \"dashboard\" &&\n    chartConfig.chartType === \"table\";\n\n  const screenshotName = useMemo(() => {\n    const date = timeUnitToFormatter.Day(new Date());\n    const label = chartConfig.meta.title[locale] || chartConfig.chartType;\n    return `${date}_${label}`;\n  }, [chartConfig.meta.title, chartConfig.chartType, locale]);\n\n  const getPublishedActions = useCallback(() => {\n    const actions: ReactNode[] = [];\n\n    if (chartConfig.chartType !== \"table\") {\n      actions.push(\n        <TableViewChartMenuActionItem\n          chartType={chartConfig.chartType}\n          onSuccess={handleClose}\n        />\n      );\n      actions.push(\n        <DownloadPNGImageMenuActionItem\n          configKey={configKey}\n          chartKey={chartKey}\n          components={components}\n          screenshotName={screenshotName}\n          screenshotNode={chartWrapperNode}\n        />\n      );\n    }\n\n    if (\n      state.layout.type !== \"dashboard\" &&\n      configKey &&\n      !disableDatabaseRelatedActions\n    ) {\n      actions.push(<CopyChartMenuActionItem configKey={configKey} />);\n      actions.push(<ShareChartMenuActionItem configKey={configKey} />);\n    }\n\n    return actions;\n  }, [\n    chartConfig.chartType,\n    state.layout.type,\n    configKey,\n    disableDatabaseRelatedActions,\n    handleClose,\n    chartKey,\n    components,\n    screenshotName,\n    chartWrapperNode,\n  ]);\n\n  const getUnpublishedActions = useCallback(() => {\n    const actions: ReactNode[] = [];\n\n    if (!isConfiguring(state)) {\n      actions.push(\n        <MenuActionItem\n          type=\"button\"\n          as=\"menuitem\"\n          onClick={() => {\n            dispatch({ type: \"CONFIGURE_CHART\", value: { chartKey } });\n            handleClose();\n          }}\n          leadingIconName=\"pen\"\n          label={<Trans id=\"chart-controls.edit\">Edit</Trans>}\n        />\n      );\n    }\n\n    actions.push(\n      <DuplicateChartMenuActionItem\n        chartConfig={chartConfig}\n        onSuccess={handleClose}\n      />\n    );\n\n    if (chartConfig.chartType !== \"table\") {\n      actions.push(\n        <TableViewChartMenuActionItem\n          chartType={chartConfig.chartType}\n          onSuccess={handleClose}\n        />\n      );\n      actions.push(\n        <DownloadPNGImageMenuActionItem\n          configKey={configKey}\n          chartKey={chartKey}\n          components={components}\n          screenshotName={screenshotName}\n          screenshotNode={chartWrapperNode}\n        />\n      );\n    }\n\n    if (state.chartConfigs.length > 1) {\n      actions.push(\n        <MenuActionItem\n          type=\"button\"\n          as=\"menuitem\"\n          color=\"red\"\n          requireConfirmation\n          confirmationTitle={t({\n            id: \"chart-controls.delete.title\",\n            message: \"Delete chart?\",\n          })}\n          confirmationText={t({\n            id: \"chart-controls.delete.confirmation\",\n            message: \"Are you sure you want to delete this chart?\",\n          })}\n          onClick={() => {\n            dispatch({\n              type: \"CHART_CONFIG_REMOVE\",\n              value: { chartKey },\n            });\n            handleClose();\n          }}\n          leadingIconName=\"trash\"\n          label={<Trans id=\"chart-controls.delete\">Delete</Trans>}\n        />\n      );\n    }\n\n    return actions;\n  }, [\n    state,\n    chartConfig,\n    handleClose,\n    dispatch,\n    chartKey,\n    configKey,\n    components,\n    screenshotName,\n    chartWrapperNode,\n  ]);\n\n  const published = isPublished(state);\n\n  const availableActions = useMemo(() => {\n    return published ? getPublishedActions() : getUnpublishedActions();\n  }, [getPublishedActions, getUnpublishedActions, published]);\n\n  if (disableButton || availableActions.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      <IconButton\n        {...DISABLE_SCREENSHOT_ATTR}\n        data-testid=\"chart-more-button\"\n        onClick={(e) => setAnchor(e.currentTarget)}\n        sx={{ height: \"fit-content\" }}\n      >\n        <Icon name=\"dots\" />\n      </IconButton>\n      <ArrowMenuTopBottom\n        open={!!anchor}\n        anchorEl={anchor}\n        onClose={handleClose}\n        anchorOrigin={{ horizontal: \"right\", vertical: \"bottom\" }}\n        transformOrigin={{ horizontal: \"right\", vertical: \"top\" }}\n      >\n        {availableActions}\n      </ArrowMenuTopBottom>\n    </>\n  );\n};\n\nconst CopyChartMenuActionItem = ({ configKey }: { configKey: string }) => {\n  const locale = useLocale();\n  const [copyUrl, setCopyUrl] = useState(\"\");\n  useEffect(() => {\n    setCopyUrl(\n      `${window.location.origin}/${locale}/create/new?copy=${configKey}`\n    );\n  }, [configKey, locale]);\n\n  return (\n    <MenuActionItem\n      type=\"link\"\n      as=\"menuitem\"\n      href={copyUrl}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      leadingIconName=\"pen\"\n      label={<Trans id=\"chart-controls.copy-and-edit\">Copy and edit</Trans>}\n    />\n  );\n};\n\nconst ShareChartMenuActionItem = ({ configKey }: { configKey: string }) => {\n  const locale = useLocale();\n  const [shareUrl, setShareUrl] = useState(\"\");\n  useEffect(() => {\n    setShareUrl(`${window.location.origin}/${locale}/v/${configKey}`);\n  }, [configKey, locale]);\n\n  return (\n    <MenuActionItem\n      type=\"link\"\n      as=\"menuitem\"\n      href={shareUrl}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      leadingIconName=\"share\"\n      label={<Trans id=\"button.share\">Share</Trans>}\n    />\n  );\n};\n\nexport const DuplicateChartMenuActionItem = ({\n  chartConfig,\n  onSuccess,\n}: {\n  chartConfig: ChartConfig;\n  onSuccess: () => void;\n}) => {\n  const locale = useLocale();\n  const [_, dispatch] = useConfiguratorState(hasChartConfigs);\n\n  return (\n    <MenuActionItem\n      type=\"button\"\n      as=\"menuitem\"\n      onClick={() => {\n        dispatch({\n          type: \"CHART_CONFIG_ADD\",\n          value: {\n            chartConfig: { ...chartConfig, key: createId() },\n            locale,\n          },\n        });\n        onSuccess();\n      }}\n      leadingIconName=\"duplicate\"\n      label={<Trans id=\"chart-controls.duplicate\">Duplicate</Trans>}\n    />\n  );\n};\n\nconst TableViewChartMenuActionItem = ({\n  chartType,\n  onSuccess,\n}: {\n  chartType: ChartConfig[\"chartType\"];\n  onSuccess: () => void;\n}) => {\n  const { isTable, setIsTable } = useChartTablePreview();\n\n  return (\n    <MenuActionItem\n      type=\"button\"\n      as=\"menuitem\"\n      onClick={() => {\n        setIsTable(!isTable);\n        onSuccess();\n      }}\n      leadingIconName={isTable ? getChartIcon(chartType) : \"tableChart\"}\n      label={\n        isTable ? (\n          <Trans id=\"chart-controls.chart-view\">Chart view</Trans>\n        ) : (\n          <Trans id=\"chart-controls.table-view\">Table view</Trans>\n        )\n      }\n    />\n  );\n};\n\nconst DownloadPNGImageMenuActionItem = ({\n  configKey,\n  chartKey,\n  components,\n  screenshotName,\n  screenshotNode,\n}: {\n  configKey?: string;\n  chartKey: string;\n  components: Component[];\n} & Omit<UseScreenshotProps, \"type\" | \"modifyNode\" | \"pngMetadata\">) => {\n  const modifyNode = useModifyNode(configKey);\n  const metadata = usePNGMetadata({\n    configKey,\n    chartKey,\n    components,\n  });\n  const { loading, screenshot } = useScreenshot({\n    type: \"png\",\n    screenshotName,\n    screenshotNode,\n    modifyNode,\n    pngMetadata: metadata,\n  });\n\n  return (\n    <MenuActionItem\n      type=\"button\"\n      as=\"menuitem\"\n      onClick={screenshot}\n      disabled={loading}\n      leadingIconName=\"download\"\n      label={t({ id: \"chart-controls.export-png\", message: \"Export PNG\" })}\n    />\n  );\n};\n\nconst useModifyNode = (configKey?: string) => {\n  const theme = useTheme();\n  const chartWithFiltersClasses = useChartWithFiltersClasses();\n\n  return useCallback(\n    async (clonedNode: HTMLElement, originalNode: HTMLElement) => {\n      // We need to explicitly set the height of the chart container to the height\n      // of the chart, as otherwise the screenshot won't work for free canvas charts.\n      const tablePreviewWrapper = clonedNode.querySelector(\n        `.${TABLE_PREVIEW_WRAPPER_CLASS_NAME}`\n      ) as HTMLElement | null;\n\n      if (tablePreviewWrapper) {\n        const chart = originalNode.querySelector(\n          `.${chartWithFiltersClasses.chartWithFilters}`\n        );\n\n        if (chart) {\n          const height = chart.clientHeight;\n          tablePreviewWrapper.style.height = `${height}px`;\n        }\n      }\n\n      const footnotes = clonedNode.querySelector(\n        `.${CHART_FOOTNOTES_CLASS_NAME}`\n      );\n\n      if (footnotes && configKey) {\n        const container = document.createElement(\"div\");\n        footnotes.appendChild(container);\n        const root = createRoot(container);\n        root.render(\n          <ThemeProvider theme={theme}>\n            <VisualizeLink\n              configKey={configKey}\n              createdWith={t({ id: \"metadata.link.created.with\" })}\n            />\n          </ThemeProvider>\n        );\n        await animationFrame();\n      }\n\n      // Remove some elements that should not be included in the screenshot.\n      // For maps, we can't apply custom classes to internal elements, so we need\n      // to remove them here.\n      clonedNode.querySelector(\".maplibregl-ctrl\")?.remove();\n\n      // Every text element should be dark-grey (currently we use primary.main to\n      // indicate interactive elements, which doesn't make sense for screenshots)\n      // and not have underlines.\n      const color = theme.palette.grey[700];\n      select(clonedNode)\n        .selectAll(\n          `:is(p, button, a, span, div, li, h1, h2, h3, h4, h5, h6):not([${DISABLE_SCREENSHOT_COLOR_WIPE_KEY}='true'])`\n        )\n        .style(\"color\", color)\n        .style(\"text-decoration\", \"none\");\n      // SVG elements have fill instead of color. Here we only target text elements,\n      // to avoid changing the color of other SVG elements (charts).\n      select(clonedNode)\n        .selectAll(`text:not([${DISABLE_SCREENSHOT_COLOR_WIPE_KEY}='true'])`)\n        .style(\"fill\", color);\n    },\n    [chartWithFiltersClasses.chartWithFilters, theme, configKey]\n  );\n};\n\nexport const DISABLE_SCREENSHOT_COLOR_WIPE_KEY =\n  \"data-disable-screenshot-color\";\nexport const DISABLE_SCREENSHOT_COLOR_WIPE_ATTR = {\n  [DISABLE_SCREENSHOT_COLOR_WIPE_KEY]: true,\n};\n\nconst usePNGMetadata = ({\n  chartKey,\n  configKey,\n  components,\n}: {\n  chartKey: string;\n  configKey?: string;\n  components: Component[];\n}): UseScreenshotProps[\"pngMetadata\"] => {\n  const locale = useLocale();\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const chartConfig = getChartConfig(state, chartKey);\n\n  const usedComponents = useMemo(() => {\n    return extractChartConfigUsedComponents(chartConfig, { components });\n  }, [chartConfig, components]);\n\n  const [{ data }] = useDataCubesMetadataQuery({\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      cubeFilters: uniqBy(\n        usedComponents.map((component) => ({ iri: component.cubeIri })),\n        \"iri\"\n      ),\n    },\n    pause: !usedComponents.length,\n  });\n\n  return useMemo(() => {\n    const publisher = data?.dataCubesMetadata\n      .map((cube) =>\n        cube.contactPoints\n          ? cube.contactPoints\n              .map(\n                (contactPoint) => `${contactPoint.name} (${contactPoint.email})`\n              )\n              .join(\", \")\n          : (cube.creator?.label ?? cube.publisher)\n      )\n      .join(\", \");\n    const publisherMetadata = publisher\n      ? { key: \"Publisher\", value: publisher }\n      : null;\n    const publishURL = configKey\n      ? `${window.location.origin}/${locale}/v/${configKey}`\n      : null;\n    const publishURLMetadata = publishURL\n      ? { key: \"Publish URL\", value: publishURL }\n      : null;\n    const datasets = data?.dataCubesMetadata\n      .map((cube) => `${cube.title} ${cube.version ? `(${cube.version})` : \"\"}`)\n      .join(\", \");\n    const datasetsMetadata = datasets\n      ? { key: \"Dataset\", value: datasets }\n      : null;\n\n    const metadata = [publisherMetadata, publishURLMetadata, datasetsMetadata]\n      .filter(truthy)\n      .map(({ key, value }) => `${key}: ${value}`)\n      .join(\" | \");\n\n    return metadata ? [{ key: \"Comment\", value: deburr(metadata) }] : [];\n  }, [configKey, data?.dataCubesMetadata, locale]);\n};\n","import { Box } from \"@mui/material\";\nimport {\n  createContext,\n  Dispatch,\n  ReactNode,\n  RefObject,\n  SetStateAction,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { hasChartConfigs, useConfiguratorState } from \"@/configurator\";\n\ntype Context = {\n  isTable: boolean;\n  setIsTable: Dispatch<SetStateAction<boolean>>;\n  setIsTableRaw: Dispatch<SetStateAction<boolean>>;\n  containerRef: RefObject<HTMLDivElement>;\n  containerHeight: \"auto\" | number;\n  computeContainerHeight: () => void;\n};\n\nconst ChartTablePreviewContext = createContext<Context>({\n  isTable: false,\n  setIsTable: () => {},\n  setIsTableRaw: () => {},\n  containerRef: { current: null },\n  containerHeight: \"auto\",\n  computeContainerHeight: () => undefined,\n});\n\nexport const useChartTablePreview = () => {\n  const ctx = useContext(ChartTablePreviewContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need to wrap your component in <ChartTablePreviewProvider /> to useChartTablePreview()\"\n    );\n  }\n\n  return ctx;\n};\n\n/**\n * Keeps track of whether we are looking at the chart or a table.\n * Before changing type, the height of containerRef is measured\n * and passed back into containerHeight.\n */\nexport const ChartTablePreviewProvider = ({\n  children,\n}: {\n  children: ReactNode;\n}) => {\n  const [configuratorState] = useConfiguratorState(hasChartConfigs);\n  const [isTable, setIsTableRaw] = useState<boolean>(false);\n  const containerHeight = useRef(\"auto\" as \"auto\" | number);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const computeContainerHeight = () => {\n    if (!containerRef.current) {\n      return;\n    }\n\n    const { height } = containerRef.current.getBoundingClientRect();\n    containerHeight.current = height;\n  };\n  const setIsTable = useCallback(\n    (v) => {\n      computeContainerHeight();\n      return setIsTableRaw(v);\n    },\n    [setIsTableRaw]\n  );\n\n  useEffect(() => {\n    containerHeight.current = \"auto\";\n  }, [configuratorState.activeChartKey]);\n\n  const ctx = useMemo(() => {\n    return {\n      isTable,\n      setIsTable,\n      setIsTableRaw,\n      containerRef,\n      containerHeight: containerHeight.current,\n      computeContainerHeight,\n    };\n  }, [isTable, setIsTable, setIsTableRaw, containerRef, containerHeight]);\n\n  return (\n    <ChartTablePreviewContext.Provider value={ctx}>\n      {children}\n    </ChartTablePreviewContext.Provider>\n  );\n};\n\nexport const TABLE_PREVIEW_WRAPPER_CLASS_NAME = \"table-preview-wrapper\";\n\nexport const ChartTablePreviewWrapper = ({\n  children,\n}: {\n  children: ReactNode;\n}) => {\n  const { containerRef, containerHeight } = useChartTablePreview();\n\n  return (\n    <Box\n      ref={containerRef}\n      className={TABLE_PREVIEW_WRAPPER_CLASS_NAME}\n      sx={{\n        minWidth: 0,\n        height: containerHeight,\n        marginTop: 4,\n        marginBottom: 2,\n        flexGrow: 1,\n      }}\n    >\n      {children}\n    </Box>\n  );\n};\n","import { useMemo, useRef } from \"react\";\n\ntype Changes<K, U> = (readonly [K, U, U])[];\n\nconst empty = [] as any[];\n\nexport const useChanges = <\n  T extends unknown,\n  K extends unknown,\n  U extends unknown,\n>(\n  currentValue: T,\n  computeChanges: (prev: T, cur: T) => Changes<K, U>\n) => {\n  const prevRef = useRef<any>();\n  const prevValue = prevRef.current;\n  if (!prevValue) {\n    prevRef.current = currentValue;\n  }\n  const changes = useMemo(\n    () =>\n      prevValue !== currentValue\n        ? computeChanges(prevRef.current, currentValue)\n        : (empty as Changes<K, U>),\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [computeChanges, prevRef.current, currentValue]\n  );\n  prevRef.current = currentValue;\n  return changes;\n};\n","import isEqual from \"lodash/isEqual\";\n\nimport { Filters, FilterValue } from \"@/config-types\";\nimport { useChanges } from \"@/utils/use-changes\";\n\nconst isEqualFilter = (fa?: FilterValue, fb?: FilterValue) => {\n  if (fa?.type === \"single\" && fb?.type === \"single\") {\n    return fa.value === fb.value;\n  }\n  if (fa?.type === \"range\" && fb?.type === \"range\") {\n    return fa.from === fb.from && fa.to === fb.to;\n  }\n\n  if (fa?.type === \"multi\" && fb?.type === \"multi\") {\n    return isEqual(fa.values, fb.values);\n  }\n\n  return false;\n};\n\nconst computeFilterChanges = (prev: Filters, cur: Filters) => {\n  const allKeys = new Set([...Object.keys(prev), ...Object.keys(cur)]);\n  const res = [];\n\n  for (const key of allKeys) {\n    if (!isEqualFilter(prev[key], cur[key])) {\n      res.push([key, prev[key], cur[key]] as const);\n    }\n  }\n\n  return res;\n};\n\nexport const useFilterChanges = (cur: Filters) => {\n  return useChanges(cur, computeFilterChanges);\n};\n","import isEqual from \"lodash/isEqual\";\nimport { useEffect, useMemo, useRef } from \"react\";\n\nimport {\n  ChartConfig,\n  DashboardFiltersConfig,\n  FilterValue,\n  isSegmentInConfig,\n} from \"@/config-types\";\nimport { useChartConfigFilters } from \"@/config-utils\";\nimport { parseDate } from \"@/configurator/components/ui-helpers\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { useFilterChanges } from \"@/configurator/use-filter-changes\";\nimport {\n  useChartInteractiveFilters,\n  useInteractiveFiltersGetState,\n} from \"@/stores/interactive-filters\";\n\n/**\n * Makes sure interactive filters are in sync with chart config.\n *\n * - when a filter is set in the chart config, it should be reflected at once\n *   inside the interactive filters\n *\n */\nexport const useSyncInteractiveFilters = (\n  chartConfig: ChartConfig,\n  dashboardFilters: DashboardFiltersConfig | undefined\n) => {\n  const { annotations, interactiveFiltersConfig } = chartConfig;\n  const filters = useChartConfigFilters(chartConfig, { joined: true });\n  const resetCategories = useChartInteractiveFilters((d) => d.resetCategories);\n  const setDataFilters = useChartInteractiveFilters((d) => d.setDataFilters);\n  const getInteractiveFiltersState = useInteractiveFiltersGetState();\n  const updateDataFilter = useChartInteractiveFilters(\n    (d) => d.updateDataFilter\n  );\n  const setTimeRange = useChartInteractiveFilters((d) => d.setTimeRange);\n  const setCalculationType = useChartInteractiveFilters(\n    (d) => d.setCalculationType\n  );\n  const lastOverridesRef = useRef<\n    Record<string, string[] | string | undefined>\n  >({});\n\n  const isFirstRunRef = useRef(true);\n\n  // Time range filter\n  const presetFrom =\n    interactiveFiltersConfig.timeRange.presets.from &&\n    parseDate(interactiveFiltersConfig.timeRange.presets.from);\n  const presetTo =\n    interactiveFiltersConfig.timeRange.presets.to &&\n    parseDate(interactiveFiltersConfig.timeRange.presets.to);\n\n  const presetFromStr = presetFrom?.toString();\n  const presetToStr = presetTo?.toString();\n  useEffect(() => {\n    // Editor time presets supersede interactive state\n    if (presetFrom && presetTo) {\n      setTimeRange(presetFrom, presetTo);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [setTimeRange, presetFromStr, presetToStr]);\n\n  // Data Filters\n  const componentIds = interactiveFiltersConfig.dataFilters.componentIds;\n  const dashboardComponentIds = dashboardFilters?.dataFilters.componentIds;\n  const newPotentialInteractiveDataFilters = useMemo(() => {\n    if (componentIds) {\n      // If dimension is already in use as interactive filter, use it,\n      // otherwise, default to editor config filter dimension value (only\n      // if dashboard filters are not set).\n      return componentIds.concat(dashboardComponentIds ?? []);\n    }\n  }, [componentIds, dashboardComponentIds]);\n\n  useEffect(() => {\n    if (!newPotentialInteractiveDataFilters) {\n      return;\n    }\n\n    const currentDataFilters = getInteractiveFiltersState().dataFilters;\n    const next = newPotentialInteractiveDataFilters.reduce(\n      (acc, iri) => {\n        const dashboardFilter = dashboardFilters?.dataFilters.filters[iri];\n        if (dashboardFilter?.type === \"single\") {\n          acc[iri] = dashboardFilter;\n          return acc;\n        }\n\n        const configFilter = filters[iri];\n\n        if (!configFilter || configFilter.type === \"multi\") {\n          const allowed = configFilter?.values ?? {};\n          const isAllowed = (val: string | number | undefined) =>\n            val !== undefined ? !configFilter || !!allowed[`${val}`] : false;\n          const current = currentDataFilters[iri];\n          const override =\n            interactiveFiltersConfig.dataFilters.defaultValueOverrides[iri];\n          const lastOverride = lastOverridesRef.current[iri];\n\n          const overrideChanged =\n            isFirstRunRef.current || !isEqual(override, lastOverride);\n\n          if (overrideChanged && override && Array.isArray(override)) {\n            const validOverrides = override.filter((val) => isAllowed(val));\n            const configuredFilterType =\n              interactiveFiltersConfig.dataFilters.filterTypes[iri];\n\n            if (configuredFilterType === \"multi\") {\n              acc[iri] = {\n                type: \"multi\",\n                values: Object.fromEntries(\n                  validOverrides.map((v) => [v, true])\n                ),\n              };\n            } else if (validOverrides.length > 1) {\n              acc[iri] = {\n                type: \"multi\",\n                values: Object.fromEntries(\n                  validOverrides.map((v) => [v, true])\n                ),\n              };\n            } else if (validOverrides.length === 1) {\n              acc[iri] = { type: \"single\", value: validOverrides[0] };\n            } else {\n              acc[iri] = { type: \"single\", value: FIELD_VALUE_NONE };\n            }\n            return acc;\n          }\n\n          if (\n            overrideChanged &&\n            override &&\n            typeof override === \"string\" &&\n            isAllowed(override)\n          ) {\n            acc[iri] = { type: \"single\", value: override };\n            return acc;\n          }\n\n          if (overrideChanged && lastOverride && override === undefined) {\n            acc[iri] = { type: \"single\", value: FIELD_VALUE_NONE };\n            return acc;\n          }\n\n          if (current?.type === \"single\" && isAllowed(current.value)) {\n            acc[iri] = current;\n            return acc;\n          }\n\n          if (current?.type === \"multi\") {\n            const validValues = Object.keys(current.values).filter(isAllowed);\n            const configuredFilterType =\n              interactiveFiltersConfig.dataFilters.filterTypes[iri];\n\n            if (configuredFilterType === \"multi\") {\n              acc[iri] = {\n                type: \"multi\",\n                values: Object.fromEntries(validValues.map((v) => [v, true])),\n              };\n            } else if (validValues.length > 1) {\n              acc[iri] = {\n                type: \"multi\",\n                values: Object.fromEntries(validValues.map((v) => [v, true])),\n              };\n            } else if (validValues.length === 1) {\n              acc[iri] = { type: \"single\", value: validValues[0] };\n            } else {\n              acc[iri] = { type: \"single\", value: FIELD_VALUE_NONE };\n            }\n            return acc;\n          }\n\n          if (Array.isArray(override)) {\n            const validOverrides = override.filter(isAllowed);\n            const configuredFilterType =\n              interactiveFiltersConfig.dataFilters.filterTypes[iri];\n\n            if (configuredFilterType === \"multi\") {\n              acc[iri] = {\n                type: \"multi\",\n                values: Object.fromEntries(\n                  validOverrides.map((v) => [v, true])\n                ),\n              };\n            } else if (validOverrides.length > 1) {\n              acc[iri] = {\n                type: \"multi\",\n                values: Object.fromEntries(\n                  validOverrides.map((v) => [v, true])\n                ),\n              };\n            } else if (validOverrides.length === 1) {\n              acc[iri] = { type: \"single\", value: validOverrides[0] };\n            } else {\n              acc[iri] = { type: \"single\", value: FIELD_VALUE_NONE };\n            }\n          } else if (typeof override === \"string\" && isAllowed(override)) {\n            acc[iri] = { type: \"single\", value: override };\n          } else {\n            acc[iri] = { type: \"single\", value: FIELD_VALUE_NONE };\n          }\n          return acc;\n        }\n\n        const current = currentDataFilters[iri];\n\n        if (current?.type === \"single\" && current.value !== FIELD_VALUE_NONE) {\n          acc[iri] = current;\n        } else if (configFilter?.type === \"single\") {\n          acc[iri] = configFilter;\n        } else {\n          acc[iri] = { type: \"single\", value: FIELD_VALUE_NONE };\n        }\n\n        return acc;\n      },\n      {} as { [key: string]: FilterValue }\n    );\n\n    if (!isEqual(next, currentDataFilters)) {\n      setDataFilters(next);\n    }\n\n    const latestOverrides: Record<string, string[] | string | undefined> = {};\n\n    for (const iri of newPotentialInteractiveDataFilters) {\n      latestOverrides[iri] =\n        interactiveFiltersConfig.dataFilters.defaultValueOverrides[iri];\n    }\n\n    lastOverridesRef.current = latestOverrides;\n    isFirstRunRef.current = false;\n  }, [\n    dashboardFilters?.dataFilters.filters,\n    filters,\n    getInteractiveFiltersState,\n    interactiveFiltersConfig.dataFilters.defaultValueOverrides,\n    interactiveFiltersConfig.dataFilters.filterTypes,\n    newPotentialInteractiveDataFilters,\n    setDataFilters,\n  ]);\n\n  const changes = useFilterChanges(filters);\n  useEffect(() => {\n    if (changes.length !== 1) {\n      return;\n    }\n\n    const [dimensionId, prev, next] = changes[0];\n    if (prev?.type === \"single\" || next?.type === \"single\") {\n      updateDataFilter(\n        dimensionId,\n        next?.type === \"single\" ? next.value : FIELD_VALUE_NONE\n      );\n    }\n  }, [changes, updateDataFilter]);\n\n  // Maybe it should be more generic?\n  const interactiveCategoriesResetTrigger = useMemo(\n    () => (isSegmentInConfig(chartConfig) ? chartConfig.fields.segment : null),\n    [chartConfig]\n  );\n\n  // Interactive legend\n  // Reset categories to avoid categories with the same\n  // name to persist as filters across different dimensions\n  // i.e. Jura as forest zone != Jura as canton.\n  useEffect(\n    () => resetCategories(),\n    [resetCategories, interactiveCategoriesResetTrigger]\n  );\n\n  // Calculation\n  const calculationActive = interactiveFiltersConfig.calculation.active;\n  const calculationType = interactiveFiltersConfig.calculation.type;\n\n  useEffect(() => {\n    if (calculationType) {\n      setCalculationType(calculationType);\n    }\n  }, [calculationActive, calculationType, setCalculationType]);\n\n  // Annotations\n  const annotationsInitializedRef = useRef(false);\n  const interactiveAnnotations = useChartInteractiveFilters(\n    (d) => d.annotations\n  );\n  const updateAnnotation = useChartInteractiveFilters(\n    (d) => d.updateAnnotation\n  );\n  useEffect(() => {\n    if (!annotationsInitializedRef.current) {\n      annotations.forEach((annotation) => {\n        if (interactiveAnnotations[annotation.key] !== annotation.defaultOpen) {\n          updateAnnotation(annotation.key, annotation.defaultOpen);\n        }\n      });\n      annotationsInitializedRef.current = true;\n    }\n  }, [annotations, interactiveAnnotations, updateAnnotation]);\n};\n","import { makeStyles } from \"@mui/styles\";\nimport dynamic from \"next/dynamic\";\nimport { forwardRef } from \"react\";\n\nimport { useQueryFilters } from \"@/charts/shared/chart-helpers\";\nimport { Observer } from \"@/charts/shared/use-size\";\nimport { useSyncInteractiveFilters } from \"@/charts/shared/use-sync-interactive-filters\";\nimport { EmbedQueryParams } from \"@/components/embed-params\";\nimport {\n  type ChartConfig,\n  type DashboardFiltersConfig,\n  type DataSource,\n} from \"@/config-types\";\n\nconst ChartAreasVisualization = dynamic(\n  import(\"@/charts/area/chart-area\").then(\n    (mod) => mod.ChartAreasVisualization,\n    () => null as never\n  )\n);\nconst ChartColumnsVisualization = dynamic(\n  import(\"@/charts/column/chart-column\").then(\n    (mod) => mod.ChartColumnsVisualization,\n    () => null as never\n  )\n);\nconst ChartBarsVisualization = dynamic(\n  import(\"@/charts/bar/chart-bar\").then(\n    (mod) => mod.ChartBarsVisualization,\n    () => null as never\n  )\n);\nconst ChartComboLineSingleVisualization = dynamic(\n  import(\"@/charts/combo/chart-combo-line-single\").then(\n    (mod) => mod.ChartComboLineSingleVisualization,\n    () => null as never\n  )\n);\nconst ChartComboLineDualVisualization = dynamic(\n  import(\"@/charts/combo/chart-combo-line-dual\").then(\n    (mod) => mod.ChartComboLineDualVisualization,\n    () => null as never\n  )\n);\nconst ChartComboLineColumnVisualization = dynamic(\n  import(\"@/charts/combo/chart-combo-line-column\").then(\n    (mod) => mod.ChartComboLineColumnVisualization,\n    () => null as never\n  )\n);\nconst ChartLinesVisualization = dynamic(\n  import(\"@/charts/line/chart-lines\").then(\n    (mod) => mod.ChartLinesVisualization,\n    () => null as never\n  )\n);\nconst ChartMapVisualization = dynamic(\n  import(\"@/charts/map/chart-map\").then(\n    (mod) => mod.ChartMapVisualization,\n    () => null as never\n  )\n);\nconst ChartPieVisualization = dynamic(\n  import(\"@/charts/pie/chart-pie\").then(\n    (mod) => mod.ChartPieVisualization,\n    () => null as never\n  )\n);\nconst ChartScatterplotVisualization = dynamic(\n  import(\"@/charts/scatterplot/chart-scatterplot\").then(\n    (mod) => mod.ChartScatterplotVisualization,\n    () => null as never\n  )\n);\nconst ChartTableVisualization = dynamic(\n  import(\"@/charts/table/chart-table\").then(\n    (mod) => mod.ChartTableVisualization,\n    () => null as never\n  )\n);\n\ntype GenericChartProps = {\n  dataSource: DataSource;\n  componentIds: string[] | undefined;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  embedParams?: EmbedQueryParams;\n};\n\nconst GenericChart = ({\n  dataSource,\n  componentIds,\n  chartConfig,\n  dashboardFilters,\n  embedParams,\n}: GenericChartProps) => {\n  const observationQueryFilters = useQueryFilters({\n    chartConfig,\n    dashboardFilters,\n    componentIds,\n  });\n\n  const commonProps = {\n    dataSource,\n    observationQueryFilters,\n    componentIds,\n    embedParams,\n  };\n\n  switch (chartConfig.chartType) {\n    case \"column\":\n      return (\n        <ChartColumnsVisualization {...commonProps} chartConfig={chartConfig} />\n      );\n    case \"bar\":\n      return (\n        <ChartBarsVisualization {...commonProps} chartConfig={chartConfig} />\n      );\n    case \"line\":\n      return (\n        <ChartLinesVisualization {...commonProps} chartConfig={chartConfig} />\n      );\n    case \"area\":\n      return (\n        <ChartAreasVisualization {...commonProps} chartConfig={chartConfig} />\n      );\n    case \"scatterplot\":\n      return (\n        <ChartScatterplotVisualization\n          {...commonProps}\n          chartConfig={chartConfig}\n        />\n      );\n    case \"pie\":\n      return (\n        <ChartPieVisualization {...commonProps} chartConfig={chartConfig} />\n      );\n    case \"table\":\n      return (\n        <ChartTableVisualization {...commonProps} chartConfig={chartConfig} />\n      );\n    case \"map\":\n      return (\n        <ChartMapVisualization {...commonProps} chartConfig={chartConfig} />\n      );\n    case \"comboLineSingle\":\n      return (\n        <ChartComboLineSingleVisualization\n          {...commonProps}\n          chartConfig={chartConfig}\n        />\n      );\n    case \"comboLineDual\":\n      return (\n        <ChartComboLineDualVisualization\n          {...commonProps}\n          chartConfig={chartConfig}\n        />\n      );\n    case \"comboLineColumn\":\n      return (\n        <ChartComboLineColumnVisualization\n          {...commonProps}\n          chartConfig={chartConfig}\n        />\n      );\n\n    default:\n      const _exhaustiveCheck: never = chartConfig;\n      return _exhaustiveCheck;\n  }\n};\n\ntype ChartWithFiltersProps = {\n  dataSource: DataSource;\n  componentIds: string[] | undefined;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  embedParams?: EmbedQueryParams;\n};\n\nexport const useChartWithFiltersClasses = makeStyles(() => ({\n  chartWithFilters: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n}));\n\nexport const ChartWithFilters = forwardRef<\n  HTMLDivElement,\n  ChartWithFiltersProps\n>((props, ref) => {\n  useSyncInteractiveFilters(props.chartConfig, props.dashboardFilters);\n  const classes = useChartWithFiltersClasses();\n\n  return (\n    <div className={classes.chartWithFilters} ref={ref}>\n      <Observer>\n        <GenericChart {...props} />\n      </Observer>\n    </div>\n  );\n});\nChartWithFilters.displayName = \"ChartWithFilters\";\n","import {\n  Box,\n  BoxProps,\n  SelectChangeEvent,\n  Slider,\n  sliderClasses,\n  useEventCallback,\n} from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport uniq from \"lodash/uniq\";\nimport { ChangeEvent, useEffect, useMemo, useRef, useState } from \"react\";\n\nimport {\n  DataFilterGenericDimension,\n  DataFilterHierarchyDimension,\n  DataFilterTemporalDimension,\n} from \"@/charts/shared/chart-data-filters\";\nimport {\n  GroupedPreparedFilter,\n  groupPreparedFiltersByDimension,\n  PreparedFilter,\n} from \"@/charts/shared/chart-data-filters/group-filters\";\nimport { useCombinedTemporalDimension } from \"@/charts/shared/use-combined-temporal-dimension\";\nimport {\n  ChartConfig,\n  DashboardTimeRangeFilter,\n  getFiltersByMappingStatus,\n  hasChartConfigs,\n  InteractiveFiltersTimeRange,\n  isLayouting,\n  SingleFilters,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport {\n  parseDate,\n  timeUnitToFormatter,\n  timeUnitToParser,\n} from \"@/configurator/components/ui-helpers\";\nimport { isTemporalDimension } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { getResolvedJoinById, isJoinById } from \"@/graphql/join\";\nimport { TimeUnit } from \"@/graphql/query-hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport {\n  setDataFilter,\n  useDashboardInteractiveFilters,\n} from \"@/stores/interactive-filters\";\nimport { useTransitionStore } from \"@/stores/transition\";\nimport { assert } from \"@/utils/assert\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { useTimeout } from \"@/utils/use-timeout\";\n\nexport const DashboardInteractiveFilters = (props: BoxProps) => {\n  const { sx, ...rest } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const layouting = isLayouting(state);\n  const { dashboardFilters } = state;\n  const { timeRange, dataFilters } = dashboardFilters ?? {\n    timeRange: undefined,\n    dataFilters: undefined,\n  };\n  const showTimeRange = !!timeRange?.active;\n  const showDataFilters = !!dataFilters?.componentIds.length;\n\n  useEffect(() => {\n    if (layouting && (showTimeRange || showDataFilters)) {\n      ref.current?.scrollIntoView({\n        block: \"nearest\",\n        behavior: \"smooth\",\n      });\n    }\n  }, [layouting, showDataFilters, showTimeRange]);\n\n  return showTimeRange || showDataFilters ? (\n    <Box ref={ref} {...rest} sx={{ ...sx, mb: 4 }}>\n      {showTimeRange ? (\n        <DashboardTimeRangeSlider\n          filter={timeRange}\n          mounted={timeRange.active}\n        />\n      ) : null}\n      {showDataFilters ? (\n        <DashboardDataFilters componentIds={dataFilters.componentIds} />\n      ) : null}\n    </Box>\n  ) : null;\n};\n\nconst useTimeRangeRangeStyles = makeStyles((theme: Theme) => ({\n  slider: {\n    maxWidth: `calc(100% - ${theme.spacing(6)})`,\n    margin: theme.spacing(6, 4, 2),\n    [`& .${sliderClasses.track}`]: {\n      height: 1,\n    },\n    [`& .${sliderClasses.rail}.${sliderClasses.rail}`]: {\n      backgroundColor: theme.palette.grey[600],\n    },\n    [`& .${sliderClasses.valueLabel}`]: {\n      padding: theme.spacing(1, 2),\n    },\n  },\n}));\n\nconst valueToTimeRange = (value: number[]) => {\n  const from = new Date(value[0] * 1000);\n  const to = new Date(value[1] * 1000);\n  if (!from || !to) {\n    return;\n  }\n  return {\n    type: \"range\",\n    from: from,\n    to: to,\n  };\n};\n\nconst presetToTimeRange = (\n  presets: Pick<InteractiveFiltersTimeRange[\"presets\"], \"from\" | \"to\">,\n  timeUnit: TimeUnit\n) => {\n  if (!timeUnit) {\n    return;\n  }\n  const parser = timeUnitToParser[timeUnit];\n  return [\n    toUnixSeconds(parser(presets.from)),\n    toUnixSeconds(parser(presets.to)),\n  ];\n};\n\nconst toUnixSeconds = (x: Date | null) => {\n  if (x) {\n    return +x / 1000;\n  }\n  return 0;\n};\n\nconst DashboardTimeRangeSlider = ({\n  filter,\n  mounted,\n}: {\n  filter: DashboardTimeRangeFilter;\n  mounted: boolean;\n}) => {\n  const classes = useTimeRangeRangeStyles();\n  const dashboardInteractiveFilters = useDashboardInteractiveFilters();\n  const setEnableTransition = useTransitionStore((state) => state.setEnable);\n  const presets = filter.presets;\n  assert(\n    presets,\n    \"Filter presets should be defined when time range filter is rendered\"\n  );\n\n  const timeUnit = filter.timeUnit as TimeUnit;\n  const [timeRange, setTimeRange] = useState(() =>\n    // timeUnit can still be an empty string\n    timeUnit ? presetToTimeRange(presets, timeUnit) : undefined\n  );\n\n  const valueLabelFormat = useEventCallback((value: number) => {\n    if (!timeUnit) {\n      return \"\";\n    }\n    const date = new Date(value * 1000);\n    return timeUnitToFormatter[timeUnit](date);\n  });\n\n  const handleChangeSlider = useEventCallback((value: number | number[]) => {\n    assert(Array.isArray(value), \"Value should be an array of two numbers\");\n    if (!timeUnit) {\n      return;\n    }\n    const newTimeRange = valueToTimeRange(value);\n    if (!newTimeRange) {\n      return;\n    }\n    setEnableTransition(false);\n    for (const [_getState, _useStore, store] of Object.values(\n      dashboardInteractiveFilters.stores\n    )) {\n      store.setState({ timeRange: newTimeRange });\n      setTimeRange([value[0], value[1]]);\n    }\n  });\n\n  useEffect(\n    function initTimeRangeAfterDataFetch() {\n      if (timeRange || !timeUnit) {\n        return;\n      }\n      const parser = timeUnitToParser[timeUnit];\n      handleChangeSlider([\n        toUnixSeconds(parser(presets.from)),\n        toUnixSeconds(parser(presets.to)),\n      ]);\n    },\n    [timeRange, timeUnit, presets, handleChangeSlider]\n  );\n\n  useEffect(() => {\n    if (presets.from && presets.to && timeUnit) {\n      const parser = timeUnitToParser[timeUnit];\n      setTimeRange([\n        toUnixSeconds(parser(presets.from)),\n        toUnixSeconds(parser(presets.to)),\n      ]);\n    }\n  }, [presets.from, presets.to, timeUnit]);\n\n  const mountedForSomeTime = useTimeout(500, mounted);\n  const combinedTemporalDimension = useCombinedTemporalDimension();\n  const sliderRange = useMemo(() => {\n    const { values } = combinedTemporalDimension;\n    const min = values[0]?.value;\n    const max = values[values.length - 1]?.value;\n\n    if (!min || !max) {\n      return;\n    }\n\n    return [\n      toUnixSeconds(parseDate(min as string)),\n      toUnixSeconds(parseDate(max as string)),\n    ];\n  }, [combinedTemporalDimension]);\n\n  if (!timeRange || !filter.active || !sliderRange) {\n    return null;\n  }\n\n  return (\n    <Slider\n      className={classes.slider}\n      onChange={(_ev, value) => handleChangeSlider(value)}\n      onChangeCommitted={() => setEnableTransition(true)}\n      valueLabelFormat={valueLabelFormat}\n      step={null}\n      min={sliderRange[0]}\n      max={sliderRange[1]}\n      valueLabelDisplay={mountedForSomeTime ? \"on\" : \"off\"}\n      value={timeRange}\n      marks={combinedTemporalDimension.values.map(({ value }) => ({\n        value: toUnixSeconds(parseDate(value as string)),\n      }))}\n    />\n  );\n};\n\nconst useDataFilterStyles = makeStyles((theme: Theme) => ({\n  wrapper: {\n    display: \"grid\",\n    gridTemplateColumns: \"repeat(auto-fill, minmax(200px, 1fr))\",\n    gap: theme.spacing(2),\n  },\n  filter: {\n    display: \"flex\",\n    flex: \"1 1 100%\",\n    width: \"100%\",\n    marginRight: theme.spacing(3),\n    \"&:last-of-type\": {\n      marginRight: 0,\n    },\n    \"& > div\": {\n      width: \"100%\",\n    },\n  },\n}));\n\ntype Stores = ReturnType<typeof useDashboardInteractiveFilters>[\"stores\"];\n\nexport const saveDataFiltersSnapshot = (\n  chartConfigs: ChartConfig[],\n  stores: Stores,\n  componentId: string\n) => {\n  const snapshot = Object.fromEntries(\n    Object.entries(stores).map(([key, [_getState, _useStore, store]]) => {\n      const state = store.getState();\n      const filterValue = state.dataFilters[componentId];\n      return [key, filterValue];\n    })\n  );\n\n  return () => {\n    for (const [chartKey, [_getState, _useStore, store]] of Object.entries(\n      stores\n    )) {\n      if (chartConfigs.map((config) => config.key).includes(chartKey)) {\n        const dataFilters = store.getState().dataFilters;\n        const filterValue = snapshot[chartKey];\n        if (filterValue) {\n          dataFilters[componentId] = filterValue;\n          store.setState({ dataFilters });\n        } else {\n          delete dataFilters[componentId];\n          store.setState({ dataFilters });\n        }\n      }\n    }\n  };\n};\n\nconst DashboardDataFilters = ({ componentIds }: { componentIds: string[] }) => {\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const { chartConfigs, dataSource } = state;\n  const classes = useDataFilterStyles();\n\n  const groupedPreparedFilters = useMemo(() => {\n    const allPreparedFilters: PreparedFilter[] = [];\n\n    chartConfigs.forEach((chartConfig) => {\n      chartConfig.cubes.forEach((cube) => {\n        const filtersByMappingStatus = getFiltersByMappingStatus(chartConfig, {\n          cubeIri: cube.iri,\n          joinByIds: componentIds.filter(isJoinById),\n        });\n        const { unmappedFilters, mappedFilters } = filtersByMappingStatus;\n\n        const cubeComponentIds = [\n          ...Object.keys(cube.filters),\n          ...Object.keys(chartConfig.fields),\n          ...Object.values(chartConfig.fields).map(\n            (field) => field.componentId\n          ),\n        ].filter(truthy);\n\n        const componentIdPairs = componentIds\n          .map((originalId) => {\n            const resolvedId = isJoinById(originalId)\n              ? (getResolvedJoinById(cube, originalId) ?? originalId)\n              : originalId;\n            return { originalId, resolvedId };\n          })\n          .filter(({ resolvedId, originalId }) => {\n            return resolvedId === originalId\n              ? cubeComponentIds.includes(resolvedId)\n              : true;\n          });\n\n        const componentIdResolution = Object.fromEntries(\n          componentIdPairs.map(({ originalId, resolvedId }) => [\n            originalId,\n            resolvedId,\n          ])\n        );\n\n        allPreparedFilters.push({\n          cubeIri: cube.iri,\n          interactiveFilters: {},\n          unmappedFilters: unmappedFilters as SingleFilters,\n          mappedFilters,\n          componentIdResolution,\n        });\n      });\n    });\n\n    return groupPreparedFiltersByDimension(allPreparedFilters, componentIds);\n  }, [chartConfigs, componentIds]);\n\n  return (\n    <div className={classes.wrapper}>\n      {groupedPreparedFilters.map(({ dimensionId, entries }) => (\n        <DataFilter\n          key={dimensionId}\n          dimensionId={dimensionId}\n          entries={entries}\n          dataSource={dataSource}\n          chartConfigs={chartConfigs}\n        />\n      ))}\n    </div>\n  );\n};\n\nconst DataFilter = ({\n  dimensionId,\n  entries,\n  dataSource,\n  chartConfigs,\n}: {\n  dimensionId: string;\n  entries: GroupedPreparedFilter[\"entries\"];\n  dataSource: { type: string; url: string };\n  chartConfigs: ChartConfig[];\n}) => {\n  const locale = useLocale();\n  const classes = useDataFilterStyles();\n  const [{ dashboardFilters }] = useConfiguratorState(hasChartConfigs);\n  const dashboardInteractiveFilters = useDashboardInteractiveFilters();\n\n  const cubeIris = uniq(entries.map((entry) => entry.cubeIri));\n\n  const relevantChartConfigs = chartConfigs.filter((config) =>\n    config.cubes.some((cube) => cubeIris.includes(cube.iri))\n  );\n\n  const cubeFilters = useMemo(() => {\n    return entries.map((entry) => ({\n      iri: entry.cubeIri,\n      componentIds: [entry.resolvedDimensionId],\n      loadValues: true,\n    }));\n  }, [entries]);\n\n  const [{ data }] = useDataCubesComponentsQuery({\n    chartConfig: relevantChartConfigs[0],\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters,\n    },\n    keepPreviousData: true,\n    pause: cubeFilters.length === 0,\n  });\n\n  const dimension = data?.dataCubesComponents.dimensions[0];\n\n  const [value, setValue] = useState<string>();\n  const handleChange = useEvent(\n    (\n      e:\n        | SelectChangeEvent<unknown>\n        | ChangeEvent<HTMLSelectElement>\n        | { target: { value: string } }\n    ) => {\n      const newValue = e.target.value as string;\n      setValue(newValue);\n\n      for (const [chartKey, [_getState, _useStore, store]] of Object.entries(\n        dashboardInteractiveFilters.stores\n      )) {\n        if (\n          relevantChartConfigs.map((config) => config.key).includes(chartKey)\n        ) {\n          setDataFilter(store, dimensionId, newValue);\n        }\n      }\n    }\n  );\n\n  // Syncs the interactive filter value with the config value\n  useEffect(() => {\n    const value = dashboardFilters?.dataFilters.filters[dimensionId].value as\n      | string\n      | undefined;\n\n    if (value) {\n      handleChange({ target: { value } });\n    }\n  }, [dimensionId, handleChange, dashboardFilters?.dataFilters.filters]);\n\n  useEffect(() => {\n    const restoreSnapshot = saveDataFiltersSnapshot(\n      relevantChartConfigs,\n      dashboardInteractiveFilters.stores,\n      dimensionId\n    );\n\n    const value = dashboardFilters?.dataFilters.filters[dimensionId]?.value as\n      | string\n      | undefined;\n\n    if (value) {\n      handleChange({ target: { value } } as ChangeEvent<HTMLSelectElement>);\n    } else if (dimension?.values.length) {\n      handleChange({\n        target: { value: dimension.values[0].value as string },\n      } as ChangeEvent<HTMLSelectElement>);\n    }\n\n    return () => {\n      restoreSnapshot();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dimension?.values]);\n  const disabled = !dimension?.values.length;\n  const hierarchy = dimension?.hierarchy;\n\n  return dimension && value ? (\n    <div className={classes.filter}>\n      {isTemporalDimension(dimension) ? (\n        <DataFilterTemporalDimension\n          value={value}\n          dimension={dimension}\n          onChange={handleChange}\n          disabled={disabled}\n        />\n      ) : hierarchy ? (\n        <DataFilterHierarchyDimension\n          value={value}\n          dimension={dimension}\n          onChange={handleChange}\n          hierarchy={hierarchy}\n          disabled={disabled}\n        />\n      ) : (\n        <DataFilterGenericDimension\n          value={value}\n          dimension={dimension}\n          onChange={handleChange}\n          disabled={disabled}\n        />\n      )}\n    </div>\n  ) : null;\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Button,\n  CircularProgress,\n  ListSubheader,\n  MenuItem,\n  Typography,\n  useEventCallback,\n} from \"@mui/material\";\nimport { ascending } from \"d3-array\";\nimport { Workbook } from \"exceljs\";\nimport { saveAs } from \"file-saver\";\nimport keyBy from \"lodash/keyBy\";\nimport {\n  createContext,\n  Dispatch,\n  memo,\n  PropsWithChildren,\n  ReactNode,\n  useCallback,\n  useContext,\n  useState,\n} from \"react\";\nimport { useClient } from \"urql\";\n\nimport { ArrowMenuBottomTop } from \"@/components/arrow-menu\";\nimport { DataSource, SortingField } from \"@/config-types\";\nimport {\n  Component,\n  DataCubeComponents,\n  DataCubesObservations,\n  Observation,\n} from \"@/domain/data\";\nimport { getSortedComponents } from \"@/domain/get-sorted-components\";\nimport {\n  dateFormatterFromDimension,\n  formatIdentity,\n  getFormatFullDateAuto,\n  getFormattersForLocale,\n} from \"@/formatters\";\nimport {\n  executeDataCubesComponentsQuery,\n  executeDataCubesObservationsQuery,\n} from \"@/graphql/hooks\";\nimport { DataCubeObservationFilter } from \"@/graphql/query-hooks\";\nimport { Icon } from \"@/icons\";\nimport { Locale } from \"@/locales/locales\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { makeDimensionValueSorters } from \"@/utils/sorting-values\";\nimport { useI18n } from \"@/utils/use-i18n\";\n\ntype DataDownloadState = {\n  isDownloading: boolean;\n  error?: string;\n};\n\nconst DataDownloadStateContext = createContext<\n  [DataDownloadState, Dispatch<DataDownloadState>] | undefined\n>(undefined);\n\nconst useDataDownloadState = () => {\n  const ctx = useContext(DataDownloadStateContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need to wrap your component in <DataDownloadStateProvider /> to useDataDownloadState()\"\n    );\n  }\n\n  return ctx;\n};\n\nconst DataDownloadStateProvider = ({ children }: { children: ReactNode }) => {\n  const [state, dispatch] = useState<DataDownloadState>({\n    isDownloading: false,\n  });\n\n  return (\n    <DataDownloadStateContext.Provider value={[state, dispatch]}>\n      {children}\n    </DataDownloadStateContext.Provider>\n  );\n};\n\nconst FILE_FORMATS = [\"csv\", \"xlsx\"] as const;\ntype FileFormat = (typeof FILE_FORMATS)[number];\n\nconst makeColumnLabel = (dim: Component) => {\n  return `${dim.label}${dim.unit ? ` (${dim.unit})` : \"\"}`;\n};\n\nconst prepareData = ({\n  components,\n  observations,\n  dimensionParsers,\n}: {\n  components: Component[];\n  observations: Observation[];\n  dimensionParsers: DimensionParsers;\n}) => {\n  const sortedComponents = getSortedComponents(components);\n  const columns = keyBy(sortedComponents, (d) => d.id);\n  // Sort the data from left to right, keeping the order of the columns.\n  const sorting: SortingField[\"sorting\"] = {\n    sortingType: \"byAuto\",\n    sortingOrder: \"asc\",\n  };\n\n  const sorters = sortedComponents.map<\n    [string, ReturnType<typeof makeDimensionValueSorters>]\n  >((d) => {\n    return [d.id, makeDimensionValueSorters(d, { sorting })];\n  });\n  // We need to sort before parsing, to access raw observation values, where\n  // dates are formatted in the format of YYYY-MM-DD, etc.\n  const sortedData = [...observations];\n  sortedData.sort((a, b) => {\n    for (const [iri, dimSorters] of sorters) {\n      for (const sorter of dimSorters) {\n        const sortResult = ascending(\n          sorter(a[iri] as string),\n          sorter(b[iri] as string)\n        );\n\n        if (sortResult !== 0) {\n          return sortResult;\n        }\n      }\n    }\n    return 0;\n  });\n\n  const parsedData = sortedData.map((obs) => {\n    const formattedObs = Object.keys(obs).reduce<Observation>((acc, key) => {\n      return {\n        ...acc,\n        [key]: formatIdentity(obs[key]),\n      };\n    }, {});\n\n    return Object.keys(formattedObs).reduce<Observation>((acc, key) => {\n      const col = columns[key];\n      const parser = dimensionParsers[key];\n\n      if (!col) return acc;\n\n      const value = formattedObs[key];\n      let parsedValue;\n\n      if (value?.toString() === \"\") {\n        parsedValue = \"-\";\n      } else {\n        parsedValue = parser(value as string);\n      }\n\n      return {\n        ...acc,\n        [makeColumnLabel(col)]: parsedValue,\n      };\n    }, {});\n  });\n\n  const columnKeys = Object.values(columns).map(makeColumnLabel);\n\n  return {\n    data: parsedData,\n    columnKeys,\n  };\n};\n\nconst RawMenuItem = ({ children }: PropsWithChildren<{}>) => {\n  return (\n    <MenuItem\n      sx={{\n        whiteSpace: \"normal\",\n\n        \"&:hover\": {\n          backgroundColor: \"transparent\",\n          cursor: \"default\",\n        },\n      }}\n    >\n      {children}\n    </MenuItem>\n  );\n};\n\nexport const DataDownloadMenu = memo(\n  ({\n    dataSource,\n    filters,\n    title,\n  }: {\n    dataSource: DataSource;\n    filters: DataCubeObservationFilter;\n    title: string;\n  }) => {\n    return (\n      <DataDownloadStateProvider>\n        <DataDownloadInnerMenu\n          dataSource={dataSource}\n          fileName={title}\n          filters={filters}\n        />\n      </DataDownloadStateProvider>\n    );\n  }\n);\n\nconst DataDownloadInnerMenu = ({\n  dataSource,\n  fileName,\n  filters,\n}: {\n  dataSource: DataSource;\n  fileName: string;\n  filters: DataCubeObservationFilter;\n}) => {\n  const [state] = useDataDownloadState();\n  const [anchor, setAnchor] = useState<HTMLElement | null>(null);\n  const handleClose = useEventCallback(() => setAnchor(null));\n\n  return (\n    <>\n      <Button\n        variant=\"text\"\n        color=\"primary\"\n        size=\"sm\"\n        startIcon={\n          state.isDownloading ? (\n            <CircularProgress size={20} />\n          ) : (\n            <Icon name=\"download\" size={20} />\n          )\n        }\n        onClick={(e) => setAnchor(e.currentTarget)}\n        sx={{\n          width: \"fit-content\",\n          minHeight: 0,\n          p: 0,\n          ml: \"2.5px\",\n          fontSize: \"inherit\",\n        }}\n      >\n        <Trans id=\"button.download.data\">Download data</Trans>\n      </Button>\n      <ArrowMenuBottomTop\n        open={!!anchor}\n        anchorEl={anchor}\n        onClose={handleClose}\n        anchorOrigin={{ horizontal: \"center\", vertical: \"top\" }}\n        transformOrigin={{ horizontal: \"center\", vertical: \"bottom\" }}\n        MenuListProps={{\n          sx: {\n            width: 200,\n          },\n        }}\n        sx={{\n          transform: \"translateY(-12px)\",\n        }}\n      >\n        {filters.filters && (\n          <DataDownloadMenuSection\n            dataSource={dataSource}\n            subheader={\n              <Trans id=\"button.download.data.visible\">Chart dataset</Trans>\n            }\n            fileName={`${fileName}-filtered`}\n            filters={filters}\n          />\n        )}\n        <DataDownloadMenuSection\n          dataSource={dataSource}\n          subheader={<Trans id=\"button.download.data.all\">Full dataset</Trans>}\n          fileName={`${fileName}-full`}\n          filters={getFullDataDownloadFilters(filters)}\n        />\n        {state.error && (\n          <RawMenuItem>\n            <Typography variant=\"caption\" color=\"error.main\">\n              {state.error}\n            </Typography>\n          </RawMenuItem>\n        )}\n      </ArrowMenuBottomTop>\n    </>\n  );\n};\n\n/** We need to include every cube column in full dataset download (client's\n * request), so we do not pass any component ids here\n * */\nexport const getFullDataDownloadFilters = (\n  filters: DataCubeObservationFilter\n) => {\n  return { iri: filters.iri };\n};\n\nconst DataDownloadMenuSection = ({\n  dataSource,\n  subheader,\n  fileName,\n  filters,\n}: {\n  dataSource: DataSource;\n  subheader: ReactNode;\n  fileName: string;\n  filters?: DataCubeObservationFilter;\n}) => {\n  return (\n    <>\n      <ListSubheader>{subheader}</ListSubheader>\n      {FILE_FORMATS.map((fileFormat) => (\n        <DownloadMenuItem\n          key={fileFormat}\n          dataSource={dataSource}\n          fileName={fileName}\n          fileFormat={fileFormat}\n          filters={filters}\n        />\n      ))}\n    </>\n  );\n};\n\nconst DownloadMenuItem = ({\n  dataSource,\n  fileName,\n  fileFormat,\n  filters,\n}: {\n  dataSource: DataSource;\n  fileName: string;\n  fileFormat: FileFormat;\n  filters?: DataCubeObservationFilter;\n}) => {\n  const locale = useLocale();\n  const i18n = useI18n();\n  const client = useClient();\n  const [state, dispatch] = useDataDownloadState();\n  const download = useCallback(\n    async (\n      componentsData: { dataCubesComponents: DataCubeComponents } | undefined,\n      observationsData:\n        | { dataCubesObservations: DataCubesObservations }\n        | undefined\n    ) => {\n      if (\n        !(\n          componentsData?.dataCubesComponents &&\n          observationsData?.dataCubesObservations\n        )\n      ) {\n        return;\n      }\n\n      const { dimensions, measures } = componentsData.dataCubesComponents;\n      const components = [...dimensions, ...measures];\n      const dimensionParsers = getDimensionParsers(components, { locale });\n      const observations = observationsData.dataCubesObservations.data;\n\n      const { columnKeys, data } = prepareData({\n        components,\n        observations,\n        dimensionParsers,\n      });\n\n      const workbook = new Workbook();\n      const worksheet = workbook.addWorksheet(\"data\");\n      worksheet.columns = columnKeys.map((d) => ({\n        header: d,\n        key: d,\n      }));\n      worksheet.addRows(data);\n\n      switch (fileFormat) {\n        case \"csv\":\n          const csv = await workbook.csv.writeBuffer();\n          saveAs(\n            new Blob([\"\\uFEFF\" + csv], { type: \"text/csv;charset=utf-8\" }),\n            `${fileName}.csv`\n          );\n          break;\n        case \"xlsx\":\n          const xlsx = await workbook.xlsx.writeBuffer();\n          saveAs(\n            new Blob([xlsx], {\n              type: \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8\",\n            }),\n            `${fileName}.xlsx`\n          );\n          break;\n      }\n    },\n    [fileFormat, fileName, locale]\n  );\n\n  return (\n    <MenuItem\n      disabled={state.isDownloading}\n      onClick={async () => {\n        if (!filters) {\n          return;\n        }\n\n        dispatch({ isDownloading: true });\n\n        try {\n          const [componentsResult, observationsResult] = await Promise.all([\n            executeDataCubesComponentsQuery(client, {\n              sourceType: dataSource.type,\n              sourceUrl: dataSource.url,\n              locale,\n              cubeFilters: [filters],\n            }),\n            executeDataCubesObservationsQuery(client, {\n              sourceType: dataSource.type,\n              sourceUrl: dataSource.url,\n              locale,\n              cubeFilters: [filters],\n            }),\n          ]);\n\n          if (componentsResult.data && observationsResult.data) {\n            await download(componentsResult.data, observationsResult.data);\n          } else if (componentsResult.error || observationsResult.error) {\n            dispatch({\n              ...state,\n              error: i18n._(\n                t({\n                  id: \"hint.dataloadingerror.message\",\n                  message: \"The data could not be loaded.\",\n                })\n              ),\n            });\n          }\n        } catch (e) {\n          console.error(\n            i18n._(\n              t({\n                id: \"hint.dataloadingerror.message\",\n                message: \"The data could not be loaded.\",\n              })\n            ),\n            e\n          );\n        } finally {\n          dispatch({ ...state, isDownloading: false });\n        }\n      }}\n    >\n      {fileFormat.toUpperCase()}\n    </MenuItem>\n  );\n};\n\ntype DimensionParsers = {\n  [iri: string]: (d: string) => any;\n};\n\nconst getDimensionParsers = (\n  components: Component[],\n  { locale }: { locale: Locale }\n): DimensionParsers => {\n  return Object.fromEntries(\n    components.map((d) => {\n      switch (d.__typename) {\n        case \"GeoCoordinatesDimension\":\n        case \"GeoShapesDimension\":\n        case \"NominalDimension\":\n        case \"OrdinalDimension\":\n        case \"TemporalEntityDimension\":\n        case \"TemporalOrdinalDimension\":\n          return [d.id, (d) => d];\n        case \"NumericalMeasure\":\n        case \"StandardErrorDimension\":\n        case \"ConfidenceUpperBoundDimension\":\n        case \"ConfidenceLowerBoundDimension\":\n          return [d.id, (d) => +d];\n        case \"OrdinalMeasure\":\n          return d.isNumerical ? [d.id, (d) => +d] : [d.id, (d) => d];\n        case \"TemporalDimension\": {\n          if (d.timeUnit === \"Year\") {\n            return [d.id, (d) => +d];\n          }\n\n          // We do not want to parse dates as dates, but strings (for easier\n          // handling in Excel).\n          const dateFormatters = getFormattersForLocale(locale);\n          const formatDateAuto = getFormatFullDateAuto(dateFormatters);\n\n          return [\n            d.id,\n            dateFormatterFromDimension(d, dateFormatters, formatDateAuto),\n          ];\n        }\n        default:\n          const _exhaustiveCheck: never = d;\n          return _exhaustiveCheck;\n      }\n    })\n  );\n};\n","import { DataCubeMetadata } from \"@/domain/data\";\n\nexport const makeOpenDataLink = (lang: string, cube: DataCubeMetadata) => {\n  const identifier = cube?.identifier;\n  const creatorIri = cube?.creator?.iri;\n  const isPublished = cube?.workExamples?.includes(\n    \"https://ld.admin.ch/application/opendataswiss\"\n  );\n\n  if (!identifier || !creatorIri || !isPublished) {\n    return;\n  }\n\n  const creatorSlug = creatorIri.replace(\n    \"https://register.ld.admin.ch/opendataswiss/org/\",\n    \"\"\n  );\n\n  return `https://opendata.swiss/${lang}/perma/${encodeURIComponent(\n    // Sometimes the identifier is prefixed with the creator slug\n    `${identifier.replace(`@${creatorSlug}`, \"\")}@${creatorSlug}`\n  )}`;\n};\n","import { Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Link,\n  Link as MUILink,\n  LinkProps,\n  Stack,\n  Typography,\n  TypographyProps,\n} from \"@mui/material\";\nimport sortBy from \"lodash/sortBy\";\nimport NextLink from \"next/link\";\nimport { ReactElement, ReactNode } from \"react\";\n\nimport { useQueryFilters } from \"@/charts/shared/chart-helpers\";\nimport { DataDownloadMenu } from \"@/components/data-download\";\nimport { Tag } from \"@/components/tag\";\nimport { DataSource } from \"@/configurator\";\nimport { DataCubeMetadata } from \"@/domain/data\";\nimport { useFormatDate } from \"@/formatters\";\nimport { Icon } from \"@/icons\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { makeOpenDataLink } from \"@/utils/opendata\";\n\nexport const DatasetMetadata = ({\n  cube,\n  showTitle,\n  sparqlEditorUrl,\n  dataSource,\n  queryFilters,\n}: {\n  cube: DataCubeMetadata;\n  showTitle: boolean;\n  sparqlEditorUrl?: string;\n  dataSource: DataSource;\n  queryFilters?: ReturnType<typeof useQueryFilters>[number];\n}) => {\n  const locale = useLocale();\n  const formatDate = useFormatDate();\n  const openDataLink = cube ? makeOpenDataLink(locale, cube) : null;\n\n  return (\n    <div>\n      {showTitle ? (\n        <Typography variant=\"h5\" fontWeight={700} sx={{ mb: 4 }}>\n          {cube.title}\n        </Typography>\n      ) : null}\n      <Stack spacing={6}>\n        {cube.publisher && (\n          <div>\n            <DatasetMetadataTitle>\n              <Trans id=\"dataset.metadata.source\">Source</Trans>\n            </DatasetMetadataTitle>\n            <DatasetMetadataBody>\n              <Box\n                component=\"span\"\n                sx={{ \"> a\": { color: \"grey.900\" } }}\n                dangerouslySetInnerHTML={{\n                  __html: cube.publisher,\n                }}\n              />\n            </DatasetMetadataBody>\n          </div>\n        )}\n        <div>\n          <DatasetMetadataTitle>\n            <Trans id=\"dataset.metadata.date.created\">Date Created</Trans>\n          </DatasetMetadataTitle>\n          <DatasetMetadataBody>\n            {cube.datePublished ? (formatDate(cube.datePublished) ?? \"\") : \"\"}\n          </DatasetMetadataBody>\n        </div>\n        <div>\n          <DatasetMetadataTitle>\n            <Trans id=\"dataset.metadata.version\">Version</Trans>\n          </DatasetMetadataTitle>\n          <DatasetMetadataBody>{cube.version ?? \"\"}</DatasetMetadataBody>\n        </div>\n        <div>\n          <DatasetMetadataTitle>\n            <Trans id=\"dataset.metadata.email\">Contact points</Trans>\n          </DatasetMetadataTitle>\n          <DatasetMetadataBody>\n            {cube.contactPoints?.map((contactPoint) =>\n              contactPoint.email && contactPoint.name ? (\n                <DatasetMetadataLink\n                  key={contactPoint.email}\n                  href={`mailto:${contactPoint.email}`}\n                  label={contactPoint.name ?? contactPoint.email}\n                />\n              ) : (\n                \"\"\n              )\n            )}\n          </DatasetMetadataBody>\n        </div>\n        <div>\n          <DatasetMetadataTitle>\n            <Trans id=\"dataset.metadata.furtherinformation\">\n              Further information\n            </Trans>\n          </DatasetMetadataTitle>\n          <DatasetMetadataBody sx={{ mt: \"1px\" }}>\n            {cube.landingPage ? (\n              <DatasetMetadataLink\n                href={cube.landingPage}\n                external\n                label={\n                  <Trans id=\"dataset.metadata.learnmore\">\n                    More about the dataset\n                  </Trans>\n                }\n              />\n            ) : (\n              \"\"\n            )}\n            {sparqlEditorUrl ? (\n              <DatasetSparqlQuery url={sparqlEditorUrl} />\n            ) : null}\n            {queryFilters ? (\n              <DataDownloadMenu\n                dataSource={dataSource}\n                title={cube.title}\n                filters={queryFilters}\n              />\n            ) : null}\n            {openDataLink ? (\n              <DatasetMetadataLink\n                external\n                label=\"OpenData.swiss\"\n                href={openDataLink}\n              />\n            ) : null}\n          </DatasetMetadataBody>\n        </div>\n        <Stack spacing={2.5}>\n          <DatasetMetadataTitle>\n            <Trans id=\"dataset-preview.keywords\">Keywords</Trans>\n          </DatasetMetadataTitle>\n          <DatasetTags cube={cube} />\n        </Stack>\n      </Stack>\n    </div>\n  );\n};\n\nconst DatasetMetadataTitle = ({ children }: { children: ReactNode }) => (\n  <Typography variant=\"h6\" component=\"p\" fontWeight={700}>\n    {children}\n  </Typography>\n);\n\nconst DatasetMetadataBody = ({\n  children,\n  sx,\n}: {\n  children: ReactNode;\n  sx?: TypographyProps[\"sx\"];\n}) => (\n  <Typography\n    variant=\"body3\"\n    sx={{\n      display: \"flex\",\n      flexDirection: \"column\",\n      gap: \"1px\",\n      mt: \"1px\",\n      ...sx,\n    }}\n  >\n    {children}\n  </Typography>\n);\n\nconst DatasetMetadataLink = ({\n  href,\n  label,\n  external,\n  ...props\n}: {\n  href: string;\n  label: string | ReactElement;\n  external?: boolean;\n} & LinkProps) => (\n  <Link\n    underline=\"hover\"\n    href={href}\n    target=\"_blank\"\n    rel=\"noopener noreferrer\"\n    sx={{ display: \"inline-flex\", alignItems: \"center\", gap: 1 }}\n    {...props}\n  >\n    {external ? <Icon name=\"link\" size={20} /> : null}\n    {label}\n  </Link>\n);\n\nconst DatasetSparqlQuery = ({ url }: { url: string }) => {\n  return (\n    <Link\n      underline=\"hover\"\n      href={url}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      sx={{ display: \"inline-flex\", alignItems: \"center\", gap: 1 }}\n    >\n      <Icon name=\"legacyLinkExternal\" size={16} />\n      <Trans id=\"chart-controls.sparql-query\">SPARQL query</Trans>\n    </Link>\n  );\n};\n\nconst DatasetTags = ({ cube }: { cube: DataCubeMetadata }) => {\n  return (\n    <Stack spacing={1} direction=\"column\">\n      {cube.creator?.iri && (\n        <DatasetMetadataTag\n          type=\"organization\"\n          iri={cube.creator.iri}\n          label={cube.creator.label}\n        />\n      )}\n      {cube.themes &&\n        sortBy(cube.themes, (d) => d.label).map(\n          (t) =>\n            t.iri &&\n            t.label && (\n              <DatasetMetadataTag\n                key={t.iri}\n                type=\"theme\"\n                iri={t.iri}\n                label={t.label}\n              />\n            )\n        )}\n    </Stack>\n  );\n};\n\nconst DatasetMetadataTag = ({\n  type,\n  iri,\n  label,\n}: {\n  type: \"organization\" | \"theme\";\n  iri: string;\n  label?: string | null;\n}) => {\n  return (\n    <NextLink\n      key={iri}\n      href={`/browse/${type}/${encodeURIComponent(iri)}`}\n      passHref\n      legacyBehavior\n    >\n      <Tag\n        component={MUILink}\n        // @ts-ignore\n        underline=\"none\"\n        title={label ?? undefined}\n        sx={{\n          display: \"inline-block\",\n          maxWidth: \"100%\",\n          borderRadius: \"16px\",\n          color: \"text.primary\",\n        }}\n      >\n        {label}\n      </Tag>\n    </NextLink>\n  );\n};\n","import { Box, BoxProps, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport { forwardRef, Ref } from \"react\";\n\nimport { chartPanelLayoutGridClasses } from \"@/components/chart-panel-layout-grid\";\nimport { useIconStyles } from \"@/components/chart-selection-tabs\";\nimport { Icon } from \"@/icons\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nexport const DragHandle = forwardRef<\n  HTMLDivElement,\n  Omit<BoxProps, \"ref\"> & {\n    ref?: Ref<HTMLDivElement>;\n    dragging?: boolean;\n  }\n>((props, ref) => {\n  const { dragging, ...rest } = props;\n  const classes = useIconStyles({ active: false, dragging });\n\n  return (\n    <Box\n      {...DISABLE_SCREENSHOT_ATTR}\n      ref={ref}\n      {...rest}\n      className={clsx(\n        classes.dragIconWrapper,\n        props.className,\n        chartPanelLayoutGridClasses.dragHandle\n      )}\n    >\n      <Icon name=\"dragndrop\" />\n    </Box>\n  );\n});\n\nexport const useDragOverClasses = makeStyles<\n  Theme,\n  { isDragging?: boolean; isDragActive?: boolean; isDragOver?: boolean }\n>((theme) => ({\n  root: {\n    opacity: ({ isDragging, isDragOver }) => {\n      return isDragging ? 0.2 : isDragOver ? 0.8 : 1;\n    },\n    outline: ({ isDragging, isDragOver }) => {\n      return `2px solid ${\n        isDragOver && !isDragging ? theme.palette.primary.main : \"transparent\"\n      }`;\n    },\n    pointerEvents: ({ isDragActive }) => {\n      return isDragActive ? \"none\" : \"auto\";\n    },\n  },\n}));\n","import { useRouter } from \"next/router\";\nimport { useCallback, useMemo } from \"react\";\n\nconst LEGACY_EMBED_QUERY_PARAMS = [\"disableBorder\"] as const;\ntype LegacyEmbedQueryParam = (typeof LEGACY_EMBED_QUERY_PARAMS)[number];\n\nconst migrateEmbedQueryParam = (\n  param: LegacyEmbedQueryParam | EmbedQueryParam\n): EmbedQueryParam => {\n  switch (param) {\n    case \"disableBorder\":\n      return \"removeBorder\";\n    case \"optimizeSpace\":\n    case \"removeLabelsInteractivity\":\n    case \"removeBorder\":\n    case \"removeFootnotes\":\n    case \"removeFilters\":\n    case \"removeMoreOptionsButton\":\n      return param;\n    default:\n      const _exhaustiveCheck: never = param;\n      return _exhaustiveCheck;\n  }\n};\n\nconst EMBED_QUERY_PARAMS = [\n  \"removeBorder\",\n  \"optimizeSpace\",\n  \"removeMoreOptionsButton\",\n  \"removeLabelsInteractivity\",\n  \"removeFootnotes\",\n  \"removeFilters\",\n] as const;\ntype EmbedQueryParam = (typeof EMBED_QUERY_PARAMS)[number];\nexport type EmbedQueryParams = Record<EmbedQueryParam, boolean>;\n\nexport const isEmbedQueryParam = (param: string): param is EmbedQueryParam => {\n  return [...LEGACY_EMBED_QUERY_PARAMS, ...EMBED_QUERY_PARAMS].includes(\n    param as $IntentionalAny\n  );\n};\n\nexport const getEmbedParamsFromQuery = (\n  query: Record<string, string | string[] | undefined>\n): EmbedQueryParams => {\n  return [\n    ...LEGACY_EMBED_QUERY_PARAMS,\n    ...EMBED_QUERY_PARAMS,\n  ].reduce<EmbedQueryParams>(\n    (acc, param) => {\n      const value = query[param];\n\n      if (value === \"true\") {\n        acc[migrateEmbedQueryParam(param)] = true;\n      }\n\n      return acc;\n    },\n    {\n      removeBorder: false,\n      optimizeSpace: false,\n      removeMoreOptionsButton: false,\n      removeLabelsInteractivity: false,\n      removeFootnotes: false,\n      removeFilters: false,\n    }\n  );\n};\n\nconst buildEmbedQueryParams = (embedParams: EmbedQueryParams) => {\n  return Object.fromEntries(\n    Object.entries(embedParams)\n      .filter(([_, v]) => v)\n      .map(([k]) => [k, \"true\"])\n  );\n};\n\nexport const getEmbedParamsQueryString = (embedParams: EmbedQueryParams) => {\n  const queryObject = buildEmbedQueryParams(embedParams);\n  const searchParams = new URLSearchParams(queryObject);\n\n  return searchParams.toString();\n};\n\nexport const useEmbedQueryParams = () => {\n  const router = useRouter();\n  const embedParams = useMemo(() => {\n    return getEmbedParamsFromQuery(router.query);\n  }, [router.query]);\n  const setEmbedQueryParam = useCallback(\n    (param: EmbedQueryParam, value: boolean) => {\n      const updatedParams = { ...embedParams, [param]: value };\n      const nonEmbedParams = Object.fromEntries(\n        Object.entries(router.query).filter(([key]) => !isEmbedQueryParam(key))\n      );\n      router.replace(\n        {\n          pathname: router.pathname,\n          query: {\n            ...nonEmbedParams,\n            ...buildEmbedQueryParams(updatedParams),\n          },\n        },\n        undefined,\n        { shallow: true }\n      );\n    },\n    [embedParams, router]\n  );\n\n  return {\n    embedParams,\n    setEmbedQueryParam,\n  };\n};\n","import { Tooltip, TooltipProps } from \"@mui/material\";\nimport { ReactNode } from \"react\";\n\nimport { Icon } from \"@/icons\";\n\nexport const InfoIconTooltip = (\n  props: {\n    title: NonNullable<ReactNode>;\n    size?: number;\n  } & Omit<TooltipProps, \"children\" | \"title\">\n) => {\n  const {\n    title,\n    size = 24,\n    componentsProps,\n    placement = \"top\",\n    ...rest\n  } = props;\n\n  return (\n    <Tooltip\n      arrow\n      placement={placement}\n      title={title}\n      disableInteractive\n      {...rest}\n    >\n      <div style={{ lineHeight: 0 }}>\n        <Icon name=\"infoCircle\" size={size} />\n      </div>\n    </Tooltip>\n  );\n};\n","import clsx from \"clsx\";\nimport { ComponentProps } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport rehypeRaw from \"rehype-raw\";\nimport rehypeSanitize from \"rehype-sanitize\";\nimport remarkGfm from \"remark-gfm\";\n\nimport classes from \"@/components/markdown.module.css\";\nimport { palette } from \"@/themes/palette\";\n\nconst components: ComponentProps<typeof ReactMarkdown>[\"components\"] = {\n  h1: ({ children, className, ...props }) => (\n    <h1 className={clsx(className, classes.common)} {...props}>\n      {children}\n    </h1>\n  ),\n  h2: ({ children, className, ...props }) => (\n    <h2 className={clsx(className, classes.common)} {...props}>\n      {children}\n    </h2>\n  ),\n  h3: ({ children, className, ...props }) => (\n    <h3 className={clsx(className, classes.common)} {...props}>\n      {children}\n    </h3>\n  ),\n  h4: ({ children, className, ...props }) => (\n    <h4 className={clsx(className, classes.common)} {...props}>\n      {children}\n    </h4>\n  ),\n  h5: ({ children, className, ...props }) => (\n    <h5 className={clsx(className, classes.common)} {...props}>\n      {children}\n    </h5>\n  ),\n  h6: ({ children, className, ...props }) => (\n    <h6 className={clsx(className, classes.common)} {...props}>\n      {children}\n    </h6>\n  ),\n  p: ({ children, className, ...props }) => (\n    <p className={clsx(className, classes.common)} {...props}>\n      {children}\n    </p>\n  ),\n  a: ({ children, className, style, ...props }) => (\n    <a\n      target=\"_blank\"\n      className={clsx(className, classes.common)}\n      style={{ ...style, color: palette.primary.main }}\n      {...props}\n    >\n      {children}\n    </a>\n  ),\n};\n\nexport const Markdown = (\n  props: Omit<ComponentProps<typeof ReactMarkdown>, \"components\">\n) => {\n  return (\n    <ReactMarkdown\n      components={components}\n      remarkPlugins={[remarkGfm]}\n      rehypePlugins={[rehypeRaw, rehypeSanitize]}\n      {...props}\n    />\n  );\n};\n\nexport const InlineMarkdown = ({\n  children,\n  ...rest\n}: Omit<ComponentProps<typeof ReactMarkdown>, \"components\">) => {\n  const inlineMarkdown = children?.replace(/\\r?\\n|\\r/g, \" \");\n\n  return (\n    <ReactMarkdown\n      components={{\n        p: ({ children }) => <>{children}</>,\n        strong: ({ children }) => <strong>{children}</strong>,\n        em: ({ children }) => <em>{children}</em>,\n        a: ({ children, href }) => <a href={href}>{children}</a>,\n        h1: () => null,\n        h2: () => null,\n        h3: () => null,\n        h4: () => null,\n        h5: () => null,\n        h6: () => null,\n        ul: () => null,\n        li: () => null,\n        blockquote: () => null,\n        code: ({ children }) => <code>{children}</code>,\n        br: () => <> </>,\n      }}\n      skipHtml\n      {...rest}\n    >\n      {inlineMarkdown}\n    </ReactMarkdown>\n  );\n};\n\nconst componentsInheritFonts: ComponentProps<\n  typeof ReactMarkdown\n>[\"components\"] = {\n  h1: ({ children, className, ...props }) => (\n    <h1\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      {...props}\n    >\n      {children}\n    </h1>\n  ),\n  h2: ({ children, className, ...props }) => (\n    <h2\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      {...props}\n    >\n      {children}\n    </h2>\n  ),\n  h3: ({ children, className, ...props }) => (\n    <h3\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      {...props}\n    >\n      {children}\n    </h3>\n  ),\n  h4: ({ children, className, ...props }) => (\n    <h4\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      {...props}\n    >\n      {children}\n    </h4>\n  ),\n  h5: ({ children, className, ...props }) => (\n    <h5\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      {...props}\n    >\n      {children}\n    </h5>\n  ),\n  h6: ({ children, className, ...props }) => (\n    <h6\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      {...props}\n    >\n      {children}\n    </h6>\n  ),\n  p: ({ children, className, ...props }) => (\n    <p\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      {...props}\n    >\n      {children}\n    </p>\n  ),\n  a: ({ children, className, style, ...props }) => (\n    <a\n      className={clsx(className, classes.common, classes.inheritFonts)}\n      target=\"_blank\"\n      style={{ ...style, color: palette.primary.main }}\n      {...props}\n    >\n      {children}\n    </a>\n  ),\n};\n\nexport const MarkdownInheritFonts = (\n  props: Omit<ComponentProps<typeof ReactMarkdown>, \"components\">\n) => {\n  return (\n    <ReactMarkdown\n      components={componentsInheritFonts}\n      remarkPlugins={[remarkGfm]}\n      rehypePlugins={[rehypeRaw, rehypeSanitize]}\n      {...props}\n    />\n  );\n};\n","import { createContext, useContext } from \"react\";\nimport { createStore, useStore } from \"zustand\";\nimport shallow from \"zustand/shallow\";\n\nimport { Component } from \"@/domain/data\";\n\ntype MetadataPanelSection = \"general\" | \"data\";\n\ntype MetadataPanelState = {\n  open: boolean;\n  activeSection: MetadataPanelSection;\n  selectedComponent: Component | undefined;\n  actions: {\n    setOpen: (open: boolean) => void;\n    toggle: () => void;\n    setActiveSection: (activeSection: MetadataPanelSection) => void;\n    setSelectedComponent: (component: Component) => void;\n    clearSelectedComponent: () => void;\n    openComponent: (component: Component) => void;\n    reset: () => void;\n  };\n};\n\nexport const createMetadataPanelStore = () =>\n  createStore<MetadataPanelState>((set, get) => ({\n    open: false,\n    activeSection: \"general\",\n    selectedComponent: undefined,\n    actions: {\n      setOpen: (open: boolean) => {\n        set({ open });\n      },\n      toggle: () => {\n        set({ open: !get().open });\n      },\n      setActiveSection: (section: MetadataPanelSection) => {\n        set({ activeSection: section });\n      },\n      setSelectedComponent: (component: Component) => {\n        set({ selectedComponent: component });\n      },\n      clearSelectedComponent: () => {\n        set({ selectedComponent: undefined });\n      },\n      openComponent: (component: Component) => {\n        set({\n          open: true,\n          activeSection: \"data\",\n          selectedComponent: component,\n        });\n      },\n      reset: () => {\n        set({ activeSection: \"general\", selectedComponent: undefined });\n      },\n    },\n  }));\n\nexport const useMetadataPanelStore: <T>(\n  selector: (state: MetadataPanelState) => T\n) => T = (selector) => {\n  const store = useContext(MetadataPanelStoreContext);\n\n  return useStore(store, selector, shallow);\n};\n\nexport const useMetadataPanelStoreActions = () => {\n  const store = useContext(MetadataPanelStoreContext);\n\n  return useStore(store, (state) => state.actions);\n};\n\nconst defaultStore = createMetadataPanelStore();\n\nexport const MetadataPanelStoreContext = createContext(defaultStore);\n","import { Chip, chipClasses, ChipProps } from \"@mui/material\";\n\nimport SvgIcJoint from \"@/icons/components/IcJoint\";\n\nexport const JoinByChip = ({ children, ...props }: ChipProps) => {\n  return (\n    <Chip\n      {...props}\n      label={\n        <>\n          <SvgIcJoint />\n          {props.label}\n        </>\n      }\n      sx={{\n        background: (theme) => theme.palette.warning.light,\n        padding: \"2px 6px\",\n        minHeight: \"auto\",\n        height: 20,\n        borderRadius: 2,\n        gap: \"4px\",\n        [`& .${chipClasses.label}`]: {\n          padding: 0,\n          lineHeight: 1,\n          display: \"flex\",\n          alignItems: \"center\",\n        },\n      }}\n    />\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { TabContext, TabList, TabPanel } from \"@mui/lab\";\nimport {\n  Autocomplete,\n  Box,\n  Button,\n  Divider,\n  Drawer,\n  IconButton,\n  InputAdornment,\n  MenuItem,\n  Stack,\n  Tab,\n  TextField,\n  Theme,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport match from \"autosuggest-highlight/match\";\nimport parse from \"autosuggest-highlight/parse\";\nimport clsx from \"clsx\";\nimport { AnimatePresence, Transition } from \"framer-motion\";\nimport groupBy from \"lodash/groupBy\";\nimport keyBy from \"lodash/keyBy\";\nimport omit from \"lodash/omit\";\nimport orderBy from \"lodash/orderBy\";\nimport sortBy from \"lodash/sortBy\";\nimport { useRouter } from \"next/router\";\nimport {\n  Fragment,\n  type MouseEvent,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\n\nimport {\n  extractChartConfigComponentIds,\n  useQueryFilters,\n} from \"@/charts/shared/chart-helpers\";\nimport { DatasetMetadata } from \"@/components/dataset-metadata\";\nimport { useEmbedQueryParams } from \"@/components/embed-params\";\nimport { Flex } from \"@/components/flex\";\nimport { Error, Loading } from \"@/components/hint\";\nimport { InfoIconTooltip } from \"@/components/info-icon-tooltip\";\nimport { JoinByChip } from \"@/components/join-by-chip\";\nimport {\n  useMetadataPanelStore,\n  useMetadataPanelStoreActions,\n} from \"@/components/metadata-panel-store\";\nimport { MotionBox } from \"@/components/presence\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  BackButton,\n  ChartConfig,\n  DashboardFiltersConfig,\n  DataSource,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { DRAWER_WIDTH } from \"@/configurator/components/drawers\";\nimport {\n  getComponentDescription,\n  getComponentLabel,\n} from \"@/configurator/components/ui-helpers\";\nimport {\n  Component,\n  DimensionValue,\n  isConfidenceLowerBoundDimension,\n  isConfidenceUpperBoundDimension,\n  isJoinByComponent,\n  isStandardErrorDimension,\n  TemporalDimension,\n} from \"@/domain/data\";\nimport { useDimensionFormatters } from \"@/formatters\";\nimport {\n  useDataCubesComponentsQuery,\n  useDataCubesMetadataQuery,\n  useDataCubesObservationsQuery,\n} from \"@/graphql/hooks\";\nimport { Icon } from \"@/icons\";\nimport SvgIcArrowRight from \"@/icons/components/IcArrowRight\";\nimport SvgIcClose from \"@/icons/components/IcClose\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useTransitionStore } from \"@/stores/transition\";\nimport { assert } from \"@/utils/assert\";\nimport { useEventEmitter } from \"@/utils/event-emitter\";\nimport { makeDimensionValueSorters } from \"@/utils/sorting-values\";\nimport { useEvent } from \"@/utils/use-event\";\n\nconst useDrawerStyles = makeStyles<Theme, { top: number | string }>((theme) => {\n  return {\n    root: {\n      position: \"static\",\n\n      \"& > .MuiPaper-root\": {\n        top: ({ top }) => top,\n        bottom: 0,\n        width: \"100%\",\n        maxWidth: DRAWER_WIDTH + 1,\n        height: \"auto\",\n        paddingLeft: theme.spacing(4),\n        paddingRight: theme.spacing(4),\n        borderRight: `1px solid ${theme.palette.divider}`,\n        boxShadow: \"none\",\n      },\n    },\n  };\n});\n\nconst useOtherStyles = makeStyles<Theme>((theme) => {\n  return {\n    toggleButton: {\n      minHeight: 0,\n      padding: 0,\n    },\n    header: {\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"space-between\",\n      marginTop: theme.spacing(6),\n      marginBottom: theme.spacing(4),\n    },\n    tabList: {\n      height: 40,\n      minHeight: 40,\n      marginBottom: theme.spacing(4),\n\n      \"& .MuiTab-root\": {\n        height: 40,\n        minHeight: 40,\n\n        \"&:not(.Mui-selected)\": {\n          color: theme.palette.grey[600],\n        },\n      },\n    },\n    tabPanel: {\n      padding: 0,\n      paddingBottom: theme.spacing(3),\n    },\n    tabPanelContent: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      gap: theme.spacing(4),\n    },\n    dimensionButton: {\n      textAlign: \"left\",\n      lineHeight: 1,\n      minHeight: \"auto\",\n      padding: 0,\n      fontWeight: \"bold\",\n\n      \"& > svg\": {\n        marginLeft: 0,\n      },\n    },\n    dimensionValues: {\n      flexDirection: \"column\",\n      gap: theme.spacing(2),\n      marginTop: theme.spacing(3),\n    },\n    search: {\n      marginBottom: \"0.25rem\",\n      \"& .MuiAutocomplete-inputRoot\": {\n        padding: `0px ${theme.spacing(3)}`,\n\n        \"& > .MuiAutocomplete-input\": {\n          padding: theme.spacing(2),\n        },\n      },\n    },\n    searchInputResultList: {\n      padding: 0,\n      border: `1px solid ${theme.palette.divider}`,\n      borderRadius: 3,\n    },\n    searchInputResult: {\n      justifyContent: \"space-between\",\n      borderBottom: `1px solid ${theme.palette.divider}`,\n\n      \"&:last-of-type\": {\n        borderBottom: \"none\",\n      },\n    },\n    openComponentInteractive: {\n      minHeight: 0,\n      verticalAlign: \"baseline\",\n      padding: 0,\n      margin: 0,\n      fontSize: \"inherit\",\n      color: theme.palette.primary.main,\n      textAlign: \"left\",\n      transition: \"opacity 0.2s ease-in-out\",\n    },\n    openComponentNonInteractive: {\n      position: \"relative\",\n      display: \"inline-flex\",\n      width: \"fit-content\",\n      fontSize: \"inherit\",\n      textAlign: \"left\",\n      lineHeight: 1.25,\n      color: theme.palette.grey[800],\n    },\n  };\n});\n\nconst animationProps: Transition = {\n  transition: {\n    duration: 0.2,\n  },\n  initial: {\n    opacity: 0,\n  },\n  animate: {\n    opacity: 1,\n  },\n  exit: {\n    opacity: 0,\n  },\n};\n\nexport const OpenMetadataPanelWrapper = ({\n  children,\n  component,\n}: {\n  children: ReactNode;\n  component?: Component;\n}) => {\n  const { embedParams } = useEmbedQueryParams();\n  const classes = useOtherStyles();\n  const { openComponent, setOpen, setActiveSection } =\n    useMetadataPanelStoreActions();\n  const handleClick = useEvent((e: MouseEvent) => {\n    e.stopPropagation();\n    if (component) {\n      openComponent(component);\n    } else {\n      setActiveSection(\"general\");\n      setOpen(true);\n    }\n  });\n\n  return embedParams.removeLabelsInteractivity ? (\n    <div className={classes.openComponentNonInteractive}>{children}</div>\n  ) : (\n    <Button\n      className={classes.openComponentInteractive}\n      variant=\"text\"\n      size=\"sm\"\n      color=\"primary\"\n      onClick={handleClick}\n    >\n      {children}\n    </Button>\n  );\n};\n\nexport const MetadataPanel = ({\n  chartConfig,\n  dashboardFilters,\n  dataSource,\n  components,\n  container,\n  top = 0,\n  allowMultipleOpen,\n  renderToggle = true,\n  smallerToggle,\n}: {\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  dataSource: DataSource;\n  components: Component[];\n  container?: HTMLDivElement | null;\n  top?: number | string;\n  allowMultipleOpen?: boolean;\n  renderToggle?: boolean;\n  smallerToggle?: boolean;\n}) => {\n  const router = useRouter();\n  const drawerClasses = useDrawerStyles({ top });\n  const otherClasses = useOtherStyles();\n  const { open, activeSection } = useMetadataPanelStore((state) => ({\n    open: state.open,\n    activeSection: state.activeSection,\n  }));\n  const setEnableTransition = useTransitionStore((state) => state.setEnable);\n  const { setOpen, toggle, setActiveSection, reset } =\n    useMetadataPanelStoreActions();\n  const ee = useEventEmitter(\"metadata-panel-opened\", () => {\n    if (open) {\n      setOpen(false);\n    }\n  });\n  const handleToggle = useEvent(() => {\n    toggle();\n    if (!allowMultipleOpen) {\n      ee.emit(\"metadata-panel-opened\", { datasetIri: \"\" });\n    }\n  });\n\n  // Close and reset the metadata panel when route has changed.\n  useEffect(() => {\n    const handleHashChange = () => {\n      setOpen(false);\n      reset();\n    };\n    router.events.on(\"hashChangeStart\", handleHashChange);\n    return () => {\n      router.events.off(\"hashChangeStart\", handleHashChange);\n    };\n  }, [setOpen, reset, router.events]);\n\n  const slideProps = useMemo(() => {\n    if (container) {\n      return {\n        onEnter: () => setEnableTransition(false),\n        onEntered: () => setEnableTransition(true),\n        onExit: () => setEnableTransition(false),\n        onExited: () => setEnableTransition(true),\n      };\n    }\n  }, [setEnableTransition, container]);\n\n  return (\n    <>\n      {renderToggle && (\n        <ToggleButton smaller={smallerToggle} onClick={handleToggle} />\n      )}\n      <Drawer\n        data-testid=\"panel-metadata\"\n        className={drawerClasses.root}\n        open={open}\n        anchor=\"left\"\n        hideBackdrop\n        disableEnforceFocus\n        ModalProps={{ container }}\n        PaperProps={{ style: { position: \"absolute\" } }}\n        SlideProps={slideProps}\n      >\n        <Header onClose={handleToggle} />\n        <TabContext value={activeSection}>\n          <TabList\n            className={otherClasses.tabList}\n            onChange={(_, v) => {\n              setActiveSection(v);\n            }}\n          >\n            <Tab\n              value=\"general\"\n              label={\n                <Typography>\n                  <Trans id=\"controls.metadata-panel.section.general\">\n                    General\n                  </Trans>\n                </Typography>\n              }\n            />\n            <Tab\n              value=\"data\"\n              label={\n                <Typography>\n                  <Trans id=\"controls.metadata-panel.section.data\">Data</Trans>\n                </Typography>\n              }\n            />\n          </TabList>\n          <AnimatePresence>\n            {activeSection === \"general\" ? (\n              <MotionBox key=\"cubes-panel\" {...animationProps}>\n                <CubesPanel\n                  dataSource={dataSource}\n                  chartConfig={chartConfig}\n                  dashboardFilters={dashboardFilters}\n                />\n              </MotionBox>\n            ) : activeSection === \"data\" ? (\n              <MotionBox key=\"data-panel\" {...animationProps}>\n                <DataPanel dataSource={dataSource} components={components} />\n              </MotionBox>\n            ) : null}\n          </AnimatePresence>\n        </TabContext>\n      </Drawer>\n    </>\n  );\n};\n\nconst ToggleButton = ({\n  smaller,\n  onClick,\n}: {\n  smaller?: boolean;\n  onClick: () => void;\n}) => {\n  const classes = useOtherStyles();\n\n  return (\n    <Button\n      data-testid=\"panel-metadata-toggle\"\n      className={classes.toggleButton}\n      variant=\"text\"\n      color=\"primary\"\n      size={smaller ? \"xs\" : \"sm\"}\n      onClick={onClick}\n    >\n      <Trans id=\"controls.metadata-panel.metadata\">Details</Trans>\n    </Button>\n  );\n};\n\nconst Header = ({ onClose }: { onClose: () => void }) => {\n  const classes = useOtherStyles();\n\n  return (\n    <div className={classes.header}>\n      <Typography variant=\"h6\" component=\"p\" sx={{ fontWeight: \"bold\" }}>\n        <Trans id=\"controls.metadata-panel.metadata\">Details</Trans>\n      </Typography>\n      <IconButton size=\"small\" onClick={onClose}>\n        <SvgIcClose />\n      </IconButton>\n    </div>\n  );\n};\n\nconst CubesPanel = ({\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n}: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n}) => {\n  const classes = useOtherStyles();\n  const locale = useLocale();\n  const cubes = chartConfig.cubes.map((cube) => ({ iri: cube.iri }));\n  const [\n    {\n      data: dataCubesMetadataData,\n      fetching: fetchingDataCubesMetadata,\n      error: dataCubesMetadataError,\n    },\n  ] = useDataCubesMetadataQuery({\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters: cubes,\n    },\n  });\n  const cubesMetadata = dataCubesMetadataData?.dataCubesMetadata;\n  const queryFilters = useQueryFilters({\n    chartConfig,\n    dashboardFilters,\n    componentIds: extractChartConfigComponentIds({ chartConfig }),\n  });\n  const [\n    { data: dataCubesObservationsData, error: dataCubesObservationsError },\n  ] = useDataCubesObservationsQuery({\n    chartConfig,\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters: queryFilters,\n    },\n  });\n  const cubesObservations = dataCubesObservationsData?.dataCubesObservations;\n\n  const error = dataCubesMetadataError || dataCubesObservationsError;\n\n  return (\n    <TabPanel className={classes.tabPanel} value=\"general\">\n      {fetchingDataCubesMetadata ? <Loading /> : null}\n      {error ? (\n        <Error>{`${error instanceof Error ? error.message : error}`}</Error>\n      ) : null}\n      <Stack divider={<Divider />} gap=\"1.5rem\">\n        {cubesMetadata?.map((cube) => {\n          const sparqlEditorUrl = cubesObservations?.sparqlEditorUrls?.find(\n            (x) => x.cubeIri === cube.iri\n          )?.url;\n          const cubeQueryFilters = queryFilters.find((f) => f.iri === cube.iri);\n          assert(cubeQueryFilters, \"Cube query filters not found\");\n          return (\n            <DatasetMetadata\n              key={cube.iri}\n              cube={cube}\n              showTitle\n              sparqlEditorUrl={sparqlEditorUrl}\n              dataSource={dataSource}\n              queryFilters={cubeQueryFilters}\n            />\n          );\n        })}\n      </Stack>\n    </TabPanel>\n  );\n};\n\nconst DataPanel = ({\n  dataSource,\n  components,\n}: {\n  dataSource: DataSource;\n  components: Component[];\n}) => {\n  const locale = useLocale();\n  const classes = useOtherStyles();\n  const selectedDimension = useMetadataPanelStore(\n    (state) => state.selectedComponent\n  );\n  const { setSelectedComponent, clearSelectedComponent } =\n    useMetadataPanelStoreActions();\n  const [inputValue, setInputValue] = useState(\"\");\n  const { options, groupedComponents } = useMemo(() => {\n    const options = components.flatMap(\n      (\n        component\n      ): {\n        label: string;\n        value: Component;\n        isJoinByDimension: boolean;\n      }[] => {\n        if (isJoinByComponent(component)) {\n          return (component.originalIds ?? []).map((x) => ({\n            label: getComponentLabel(component, { cubeIri: x.cubeIri }),\n            value: {\n              ...omit(component, \"originalIds\"),\n              cubeIri: x.cubeIri,\n              id: x.dimensionId,\n            } as unknown as Component,\n            isJoinByDimension: true,\n          }));\n        } else {\n          return [\n            {\n              label: component.label,\n              value: component,\n              isJoinByDimension: false,\n            },\n          ];\n        }\n      }\n    );\n    const groupedComponents = groupBy(\n      components.flatMap((component): Component[] => {\n        if (\"originalIds\" in component && component.originalIds) {\n          return (\n            component.originalIds.map((originalId) => ({\n              ...component,\n              cubeIri: originalId.cubeIri,\n              id: originalId.dimensionId,\n            })) ?? []\n          );\n        } else {\n          return [component];\n        }\n      }),\n      (x) => x.cubeIri\n    );\n\n    return { options, groupedComponents };\n  }, [components]);\n  const [metadataQuery] = useDataCubesMetadataQuery({\n    variables: {\n      locale: locale,\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      cubeFilters: Object.keys(groupedComponents).map((iri) => ({ iri })),\n    },\n    keepPreviousData: true,\n  });\n  const dataCubesMetadata = metadataQuery.data?.dataCubesMetadata;\n  const cubesByIri = useMemo(\n    () => keyBy(dataCubesMetadata, (x) => x.iri),\n    [dataCubesMetadata]\n  );\n  const sortedOptions = useMemo(\n    () => sortBy(options, (x) => cubesByIri[x.value.cubeIri]?.title),\n    [options, cubesByIri]\n  );\n\n  return (\n    <TabPanel className={classes.tabPanel} value=\"data\">\n      <AnimatePresence mode=\"wait\">\n        {selectedDimension ? (\n          <MotionBox key=\"dimension-selected\" {...animationProps}>\n            <BackButton onClick={clearSelectedComponent}>\n              <Trans id=\"button.back\">Back</Trans>\n            </BackButton>\n            <Box sx={{ mt: 4 }}>\n              <ComponentTabPanel\n                component={selectedDimension}\n                expanded\n                dataSource={dataSource}\n              />\n            </Box>\n          </MotionBox>\n        ) : (\n          <MotionBox\n            key=\"dimension-not-selected\"\n            className={classes.tabPanelContent}\n            {...animationProps}\n          >\n            <Autocomplete\n              className={classes.search}\n              disablePortal\n              onChange={(_, v) => v && setSelectedComponent(v.value)}\n              inputValue={inputValue}\n              onInputChange={(_, v) => setInputValue(v.toLowerCase())}\n              options={sortedOptions}\n              groupBy={(x) => cubesByIri[x.value.cubeIri]?.title ?? \"\"}\n              ListboxProps={{ className: classes.searchInputResultList }}\n              renderInput={(params) => (\n                <TextField\n                  {...params}\n                  className={classes.search}\n                  placeholder={t({\n                    id: \"select.controls.metadata.search\",\n                    message: \"Jump to...\",\n                  })}\n                  InputProps={{\n                    ...params.InputProps,\n                    endAdornment: (\n                      <InputAdornment position=\"start\">\n                        <Icon name=\"search\" />\n                      </InputAdornment>\n                    ),\n                    sx: { pr: \"0 !important\", typography: \"h6\" },\n                  }}\n                />\n              )}\n              renderOption={(props, option, { inputValue }) => {\n                const matches = match(option.label, inputValue, {\n                  insideWords: true,\n                });\n                const parts = parse(option.label, matches);\n\n                return (\n                  <MenuItem\n                    {...props}\n                    className={clsx(props.className, classes.searchInputResult)}\n                  >\n                    {parts.map(({ text, highlight }, i) => (\n                      <Typography\n                        key={i}\n                        variant=\"body3\"\n                        component=\"span\"\n                        flexGrow={1}\n                        style={{\n                          fontWeight: highlight ? 700 : 400,\n                          textOverflow: \"ellipsis\",\n                          overflow: \"hidden\",\n                        }}\n                      >\n                        {text}\n                      </Typography>\n                    ))}\n                    {option.isJoinByDimension ? (\n                      <JoinByChip\n                        label={<Trans id=\"dimension.joined\">Joined</Trans>}\n                      />\n                    ) : (\n                      \"\"\n                    )}\n                  </MenuItem>\n                );\n              }}\n              clearIcon={null}\n            />\n            <Stack spacing={4} divider={<Divider />}>\n              {Object.entries(groupedComponents).map(\n                ([cubeIri, components]) => {\n                  const cube = cubesByIri[cubeIri];\n                  if (!cube) {\n                    return null;\n                  }\n\n                  return (\n                    <div key={cubeIri}>\n                      {dataCubesMetadata && dataCubesMetadata.length > 1 ? (\n                        <Typography variant=\"h5\" component=\"p\" sx={{ mb: 6 }}>\n                          {cube.title}\n                        </Typography>\n                      ) : null}\n                      <Stack gap={6}>\n                        {components.map((component) => (\n                          <ComponentTabPanel\n                            key={component.id}\n                            component={component}\n                            cubeIri={cubeIri}\n                            expanded={false}\n                            dataSource={dataSource}\n                          />\n                        ))}\n                      </Stack>\n                    </div>\n                  );\n                }\n              )}\n            </Stack>\n          </MotionBox>\n        )}\n      </AnimatePresence>\n    </TabPanel>\n  );\n};\n\nconst ComponentTabPanel = ({\n  component,\n  dataSource,\n  expanded,\n  cubeIri,\n}: {\n  component: Component;\n  dataSource: DataSource;\n  expanded: boolean;\n  cubeIri?: string;\n}) => {\n  const [state] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n  const classes = useOtherStyles();\n  const { setSelectedComponent } = useMetadataPanelStoreActions();\n  const label = useMemo(\n    () => getComponentLabel(component, { cubeIri }),\n    [cubeIri, component]\n  );\n  const description = useMemo(() => {\n    const description = getComponentDescription(component, cubeIri);\n    if (!expanded && description && description.length > 180) {\n      return `${description.slice(0, 180)}`;\n    }\n    return description;\n  }, [cubeIri, component, expanded]);\n\n  const locale = useLocale();\n  const cubesIri = useMemo(() => {\n    return isJoinByComponent(component)\n      ? component.originalIds.map((x) => x.cubeIri)\n      : [component.cubeIri];\n  }, [component]);\n  const [cubesQuery] = useDataCubesMetadataQuery({\n    variables: {\n      locale,\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      cubeFilters: cubesIri.map((iri) => ({ iri })),\n    },\n  });\n  const cubesByIri = useMemo(\n    () => keyBy(cubesQuery.data?.dataCubesMetadata, (x) => x.iri),\n    [cubesQuery.data?.dataCubesMetadata]\n  );\n  const [{ data: componentsData, fetching: fetchingComponents }] =\n    useDataCubesComponentsQuery({\n      chartConfig,\n      variables: {\n        cubeFilters: [\n          {\n            iri: component.cubeIri,\n            loadValues: true,\n            componentIds: [component.id],\n          },\n        ],\n        locale,\n        sourceType: dataSource.type,\n        sourceUrl: dataSource.url,\n      },\n      pause: !expanded,\n    });\n  const loadedComponent = useMemo(() => {\n    return [\n      ...(componentsData?.dataCubesComponents.dimensions ?? []),\n      ...(componentsData?.dataCubesComponents.measures ?? []),\n    ].find((d) => component.id === d.id);\n  }, [\n    componentsData?.dataCubesComponents.dimensions,\n    componentsData?.dataCubesComponents.measures,\n    component.id,\n  ]);\n\n  const handleClick = useCallback(() => {\n    if (!expanded) {\n      setSelectedComponent(component);\n    }\n  }, [expanded, component, setSelectedComponent]);\n\n  return (\n    <div>\n      <Flex sx={{ justifyContent: \"space-between\" }}>\n        <div>\n          <Box display=\"flex\" alignItems=\"center\" gap={2}>\n            <Button\n              className={classes.dimensionButton}\n              variant=\"text\"\n              size=\"sm\"\n              onClick={handleClick}\n              sx={{\n                cursor: !expanded ? \"pointer\" : \"default\",\n\n                \"&:hover\": {\n                  color: !expanded ? \"primary.main\" : \"text.primary\",\n                },\n              }}\n            >\n              {label}\n            </Button>\n            {isJoinByComponent(component) ? (\n              <>\n                <JoinByChip\n                  label={<Trans id=\"dimension.joined\">Joined</Trans>}\n                />\n                <InfoIconTooltip\n                  title={\n                    <Trans id=\"dimension.joined-info-icon\">\n                      Joined dimensions integrate data from multiple datasets\n                    </Trans>\n                  }\n                  placement=\"top-end\"\n                />\n              </>\n            ) : null}\n          </Box>\n          {description && (\n            <Typography variant=\"body3\" component=\"p\" sx={{ mt: 1 }}>\n              {description}\n            </Typography>\n          )}\n        </div>\n      </Flex>\n      <AnimatePresence>\n        {expanded && loadedComponent && loadedComponent.values.length > 0 && (\n          <MotionBox\n            key=\"dimension-values\"\n            className={classes.dimensionValues}\n            {...animationProps}\n          >\n            {isJoinByComponent(component) ? (\n              <div>\n                <Typography variant=\"h5\" gutterBottom>\n                  Joined with\n                </Typography>\n                {component.originalIds.map((x) =>\n                  x.cubeIri === loadedComponent.cubeIri ? null : (\n                    <div key={x.cubeIri}>\n                      <Typography variant=\"body2\">\n                        {x.label} ({cubesByIri[x.cubeIri]?.title})\n                      </Typography>\n                    </div>\n                  )\n                )}\n              </div>\n            ) : null}\n            <Typography variant=\"body3\" sx={{ my: 2, fontWeight: 700 }}>\n              <Trans id=\"controls.metadata-panel.available-values\">\n                Available values\n              </Trans>\n            </Typography>\n            {fetchingComponents ? (\n              <Box sx={{ mt: 6 }}>\n                <Loading delayMs={0} />\n              </Box>\n            ) : (\n              <ComponentValues component={loadedComponent} />\n            )}\n          </MotionBox>\n        )}\n      </AnimatePresence>\n      {!expanded && (\n        <Button\n          component=\"a\"\n          variant=\"text\"\n          size=\"sm\"\n          color=\"primary\"\n          onClick={handleClick}\n          endIcon={<SvgIcArrowRight />}\n          sx={{ p: 0 }}\n        >\n          <Trans id=\"controls.metadata-panel.show-more\">Show more</Trans>\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst ComponentValues = ({ component }: { component: Component }) => {\n  const sortedValues = useMemo(() => {\n    const sorters = makeDimensionValueSorters(component);\n    return orderBy(\n      component.values,\n      sorters.map((s) => (dv) => s(dv.label))\n    ) as DimensionValue[];\n  }, [component]);\n\n  if (\n    isStandardErrorDimension(component) ||\n    isConfidenceUpperBoundDimension(component) ||\n    isConfidenceLowerBoundDimension(component)\n  ) {\n    return <MeasureValuesNumeric values={sortedValues} />;\n  }\n\n  switch (component.__typename) {\n    case \"NominalDimension\":\n    case \"OrdinalDimension\":\n    case \"TemporalEntityDimension\":\n    case \"TemporalOrdinalDimension\":\n    case \"OrdinalMeasure\":\n    case \"GeoCoordinatesDimension\":\n    case \"GeoShapesDimension\":\n      return <DimensionValuesNominal values={sortedValues} />;\n    case \"NumericalMeasure\":\n      return sortedValues.length > 0 ? (\n        <MeasureValuesNumeric values={sortedValues} />\n      ) : null;\n    case \"TemporalDimension\":\n      return <DimensionValuesTemporal dim={component} values={sortedValues} />;\n    default:\n      const _exhaustiveCheck: never = component;\n      return _exhaustiveCheck;\n  }\n};\n\nconst DimensionValuesNominal = ({ values }: { values: DimensionValue[] }) => {\n  return (\n    <>\n      {values.map((d) =>\n        d.label ? (\n          <Fragment key={d.value}>\n            <Typography variant=\"body3\" component=\"p\" {...animationProps}>\n              {d.label}{\" \"}\n              {d.alternateName ? (\n                <span style={{ fontStyle: \"italic\" }}>({d.alternateName})</span>\n              ) : (\n                \"\"\n              )}\n            </Typography>\n            {d.description ? (\n              <Typography variant=\"body3\" component=\"p\">\n                {d.description}\n              </Typography>\n            ) : null}\n          </Fragment>\n        ) : null\n      )}\n    </>\n  );\n};\n\nconst MeasureValuesNumeric = ({ values }: { values: DimensionValue[] }) => {\n  const [min, max] = [values[0].value, values[values.length - 1].value];\n\n  return (\n    <>\n      <Typography variant=\"body3\" component=\"p\">\n        Min: {min}\n      </Typography>\n      <Typography variant=\"body3\" component=\"p\">\n        Max: {max}\n      </Typography>\n    </>\n  );\n};\n\nconst DimensionValuesTemporal = ({\n  dim,\n  values,\n}: {\n  dim: TemporalDimension;\n  values: DimensionValue[];\n}) => {\n  const formatters = useDimensionFormatters([dim]);\n  const format = formatters[dim.id];\n  const [min, max] = [values[0].value, values[values.length - 1].value];\n\n  return (\n    <>\n      <Typography variant=\"body3\" component=\"p\">\n        Min: {format(min)}\n      </Typography>\n      <Typography variant=\"body3\" component=\"p\">\n        Max: {format(max)}\n      </Typography>\n    </>\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport { AutocompleteRenderInputParams, TextField } from \"@mui/material\";\nimport { ComponentProps } from \"react\";\n\nimport { MultiSelect } from \"@/components/multi-select\";\n\nexport const MultiSelectInput = ({\n  params,\n  value,\n  placeholder,\n  variant,\n  size,\n  onClick,\n}: {\n  params: AutocompleteRenderInputParams;\n  value: string[];\n  placeholder?: string;\n  variant: ComponentProps<typeof MultiSelect>[\"variant\"];\n  size: ComponentProps<typeof MultiSelect>[\"size\"];\n  onClick: () => void;\n}) => {\n  const noneLabel = t({ id: \"controls.none\", message: \"None\" });\n\n  return (\n    <TextField\n      {...params}\n      placeholder={value.length === 0 ? (placeholder ?? noneLabel) : undefined}\n      variant={variant}\n      onClick={onClick}\n      inputProps={{\n        ...params.inputProps,\n        onClick: undefined,\n        readOnly: true,\n        size,\n        sx: {\n          width: 0,\n          minWidth: \"0px !important\",\n          p: 0,\n\n          \"&::placeholder\": {\n            opacity: 1,\n          },\n        },\n      }}\n      sx={{ p: 0 }}\n    />\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport {\n  AutocompleteRenderOptionState,\n  ListSubheader,\n  MenuItem,\n  MenuItemProps,\n  Typography,\n} from \"@mui/material\";\nimport { ComponentProps } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport {\n  DisabledMessageIcon,\n  SelectOption,\n  selectSizeToTypography,\n} from \"@/components/form\";\nimport { MultiSelect } from \"@/components/multi-select\";\nimport { Icon } from \"@/icons\";\n\nexport const MultiSelectOption = ({\n  props,\n  option: {\n    isGroupHeader,\n    isNoneValue,\n    value,\n    label,\n    disabled,\n    disabledMessage,\n  },\n  state,\n  size,\n  width,\n}: {\n  props: MenuItemProps;\n  option: SelectOption;\n  state: AutocompleteRenderOptionState;\n  size: NonNullable<ComponentProps<typeof MultiSelect>[\"size\"]>;\n  width: number;\n}) => {\n  if (!value && !isGroupHeader) {\n    return null;\n  }\n\n  return isGroupHeader ? (\n    label && (\n      <ListSubheader key={label}>\n        <Typography variant=\"caption\" component=\"p\" style={{ maxWidth: width }}>\n          {label}\n        </Typography>\n      </ListSubheader>\n    )\n  ) : (\n    <MenuItem\n      {...props}\n      key={value}\n      disabled={disabled}\n      value={value ?? undefined}\n      sx={{\n        display: \"flex\",\n        justifyContent: \"space-between !important\",\n        alignItems: \"center\",\n        gap: 1,\n        borderBottom: (t) =>\n          isNoneValue ? `1px solid ${t.palette.divider}` : \"none\",\n        typography: selectSizeToTypography[size],\n      }}\n    >\n      <Typography\n        sx={{\n          overflow: \"hidden\",\n          textOverflow: \"ellipsis\",\n          whiteSpace: \"nowrap\",\n          flex: 1,\n          typography: selectSizeToTypography[size],\n        }}\n      >\n        {isNoneValue\n          ? t({ id: \"controls.clear-selection\", message: \"Clear selection\" })\n          : label}\n      </Typography>\n      <Flex\n        sx={{\n          justifyContent: \"flex-end\",\n          alignItems: \"center\",\n          gap: 1,\n          minWidth: 24,\n          minHeight: 20,\n        }}\n      >\n        {disabledMessage ? (\n          <DisabledMessageIcon message={disabledMessage} />\n        ) : null}\n        {state.selected ? <Icon name=\"checkmark\" size={20} /> : null}\n      </Flex>\n    </MenuItem>\n  );\n};\n","import {\n  AutocompleteRenderGetTagProps,\n  Box,\n  Chip,\n  Typography,\n} from \"@mui/material\";\nimport { ComponentProps } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport {\n  DisabledMessageIcon,\n  SelectOption,\n  selectSizeToTypography,\n} from \"@/components/form\";\nimport { MultiSelect } from \"@/components/multi-select\";\nimport { Icon } from \"@/icons\";\n\nexport const MultiSelectTags = ({\n  options,\n  getTagProps,\n  size,\n}: {\n  options: SelectOption[];\n  getTagProps: AutocompleteRenderGetTagProps;\n  size: NonNullable<ComponentProps<typeof MultiSelect>[\"size\"]>;\n}) => {\n  return (\n    <Flex\n      sx={{\n        flexWrap: \"nowrap\",\n        overflowX: \"auto\",\n        maxWidth: \"100%\",\n        pl: 4,\n        pr: 14,\n        py: 1,\n      }}\n    >\n      {options.map((option, index) => (\n        <Chip\n          {...getTagProps({ index })}\n          key={option.value}\n          label={\n            <Box\n              sx={{\n                display: \"inline-flex\",\n                alignItems: \"center\",\n                gap: 0.5,\n                maxWidth: \"100%\",\n                overflow: \"hidden\",\n              }}\n            >\n              <Typography\n                variant={selectSizeToTypography[size]}\n                sx={{\n                  lineHeight: 1,\n                  overflow: \"hidden\",\n                  textOverflow: \"ellipsis\",\n                  whiteSpace: \"nowrap\",\n                  minWidth: 0,\n                }}\n              >\n                {option.label}\n              </Typography>\n              {option.disabledMessage ? (\n                <DisabledMessageIcon message={option.disabledMessage} />\n              ) : null}\n            </Box>\n          }\n          deleteIcon={<Icon name=\"close\" size={16} />}\n          size=\"small\"\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n          }}\n          sx={{\n            maxWidth: \"100% !important\",\n            height: \"fit-content\",\n            mr: 0.5,\n            px: 1,\n            py: 0.75,\n            backgroundColor: \"#F0F4F7\",\n\n            \"&:hover\": {\n              backgroundColor: \"cobalt.100\",\n            },\n\n            \"& .MuiChip-deleteIcon\": {\n              color: \"text.primary\",\n              transition: \"color 0.2s ease\",\n            },\n          }}\n        />\n      ))}\n    </Flex>\n  );\n};\n","\"use client\";\n\nimport { Grow, Popper, PopperProps } from \"@mui/material\";\nimport { useEffect, useRef, useState } from \"react\";\n\nexport const TransitionPopper = ({\n  children,\n  open,\n  anchorX,\n  anchorY,\n  ...rest\n}: PopperProps & {\n  anchorX: number;\n  anchorY: number;\n}): JSX.Element => {\n  const [isClosing, setIsClosing] = useState(false);\n  const childrenRef = useRef<typeof children>();\n\n  // Make sure the children do not disappear mid-transition.\n  useEffect(() => {\n    if (open) {\n      setIsClosing(false);\n      childrenRef.current = children;\n    }\n  }, [children, open]);\n\n  return (\n    <Popper\n      open={open}\n      keepMounted\n      modifiers={[\n        ...modifiers,\n        // Mirroring default Select's behavior.\n        {\n          name: \"computeTransformOrigin\",\n          enabled: true,\n          phase: \"write\",\n          fn: ({\n            state,\n          }: {\n            state: { elements: { popper: HTMLElement | undefined } };\n          }) => {\n            const el = state.elements.popper;\n\n            if (!el) {\n              return;\n            }\n\n            const { left, top, width, height } = el.getBoundingClientRect();\n            const x = Math.max(0, Math.min(anchorX - left, width));\n            const y = Math.max(0, Math.min(anchorY - top, height));\n\n            el.style.setProperty(\"--transform-origin\", `${x}px ${y}px`);\n          },\n        },\n      ]}\n      {...rest}\n      transition\n    >\n      {({ TransitionProps }) => (\n        <Grow\n          {...TransitionProps}\n          onExit={() => setIsClosing(true)}\n          style={{ transformOrigin: `var(--transform-origin)` }}\n        >\n          <div>{isClosing ? childrenRef.current : children}</div>\n        </Grow>\n      )}\n    </Popper>\n  );\n};\n\nconst modifiers: NonNullable<PopperProps[\"modifiers\"]> = [\n  {\n    name: \"flip\",\n    enabled: false,\n  },\n  {\n    name: \"preventOverflow\",\n    enabled: true,\n    options: {\n      boundary: \"viewport\",\n      altBoundary: true,\n      padding: 8,\n      tether: true,\n      mainAxis: true,\n      altAxis: true,\n    },\n  },\n];\n","import {\n  Autocomplete,\n  Box,\n  CircularProgress,\n  ClickAwayListener,\n  SxProps,\n  Typography,\n} from \"@mui/material\";\nimport { PopperProps } from \"@mui/material/Popper\";\nimport flatten from \"lodash/flatten\";\nimport { ReactNode, useCallback, useMemo, useRef, useState } from \"react\";\n\nimport {\n  getSelectOptions,\n  Label,\n  SelectOption,\n  SelectOptionGroup,\n  selectSizeToTypography,\n} from \"@/components/form\";\nimport { MultiSelectInput } from \"@/components/multi-select/input\";\nimport { MultiSelectOption } from \"@/components/multi-select/option\";\nimport { MultiSelectTags } from \"@/components/multi-select/tags\";\nimport { TransitionPopper } from \"@/components/multi-select/transition-popper\";\nimport { truthy } from \"@/domain/types\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const MultiSelect = ({\n  id,\n  label,\n  options,\n  optionGroups,\n  value,\n  onChange,\n  disabled,\n  loading,\n  hint,\n  placeholder,\n  size = \"md\",\n  variant = \"outlined\",\n  sort = true,\n  sideControls,\n  sx,\n}: {\n  id: string;\n  options: SelectOption[];\n  optionGroups?: SelectOptionGroup[];\n  value: string[];\n  onChange: (values: string[]) => void;\n  label?: ReactNode;\n  disabled?: boolean;\n  loading?: boolean;\n  hint?: string;\n  placeholder?: string;\n  size?: \"xs\" | \"sm\" | \"md\" | \"lg\" | \"xl\";\n  variant?: \"outlined\" | \"filled\" | \"standard\";\n  sort?: boolean;\n  sideControls?: ReactNode;\n  sx?: SxProps;\n}) => {\n  const [open, setOpen] = useState(false);\n  const ref = useRef<HTMLDivElement>(null);\n  const [width, setWidth] = useState(0);\n  const locale = useLocale();\n  const [anchorX, setAnchorX] = useState(0);\n  const [anchorY, setAnchorY] = useState(0);\n  const setDimensions = useEvent(() => {\n    const el = ref.current;\n\n    if (!el) {\n      return;\n    }\n\n    const rect = el.getBoundingClientRect();\n    setWidth(rect.width);\n    setAnchorX(rect.left + rect.width / 2);\n    setAnchorY(rect.bottom);\n  });\n\n  const normalizedOptions = useMemo<SelectOption[]>(() => {\n    if (optionGroups && optionGroups.length > 0) {\n      return flatten(\n        optionGroups.map(([group, values]) => {\n          const normalized = getSelectOptions(values, { sort, locale }).map(\n            (o) => ({\n              ...o,\n              group: group?.label,\n            })\n          );\n\n          return normalized;\n        })\n      );\n    }\n\n    return getSelectOptions(options, { sort, locale });\n  }, [optionGroups, sort, locale, options]);\n\n  const valueOptions = useMemo(() => {\n    const map = new Map(normalizedOptions.map((o) => [o.value, o]));\n    return value.map((v) => map.get(v)).filter(truthy);\n  }, [value, normalizedOptions]);\n\n  const StableTransitionPopper = useCallback(\n    (props: PopperProps) => {\n      return (\n        <TransitionPopper {...props} anchorX={anchorX} anchorY={anchorY} />\n      );\n    },\n    [anchorX, anchorY]\n  );\n\n  return (\n    <ClickAwayListener onClickAway={() => setOpen(false)}>\n      <Box ref={ref} sx={{ width: \"100%\", ...sx }}>\n        {label && (\n          <Label\n            htmlFor={id}\n            sx={{ display: \"flex\", alignItems: \"center\", mb: 1 }}\n          >\n            {label}\n            {loading && (\n              <CircularProgress\n                size={12}\n                sx={{ display: \"inline-block\", marginLeft: 2 }}\n              />\n            )}\n          </Label>\n        )}\n        <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\n          <Autocomplete\n            id={id}\n            open={open}\n            onOpen={setDimensions}\n            options={normalizedOptions}\n            value={valueOptions}\n            onChange={(_, newValue) => {\n              if (newValue.some((o) => o.isNoneValue)) {\n                onChange([]);\n              } else {\n                onChange(newValue.map((o) => o.value));\n              }\n            }}\n            disabled={disabled}\n            multiple\n            disableCloseOnSelect\n            disableClearable\n            groupBy={\n              optionGroups && optionGroups.length > 0\n                ? (o) => o.group ?? \"\"\n                : undefined\n            }\n            getOptionLabel={(o) => o.label}\n            isOptionEqualToValue={(o, v) => o.value === v.value}\n            getOptionDisabled={(o) => !!o.disabled}\n            PopperComponent={StableTransitionPopper}\n            renderOption={(props, option, state) => {\n              return (\n                <MultiSelectOption\n                  props={props}\n                  option={option}\n                  state={state}\n                  size={size}\n                  width={width}\n                />\n              );\n            }}\n            renderTags={(options, getTagProps) => {\n              return (\n                <MultiSelectTags\n                  options={options}\n                  getTagProps={getTagProps}\n                  size={size}\n                />\n              );\n            }}\n            renderInput={(params) => {\n              return (\n                <MultiSelectInput\n                  params={params}\n                  value={value}\n                  placeholder={placeholder}\n                  variant={variant}\n                  size={size}\n                  onClick={() => setOpen(!open)}\n                />\n              );\n            }}\n            sx={{\n              \"& .MuiInputBase-root > .MuiInputBase-input\": {\n                pl: value.length === 0 ? 5 : 1,\n                typography: selectSizeToTypography[size],\n              },\n            }}\n          />\n          {sideControls}\n        </Box>\n        {hint ? (\n          <Box sx={{ mt: 0.5 }}>\n            <Typography variant=\"caption\" color=\"text.secondary\">\n              {hint}\n            </Typography>\n          </Box>\n        ) : null}\n      </Box>\n    </ClickAwayListener>\n  );\n};\n","import { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport isEqual from \"lodash/isEqual\";\nimport map from \"lodash/map\";\nimport mapValues from \"lodash/mapValues\";\nimport range from \"lodash/range\";\nimport { ComponentProps, useEffect, useState } from \"react\";\nimport { Layout, Responsive, WidthProvider } from \"react-grid-layout\";\nimport { match } from \"ts-pattern\";\n\nimport { useStyles as useChartContainerStyles } from \"@/charts/shared/containers\";\nimport { getChartWrapperId } from \"@/components/chart-panel\";\nimport {\n  hasChartConfigs,\n  isLayouting,\n  LayoutBlock,\n  ReactGridLayoutType,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { theme } from \"@/themes/theme\";\nimport { assert } from \"@/utils/assert\";\nimport { useTimeout } from \"@/utils/use-timeout\";\n\nconst ResponsiveReactGridLayout = WidthProvider(Responsive);\n\ntype ResizeHandle = NonNullable<Layout[\"resizeHandles\"]>[number];\nexport type GridLayout = \"horizontal\" | \"vertical\" | \"wide\" | \"tall\";\n\nexport const availableHandlesByBlockType: Record<\n  LayoutBlock[\"type\"],\n  ResizeHandle[]\n> = {\n  chart: [\"s\", \"w\", \"e\", \"n\", \"sw\", \"nw\", \"se\", \"ne\"],\n  text: [\"w\", \"e\"],\n};\n\n/** In grid unit */\nconst MAX_H = 10;\n\nconst INITIAL_H = 7;\nexport const MIN_H = 1;\n\n/** In grid unit */\nconst MAX_W = 4;\n\nexport const COLS = { xl: 4, lg: 3, md: 2, sm: 1 };\nexport const FREE_CANVAS_BREAKPOINTS = {\n  xl: theme.breakpoints.values.md,\n  lg: theme.breakpoints.values.sm,\n  md: 480,\n  sm: 0,\n};\nexport const ROW_HEIGHT = 100;\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  root: {\n    position: \"relative\",\n    \"& .react-grid-layout\": {\n      position: \"relative\",\n      transition: \"height 200ms ease\",\n      minHeight: \"initial\",\n\n      // Customization\n      background: \"#eee\",\n      marginTop: \"10px\",\n    },\n    \"& .react-grid-item\": {\n      transition: \"all 200ms ease\",\n      transitionProperty: \"none\",\n\n      // Customization\n      boxSizing: \"border-box\",\n    },\n    \"& .react-grid-item img\": {\n      pointerEvents: \"none\",\n      userSelect: \"none\",\n    },\n    \"& .react-grid-item.cssTransforms\": {\n      transitionProperty: \"none\",\n    },\n    \"& .react-grid-item.resizing\": {\n      transition: \"none\",\n      zIndex: 1,\n      willChange: \"width, height\",\n\n      // Customization\n      opacity: 0.9,\n    },\n    \"& .react-grid-item.react-draggable-dragging\": {\n      transition: \"none\",\n      zIndex: 3,\n      willChange: \"transform\",\n    },\n    \"& .react-grid-item.dropping\": {\n      visibility: \"hidden\",\n    },\n    \"& .react-grid-item.react-grid-placeholder\": {\n      background: theme.palette.primary.main,\n      opacity: 0.2,\n      transitionDuration: \"100ms\",\n      zIndex: 2,\n      \"-webkit-user-select\": \"none\",\n      \"-moz-user-select\": \"none\",\n      \"-ms-user-select\": \"none\",\n      \"-o-user-select\": \"none\",\n      userSelect: \"none\",\n    },\n    \"& .react-grid-item.react-grid-placeholder.placeholder-resizing\": {\n      transition: \"none\",\n    },\n    \"& .react-grid-item .react-resizable-handle\": {\n      position: \"absolute\",\n      width: \"20px\",\n      height: \"20px\",\n    },\n    \"& .react-grid-item .react-resizable-handle::after\": {\n      content: '\"\"',\n      position: \"absolute\",\n      right: \"3px\",\n      bottom: \"3px\",\n      width: \"5px\",\n      height: \"5px\",\n      borderRight: \"2px solid rgba(0, 0, 0, 0.4)\",\n      borderBottom: \"2px solid rgba(0, 0, 0, 0.4)\",\n    },\n    \"& .react-resizable-hide .react-resizable-handle\": {\n      display: \"none\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-sw\": {\n      bottom: \"0\",\n      left: \"0\",\n      cursor: \"sw-resize\",\n      transform: \"rotate(90deg)\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-se\": {\n      bottom: \"0\",\n      right: \"0\",\n      cursor: \"se-resize\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-nw\": {\n      top: \"0\",\n      left: \"0\",\n      cursor: \"nw-resize\",\n      transform: \"rotate(180deg)\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-ne\": {\n      top: \"0\",\n      right: \"0\",\n      cursor: \"ne-resize\",\n      transform: \"rotate(270deg)\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-w, & .react-grid-item .react-resizable-handle.react-resizable-handle-e\":\n      {\n        top: \"50%\",\n        marginTop: \"-10px\",\n        cursor: \"ew-resize\",\n      },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-w\": {\n      left: \"0\",\n      transform: \"rotate(135deg)\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-e\": {\n      right: \"0\",\n      transform: \"rotate(315deg)\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-n, & .react-grid-item .react-resizable-handle.react-resizable-handle-s\":\n      {\n        left: \"50%\",\n        marginLeft: \"-10px\",\n        cursor: \"ns-resize\",\n      },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-n\": {\n      top: \"0\",\n      transform: \"rotate(225deg)\",\n    },\n    \"& .react-grid-item .react-resizable-handle.react-resizable-handle-s\": {\n      bottom: \"0\",\n      transform: \"rotate(45deg)\",\n    },\n    \"& .react-grid-item:not(.react-grid-placeholder)\": {\n      border: theme.palette.divider,\n      boxShadow: theme.shadows[1],\n    },\n    \"& .react-grid-item.static\": {\n      background: \"#cce\",\n    },\n    \"& .react-grid-item .text\": {\n      fontSize: \"24px\",\n      textAlign: \"center\",\n      position: \"absolute\",\n      top: \"0\",\n      bottom: \"0\",\n      left: \"0\",\n      right: \"0\",\n      margin: \"auto\",\n      height: \"24px\",\n    },\n    \"& .react-grid-item .minMax\": {\n      fontSize: \"12px\",\n    },\n    \"& .react-grid-item .add\": {\n      cursor: \"pointer\",\n    },\n    \"& .react-grid-dragHandleExample\": {\n      cursor: \"move\",\n    },\n  },\n}));\n\nexport const CHART_GRID_MIN_HEIGHT = 150;\n\nexport const ChartGridLayout = ({\n  children,\n  className,\n  layouts,\n  resize,\n  ...rest\n}: {\n  className: string;\n  resize?: boolean;\n} & ComponentProps<typeof ResponsiveReactGridLayout>) => {\n  const classes = useStyles();\n\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const layout = state.layout;\n  assert(\n    layout.type === \"dashboard\" && layout.layout === \"canvas\",\n    \"ChartGridLayout can only be used in a canvas layout!\"\n  );\n  const allowHeightInitialization = isLayouting(state);\n  const [mounted, setMounted] = useState(false);\n  const mountedForSomeTime = useTimeout(500, mounted);\n  const chartContainerClasses = useChartContainerStyles();\n  const [enhancedLayouts, setEnhancedLayouts] = useState(() => {\n    if (!layouts) {\n      return {};\n    }\n\n    return mapValues(layouts, (chartLayouts) => {\n      return chartLayouts.map((chartLayout) => {\n        const block = layout.blocks.find(\n          (block) => block.key === chartLayout.i\n        );\n\n        return {\n          ...chartLayout,\n          maxW: MAX_W,\n          w: Math.min(MAX_W, chartLayout.w),\n          resizeHandles:\n            resize && block ? availableHandlesByBlockType[block.type] : [],\n          minH: chartLayout.minH ?? MIN_H,\n          h: Math.max(MIN_H, chartLayout.h),\n        };\n      });\n    });\n  });\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  useEffect(() => {\n    if (!mountedForSomeTime || !allowHeightInitialization) {\n      return;\n    }\n\n    const newLayouts = Object.fromEntries(\n      Object.entries(enhancedLayouts).map(([breakpoint, chartLayouts]) => {\n        return [\n          breakpoint,\n          chartLayouts.map((chartLayout) => {\n            const block = layout.blocks.find(\n              (block) => block.key === chartLayout.i\n            );\n\n            if (block?.initialized) {\n              return chartLayout;\n            }\n\n            let minH = MIN_H;\n\n            const chartKey = chartLayout.i;\n            const wrapper: HTMLDivElement | null = document.querySelector(\n              `#${getChartWrapperId(chartKey)}`\n            );\n\n            if (wrapper) {\n              const chartContainer: HTMLDivElement | null =\n                wrapper.querySelector(\n                  `.${chartContainerClasses.chartContainer}`\n                );\n\n              if (chartContainer) {\n                const minWrapperHeight =\n                  wrapper.scrollHeight -\n                  chartContainer.clientHeight +\n                  CHART_GRID_MIN_HEIGHT;\n                minH = Math.max(\n                  MIN_H,\n                  Math.ceil(minWrapperHeight / ROW_HEIGHT)\n                );\n              }\n            }\n\n            return {\n              ...chartLayout,\n              maxW: MAX_W,\n              w: Math.min(MAX_W, chartLayout.w),\n              resizeHandles:\n                resize && block ? availableHandlesByBlockType[block.type] : [],\n              minH,\n              h: minH,\n            };\n          }),\n        ];\n      })\n    );\n\n    if (!isEqual(newLayouts, enhancedLayouts)) {\n      setEnhancedLayouts(newLayouts);\n      dispatch({\n        type: \"LAYOUT_CHANGED\",\n        value: {\n          ...layout,\n          layouts: newLayouts,\n          blocks: layout.blocks.map((block) => {\n            return {\n              ...block,\n              initialized: true,\n            };\n          }),\n        },\n      });\n    }\n  }, [\n    allowHeightInitialization,\n    chartContainerClasses.chartContainer,\n    dispatch,\n    enhancedLayouts,\n    mountedForSomeTime,\n    resize,\n    layout,\n    state.chartConfigs,\n  ]);\n\n  return (\n    <ResponsiveReactGridLayout\n      {...rest}\n      layouts={layouts}\n      className={clsx(classes.root, className)}\n      cols={COLS}\n      rowHeight={ROW_HEIGHT}\n      useCSSTransforms={false}\n      compactType=\"vertical\"\n      preventCollision={false}\n      isResizable={resize}\n    >\n      {children}\n    </ResponsiveReactGridLayout>\n  );\n};\n\nexport const getInitialTileWidth = () => MAX_W / 4;\nexport const getInitialTileHeight = () => INITIAL_H;\n\nexport const generateLayout = function ({\n  count,\n  maxWidth = MAX_W,\n  maxHeight = MAX_H,\n  layout,\n  resizeHandles,\n}: {\n  count: number;\n  maxWidth?: number;\n  maxHeight?: number;\n  layout: \"horizontal\" | \"vertical\" | \"wide\" | \"tall\" | \"tiles\";\n  resizeHandles?: ResizeHandle[];\n}): ReactGridLayoutType[] {\n  return map(range(0, count), (_item, i) => {\n    return match(layout)\n      .with(\"horizontal\", () => {\n        const h = Math.ceil(maxHeight / count);\n        return {\n          x: 0,\n          y: i * h,\n          w: maxWidth,\n          h,\n          minH: MIN_H,\n          i: i.toString(),\n          resizeHandles,\n        };\n      })\n      .with(\"vertical\", () => {\n        const w = Math.ceil(maxWidth / count);\n        return {\n          x: i * w,\n          y: 0,\n          w: w,\n          h: maxHeight,\n          minH: MIN_H,\n          i: i.toString(),\n          resizeHandles,\n        };\n      })\n      .with(\"tall\", () => {\n        const h = Math.ceil(maxHeight / (count - 1));\n        return {\n          x: i === 0 ? 0 : maxWidth / 2,\n          y: i === 0 ? 0 : h * (i - 1),\n          w: maxWidth / 2,\n          h: i === 0 ? maxHeight : h,\n          minH: MIN_H,\n          i: i.toString(),\n          resizeHandles,\n        };\n      })\n      .with(\"tiles\", () => {\n        return {\n          x: ((i % 4) * MAX_W) / 4,\n          y: Math.floor(i / 2) * INITIAL_H,\n          w: getInitialTileWidth(),\n          h: getInitialTileHeight(),\n          minH: MIN_H,\n          i: i.toString(),\n          resizeHandles: [],\n        };\n      })\n      .with(\"wide\", () => {\n        const w = Math.ceil(maxWidth / (count - 1));\n        return {\n          x: i === 0 ? maxWidth : w * (i - 1),\n          y: i === 0 ? 0 : maxHeight / 2,\n          w: i === 0 ? maxWidth : w,\n          h: maxHeight / 2,\n          minH: MIN_H,\n          i: i.toString(),\n          resizeHandles,\n        };\n      })\n      .exhaustive();\n  });\n};\n","import { Trans } from \"@lingui/macro\";\nimport MUITreeItem, {\n  TreeItemContentClassKey,\n  TreeItemProps,\n  useTreeItem,\n} from \"@mui/lab/TreeItem\";\nimport TreeView, { TreeViewProps } from \"@mui/lab/TreeView\";\nimport {\n  Box,\n  Chip,\n  Collapse,\n  IconButton,\n  Input,\n  Popover,\n  PopoverActions,\n  Select,\n  SelectProps,\n  TextFieldProps,\n  Theme,\n  Typography,\n  useControlled,\n  useEventCallback,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport {\n  ForwardedRef,\n  forwardRef,\n  HTMLAttributes,\n  type MouseEvent,\n  MouseEventHandler,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport { Label, selectSizeToTypography } from \"@/components/form\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { HierarchyValue } from \"@/domain/data\";\nimport { Icon } from \"@/icons\";\nimport SvgIcChevronRight from \"@/icons/components/IcChevronRight\";\nimport { flattenTree, pruneTree } from \"@/rdf/tree-utils\";\nimport { useEvent } from \"@/utils/use-event\";\n\nconst useTreeItemStyles = makeStyles({\n  // Necessary to use $content below\n  content: {},\n  root: {\n    \"&:hover > div > $iconContainer\": {\n      opacity: 1,\n    },\n    \"--depth\": 1,\n    \"& &\": {\n      \"--depth\": 2,\n    },\n    \"& & &\": {\n      \"--depth\": 3,\n    },\n    \"& & & &\": {\n      \"--depth\": 4,\n    },\n    \"& & & & &\": {\n      \"--depth\": 5,\n    },\n    \"& $content\": {\n      paddingLeft: \"calc(var(--depth) * 10px)\",\n    },\n  },\n  iconContainer: {\n    opacity: 0.5,\n  },\n  group: {\n    // The padding is done on the content inside the row for the hover\n    // effect to extend until the edge of the popover\n    marginLeft: 0,\n  },\n});\n\nconst useCustomTreeItemStyles = makeStyles<Theme, { selectable?: boolean }>(\n  (theme) => ({\n    action: {\n      marginLeft: theme.spacing(2),\n      color: theme.palette.text.primary,\n      lineHeight: 0,\n      transform: \"translateX(0)\",\n      opacity: 0.5,\n      transition: \"transform 0.3s ease, opacity 0.3s ease\",\n\n      \"&:hover\": {\n        opacity: 1,\n        color: theme.palette.primary.main,\n      },\n    },\n    root: {\n      \"&:hover\": {\n        \"& $action\": {\n          transform: \"translateX(0)\",\n        },\n      },\n    },\n    checkIcon: {\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(1),\n    },\n  })\n);\n\nconst TreeItemContent = forwardRef<\n  unknown,\n  {\n    classes: Record<TreeItemContentClassKey, string>;\n    className?: string;\n    displayIcon?: ReactNode;\n    expansionIcon?: ReactNode;\n    size?: SelectProps[\"size\"];\n    icon?: ReactNode;\n    label?: ReactNode;\n    onClick?: MouseEventHandler;\n    nodeId: string;\n    onMouseDown?: MouseEventHandler;\n    \"data-selectable\"?: boolean;\n    \"data-children\"?: boolean;\n    \"data-multi\"?: boolean;\n    \"data-item-click\"?: (nodeId: string) => void;\n    \"data-is-selected\"?: boolean;\n  }\n>(function TreeItemContent(props, ref) {\n  const {\n    classes,\n    className,\n    displayIcon,\n    expansionIcon,\n    size = \"sm\",\n    icon: iconProp,\n    label,\n    nodeId,\n    onClick,\n    children,\n    onMouseDown,\n    ...other\n  } = props;\n\n  const hasChildren = other[\"data-children\"];\n  const selectable = other[\"data-selectable\"] !== false;\n  const isMulti = other[\"data-multi\"] === true;\n  const handleItemClick = other[\"data-item-click\"];\n  const isSelectedInMulti = other[\"data-is-selected\"] === true;\n\n  const {\n    disabled,\n    expanded,\n    selected,\n    focused,\n    handleExpansion,\n    handleSelection,\n    preventSelection,\n  } = useTreeItem(nodeId);\n\n  const icon = iconProp || expansionIcon || displayIcon;\n\n  const handleMouseDown = useEvent((e: MouseEvent) => {\n    preventSelection(e);\n\n    if (onMouseDown) {\n      onMouseDown(e);\n    }\n  });\n\n  const ownClasses = useCustomTreeItemStyles({\n    selectable,\n  });\n\n  const handleClickLabel = useEvent((e: MouseEvent) => {\n    if (!e.defaultPrevented) {\n      handleExpansion(e);\n    }\n  });\n\n  const handleSelect = useEvent((e: MouseEvent) => {\n    e.preventDefault();\n\n    if (selectable === false) {\n      return;\n    }\n\n    preventSelection(e);\n\n    if (isMulti && handleItemClick) {\n      // For multi-select, use our custom handler\n      handleItemClick(nodeId);\n    } else {\n      handleSelection(e);\n      if (onClick) {\n        onClick(e);\n      }\n    }\n  });\n\n  return (\n    <div\n      className={clsx(className, classes.root, ownClasses.root, {\n        [classes.expanded]: expanded,\n        [classes.selected]: selected,\n        [classes.focused]: focused,\n        [classes.disabled]: disabled,\n      })}\n      onMouseDown={handleMouseDown}\n      onClick={selectable && !hasChildren ? handleSelect : handleClickLabel}\n      ref={ref as ForwardedRef<HTMLDivElement>}\n      {...other}\n    >\n      <div className={clsx(classes.iconContainer)}>{icon}</div>\n      <div className={classes.label}>\n        <Typography\n          variant={selectSizeToTypography[size]}\n          component=\"span\"\n          sx={{\n            overflow: \"hidden\",\n            textOverflow: \"ellipsis\",\n            whiteSpace: \"nowrap\",\n            display: \"inline-block\",\n            maxWidth: \"100%\",\n          }}\n        >\n          {label}\n        </Typography>\n        {selectable && hasChildren ? (\n          <div className={ownClasses.action} onClick={handleSelect}>\n            <Typography variant={selectSizeToTypography[size]} component=\"span\">\n              <Trans id=\"controls.tree.select-value\">Select</Trans>\n            </Typography>\n          </div>\n        ) : null}\n      </div>\n      {isMulti && selectable && isSelectedInMulti ? (\n        <div className={ownClasses.checkIcon}>\n          <Icon name=\"checkmark\" size={20} />\n        </div>\n      ) : selected && !isMulti ? (\n        <div className={ownClasses.checkIcon}>\n          <Icon name=\"checkmark\" size={20} />\n        </div>\n      ) : null}\n    </div>\n  );\n});\n\nconst TreeItem = (props: TreeItemProps) => {\n  return <MUITreeItem {...props} ContentComponent={TreeItemContent} />;\n};\n\nexport type TreeHierarchyValue = Omit<\n  HierarchyValue,\n  \"depth\" | \"dimensionId\" | \"children\"\n> & {\n  selectable?: boolean;\n  children?: TreeHierarchyValue[];\n};\n\nexport type Tree = TreeHierarchyValue[];\n\ntype NodeId = string;\n\nexport type SelectTreeProps = {\n  id?: string;\n  size?: SelectProps[\"size\"];\n  isMulti?: boolean;\n  open?: boolean;\n  onOpen?: () => void;\n  onClose?: () => void;\n  options: Tree;\n  value?: NodeId | NodeId[];\n  label?: ReactNode;\n  onChange: (e: { target: { value: NodeId | NodeId[] } }) => void;\n  sideControls?: ReactNode;\n  disabled?: boolean;\n\n  // Controlled input value\n  inputValue?: string;\n  onChangeInputValue?: (value: string) => void;\n};\n\nconst getFilteredOptions = (options: Tree, value: string) => {\n  const rx = new RegExp(`^${value}|\\\\s${value}`, \"i\");\n\n  return value === \"\"\n    ? options\n    : pruneTree(options as HierarchyValue[], (d) => !!d.label.match(rx));\n};\n\n/**\n * Manages business logic for a select tree with search functionality\n *\n * When searching, the tree is automatically expanded\n */\nexport const useSelectTree = ({\n  value,\n  options,\n  inputValue: controlledInputValue,\n  onChangeInputValue,\n}: Pick<\n  SelectTreeProps,\n  \"value\" | \"options\" | \"inputValue\" | \"onChangeInputValue\"\n>) => {\n  const [inputValue, setInputValue_] = useControlled({\n    name: \"SelectTree\",\n    state: \"inputValue\",\n    controlled: controlledInputValue,\n    default: \"\",\n  });\n\n  const setInputValue = useEvent((value: string) => {\n    setInputValue_(value);\n    onChangeInputValue?.(value);\n  });\n\n  const optionsRef = useRef(options);\n  const [filteredOptions_, setFilteredOptions] = useState<Tree>([]);\n\n  // Trick to get filteredOptions updated synchronously\n  const filteredOptions =\n    optionsRef.current !== options ? options : filteredOptions_;\n\n  optionsRef.current = options;\n\n  useEffect(() => {\n    setFilteredOptions(options);\n  }, [options]);\n\n  const parentsRef = useRef({} as Record<NodeId, NodeId>);\n\n  const defaultExpanded = useMemo(() => {\n    if (\n      (!value || (Array.isArray(value) && value.length === 0)) &&\n      options.length > 0\n    ) {\n      return options[0].value ? [options[0].value] : [];\n    }\n\n    const values = Array.isArray(value) ? value : value ? [value] : [];\n    const res = [...values];\n    const parents = parentsRef.current;\n\n    for (const v of values) {\n      let cur = v;\n      while (cur && parents[cur]) {\n        res.push(parents[cur]);\n        cur = parents[cur];\n      }\n    }\n\n    return Array.from(new Set(res));\n  }, [value, options]);\n\n  const [expanded, setExpanded] = useState(defaultExpanded);\n\n  const handleInputChange: TextFieldProps[\"onChange\"] = useEvent((ev) => {\n    const value = ev.currentTarget.value;\n    setInputValue(value);\n    const filteredOptions = getFilteredOptions(options, value);\n    setFilteredOptions(filteredOptions);\n    setExpanded((curExpanded) => {\n      const newExpanded = Array.from(\n        new Set([\n          ...curExpanded,\n          ...flattenTree(filteredOptions as HierarchyValue[]).map(\n            (v) => v.value\n          ),\n        ])\n      );\n      return newExpanded;\n    });\n  });\n\n  const handleNodeToggle: TreeViewProps[\"onNodeToggle\"] = useEvent(\n    (_ev, nodeIds) => {\n      setExpanded(nodeIds);\n    }\n  );\n\n  const handleClickResetInput = useEvent(() => {\n    const newValue = \"\";\n    setInputValue(newValue);\n    setFilteredOptions(getFilteredOptions(options, newValue));\n    setExpanded(defaultExpanded);\n  });\n\n  return {\n    inputValue,\n    setInputValue,\n    filteredOptions,\n    setFilteredOptions,\n    expanded,\n    setExpanded,\n    handleInputChange,\n    parentsRef,\n    handleNodeToggle,\n    handleClickResetInput,\n    defaultExpanded,\n  };\n};\n\nexport const SelectTree = ({\n  size = \"sm\",\n  label,\n  options,\n  value,\n  onChange,\n  disabled,\n  sideControls,\n  onOpen,\n  onClose,\n  open,\n  id,\n  isMulti = false,\n}: SelectTreeProps) => {\n  const [openState, setOpenState] = useState(false);\n  const [minMenuWidth, setMinMenuWidth] = useState<number>();\n\n  const {\n    inputValue,\n    setInputValue,\n    filteredOptions,\n    setFilteredOptions,\n    parentsRef,\n    expanded,\n    setExpanded,\n    handleInputChange,\n    handleNodeToggle,\n    handleClickResetInput,\n    defaultExpanded,\n  } = useSelectTree({ value, options });\n\n  const menuRef = useRef<PopoverActions>(null);\n  const inputRef = useRef<HTMLDivElement>();\n\n  const labelsByValue = useMemo(() => {\n    parentsRef.current = {} as Record<NodeId, NodeId>;\n    const res: Record<string, string> = {};\n    const registerNode = ({ value, label, children }: Tree[number]) => {\n      res[value] = label;\n      if (children && children.length > 0) {\n        for (let child of children) {\n          registerNode(child);\n          parentsRef.current[child.value as unknown as NodeId] = value;\n        }\n      }\n    };\n\n    for (let root of options) {\n      registerNode(root);\n    }\n\n    return res;\n  }, [options, parentsRef]);\n\n  const handleOpen = useEventCallback(() => {\n    setOpenState(true);\n    setMinMenuWidth(inputRef.current?.clientLeft);\n    onOpen?.();\n  });\n\n  const handleClose = useEventCallback(() => {\n    setOpenState(false);\n    setInputValue(\"\");\n    setFilteredOptions(getFilteredOptions(options, \"\"));\n    setExpanded(defaultExpanded);\n    onClose?.();\n  });\n\n  const handleNodeSelect = useEventCallback((_, v: NodeId | NodeId[]) => {\n    onChange({ target: { value: v } });\n\n    if (!isMulti) {\n      handleClose();\n    }\n  });\n\n  const handleItemClick = useEventCallback((v: NodeId) => {\n    if (isMulti) {\n      if (v === FIELD_VALUE_NONE) {\n        onChange({ target: { value: [] } });\n        return;\n      }\n\n      const currentValues = value as NodeId[];\n      const newValues = currentValues.includes(v)\n        ? currentValues.filter((id) => id !== v)\n        : [...currentValues, v];\n      onChange({ target: { value: newValues } });\n    } else {\n      onChange({ target: { value: v } });\n      handleClose();\n    }\n  });\n\n  const treeItemClasses = useTreeItemStyles();\n  const treeItemTransitionProps = useMemo(\n    () => ({\n      onEntered: () => {\n        menuRef.current?.updatePosition();\n      },\n      onExited: () => {\n        menuRef.current?.updatePosition();\n      },\n    }),\n    []\n  );\n  const renderTreeContent = useCallback(\n    (nodesData: Tree) => {\n      return (\n        <>\n          {nodesData.map(\n            ({ value: nodeValue, label, children, selectable }) => {\n              return (\n                <TreeItem\n                  key={nodeValue}\n                  nodeId={nodeValue}\n                  defaultExpanded={defaultExpanded}\n                  label={label}\n                  size={size}\n                  expandIcon={\n                    children && children.length > 0 ? (\n                      <SvgIcChevronRight />\n                    ) : null\n                  }\n                  classes={treeItemClasses}\n                  TransitionComponent={Collapse}\n                  TransitionProps={treeItemTransitionProps}\n                  ContentProps={{\n                    // @ts-expect-error - TS says we cannot put a data attribute\n                    // on the HTML element, but we know we can.\n                    \"data-selectable\": selectable,\n                    \"data-children\": children && children.length > 0,\n                    \"data-multi\": isMulti,\n                    \"data-item-click\": isMulti ? handleItemClick : undefined,\n                    \"data-is-selected\": isMulti\n                      ? (value as NodeId[]).includes(nodeValue)\n                      : undefined,\n                  }}\n                >\n                  {children ? renderTreeContent(children) : null}\n                </TreeItem>\n              );\n            }\n          )}\n        </>\n      );\n    },\n    [\n      defaultExpanded,\n      size,\n      treeItemClasses,\n      treeItemTransitionProps,\n      isMulti,\n      handleItemClick,\n      value,\n    ]\n  );\n\n  const paperProps = useMemo(\n    () => ({\n      sx: {\n        minWidth: minMenuWidth ?? 0,\n        boxShadow: 3,\n      },\n    }),\n    [minMenuWidth]\n  );\n\n  const menuTransitionProps = useMemo(\n    () => ({\n      /**\n       * Adds transition for top, as we need to reposition the paper when a node is toggled.\n       * This needs to be done like this since the Grow transition component imperatively\n       * changes the node.style.transition on entering.\n       */\n      onEnter: (node: HTMLElement, isAppearing: boolean) => {\n        if (isAppearing) {\n          node.style.transition = `${node.style.transition}, top 158ms cubic-bezier(0.4, 0, 0.2, 1)`;\n        }\n      },\n    }),\n    []\n  );\n\n  const treeRef = useRef();\n  const handleKeyDown: HTMLAttributes<HTMLInputElement>[\"onKeyDown\"] = useEvent(\n    (e) => {\n      if (e.key === \"Enter\" || e.key == \" \") {\n        handleOpen();\n        e.preventDefault();\n      }\n    }\n  );\n\n  useEffect(() => {\n    const inputNode = inputRef.current;\n    if (inputNode) {\n      setMinMenuWidth(inputNode.clientWidth);\n    }\n  }, [open]);\n\n  return (\n    <div>\n      {label && (\n        <Label\n          htmlFor={id!}\n          sx={{ display: \"flex\", alignItems: \"center\", mb: 1 }}\n        >\n          {label}\n        </Label>\n      )}\n      <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\n        <Select\n          aria-expanded={open}\n          ref={inputRef}\n          id={id}\n          name={id}\n          size={size}\n          disabled={disabled}\n          readOnly\n          displayEmpty\n          value={\n            isMulti\n              ? (value as NodeId[]).length > 0\n                ? (value as NodeId[]).join(\",\")\n                : \"\"\n              : value\n                ? labelsByValue[value as string]\n                : undefined\n          }\n          onClick={disabled ? undefined : handleOpen}\n          onKeyDown={handleKeyDown}\n          renderValue={() => {\n            if (isMulti && Array.isArray(value) && value.length > 0) {\n              return (\n                <Flex\n                  sx={{\n                    flexWrap: \"nowrap\",\n                    gap: 0.5,\n                    overflowX: \"auto\",\n                    maxWidth: \"calc(100% - 32px)\",\n                    py: 2,\n                  }}\n                >\n                  {value.map((nodeId) => (\n                    <Chip\n                      key={nodeId}\n                      label={\n                        <Box\n                          sx={{\n                            display: \"inline-flex\",\n                            alignItems: \"center\",\n                            gap: 0.5,\n                            py: 1,\n                            maxWidth: \"100%\",\n                            overflow: \"hidden\",\n                          }}\n                        >\n                          <Typography\n                            variant={selectSizeToTypography[size]}\n                            sx={{\n                              lineHeight: 1,\n                              overflow: \"hidden\",\n                              textOverflow: \"ellipsis\",\n                              whiteSpace: \"nowrap\",\n                              minWidth: 0,\n                            }}\n                          >\n                            {labelsByValue[nodeId]}\n                          </Typography>\n                        </Box>\n                      }\n                      size=\"small\"\n                      deleteIcon={<Icon name=\"close\" size={16} />}\n                      onDelete={(e) => {\n                        e.stopPropagation();\n                        const newValues = value.filter((v) => v !== nodeId);\n                        onChange({ target: { value: newValues } });\n                      }}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      sx={{\n                        maxWidth: \"100% !important\",\n                        height: \"fit-content\",\n                        mr: 0.5,\n                        px: 1,\n                        py: 0.25,\n                        backgroundColor: \"#F0F4F7\",\n\n                        \"&:hover\": {\n                          backgroundColor: \"cobalt.100\",\n                        },\n\n                        \"& .MuiChip-deleteIcon\": {\n                          color: \"text.primary\",\n                          transition: \"color 0.2s ease\",\n                        },\n                      }}\n                    />\n                  ))}\n                </Flex>\n              );\n            }\n            if (isMulti && Array.isArray(value) && value.length === 0) {\n              return (\n                <Trans id=\"controls.dimensionvalue.select\">Select filter</Trans>\n              );\n            }\n\n            return (\n              <Typography\n                variant={selectSizeToTypography[size]}\n                sx={{\n                  overflow: \"hidden\",\n                  textOverflow: \"ellipsis\",\n                  whiteSpace: \"nowrap\",\n                  display: \"block\",\n                }}\n              >\n                {value ? labelsByValue[value as string] : undefined}\n              </Typography>\n            );\n          }}\n          sx={{\n            \"& svg\": {\n              // Force icon rotation, as the Select is read only to keep the styling,\n              // but allow of rendering custom tree menu.\n              transform: open ? \"rotate(180deg)\" : \"rotate(0deg)\",\n            },\n            ...(isMulti && {\n              \"& .MuiSelect-select.MuiInputBase-input.MuiOutlinedInput-input\": {\n                display: \"flex\",\n                alignItems: \"center\",\n                height: 40,\n                minHeight: 0,\n                padding: \"0px 16px !important\",\n              },\n\n              \"&:hover\": {\n                \"& .MuiSelect-select\": {\n                  backgroundColor: \"transparent\",\n                },\n              },\n            }),\n          }}\n        />\n        {sideControls}\n      </Box>\n      <Popover\n        anchorEl={inputRef.current}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        open={open !== undefined ? open : !!openState}\n        onClose={handleClose}\n        action={menuRef}\n        slotProps={{ paper: paperProps }}\n        TransitionProps={menuTransitionProps}\n      >\n        <Input\n          size=\"sm\"\n          value={inputValue}\n          autoFocus\n          startAdornment={<Icon name=\"search\" size={18} />}\n          endAdornment={\n            <IconButton size=\"small\" onClick={handleClickResetInput}>\n              <Icon name=\"close\" size={16} />\n            </IconButton>\n          }\n          onChange={handleInputChange}\n          sx={{\n            px: 2,\n            py: 1,\n\n            \"& .MuiInput-input\": {\n              px: 1,\n            },\n          }}\n        />\n        {filteredOptions.length === 0 ? (\n          <Typography\n            variant={selectSizeToTypography[size]}\n            component=\"p\"\n            sx={{ py: 2, textAlign: \"center\" }}\n          >\n            <Trans id=\"No results\">No results</Trans>\n          </Typography>\n        ) : (\n          // @ts-ignore\n          <TreeView\n            ref={treeRef}\n            multiSelect={isMulti}\n            selected={value}\n            expanded={expanded}\n            onNodeToggle={handleNodeToggle}\n            onNodeSelect={isMulti ? () => {} : handleNodeSelect}\n          >\n            {renderTreeContent(filteredOptions)}\n          </TreeView>\n        )}\n      </Popover>\n    </div>\n  );\n};\n","import { BoxProps, styled, Typography, TypographyProps } from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport { forwardRef, ReactNode } from \"react\";\n\ntype TagType =\n  | \"draft\"\n  | \"theme\"\n  | \"organization\"\n  | \"termset\"\n  | \"dimension\"\n  | \"unknown\";\n\nconst TagTypography = styled(Typography)(({ theme }) => ({\n  display: \"inline-flex\",\n  alignItems: \"center\",\n  width: \"fit-content\",\n  minHeight: 24,\n  padding: `${theme.spacing(1)} ${theme.spacing(2)}`,\n  borderRadius: \"16px\",\n  transition: \"box-shadow 0.2s ease\",\n}));\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  themeType: {\n    backgroundColor: theme.palette.green[100],\n  },\n  organizationType: {\n    backgroundColor: theme.palette.blue[100],\n  },\n  termsetType: {\n    backgroundColor: theme.palette.cobalt[50],\n  },\n  unknownType: {\n    backgroundColor: theme.palette.cobalt[50],\n  },\n  dimensionType: {\n    backgroundColor: theme.palette.yellow[100],\n  },\n  draftType: {},\n  clickable: {\n    cursor: \"pointer\",\n    \"&:hover\": {\n      boxShadow: theme.shadows[2],\n    },\n  },\n}));\n\nexport const Tag = forwardRef<\n  HTMLParagraphElement,\n  {\n    children: ReactNode;\n    type?: TagType;\n  } & TypographyProps & {\n      component?: BoxProps[\"component\"];\n    }\n>(({ children, type = \"unknown\", ...props }, ref) => {\n  const classes = useStyles();\n\n  return (\n    <TagTypography\n      ref={ref}\n      variant=\"caption\"\n      {...props}\n      className={clsx(\n        props.className,\n        classes[`${type}Type` as const],\n        props.onClick ? classes.clickable : null\n      )}\n    >\n      {children}\n    </TagTypography>\n  );\n});\n","import { t } from \"@lingui/macro\";\nimport { IconButton, useEventCallback } from \"@mui/material\";\nimport { useState } from \"react\";\n\nimport { ArrowMenuTopBottom } from \"@/components/arrow-menu\";\nimport { MenuActionItem } from \"@/components/menu-action-item\";\nimport {\n  isLayouting,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport SvgIcMore from \"@/icons/components/IcMore\";\nimport { createId } from \"@/utils/create-id\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nexport const BlockMoreButton = ({ blockKey }: { blockKey: string }) => {\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const { layout } = state;\n  const [anchor, setAnchor] = useState<HTMLElement | null>(null);\n  const handleClose = useEventCallback(() => setAnchor(null));\n  const handleDuplicate = useEventCallback(() => {\n    const key = createId();\n    const block = layout.blocks.find((b) => b.key === blockKey);\n\n    if (!block) {\n      return;\n    }\n\n    dispatch({\n      type: \"LAYOUT_CHANGED\",\n      value: {\n        ...layout,\n        blocks: [\n          ...layout.blocks,\n          {\n            ...block,\n            key,\n          },\n        ],\n      },\n    });\n    dispatch({\n      type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value: key,\n    });\n  });\n  const handleRemove = useEventCallback(() => {\n    dispatch({\n      type: \"LAYOUT_CHANGED\",\n      value: {\n        ...layout,\n        blocks: layout.blocks.filter((b) => b.key !== blockKey),\n      },\n    });\n\n    if (layout.activeField === blockKey) {\n      dispatch({\n        type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n        value: undefined,\n      });\n    }\n  });\n\n  return (\n    <>\n      <IconButton\n        color=\"secondary\"\n        onClick={(e) => {\n          e.stopPropagation();\n          setAnchor(e.currentTarget);\n        }}\n        sx={{ height: \"fit-content\" }}\n        {...DISABLE_SCREENSHOT_ATTR}\n        data-testid=\"block-more-button\"\n      >\n        <SvgIcMore />\n      </IconButton>\n      <ArrowMenuTopBottom\n        open={!!anchor}\n        anchorEl={anchor}\n        onClose={(e) => {\n          (e as Event).stopPropagation();\n          handleClose();\n        }}\n        anchorOrigin={{ horizontal: \"right\", vertical: \"bottom\" }}\n        transformOrigin={{ horizontal: \"right\", vertical: \"top\" }}\n      >\n        <div>\n          <MenuActionItem\n            type=\"button\"\n            as=\"menuitem\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handleDuplicate();\n              handleClose();\n            }}\n            leadingIconName=\"duplicate\"\n            label={t({ id: \"block-controls.duplicate\", message: \"Duplicate\" })}\n          />\n          <MenuActionItem\n            type=\"button\"\n            as=\"menuitem\"\n            color=\"red\"\n            requireConfirmation\n            confirmationTitle={t({\n              id: \"block-controls.delete.title\",\n              message: \"Delete block?\",\n            })}\n            confirmationText={t({\n              id: \"block-controls.delete.confirmation\",\n              message: \"Are you sure you want to delete this block?\",\n            })}\n            onClick={(e) => {\n              e.stopPropagation();\n              handleRemove();\n              handleClose();\n            }}\n            leadingIconName=\"trash\"\n            label={t({ id: \"block-controls.delete\", message: \"Delete\" })}\n          />\n        </div>\n      </ArrowMenuTopBottom>\n    </>\n  );\n};\n","import { useDraggable, useDroppable } from \"@dnd-kit/core\";\nimport { t } from \"@lingui/macro\";\nimport { Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport { selectAll } from \"d3-selection\";\nimport isEqual from \"lodash/isEqual\";\nimport {\n  ComponentProps,\n  forwardRef,\n  useCallback,\n  useLayoutEffect,\n} from \"react\";\n\nimport { ActionElementsContainer } from \"@/components/action-elements-container\";\nimport { CHART_GRID_ROW_COUNT } from \"@/components/chart-shared\";\nimport { BlockMoreButton } from \"@/components/dashboard-shared\";\nimport { DragHandle, useDragOverClasses } from \"@/components/drag-handle\";\nimport { Markdown } from \"@/components/markdown\";\nimport { ROW_HEIGHT } from \"@/components/react-grid\";\nimport { LayoutTextBlock } from \"@/config-types\";\nimport {\n  hasChartConfigs,\n  isLayouting,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\n\nconst useTextBlockStyles = makeStyles<Theme, { layouting?: boolean }>(() => ({\n  root: {\n    // Make sure the text block doesn't cause the grid to grow.\n    gridRow: `span ${CHART_GRID_ROW_COUNT + 1}`,\n    display: \"flex\",\n    padding: \"0.75rem\",\n    cursor: ({ layouting }) => (layouting ? \"pointer\" : \"default\"),\n    \"&:hover\": {\n      textDecoration: ({ layouting }) => (layouting ? \"underline\" : \"none\"),\n    },\n  },\n}));\nconst TEXT_BLOCK_WRAPPER_CLASS = \"text-block-wrapper\";\nconst TEXT_BLOCK_CONTENT_CLASS = \"text-block-content\";\n\nexport const TextBlock = forwardRef<\n  HTMLDivElement,\n  {\n    block: LayoutTextBlock;\n    dragHandleProps?: ComponentProps<typeof DragHandle>;\n  } & ComponentProps<\"div\">\n>(({ children, block, className, dragHandleProps, ...rest }, ref) => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const layouting = isLayouting(state);\n  const classes = useTextBlockStyles({ layouting });\n  const handleTextBlockClick = useEvent((block: LayoutTextBlock) => {\n    if (!layouting) {\n      return;\n    }\n\n    dispatch({\n      type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value: block.key,\n    });\n  });\n  const text = block.text[locale];\n\n  return (\n    <div\n      // We need to spread the rest props, as there's some additional logic\n      // in ReactGridLayout that breaks otherwise.\n      {...rest}\n      ref={ref}\n      id={block.key}\n      className={clsx(classes.root, className, TEXT_BLOCK_WRAPPER_CLASS)}\n      onClick={(e) => {\n        if (e.isPropagationStopped()) {\n          return;\n        }\n\n        handleTextBlockClick(block);\n      }}\n    >\n      <div\n        className={TEXT_BLOCK_CONTENT_CLASS}\n        style={{ flexGrow: 1, height: \"fit-content\" }}\n      >\n        <Markdown>\n          {text || t({ id: \"annotation.add.text\", message: \"[ Add text ]\" })}\n        </Markdown>\n      </div>\n      {layouting ? (\n        <TextBlockActionElements\n          block={block}\n          dragHandleProps={dragHandleProps}\n        />\n      ) : null}\n      {children}\n    </div>\n  );\n});\n\nexport const renderBaseTextBlock = (block: LayoutTextBlock) => {\n  return (\n    <TextBlock\n      // Important, otherwise react-grid-layout breaks.\n      key={block.key}\n      block={block}\n    />\n  );\n};\n\nexport const DndTextBlock = ({ block }: { block: LayoutTextBlock }) => {\n  const {\n    setActivatorNodeRef,\n    setNodeRef: setDraggableNodeRef,\n    attributes,\n    listeners,\n    isDragging,\n  } = useDraggable({ id: block.key });\n  const {\n    setNodeRef: setDroppableNodeRef,\n    isOver: isDragOver,\n    active: isDragActive,\n  } = useDroppable({ id: block.key });\n  const setRef = useCallback(\n    (node: HTMLElement | null) => {\n      setDraggableNodeRef(node);\n      setDroppableNodeRef(node);\n    },\n    [setDraggableNodeRef, setDroppableNodeRef]\n  );\n  const dragOverClasses = useDragOverClasses({\n    isDragging,\n    isDragActive: !!isDragActive,\n    isDragOver,\n  });\n\n  return (\n    <TextBlock\n      {...attributes}\n      ref={setRef}\n      block={block}\n      className={\n        isDragging || isDragActive || isDragOver\n          ? dragOverClasses.root\n          : undefined\n      }\n      dragHandleProps={{\n        ref: setActivatorNodeRef,\n        dragging: isDragging,\n        ...listeners,\n      }}\n    />\n  );\n};\n\nconst TextBlockActionElements = ({\n  block,\n  dragHandleProps,\n}: {\n  block: LayoutTextBlock;\n  dragHandleProps?: ComponentProps<typeof DragHandle>;\n}) => {\n  return (\n    <ActionElementsContainer>\n      <BlockMoreButton blockKey={block.key} />\n      <DragHandle\n        onClick={(e) => {\n          e.stopPropagation();\n        }}\n        {...dragHandleProps}\n      />\n    </ActionElementsContainer>\n  );\n};\n\nexport const useSyncTextBlockHeight = () => {\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const layout = state.layout;\n  const isFreeCanvas =\n    layout.type === \"dashboard\" && layout.layout === \"canvas\";\n\n  useLayoutEffect(() => {\n    if (!isFreeCanvas) {\n      return;\n    }\n\n    selectAll<HTMLDivElement, unknown>(`.${TEXT_BLOCK_WRAPPER_CLASS}`).each(\n      function () {\n        const wrapperEl = this;\n        const contentEl = wrapperEl.querySelector<HTMLDivElement>(\n          `.${TEXT_BLOCK_CONTENT_CLASS}`\n        );\n\n        if (!contentEl) {\n          return;\n        }\n\n        const key = wrapperEl.id;\n        const h = Math.ceil(contentEl.clientHeight / ROW_HEIGHT) || 1;\n\n        const newLayouts = Object.fromEntries(\n          Object.entries(layout.layouts).map(([bp, layouts]) => [\n            bp,\n            layouts.map((b) => {\n              return b.i === key ? { ...b, h, minH: h } : b;\n            }),\n          ])\n        );\n\n        if (!isEqual(newLayouts, layout.layouts)) {\n          dispatch({\n            type: \"LAYOUT_CHANGED\",\n            value: {\n              ...layout,\n              layouts: newLayouts,\n            },\n          });\n        }\n      }\n    );\n  }, [dispatch, layout, isFreeCanvas]);\n};\n","/* eslint-disable no-redeclare */\nimport { PALETTE_TYPE } from \"@prisma/client\";\nimport { fold } from \"fp-ts/lib/Either\";\nimport { pipe } from \"fp-ts/lib/function\";\nimport * as t from \"io-ts\";\n\nconst DimensionType = t.union([\n  t.literal(\"NominalDimension\"),\n  t.literal(\"OrdinalDimension\"),\n  t.literal(\"TemporalDimension\"),\n  t.literal(\"TemporalEntityDimension\"),\n  t.literal(\"TemporalOrdinalDimension\"),\n  t.literal(\"GeoCoordinatesDimension\"),\n  t.literal(\"GeoShapesDimension\"),\n  t.literal(\"StandardErrorDimension\"),\n  t.literal(\"ConfidenceUpperBoundDimension\"),\n  t.literal(\"ConfidenceLowerBoundDimension\"),\n]);\nexport type DimensionType = t.TypeOf<typeof DimensionType>;\n\nconst MeasureType = t.union([\n  t.literal(\"NumericalMeasure\"),\n  t.literal(\"OrdinalMeasure\"),\n]);\nexport type MeasureType = t.TypeOf<typeof MeasureType>;\n\nconst ComponentType = t.union([DimensionType, MeasureType]);\nexport type ComponentType = t.TypeOf<typeof ComponentType>;\n\n// Filters\nconst FilterValueSingle = t.intersection([\n  t.type(\n    {\n      type: t.literal(\"single\"),\n      value: t.union([t.string, t.number]),\n    },\n    \"FilterValueSingle\"\n  ),\n  t.partial({\n    position: t.number,\n  }),\n]);\nexport type FilterValueSingle = t.TypeOf<typeof FilterValueSingle>;\n\nconst FilterValueMulti = t.intersection([\n  t.type(\n    {\n      type: t.literal(\"multi\"),\n      values: t.record(t.string, t.literal(true)), // undefined values will be removed when serializing to JSON\n    },\n    \"FilterValueMulti\"\n  ),\n  t.partial({\n    position: t.number,\n  }),\n]);\nexport type FilterValueMulti = t.TypeOf<typeof FilterValueMulti>;\n\nconst FilterValueRange = t.intersection([\n  t.type(\n    {\n      type: t.literal(\"range\"),\n      from: t.string,\n      to: t.string,\n    },\n    \"FilterValueRange\"\n  ),\n  t.partial({\n    position: t.number,\n  }),\n]);\nexport type FilterValueRange = t.TypeOf<typeof FilterValueRange>;\n\nconst FilterValue = t.union(\n  [FilterValueSingle, FilterValueMulti, FilterValueRange],\n  \"FilterValue\"\n);\nexport type FilterValue = t.TypeOf<typeof FilterValue>;\n\nexport type FilterValueType = FilterValue[\"type\"];\n\nexport type FilterValueMultiValues = FilterValueMulti[\"values\"];\n\nconst Filters = t.record(t.string, FilterValue, \"Filters\");\nexport type Filters = t.TypeOf<typeof Filters>;\n\nconst SingleFilters = t.record(t.string, FilterValueSingle, \"SingleFilters\");\nexport type SingleFilters = t.TypeOf<typeof SingleFilters>;\n\nconst Title = t.type({\n  de: t.string,\n  fr: t.string,\n  it: t.string,\n  en: t.string,\n});\nexport type Title = t.TypeOf<typeof Title>;\n\nconst Description = t.type({\n  de: t.string,\n  fr: t.string,\n  it: t.string,\n  en: t.string,\n});\nexport type Description = t.TypeOf<typeof Description>;\n\nconst Label = t.type({\n  de: t.string,\n  fr: t.string,\n  it: t.string,\n  en: t.string,\n});\nexport type Label = t.TypeOf<typeof Label>;\n\nconst Meta = t.type({\n  title: Title,\n  description: Description,\n  label: Label,\n});\nexport type Meta = t.TypeOf<typeof Meta>;\nexport type MetaKey = keyof Meta;\n\nconst InteractiveFiltersLegend = t.type({\n  active: t.boolean,\n  componentId: t.string,\n});\nexport type InteractiveFiltersLegend = t.TypeOf<\n  typeof InteractiveFiltersLegend\n>;\n\nconst InteractiveFiltersTimeRange = t.type({\n  active: t.boolean,\n  componentId: t.string,\n  presets: t.type({\n    type: t.literal(\"range\"),\n    from: t.string,\n    to: t.string,\n  }),\n});\nexport type InteractiveFiltersTimeRange = t.TypeOf<\n  typeof InteractiveFiltersTimeRange\n>;\n\nconst DefaultValueOverrides = t.record(t.string, t.array(t.string));\nexport type DefaultValueOverrides = t.TypeOf<typeof DefaultValueOverrides>;\n\nconst InteractiveDataFilterType = t.union([\n  t.literal(\"single\"),\n  t.literal(\"multi\"),\n]);\nexport type InteractiveDataFilterType = t.TypeOf<\n  typeof InteractiveDataFilterType\n>;\n\nconst InteractiveFiltersDataConfig = t.intersection([\n  t.type({\n    active: t.boolean,\n    componentIds: t.array(t.string),\n    defaultValueOverrides: DefaultValueOverrides,\n    filterTypes: t.record(t.string, InteractiveDataFilterType),\n  }),\n  t.partial({\n    defaultOpen: t.boolean,\n  }),\n]);\nexport type InteractiveFiltersDataConfig = t.TypeOf<\n  typeof InteractiveFiltersDataConfig\n>;\n\nconst CalculationType = t.union([t.literal(\"identity\"), t.literal(\"percent\")]);\nexport type CalculationType = t.TypeOf<typeof CalculationType>;\n\nconst InteractiveFiltersCalculation = t.type({\n  active: t.boolean,\n  type: CalculationType,\n});\nexport type InteractiveFiltersCalculation = t.TypeOf<\n  typeof InteractiveFiltersCalculation\n>;\n\nconst InteractiveFiltersConfig = t.type({\n  legend: InteractiveFiltersLegend,\n  timeRange: InteractiveFiltersTimeRange,\n  dataFilters: InteractiveFiltersDataConfig,\n  calculation: InteractiveFiltersCalculation,\n});\n\nexport type InteractiveFiltersConfig = t.TypeOf<\n  typeof InteractiveFiltersConfig\n>;\n\n// Chart Config\nconst ColorMapping = t.record(t.string, t.string);\nexport type ColorMapping = t.TypeOf<typeof ColorMapping>;\n\nconst SingleColorField = t.type({\n  type: t.literal(\"single\"),\n  paletteId: t.string,\n  color: t.string,\n});\nexport type SingleColorField = t.TypeOf<typeof SingleColorField>;\n\nconst SegmentColorField = t.type({\n  type: t.literal(\"segment\"),\n  paletteId: t.string,\n  colorMapping: ColorMapping,\n});\nexport type SegmentColorField = t.TypeOf<typeof SegmentColorField>;\n\nconst MeasuresColorField = t.type({\n  type: t.literal(\"measures\"),\n  paletteId: t.string,\n  colorMapping: ColorMapping,\n});\nexport type MeasuresColorField = t.TypeOf<typeof MeasuresColorField>;\n\nconst ColorField = t.union([\n  SingleColorField,\n  SegmentColorField,\n  MeasuresColorField,\n]);\nexport type ColorField = t.TypeOf<typeof ColorField>;\n\nconst GenericField = t.intersection([\n  t.type({ componentId: t.string }),\n  t.partial({ useAbbreviations: t.boolean }),\n]);\nexport type GenericField = t.TypeOf<typeof GenericField>;\n\nconst GenericFields = t.record(t.string, t.union([GenericField, t.undefined]));\nexport type GenericFields = t.TypeOf<typeof GenericFields>;\n\nconst AnimationType = t.union([t.literal(\"continuous\"), t.literal(\"stepped\")]);\nexport type AnimationType = t.TypeOf<typeof AnimationType>;\n\nconst AnimationField = t.intersection([\n  GenericField,\n  t.type({\n    showPlayButton: t.boolean,\n    type: AnimationType,\n    duration: t.number,\n    dynamicScales: t.boolean,\n  }),\n]);\nexport type AnimationField = t.TypeOf<typeof AnimationField>;\n\nconst SortingOrder = t.union([t.literal(\"asc\"), t.literal(\"desc\")]);\nexport type SortingOrder = t.TypeOf<typeof SortingOrder>;\n\nconst SortingType = t.union([\n  t.literal(\"byDimensionLabel\"),\n  t.literal(\"byMeasure\"),\n  t.literal(\"byTotalSize\"),\n  t.literal(\"byAuto\"),\n]);\nexport type SortingType = t.TypeOf<typeof SortingType>;\n\nconst SortingField = t.partial({\n  sorting: t.type({\n    sortingType: SortingType,\n    sortingOrder: SortingOrder,\n  }),\n});\nexport type SortingField = t.TypeOf<typeof SortingField>;\n\nconst ShowValuesBySegmentFieldExtension = t.type({\n  showValuesMapping: t.record(t.string, t.boolean),\n});\nexport type ShowValuesSegmentFieldExtension = t.TypeOf<\n  typeof ShowValuesBySegmentFieldExtension\n>;\nexport const shouldEnableSettingShowValuesBySegment = (\n  chartConfig: ChartConfig\n) => {\n  return (\n    (isBarConfig(chartConfig) || isColumnConfig(chartConfig)) &&\n    chartConfig.fields.segment?.type === \"stacked\"\n  );\n};\n\nconst Cube = t.intersection([\n  t.type({\n    /** * Cube iri at publish time (stored in the database) and latest one on the client side. */\n    iri: t.string,\n    filters: Filters,\n  }),\n  t.partial({\n    joinBy: t.array(t.string),\n  }),\n]);\nexport type Cube = t.TypeOf<typeof Cube>;\n\nconst AnnotationTarget = t.type({\n  componentId: t.string,\n  value: t.string,\n});\nexport type AnnotationTarget = t.TypeOf<typeof AnnotationTarget>;\n\nconst HighlightAnnotation = t.type({\n  key: t.string,\n  type: t.literal(\"highlight\"),\n  targets: t.array(AnnotationTarget),\n  text: t.type({\n    de: t.string,\n    fr: t.string,\n    it: t.string,\n    en: t.string,\n  }),\n  highlightType: t.union([t.literal(\"none\"), t.literal(\"filled\")]),\n  color: t.union([t.string, t.undefined]),\n  defaultOpen: t.boolean,\n});\nexport type HighlightAnnotation = t.TypeOf<typeof HighlightAnnotation>;\n\nconst Annotation = HighlightAnnotation;\nexport type Annotation = t.TypeOf<typeof Annotation>;\n\nexport const supportsAnnotations = (chartConfig: ChartConfig) => {\n  switch (chartConfig.chartType) {\n    case \"area\":\n    case \"bar\":\n    case \"column\":\n    case \"line\":\n    case \"pie\":\n    case \"scatterplot\":\n      return true;\n    case \"comboLineColumn\":\n    case \"comboLineDual\":\n    case \"comboLineSingle\":\n    case \"map\":\n    case \"table\":\n      return false;\n    default:\n      const _exhaustiveCheck: never = chartConfig;\n      return _exhaustiveCheck;\n  }\n};\n\nconst Limit = t.intersection([\n  t.type({\n    related: t.array(\n      t.type({\n        dimensionId: t.string,\n        value: t.string,\n      })\n    ),\n    color: t.string,\n    lineType: t.union([t.literal(\"dashed\"), t.literal(\"solid\")]),\n  }),\n  t.partial({\n    symbolType: t.union([\n      t.literal(\"cross\"),\n      t.literal(\"circle\"),\n      t.literal(\"triangle\"),\n    ]),\n  }),\n]);\nexport type Limit = t.TypeOf<typeof Limit>;\n\nconst ConversionUnit = t.type({\n  multiplier: t.number,\n  labels: t.type({\n    de: t.string,\n    fr: t.string,\n    it: t.string,\n    en: t.string,\n  }),\n});\nexport type ConversionUnit = t.TypeOf<typeof ConversionUnit>;\n\nconst GenericChartConfig = t.type({\n  key: t.string,\n  version: t.string,\n  meta: Meta,\n  cubes: t.array(Cube),\n  interactiveFiltersConfig: InteractiveFiltersConfig,\n  annotations: t.array(Annotation),\n  limits: t.record(t.string, t.array(Limit)),\n  conversionUnitsByComponentId: t.record(t.string, ConversionUnit),\n  activeField: t.union([t.string, t.undefined]),\n});\n\nexport type GenericChartConfig = t.TypeOf<typeof GenericChartConfig>;\n\nconst ShowTitleFieldExtension = t.partial({\n  showTitle: t.boolean,\n});\nexport type ShowTitleFieldExtension = t.TypeOf<typeof ShowTitleFieldExtension>;\n\nconst ShowValuesFieldExtension = t.partial({\n  showValues: t.boolean,\n});\nexport type ShowValuesFieldExtension = t.TypeOf<\n  typeof ShowValuesFieldExtension\n>;\n\nconst UncertaintyFieldExtension = t.partial({\n  showStandardError: t.boolean,\n  showConfidenceInterval: t.boolean,\n});\nexport type UncertaintyFieldExtension = t.TypeOf<\n  typeof UncertaintyFieldExtension\n>;\n\nconst CustomScaleDomainFieldExtension = t.partial({\n  customDomain: t.tuple([t.number, t.number]),\n});\nexport type CustomScaleDomainFieldExtension = t.TypeOf<\n  typeof CustomScaleDomainFieldExtension\n>;\n\nconst ChartSubType = t.union([t.literal(\"stacked\"), t.literal(\"grouped\")]);\nexport type ChartSubType = t.TypeOf<typeof ChartSubType>;\n\nconst ColumnSegmentField = t.intersection([\n  GenericField,\n  SortingField,\n  t.type({ type: ChartSubType }),\n  ShowTitleFieldExtension,\n  ShowValuesBySegmentFieldExtension,\n]);\nexport type ColumnSegmentField = t.TypeOf<typeof ColumnSegmentField>;\n\nconst ColumnFields = t.intersection([\n  t.type({\n    x: t.intersection([GenericField, SortingField]),\n    y: t.intersection([\n      GenericField,\n      ShowValuesFieldExtension,\n      UncertaintyFieldExtension,\n      CustomScaleDomainFieldExtension,\n    ]),\n    color: t.union([SegmentColorField, SingleColorField]),\n  }),\n  t.partial({\n    segment: ColumnSegmentField,\n    animation: AnimationField,\n  }),\n]);\nexport type ColumnFields = t.TypeOf<typeof ColumnFields>;\n\nconst ColumnConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"column\"),\n      fields: ColumnFields,\n    },\n    \"ColumnConfig\"\n  ),\n]);\nexport type ColumnConfig = t.TypeOf<typeof ColumnConfig>;\n\nconst BarSegmentField = t.intersection([\n  GenericField,\n  SortingField,\n  t.type({ type: ChartSubType }),\n  ShowTitleFieldExtension,\n  ShowValuesBySegmentFieldExtension,\n]);\nexport type BarSegmentField = t.TypeOf<typeof BarSegmentField>;\n\nconst BarFields = t.intersection([\n  t.type({\n    x: t.intersection([\n      GenericField,\n      ShowValuesFieldExtension,\n      CustomScaleDomainFieldExtension,\n    ]),\n    y: t.intersection([GenericField, SortingField]),\n    color: t.union([SegmentColorField, SingleColorField]),\n  }),\n  t.partial({\n    segment: BarSegmentField,\n    animation: AnimationField,\n  }),\n]);\nexport type BarFields = t.TypeOf<typeof BarFields>;\n\nconst BarConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"bar\"),\n      fields: BarFields,\n    },\n    \"BarConfig\"\n  ),\n]);\nexport type BarConfig = t.TypeOf<typeof BarConfig>;\n\nconst LineSegmentField = t.intersection([\n  GenericField,\n  SortingField,\n  ShowTitleFieldExtension,\n  ShowValuesBySegmentFieldExtension,\n]);\nexport type LineSegmentField = t.TypeOf<typeof LineSegmentField>;\n\nconst ShowDotsSize = t.union([\n  t.literal(\"Small\"),\n  t.literal(\"Medium\"),\n  t.literal(\"Large\"),\n]);\nexport type ShowDotsSize = t.TypeOf<typeof ShowDotsSize>;\n\nconst LineFields = t.intersection([\n  t.type({\n    x: GenericField,\n    y: t.intersection([\n      GenericField,\n      ShowValuesFieldExtension,\n      UncertaintyFieldExtension,\n      CustomScaleDomainFieldExtension,\n      t.partial({\n        showDots: t.boolean,\n        showDotsSize: ShowDotsSize,\n      }),\n    ]),\n    color: t.union([SegmentColorField, SingleColorField]),\n  }),\n  t.partial({\n    segment: LineSegmentField,\n  }),\n]);\nexport type LineFields = t.TypeOf<typeof LineFields>;\n\nconst LineConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"line\"),\n      fields: LineFields,\n    },\n    \"LineConfig\"\n  ),\n]);\nexport type LineConfig = t.TypeOf<typeof LineConfig>;\n\nconst AreaSegmentField = t.intersection([\n  GenericField,\n  SortingField,\n  ShowTitleFieldExtension,\n  ShowValuesBySegmentFieldExtension,\n]);\nexport type AreaSegmentField = t.TypeOf<typeof AreaSegmentField>;\n\nconst ImputationType = t.union([\n  t.literal(\"none\"),\n  t.literal(\"zeros\"),\n  t.literal(\"linear\"),\n]);\nexport type ImputationType = t.TypeOf<typeof ImputationType>;\nexport const IMPUTATION_TYPES: ImputationType[] = [\"none\", \"zeros\", \"linear\"];\n\nconst AreaFields = t.intersection([\n  t.type({\n    x: GenericField,\n    y: t.intersection([\n      GenericField,\n      ShowValuesFieldExtension,\n      CustomScaleDomainFieldExtension,\n      t.partial({ imputationType: ImputationType }),\n    ]),\n    color: t.union([SegmentColorField, SingleColorField]),\n  }),\n  t.partial({\n    segment: AreaSegmentField,\n  }),\n]);\nexport type AreaFields = t.TypeOf<typeof AreaFields>;\n\nconst AreaConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"area\"),\n      fields: AreaFields,\n    },\n    \"AreaConfig\"\n  ),\n]);\nexport type AreaConfig = t.TypeOf<typeof AreaConfig>;\n\nconst ScatterPlotSegmentField = t.intersection([\n  GenericField,\n  ShowTitleFieldExtension,\n  ShowValuesBySegmentFieldExtension,\n]);\nexport type ScatterPlotSegmentField = t.TypeOf<typeof ScatterPlotSegmentField>;\n\nconst ScatterPlotFields = t.intersection([\n  t.type({\n    x: GenericField,\n    y: GenericField,\n    color: t.union([SegmentColorField, SingleColorField]),\n  }),\n  t.partial({\n    segment: ScatterPlotSegmentField,\n    animation: AnimationField,\n  }),\n]);\nexport type ScatterPlotFields = t.TypeOf<typeof ScatterPlotFields>;\n\nconst ScatterPlotConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"scatterplot\"),\n      fields: ScatterPlotFields,\n    },\n    \"ScatterPlotConfig\"\n  ),\n]);\nexport type ScatterPlotConfig = t.TypeOf<typeof ScatterPlotConfig>;\n\nconst PieSegmentField = t.intersection([\n  GenericField,\n  SortingField,\n  ShowTitleFieldExtension,\n  ShowValuesBySegmentFieldExtension,\n]);\nexport type PieSegmentField = t.TypeOf<typeof PieSegmentField>;\n\nconst PieFields = t.intersection([\n  t.type({\n    y: t.intersection([GenericField, ShowValuesFieldExtension]),\n    segment: PieSegmentField,\n    color: SegmentColorField,\n  }),\n  t.partial({ animation: AnimationField }),\n]);\nexport type PieFields = t.TypeOf<typeof PieFields>;\n\nconst PieConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"pie\"),\n      fields: PieFields,\n    },\n    \"PieConfig\"\n  ),\n]);\nexport type PieConfig = t.TypeOf<typeof PieConfig>;\n\nconst DivergingPaletteType = t.union([\n  t.literal(\"BrBG\"),\n  t.literal(\"PiYG\"),\n  t.literal(\"PRGn\"),\n  t.literal(\"PuOr\"),\n  t.literal(\"RdBu\"),\n  t.literal(\"RdYlBu\"),\n  t.literal(\"RdYlGn\"),\n]);\nexport type DivergingPaletteType = t.TypeOf<typeof DivergingPaletteType>;\n\nconst SequentialPaletteType = t.union([\n  t.literal(\"blues\"),\n  t.literal(\"greens\"),\n  t.literal(\"greys\"),\n  t.literal(\"oranges\"),\n  t.literal(\"purples\"),\n  t.literal(\"reds\"),\n]);\nexport type SequentialPaletteType = t.TypeOf<typeof SequentialPaletteType>;\n\nconst DimensionPaletteType = t.literal(\"dimension\");\nconst CategoricalPaletteType = t.union([\n  DimensionPaletteType,\n  t.literal(\"accent\"),\n  t.literal(\"category10\"),\n  t.literal(\"dark2\"),\n  t.literal(\"paired\"),\n  t.literal(\"pastel1\"),\n  t.literal(\"pastel2\"),\n  t.literal(\"set1\"),\n  t.literal(\"set2\"),\n  t.literal(\"set3\"),\n  t.literal(\"tableau10\"),\n]);\n\nexport type CategoricalPaletteType = t.TypeOf<typeof CategoricalPaletteType>;\n\nconst DivergingPalette = t.type({\n  type: t.literal(\"diverging\"),\n  paletteId: DivergingPaletteType,\n  name: DivergingPaletteType,\n});\n\nconst SequentialPalette = t.type({\n  type: t.literal(\"sequential\"),\n  paletteId: SequentialPaletteType,\n  name: SequentialPaletteType,\n});\n\nconst CategoricalPalette = t.type({\n  type: t.literal(\"categorical\"),\n  paletteId: CategoricalPaletteType,\n  name: CategoricalPaletteType,\n});\n\nconst CustomPalette = t.type({\n  type: t.union([\n    t.literal(\"diverging\"),\n    t.literal(\"sequential\"),\n    t.literal(\"categorical\"),\n  ]),\n  paletteId: t.string,\n  name: t.string,\n  colors: t.array(t.string),\n});\n\nexport type CustomPaletteType = t.TypeOf<typeof CustomPalette>;\nexport const convertPaletteTypeToDBType = (\n  type: CustomPaletteType[\"type\"]\n): PALETTE_TYPE => {\n  switch (type) {\n    case \"diverging\":\n      return \"DIVERGING\";\n    case \"sequential\":\n      return \"SEQUENTIAL\";\n    case \"categorical\":\n      return \"CATEGORICAL\";\n    default:\n      const _exhaustiveCheck: never = type;\n      return _exhaustiveCheck;\n  }\n};\n\nexport const convertDBTypeToPaletteType = (\n  type: PALETTE_TYPE\n): CustomPaletteType[\"type\"] => {\n  switch (type) {\n    case \"DIVERGING\":\n      return \"diverging\";\n    case \"SEQUENTIAL\":\n      return \"sequential\";\n    case \"CATEGORICAL\":\n      return \"categorical\";\n    default:\n      const _exhaustiveCheck: never = type;\n      return _exhaustiveCheck;\n  }\n};\n\nexport const PaletteType = t.union([\n  DivergingPalette,\n  SequentialPalette,\n  CategoricalPalette,\n  CustomPalette,\n]);\n\nexport type PaletteType = t.TypeOf<typeof PaletteType>;\n\nconst ColorScaleType = t.union([\n  t.literal(\"continuous\"),\n  t.literal(\"discrete\"),\n]);\nexport type ColorScaleType = t.TypeOf<typeof ColorScaleType>;\n\nconst ColorScaleInterpolationType = t.union([\n  t.literal(\"linear\"),\n  t.literal(\"quantize\"),\n  t.literal(\"quantile\"),\n  t.literal(\"jenks\"),\n]);\nexport type ColorScaleInterpolationType = t.TypeOf<\n  typeof ColorScaleInterpolationType\n>;\n\nconst ColumnTextStyle = t.union([t.literal(\"regular\"), t.literal(\"bold\")]);\n\nconst ColumnStyleText = t.type({\n  type: t.literal(\"text\"),\n  textStyle: ColumnTextStyle,\n  textColor: t.string,\n  columnColor: t.string,\n});\nconst ColumnStyleCategory = t.type({\n  type: t.literal(\"category\"),\n  textStyle: ColumnTextStyle,\n  paletteId: t.string,\n  colorMapping: ColorMapping,\n});\nconst ColumnStyleHeatmap = t.type({\n  type: t.literal(\"heatmap\"),\n  textStyle: ColumnTextStyle,\n  paletteId: DivergingPaletteType,\n});\nconst ColumnStyleBar = t.type({\n  type: t.literal(\"bar\"),\n  textStyle: ColumnTextStyle,\n  barColorPositive: t.string,\n  barColorNegative: t.string,\n  barColorBackground: t.string,\n  barShowBackground: t.boolean,\n});\nconst ColumnStyle = t.union([\n  ColumnStyleText,\n  ColumnStyleCategory,\n  ColumnStyleHeatmap,\n  ColumnStyleBar,\n]);\nexport type ColumnStyle = t.TypeOf<typeof ColumnStyle>;\n\nexport type ColumnStyleText = t.TypeOf<typeof ColumnStyleText>;\nexport type ColumnStyleCategory = t.TypeOf<typeof ColumnStyleCategory>;\nexport type ColumnStyleHeatmap = t.TypeOf<typeof ColumnStyleHeatmap>;\nexport type ColumnStyleBar = t.TypeOf<typeof ColumnStyleBar>;\n\nconst TableColumn = t.type({\n  componentId: t.string,\n  componentType: ComponentType,\n  index: t.number,\n  isGroup: t.boolean,\n  isHidden: t.boolean,\n  columnStyle: ColumnStyle,\n});\nexport type TableColumn = t.TypeOf<typeof TableColumn>;\n\nconst TableSettings = t.type({\n  showSearch: t.boolean,\n  showAllRows: t.boolean,\n});\nexport type TableSettings = t.TypeOf<typeof TableSettings>;\n\nconst TableLinks = t.type({\n  enabled: t.boolean,\n  baseUrl: t.string,\n  componentId: t.string,\n  targetComponentId: t.string,\n});\nexport type TableLinks = t.TypeOf<typeof TableLinks>;\n\nconst TableFields = t.record(t.string, TableColumn);\nexport type TableFields = t.TypeOf<typeof TableFields>;\n\nconst TableSortingOption = t.type({\n  componentId: t.string,\n  componentType: ComponentType,\n  sortingOrder: SortingOrder,\n});\nexport type TableSortingOption = t.TypeOf<typeof TableSortingOption>;\n\nconst TableConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"table\"),\n      fields: TableFields,\n      settings: TableSettings,\n      links: TableLinks,\n      sorting: t.array(TableSortingOption),\n    },\n    \"TableConfig\"\n  ),\n]);\nexport type TableConfig = t.TypeOf<typeof TableConfig>;\n\nconst BBox = t.tuple([\n  t.tuple([t.number, t.number]),\n  t.tuple([t.number, t.number]),\n]);\nexport type BBox = t.TypeOf<typeof BBox>;\n\nconst ColorFieldOpacity = t.type({\n  opacity: t.number,\n});\nexport type ColorFieldOpacity = t.TypeOf<typeof ColorFieldOpacity>;\n\nconst ColorFieldType = t.union([\n  t.literal(\"fixed\"),\n  t.literal(\"categorical\"),\n  t.literal(\"numerical\"),\n]);\nexport type ColorFieldType = t.TypeOf<typeof ColorFieldType>;\n\nconst FixedColorField = t.intersection([\n  t.type({\n    type: t.literal(\"fixed\"),\n    value: t.string,\n  }),\n  ColorFieldOpacity,\n]);\nexport type FixedColorField = t.TypeOf<typeof FixedColorField>;\n\nconst CategoricalColorField = t.intersection([\n  t.type({\n    type: t.literal(\"categorical\"),\n    componentId: t.string,\n    paletteId: t.string,\n    colorMapping: ColorMapping,\n  }),\n  t.partial({ useAbbreviations: t.boolean }),\n  ColorFieldOpacity,\n]);\n\nexport type CategoricalColorField = t.TypeOf<typeof CategoricalColorField>;\n\nconst NumericalColorField = t.intersection([\n  t.type({\n    type: t.literal(\"numerical\"),\n    componentId: t.string,\n    paletteId: t.string,\n  }),\n  t.partial({\n    paletteType: t.union([t.literal(\"sequential\"), t.literal(\"diverging\")]),\n    colors: t.array(t.string),\n  }),\n  t.union([\n    t.type({\n      scaleType: t.literal(\"continuous\"),\n      interpolationType: t.literal(\"linear\"),\n    }),\n    t.type({\n      scaleType: t.literal(\"discrete\"),\n      interpolationType: t.union([\n        t.literal(\"quantize\"),\n        t.literal(\"quantile\"),\n        t.literal(\"jenks\"),\n      ]),\n      nbClass: t.number,\n    }),\n  ]),\n  ColorFieldOpacity,\n]);\n\nexport type NumericalColorField = t.TypeOf<typeof NumericalColorField>;\n\nexport type MapColorField =\n  | FixedColorField\n  | CategoricalColorField\n  | NumericalColorField;\n\nconst MapAreaLayer = t.type({\n  componentId: t.string,\n  // FIXME: convert to new color field type\n  color: t.union([CategoricalColorField, NumericalColorField]),\n});\nexport type MapAreaLayer = t.TypeOf<typeof MapAreaLayer>;\n\nconst MapSymbolLayer = t.type({\n  componentId: t.string,\n  /** Symbol radius (size) */\n  measureId: t.string,\n  // FIXME: convert to new color field type\n  color: t.union([FixedColorField, CategoricalColorField, NumericalColorField]),\n});\nexport type MapSymbolLayer = t.TypeOf<typeof MapSymbolLayer>;\n\nconst BaseCustomLayer = t.type({\n  id: t.string,\n  isBehindAreaLayer: t.boolean,\n  syncTemporalFilters: t.boolean,\n  endpoint: t.union([t.string, t.undefined]),\n});\nexport type BaseCustomLayer = t.TypeOf<typeof BaseCustomLayer>;\n\nconst WMSCustomLayer = t.intersection([\n  t.type({\n    type: t.literal(\"wms\"),\n    endpoint: t.string,\n  }),\n  BaseCustomLayer,\n]);\nexport type WMSCustomLayer = t.TypeOf<typeof WMSCustomLayer>;\nexport const getWMSCustomLayers = (\n  customLayers: BaseLayer[\"customLayers\"]\n): WMSCustomLayer[] => {\n  return customLayers.filter((l) => l.type === \"wms\") as WMSCustomLayer[];\n};\n\nconst WMTSCustomLayer = t.intersection([\n  t.type({\n    type: t.literal(\"wmts\"),\n    url: t.string,\n  }),\n  BaseCustomLayer,\n]);\nexport type WMTSCustomLayer = t.TypeOf<typeof WMTSCustomLayer>;\nexport const getWMTSCustomLayers = (\n  customLayers: BaseLayer[\"customLayers\"]\n): WMTSCustomLayer[] => {\n  return customLayers.filter((l) => l.type === \"wmts\") as WMTSCustomLayer[];\n};\n\nconst BaseLayer = t.type({\n  show: t.boolean,\n  locked: t.boolean,\n  bbox: t.union([BBox, t.undefined]),\n  customLayers: t.array(t.union([WMSCustomLayer, WMTSCustomLayer])),\n});\nexport type BaseLayer = t.TypeOf<typeof BaseLayer>;\n\nconst MapFields = t.partial({\n  areaLayer: MapAreaLayer,\n  symbolLayer: MapSymbolLayer,\n  animation: AnimationField,\n});\nexport type MapFields = t.TypeOf<typeof MapFields>;\n\nconst MapConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"map\"),\n      fields: MapFields,\n      baseLayer: BaseLayer,\n    },\n    \"MapConfig\"\n  ),\n]);\nexport type MapConfig = t.TypeOf<typeof MapConfig>;\n\nconst ComboLineSingleFields = t.type({\n  x: GenericField,\n  y: t.type({\n    componentIds: t.array(t.string),\n  }),\n  color: MeasuresColorField,\n});\nexport type ComboLineSingleFields = t.TypeOf<typeof ComboLineSingleFields>;\n\nconst ComboLineSingleConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"comboLineSingle\"),\n      fields: ComboLineSingleFields,\n    },\n    \"ComboLineSingleConfig\"\n  ),\n]);\nexport type ComboLineSingleConfig = t.TypeOf<typeof ComboLineSingleConfig>;\n\nconst ComboLineDualFields = t.type({\n  x: GenericField,\n  y: t.type({\n    leftAxisComponentId: t.string,\n    rightAxisComponentId: t.string,\n  }),\n  color: MeasuresColorField,\n});\nexport type ComboLineDualFields = t.TypeOf<typeof ComboLineDualFields>;\n\nconst ComboLineDualConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"comboLineDual\"),\n      fields: ComboLineDualFields,\n    },\n    \"ComboLineDualConfig\"\n  ),\n]);\nexport type ComboLineDualConfig = t.TypeOf<typeof ComboLineDualConfig>;\n\nconst ComboLineColumnFields = t.type({\n  x: GenericField,\n  y: t.type({\n    lineComponentId: t.string,\n    lineAxisOrientation: t.union([t.literal(\"left\"), t.literal(\"right\")]),\n    columnComponentId: t.string,\n  }),\n  color: MeasuresColorField,\n});\n\nexport type ComboLineColumnFields = t.TypeOf<typeof ComboLineColumnFields>;\n\nconst ComboLineColumnConfig = t.intersection([\n  GenericChartConfig,\n  t.type(\n    {\n      chartType: t.literal(\"comboLineColumn\"),\n      fields: ComboLineColumnFields,\n    },\n    \"ComboLineColumnConfig\"\n  ),\n]);\nexport type ComboLineColumnConfig = t.TypeOf<typeof ComboLineColumnConfig>;\n\nexport type ChartSegmentField =\n  | AreaSegmentField\n  | BarSegmentField\n  | ColumnSegmentField\n  | LineSegmentField\n  | PieSegmentField\n  | ScatterPlotSegmentField;\n\nconst RegularChartConfig = t.union([\n  AreaConfig,\n  ColumnConfig,\n  BarConfig,\n  LineConfig,\n  MapConfig,\n  PieConfig,\n  ScatterPlotConfig,\n  TableConfig,\n]);\nexport type RegularChartConfig = t.TypeOf<typeof RegularChartConfig>;\n\nconst ComboChartConfig = t.union([\n  ComboLineSingleConfig,\n  ComboLineDualConfig,\n  ComboLineColumnConfig,\n]);\nexport type ComboChartConfig = t.TypeOf<typeof ComboChartConfig>;\n\nexport const ChartConfig = t.union([RegularChartConfig, ComboChartConfig]);\nexport type ChartConfig = t.TypeOf<typeof ChartConfig>;\n\nexport const decodeChartConfig = (\n  chartConfig: unknown\n): ChartConfig | undefined => {\n  return pipe(\n    ChartConfig.decode(chartConfig),\n    fold(\n      (err) => {\n        console.error(\"Error while decoding chart config\", err);\n        return undefined;\n      },\n      (d) => d\n    )\n  );\n};\n\nexport type ChartType = ChartConfig[\"chartType\"];\nexport type RegularChartType = RegularChartConfig[\"chartType\"];\nexport type ComboChartType = ComboChartConfig[\"chartType\"];\n\nexport const isComboChartConfig = (\n  chartConfig: ChartConfig\n): chartConfig is ComboChartConfig => {\n  return (\n    isComboLineSingleConfig(chartConfig) ||\n    isComboLineDualConfig(chartConfig) ||\n    isComboLineColumnConfig(chartConfig)\n  );\n};\n\nexport const fieldHasComponentId = (chartConfig: ChartConfig) => {\n  const validFields = Object.entries(chartConfig.fields).reduce(\n    (acc, [key, field]) => {\n      if (field && typeof field.componentId === \"string\") {\n        acc[key] = field;\n      }\n      return acc;\n    },\n    {} as { [key: string]: GenericField }\n  );\n\n  return validFields as {\n    [s: string]: { componentId: string } & {\n      useAbbreviations?: boolean | undefined;\n    };\n  };\n};\n\nexport const isAreaConfig = (\n  chartConfig: ChartConfig\n): chartConfig is AreaConfig => {\n  return chartConfig.chartType === \"area\";\n};\n\nexport const isColumnConfig = (\n  chartConfig: ChartConfig\n): chartConfig is ColumnConfig => {\n  return chartConfig.chartType === \"column\";\n};\n\nexport const isBarConfig = (\n  chartConfig: ChartConfig\n): chartConfig is BarConfig => {\n  return chartConfig.chartType === \"bar\";\n};\n\nexport const isComboLineSingleConfig = (\n  chartConfig: ChartConfig\n): chartConfig is ComboLineSingleConfig => {\n  return chartConfig.chartType === \"comboLineSingle\";\n};\n\nexport const isComboLineDualConfig = (\n  chartConfig: ChartConfig\n): chartConfig is ComboLineDualConfig => {\n  return chartConfig.chartType === \"comboLineDual\";\n};\n\nexport const isComboLineColumnConfig = (\n  chartConfig: ChartConfig\n): chartConfig is ComboLineColumnConfig => {\n  return chartConfig.chartType === \"comboLineColumn\";\n};\n\nexport const isLineConfig = (\n  chartConfig: ChartConfig\n): chartConfig is LineConfig => {\n  return chartConfig.chartType === \"line\";\n};\n\nexport const isScatterPlotConfig = (\n  chartConfig: ChartConfig\n): chartConfig is ScatterPlotConfig => {\n  return chartConfig.chartType === \"scatterplot\";\n};\n\nexport const isPieConfig = (\n  chartConfig: ChartConfig\n): chartConfig is PieConfig => {\n  return chartConfig.chartType === \"pie\";\n};\n\nexport const isTableConfig = (\n  chartConfig: ChartConfig\n): chartConfig is TableConfig => {\n  return chartConfig.chartType === \"table\";\n};\n\nexport const isMapConfig = (\n  chartConfig: ChartConfig\n): chartConfig is MapConfig => {\n  return chartConfig.chartType === \"map\";\n};\n\nexport const canBeNormalized = (\n  chartConfig: ChartConfig\n): chartConfig is AreaConfig | ColumnConfig | BarConfig => {\n  return (\n    chartConfig.chartType === \"area\" ||\n    (chartConfig.chartType === \"column\" &&\n      chartConfig.fields.segment !== undefined &&\n      chartConfig.fields.segment.type === \"stacked\") ||\n    (chartConfig.chartType === \"bar\" &&\n      chartConfig.fields.segment !== undefined &&\n      chartConfig.fields.segment.type === \"stacked\")\n  );\n};\n\nexport const isSegmentInConfig = (\n  chartConfig: ChartConfig\n): chartConfig is\n  | AreaConfig\n  | ColumnConfig\n  | BarConfig\n  | LineConfig\n  | PieConfig\n  | ScatterPlotConfig => {\n  return [\"area\", \"column\", \"bar\", \"line\", \"pie\", \"scatterplot\"].includes(\n    chartConfig.chartType\n  );\n};\n\nexport const isColorInConfig = (\n  chartConfig: ChartConfig\n): chartConfig is Exclude<ChartConfig, { chartType: \"table\" | \"map\" }> => {\n  return !isTableConfig(chartConfig) && !isMapConfig(chartConfig);\n};\n\nexport const isNotTableOrMap = (chartConfig: ChartConfig) => {\n  return !isTableConfig(chartConfig) && !isMapConfig(chartConfig);\n};\n\nexport const isSortingInConfig = (\n  chartConfig: ChartConfig\n): chartConfig is\n  | AreaConfig\n  | ColumnConfig\n  | BarConfig\n  | LineConfig\n  | PieConfig => {\n  return [\"area\", \"column\", \"bar\", \"line\", \"pie\"].includes(\n    chartConfig.chartType\n  );\n};\n\nexport const isAnimationInConfig = (\n  chartConfig: ChartConfig\n): chartConfig is\n  | ColumnConfig\n  | BarConfig\n  | MapConfig\n  | PieConfig\n  | ScatterPlotConfig => {\n  return [\"column\", \"bar\", \"map\", \"pie\", \"scatterplot\"].includes(\n    chartConfig.chartType\n  );\n};\n\nexport const getAnimationField = (\n  chartConfig: ChartConfig\n): AnimationField | undefined => {\n  if (isAnimationInConfig(chartConfig)) {\n    return chartConfig.fields.animation;\n  }\n};\n\nexport const isColorFieldInConfig = (\n  chartConfig: ChartConfig\n): chartConfig is MapConfig => {\n  return isMapConfig(chartConfig);\n};\n\nconst DataSource = t.type({\n  type: t.union([t.literal(\"sql\"), t.literal(\"sparql\")]),\n  url: t.string,\n});\nexport type DataSource = t.TypeOf<typeof DataSource>;\n\nconst ResizeHandle = t.keyof({\n  s: null,\n  w: null,\n  e: null,\n  n: null,\n  sw: null,\n  nw: null,\n  se: null,\n  ne: null,\n});\n\nconst ReactGridLayoutType = t.type({\n  w: t.number,\n  h: t.number,\n  minH: t.union([t.number, t.undefined]),\n  x: t.number,\n  y: t.number,\n  i: t.string,\n  resizeHandles: t.union([t.array(ResizeHandle), t.undefined]),\n});\nexport type ReactGridLayoutType = t.TypeOf<typeof ReactGridLayoutType>;\n\nexport const ReactGridLayoutsType = t.record(\n  t.string,\n  t.array(ReactGridLayoutType)\n);\nexport type ReactGridLayoutsType = t.TypeOf<typeof ReactGridLayoutsType>;\n\nconst LayoutChartBlock = t.type({\n  type: t.literal(\"chart\"),\n  key: t.string,\n});\nexport type LayoutChartBlock = t.TypeOf<typeof LayoutChartBlock>;\n\nconst LayoutTextBlock = t.type({\n  type: t.literal(\"text\"),\n  key: t.string,\n  text: t.type({\n    de: t.string,\n    fr: t.string,\n    it: t.string,\n    en: t.string,\n  }),\n});\nexport type LayoutTextBlock = t.TypeOf<typeof LayoutTextBlock>;\n\nconst LayoutBlock = t.intersection([\n  t.union([LayoutChartBlock, LayoutTextBlock]),\n  t.type({ initialized: t.boolean }),\n]);\nexport type LayoutBlock = t.TypeOf<typeof LayoutBlock>;\n\nconst Layout = t.intersection([\n  t.type({\n    activeField: t.union([t.undefined, t.string]),\n    meta: Meta,\n    blocks: t.array(LayoutBlock),\n  }),\n  t.union([\n    t.type({\n      type: t.literal(\"tab\"),\n    }),\n    t.type({\n      type: t.literal(\"dashboard\"),\n      layout: t.union([t.literal(\"vertical\"), t.literal(\"tall\")]),\n    }),\n    t.type({\n      type: t.literal(\"dashboard\"),\n      layout: t.literal(\"canvas\"),\n      layouts: ReactGridLayoutsType,\n    }),\n    t.type({\n      type: t.literal(\"singleURLs\"),\n      publishableChartKeys: t.array(t.string),\n    }),\n  ]),\n]);\nexport type Layout = t.TypeOf<typeof Layout>;\nexport type LayoutType = Layout[\"type\"];\nexport type LayoutDashboard = Extract<Layout, { type: \"dashboard\" }>;\nexport type LayoutDashboardFreeCanvas = Extract<\n  Layout,\n  { type: \"dashboard\"; layout: \"canvas\" }\n>;\n\nconst DashboardTimeRangeFilter = t.type({\n  active: t.boolean,\n  timeUnit: t.string,\n  presets: t.type({\n    from: t.string,\n    to: t.string,\n  }),\n});\nexport type DashboardTimeRangeFilter = t.TypeOf<\n  typeof DashboardTimeRangeFilter\n>;\n\nconst DashboardDataFiltersConfig = t.type({\n  componentIds: t.array(t.string),\n  filters: SingleFilters,\n});\nexport type DashboardDataFiltersConfig = t.TypeOf<\n  typeof DashboardDataFiltersConfig\n>;\n\nconst DashboardFiltersConfig = t.type({\n  timeRange: DashboardTimeRangeFilter,\n  dataFilters: DashboardDataFiltersConfig,\n});\nexport type DashboardFiltersConfig = t.TypeOf<typeof DashboardFiltersConfig>;\n\nexport const areDataFiltersActive = (\n  dashboardFilters: DashboardFiltersConfig | undefined\n) => {\n  return !!dashboardFilters?.dataFilters.componentIds.length;\n};\n\nconst Config = t.intersection([\n  t.type(\n    {\n      version: t.string,\n      dataSource: DataSource,\n      layout: Layout,\n      chartConfigs: t.array(ChartConfig),\n      activeChartKey: t.string,\n      dashboardFilters: t.union([DashboardFiltersConfig, t.undefined]),\n    },\n    \"Config\"\n  ),\n  t.partial({ key: t.string }),\n]);\n\nexport type Config = t.TypeOf<typeof Config>;\n\nconst ConfiguratorStateInitial = t.type({\n  state: t.literal(\"INITIAL\"),\n  version: t.string,\n  dataSource: DataSource,\n});\nexport type ConfiguratorStateInitial = t.TypeOf<\n  typeof ConfiguratorStateInitial\n>;\n\nconst ConfiguratorStateSelectingDataSet = t.type({\n  state: t.literal(\"SELECTING_DATASET\"),\n  version: t.string,\n  dataSource: DataSource,\n  chartConfigs: t.undefined,\n  layout: t.undefined,\n  activeChartKey: t.undefined,\n});\nexport type ConfiguratorStateSelectingDataSet = t.TypeOf<\n  typeof ConfiguratorStateSelectingDataSet\n>;\n\nconst ConfiguratorStateConfiguringChart = t.intersection([\n  t.type({ state: t.literal(\"CONFIGURING_CHART\") }),\n  Config,\n]);\nexport type ConfiguratorStateConfiguringChart = t.TypeOf<\n  typeof ConfiguratorStateConfiguringChart\n>;\n\nexport const CONFIGURATOR_STATE_LAYOUTING = \"LAYOUTING\";\n\nconst ConfiguratorStateLayouting = t.intersection([\n  t.type({ state: t.literal(CONFIGURATOR_STATE_LAYOUTING) }),\n  Config,\n]);\nexport type ConfiguratorStateLayouting = t.TypeOf<\n  typeof ConfiguratorStateLayouting\n>;\n\nexport const enableLayouting = (\n  state:\n    | ConfiguratorStateConfiguringChart\n    | ConfiguratorStateLayouting\n    | ConfiguratorStatePublishing\n    | ConfiguratorStatePublished\n) => {\n  return state.chartConfigs.length > 1;\n};\n\nconst ConfiguratorStatePublishing = t.intersection([\n  t.type({\n    state: t.literal(\"PUBLISHING\"),\n  }),\n  Config,\n]);\nexport type ConfiguratorStatePublishing = t.TypeOf<\n  typeof ConfiguratorStatePublishing\n>;\n\nconst ConfiguratorStatePublished = t.intersection([\n  t.type({\n    state: t.literal(\"PUBLISHED\"),\n  }),\n  Config,\n]);\nexport type ConfiguratorStatePublished = t.TypeOf<\n  typeof ConfiguratorStatePublished\n>;\n\nexport const ConfiguratorState = t.union([\n  ConfiguratorStateInitial,\n  ConfiguratorStateSelectingDataSet,\n  ConfiguratorStateConfiguringChart,\n  ConfiguratorStateLayouting,\n  ConfiguratorStatePublishing,\n  ConfiguratorStatePublished,\n]);\nexport type ConfiguratorState = t.TypeOf<typeof ConfiguratorState>;\n\nexport const decodeConfiguratorState = (\n  state: unknown\n): ConfiguratorState | undefined => {\n  return pipe(\n    ConfiguratorState.decode(state),\n    fold(\n      (err) => {\n        console.error(\"Error while decoding configurator state\", err);\n        return undefined;\n      },\n      (d) => d\n    )\n  );\n};\n","import { bisectCenter } from \"d3-array\";\nimport { useMemo } from \"react\";\n\nimport {\n  ChartConfig,\n  ConfiguratorState,\n  Cube,\n  Filters,\n  FilterValue,\n  FilterValueMulti,\n  FilterValueSingle,\n  getAnimationField,\n  Limit as ConfigLimit,\n  SingleFilters,\n} from \"@/config-types\";\nimport { useConfiguratorState } from \"@/configurator/configurator-state\";\nimport {\n  Dimension,\n  isTemporalDimensionWithTimeUnit,\n  Measure,\n  ObservationValue,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { mkJoinById } from \"@/graphql/join\";\nimport { Limit } from \"@/rdf/limits\";\nimport {\n  useChartInteractiveFilters,\n  useDashboardInteractiveFilters,\n} from \"@/stores/interactive-filters\";\n\nconst isFilterValueSingle = (v: FilterValue): v is FilterValueSingle => {\n  return v.type === \"single\";\n};\n\nexport const isSingleFilters = (filters: Filters): filters is SingleFilters => {\n  return Object.values(filters).every(isFilterValueSingle);\n};\n\nexport const extractSingleFilters = (filters: Filters): SingleFilters => {\n  return Object.fromEntries(\n    Object.entries(filters).filter(([, value]) => value.type === \"single\")\n  ) as SingleFilters;\n};\n\nexport const makeMultiFilter = (\n  values: ObservationValue[]\n): FilterValueMulti => {\n  return {\n    type: \"multi\",\n    values: Object.fromEntries(values.map((d) => [d, true])),\n  };\n};\n\n/** Use to extract the chart config from configurator state. Handy in the editor mode,\n * where the is a need to edit the active chart config.\n *\n * @param state configurator state\n * @param chartKey optional chart key. If not provided, the active chart config will be returned.\n *\n */\nexport const getChartConfig = (\n  state: ConfiguratorState,\n  chartKey?: string | null\n): ChartConfig => {\n  if (state.state === \"INITIAL\" || state.state === \"SELECTING_DATASET\") {\n    throw Error(\"No chart config available!\");\n  }\n\n  const { chartConfigs, activeChartKey } = state;\n  const key = chartKey ?? activeChartKey;\n\n  return chartConfigs.find((d) => d.key === key) ?? chartConfigs[0];\n};\n\n/**\n * Get all filters from cubes and returns an object containing all values.\n */\nexport const getChartConfigFilters = (\n  cubes: Cube[],\n  {\n    cubeIri,\n    joined,\n  }: {\n    /** If passed, only filters for a particular cube will be considered */\n    cubeIri?: string;\n    /**\n     * If true, filters for joined dimensions will be deduped. Useful in contexts where filters\n     * for multiple join dimensions should be considered unique (for example, in the left data filters).\n     */\n    joined?: boolean;\n  } = {}\n): Filters => {\n  const relevantCubes = cubes.filter((c) =>\n    cubeIri ? c.iri === cubeIri : true\n  );\n  const dimIdToJoinId = joined\n    ? Object.fromEntries(\n        relevantCubes.flatMap((x) =>\n          (x.joinBy ?? []).map(\n            (iri, index) => [iri, mkJoinById(index)] as const\n          )\n        )\n      )\n    : {};\n\n  return Object.fromEntries(\n    relevantCubes.flatMap((c) =>\n      Object.entries(c.filters).map(([id, value]) => [\n        dimIdToJoinId[id] ?? id,\n        value,\n      ])\n    )\n  );\n};\n\nexport const useChartConfigFilters = (\n  chartConfig: ChartConfig,\n  options?: Parameters<typeof getChartConfigFilters>[1]\n): Filters => {\n  return useMemo(() => {\n    return getChartConfigFilters(chartConfig.cubes, {\n      cubeIri: options?.cubeIri,\n      joined: options?.joined,\n    });\n  }, [chartConfig.cubes, options?.cubeIri, options?.joined]);\n};\n\nexport const useDefinitiveTemporalFilterValue = ({\n  dimensions,\n}: {\n  dimensions: Dimension[];\n}) => {\n  const [state] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n  const definitiveFilters = useDefinitiveFilters();\n  const temporalDims = dimensions.filter(isTemporalDimensionWithTimeUnit);\n  const temporalFilters = Object.entries(definitiveFilters)\n    .map(([id, f]) => {\n      return temporalDims.some((d) => d.id === id) && f.type === \"single\"\n        ? f\n        : undefined;\n    })\n    .filter(truthy) as FilterValueSingle[];\n  const animationDim = temporalDims.find(\n    (d) => d.id === getAnimationField(chartConfig)?.componentId\n  );\n  const timeFormatUnit = useTimeFormatUnit();\n  const timeUnit = animationDim?.timeUnit;\n  const { value: timeSliderValue } = useChartInteractiveFilters(\n    (d) => d.timeSlider\n  );\n  const formattedTimeSliderValue =\n    timeUnit && timeSliderValue\n      ? timeFormatUnit(new Date(timeSliderValue), timeUnit)\n      : undefined;\n  const closestTemporalTimeSliderValue = useMemo(() => {\n    if (!animationDim || !formattedTimeSliderValue) {\n      return undefined;\n    }\n\n    const closesValueIndex = bisectCenter(\n      animationDim.values.map((d) => d.value) as string[],\n      formattedTimeSliderValue\n    );\n\n    return animationDim.values[closesValueIndex]?.value;\n  }, [animationDim, formattedTimeSliderValue]);\n\n  if (closestTemporalTimeSliderValue) {\n    return closestTemporalTimeSliderValue;\n  }\n\n  if (temporalFilters.length > 1) {\n    console.warn(\"More than one temporal filter found. Using the first one.\");\n  }\n\n  return temporalFilters.length === 1 ? temporalFilters[0].value : undefined;\n};\n\nexport const useDefinitiveFilters = () => {\n  const [state] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n  const filters = useChartConfigFilters(chartConfig);\n  const dataFilters = useChartInteractiveFilters((d) => d.dataFilters);\n  const dashboardFilters = useDashboardInteractiveFilters();\n  const definitiveFilters = useMemo(() => {\n    const definitiveFilters: Filters = {};\n\n    for (const [k, v] of Object.entries(filters)) {\n      definitiveFilters[k] = v;\n    }\n\n    for (const [k, v] of Object.entries(dataFilters)) {\n      definitiveFilters[k] = v;\n    }\n\n    for (const [getState] of Object.values(dashboardFilters.stores)) {\n      const state = getState();\n\n      for (const [k, v] of Object.entries(state.dataFilters)) {\n        definitiveFilters[k] = v;\n      }\n    }\n\n    return definitiveFilters;\n  }, [filters, dataFilters, dashboardFilters]);\n\n  return definitiveFilters;\n};\n\n/** Get the limit from the chart config that is related to the given measure\n * and dimension along with additional metadata.\n */\nexport const getMaybeValidChartConfigLimit = ({\n  chartConfig,\n  measureId,\n  limit,\n  axisDimension,\n  filters,\n}: {\n  chartConfig: ChartConfig;\n  measureId: string;\n  limit: Limit;\n  axisDimension?: Dimension;\n  filters: Filters;\n}): {\n  /** The limit that is valid in the context of related dimension and filters. */\n  limit: ConfigLimit | undefined;\n  /** The related value label that is valid in the context of current axis dimension. */\n  relatedAxisDimensionValueLabel: string | undefined;\n  /** If the limit would be valid in the context of current filters. */\n  wouldBeValid: boolean;\n} => {\n  const relatedAxisDimensionValue = axisDimension\n    ? limit.related.find((r) => r.dimensionId === axisDimension.id)?.value\n    : undefined;\n  const relatedAxisDimensionValueLabel = axisDimension\n    ? [...axisDimension.values, ...axisDimension.relatedLimitValues].find(\n        (v) => v.value === relatedAxisDimensionValue\n      )?.label\n    : undefined;\n  const relatedToFilterBys = axisDimension\n    ? limit.related.filter((r) => r.dimensionId !== axisDimension.id)\n    : limit.related;\n\n  for (const relatedToFilterBy of relatedToFilterBys) {\n    const maybeFilter = filters[relatedToFilterBy.dimensionId];\n    const maybeFilterValue =\n      maybeFilter && isFilterValueSingle(maybeFilter)\n        ? maybeFilter.value\n        : undefined;\n\n    if (maybeFilterValue !== relatedToFilterBy.value) {\n      return {\n        limit: undefined,\n        relatedAxisDimensionValueLabel,\n        wouldBeValid: false,\n      };\n    }\n  }\n\n  const measureConfigLimits = chartConfig.limits[measureId] ?? [];\n\n  return {\n    limit: measureConfigLimits.find((configLimit) => {\n      if (configLimit.related.length !== limit.related.length) {\n        return false;\n      }\n\n      return configLimit.related.every((cr) => {\n        return limit.related.some((lr) => {\n          return lr.dimensionId === cr.dimensionId && lr.value === cr.value;\n        });\n      });\n    }),\n    relatedAxisDimensionValueLabel,\n    wouldBeValid: true,\n  };\n};\n\nexport const getAxisDimension = ({\n  chartConfig,\n  dimensions,\n}: {\n  chartConfig: ChartConfig;\n  dimensions: Dimension[];\n}) => {\n  switch (chartConfig.chartType) {\n    case \"area\":\n    case \"column\":\n    case \"line\":\n      return dimensions.find((d) => d.id === chartConfig.fields.x.componentId);\n    case \"bar\":\n      return dimensions.find((d) => d.id === chartConfig.fields.y.componentId);\n    // For maps, we don't really have a \"related dimension\", as it's used as single filter.\n    case \"map\":\n      return;\n    // These chart types do not support the display of the limits.\n    case \"comboLineColumn\":\n    case \"comboLineDual\":\n    case \"comboLineSingle\":\n    case \"pie\":\n    case \"scatterplot\":\n    case \"table\":\n      return;\n    default:\n      const _exhaustiveCheck: never = chartConfig;\n      return _exhaustiveCheck;\n  }\n};\n\nconst getLimitMeasure = ({\n  chartConfig,\n  measures,\n}: {\n  chartConfig: ChartConfig;\n  measures: Measure[];\n}) => {\n  switch (chartConfig.chartType) {\n    case \"area\":\n    case \"column\":\n    case \"line\":\n      return measures.find((d) => d.id === chartConfig.fields.y.componentId);\n    case \"bar\":\n      return measures.find((d) => d.id === chartConfig.fields.x.componentId);\n    case \"map\":\n      return measures.find(\n        (d) => d.id === chartConfig.fields.symbolLayer?.measureId\n      );\n    case \"comboLineColumn\":\n    case \"comboLineDual\":\n    case \"comboLineSingle\":\n    case \"pie\":\n    case \"scatterplot\":\n    case \"table\":\n      return;\n    default:\n      const _exhaustiveCheck: never = chartConfig;\n      return _exhaustiveCheck;\n  }\n};\n\nexport const useLimits = ({\n  chartConfig,\n  dimensions,\n  measures,\n}: {\n  chartConfig: ChartConfig;\n  dimensions: Dimension[];\n  measures: Measure[];\n}): {\n  axisDimension: Dimension | undefined;\n  limitMeasure: Measure | undefined;\n  limits: {\n    configLimit: ConfigLimit;\n    measureLimit: Limit;\n    relatedAxisDimensionValueLabel: string | undefined;\n    limitUnit: string | undefined;\n  }[];\n} => {\n  const filters = useDefinitiveFilters();\n  const limitMeasure = getLimitMeasure({ chartConfig, measures });\n  const axisDimension = getAxisDimension({ chartConfig, dimensions });\n\n  return useMemo(() => {\n    if (!limitMeasure) {\n      return {\n        axisDimension,\n        limitMeasure,\n        limits: [],\n      };\n    }\n\n    return {\n      axisDimension,\n      limitMeasure,\n      limits: limitMeasure.limits\n        .map((limit) => {\n          const { limit: maybeLimit, relatedAxisDimensionValueLabel } =\n            getMaybeValidChartConfigLimit({\n              chartConfig,\n              measureId: limitMeasure.id,\n              limit,\n              axisDimension,\n              filters,\n            });\n\n          return maybeLimit\n            ? {\n                configLimit: {\n                  ...maybeLimit,\n                  symbolType:\n                    limit.type === \"single\" &&\n                    getSupportsLimitSymbols(chartConfig)\n                      ? (maybeLimit.symbolType ?? \"circle\")\n                      : undefined,\n                },\n                measureLimit: limit,\n                relatedAxisDimensionValueLabel,\n                limitUnit: limitMeasure.unit,\n              }\n            : null;\n        })\n        .filter(truthy),\n    };\n  }, [limitMeasure, axisDimension, chartConfig, filters]);\n};\n\nexport const getSupportsLimitSymbols = (chartConfig: ChartConfig) => {\n  return chartConfig.chartType === \"area\" || chartConfig.chartType === \"line\";\n};\n","import { IconButton, IconButtonProps } from \"@mui/material\";\n\nimport SvgIcClose from \"@/icons/components/IcClose\";\n\nexport const DialogCloseButton = (props: IconButtonProps) => (\n  <IconButton\n    {...props}\n    sx={{ zIndex: 1, position: \"absolute\", top: \"1rem\", right: \"1rem\" }}\n  >\n    <SvgIcClose />\n  </IconButton>\n);\n","import { useEventCallback } from \"@mui/material\";\nimport { useState } from \"react\";\nimport { useClient } from \"urql\";\nimport createStore from \"zustand\";\n\nimport { SelectDatasetStep } from \"@/browse/ui/select-dataset-step\";\nimport { DialogCloseButton } from \"@/components/dialog-close-button\";\nimport { RightDrawer } from \"@/configurator/components/drawers\";\nimport {\n  ConfiguratorStateProvider,\n  initChartStateFromCube,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useDataSourceStore } from \"@/stores/data-source\";\nimport { assert } from \"@/utils/assert\";\n\nexport const useSearchDatasetPanelStore = createStore<{\n  isOpen: boolean;\n  toggle: () => void;\n  close: () => void;\n  open: () => void;\n}>((set) => ({\n  isOpen: false,\n  toggle: () => {\n    set((s) => ({ isOpen: !s.isOpen }));\n  },\n  close: () => {\n    set({ isOpen: false });\n  },\n  open: () => {\n    set({ isOpen: true });\n  },\n}));\n\n/**\n * Inits a new chart state based on a new dataset and adds it to the configurator state\n */\nconst useAddChartConfigBasedOnNewDataset = () => {\n  const [, dispatch] = useConfiguratorState();\n  const locale = useLocale();\n  const client = useClient();\n  const { dataSource } = useDataSourceStore();\n  const handleAddNewDataset = useEventCallback(async (datasetIri: string) => {\n    const chartState = await initChartStateFromCube(\n      client,\n      datasetIri,\n      dataSource,\n      locale\n    );\n\n    if (!chartState) {\n      return;\n    }\n\n    assert(\n      chartState?.state === \"CONFIGURING_CHART\",\n      \"After init, chart state should be in CONFIGURING_CHART state\"\n    );\n\n    dispatch({\n      type: \"CHART_CONFIG_ADD_NEW_DATASET\",\n      value: {\n        chartConfig: chartState.chartConfigs[0],\n        locale,\n      },\n    });\n  });\n  return handleAddNewDataset;\n};\n\n/**\n * Used when adding a new chart based on a new dataset\n * Shows the dataset search, but overrides its default behavior to\n * keep the state as a local state instead of inside the URL\n */\nexport const AddNewDatasetPanel = () => {\n  const { isOpen, close } = useSearchDatasetPanelStore();\n  const [dataSetIri, setDataSetIri] = useState(\"\");\n  const addNewDataset = useAddChartConfigBasedOnNewDataset();\n\n  const handleClose = useEventCallback(() => {\n    close();\n  });\n\n  const handleExited = useEventCallback(() => {\n    setDataSetIri(\"\");\n  });\n\n  return (\n    <RightDrawer open={isOpen} onClose={handleClose} onExited={handleExited}>\n      <DialogCloseButton onClick={() => handleClose()} />\n      <ConfiguratorStateProvider chartId=\"new\" allowDefaultRedirect={false}>\n        <SelectDatasetStep\n          variant=\"drawer\"\n          dataset={dataSetIri}\n          onClickBackLink={(ev) => {\n            ev.preventDefault();\n            setDataSetIri(\"\");\n          }}\n          onCreateChartFromDataset={async (ev, datasetIri) => {\n            ev.preventDefault();\n            await addNewDataset(datasetIri);\n            close();\n          }}\n          datasetResultsProps={{\n            datasetResultProps: () => ({\n              showDimensions: true,\n              onClickTitle: (ev, datasetIri) => {\n                ev.preventDefault();\n                setDataSetIri(datasetIri);\n              },\n            }),\n          }}\n          datasetPreviewProps={{\n            dataSetIri,\n          }}\n        />\n      </ConfiguratorStateProvider>\n    </RightDrawer>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Theme, Typography, TypographyProps } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\n\nimport { MarkdownInheritFonts } from \"@/components/markdown\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  ChartAnnotatorTabField,\n  LayoutAnnotatorTabField,\n} from \"@/configurator/components/field\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport {\n  isConfiguring,\n  isLayouting,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nconst useStyles = makeStyles<Theme, { interactive?: boolean; empty: boolean }>(\n  (theme) => ({\n    text: {\n      wordBreak: \"break-word\",\n      color: ({ empty }) =>\n        empty ? theme.palette.text.secondary : theme.palette.text.primary,\n      cursor: ({ interactive }) => (interactive ? \"pointer\" : \"text\"),\n\n      \"&:hover\": {\n        textDecoration: ({ interactive }) =>\n          interactive ? \"underline\" : \"none\",\n      },\n\n      \"& > :last-child\": {\n        marginBottom: 0,\n      },\n    },\n  })\n);\n\ntype Props = TypographyProps & {\n  text: string;\n  smaller?: boolean;\n};\n\nexport const Title = ({\n  text,\n  smaller,\n  onClick,\n  className,\n  sx,\n  ...rest\n}: Props) => {\n  const classes = useStyles({\n    interactive: !!onClick,\n    empty: !text,\n  });\n\n  return (\n    <Typography\n      {...rest}\n      variant={smaller ? \"h2\" : \"h1\"}\n      component=\"span\"\n      className={clsx(classes.text, className)}\n      onClick={onClick}\n      sx={{ mb: smaller ? 1 : 4, fontWeight: smaller ? 400 : 700 }}\n    >\n      {text ? (\n        <MarkdownInheritFonts>{text}</MarkdownInheritFonts>\n      ) : (\n        <Trans id=\"annotator.add.title\">[ Add Title ]</Trans>\n      )}\n    </Typography>\n  );\n};\n\nexport const Description = ({\n  text,\n  smaller,\n  onClick,\n  className,\n  sx,\n  ...rest\n}: Props) => {\n  const classes = useStyles({\n    interactive: !!onClick,\n    empty: !text,\n  });\n\n  return (\n    <Typography\n      {...rest}\n      variant=\"body2\"\n      component=\"span\"\n      className={clsx(classes.text, className)}\n      onClick={onClick}\n    >\n      {text ? (\n        <MarkdownInheritFonts>{text}</MarkdownInheritFonts>\n      ) : (\n        <Trans id=\"annotator.add.description\">[ Add Description ]</Trans>\n      )}\n    </Typography>\n  );\n};\n\nexport const ChartAnnotator = () => {\n  const locale = useLocale();\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const { title, description } = chartConfig.meta;\n  const labelsMissing = !(title[locale] && description[locale]);\n\n  return (\n    <ControlSection\n      role=\"tablist\"\n      aria-labelledby=\"controls-title-description\"\n      collapse\n      defaultExpanded={false}\n    >\n      <SectionTitle\n        id=\"controls-title-description\"\n        warnMessage={\n          labelsMissing ? (\n            <Trans id=\"controls.section.title.warning\">\n              Please add a title or description.\n            </Trans>\n          ) : undefined\n        }\n      >\n        <Trans id=\"controls.section.description\">Title & Description</Trans>\n      </SectionTitle>\n      <ControlSectionContent gap=\"none\" px=\"none\">\n        <ChartAnnotatorTabField\n          value=\"title\"\n          icon=\"text\"\n          emptyValueWarning={\n            <Trans id=\"controls.annotator.add-title-warning\">\n              Please add a title\n            </Trans>\n          }\n          mainLabel={getFieldLabel(\"title\")}\n        />\n        <ChartAnnotatorTabField\n          value=\"description\"\n          icon=\"description\"\n          emptyValueWarning={\n            <Trans id=\"controls.annotator.add-description-warning\">\n              Please add a description\n            </Trans>\n          }\n          mainLabel={getFieldLabel(\"description\")}\n        />\n        <ChartAnnotatorTabField\n          value=\"label\"\n          icon=\"layoutTab\"\n          emptyValueWarning={\n            <Trans id=\"controls.annotator.add-tab-label-warning\">\n              Please add a tab label\n            </Trans>\n          }\n          mainLabel={getFieldLabel(\"label\")}\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n\nexport const LayoutAnnotator = () => {\n  const locale = useLocale();\n  const [state] = useConfiguratorState(isLayouting);\n  const { title, description } = state.layout.meta;\n  const labelsMissing = !(title[locale] && description[locale]);\n\n  return (\n    <ControlSection\n      role=\"tablist\"\n      aria-labelledby=\"controls-title-description\"\n      collapse\n      defaultExpanded\n      hideTopBorder\n    >\n      <SectionTitle\n        id=\"controls-title-description\"\n        warnMessage={\n          labelsMissing ? (\n            <Trans id=\"controls.section.title.warning\">\n              Please add a title or description.\n            </Trans>\n          ) : undefined\n        }\n      >\n        <Trans id=\"controls.section.description\">Title & Description</Trans>\n      </SectionTitle>\n      <ControlSectionContent gap=\"none\" px=\"none\">\n        <LayoutAnnotatorTabField\n          value=\"title\"\n          icon=\"text\"\n          emptyValueWarning={\n            <Trans id=\"controls.annotator.add-title-warning\">\n              Please add a title\n            </Trans>\n          }\n          mainLabel={getFieldLabel(\"title\")}\n        />\n        <LayoutAnnotatorTabField\n          value=\"description\"\n          icon=\"description\"\n          emptyValueWarning={\n            <Trans id=\"controls.annotator.add-description-warning\">\n              Please add a description\n            </Trans>\n          }\n          mainLabel={getFieldLabel(\"description\")}\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { Annotation, HighlightAnnotation } from \"@/config-types\";\nimport { createId } from \"@/utils/create-id\";\n\nconst ANNOTATION_FIELD_PREFIX = \"annotation\";\n\nconst getAnnotationKey = (type: Annotation[\"type\"]) => {\n  const key = createId();\n\n  return `${ANNOTATION_FIELD_PREFIX}:${type}:${key}`;\n};\n\nexport const isAnnotationField = (field: string | undefined) => {\n  return !!field?.startsWith(ANNOTATION_FIELD_PREFIX);\n};\n\nexport const getDefaultHighlightAnnotation = (): HighlightAnnotation => {\n  return {\n    key: getAnnotationKey(\"highlight\"),\n    type: \"highlight\",\n    targets: [],\n    text: {\n      de: \"\",\n      fr: \"\",\n      it: \"\",\n      en: \"\",\n    },\n    highlightType: \"none\",\n    color: undefined,\n    defaultOpen: true,\n  };\n};\n","import { Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Button,\n  Divider,\n  MenuItem,\n  Select,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport get from \"lodash/get\";\nimport { MouseEventHandler, useMemo, useState } from \"react\";\n\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { hasDimensionColors } from \"@/charts/shared/colors\";\nimport { Flex } from \"@/components/flex\";\nimport { selectMenuProps } from \"@/components/form\";\nimport { Label } from \"@/components/form\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ConfiguratorStateConfiguringChart,\n  CustomPaletteType,\n  isColorInConfig,\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { ColorPaletteDrawerContent } from \"@/configurator/components/chart-controls/drawer-color-palette-content\";\nimport { ConfiguratorDrawer } from \"@/configurator/components/drawers\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport { Component, isNumericalMeasure } from \"@/domain/data\";\nimport { Icon } from \"@/icons\";\nimport { useUser } from \"@/login/utils\";\nimport {\n  categoricalPalettes,\n  DEFAULT_CATEGORICAL_PALETTE_ID,\n  divergingSteppedPalettes,\n  getDefaultCategoricalPalette,\n  getPalette,\n} from \"@/palettes\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { useUserPalettes } from \"@/utils/use-user-palettes\";\n\ntype Props = {\n  field: EncodingFieldType;\n  disabled?: boolean;\n  colorConfigPath?: string;\n  component?: Component;\n};\n\nexport const ColorPalette = ({\n  field,\n  disabled,\n  colorConfigPath,\n  component,\n}: Props) => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const user = useUser();\n\n  const { data: customColorPalettes, invalidate } = useUserPalettes();\n\n  const hasColors = hasDimensionColors(component);\n  const defaultPalette =\n    hasColors && component\n      ? getDefaultCategoricalPalette(\n          component.values.map((d) => d.color).filter(Boolean) as string[]\n        )\n      : null;\n\n  const palettes = isNumericalMeasure(component)\n    ? divergingSteppedPalettes\n    : defaultPalette\n      ? [defaultPalette, ...categoricalPalettes]\n      : categoricalPalettes;\n\n  const currentPaletteName = isColorInConfig(chartConfig)\n    ? get(chartConfig, `fields.color.paletteId`)\n    : get(\n        chartConfig,\n        `fields[\"${chartConfig.activeField}\"].${\n          colorConfigPath ? `${colorConfigPath}.` : \"\"\n        }paletteId`\n      );\n\n  const currentPalette = palettes.find((p) => p.value === currentPaletteName);\n\n  const handleChangePalette = useEvent((paletteId: string) => {\n    handleChartConfigUpdate(paletteId);\n  });\n\n  const handleChartConfigUpdate = (\n    value?: string,\n    selectedPalette?: CustomPaletteType\n  ) => {\n    if (!component) {\n      return;\n    }\n\n    const regularPalette = palettes.find((p) => p.value === value);\n    const customPalette =\n      customColorPalettes?.find((p) => p.paletteId === value) ||\n      selectedPalette;\n\n    if (customPalette) {\n      const colorMapping = mapValueIrisToColor({\n        paletteId: customPalette.paletteId,\n        dimensionValues: component.values,\n        customPalette,\n      });\n\n      if (isColorInConfig(chartConfig)) {\n        dispatch({\n          type: \"COLOR_FIELD_SET\",\n          value:\n            chartConfig.fields.color.type === \"single\"\n              ? {\n                  type: chartConfig.fields.color.type,\n                  paletteId: customPalette.paletteId,\n                  color: customPalette.colors[0],\n                }\n              : {\n                  type: chartConfig.fields.color.type,\n                  paletteId: customPalette.paletteId,\n                  colorMapping,\n                },\n        });\n      } else {\n        dispatch({\n          type: \"CHART_PALETTE_CHANGED\",\n          value: {\n            field,\n            colorConfigPath,\n            paletteId: customPalette.paletteId,\n            colorMapping,\n          },\n        });\n      }\n      return;\n    }\n\n    if (!regularPalette) {\n      return;\n    }\n\n    if (isColorInConfig(chartConfig)) {\n      dispatch({\n        type: \"COLOR_FIELD_SET\",\n        value:\n          chartConfig.fields.color.type === \"single\"\n            ? {\n                type: chartConfig.fields.color.type,\n                paletteId: regularPalette.value,\n                color: regularPalette.colors[0],\n              }\n            : {\n                type: chartConfig.fields.color.type,\n                paletteId: regularPalette.value,\n                colorMapping: mapValueIrisToColor({\n                  paletteId: regularPalette.value,\n                  dimensionValues: component.values,\n                }),\n              },\n      });\n    } else {\n      dispatch({\n        type: \"CHART_PALETTE_CHANGED\",\n        value: {\n          field,\n          colorConfigPath,\n          paletteId: regularPalette.value,\n          colorMapping: mapValueIrisToColor({\n            paletteId: regularPalette.value,\n            dimensionValues: component.values,\n          }),\n        },\n      });\n    }\n  };\n\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>();\n  const handleOpenCreateColorPalette: MouseEventHandler<HTMLElement> = useEvent(\n    (e) => {\n      setAnchorEl(e.currentTarget);\n    }\n  );\n\n  const handleCloseCreateColorPalette = useEvent(\n    (palette?: CustomPaletteType) => {\n      invalidate();\n      setAnchorEl(undefined);\n\n      handleChartConfigUpdate(palette?.paletteId, palette);\n\n      anchorEl?.focus();\n    }\n  );\n\n  const isValidValue = (value: string) => {\n    const isPaletteValue = palettes.some((p) => p.value === value);\n    const isCustomPaletteValue = customColorPalettes?.some(\n      (p) => p.paletteId === value\n    );\n    return isPaletteValue || isCustomPaletteValue;\n  };\n\n  const value = (() => {\n    const valueToUse = currentPalette\n      ? currentPalette.value\n      : currentPaletteName;\n\n    if (!isValidValue(valueToUse)) {\n      return \"\";\n    }\n\n    return valueToUse;\n  })();\n\n  return (\n    <Flex\n      sx={{\n        pointerEvents: disabled ? \"none\" : \"auto\",\n        flexDirection: \"column\",\n        gap: 1,\n      }}\n    >\n      <div>\n        <Label htmlFor=\"color-palette-toggle\">\n          <Trans id=\"controls.color.palette\">Color palette</Trans>\n        </Label>\n        <Select\n          size=\"sm\"\n          MenuProps={selectMenuProps}\n          renderValue={(selected) => {\n            if (!selected || !isValidValue(selected)) {\n              return (\n                <Trans id=\"controls.color.palette.select\">\n                  Select a color palette\n                </Trans>\n              );\n            }\n\n            return (\n              <Flex gap={0.5} flexWrap=\"wrap\">\n                {currentPalette\n                  ? currentPalette.colors.map((color, i) => (\n                      <ColorSquare key={i} color={color} disabled={disabled} />\n                    ))\n                  : customColorPalettes\n                      ?.find(\n                        (palette) => palette.paletteId === currentPaletteName\n                      )\n                      ?.colors.map((color, i) => (\n                        <ColorSquare\n                          key={i}\n                          color={color}\n                          disabled={disabled}\n                        />\n                      ))}\n              </Flex>\n            );\n          }}\n          value={value}\n          displayEmpty\n        >\n          {user && (\n            <MenuItem onClick={handleOpenCreateColorPalette}>\n              <Button\n                variant=\"text\"\n                size=\"sm\"\n                color=\"primary\"\n                sx={{\n                  \"&:hover\": {\n                    color: \"primary.main\",\n                  },\n                }}\n              >\n                <Trans id=\"login.profile.my-color-palettes.add\">\n                  Add color palette\n                </Trans>\n              </Button>\n            </MenuItem>\n          )}\n          {customColorPalettes && customColorPalettes.length > 0 && (\n            <Flex sx={{ flexDirection: \"column\", gap: 2, pt: 3 }}>\n              <Typography\n                variant=\"caption\"\n                sx={{ px: 4, color: \"text.secondary\", fontWeight: 700 }}\n              >\n                <Trans id=\"controls.custom-color-palettes\">\n                  Custom color palettes\n                </Trans>\n              </Typography>\n              <Divider sx={{ width: \"100%\", height: 2 }} />\n            </Flex>\n          )}\n          {customColorPalettes &&\n            customColorPalettes?.length > 0 &&\n            customColorPalettes\n              .filter((palette) => palette.type === \"categorical\")\n              .map((palette) => (\n                <ColorPaletteMenuItem\n                  key={palette.paletteId}\n                  value={palette.paletteId}\n                  label={palette.name}\n                  colors={palette.colors}\n                  selected={palette.paletteId === value}\n                  onClick={() => handleChangePalette(palette.paletteId)}\n                />\n              ))}\n          <Flex sx={{ flexDirection: \"column\", gap: 2, pt: 3 }}>\n            <Typography\n              variant=\"caption\"\n              sx={{ px: 4, color: \"text.secondary\", fontWeight: 700 }}\n            >\n              <Trans id=\"controls.visualize-color-palette\">\n                Visualize color palettes\n              </Trans>\n            </Typography>\n            <Divider sx={{ width: \"100%\", height: 2 }} />\n          </Flex>\n          {palettes.map((palette) => (\n            <ColorPaletteMenuItem\n              key={palette.value}\n              value={palette.value}\n              label={palette.label}\n              colors={palette.colors}\n              selected={palette.value === value}\n              onClick={() => handleChangePalette(palette.value)}\n            />\n          ))}\n        </Select>\n      </div>\n      {component && (\n        <ColorPaletteControls\n          field={field}\n          component={component}\n          state={state}\n          colorConfigPath={colorConfigPath}\n          customColorPalettes={customColorPalettes}\n        />\n      )}\n      <ConfiguratorDrawer open={!!anchorEl} hideBackdrop>\n        <ColorPaletteDrawerContent\n          onClose={(palette) => handleCloseCreateColorPalette(palette)}\n          type=\"categorical\"\n          customColorPalettes={customColorPalettes}\n        />\n      </ConfiguratorDrawer>\n    </Flex>\n  );\n};\n\nconst ColorPaletteMenuItem = ({\n  value,\n  label,\n  colors,\n  selected,\n  onClick,\n}: {\n  value: string;\n  label: string;\n  colors: ReadonlyArray<string>;\n  selected: boolean;\n  onClick: () => void;\n}) => {\n  return (\n    <MenuItem\n      value={value}\n      onClick={onClick}\n      sx={{\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        gap: 1,\n      }}\n    >\n      <Flex sx={{ flexDirection: \"column\", gap: 1, width: \"100%\" }}>\n        <Typography component=\"div\" variant=\"caption\" color=\"text.primary\">\n          {label}\n        </Typography>\n        <Flex\n          sx={{\n            justifyContent: \"space-between\",\n            alignItems: \"center\",\n            gap: 1,\n            width: \"100%\",\n          }}\n        >\n          <Flex sx={{ gap: 0.5, flexWrap: \"wrap\" }}>\n            {colors.map((c) => (\n              <ColorSquare key={c} color={c} />\n            ))}\n          </Flex>\n          <div\n            style={{\n              minWidth: 24,\n              minHeight: 20,\n            }}\n          >\n            {selected ? <Icon name=\"checkmark\" size={20} /> : null}\n          </div>\n        </Flex>\n      </Flex>\n    </MenuItem>\n  );\n};\n\nconst useColorSquareStyles = makeStyles({\n  root: {\n    display: \"inline-block\",\n    margin: 0,\n    padding: 0,\n    width: 20,\n    height: 20,\n\n    \"&:first-of-type\": {\n      borderTopLeftRadius: \"default\",\n      borderBottomLeftRadius: \"default\",\n    },\n\n    \"&:last-of-type\": {\n      borderTopRightRadius: \"default\",\n      borderBottomRightRadius: \"default\",\n    },\n  },\n});\n\nexport const ColorSquare = ({\n  disabled,\n  color,\n}: {\n  disabled?: boolean;\n  color: string;\n}) => {\n  const classes = useColorSquareStyles();\n\n  return (\n    <Box\n      className={classes.root}\n      data-testid=\"select-color-square\"\n      sx={{\n        backgroundColor: disabled ? \"grey.300\" : color,\n      }}\n    />\n  );\n};\n\nconst ColorPaletteControls = ({\n  field,\n  colorConfigPath,\n  component,\n  state,\n  customColorPalettes,\n}: {\n  field: string;\n  colorConfigPath?: string;\n  component: Component;\n  state: ConfiguratorStateConfiguringChart;\n  customColorPalettes: CustomPaletteType[] | undefined;\n}) => {\n  const [, dispatch] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n\n  const paletteId = isColorInConfig(chartConfig)\n    ? get(chartConfig, `fields.color.paletteId`)\n    : (get(\n        chartConfig,\n        `fields[\"${field}\"].${colorConfigPath ? `${colorConfigPath}.` : \"\"}paletteId`,\n        DEFAULT_CATEGORICAL_PALETTE_ID\n      ) as string);\n  const customPalette = useMemo(() => {\n    return customColorPalettes?.find((p) => p.paletteId === paletteId);\n  }, [customColorPalettes, paletteId]);\n\n  const colorMapping = isColorInConfig(chartConfig)\n    ? get(chartConfig, `fields.color.colorMapping`)\n    : (get(\n        chartConfig,\n        `fields[\"${field}\"].${\n          colorConfigPath ? `${colorConfigPath}.` : \"\"\n        }colorMapping`\n      ) as Record<string, string> | undefined);\n\n  const resetColorPalette = useEvent(() => {\n    dispatch({\n      type: \"CHART_PALETTE_RESET\",\n      value: {\n        field: isColorInConfig(chartConfig) ? \"color\" : field,\n        colorConfigPath,\n        colorMapping: mapValueIrisToColor({\n          paletteId,\n          dimensionValues: component.values,\n          customPalette,\n        }),\n      },\n    });\n  });\n  const shuffleColors = useEvent(() => {\n    dispatch({\n      type: \"CHART_CONFIG_UPDATE_COLOR_MAPPING\",\n      value: {\n        field: isColorInConfig(chartConfig) ? \"color\" : field,\n        colorConfigPath,\n        dimensionId: component.id,\n        values: component.values,\n        random: true,\n        customPalette,\n      },\n    });\n  });\n\n  if (colorMapping) {\n    const currentPalette = getPalette({\n      paletteId,\n      fallbackPalette: customPalette?.colors,\n    });\n    const colorMappingColors = Object.values(colorMapping);\n    const nbMatchedColors = colorMappingColors.length;\n    const matchedColorsInPalette = currentPalette.slice(0, nbMatchedColors);\n    const same =\n      matchedColorsInPalette.every((d, i) => d === colorMappingColors[i]) ||\n      paletteId === \"dimension\";\n\n    return (\n      <Flex\n        sx={{\n          alignItems: \"center\",\n          columnGap: 2,\n          flexWrap: \"wrap\",\n          color: \"primary.main\",\n        }}\n      >\n        <Button\n          variant=\"text\"\n          color=\"primary\"\n          size=\"xs\"\n          disabled={same}\n          onClick={resetColorPalette}\n        >\n          <Trans id=\"controls.color.palette.reset\">Reset color palette</Trans>\n        </Button>\n        \n        <Button\n          variant=\"text\"\n          color=\"primary\"\n          size=\"xs\"\n          onClick={shuffleColors}\n        >\n          <Trans id=\"controls.filters.select.refresh-colors\">\n            Shuffle colors\n          </Trans>\n        </Button>\n      </Flex>\n    );\n  } else {\n    return null;\n  }\n};\n","import { Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Button,\n  ListSubheader,\n  MenuItem,\n  Select,\n  SelectProps,\n  Typography,\n} from \"@mui/material\";\nimport get from \"lodash/get\";\nimport {\n  Dispatch,\n  MouseEvent,\n  MouseEventHandler,\n  SetStateAction,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { Label } from \"@/components/form\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  CustomPaletteType,\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { ColorPaletteDrawerContent } from \"@/configurator/components/chart-controls/drawer-color-palette-content\";\nimport { ConfiguratorDrawer } from \"@/configurator/components/drawers\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useUser } from \"@/login/utils\";\nimport {\n  createDivergingInterpolator,\n  createSequentialInterpolator,\n  divergingPalettes,\n  getColorInterpolator,\n  sequentialPalettes,\n} from \"@/palettes\";\nimport { getFittingColorInterpolator } from \"@/utils/color-palette-utils\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { useUserPalettes } from \"@/utils/use-user-palettes\";\n\n// Adapted from https://observablehq.com/@mbostock/color-ramp\n\ntype ColorRampProps = {\n  colorInterpolator: (t: number) => string;\n  nSteps?: number;\n  width?: number;\n  height?: number;\n  disabled?: boolean;\n  rx?: number;\n};\n\nexport const ColorRamp = (props: ColorRampProps) => {\n  const {\n    colorInterpolator,\n    nSteps: _nSteps = 512,\n    width = 220,\n    height = 28,\n    disabled,\n    rx = 2,\n  } = props;\n  const ref = useRef<HTMLCanvasElement>(null);\n\n  useEffect(() => {\n    const canvas = ref.current;\n    const ctx = canvas && canvas.getContext(\"2d\");\n\n    if (ctx) {\n      ctx.clearRect(0, 0, width, height);\n      const [stepWidth, nSteps] =\n        _nSteps > width ? [1, width] : [width / _nSteps, _nSteps];\n\n      for (let i = 0; i < nSteps; ++i) {\n        ctx.fillStyle = colorInterpolator(i / (nSteps - 1));\n        ctx.fillRect(stepWidth * i, 0, stepWidth, height);\n      }\n    }\n  }, [colorInterpolator, _nSteps, width, height, disabled, rx]);\n\n  return (\n    <canvas\n      ref={ref}\n      width={width}\n      height={height}\n      style={{\n        borderRadius: `${rx}px`,\n        imageRendering: \"pixelated\",\n        opacity: disabled ? 0.5 : 1,\n      }}\n    />\n  );\n};\n\ntype ColorRampFieldProps = Omit<ColorRampProps, \"colorInterpolator\"> & {\n  field: EncodingFieldType;\n  path: string;\n};\n\nexport const ColorRampField = (props: ColorRampFieldProps) => {\n  const { field, path, disabled, nSteps } = props;\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n\n  const { data: customColorPalettes, invalidate } = useUserPalettes();\n\n  const palettes = useMemo(() => {\n    const palettes = [...sequentialPalettes, ...divergingPalettes];\n    return palettes;\n  }, []);\n\n  const currentPaletteId = get(\n    chartConfig,\n    `fields[\"${field}\"].${path}.paletteId`\n  );\n\n  const currentPalette = palettes.find((d) => d.value === currentPaletteId);\n  const currentCustomPalette = customColorPalettes?.find(\n    (d) => d.paletteId === currentPaletteId\n  );\n\n  const onSelectedItemChange: SelectProps<typeof currentPalette>[\"onChange\"] =\n    useEvent((ev) => {\n      const value = ev.target.value as string;\n\n      const selectedPalette = customColorPalettes?.find(\n        (palette) => palette.paletteId === value\n      );\n\n      handleChartConfigUpdate(value, selectedPalette);\n    });\n\n  const handleChartConfigUpdate = (\n    value: string,\n    selectedPalette?: CustomPaletteType\n  ) => {\n    if (value) {\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field,\n          path,\n          value: {\n            ...get(chartConfig, `fields[\"${field}\"].${path}`),\n            paletteId: value,\n            paletteType: selectedPalette?.type,\n            colors: selectedPalette?.colors ?? [],\n          },\n        },\n      });\n    }\n  };\n\n  const [type, setType] = useState<CustomPaletteType[\"type\"] | undefined>();\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>();\n  const handleOpenCreateColorPalette: MouseEventHandler<HTMLButtonElement> =\n    useEvent((ev) => {\n      setAnchorEl(ev.currentTarget);\n    });\n  const handleCloseCreateColorPalette = useEvent(\n    (palette?: CustomPaletteType) => {\n      invalidate();\n      setAnchorEl(undefined);\n\n      if (palette) {\n        handleChartConfigUpdate(palette.paletteId, palette);\n      }\n\n      anchorEl?.focus();\n    }\n  );\n\n  const selectedColorInterpolator = getFittingColorInterpolator(\n    {\n      currentPalette,\n      customPalette: currentCustomPalette,\n      defaultPalette: palettes[0],\n    },\n    getColorInterpolator\n  );\n\n  return (\n    <Box pb={2} sx={{ pointerEvents: disabled ? \"none\" : \"auto\" }}>\n      <Label htmlFor=\"color-palette\">\n        <Trans id=\"controls.color.palette\">Color palette</Trans>\n      </Label>\n      <Select\n        size=\"sm\"\n        value={currentPaletteId}\n        disabled={disabled}\n        displayEmpty\n        onChange={onSelectedItemChange}\n        renderValue={(selected) => {\n          if (!selected) {\n            return (\n              <Typography color={\"secondary.active\"} variant=\"body2\">\n                <Trans id=\"controls.color.palette.select\">\n                  Select a color palette\n                </Trans>\n              </Typography>\n            );\n          }\n\n          return (\n            <ColorRamp\n              colorInterpolator={selectedColorInterpolator}\n              nSteps={nSteps}\n              disabled={disabled}\n            />\n          );\n        }}\n        sx={{ mt: 1, lineHeight: 0 }}\n      >\n        {[\n          ...PaletteSection({\n            type: \"sequential\",\n            onTypeSelect: setType,\n            nSteps: nSteps,\n            customColorPalettes: customColorPalettes,\n            colorPalettes: sequentialPalettes,\n            handleAddColorPalette: handleOpenCreateColorPalette,\n            customInterpolator: createSequentialInterpolator,\n          }),\n          ...PaletteSection({\n            type: \"diverging\",\n            onTypeSelect: setType,\n            nSteps: nSteps,\n            customColorPalettes: customColorPalettes,\n            colorPalettes: divergingPalettes,\n            handleAddColorPalette: handleOpenCreateColorPalette,\n            customInterpolator: createDivergingInterpolator,\n          }),\n        ]}\n      </Select>\n      {type && (\n        <ConfiguratorDrawer open={!!anchorEl} hideBackdrop>\n          <ColorPaletteDrawerContent\n            onClose={(palette) => handleCloseCreateColorPalette(palette)}\n            type={type}\n            customColorPalettes={customColorPalettes}\n          />\n        </ConfiguratorDrawer>\n      )}\n    </Box>\n  );\n};\n\ntype PaletteSectionProps = {\n  nSteps?: number;\n  customColorPalettes?: CustomPaletteType[];\n  colorPalettes: { value: string; interpolator: (t: number) => string }[];\n  handleAddColorPalette: (\n    e: MouseEvent<HTMLButtonElement, globalThis.MouseEvent>\n  ) => void;\n  onTypeSelect: Dispatch<SetStateAction<CustomPaletteType[\"type\"] | undefined>>;\n  customInterpolator:\n    | typeof createDivergingInterpolator\n    | typeof createSequentialInterpolator;\n  type: CustomPaletteType[\"type\"];\n};\n\nconst PaletteSection = (props: PaletteSectionProps) => {\n  const user = useUser();\n  const {\n    type,\n    nSteps,\n    customColorPalettes,\n    colorPalettes,\n    onTypeSelect,\n    customInterpolator,\n    handleAddColorPalette,\n  } = props;\n\n  return [\n    type === \"diverging\" ? (\n      <ListSubheader>\n        <Trans id=\"controls.color.palette.diverging\">Diverging</Trans>\n      </ListSubheader>\n    ) : (\n      <ListSubheader>\n        <Trans id=\"controls.color.palette.sequential\">Sequential</Trans>\n      </ListSubheader>\n    ),\n    user && (\n      <Button\n        onClick={(e) => {\n          onTypeSelect(type);\n          handleAddColorPalette(e);\n        }}\n        variant=\"text\"\n        sx={{\n          width: \"100%\",\n          paddingY: 3,\n          paddingX: 4,\n        }}\n      >\n        <Trans id=\"login.profile.my-color-palettes.add\">\n          Add color palette\n        </Trans>\n      </Button>\n    ),\n    user && (\n      <ListSubheader>\n        <Typography\n          variant=\"subtitle2\"\n          fontWeight={700}\n          fontSize={10}\n          align=\"left\"\n        >\n          <Trans id=\"controls.custom-color-palettes\">\n            Custom color palettes\n          </Trans>\n        </Typography>\n      </ListSubheader>\n    ),\n    user &&\n      customColorPalettes\n        ?.filter((palette) => palette.type === type)\n        .map((palette) => {\n          return (\n            <MenuItem\n              sx={{ flexDirection: \"column\", alignItems: \"flex-start\" }}\n              key={`${type}-${palette.paletteId}`}\n              value={palette.paletteId}\n            >\n              <Typography variant=\"caption\">{palette.name}</Typography>\n              <ColorRamp\n                colorInterpolator={\n                  customInterpolator({\n                    endColorHex: palette.colors[0],\n                    startColorHex: palette.colors[1],\n                    options: {\n                      midColorHex: palette.colors[2] ?? undefined,\n                    },\n                  }).interpolator\n                }\n                nSteps={nSteps}\n              />\n            </MenuItem>\n          );\n        }),\n    user && (\n      <ListSubheader>\n        <Typography\n          variant=\"subtitle2\"\n          fontWeight={700}\n          fontSize={10}\n          align=\"left\"\n        >\n          <Trans id=\"controls.visualize-color-palette\">\n            Visualize color palettes\n          </Trans>\n        </Typography>\n      </ListSubheader>\n    ),\n    colorPalettes.map(({ value, interpolator }, i) => (\n      <MenuItem\n        sx={{ flexDirection: \"column\", alignItems: \"flex-start\" }}\n        key={`${type}-${i}`}\n        value={value}\n      >\n        <ColorRamp colorInterpolator={interpolator} nSteps={nSteps} />\n      </MenuItem>\n    )),\n  ];\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Box, Button, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { ReactNode } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport {\n  ChartConfig,\n  FieldProps,\n  isComboChartConfig,\n  overrideChecked,\n} from \"@/configurator\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport {\n  getComponentLabel,\n  getIconName,\n} from \"@/configurator/components/ui-helpers\";\nimport { Component } from \"@/domain/data\";\nimport { Icon, IconName } from \"@/icons\";\nimport SvgIcPen from \"@/icons/components/IcPen\";\nimport SvgIcWarningCircle from \"@/icons/components/IcWarningCircle\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const ControlTabFieldInner = ({\n  chartConfig,\n  fieldComponents,\n  value,\n  onClick,\n  checked,\n  labelId,\n  disabled,\n  warnMessage,\n}: {\n  chartConfig: ChartConfig;\n  fieldComponents?: Component[];\n  value: string;\n  onClick: (x: string) => void;\n  labelId: string | null;\n  disabled?: boolean;\n  warnMessage?: string;\n} & FieldProps) => {\n  const handleClick = useEvent(() => onClick(value));\n\n  const components = fieldComponents;\n  const firstComponent = components?.[0];\n  const isActive = overrideChecked(chartConfig, value) || !!firstComponent;\n\n  const labels = components?.map((c) => getComponentLabel(c));\n\n  const { upperLabel, mainLabel } = getLabels(\n    chartConfig,\n    value,\n    labelId,\n    labels\n  );\n\n  return (\n    <ControlTabButton\n      disabled={disabled}\n      checked={checked}\n      value={value}\n      onClick={handleClick}\n    >\n      <ControlTabButtonInner\n        iconName={getIconName(value)}\n        upperLabel={upperLabel}\n        mainLabel={mainLabel}\n        isActive={isActive}\n        checked={checked}\n        optional={overrideChecked(chartConfig, value) ? false : !firstComponent}\n        rightIcon={\n          <Flex gap={2}>\n            {warnMessage && <WarnIconTooltip title={warnMessage} />}{\" \"}\n            <FieldEditIcon isActive={isActive} />\n          </Flex>\n        }\n      />\n    </ControlTabButton>\n  );\n};\n\nconst getLabels = (\n  chartConfig: ChartConfig,\n  value: string,\n  labelId: string | null,\n  componentLabels: string[] | undefined\n) => {\n  switch (value) {\n    case \"y\":\n      if (isComboChartConfig(chartConfig)) {\n        return {\n          upperLabel: getFieldLabel(\"y\"),\n          mainLabel: componentLabels?.join(\", \"),\n        };\n      }\n    default:\n      return {\n        upperLabel: labelId ? getFieldLabel(labelId) : null,\n        mainLabel: componentLabels?.[0] ?? (\n          <Trans id=\"controls.color.add\">Add...</Trans>\n        ),\n      };\n  }\n};\n\nconst useIconStyles = makeStyles<Theme, { isActive: boolean }>((theme) => ({\n  edit: {\n    color: ({ isActive }) =>\n      isActive ? theme.palette.monochrome[800] : theme.palette.monochrome[300],\n    width: 18,\n    height: 18,\n  },\n  warn: {\n    color: theme.palette.orange.main,\n    width: 18,\n    height: 18,\n    pointerEvents: \"auto\",\n  },\n}));\n\ntype WarnIconTooltipProps = {\n  title: NonNullable<ReactNode>;\n};\n\nconst WarnIconTooltip = (props: WarnIconTooltipProps) => {\n  const { title } = props;\n  const iconStyles = useIconStyles({ isActive: false });\n\n  return (\n    <MaybeTooltip title={title}>\n      <Typography>\n        <SvgIcWarningCircle className={iconStyles.warn} />\n      </Typography>\n    </MaybeTooltip>\n  );\n};\n\nconst FieldEditIcon = ({ isActive }: { isActive: boolean }) => {\n  const classes = useIconStyles({ isActive });\n\n  return <SvgIcPen className={classes.edit} />;\n};\n\nexport const OnOffControlTab = ({\n  value,\n  label,\n  icon,\n  checked,\n  active,\n  onClick,\n}: {\n  value: string;\n  label: ReactNode;\n  icon: string;\n  checked?: boolean;\n  active?: boolean;\n  onClick: (value: string) => void;\n}) => {\n  return (\n    <div style={{ width: \"100%\", margin: \"2px 0\", borderRadius: 1.5 }}>\n      <ControlTabButton checked={checked} value={value} onClick={onClick}>\n        <ControlTabButtonInner\n          iconName={getIconName(icon)}\n          mainLabel={label}\n          checked={checked}\n          isActive={active}\n          showIsActive\n        />\n      </ControlTabButton>\n    </div>\n  );\n};\n\nexport type ControlTabProps = {\n  disabled?: boolean;\n  onClick: (x: string) => void;\n  value: string;\n  icon: IconName;\n  mainLabel: ReactNode;\n  upperLabel?: ReactNode;\n  lowerLabel?: ReactNode;\n  rightIcon?: ReactNode;\n} & FieldProps;\n\nexport const ControlTab = ({\n  value,\n  checked,\n  onClick,\n  icon,\n  upperLabel,\n  mainLabel,\n  lowerLabel,\n  rightIcon,\n  disabled,\n}: ControlTabProps) => {\n  return (\n    <div style={{ width: \"100%\", margin: \"2px 0\", borderRadius: 1.5 }}>\n      <ControlTabButton\n        checked={checked}\n        value={value}\n        disabled={disabled}\n        onClick={() => onClick(value)}\n      >\n        <ControlTabButtonInner\n          iconName={icon}\n          mainLabel={mainLabel}\n          upperLabel={upperLabel}\n          lowerLabel={lowerLabel}\n          checked={checked}\n          disabled={disabled}\n          rightIcon={rightIcon}\n        />\n      </ControlTabButton>\n    </div>\n  );\n};\n\nexport const DraggableTab = ({\n  component,\n  value,\n  checked,\n  onClick,\n  isDragging,\n  upperLabel,\n  disabled,\n  iconName,\n}: {\n  component: Component;\n  disabled?: boolean;\n  onClick: (x: string) => void;\n  value: string;\n  isDragging: boolean;\n  upperLabel: ReactNode;\n  iconName?: IconName;\n} & FieldProps) => {\n  return (\n    <Box\n      sx={{\n        boxShadow: isDragging ? \"tooltip\" : undefined,\n        width: \"100%\",\n        borderRadius: 1.5,\n        my: \"2px\",\n      }}\n    >\n      <ControlTabButton\n        checked={checked}\n        value={value}\n        onClick={() => onClick(value)}\n      >\n        <ControlTabButtonInner\n          iconName={iconName ?? getIconName(value)}\n          upperLabel={upperLabel}\n          mainLabel={component.label}\n          checked={checked}\n          optional={disabled}\n        />\n      </ControlTabButton>\n    </Box>\n  );\n};\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  controlTabButton: {\n    width: \"100%\",\n    minWidth: 160,\n    padding: `${theme.spacing(2)} ${theme.spacing(4)}`,\n    borderColor: theme.palette.primary.main,\n    borderRadius: 1.5,\n    fontWeight: \"normal\",\n    fontSize: \"0.875rem\",\n    transition: \"background-color 0.2s ease\",\n    backgroundColor: \"white\",\n    cursor: \"pointer\",\n    boxShadow: \"none\",\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.cobalt[50],\n      boxShadow: \"none\",\n    },\n\n    \"&.Mui-disabled\": {\n      cursor: \"initial\",\n      backgroundColor: \"transparent\",\n    },\n  },\n  controlTabButtonInnerIcon: {\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: 32,\n    minWidth: 32,\n    height: 32,\n    borderRadius: 2,\n    transition: \"color 0.2s ease\",\n  },\n}));\n\nconst ControlTabButton = ({\n  disabled,\n  checked,\n  value,\n  onClick,\n  children,\n}: {\n  disabled?: boolean;\n  checked?: boolean;\n  value: string;\n  onClick: (value: string) => void;\n  children: ReactNode;\n}) => {\n  const classes = useStyles();\n\n  return (\n    <Button\n      id={`tab-${value}`}\n      className={classes.controlTabButton}\n      role=\"tab\"\n      disabled={disabled}\n      aria-selected={checked}\n      onClick={() => onClick(value)}\n      sx={{\n        backgroundColor: checked\n          ? (t) => `${t.palette.cobalt[50]} !important`\n          : \"transparent\",\n      }}\n    >\n      {children}\n    </Button>\n  );\n};\n\nconst ControlTabButtonInner = ({\n  iconName,\n  upperLabel,\n  mainLabel,\n  lowerLabel,\n  checked,\n  disabled,\n  rightIcon,\n  optional = false,\n  isActive = false,\n  showIsActive = false,\n}: {\n  iconName: IconName;\n  upperLabel?: string | ReactNode;\n  mainLabel: string | ReactNode;\n  lowerLabel?: string | ReactNode;\n  checked?: boolean;\n  disabled?: boolean;\n  optional?: boolean;\n  // On / Off indicator\n  isActive?: boolean;\n  showIsActive?: boolean;\n  rightIcon?: ReactNode;\n}) => {\n  const classes = useStyles();\n\n  return (\n    <Flex\n      sx={{\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        flexGrow: 1,\n      }}\n    >\n      <Flex sx={{ justifyContent: \"flex-start\", alignItems: \"center\" }}>\n        <Flex\n          className={classes.controlTabButtonInnerIcon}\n          sx={{\n            backgroundColor: checked ? \"monochrome.800\" : \"white\",\n\n            \"& svg\": {\n              color: checked\n                ? \"white\"\n                : optional || disabled\n                  ? \"monochrome.300\"\n                  : \"monochrome.800\",\n            },\n          }}\n        >\n          <Icon size={24} name={iconName} />\n        </Flex>\n        <Flex\n          sx={{\n            flexDirection: \"column\",\n            alignItems: \"flex-start\",\n            mx: 1,\n            flexGrow: 1,\n          }}\n        >\n          {upperLabel && (\n            <Typography\n              variant=\"caption\"\n              sx={{\n                color:\n                  (optional && !checked) || disabled\n                    ? \"monochrome.300\"\n                    : \"monochrome.500\",\n              }}\n            >\n              {upperLabel}\n            </Typography>\n          )}\n          <Typography\n            variant=\"h6\"\n            component=\"p\"\n            textAlign=\"left\"\n            fontWeight={700}\n            sx={{\n              // --- Puts ellipsis on the second line.\n              display: \"-webkit-box\",\n              overflow: \"hidden\",\n              textOverflow: \"ellipsis\",\n              WebkitBoxOrient: \"vertical\",\n              WebkitLineClamp: \"2\",\n              // ---\n              color:\n                (optional && !checked) || disabled\n                  ? \"monochrome.300\"\n                  : \"monochrome.800\",\n            }}\n          >\n            {mainLabel}\n          </Typography>\n          {lowerLabel && (\n            <Typography variant=\"caption\" sx={{ color: \"grey.600\" }}>\n              {lowerLabel}\n            </Typography>\n          )}\n        </Flex>\n      </Flex>\n      {showIsActive && isActive === false ? (\n        <Box sx={{ mr: 3 }}>\n          <Trans id=\"controls.option.isNotActive\">Off</Trans>\n        </Box>\n      ) : showIsActive && isActive ? (\n        <Box sx={{ mr: 3, color: \"primary\" }}>\n          <Trans id=\"controls.option.isActive\">On</Trans>\n        </Box>\n      ) : null}\n      {rightIcon}\n    </Flex>\n  );\n};\n","import { useEvent } from \"@dnd-kit/utilities\";\nimport { t, Trans } from \"@lingui/macro\";\nimport { Box, Button, IconButton, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { forwardRef, useState } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport { Input } from \"@/components/form\";\nimport { CustomPaletteType } from \"@/config-types\";\nimport SvgIcClose from \"@/icons/components/IcClose\";\nimport { ColorPaletteCreator } from \"@/login/components/color-palettes/color-palette-types\";\nimport { ColorItem, getDefaultColorValues } from \"@/palettes\";\nimport { theme } from \"@/themes/theme\";\nimport { createCustomColorPalette } from \"@/utils/chart-config/api\";\nimport { createColorId } from \"@/utils/color-palette-utils\";\nimport { useMutate } from \"@/utils/use-fetch-data\";\n\nimport { DRAWER_WIDTH } from \"../drawers\";\n\nconst useStyles = makeStyles({\n  autocompleteMenuContent: {\n    \"--mx\": \"1rem\",\n    \"--colorBoxSize\": \"1.25rem\",\n    \"--columnGap\": \"0.75rem\",\n    width: DRAWER_WIDTH,\n  },\n  autocompleteHeader: {\n    margin: \"1rem var(--mx)\",\n  },\n  autocompleteApplyButtonContainer: {\n    padding: \"1rem var(--mx)\",\n    background: \"rgba(255,255,255,0.75)\",\n  },\n  textInput: {\n    margin: `${theme.spacing(4)} 0px`,\n    padding: \"30px\",\n    width: \"100%\",\n    height: 40,\n    minHeight: 40,\n  },\n  autocompleteApplyButton: {\n    justifyContent: \"center\",\n  },\n});\n\nexport const ColorPaletteDrawerContent = forwardRef<\n  HTMLDivElement,\n  {\n    onClose: (palette?: CustomPaletteType) => void;\n    type: CustomPaletteType[\"type\"];\n    customColorPalettes?: CustomPaletteType[];\n  }\n>((props, ref) => {\n  const { onClose, type, customColorPalettes } = props;\n  const classes = useStyles();\n\n  const [colorValues, setColorValues] = useState<ColorItem[]>(() =>\n    getDefaultColorValues(type, [])\n  );\n\n  const [titleInput, setTitleInput] = useState<string>(\"\");\n  const [isNotAvailable, setIsNotAvailable] = useState(false);\n\n  const createColorPalette = useMutate(createCustomColorPalette);\n\n  const updateColor = useEvent((color: string, id: string) => {\n    setColorValues((prevColors) => {\n      const newColors = prevColors.map((oldColor) =>\n        oldColor.id === id ? { ...oldColor, color } : oldColor\n      );\n      return newColors;\n    });\n  });\n\n  const removeColor = useEvent((colorId: string) => {\n    setColorValues((prevColors) => {\n      const newColors = prevColors.filter(\n        (oldColor) => oldColor.id !== colorId\n      );\n      return newColors;\n    });\n  });\n\n  const addColor = useEvent(() => {\n    setColorValues((prevColors) => {\n      const newColors = [\n        ...prevColors,\n        { color: \"#000000\", id: createColorId() },\n      ];\n      return newColors;\n    });\n  });\n\n  const saveColorPalette = useEvent(async () => {\n    const titleExistsAlready = customColorPalettes?.find(\n      (palette) => palette.name === titleInput\n    );\n    if (titleExistsAlready) {\n      setIsNotAvailable(true);\n    } else {\n      setIsNotAvailable(false);\n      const palette = await createColorPalette.mutate({\n        name: titleInput,\n        colors: colorValues.map((c) => c.color),\n        type,\n      });\n\n      onClose(palette);\n    }\n  });\n\n  const captions: Record<CustomPaletteType[\"type\"], string> = {\n    sequential: t({\n      id: \"controls.custom-color-palettes.caption-sequential\",\n      message:\n        \"Select a dark endpoint color for a strong contrast between low and high values; the light color is calculated automatically. Sequential color palettes are suitable for ordered data such as temperatures or population densities.\",\n    }),\n    diverging: t({\n      id: \"controls.custom-color-palettes.caption-diverging\",\n      message:\n        \"Choose contrasting colors for the start and end points. These colors will help visually separate extreme values. Diverging palettes are ideal for data with a meaningful midpoint, such as zero or an average.\",\n    }),\n    categorical: t({\n      id: \"controls.custom-color-palettes.caption-categorical\",\n      message:\n        \"Use distinct, high-contrast colors. Avoid using too many colors, maximum 57. Apply sequential palettes for ordered data and diverging palettes for extremes.\",\n    }),\n  };\n\n  return (\n    <div\n      className={classes.autocompleteMenuContent}\n      ref={ref}\n      data-testid=\"colors-filters-drawer\"\n    >\n      <Box className={classes.autocompleteHeader}>\n        <Flex alignItems=\"center\" justifyContent=\"space-between\">\n          <Typography\n            variant=\"h4\"\n            sx={{\n              py: 4,\n            }}\n          >\n            <Trans id=\"controls.custom-color-palettes\">\n              Custom color palettes\n            </Trans>\n          </Typography>\n          <IconButton\n            sx={{ mt: \"-0.5rem\" }}\n            size=\"small\"\n            onClick={() => onClose()}\n          >\n            <SvgIcClose fontSize=\"inherit\" />\n          </IconButton>\n        </Flex>\n        <Typography variant=\"body2\" color=\"textSecondary\">\n          {captions[type]}\n        </Typography>\n      </Box>\n      <Flex\n        sx={{\n          mt: 4,\n          gap: 4,\n          paddingX: \"1rem\",\n        }}\n        flexDirection={\"column\"}\n      >\n        <Flex flexDirection={\"column\"}>\n          <Input\n            error={isNotAvailable}\n            label={t({ id: \"controls.custom-color-palettes.title\" })}\n            name=\"custom-color-palette-title\"\n            value={titleInput}\n            onChange={(e) => setTitleInput(e.target.value)}\n          />\n          {isNotAvailable && (\n            <Typography color={\"error.main\"} variant=\"caption\">\n              <Trans id=\"controls.custom-color-palettes.title-unavailable\">\n                This name is already in use. Please choose a unique name for\n                your color palette.\n              </Trans>\n            </Typography>\n          )}\n        </Flex>\n        <ColorPaletteCreator\n          title={titleInput}\n          type={type}\n          colorValues={colorValues}\n          onRemove={removeColor}\n          onUpdate={updateColor}\n          onAdd={addColor}\n        />\n      </Flex>\n\n      <Box className={classes.autocompleteApplyButtonContainer}>\n        <Button\n          disabled={colorValues.length === 0 || titleInput === \"\"}\n          className={classes.autocompleteApplyButton}\n          onClick={saveColorPalette}\n        >\n          <Trans id=\"controls.custom-color-palettes.set-values-apply\">\n            Save color palette\n          </Trans>\n        </Button>\n      </Box>\n    </div>\n  );\n});\n","import {\n  Box,\n  BoxProps,\n  Collapse,\n  Skeleton,\n  Theme,\n  Typography,\n  TypographyProps,\n  useEventCallback,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport {\n  ComponentProps,\n  createContext,\n  forwardRef,\n  HTMLProps,\n  ReactNode,\n  useContext,\n  useMemo,\n} from \"react\";\n\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport { useDisclosure } from \"@/components/use-disclosure\";\nimport { isConfiguring, isLayouting } from \"@/configurator/configurator-state\";\nimport { Icon, IconName } from \"@/icons\";\nimport { useConfiguratorState } from \"@/src\";\n\nconst useControlSectionStyles = makeStyles<Theme, { hideTopBorder: boolean }>(\n  (theme) => ({\n    controlSection: {\n      borderTopColor: theme.palette.divider,\n      borderTopWidth: ({ hideTopBorder }) => (hideTopBorder ? 0 : \"1px\"),\n      borderTopStyle: \"solid\",\n      overflowX: \"hidden\",\n      overflowY: \"auto\",\n      flexShrink: 0,\n    },\n  })\n);\n\nexport const useSectionTitleStyles = makeStyles<\n  Theme,\n  {\n    disabled?: boolean;\n    sectionOpen: boolean;\n    interactive?: boolean;\n    warn?: boolean;\n  }\n>((theme) => ({\n  text: {\n    flexGrow: 1,\n    display: \"flex\",\n    alignItems: \"center\",\n    color: theme.palette.text.primary,\n    fontWeight: 700,\n\n    \"& > svg:first-of-type\": {\n      marginRight: theme.spacing(1),\n    },\n  },\n  textDisabled: {\n    color: theme.palette.monochrome[300],\n  },\n  root: {\n    display: \"flex\",\n    justifyContent: \"flex-start\",\n    alignItems: \"center\",\n    width: \"100%\",\n    padding: theme.spacing(4),\n    border: \"none\",\n    backgroundColor: ({ warn }) =>\n      warn ? theme.palette.orange[50] : \"transparent\",\n    color: ({ disabled, warn }) => {\n      if (disabled) {\n        return theme.palette.monochrome[300];\n      }\n\n      if (warn) {\n        return theme.palette.orange.main;\n      }\n\n      return theme.palette.monochrome[800];\n    },\n    WebkitUserSelect: \"none\",\n    transition: \"background-color 0.2s ease\",\n\n    \"&:hover\": {\n      cursor: ({ interactive }) => (interactive ? \"pointer\" : \"initial\"),\n      backgroundColor: ({ interactive }) => {\n        if (interactive) {\n          return theme.palette.cobalt[50];\n        }\n\n        return \"transparent\";\n      },\n    },\n  },\n  icon: {\n    lineHeight: 0,\n    justifySelf: \"flex-end\",\n  },\n}));\n\nconst ControlSectionContext = createContext({\n  open: () => {},\n  isOpen: false,\n  close: () => {},\n  setOpen: (_v: boolean | ((oldV: boolean) => boolean)) => {},\n  collapse: true as boolean | undefined,\n});\n\nexport const ControlSection = forwardRef<\n  HTMLDivElement,\n  {\n    children: ReactNode;\n    sx?: BoxProps[\"sx\"];\n    collapse?: boolean;\n    defaultExpanded?: boolean;\n    hideTopBorder?: boolean;\n  } & Omit<HTMLProps<HTMLDivElement>, \"ref\">\n>(function ControlSection(\n  {\n    role,\n    children,\n    sx,\n    collapse = false,\n    defaultExpanded = true,\n    hideTopBorder = false,\n    ...props\n  },\n  ref\n) {\n  const classes = useControlSectionStyles({ hideTopBorder });\n  const disclosure = useDisclosure(defaultExpanded);\n  const ctx = useMemo(\n    () => ({ ...disclosure, collapse }),\n    [collapse, disclosure]\n  );\n\n  return (\n    <ControlSectionContext.Provider value={ctx}>\n      <Box\n        ref={ref}\n        role={role}\n        data-testid=\"controlSection\"\n        sx={sx}\n        {...props}\n        className={clsx(classes.controlSection, props.className)}\n      >\n        {children}\n      </Box>\n    </ControlSectionContext.Provider>\n  );\n});\n\ntype ControlSectionContentProps = {\n  children: ReactNode;\n  px?: \"md\" | \"none\";\n  gap?: \"xl\" | \"lg\" | \"md\" | \"none\";\n} & Omit<BoxProps, \"children\">;\n\nconst useControlSectionContentStyles = makeStyles<\n  Theme,\n  Pick<ControlSectionContentProps, \"gap\" | \"px\">\n>((theme) => ({\n  controlSectionContent: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: ({ gap }) => {\n      switch (gap) {\n        case \"xl\":\n          return theme.spacing(4);\n        case \"lg\":\n          return theme.spacing(3);\n        case \"md\":\n          return theme.spacing(2);\n        case \"none\":\n        case undefined:\n          return 0;\n        default:\n          const _exhaustiveCheck: never = gap;\n          return _exhaustiveCheck;\n      }\n    },\n    minWidth: 0,\n    padding: ({ px: _px }) => {\n      const px: string = (() => {\n        switch (_px) {\n          case \"none\":\n            return \"0px\";\n          case \"md\":\n            return theme.spacing(4);\n          case undefined:\n            return \"0px\";\n          default:\n            const _exhaustiveCheck: never = _px;\n            return _exhaustiveCheck;\n        }\n      })();\n\n      return `${theme.spacing(2)} ${px} ${theme.spacing(4)}`;\n    },\n  },\n}));\n\nexport const ControlSectionContent = ({\n  component = \"div\",\n  role,\n  children,\n  px = \"md\",\n  gap = \"md\",\n  sx,\n  ...props\n}: ControlSectionContentProps) => {\n  const classes = useControlSectionContentStyles({ gap, px });\n  const disclosure = useControlSectionContext();\n\n  return (\n    <Collapse in={disclosure.isOpen}>\n      <Box\n        component={component}\n        role={role}\n        {...props}\n        className={classes.controlSectionContent}\n        sx={sx}\n      >\n        {children}\n      </Box>\n    </Collapse>\n  );\n};\n\nexport const useControlSectionContext = () => useContext(ControlSectionContext);\n\nexport const SectionTitle = ({\n  children,\n  closable: _closable,\n  onClose,\n  id,\n  disabled,\n  iconName,\n  warnMessage,\n  sx,\n}: {\n  children: ReactNode;\n  closable?: boolean;\n  onClose?: () => void;\n  id?: string;\n  disabled?: boolean;\n  iconName?: IconName;\n  warnMessage?: string | ReactNode;\n  sx?: TypographyProps[\"sx\"];\n}) => {\n  const closable = !!(_closable || onClose);\n  const [state, dispatch] = useConfiguratorState();\n  const handleClick = useEventCallback(() => {\n    if (collapse) {\n      return setOpen((d) => !d);\n    }\n\n    if (!closable) {\n      return;\n    }\n\n    if (onClose) {\n      onClose();\n      return;\n    }\n\n    if (isConfiguring(state)) {\n      return dispatch({\n        type: \"CHART_ACTIVE_FIELD_CHANGE\",\n        value: undefined,\n      });\n    }\n\n    if (isLayouting(state)) {\n      return dispatch({\n        type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n        value: undefined,\n      });\n    }\n  });\n\n  const { setOpen, isOpen, collapse } = useControlSectionContext();\n  const classes = useSectionTitleStyles({\n    disabled,\n    sectionOpen: isOpen,\n    interactive: !!collapse || !!closable,\n    warn: !!warnMessage,\n  });\n\n  return (\n    <Box\n      aria-label={closable ? \"Back to main\" : undefined}\n      component={closable || collapse ? \"button\" : \"div\"}\n      className={classes.root}\n      onClick={handleClick}\n    >\n      <Typography\n        variant=\"h6\"\n        id={id}\n        className={clsx(classes.text, disabled && classes.textDisabled)}\n        sx={sx}\n      >\n        {closable ? (\n          <Icon name=\"chevronLeft\" />\n        ) : iconName ? (\n          <Icon name={iconName} />\n        ) : null}\n        {children}\n      </Typography>\n      {warnMessage && <Warning title={warnMessage} />}\n      <span className={classes.icon}>\n        {collapse ? <Icon name={isOpen ? \"minus\" : \"plus\"} /> : null}\n      </span>\n    </Box>\n  );\n};\n\nexport const ControlSectionSkeleton = ({\n  sx,\n  showTitle = true,\n}: {\n  sx?: ComponentProps<typeof ControlSection>[\"sx\"];\n  showTitle?: boolean;\n}) => (\n  <ControlSection sx={{ mt: 2, ...sx }}>\n    <ControlSectionContent gap=\"none\">\n      {showTitle ? (\n        <Typography variant=\"h1\">\n          <Skeleton sx={{ bgcolor: \"cobalt.50\" }} />\n        </Typography>\n      ) : null}\n      <Skeleton\n        variant=\"rectangular\"\n        sx={{\n          width: \"100%\",\n          height: 120,\n          mt: showTitle ? 0 : 2,\n          bgcolor: \"cobalt.50\",\n        }}\n      />\n    </ControlSectionContent>\n  </ControlSection>\n);\n\nconst Warning = ({ title }: { title: string | ReactNode }) => {\n  return (\n    <MaybeTooltip title={title}>\n      <Typography sx={{ mr: 2, lineHeight: \"0 !important\" }}>\n        <Icon name=\"warningCircle\" />\n      </Typography>\n    </MaybeTooltip>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, BoxProps, Divider, Typography } from \"@mui/material\";\nimport { SyntheticEvent, useCallback } from \"react\";\n\nimport {\n  comboChartTypes,\n  getEnabledChartTypes,\n  regularChartTypes,\n} from \"@/charts\";\nimport { Flex } from \"@/components/flex\";\nimport { HintError } from \"@/components/hint\";\nimport { InfoIconTooltip } from \"@/components/info-icon-tooltip\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport { ChartType, ConfiguratorStatePublished } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { ControlSectionSkeleton } from \"@/configurator/components/chart-controls/section\";\nimport { IconButton } from \"@/configurator/components/icon-button\";\nimport { useAddOrEditChartType } from \"@/configurator/config-form\";\nimport { ConfiguratorStateWithChartConfigs } from \"@/configurator/configurator-state\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const ChartTypeSelector = ({\n  state,\n  type = \"edit\",\n  showHelp,\n  showComparisonCharts = true,\n  chartKey,\n  ...rest\n}: {\n  state: Exclude<ConfiguratorStateWithChartConfigs, ConfiguratorStatePublished>;\n  type?: \"add\" | \"edit\";\n  showHelp?: boolean;\n  showComparisonCharts?: boolean;\n  chartKey: string;\n} & BoxProps) => {\n  const locale = useLocale();\n  const chartConfig = getChartConfig(state);\n  const [{ data }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        joinBy: cube.joinBy,\n        loadValues: true,\n      })),\n    },\n  });\n  const dimensions = data?.dataCubesComponents?.dimensions ?? [];\n  const measures = data?.dataCubesComponents?.measures ?? [];\n  const { value: chartType, addOrEditChartType } = useAddOrEditChartType(\n    chartKey,\n    type,\n    dimensions,\n    measures\n  );\n\n  const handleClick = useCallback(\n    (e: SyntheticEvent<HTMLButtonElement, Event>) => {\n      const newChartType = e.currentTarget.value as ChartType;\n\n      // Disable triggering the change event if the chart type is the same,\n      // only in edit mode; we should be able to add any possible chart type\n      // in add mode.\n      if (type === \"edit\" ? newChartType !== chartType : true) {\n        addOrEditChartType(newChartType);\n      }\n    },\n    [chartType, addOrEditChartType, type]\n  );\n\n  if (!data?.dataCubesComponents) {\n    return <ControlSectionSkeleton />;\n  }\n\n  const { enabledChartTypes, possibleChartTypesDict } = getEnabledChartTypes({\n    dimensions,\n    measures,\n    cubeCount: chartConfig.cubes.length,\n  });\n\n  return (\n    <Box {...rest}>\n      <legend style={{ display: \"none\" }}>\n        <Trans id=\"controls.select.chart.type\">Chart Type</Trans>\n      </legend>\n      {showHelp === false ? null : (\n        <Box sx={{ m: 4, textAlign: \"center\" }}>\n          <Typography variant=\"body2\">\n            {type === \"add\" ? (\n              <Trans id=\"controls.add.chart\">Add another chart.</Trans>\n            ) : (\n              <Trans id=\"controls.switch.chart.type\">\n                Switch to another chart type while maintaining most filter\n                settings.\n              </Trans>\n            )}\n          </Typography>\n        </Box>\n      )}\n      <div>\n        {enabledChartTypes.length === 0 ? (\n          <HintError smaller>\n            <Trans id=\"hint.no.visualization.with.dataset\">\n              No visualization can be created with the selected dataset.\n            </Trans>\n          </HintError>\n        ) : (\n          <Flex sx={{ flexDirection: \"column\", gap: 4 }}>\n            <ChartTypeSelectorMenu\n              type={type}\n              title={t({\n                id: \"controls.chart.category.regular\",\n                message: \"Regular\",\n              })}\n              currentChartType={chartType}\n              chartTypes={regularChartTypes}\n              possibleChartTypesDict={possibleChartTypesDict}\n              onClick={handleClick}\n              testId=\"chart-type-selector-regular\"\n            />\n            {showComparisonCharts ? (\n              <>\n                <Divider sx={{ borderColor: \"cobalt.100\" }} />\n                <ChartTypeSelectorMenu\n                  type={type}\n                  title={t({\n                    id: \"controls.chart.category.combo\",\n                    message: \"Comparison\",\n                  })}\n                  titleHint={t({\n                    id: \"controls.chart.category.combo.hint\",\n                    message:\n                      \"Comparison chart types combine several measures in a chart, helping to visualize their relationships or correlations, even when they have different units or scales.\",\n                  })}\n                  currentChartType={chartType}\n                  chartTypes={comboChartTypes}\n                  possibleChartTypesDict={possibleChartTypesDict}\n                  onClick={handleClick}\n                  testId=\"chart-type-selector-combo\"\n                />\n              </>\n            ) : null}\n          </Flex>\n        )}\n      </div>\n    </Box>\n  );\n};\n\nconst ChartTypeSelectorMenu = ({\n  type,\n  title,\n  titleHint,\n  currentChartType,\n  chartTypes,\n  possibleChartTypesDict,\n  onClick,\n  testId,\n}: {\n  type: \"add\" | \"edit\";\n  title: string;\n  titleHint?: string;\n  currentChartType: ChartType;\n  chartTypes: ChartType[];\n  possibleChartTypesDict: ReturnType<\n    typeof getEnabledChartTypes\n  >[\"possibleChartTypesDict\"];\n  onClick: (e: SyntheticEvent<HTMLButtonElement, Event>) => void;\n  testId?: string;\n}) => {\n  return (\n    <Flex sx={{ flexDirection: \"column\", gap: 2 }}>\n      <Typography\n        variant=\"caption\"\n        sx={{\n          display: \"inline-flex\",\n          alignItems: \"center\",\n          gap: 1,\n          mx: \"auto\",\n        }}\n      >\n        {title}\n        {titleHint && <InfoIconTooltip title={titleHint} size={16} />}\n      </Typography>\n      <Box\n        data-testid={testId}\n        sx={{\n          display: \"grid\",\n          gridTemplateColumns: [\"1fr 1fr\", \"1fr 1fr\", \"1fr 1fr 1fr\"],\n          justifyItems: \"center\",\n          gap: 4,\n        }}\n      >\n        {chartTypes.map((chartType) => {\n          const { enabled, message } = possibleChartTypesDict[chartType];\n\n          return (\n            <MaybeTooltip\n              key={chartType}\n              title={!enabled && message ? message : undefined}\n              tooltipProps={{ placement: \"right\" }}\n            >\n              <div>\n                <IconButton\n                  label={chartType}\n                  value={chartType}\n                  checked={\n                    type === \"edit\" ? currentChartType === chartType : false\n                  }\n                  disabled={!enabled}\n                  onClick={onClick}\n                />\n              </div>\n            </MaybeTooltip>\n          );\n        })}\n      </Box>\n    </Flex>\n  );\n};\n","import { Drawer as MuiDrawer, DrawerProps } from \"@mui/material\";\nimport { styled } from \"@mui/material/styles\";\nimport { ReactNode } from \"react\";\n\nimport { HEADER_HEIGHT_CSS_VAR } from \"@/components/header-constants\";\nimport { PANEL_HEADER_CSS_VAR } from \"@/configurator/components/layout\";\n\nexport const DRAWER_WIDTH = 340;\n\nexport const ConfiguratorDrawer = styled(MuiDrawer)(({ theme }) => ({\n  \"&\": {\n    /**\n     * We use position static otherwise the Drawer is fixed and takes\n     * the whole screen, blocking screen underneath.\n     * */\n    position: \"static\",\n  },\n\n  \"& > .MuiPaper-root\": {\n    overflowX: \"hidden\",\n    top: `calc(${HEADER_HEIGHT_CSS_VAR} + ${PANEL_HEADER_CSS_VAR})`,\n    bottom: 0,\n    width: DRAWER_WIDTH,\n    height: \"auto\",\n    borderTop: `1px solid ${theme.palette.divider}`,\n    boxShadow: \"none\",\n  },\n}));\n\nexport const RightDrawer = ({\n  children,\n  open,\n  onClose,\n  onExited,\n}: {\n  children: ReactNode;\n  open?: DrawerProps[\"open\"];\n  onClose?: DrawerProps[\"onClose\"];\n  onExited?: () => void;\n}) => {\n  return (\n    <MuiDrawer\n      anchor=\"right\"\n      open={open}\n      variant=\"temporary\"\n      onClose={onClose}\n      SlideProps={{\n        onExited: onExited,\n      }}\n      PaperProps={{\n        sx: {\n          width: 1400,\n          maxWidth: \"100%\",\n          p: 8,\n        },\n      }}\n    >\n      {children}\n    </MuiDrawer>\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport { DatePicker, DatePickerProps, PickersDay } from \"@mui/lab\";\nimport { DatePickerView } from \"@mui/lab/DatePicker/shared\";\nimport { Box, IconButton, TextField } from \"@mui/material\";\nimport { timeFormat } from \"d3-time-format\";\nimport { ChangeEvent, ReactNode, useCallback } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport { Label } from \"@/components/form\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { TimeUnit } from \"@/graphql/resolver-types\";\nimport { Icon } from \"@/icons\";\n\nexport type DatePickerFieldProps = {\n  name: string;\n  label?: ReactNode;\n  value: Date | null;\n  onChange: (e: ChangeEvent<HTMLSelectElement>) => void;\n  disabled?: boolean;\n  isDateDisabled: (date: Date) => boolean;\n  sideControls?: ReactNode;\n  timeUnit?: DatePickerTimeUnit;\n  dateFormat?: (d: Date) => string;\n  parseDate: (s: string) => Date | null;\n  showClearButton?: boolean;\n} & Omit<\n  DatePickerProps<Date>,\n  \"value\" | \"onChange\" | \"shouldDisableDate\" | \"inputFormat\" | \"renderInput\"\n>;\n\nexport const DatePickerField = ({\n  name,\n  label,\n  value,\n  onChange,\n  disabled,\n  isDateDisabled,\n  sideControls,\n  timeUnit = TimeUnit.Day,\n  dateFormat = timeFormat(\"%Y-%m-%d\"),\n  parseDate,\n  showClearButton,\n  ...rest\n}: DatePickerFieldProps) => {\n  const handleChange = useCallback(\n    (date: Date | null) => {\n      if (!date || isDateDisabled(date)) {\n        return;\n      }\n\n      const e = {\n        target: {\n          value: dateFormat(date),\n        },\n      } as ChangeEvent<HTMLSelectElement>;\n\n      onChange(e);\n    },\n    [isDateDisabled, onChange, dateFormat]\n  );\n\n  const handleNoFilter = useCallback(() => {\n    const e = {\n      target: {\n        value: FIELD_VALUE_NONE,\n      },\n    } as ChangeEvent<HTMLSelectElement>;\n\n    onChange(e);\n  }, [onChange]);\n\n  const dateLimitProps = getDateRenderProps(timeUnit, isDateDisabled);\n\n  return (\n    <Flex sx={{ flexDirection: \"column\", gap: 1 }}>\n      {label && name && <Label htmlFor={name}>{label}</Label>}\n      <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\n        <DatePicker<Date>\n          {...rest}\n          {...dateLimitProps}\n          components={{\n            OpenPickerIcon: (props) => <Icon name=\"calendar\" {...props} />,\n          }}\n          PaperProps={{\n            elevation: 4,\n          }}\n          inputFormat={getInputFormat(timeUnit)}\n          views={getViews(timeUnit)}\n          value={value}\n          onAccept={handleChange}\n          onChange={(date, keyboardInputValue) => {\n            if (keyboardInputValue) {\n              handleChange(date);\n            }\n          }}\n          // We need to render the day picker ourselves to correctly highlight\n          // the selected day. It's broken in the MUI date picker.\n          renderDay={(day, _, dayPickerProps) => {\n            return (\n              <PickersDay\n                {...dayPickerProps}\n                selected={value?.getTime() === day.getTime()}\n              />\n            );\n          }}\n          renderInput={(params) => (\n            <TextField\n              hiddenLabel\n              size=\"small\"\n              {...params}\n              inputProps={{\n                ...params.inputProps,\n                value: value\n                  ? dateFormat(value)\n                  : t({\n                      id: \"controls.dimensionvalue.select\",\n                      message: \"Select filter\",\n                    }),\n              }}\n              onChange={(e) => {\n                handleChange(parseDate(e.target.value));\n              }}\n              sx={{\n                ...params.sx,\n                width: \"100%\",\n\n                \"& input\": {\n                  height: 40,\n                  typography: \"h6\",\n                },\n\n                \"& .MuiIconButton-root\": {\n                  p: 1,\n                },\n\n                \"& .MuiOutlinedInput-input\": {\n                  py: 0,\n                  pl: 4,\n                },\n\n                \"& svg\": {\n                  color: \"text.primary\",\n                },\n              }}\n              InputProps={{\n                ...params.InputProps,\n                endAdornment: (\n                  <Box sx={{ display: \"flex\", alignItems: \"center\" }}>\n                    {showClearButton && value && (\n                      <IconButton\n                        size=\"small\"\n                        onClick={handleNoFilter}\n                        sx={{\n                          p: 1,\n                          mr: -0.5,\n                        }}\n                      >\n                        <Icon name=\"close\" />\n                      </IconButton>\n                    )}\n                    {params.InputProps?.endAdornment}\n                  </Box>\n                ),\n              }}\n            />\n          )}\n          disabled={disabled}\n        />\n        {sideControls}\n      </Box>\n    </Flex>\n  );\n};\n\nexport type DatePickerTimeUnit =\n  | TimeUnit.Day\n  | TimeUnit.Week\n  | TimeUnit.Month\n  | TimeUnit.Year;\n\nexport const canRenderDatePickerField = (\n  timeUnit: TimeUnit\n): timeUnit is DatePickerTimeUnit => {\n  return [TimeUnit.Day, TimeUnit.Week, TimeUnit.Month, TimeUnit.Year].includes(\n    timeUnit\n  );\n};\n\nconst getDateRenderProps = (\n  timeUnit: DatePickerTimeUnit,\n  isDateDisabled: (d: any) => boolean\n):\n  | { shouldDisableDate: DatePickerProps[\"shouldDisableDate\"] }\n  | { shouldDisableYear: DatePickerProps[\"shouldDisableYear\"] } => {\n  switch (timeUnit) {\n    case TimeUnit.Day:\n    case TimeUnit.Week:\n    case TimeUnit.Month:\n      return { shouldDisableDate: isDateDisabled };\n    case TimeUnit.Year:\n      return { shouldDisableYear: isDateDisabled };\n    default:\n      const _exhaustiveCheck: never = timeUnit;\n      return _exhaustiveCheck;\n  }\n};\n\nconst getInputFormat = (timeUnit: DatePickerTimeUnit): string => {\n  switch (timeUnit) {\n    case TimeUnit.Day:\n    case TimeUnit.Week:\n      return \"dd.MM.yyyy\";\n    case TimeUnit.Month:\n      return \"MM.yyyy\";\n    case TimeUnit.Year:\n      return \"yyyy\";\n    default:\n      const _exhaustiveCheck: never = timeUnit;\n      return _exhaustiveCheck;\n  }\n};\n\nconst getViews = (timeUnit: DatePickerTimeUnit): DatePickerView[] => {\n  switch (timeUnit) {\n    case TimeUnit.Day:\n    case TimeUnit.Week:\n      return [\"year\", \"month\", \"day\"];\n    case TimeUnit.Month:\n      return [\"year\", \"month\"];\n    case TimeUnit.Year:\n      return [\"year\"];\n    default:\n      const _exhaustiveCheck: never = timeUnit;\n      return _exhaustiveCheck;\n  }\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, CircularProgress, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { TimeLocaleObject } from \"d3-time-format\";\nimport get from \"lodash/get\";\nimport orderBy from \"lodash/orderBy\";\nimport pick from \"lodash/pick\";\nimport dynamic from \"next/dynamic\";\nimport {\n  ChangeEvent,\n  ComponentProps,\n  ReactNode,\n  useCallback,\n  useMemo,\n  useState,\n} from \"react\";\n\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { LegendItem, LegendSymbol } from \"@/charts/shared/legend-color\";\nimport { Flex } from \"@/components/flex\";\nimport {\n  Checkbox,\n  CheckboxProps,\n  FormControlLabel,\n  Input,\n  MarkdownInput,\n  Radio,\n  Select,\n  SelectOption,\n  SelectOptionGroup,\n  Slider,\n  Switch,\n} from \"@/components/form\";\nimport { SelectTree } from \"@/components/select-tree\";\nimport { useDisclosure } from \"@/components/use-disclosure\";\nimport {\n  ChartConfig,\n  CustomPaletteType,\n  isColorInConfig,\n} from \"@/config-types\";\nimport { getChartConfig, useChartConfigFilters } from \"@/config-utils\";\nimport {\n  ControlTab,\n  ControlTabFieldInner,\n  ControlTabProps,\n  OnOffControlTab,\n} from \"@/configurator/components/chart-controls/control-tab\";\nimport {\n  DatePickerField,\n  DatePickerTimeUnit,\n} from \"@/configurator/components/field-date-picker\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport {\n  isMultiFilterFieldChecked,\n  Option,\n  useActiveChartField,\n  useActiveLayoutField,\n  useChartFieldField,\n  useChartOptionBooleanField,\n  useChartOptionRadioField,\n  useChartOptionSelectField,\n  useChartOptionSliderField,\n  useMetaField,\n  useMultiFilterContext,\n  useSingleFilterField,\n  useSingleFilterSelect,\n} from \"@/configurator/config-form\";\nimport {\n  isConfiguring,\n  isLayouting,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport {\n  Component,\n  Dimension,\n  HierarchyValue,\n  isJoinByComponent,\n  isTemporalOrdinalDimension,\n  TemporalDimension,\n} from \"@/domain/data\";\nimport {\n  isMostRecentValue,\n  VISUALIZE_MOST_RECENT_VALUE,\n} from \"@/domain/most-recent-value\";\nimport { useTimeFormatLocale } from \"@/formatters\";\nimport { Locale } from \"@/locales/locales\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { ColorItem, getPalette } from \"@/palettes\";\nimport { assert } from \"@/utils/assert\";\nimport { hierarchyToOptions } from \"@/utils/hierarchy\";\nimport { makeDimensionValueSorters } from \"@/utils/sorting-values\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { useUserPalettes } from \"@/utils/use-user-palettes\";\n\nconst ColorPickerMenu = dynamic(\n  () =>\n    import(\"./chart-controls/color-picker\").then((mod) => mod.ColorPickerMenu),\n  { ssr: false }\n);\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  root: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"flex-end\",\n    width: \"100%\",\n    gap: theme.spacing(1),\n    textAlign: \"left\",\n    WebkitBoxOrient: \"vertical\",\n    WebkitLineClamp: 2,\n    overflow: \"hidden\",\n  },\n  loadingIndicator: {\n    display: \"inline-block\",\n    marginTop: theme.spacing(1),\n    marginLeft: theme.spacing(2),\n  },\n}));\n\nexport const ControlTabField = ({\n  chartConfig,\n  fieldComponents,\n  value,\n  labelId,\n  disabled,\n  warnMessage,\n}: {\n  chartConfig: ChartConfig;\n  fieldComponents?: Component[];\n  value: string;\n  labelId: string | null;\n  disabled?: boolean;\n  warnMessage?: string;\n}) => {\n  const field = useActiveChartField({ value });\n\n  return (\n    <ControlTabFieldInner\n      chartConfig={chartConfig}\n      fieldComponents={fieldComponents}\n      value={`${field.value}`}\n      labelId={labelId}\n      checked={field.checked}\n      onClick={field.onClick}\n      disabled={disabled}\n      warnMessage={warnMessage}\n    />\n  );\n};\n\nexport const OnOffControlTabField = ({\n  value,\n  label,\n  icon,\n  active,\n}: {\n  value: string;\n  label: ReactNode;\n  icon: string;\n  active?: boolean;\n}) => {\n  const { checked, onClick } = useActiveChartField({ value });\n\n  return (\n    <OnOffControlTab\n      value={value}\n      label={label}\n      icon={icon}\n      checked={checked}\n      active={active}\n      onClick={onClick}\n    />\n  );\n};\n\nexport const DataFilterSelect = ({\n  dimension,\n  label,\n  id,\n  disabled,\n  optional,\n  sideControls,\n  hierarchy,\n  onOpen,\n  loading,\n}: {\n  dimension: Dimension;\n  label: ReactNode;\n  id: string;\n  disabled?: boolean;\n  optional?: boolean;\n  sideControls?: ReactNode;\n  hierarchy?: HierarchyValue[] | null;\n  onOpen?: () => void;\n  loading?: boolean;\n}) => {\n  const fieldProps = useSingleFilterSelect(dimensionToFieldProps(dimension));\n  const noneLabel = t({\n    id: \"controls.dimensionvalue.select\",\n    message: \"Select filter\",\n  });\n  const sortedValues = useMemo(() => {\n    const sorters = makeDimensionValueSorters(dimension);\n\n    return orderBy(\n      dimension.values,\n      sorters.map((s) => (dv) => s(dv.label))\n    );\n  }, [dimension]);\n\n  const allValues = useMemo(() => {\n    return optional\n      ? [\n          {\n            value: FIELD_VALUE_NONE,\n            label: noneLabel,\n            isNoneValue: true,\n          },\n          ...sortedValues,\n        ]\n      : sortedValues;\n  }, [optional, sortedValues, noneLabel]);\n\n  const hierarchyOptions = useMemo(() => {\n    if (!hierarchy) {\n      return;\n    }\n\n    return hierarchyToOptions(\n      hierarchy,\n      dimension.values.map((v) => v.value)\n    );\n  }, [hierarchy, dimension.values]);\n\n  const { open, close, isOpen } = useDisclosure();\n  const handleOpen = useEvent(() => {\n    open();\n    onOpen?.();\n  });\n  const handleClose = useEvent(() => {\n    close();\n  });\n\n  if (hierarchy && hierarchyOptions) {\n    return (\n      <SelectTree\n        label={<FieldLabel label={label} />}\n        id={id}\n        options={hierarchyOptions}\n        onClose={handleClose}\n        onOpen={handleOpen}\n        open={isOpen}\n        disabled={disabled}\n        sideControls={sideControls}\n        value={fieldProps.value}\n        onChange={(e) => {\n          fieldProps.onChange({ target: { value: e.target.value as string } });\n        }}\n      />\n    );\n  }\n\n  const canUseMostRecentValue = isTemporalOrdinalDimension(dimension);\n  const usesMostRecentValue = isMostRecentValue(fieldProps.value);\n  // Dimension values can be empty just before a filter is reloaded through\n  // ensurePossibleFilters\n  const maxValue = sortedValues[sortedValues.length - 1]?.value;\n\n  return (\n    <Select\n      id={id}\n      size=\"sm\"\n      label={\n        canUseMostRecentValue ? (\n          <div style={{ width: \"100%\" }}>\n            <Flex justifyContent=\"flex-end\" sx={{ mb: 0.5, mr: 7 }}>\n              <Switch\n                label={t({\n                  id: \"controls.filter.use-most-recent\",\n                  message: \"Use most recent\",\n                })}\n                size=\"sm\"\n                checked={usesMostRecentValue}\n                onChange={() =>\n                  fieldProps.onChange({\n                    target: {\n                      value: usesMostRecentValue\n                        ? `${maxValue}`\n                        : VISUALIZE_MOST_RECENT_VALUE,\n                    },\n                  })\n                }\n              />\n            </Flex>\n            <Flex\n              justifyContent=\"space-between\"\n              alignItems=\"center\"\n              gap={1}\n              width=\"100%\"\n            >\n              {label}\n            </Flex>\n          </div>\n        ) : (\n          <FieldLabel label={label} />\n        )\n      }\n      disabled={disabled || usesMostRecentValue}\n      options={allValues}\n      sort={false}\n      sideControls={sideControls}\n      open={isOpen}\n      onClose={handleClose}\n      onOpen={handleOpen}\n      loading={loading}\n      {...fieldProps}\n      value={usesMostRecentValue ? maxValue : fieldProps.value}\n    />\n  );\n};\n\nexport const dimensionToFieldProps = (dim: Component) => {\n  return isJoinByComponent(dim)\n    ? dim.originalIds.map((o) => pick(o, [\"cubeIri\", \"dimensionId\"]))\n    : [{ dimensionId: dim.id, cubeIri: dim.cubeIri }];\n};\n\nexport const DataFilterTemporal = ({\n  label: _label,\n  dimension,\n  timeUnit,\n  disabled,\n  isOptional,\n  sideControls,\n}: {\n  label: ReactNode;\n  dimension: TemporalDimension;\n  timeUnit: DatePickerTimeUnit;\n  disabled?: boolean;\n  isOptional?: boolean;\n  sideControls?: ReactNode;\n}) => {\n  const { values, timeFormat } = dimension;\n  const formatLocale = useTimeFormatLocale();\n  const formatDate = formatLocale.format(timeFormat);\n  const parseDate = formatLocale.parse(timeFormat);\n  const fieldProps = useSingleFilterSelect(dimensionToFieldProps(dimension));\n  const usesMostRecentDate = isMostRecentValue(fieldProps.value);\n  const label = isOptional ? (\n    <span>\n      {_label}{\" \"}\n      <span style={{ marginLeft: \"0.25rem\" }}>\n        (<Trans id=\"controls.select.optional\">optional</Trans>)\n      </span>\n    </span>\n  ) : (\n    _label\n  );\n  const { minDate, maxDate, optionValues } = useMemo(() => {\n    if (values.length) {\n      const options = values.map((d) => {\n        return {\n          label: `${d.value}`,\n          value: `${d.value}`,\n        };\n      });\n\n      return {\n        minDate: parseDate(`${values[0].value}`) as Date,\n        maxDate: parseDate(`${values[values.length - 1].value}`) as Date,\n        optionValues: options.map((d) => d.value),\n      };\n    } else {\n      const date = new Date();\n      return {\n        minDate: date,\n        maxDate: date,\n        optionValues: [],\n      };\n    }\n  }, [values, parseDate]);\n  const isDateDisabled = useCallback(\n    (date: Date) => {\n      return !optionValues.includes(formatDate(date));\n    },\n    [optionValues, formatDate]\n  );\n\n  return (\n    <>\n      <DatePickerField\n        name={`date-picker-${dimension.id}`}\n        label={<FieldLabel label={label} />}\n        value={\n          usesMostRecentDate ? maxDate : (parseDate(fieldProps.value) as Date)\n        }\n        onChange={fieldProps.onChange}\n        isDateDisabled={isDateDisabled}\n        timeUnit={timeUnit}\n        dateFormat={formatDate}\n        minDate={minDate}\n        maxDate={maxDate}\n        disabled={disabled || usesMostRecentDate}\n        sideControls={sideControls}\n        parseDate={parseDate}\n      />\n      <Box sx={{ mt: 3 }}>\n        <Switch\n          label={t({\n            id: \"controls.filter.use-most-recent\",\n            message: \"Use most recent\",\n          })}\n          size=\"sm\"\n          checked={usesMostRecentDate}\n          onChange={() =>\n            fieldProps.onChange({\n              target: {\n                value: usesMostRecentDate\n                  ? formatDate(maxDate)\n                  : VISUALIZE_MOST_RECENT_VALUE,\n              },\n            })\n          }\n        />\n      </Box>\n    </>\n  );\n};\n\nexport const TimeInput = ({\n  id,\n  label,\n  value,\n  timeFormat,\n  formatLocale,\n  isOptional,\n  onChange,\n}: {\n  id: string;\n  label: ReactNode;\n  value: string | undefined;\n  timeFormat: string;\n  formatLocale: TimeLocaleObject;\n  isOptional: boolean | undefined;\n  onChange: (e: ChangeEvent<HTMLInputElement>) => void;\n}) => {\n  const [inputValue, setInputValue] = useState(\n    value === FIELD_VALUE_NONE ? undefined : value\n  );\n\n  const [parseDateValue, formatDateValue] = useMemo(\n    () => [formatLocale.parse(timeFormat), formatLocale.format(timeFormat)],\n    [timeFormat, formatLocale]\n  );\n\n  const onInputChange = useCallback<(e: ChangeEvent<HTMLInputElement>) => void>(\n    (e) => {\n      setInputValue(e.currentTarget.value);\n\n      if (e.currentTarget.value === \"\") {\n        if (isOptional) {\n          onChange(e);\n        } else {\n          setInputValue(value);\n        }\n      } else {\n        const parsed = parseDateValue(e.currentTarget.value);\n        const isValidDate =\n          parsed !== null && formatDateValue(parsed) === e.currentTarget.value;\n\n        if (isValidDate) {\n          onChange(e);\n        }\n      }\n    },\n    [formatDateValue, onChange, parseDateValue, value, isOptional]\n  );\n\n  return (\n    <Input\n      name={id}\n      label={label}\n      value={inputValue}\n      onChange={onInputChange}\n    />\n  );\n};\n\ntype AnnotatorTabFieldProps<T extends string = string> = {\n  value: T;\n  emptyValueWarning?: ReactNode;\n} & Omit<ControlTabProps, \"onClick\" | \"value\">;\n\nexport const ChartAnnotatorTabField = (props: AnnotatorTabFieldProps) => {\n  const { value, emptyValueWarning, ...tabProps } = props;\n  const fieldProps = useActiveChartField({ value });\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const locale = useLocale();\n\n  return (\n    <ControlTab\n      {...tabProps}\n      lowerLabel={\n        (chartConfig.meta as any)[value]?.[locale] ? null : (\n          <Typography variant=\"caption\" color=\"orange.main\">\n            {emptyValueWarning}\n          </Typography>\n        )\n      }\n      value={`${fieldProps.value}`}\n      checked={fieldProps.checked}\n      onClick={fieldProps.onClick}\n    />\n  );\n};\n\nexport const LayoutAnnotatorTabField = (\n  props: AnnotatorTabFieldProps<\"title\" | \"description\" | \"label\">\n) => {\n  const { value, emptyValueWarning, ...tabProps } = props;\n  const fieldProps = useActiveLayoutField({ value });\n  const [state] = useConfiguratorState(isLayouting);\n  const locale = useLocale();\n\n  return (\n    <ControlTab\n      {...tabProps}\n      lowerLabel={\n        state.layout.meta[value][locale] ? null : (\n          <Typography variant=\"caption\" color=\"orange.main\">\n            {emptyValueWarning}\n          </Typography>\n        )\n      }\n      value={`${fieldProps.value}`}\n      checked={fieldProps.checked}\n      onClick={fieldProps.onClick}\n    />\n  );\n};\n\nexport const MetaInputField = ({\n  type,\n  inputType,\n  label,\n  metaKey,\n  locale,\n  value,\n  disableToolbar,\n}: {\n  type: \"chart\" | \"layout\";\n  inputType: \"text\" | \"markdown\";\n  label: string | ReactNode;\n  metaKey: string;\n  locale: string;\n  value?: string;\n  disableToolbar?: ComponentProps<typeof MarkdownInput>[\"disableToolbar\"];\n}) => {\n  const field = useMetaField({ type, metaKey, locale, value });\n\n  switch (inputType) {\n    case \"text\":\n      return <Input label={label} {...field} />;\n    case \"markdown\":\n      return (\n        <MarkdownInput\n          label={label}\n          {...field}\n          disableToolbar={disableToolbar}\n        />\n      );\n    default:\n      const _exhaustiveCheck: never = inputType;\n      return _exhaustiveCheck;\n  }\n};\n\nexport const TextBlockInputField = ({ locale }: { locale: Locale }) => {\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const { layout } = state;\n  const { blocks } = layout;\n  const activeBlock = useMemo(() => {\n    const activeBlock = blocks.find(\n      (block) => block.key === layout.activeField\n    );\n\n    assert(\n      activeBlock?.type === \"text\",\n      \"We can only edit text blocks from TextBlockInputField\"\n    );\n\n    return activeBlock;\n  }, [blocks, layout.activeField]);\n  const handleChanged = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      const text = e.currentTarget.value;\n      dispatch({\n        type: \"LAYOUT_CHANGED\",\n        value: {\n          ...layout,\n          blocks: blocks.map((b) =>\n            b.key === activeBlock.key\n              ? {\n                  ...b,\n                  text: {\n                    ...activeBlock.text,\n                    [locale]: text,\n                  },\n                }\n              : b\n          ),\n        },\n      });\n    },\n    [dispatch, layout, blocks, activeBlock.key, activeBlock.text, locale]\n  );\n  const label = getFieldLabel(locale);\n\n  return (\n    <MarkdownInput\n      name={label}\n      label={label}\n      value={activeBlock.text[locale]}\n      onChange={handleChanged}\n    />\n  );\n};\n\nconst useMultiFilterColorPicker = (\n  value: string,\n  customColorPalettes?: CustomPaletteType[]\n) => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const filters = useChartConfigFilters(chartConfig);\n  const { dimensionId, colorConfigPath } = useMultiFilterContext();\n  const { activeField } = chartConfig;\n\n  const hasColorField = isColorInConfig(chartConfig);\n  const colorField = hasColorField ? \"color\" : activeField;\n\n  const onChange = useCallback(\n    (color: string) => {\n      if (colorField) {\n        dispatch({\n          type: \"CHART_COLOR_CHANGED\",\n          value: {\n            field: colorField,\n            colorConfigPath: hasColorField ? \"\" : \"color\",\n            color,\n            value,\n          },\n        });\n      }\n    },\n\n    [dispatch, colorField, value, hasColorField]\n  );\n\n  const path = colorConfigPath ? `color.${colorConfigPath}` : \"\";\n\n  const color = get(\n    chartConfig,\n    `fields[\"${colorField}\"].${path}${hasColorField ? \"colorMapping\" : \"\"}[\"${value}\"]`\n  );\n\n  const palette = useMemo(() => {\n    const paletteId = get(chartConfig, `fields[\"${colorField}\"].paletteId`);\n\n    return getPalette({\n      paletteId,\n      fallbackPalette: customColorPalettes?.find(\n        (palette) => palette.paletteId === paletteId\n      )?.colors,\n    });\n  }, [chartConfig, colorField, customColorPalettes]);\n\n  const checked = dimensionId\n    ? isMultiFilterFieldChecked(filters, dimensionId, value)\n    : null;\n\n  return useMemo(() => {\n    return {\n      color,\n      palette,\n      onChange,\n      checked,\n    };\n  }, [color, palette, onChange, checked]);\n};\n\nexport const MultiFilterField = ({\n  value,\n  label,\n  symbol,\n  enableShowValue,\n}: {\n  value: string;\n  label: string;\n  symbol: LegendSymbol;\n  enableShowValue?: boolean;\n}) => {\n  const { data: customColorPalettes } = useUserPalettes();\n  const { color, checked, palette, onChange } = useMultiFilterColorPicker(\n    value,\n    customColorPalettes\n  );\n\n  return color && checked ? (\n    <Flex\n      sx={{\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        gap: 2,\n        width: \"100%\",\n      }}\n    >\n      <LegendItem symbol={symbol} label={label} color={color} />\n      <Flex sx={{ alignItems: \"center\", gap: 1 }}>\n        {enableShowValue ? <ShowValuesMappingField value={value} /> : null}\n        <ColorPickerMenu\n          colors={palette}\n          selectedHexColor={color}\n          onChange={onChange}\n        />\n      </Flex>\n    </Flex>\n  ) : null;\n};\n\nexport const ShowValuesMappingField = ({ value }: { value: string }) => {\n  return (\n    <ChartOptionCheckboxField\n      label={t({ id: \"controls.filter.show-values\", message: \"Show value\" })}\n      size=\"sm\"\n      field=\"segment\"\n      path={`showValuesMapping[\"${value}\"]`}\n    />\n  );\n};\n\nexport const SingleFilterField = ({\n  filters,\n  label,\n  value,\n  disabled,\n}: {\n  filters: { cubeIri: string; dimensionId: string }[];\n  label: string;\n  value: string;\n  disabled?: boolean;\n}) => {\n  const field = useSingleFilterField({ filters, value });\n\n  return <Radio label={label} disabled={disabled} {...field} />;\n};\n\nexport const ColorPicker = ({\n  label,\n  color,\n  symbol,\n  colors,\n  onChange,\n  disabled,\n}: {\n  label: string;\n  color: string;\n  symbol: LegendSymbol;\n  colors?: ColorItem[] | readonly string[];\n  onChange: (color: string) => void;\n  disabled?: boolean;\n}) => {\n  return (\n    <Flex\n      justifyContent=\"space-between\"\n      alignItems=\"center\"\n      gap={2}\n      width=\"100%\"\n    >\n      <LegendItem label={label} color={color} symbol={symbol} />\n      <ColorPickerMenu\n        colors={colors}\n        selectedHexColor={color}\n        onChange={onChange}\n        disabled={disabled}\n      />\n    </Flex>\n  );\n};\n\nexport const ColorPickerField = ({\n  symbol = \"square\",\n  field,\n  path,\n  label,\n  disabled,\n}: {\n  symbol?: LegendSymbol;\n  field: EncodingFieldType;\n  path: string;\n  label: string;\n  disabled?: boolean;\n}) => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n\n  const updateColor = useCallback(\n    (value: string) =>\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field,\n          path,\n          value,\n        },\n      }),\n    [locale, dispatch, field, path]\n  );\n\n  const { data: customColorPalettes } = useUserPalettes();\n  const paletteId = get(chartConfig, `fields[\"${field}\"].paletteId`);\n\n  const color = get(chartConfig, `fields[\"${field}\"].${path}`);\n  const palette = getPalette({\n    paletteId,\n    fallbackPalette: customColorPalettes?.find(\n      (palette) => palette.paletteId === paletteId\n    )?.colors,\n  });\n\n  return (\n    <ColorPicker\n      label={label}\n      color={color}\n      symbol={symbol}\n      colors={palette}\n      onChange={updateColor}\n      disabled={disabled}\n    />\n  );\n};\n\nexport const LoadingIndicator = () => {\n  const classes = useStyles();\n\n  return <CircularProgress size={16} className={classes.loadingIndicator} />;\n};\n\nexport const FieldLabel = ({\n  label,\n  isFetching,\n}: {\n  label: ReactNode;\n  isFetching?: boolean;\n}) => {\n  const classes = useStyles();\n\n  return (\n    <Typography className={classes.root} variant=\"caption\">\n      {label}\n      {isFetching ? <LoadingIndicator /> : null}\n    </Typography>\n  );\n};\n\nconst getOptionsWithMaybeOptional = (\n  options: SelectOption[],\n  optional: boolean\n): SelectOption[] => {\n  return optional\n    ? [\n        {\n          value: FIELD_VALUE_NONE,\n          label: t({\n            id: \"controls.none\",\n            message: \"None\",\n          }),\n          isNoneValue: true,\n        },\n        ...options,\n      ]\n    : options;\n};\n\nconst getOptionGroupsWithMaybeOptional = (\n  optionGroups: SelectOptionGroup[],\n  optional: boolean\n): SelectOptionGroup[] | undefined => {\n  return optional\n    ? [\n        [\n          undefined,\n          [\n            {\n              value: FIELD_VALUE_NONE,\n              label: t({\n                id: \"controls.none\",\n                message: \"None\",\n              }),\n              isNoneValue: true,\n            },\n          ],\n        ],\n        ...optionGroups,\n      ]\n    : optionGroups;\n};\n\nexport const ChartFieldField = ({\n  label = \"\",\n  field,\n  options,\n  optionGroups,\n  optional,\n  disabled,\n  components,\n}: {\n  label?: string;\n  field: EncodingFieldType;\n  options: Option[];\n  optionGroups?: SelectOptionGroup[];\n  optional?: boolean;\n  disabled?: boolean;\n  components: Component[];\n}) => {\n  const props = useChartFieldField({ field, components });\n  const allOptions = useMemo(() => {\n    return getOptionsWithMaybeOptional(options, !!optional);\n  }, [options, optional]);\n  const allOptionGroups = useMemo(() => {\n    return optionGroups\n      ? getOptionGroupsWithMaybeOptional(optionGroups, !!optional)\n      : undefined;\n  }, [optionGroups, optional]);\n\n  return (\n    <Select\n      key={`select-${field}-dimension`}\n      id={field}\n      label={<FieldLabel label={label} />}\n      size=\"sm\"\n      disabled={disabled}\n      options={allOptions}\n      optionGroups={allOptionGroups}\n      {...props}\n    />\n  );\n};\n\nexport const ChartOptionRadioField = <V extends string | number>({\n  label,\n  field,\n  path,\n  value,\n  defaultChecked,\n  disabled = false,\n  warnMessage,\n}: {\n  label: string;\n  field: EncodingFieldType | null;\n  path: string;\n  value: V;\n  defaultChecked?: boolean;\n  disabled?: boolean;\n  warnMessage?: string;\n}) => {\n  const fieldProps = useChartOptionRadioField({\n    path,\n    field,\n    value,\n  });\n\n  return (\n    <Radio\n      disabled={disabled}\n      label={label}\n      {...fieldProps}\n      checked={fieldProps.checked ?? defaultChecked}\n      warnMessage={warnMessage}\n    />\n  );\n};\n\nexport const ChartOptionSliderField = ({\n  label,\n  field,\n  path,\n  disabled = false,\n  min = 0,\n  max = 1,\n  step = 0.1,\n  defaultValue,\n}: {\n  label: string;\n  field: EncodingFieldType | null;\n  path: string;\n  disabled?: boolean;\n  min?: number;\n  max?: number;\n  step?: number;\n  defaultValue: number;\n}) => {\n  const fieldProps = useChartOptionSliderField({\n    path,\n    field,\n    min,\n    max,\n    defaultValue,\n  });\n\n  return (\n    <Slider\n      disabled={disabled}\n      label={label}\n      min={min}\n      max={max}\n      step={step}\n      {...fieldProps}\n    />\n  );\n};\n\nexport const ChartOptionCheckboxField = ({\n  label,\n  size,\n  field,\n  path,\n  defaultValue = false,\n  disabled = false,\n}: {\n  label: string;\n  size?: CheckboxProps[\"size\"];\n  field: EncodingFieldType | null;\n  path: string;\n  defaultValue?: boolean;\n  disabled?: boolean;\n}) => {\n  const fieldProps = useChartOptionBooleanField({\n    field,\n    path,\n    defaultValue,\n  });\n\n  return (\n    <Checkbox\n      disabled={disabled}\n      label={label}\n      size={size}\n      {...fieldProps}\n      checked={fieldProps.checked ?? defaultValue}\n    />\n  );\n};\n\ntype ChartOptionSelectFieldProps<V> = {\n  id: string;\n  label: string | ReactNode;\n  field: EncodingFieldType;\n  path: string;\n  disabled?: boolean;\n  options: Option[];\n  optionGroups?: SelectOptionGroup[];\n  getValue?: (x: string) => V | undefined;\n  getKey?: (x: V) => string;\n  optional?: boolean;\n};\n\nexport const ChartOptionSelectField = <V extends {} = string>(\n  props: ChartOptionSelectFieldProps<V>\n) => {\n  const {\n    id,\n    label,\n    field,\n    path,\n    disabled = false,\n    options,\n    optionGroups,\n    getValue,\n    getKey,\n    optional,\n  } = props;\n  const fieldProps = useChartOptionSelectField({\n    field,\n    path,\n    getValue,\n    getKey,\n  });\n\n  const allOptions: SelectOption[] = useMemo(() => {\n    return getOptionsWithMaybeOptional(options, !!optional);\n  }, [optional, options]);\n  const allOptionGroups: SelectOptionGroup[] | undefined = useMemo(() => {\n    return optionGroups\n      ? getOptionGroupsWithMaybeOptional(optionGroups, !!optional)\n      : undefined;\n  }, [optional, optionGroups]);\n\n  return (\n    <Select\n      id={id}\n      disabled={disabled}\n      size=\"sm\"\n      label={<FieldLabel isFetching={false} label={label} />}\n      options={allOptions}\n      optionGroups={allOptionGroups}\n      {...fieldProps}\n    />\n  );\n};\n\nexport const ChartOptionSwitchField = ({\n  label,\n  size,\n  field,\n  path,\n  defaultValue = false,\n  disabled = false,\n  ...props\n}: {\n  label: ComponentProps<typeof FormControlLabel>[\"label\"];\n  size?: ComponentProps<typeof FormControlLabel>[\"size\"];\n  field: EncodingFieldType | null;\n  path: string;\n  defaultValue?: boolean;\n  disabled?: boolean;\n} & ComponentProps<typeof Switch>) => {\n  const fieldProps = useChartOptionBooleanField({\n    field,\n    path,\n    defaultValue,\n  });\n\n  return (\n    <Switch\n      disabled={disabled}\n      label={label}\n      size={size}\n      {...fieldProps}\n      {...props}\n      checked={fieldProps.checked ?? defaultValue}\n    />\n  );\n};\n","import get from \"lodash/get\";\nimport { ChangeEvent } from \"react\";\n\nimport { isSegmentInConfig } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { isConfiguring } from \"@/configurator/configurator-state\";\nimport { useConfiguratorState } from \"@/src\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const useLegendTitleVisibility = () => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const onChange = useEvent((e: ChangeEvent<HTMLInputElement>) => {\n    if (isSegmentInConfig(chartConfig)) {\n      dispatch({\n        type: \"CHART_SHOW_LEGEND_TITLE_CHANGED\",\n        value: e.currentTarget.checked,\n      });\n    }\n  });\n\n  const stateValue = get(chartConfig, `fields.segment.showTitle`);\n  const checked = stateValue ? stateValue : false;\n\n  return {\n    name: \"showTitle\",\n    checked,\n    onChange,\n  };\n};\n","import { Box, Typography } from \"@mui/material\";\nimport { brushX, D3BrushEvent } from \"d3-brush\";\nimport { scaleTime } from \"d3-scale\";\nimport { pointer, select, Selection } from \"d3-selection\";\nimport { CountableTimeInterval } from \"d3-time\";\nimport { useCallback, useEffect, useRef } from \"react\";\n\nimport { Flex } from \"@/components/flex\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { TimeUnit } from \"@/graphql/query-hooks\";\nimport { useTheme } from \"@/themes\";\nimport { useResizeObserver } from \"@/utils/use-resize-observer\";\n\nconst HANDLE_SIZE = 16;\nconst HANDLE_OFFSET = HANDLE_SIZE / 8;\nconst BRUSH_HEIGHT = 1;\nconst MARGIN = HANDLE_SIZE / 2;\n\nexport const EditorBrush = ({\n  timeExtent,\n  timeRange,\n  timeInterval,\n  timeUnit,\n  onChange,\n  disabled = false,\n  hideEndHandle = false,\n}: {\n  timeExtent: Date[];\n  timeRange: Date[];\n  timeInterval: CountableTimeInterval;\n  timeUnit: TimeUnit;\n  onChange: (extent: Date[]) => void;\n  disabled?: boolean;\n  hideEndHandle?: boolean;\n}) => {\n  const [resizeRef, width] = useResizeObserver<HTMLDivElement>();\n  const brushRef = useRef<SVGGElement>(null);\n  const { palette } = useTheme();\n  const timeFormatUnit = useTimeFormatUnit();\n\n  const brushWidth = width - (MARGIN + HANDLE_OFFSET) * 2;\n  const timeScale = scaleTime().domain(timeExtent).range([0, brushWidth]);\n\n  const getClosestDimensionValue = useCallback(\n    (date: Date) => timeInterval.round(date),\n    [timeInterval]\n  );\n\n  function brushed(e: D3BrushEvent<unknown>) {\n    const selection = e.selection as [number, number] | undefined;\n\n    if (selection) {\n      const [xStart, xEnd] = selection.map((s) =>\n        getClosestDimensionValue(timeScale.invert(s))\n      );\n\n      onChange([xStart, xEnd]);\n    } else {\n      const g = select(brushRef.current);\n      //@ts-ignore\n      const [mx] = pointer(e, this);\n      const x = mx < 0 ? 0 : mx > brushWidth ? brushWidth : mx;\n      g.call(brush.move as any, [x, x]);\n    }\n  }\n  const brush = brushX()\n    .extent([\n      [0, 0],\n      [brushWidth, BRUSH_HEIGHT],\n    ])\n    .on(\"end\", brushed);\n\n  useEffect(() => {\n    const g = select(brushRef.current);\n    const fill = disabled ? palette.grey[300] : palette.primary.main;\n    const pointerEvents = disabled ? \"none\" : \"auto\";\n    const mkBrush = (g: BrushSelection) => {\n      g.select(\".overlay\")\n        .attr(\"pointer-events\", pointerEvents)\n        .attr(\"fill\", palette.grey[300])\n        .attr(\"fill-opacity\", 0.9);\n      g.select(\".selection\")\n        .attr(\"pointer-events\", pointerEvents)\n        .attr(\"fill\", fill)\n        .attr(\"fill-opacity\", 1)\n        .attr(\"stroke\", \"none\");\n      g.selectAll(\".handle\")\n        .attr(\"pointer-events\", pointerEvents)\n        .attr(\"fill\", fill)\n        .style(\"y\", `-${HANDLE_SIZE / 2 - 1}px`)\n        .style(\"width\", `${HANDLE_SIZE}px`)\n        .style(\"height\", `${HANDLE_SIZE}px`)\n        .attr(\"rx\", `${HANDLE_SIZE}px`);\n\n      if (hideEndHandle) {\n        g.select(\".handle--e\").remove();\n      }\n\n      g.call(brush);\n    };\n\n    mkBrush(g as BrushSelection);\n  }, [brush, disabled, hideEndHandle, palette.grey, palette.primary.main]);\n\n  // Set default selection to full extent\n  const [fromPx, toPx] = timeRange.map(timeScale);\n\n  // FIXME: fix dependency array but don't include brush.move!\n  useEffect(() => {\n    const g = select(brushRef.current);\n    (g as BrushSelection).call(brush.move, [fromPx, toPx]);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fromPx, toPx]);\n\n  return (\n    <Box sx={{ mt: 4 }}>\n      <div ref={resizeRef} id=\"editor-brush\">\n        {width > 0 && (\n          <svg width={width} height={BRUSH_HEIGHT + MARGIN * 2}>\n            <g\n              ref={brushRef}\n              transform={`translate(${HANDLE_OFFSET * 2}, ${MARGIN})`}\n            />\n          </svg>\n        )}\n      </div>\n      <Flex\n        justifyContent=\"space-between\"\n        mt={1}\n        sx={{ px: `${HANDLE_OFFSET}px` }}\n      >\n        <Typography component=\"div\" variant=\"caption\">\n          {timeFormatUnit(timeExtent[0], timeUnit)}\n        </Typography>\n        <Typography component=\"div\" variant=\"caption\">\n          {timeFormatUnit(timeExtent[1], timeUnit)}\n        </Typography>\n      </Flex>\n    </Box>\n  );\n};\n\ntype BrushSelection = Selection<SVGGElement, unknown, null, undefined>;\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Accordion,\n  AccordionDetails,\n  AccordionSummary,\n  Box,\n  Button,\n  ClickAwayListener,\n  Divider,\n  IconButton,\n  Input,\n  InputAdornment,\n  SelectChangeEvent,\n  Theme,\n  Tooltip,\n  Typography,\n} from \"@mui/material\";\nimport { styled } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport { ascending, groups, max, sum } from \"d3-array\";\nimport get from \"lodash/get\";\nimport groupBy from \"lodash/groupBy\";\nimport keyBy from \"lodash/keyBy\";\nimport uniqBy from \"lodash/uniqBy\";\nimport {\n  ChangeEvent,\n  forwardRef,\n  MouseEventHandler,\n  MutableRefObject,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { getChartSymbol } from \"@/charts\";\nimport { makeGetClosestDatesFromDateRange } from \"@/charts/shared/brush/utils\";\nimport { useFootnotesStyles } from \"@/components/chart-footnotes\";\nimport { Flex } from \"@/components/flex\";\nimport { Select, Switch } from \"@/components/form\";\nimport { Loading } from \"@/components/hint\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport { MultiSelect } from \"@/components/multi-select\";\nimport { ChartConfig, ColorMapping, isColorInConfig } from \"@/config-types\";\nimport { getChartConfig, useChartConfigFilters } from \"@/config-utils\";\nimport { isSegmentInConfig } from \"@/configurator\";\nimport {\n  ColorField,\n  getFilterValue,\n  isConfiguring,\n  MultiFilterContextProvider,\n  shouldEnableSettingShowValuesBySegment,\n  useConfiguratorState,\n  useMultiFilterContext,\n} from \"@/configurator\";\nimport {\n  ConfiguratorDrawer,\n  DRAWER_WIDTH,\n} from \"@/configurator/components/drawers\";\nimport {\n  dimensionToFieldProps,\n  MultiFilterField,\n  ShowValuesMappingField,\n  SingleFilterField,\n} from \"@/configurator/components/field\";\nimport {\n  canRenderDatePickerField,\n  DatePickerField,\n} from \"@/configurator/components/field-date-picker\";\nimport { useLegendTitleVisibility } from \"@/configurator/configurator-state/segment-config-state\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { EditorBrush } from \"@/configurator/interactive-filters/editor-brush\";\nimport {\n  useDefaultValueOverride,\n  useInteractiveDataFilterToggle,\n  useInteractiveFiltersToggle,\n  useInteractiveTimeRangeToggle,\n} from \"@/configurator/interactive-filters/interactive-filters-config-state\";\nimport {\n  Component,\n  Dimension,\n  DimensionValue,\n  HierarchyValue,\n  TemporalDimension,\n  TemporalEntityDimension,\n} from \"@/domain/data\";\nimport {\n  isMostRecentValue,\n  VISUALIZE_MOST_RECENT_VALUE,\n} from \"@/domain/most-recent-value\";\nimport { useTimeFormatLocale, useTimeFormatUnit } from \"@/formatters\";\nimport { Icon } from \"@/icons\";\nimport SvgIcCheckmark from \"@/icons/components/IcCheckmark\";\nimport SvgIcClose from \"@/icons/components/IcClose\";\nimport SvgIcRefresh from \"@/icons/components/IcRefresh\";\nimport { getTimeInterval } from \"@/intervals\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport {\n  getOptionsFromTree,\n  joinParents,\n  pruneTree,\n  sortHierarchy,\n} from \"@/rdf/tree-utils\";\nimport { interlace } from \"@/utils/interlace\";\nimport { valueComparator } from \"@/utils/sorting-values\";\nimport { getTimeFilterOptions } from \"@/utils/time-filter-options\";\nimport { useEvent } from \"@/utils/use-event\";\n\nconst useStyles = makeStyles((theme: Theme) => {\n  return {\n    wrapper: {\n      \"--colorBoxSize\": \"12px\", // matches legend item size\n      \"--columnGap\": \"0.75rem\",\n      width: DRAWER_WIDTH,\n    },\n    header: {\n      margin: theme.spacing(4),\n    },\n    autocompleteApplyButtonContainer: {\n      position: \"sticky\",\n      zIndex: 1000,\n      left: 0,\n      right: 0,\n      bottom: theme.spacing(3),\n      marginTop: theme.spacing(6),\n      padding: `0 ${theme.spacing(4)}`,\n    },\n    autocompleteApplyButton: {\n      justifyContent: \"center\",\n    },\n    textInput: {\n      margin: `${theme.spacing(4)} 0px`,\n      padding: \"0px 12px\",\n      width: \"100%\",\n      height: 40,\n      minHeight: 40,\n    },\n    optionColor: {\n      width: \"var(--colorBoxSize)\",\n      height: \"var(--colorBoxSize)\",\n      flexShrink: 0,\n      outline: `1px solid ${theme.palette.divider}`,\n      transition: \"background-color 0.125s ease-out\",\n      alignSelf: \"flex-start\",\n      marginTop: theme.spacing(1.5),\n      marginRight: \"0.5rem\",\n    },\n    optionLabel: {\n      flexGrow: 1,\n      marginTop: -2,\n\n      [theme.breakpoints.up(\"xl\")]: {\n        marginTop: -3.5,\n      },\n    },\n    optionCheck: {\n      width: 16,\n      height: 16,\n      flexShrink: 0,\n      alignSelf: \"flex-start\",\n      marginTop: \"0.125rem\",\n    },\n    selectedValueRow: {\n      display: \"flex\",\n      alignItems: \"center\",\n      gap: theme.spacing(2),\n\n      \"&:not(:last-of-type)\": {\n        paddingBottom: theme.spacing(4),\n      },\n    },\n  };\n});\n\nconst explodeParents = (parents: string) => {\n  return parents ? parents.split(\" > \") : [];\n};\n\nconst groupByParent = (node: { parents: HierarchyValue[] }) => {\n  return joinParents(node?.parents);\n};\n\nexport const sortFilterValue = (a: HierarchyValue, b: HierarchyValue) => {\n  return (\n    ascending(a.position ?? 0, b.position ?? 0) ||\n    `${a.identifier}`.localeCompare(`${b.identifier}`, undefined, {\n      numeric: true,\n    }) ||\n    a.label.localeCompare(b.label)\n  );\n};\n\nexport const sortFilterValues = (values: HierarchyValue[]) => {\n  return values.sort(sortFilterValue);\n};\n\nconst getColorConfig = (chartConfig: ChartConfig) => {\n  if (isColorInConfig(chartConfig)) {\n    return get(chartConfig.fields, [\"color\"]) as ColorField | undefined;\n  } else {\n    return get(chartConfig.fields, [\n      chartConfig.activeField ?? \"symbolLayer\",\n      \"color\",\n    ]) as ColorField | undefined;\n  }\n};\n\nconst FilterControls = ({\n  selectAll,\n  selectNone,\n  allKeysLength,\n  activeKeysLength,\n}: {\n  selectAll: () => void;\n  selectNone: () => void;\n  allKeysLength: number;\n  activeKeysLength: number;\n}) => {\n  const classes = useFootnotesStyles({ useMarginTop: false });\n\n  return (\n    <Box className={classes.actions}>\n      <Button\n        variant=\"text\"\n        size=\"sm\"\n        disabled={activeKeysLength === allKeysLength}\n        onClick={selectAll}\n      >\n        <Trans id=\"controls.filter.select.all\">Select all</Trans>\n      </Button>\n      <Button\n        variant=\"text\"\n        size=\"sm\"\n        disabled={activeKeysLength === 0}\n        onClick={selectNone}\n      >\n        <Trans id=\"controls.filter.select.none\">Select none</Trans>\n      </Button>\n    </Box>\n  );\n};\n\nexport const getHasColorMapping = ({\n  colorConfig,\n  colorComponent,\n  filterDimensionId,\n}: {\n  colorConfig: ColorField | undefined;\n  colorComponent?: Component;\n  filterDimensionId: string;\n}) => {\n  return !!(\n    (colorConfig?.type === \"single\" ? false : colorConfig?.colorMapping) &&\n    (colorComponent !== undefined\n      ? filterDimensionId === colorComponent.id\n      : false)\n  );\n};\n\nconst MultiFilterContent = ({\n  field,\n  colorComponent,\n  tree,\n}: {\n  field: string;\n  colorComponent?: Component;\n  tree: HierarchyValue[];\n}) => {\n  const locale = useLocale();\n  const [config, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(config);\n  const isSegmentField = chartConfig.activeField === \"segment\";\n  const { cubeIri, dimensionId, activeKeys, allValues, colorConfigPath } =\n    useMultiFilterContext();\n  const filters = useChartConfigFilters(chartConfig);\n  const rawValues = filters[dimensionId];\n  const classes = useStyles();\n  const { sortedTree, flatOptions, optionsByValue } = useMemo(() => {\n    const sortedTree = sortHierarchy(tree);\n    const flatOptions = getOptionsFromTree(sortedTree);\n    const optionsByValue = keyBy(flatOptions, (option) => option.value);\n\n    return {\n      sortedTree,\n      flatOptions,\n      optionsByValue,\n    };\n  }, [tree]);\n\n  const { values, valueGroups } = useMemo(() => {\n    const values = (\n      (rawValues?.type === \"multi\" && Object.keys(rawValues.values)) ||\n      Object.keys(optionsByValue)\n    )\n      .map((v) => optionsByValue[v])\n      .filter(isHierarchyOptionSelectable);\n    const grouped = groups(values, groupByParent)\n      .sort((a, b) =>\n        a[0].length === 0\n          ? 1\n          : ascending(\n              explodeParents(a[0]).length,\n              explodeParents(b[0]).length\n            ) || ascending(a[0], b[0])\n      )\n      .map(([parent, group]) => {\n        return [parent, sortFilterValues(group)] as const;\n      });\n\n    return {\n      values,\n      valueGroups: grouped,\n      valuesByParent: groupBy(values, groupByParent),\n    };\n  }, [optionsByValue, rawValues]);\n\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>();\n  const handleOpenAutocomplete: MouseEventHandler<HTMLButtonElement> = useEvent(\n    (ev) => {\n      setAnchorEl(ev.currentTarget);\n    }\n  );\n\n  // The popover content is responsible for keeping this ref up-to-date.\n  // This is so that the click-away close event can still access the pending values\n  // without the state changing (triggering a repositioning of the popover).\n  const pendingValuesRef = useRef<HierarchyValue[]>([]);\n  const handleCloseAutocomplete = useEvent(() => {\n    setAnchorEl(undefined);\n    const newValues = pendingValuesRef.current\n      .map((x) => x?.value)\n      .filter(Boolean);\n    dispatch({\n      type: \"CHART_CONFIG_FILTER_SET_MULTI\",\n      value: {\n        cubeIri,\n        dimensionId,\n        values: newValues,\n      },\n    });\n    anchorEl?.focus();\n  });\n\n  const handleResetColorMapping = useEvent(() => {\n    const values = colorComponent?.values ?? [];\n    dispatch({\n      type: \"CHART_CONFIG_UPDATE_COLOR_MAPPING\",\n      value: {\n        field,\n        colorConfigPath,\n        dimensionId,\n        values,\n        random: false,\n      },\n    });\n  });\n\n  const colorConfig = useMemo(() => {\n    return getColorConfig(chartConfig);\n  }, [chartConfig]);\n\n  const hasColorMapping = useMemo(() => {\n    return getHasColorMapping({\n      colorConfig,\n      colorComponent,\n      filterDimensionId: dimensionId,\n    });\n  }, [colorConfig, dimensionId, colorComponent]);\n  useEnsureUpToDateColorMapping({\n    colorComponentValues: colorComponent?.values,\n    colorMapping:\n      colorConfig?.type !== \"single\" ? colorConfig?.colorMapping : undefined,\n  });\n\n  const segment = isSegmentInConfig(chartConfig)\n    ? chartConfig.fields.segment\n    : undefined;\n  const enableSettingShowValuesBySegment =\n    segment &&\n    isSegmentField &&\n    shouldEnableSettingShowValuesBySegment(chartConfig);\n  const showValuesMappingBooleans: boolean[] = Object.values(\n    segment?.showValuesMapping ?? {}\n  );\n\n  const interactiveDataFilterProps = useInteractiveDataFilterToggle(\n    dimensionId,\n    \"multi\"\n  );\n  const interactiveLegendFilterProps = useInteractiveFiltersToggle();\n  const interactiveFilterProps = isSegmentField\n    ? interactiveLegendFilterProps\n    : interactiveDataFilterProps;\n  const visibleLegendProps = useLegendTitleVisibility();\n  const chartSymbol = getChartSymbol(chartConfig.chartType);\n\n  const defaultValueOverrideProps = useDefaultValueOverride(dimensionId);\n  const defaultValueOptions = useMemo(() => {\n    return [\n      {\n        value: FIELD_VALUE_NONE,\n        label: t({\n          id: \"controls.none\",\n          message: \"None\",\n        }),\n        isNoneValue: true,\n      },\n      ...values.map(({ value, label }) => ({ value, label })),\n    ];\n  }, [values]);\n\n  return (\n    <Box sx={{ position: \"relative\" }}>\n      <Box mb={4}>\n        <Flex sx={{ flexDirection: \"column\", gap: 3, mb: 3 }}>\n          <InteractiveToggle {...interactiveFilterProps} />\n          {isSegmentField ? (\n            <Switch\n              label={t({\n                id: \"controls.filters.show-legend.toggle\",\n                message: \"Show legend titles\",\n              })}\n              {...visibleLegendProps}\n            />\n          ) : interactiveFilterProps.checked ? (\n            <MultiSelect\n              id={`default-value-${dimensionId}`}\n              size=\"sm\"\n              label={t({\n                id: \"controls.filters.default-value.label\",\n                message: \"Default value\",\n              })}\n              placeholder={t({\n                id: \"controls.dimensionvalue.select\",\n                message: \"Select filter\",\n              })}\n              options={defaultValueOptions}\n              {...defaultValueOverrideProps}\n            />\n          ) : null}\n        </Flex>\n        <Button\n          variant=\"outlined\"\n          size=\"sm\"\n          onClick={handleOpenAutocomplete}\n          sx={{ width: \"fit-content\" }}\n        >\n          <Trans id=\"controls.set-filters\">Edit filters</Trans>\n        </Button>\n        <Flex sx={{ justifyContent: \"space-between\", mt: 4 }}>\n          <Typography variant=\"h6\" component=\"p\" sx={{ fontWeight: 700 }}>\n            <Trans id=\"controls.filters.select.selected-filters\">\n              Selected filters\n            </Trans>\n            {hasColorMapping && colorConfig?.paletteId === \"dimension\" && (\n              <Tooltip\n                title={\n                  <Trans id=\"controls.filters.select.reset-colors\">\n                    Reset colors\n                  </Trans>\n                }\n              >\n                <IconButton\n                  size=\"small\"\n                  onClick={handleResetColorMapping}\n                  sx={{ ml: 1, my: -2 }}\n                >\n                  <SvgIcRefresh fontSize=\"inherit\" />\n                </IconButton>\n              </Tooltip>\n            )}\n          </Typography>\n          <Typography variant=\"caption\" color=\"text.secondary\">\n            <Trans id=\"controls.filter.nb-elements\">\n              {activeKeys.size} of {allValues.length}\n            </Trans>\n          </Typography>\n        </Flex>\n        <Divider sx={{ mt: 4 }} />\n      </Box>\n      {enableSettingShowValuesBySegment ? (\n        <Flex gap={2} alignItems=\"center\" sx={{ color: \"primary.main\" }}>\n          <Button\n            variant=\"text\"\n            color=\"primary\"\n            size=\"xs\"\n            disabled={\n              sum(showValuesMappingBooleans, (d) => +d) === values.length\n            }\n            onClick={() => {\n              dispatch({\n                type: \"CHART_FIELD_UPDATED\",\n                value: {\n                  locale,\n                  path: \"fields.segment.showValuesMapping\",\n                  field: null,\n                  value: Object.fromEntries(values.map((v) => [v.value, true])),\n                },\n              });\n            }}\n          >\n            <Trans id=\"controls.filter.show-values.all\">Show all values</Trans>\n          </Button>\n          \n          <Button\n            variant=\"text\"\n            color=\"primary\"\n            size=\"xs\"\n            disabled={showValuesMappingBooleans.every((d) => !d)}\n            onClick={() => {\n              dispatch({\n                type: \"CHART_FIELD_UPDATED\",\n                value: {\n                  locale,\n                  path: \"fields.segment.showValuesMapping\",\n                  field: null,\n                  value: {},\n                },\n              });\n            }}\n          >\n            <Trans id=\"controls.filter.show-values.none\">Show no values</Trans>\n          </Button>\n        </Flex>\n      ) : null}\n      {valueGroups.map(([parentLabel, children]) => {\n        return (\n          <Box sx={{ mb: 4 }} key={parentLabel}>\n            <Typography variant=\"h6\" sx={{ mb: 4, fontWeight: 700 }}>\n              {interlace(explodeParents(parentLabel), (i) => (\n                <BreadcrumbChevron key={i} />\n              ))}\n            </Typography>\n            {children.map(({ value, label }) => {\n              return (\n                <Flex\n                  key={value}\n                  className={classes.selectedValueRow}\n                  data-testid=\"chart-filters-value\"\n                >\n                  {hasColorMapping ? (\n                    <MultiFilterField\n                      value={value}\n                      label={label}\n                      symbol={chartSymbol}\n                      enableShowValue={enableSettingShowValuesBySegment}\n                    />\n                  ) : (\n                    <>\n                      <Typography variant=\"body3\" style={{ flexGrow: 1 }}>\n                        {label}\n                      </Typography>\n                      {enableSettingShowValuesBySegment ? (\n                        <ShowValuesMappingField value={value} />\n                      ) : null}\n                      <SvgIcCheckmark />\n                    </>\n                  )}\n                </Flex>\n              );\n            })}\n          </Box>\n        );\n      })}\n      <ConfiguratorDrawer open={!!anchorEl} hideBackdrop>\n        <ClickAwayListener onClickAway={handleCloseAutocomplete}>\n          <DrawerContent\n            pendingValuesRef={pendingValuesRef}\n            options={sortedTree}\n            flatOptions={flatOptions}\n            onClose={handleCloseAutocomplete}\n            values={values}\n            hasColorMapping={hasColorMapping}\n          />\n        </ClickAwayListener>\n      </ConfiguratorDrawer>\n    </Box>\n  );\n};\n\nconst InteractiveToggle = ({\n  name,\n  checked,\n  onChange,\n}: {\n  name: string;\n  checked: boolean;\n  onChange: (e: ChangeEvent<HTMLInputElement>) => void;\n}) => {\n  return (\n    <Switch\n      name={name}\n      label={\n        <MaybeTooltip\n          tooltipProps={{ enterDelay: 600 }}\n          title={\n            <Trans id=\"controls.filters.interactive.tooltip\">\n              Allow users to change filters\n            </Trans>\n          }\n        >\n          <div>\n            <Trans id=\"controls.filters.interactive.toggle\">Interactive</Trans>\n          </div>\n        </MaybeTooltip>\n      }\n      checked={checked}\n      onChange={onChange}\n    />\n  );\n};\n\n/**\n * Fixes situations where an old chart is being edited and the cube has changed\n * and contains new values in the color dimension.\n * */\nconst useEnsureUpToDateColorMapping = ({\n  colorComponentValues,\n  colorMapping,\n}: {\n  colorComponentValues?: DimensionValue[];\n  colorMapping?: ColorMapping;\n}) => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const { dimensionId, colorConfigPath } = useMultiFilterContext();\n  const { activeField } = chartConfig;\n\n  const hasOutdatedMapping = useMemo(() => {\n    return colorMapping && colorComponentValues\n      ? colorComponentValues.some((value) => !colorMapping[value.value])\n      : false;\n  }, [colorComponentValues, colorMapping]);\n\n  const field = isColorInConfig(chartConfig) ? \"color\" : activeField;\n\n  useEffect(() => {\n    if (hasOutdatedMapping && colorMapping && colorComponentValues && field) {\n      dispatch({\n        type: \"CHART_CONFIG_UPDATE_COLOR_MAPPING\",\n        value: {\n          dimensionId,\n          colorConfigPath,\n          colorMapping,\n          field,\n          values: colorComponentValues,\n          random: false,\n        },\n      });\n    }\n  }, [\n    field,\n    chartConfig,\n    hasOutdatedMapping,\n    dispatch,\n    dimensionId,\n    colorConfigPath,\n    colorMapping,\n    colorComponentValues,\n  ]);\n};\n\nconst useBreadcrumbStyles = makeStyles({\n  root: {\n    display: \"inline\",\n    top: 5,\n    position: \"relative\",\n  },\n});\n\nconst BreadcrumbChevron = () => {\n  const classes = useBreadcrumbStyles();\n\n  return <Icon className={classes.root} name=\"chevronRight\" size={20} />;\n};\n\nconst StyledAccordion = styled(Accordion)({\n  boxShadow: \"none\",\n  minHeight: 0,\n\n  \"&:before\": {\n    display: \"none\",\n  },\n\n  \"&.Mui-expanded\": {\n    minHeight: 0,\n  },\n});\n\nconst TreeAccordionSummary = styled(AccordionSummary)(({ theme }) => ({\n  minHeight: 0,\n  transition: \"background-color 0.1s ease\",\n  paddingLeft: theme.spacing(1),\n  paddingRight: theme.spacing(4),\n\n  \"&.Mui-expanded\": {\n    minHeight: 0,\n  },\n\n  \"& > .MuiAccordionSummary-content\": {\n    display: \"flex\",\n    alignItems: \"center\",\n    marginTop: 0,\n    marginBottom: 0,\n    padding: `${theme.spacing(2)} 0`,\n    color: theme.palette.monochrome[600],\n  },\n\n  \"&:hover\": {\n    backgroundColor: theme.palette.cobalt[50],\n\n    \"& > .MuiAccordionSummary-content\": {\n      color: theme.palette.monochrome[800],\n    },\n  },\n}));\n\nconst TreeAccordionDetails = styled(AccordionDetails)(() => ({\n  padding: 0,\n}));\n\nconst TreeAccordion = ({\n  flat,\n  depth,\n  value,\n  label,\n  state,\n  selectable,\n  expandable,\n  renderExpandButton,\n  renderColorCheckbox,\n  onSelect,\n  children,\n}: {\n  flat?: boolean;\n  depth: number;\n  value: string;\n  label: string;\n  state: \"SELECTED\" | \"CHILDREN_SELECTED\" | \"NOT_SELECTED\";\n  selectable: boolean;\n  expandable: boolean;\n  renderExpandButton: boolean;\n  renderColorCheckbox: boolean;\n  onSelect: () => void;\n  children?: ReactNode;\n}) => {\n  const classes = useStyles();\n  const { getValueColor } = useMultiFilterContext();\n  const [expanded, setExpanded] = useState(() => depth === 0);\n\n  return (\n    <StyledAccordion\n      expanded={expanded}\n      disableGutters\n      slotProps={{ transition: { unmountOnExit: true } }}\n    >\n      <TreeAccordionSummary\n        expandIcon={null}\n        onClick={(e) => {\n          e.stopPropagation();\n\n          if (selectable) {\n            onSelect();\n          }\n        }}\n        sx={{ pl: flat ? 4 : `${(depth + 1) * 8}px` }}\n      >\n        {renderExpandButton && (\n          <IconButton\n            onClick={(e) => {\n              e.stopPropagation();\n              setExpanded(!expanded);\n            }}\n            sx={{\n              alignSelf: \"flex-start\",\n              visibility: expandable ? \"visible\" : \"hidden\",\n              ml: 2,\n              mr: 1,\n              p: 1,\n\n              \"&:hover\": {\n                backgroundColor: \"cobalt.100\", // default hover color is the same\n                // as the parent hover color\n              },\n            }}\n          >\n            <Icon\n              name=\"chevronRight\"\n              size={16}\n              style={{\n                transition: \"transform 0.2s ease\",\n                transform: expanded ? \"rotate(90deg)\" : \"rotate(0deg)\",\n              }}\n            />\n          </IconButton>\n        )}\n        {renderColorCheckbox && (\n          <div\n            className={classes.optionColor}\n            style={{\n              visibility: selectable ? \"visible\" : \"hidden\",\n              backgroundColor:\n                state === \"SELECTED\" ? getValueColor(value) : \"transparent\",\n            }}\n          />\n        )}\n        <Typography variant=\"body3\" className={classes.optionLabel}>\n          {label}\n        </Typography>\n        <Icon\n          name={\n            state === \"SELECTED\"\n              ? \"checkmark\"\n              : state === \"CHILDREN_SELECTED\"\n                ? \"indeterminate\"\n                : \"show\"\n          }\n          className={classes.optionCheck}\n          style={{\n            visibility: state === \"NOT_SELECTED\" ? \"hidden\" : \"visible\",\n          }}\n        />\n      </TreeAccordionSummary>\n      {children && <TreeAccordionDetails>{children}</TreeAccordionDetails>}\n    </StyledAccordion>\n  );\n};\n\nconst validateChildren = (\n  d: HierarchyValue[] | undefined\n): d is HierarchyValue[] => {\n  return Array.isArray(d) && d.length > 0;\n};\n\nconst areChildrenSelected = ({\n  children,\n  selectedValues,\n}: {\n  children: HierarchyValue[] | undefined;\n  selectedValues: HierarchyValue[];\n}): boolean => {\n  if (validateChildren(children)) {\n    const values = children.map((d) => d.value);\n    if (selectedValues.some((d) => values.includes(d.value))) {\n      return true;\n    } else {\n      return children\n        .map((d) =>\n          areChildrenSelected({ children: d.children, selectedValues })\n        )\n        .some((d) => d === true);\n    }\n  } else {\n    return false;\n  }\n};\n\nconst isHierarchyOptionSelectable = (d: HierarchyValue) => {\n  return d.hasValue !== undefined ? Boolean(d.hasValue) : true;\n};\n\nconst Tree = ({\n  flat,\n  depthsMetadata,\n  options,\n  selectedValues,\n  showColors,\n  onSelect,\n}: {\n  flat: boolean;\n  depthsMetadata: Record<number, { selectable: boolean; expandable: boolean }>;\n  options: HierarchyValue[];\n  selectedValues: HierarchyValue[];\n  showColors: boolean;\n  onSelect: (newSelectedValues: HierarchyValue[]) => void;\n}) => {\n  return (\n    <>\n      {options.map((d) => {\n        const { depth, value, label, children } = d;\n        const currentDepthsMetadata = depthsMetadata[depth];\n        const hasChildren = validateChildren(children);\n        const state = selectedValues.map((d) => d.value).includes(value)\n          ? \"SELECTED\"\n          : areChildrenSelected({ children, selectedValues })\n            ? \"CHILDREN_SELECTED\"\n            : \"NOT_SELECTED\";\n\n        return (\n          <TreeAccordion\n            key={value}\n            flat={flat}\n            depth={depth}\n            value={value}\n            label={label}\n            state={state}\n            // Has value is only present for hierarchies.\n            selectable={isHierarchyOptionSelectable(d)}\n            expandable={hasChildren}\n            renderExpandButton={currentDepthsMetadata.expandable || depth > 0}\n            renderColorCheckbox={\n              showColors && (currentDepthsMetadata.selectable || d.depth === -1)\n            }\n            onSelect={() => {\n              if (state === \"SELECTED\") {\n                onSelect(selectedValues.filter((d) => d.value !== value));\n              } else {\n                onSelect([...selectedValues, d]);\n              }\n            }}\n          >\n            {hasChildren ? (\n              <Tree\n                flat={flat}\n                depthsMetadata={depthsMetadata}\n                options={children as HierarchyValue[]}\n                selectedValues={selectedValues}\n                showColors={showColors}\n                onSelect={onSelect}\n              />\n            ) : null}\n          </TreeAccordion>\n        );\n      })}\n    </>\n  );\n};\n\nconst DrawerContent = forwardRef<\n  HTMLDivElement,\n  {\n    onClose: () => void;\n    options: HierarchyValue[];\n    flatOptions: HierarchyValue[];\n    values: HierarchyValue[];\n    pendingValuesRef: MutableRefObject<HierarchyValue[]>;\n    hasColorMapping: boolean;\n  }\n>(\n  (\n    {\n      onClose,\n      options,\n      flatOptions,\n      values,\n      pendingValuesRef,\n      hasColorMapping,\n    },\n    ref\n  ) => {\n    const classes = useStyles();\n    const [textInput, setTextInput] = useState(\"\");\n    const [pendingValues, setPendingValues] = useState<HierarchyValue[]>(() =>\n      // Do not set unselectable options\n      values.filter(isHierarchyOptionSelectable)\n    );\n    pendingValuesRef.current = pendingValues;\n\n    const { depthsMetadata, uniqueSelectableFlatOptions } = useMemo(() => {\n      const uniqueSelectableFlatOptions = uniqBy(\n        flatOptions.filter(isHierarchyOptionSelectable),\n        (d) => d.value\n      );\n\n      const depthsMetadata = flatOptions.reduce(\n        (acc, d) => {\n          if (!acc[d.depth]) {\n            acc[d.depth] = { selectable: false, expandable: false };\n          }\n\n          if (acc[d.depth].selectable === false && d.hasValue) {\n            acc[d.depth].selectable = true;\n          }\n\n          if (\n            acc[d.depth].expandable === false &&\n            d.children &&\n            d.children.length > 0\n          ) {\n            acc[d.depth].expandable = true;\n          }\n\n          return acc;\n        },\n        {} as Record<number, { selectable: boolean; expandable: boolean }>\n      );\n\n      const maxDepth = max(flatOptions, (d) => d.depth);\n\n      // Expand last level by default, so it's aligned correctly.\n      if (maxDepth && maxDepth > 0) {\n        depthsMetadata[maxDepth].expandable = true;\n      }\n\n      return { depthsMetadata, uniqueSelectableFlatOptions };\n    }, [flatOptions]);\n\n    const filteredOptions = useMemo(() => {\n      return pruneTree(options, (d) =>\n        d.label.toLowerCase().includes(textInput.toLowerCase())\n      );\n    }, [textInput, options]);\n\n    return (\n      <div\n        ref={ref}\n        className={classes.wrapper}\n        data-testid=\"edition-filters-drawer\"\n      >\n        <Box className={classes.header}>\n          <Flex alignItems=\"center\" justifyContent=\"space-between\">\n            <Flex alignItems=\"center\" gap={1} mb={3}>\n              <Icon name=\"filter\" />\n              <Typography variant=\"h6\" component=\"p\" sx={{ fontWeight: 700 }}>\n                <Trans id=\"controls.set-filters\">Edit filters</Trans>\n              </Typography>\n            </Flex>\n            <IconButton sx={{ mt: \"-0.5rem\" }} size=\"small\" onClick={onClose}>\n              <SvgIcClose fontSize=\"inherit\" />\n            </IconButton>\n          </Flex>\n          <Typography variant=\"body3\" color=\"text.secondary\">\n            <Trans id=\"controls.set-filters-caption\">\n              For best results, do not select more than 7 values in the\n              visualization.\n            </Trans>\n          </Typography>\n          <Input\n            className={classes.textInput}\n            size=\"sm\"\n            value={textInput}\n            onChange={(e) => setTextInput(e.target.value)}\n            placeholder={t({ id: \"select.controls.filters.search\" })}\n            startAdornment={\n              <InputAdornment position=\"start\">\n                <Icon name=\"search\" size={16} />\n              </InputAdornment>\n            }\n          />\n          <FilterControls\n            selectAll={() => setPendingValues(uniqueSelectableFlatOptions)}\n            selectNone={() => setPendingValues([])}\n            allKeysLength={uniqueSelectableFlatOptions.length}\n            activeKeysLength={pendingValues.length}\n          />\n        </Box>\n        <Tree\n          flat={Object.keys(depthsMetadata).length === 1}\n          depthsMetadata={depthsMetadata}\n          options={filteredOptions}\n          selectedValues={pendingValues}\n          showColors={hasColorMapping}\n          onSelect={(newValues: HierarchyValue[]) => {\n            setPendingValues(newValues);\n          }}\n        />\n        <div className={classes.autocompleteApplyButtonContainer}>\n          <Button\n            size=\"sm\"\n            className={classes.autocompleteApplyButton}\n            fullWidth\n            onClick={onClose}\n          >\n            <Trans id=\"controls.set-values-apply\">Apply filters</Trans>\n          </Button>\n        </div>\n      </div>\n    );\n  }\n);\n\nconst getPathToColorConfigProperty = ({\n  field,\n  colorConfigPath,\n  propertyPath,\n}: {\n  field: string;\n  colorConfigPath?: string;\n  propertyPath: string;\n}) => {\n  return `fields[\"${field}\"].${\n    colorConfigPath !== undefined ? `${colorConfigPath}.` : \"\"\n  }${propertyPath}`;\n};\n\nexport const DimensionValuesMultiFilter = ({\n  dimension,\n  colorConfigPath,\n  colorComponent,\n  field,\n}: {\n  dimension: Dimension;\n  colorConfigPath?: string;\n  colorComponent?: Component;\n  field: string;\n}) => {\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const getValueColor = useEvent((value: string) => {\n    const colorPath = getPathToColorConfigProperty({\n      field: isColorInConfig(chartConfig) ? \"color\" : field,\n      colorConfigPath:\n        isColorInConfig(chartConfig) &&\n        chartConfig.fields.color.type === \"single\"\n          ? undefined\n          : \"colorMapping\",\n      propertyPath: `[\"${value}\"]`,\n    });\n\n    return get(chartConfig, colorPath);\n  });\n\n  return (\n    <MultiFilterContextProvider\n      dimension={dimension}\n      colorConfigPath={colorConfigPath}\n      getValueColor={getValueColor}\n    >\n      <MultiFilterContent\n        field={field}\n        colorComponent={colorComponent}\n        // @ts-ignore\n        tree={\n          dimension.hierarchy && dimension.hierarchy.length > 0\n            ? dimension.hierarchy\n            : dimension.values\n        }\n      />\n    </MultiFilterContextProvider>\n  );\n};\n\ntype TimeFilterProps = {\n  dimension: TemporalDimension | TemporalEntityDimension;\n  disableInteractiveFilters?: boolean;\n};\n\nexport const TimeFilter = (props: TimeFilterProps) => {\n  const { dimension, disableInteractiveFilters = false } = props;\n  const formatLocale = useTimeFormatLocale();\n  const timeFormatUnit = useTimeFormatUnit();\n  const [state, dispatch] = useConfiguratorState();\n  const setFilterRange = useCallback(\n    ([from, to]: [string, string]) => {\n      dispatch({\n        type: \"CHART_CONFIG_FILTER_SET_RANGE\",\n        value: {\n          dimension,\n          from,\n          to,\n        },\n      });\n    },\n    [dispatch, dimension]\n  );\n\n  const activeFilter = getFilterValue(state, dimension);\n  const rangeActiveFilter =\n    activeFilter?.type === \"range\" ? activeFilter : null;\n  const usesMostRecentValue = rangeActiveFilter\n    ? isMostRecentValue(rangeActiveFilter.to)\n    : false;\n\n  const onChangeFrom = useEvent(\n    (e: SelectChangeEvent<unknown> | ChangeEvent<HTMLSelectElement>) => {\n      if (rangeActiveFilter) {\n        const from = e.target.value as string;\n        setFilterRange([from, rangeActiveFilter.to]);\n      }\n    }\n  );\n\n  const onChangeTo = useEvent(\n    (e: SelectChangeEvent<unknown> | ChangeEvent<HTMLSelectElement>) => {\n      if (rangeActiveFilter) {\n        const to = e.target.value as string;\n        setFilterRange([rangeActiveFilter.from, to]);\n      }\n    }\n  );\n\n  const { sortedOptions, sortedValues } = useMemo(() => {\n    return getTimeFilterOptions({\n      dimension,\n      formatLocale,\n      timeFormatUnit,\n    });\n  }, [dimension, formatLocale, timeFormatUnit]);\n\n  const getClosestDatesFromDateRange = useCallback(\n    (from: Date, to: Date) => {\n      const getClosestDatesFromDateRange = makeGetClosestDatesFromDateRange(\n        sortedOptions,\n        (d) => d.date\n      );\n\n      return getClosestDatesFromDateRange(from, to);\n    },\n    [sortedOptions]\n  );\n\n  if (isConfiguring(state)) {\n    const { timeUnit, timeFormat } = dimension;\n    const timeInterval = getTimeInterval(timeUnit);\n\n    const parse = formatLocale.parse(timeFormat);\n    const formatDateValue = formatLocale.format(timeFormat);\n\n    const from = sortedOptions[0].date;\n    const to = sortedOptions[sortedOptions.length - 1].date;\n\n    if (!from || !to) {\n      return null;\n    }\n\n    const timeRange = rangeActiveFilter\n      ? [\n          parse(rangeActiveFilter.from) as Date,\n          usesMostRecentValue ? to : (parse(rangeActiveFilter.to) as Date),\n        ]\n      : [from, to];\n\n    const fromOptions = sortedOptions.filter(({ date }) => {\n      return date <= timeRange[1];\n    });\n    const toOptions = sortedOptions.filter(({ date }) => {\n      return date >= timeRange[0];\n    });\n\n    const fromLabel = t({\n      id: \"controls.filters.select.from\",\n      message: \"From\",\n    });\n    const toLabel = t({\n      id: \"controls.filters.select.to\",\n      message: \"To\",\n    });\n\n    return (\n      <div>\n        {!disableInteractiveFilters && (\n          <Box sx={{ mb: 3 }}>\n            <InteractiveTimeRangeToggle />\n          </Box>\n        )}\n        <Flex sx={{ gap: 1 }}>\n          {rangeActiveFilter ? (\n            canRenderDatePickerField(timeUnit) ? (\n              <LeftRightFormContainer\n                left={\n                  <DatePickerField\n                    name=\"time-range-start\"\n                    label={fromLabel}\n                    value={timeRange[0]}\n                    onChange={onChangeFrom}\n                    isDateDisabled={(date) => {\n                      return (\n                        date > timeRange[1] ||\n                        !sortedValues.includes(formatDateValue(date))\n                      );\n                    }}\n                    timeUnit={timeUnit}\n                    dateFormat={formatDateValue}\n                    minDate={from}\n                    maxDate={to}\n                    parseDate={parse}\n                  />\n                }\n                right={\n                  <DatePickerField\n                    name=\"time-range-end\"\n                    label={toLabel}\n                    value={timeRange[1]}\n                    disabled={usesMostRecentValue}\n                    onChange={onChangeTo}\n                    isDateDisabled={(date) => {\n                      return (\n                        date < timeRange[0] ||\n                        !sortedValues.includes(formatDateValue(date))\n                      );\n                    }}\n                    timeUnit={timeUnit}\n                    dateFormat={formatDateValue}\n                    minDate={from}\n                    maxDate={to}\n                    parseDate={parse}\n                  />\n                }\n              />\n            ) : (\n              <LeftRightFormContainer\n                left={\n                  <Select\n                    id=\"time-range-start\"\n                    size=\"sm\"\n                    label={fromLabel}\n                    options={fromOptions}\n                    sort={false}\n                    value={rangeActiveFilter.from}\n                    onChange={onChangeFrom}\n                  />\n                }\n                right={\n                  <Select\n                    id=\"time-range-end\"\n                    size=\"sm\"\n                    label={toLabel}\n                    options={toOptions}\n                    sort={false}\n                    value={rangeActiveFilter.to}\n                    onChange={onChangeTo}\n                  />\n                }\n              />\n            )\n          ) : null}\n        </Flex>\n        <EditorBrush\n          timeExtent={[from, to]}\n          timeRange={timeRange}\n          timeInterval={timeInterval}\n          timeUnit={timeUnit}\n          hideEndHandle={usesMostRecentValue}\n          onChange={([from, to]) => {\n            const [closestFrom, closestTo] = getClosestDatesFromDateRange(\n              from,\n              to\n            );\n            setFilterRange([\n              formatDateValue(closestFrom),\n              usesMostRecentValue\n                ? VISUALIZE_MOST_RECENT_VALUE\n                : formatDateValue(closestTo),\n            ]);\n          }}\n        />\n        {rangeActiveFilter && (\n          <Flex sx={{ alignItems: \"center\", gap: 1, mt: 3 }}>\n            <Switch\n              label={t({\n                id: \"controls.filter.use-most-recent\",\n                message: \"Use most recent\",\n              })}\n              size=\"sm\"\n              checked={usesMostRecentValue}\n              onChange={() => {\n                setFilterRange([\n                  rangeActiveFilter.from,\n                  usesMostRecentValue\n                    ? formatDateValue(to)\n                    : VISUALIZE_MOST_RECENT_VALUE,\n                ]);\n              }}\n            />\n            <Tooltip\n              arrow\n              PopperProps={{ sx: { maxWidth: 160 } }}\n              title={\n                <Trans id=\"controls.filter.use-most-recent-explanation\">\n                  When the publisher updates this dataset, the most recent date\n                  will be selected by default.\n                </Trans>\n              }\n            >\n              <Box sx={{ color: \"primary.main\", lineHeight: 0 }}>\n                <Icon name=\"infoCircle\" size={16} />\n              </Box>\n            </Tooltip>\n          </Flex>\n        )}\n      </div>\n    );\n  } else {\n    return <Loading />;\n  }\n};\n\nconst LeftRightFormContainer = ({\n  left,\n  right,\n}: {\n  left: ReactNode;\n  right: ReactNode;\n}) => {\n  const columnGap = 12;\n  const middleElementSize = 8;\n  const sideElementSize = DRAWER_WIDTH / 2 - columnGap * 2 - middleElementSize;\n\n  return (\n    <div\n      style={{\n        display: \"grid\",\n        gridTemplateColumns: `${sideElementSize}px ${middleElementSize}px ${sideElementSize}px`,\n        columnGap,\n        alignItems: \"center\",\n      }}\n    >\n      {left}\n      <Typography mt=\"1em\"></Typography>\n      {right}\n    </div>\n  );\n};\n\nconst InteractiveTimeRangeToggle = () => {\n  const { checked, toggle } = useInteractiveTimeRangeToggle();\n\n  return (\n    <Switch\n      label={t({\n        id: \"controls.filters.interactive.toggle\",\n        message: \"Interactive\",\n      })}\n      size=\"sm\"\n      checked={checked}\n      onChange={toggle}\n    />\n  );\n};\n\nexport const DimensionValuesSingleFilter = ({\n  dimension,\n}: {\n  dimension: Component;\n}) => {\n  const locale = useLocale();\n  const sortedDimensionValues = useMemo(() => {\n    const values = dimension.values;\n    return [...values].sort(valueComparator(locale));\n  }, [dimension?.values, locale]);\n\n  return dimension ? (\n    <>\n      {sortedDimensionValues.map((d) => {\n        return (\n          <SingleFilterField\n            key={d.value}\n            filters={dimensionToFieldProps(dimension)}\n            label={d.label}\n            value={`${d.value}`}\n          />\n        );\n      })}\n    </>\n  ) : (\n    <Loading />\n  );\n};\n","import { ButtonBase, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport { SyntheticEvent } from \"react\";\n\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { getIconName } from \"@/configurator/components/ui-helpers\";\nimport { FieldProps } from \"@/configurator/config-form\";\nimport { Icon } from \"@/icons\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: 91,\n    height: 64,\n    borderRadius: 2,\n    transition: theme.transitions.create([\"background-color\", \"color\"], {\n      duration: theme.transitions.duration.shorter,\n    }),\n    cursor: \"pointer\",\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.monochrome[100],\n    },\n\n    \"& svg\": {\n      color: theme.palette.monochrome[800],\n    },\n  },\n  checked: {\n    backgroundColor: theme.palette.monochrome[800],\n    color: \"white\",\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.monochrome[800],\n    },\n\n    \"& svg\": {\n      color: \"white\",\n    },\n  },\n  disabled: {\n    cursor: \"initial\",\n    color: theme.palette.monochrome[500],\n\n    \"& svg\": {\n      color: theme.palette.monochrome[500],\n    },\n  },\n}));\n\nexport const IconButton = ({\n  label,\n  value,\n  checked,\n  disabled,\n  onClick,\n  iconSize = 24,\n}: {\n  label: string;\n  disabled?: boolean;\n  onClick: (e: SyntheticEvent<HTMLButtonElement>) => void;\n  iconSize?: number;\n} & FieldProps) => {\n  const classes = useStyles();\n\n  return (\n    <ButtonBase\n      tabIndex={0}\n      value={value}\n      onClick={onClick}\n      disabled={disabled}\n      className={clsx(\n        classes.root,\n        disabled ? classes.disabled : null,\n        checked ? classes.checked : null\n      )}\n    >\n      <Icon name={getIconName(label)} size={iconSize} />\n      <Typography variant=\"caption\" sx={{ mt: 2 }}>\n        {getFieldLabel(label)}\n      </Typography>\n    </ButtonBase>\n  );\n};\n","import { Box, BoxProps, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\n\nimport { HEADER_HEIGHT_CSS_VAR } from \"@/components/header-constants\";\nimport { DRAWER_WIDTH } from \"@/configurator/components/drawers\";\nimport { useResizeObserver } from \"@/utils/use-resize-observer\";\n\nexport const LAYOUT_HEADER_HEIGHT = 88;\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  panelLayout: {\n    position: \"fixed\",\n    top: HEADER_HEIGHT_CSS_VAR,\n    width: \"100%\",\n    height: `calc(100vh - ${HEADER_HEIGHT_CSS_VAR})`,\n    display: \"grid\",\n    gridTemplateRows: \"auto minmax(0, 1fr)\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n  },\n  MPanelLayout: {\n    gridTemplateColumns: `minmax(22rem, 1fr)`,\n    gridTemplateAreas: `\n    \"header\"\n    \"middle\"`,\n    backgroundColor: theme.palette.monochrome[100],\n  },\n  LMPanelLayout: {\n    gridTemplateColumns: `${DRAWER_WIDTH}px minmax(22rem, 1fr)`,\n    gridTemplateAreas: `\n    \"header header\"\n    \"left middle\"`,\n    backgroundColor: theme.palette.monochrome[100],\n\n    [theme.breakpoints.down(\"md\")]: {\n      gridTemplateColumns: `minmax(22rem, 1fr)`,\n      gridTemplateAreas: `\n      \"header\"\n      \"left\"\n      \"middle\"`,\n    },\n  },\n  MRPanelLayout: {\n    gridTemplateColumns: `minmax(22rem, 1fr) ${DRAWER_WIDTH}px`,\n    gridTemplateAreas: `\n    \"header header\"\n    \"middle right\"`,\n    backgroundColor: theme.palette.monochrome[100],\n\n    [theme.breakpoints.down(\"md\")]: {\n      gridTemplateColumns: `minmax(22rem, 1fr)`,\n      gridTemplateAreas: `\n      \"header\"\n      \"middle\"\n      \"right\"`,\n    },\n  },\n  LMRPanelLayout: {\n    gridTemplateColumns: `${DRAWER_WIDTH}px minmax(22rem, 1fr) ${DRAWER_WIDTH}px`,\n    gridTemplateAreas: `\n    \"header header header\"\n    \"left middle right\"`,\n    backgroundColor: theme.palette.monochrome[100],\n\n    [theme.breakpoints.down(\"md\")]: {\n      gridTemplateColumns: `minmax(22rem, 1fr)`,\n      gridTemplateAreas: `\n      \"header\"\n      \"left\"\n      \"middle\"\n      \"right\"`,\n    },\n  },\n  panelHeaderLayout: {\n    gridArea: \"header\",\n    height: LAYOUT_HEADER_HEIGHT,\n    borderBottom: `1px solid ${theme.palette.cobalt[100]}`,\n    backgroundColor: theme.palette.background.paper,\n  },\n  LMRPanelHeaderLayout: {\n    width: \"100%\",\n    display: \"grid\",\n    gridTemplateColumns: `${DRAWER_WIDTH}px minmax(22rem, 1fr) minmax(${DRAWER_WIDTH}px, auto)`,\n    gridTemplateAreas: `\n    \"left middle right\"\n    `,\n    alignItems: \"center\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    paddingLeft: theme.spacing(12),\n    paddingRight: theme.spacing(12),\n    backgroundColor: theme.palette.background.paper,\n  },\n  LPanelHeaderWrapper: {\n    gridArea: \"left\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  MPanelHeaderWrapper: {\n    gridArea: \"middle\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  RPanelHeaderWrapper: {\n    gridArea: \"right\",\n    display: \"flex\",\n    alignItems: \"center\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  LPanelBodyWrapper: {\n    overflowX: \"hidden\",\n    overflowY: \"auto\",\n    gridArea: \"left\",\n    outline: `1px solid ${theme.palette.cobalt[100]}`,\n    backgroundColor: theme.palette.background.paper,\n    boxShadow: \"none\",\n  },\n  MPanelBodyWrapper: {\n    gridArea: \"middle\",\n  },\n  RPanelBodyWrapper: {\n    overflowX: \"hidden\",\n    overflowY: \"auto\",\n    boxShadow: theme.shadows[5],\n    borderLeftColor: theme.palette.divider,\n    borderLeftWidth: \"1px\",\n    borderLeftStyle: \"solid\",\n    gridArea: \"right\",\n  },\n}));\n\nconst __PANEL_HEADER_CSS_VAR = \"--panel-header\";\nexport const PANEL_HEADER_CSS_VAR = `var(${__PANEL_HEADER_CSS_VAR})`;\n\nexport const PanelHeaderLayout = (\n  props: BoxProps & {\n    type: \"LMR\";\n  }\n) => {\n  const { children, type, ...rest } = props;\n  const classes = useStyles();\n  const [ref] = useResizeObserver<HTMLDivElement>(({ height }) => {\n    if (height) {\n      document.documentElement.style.setProperty(\n        __PANEL_HEADER_CSS_VAR,\n        `${height}px`\n      );\n    }\n  });\n\n  return (\n    <Box\n      {...rest}\n      ref={ref}\n      component=\"section\"\n      data-testid=\"panel-header\"\n      className={clsx(\n        classes.panelHeaderLayout,\n        classes[`${type}PanelHeaderLayout`],\n        rest.className\n      )}\n    >\n      {children}\n    </Box>\n  );\n};\n\ntype PanelHeaderWrapperProps = BoxProps & {\n  type: \"L\" | \"M\" | \"R\";\n};\n\nexport const PanelHeaderWrapper = (props: PanelHeaderWrapperProps) => {\n  const { children, type, ...rest } = props;\n  const classes = useStyles();\n\n  return (\n    <Box\n      {...rest}\n      component=\"section\"\n      data-testid={`panel-header-${type}`}\n      className={clsx(classes[`${type}PanelHeaderWrapper`], rest.className)}\n    >\n      {children}\n    </Box>\n  );\n};\n\ntype PanelLayoutProps = BoxProps & {\n  type: \"M\" | \"LM\" | \"MR\" | \"LMR\";\n};\n\nexport const PanelLayout = (props: PanelLayoutProps) => {\n  const { children, type, ...rest } = props;\n  const classes = useStyles();\n\n  return (\n    <Box\n      {...rest}\n      className={clsx(\n        classes.panelLayout,\n        classes[`${type}PanelLayout`],\n        rest.className\n      )}\n    >\n      {children}\n    </Box>\n  );\n};\n\nexport const PanelBodyWrapper = (\n  props: BoxProps & {\n    type: \"L\" | \"M\" | \"R\";\n  }\n) => {\n  const { children, type, ...rest } = props;\n  const classes = useStyles();\n\n  return (\n    <Box\n      {...rest}\n      component=\"section\"\n      data-testid={`panel-body-${type}`}\n      className={clsx(classes[`${type}PanelBodyWrapper`], rest.className)}\n    >\n      {children}\n    </Box>\n  );\n};\n","import { SelectChangeEvent, SelectProps } from \"@mui/material\";\nimport get from \"lodash/get\";\nimport {\n  ChangeEvent,\n  createContext,\n  InputHTMLAttributes,\n  ReactNode,\n  useCallback,\n  useContext,\n  useMemo,\n} from \"react\";\n\nimport { getFieldComponentId, getInitialConfig } from \"@/charts\";\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport {\n  ChartConfig,\n  ChartType,\n  ConfiguratorState,\n  Filters,\n  isColorInConfig,\n  isComboChartConfig,\n  isTableConfig,\n} from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport {\n  getChartOptionField,\n  GetConfiguratorStateAction,\n  getFilterValue,\n  isConfiguring,\n  isLayouting,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport {\n  Component,\n  Dimension,\n  DimensionValue,\n  HierarchyValue,\n  isMeasure,\n  Measure,\n} from \"@/domain/data\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { categoricalPalettes } from \"@/palettes\";\nimport { bfs } from \"@/utils/bfs\";\nimport { isMultiHierarchyNode } from \"@/utils/hierarchy\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport type Option = {\n  isGroupHeader?: boolean;\n  group?: string;\n  value: string | $FixMe;\n  label: string | $FixMe;\n  position?: DimensionValue[\"position\"];\n  isNoneValue?: boolean;\n  disabled?: boolean;\n};\n\nexport type OptionGroupKey = $FixMe;\n\nexport type FieldProps = Pick<\n  InputHTMLAttributes<HTMLInputElement>,\n  \"onChange\" | \"id\" | \"name\" | \"value\" | \"checked\" | \"type\"\n>;\n\nconst getLeaves = (\n  tree: HierarchyValue[],\n  {\n    limit,\n    ignoreNode,\n  }: {\n    limit?: number;\n    ignoreNode: (hv: HierarchyValue) => boolean;\n  }\n) => {\n  const leaves = tree ? ([] as HierarchyValue[]) : undefined;\n  if (tree && leaves) {\n    bfs(tree, (node) => {\n      if (ignoreNode?.(node)) {\n        return bfs.IGNORE;\n      }\n\n      if (\n        (!node.children || node.children.length === 0) &&\n        node.hasValue &&\n        (limit === undefined || leaves.length < limit)\n      ) {\n        leaves?.push(node);\n      }\n    });\n  }\n\n  return leaves;\n};\n\n// Generic ------------------------------------------------------------------\n\nexport const useChartFieldField = ({\n  field,\n  components,\n}: {\n  field: EncodingFieldType;\n  components: Component[];\n}): SelectProps => {\n  const [state, dispatch] = useConfiguratorState();\n  const locale = useLocale();\n  const chartConfig = getChartConfig(state);\n  const handleChange = useEvent(async (e: SelectChangeEvent<unknown>) => {\n    if (e.target.value !== FIELD_VALUE_NONE) {\n      const dimensionId = e.target.value as string;\n      const dimension = components.find(\n        (c) => c.id === dimensionId\n      ) as Component;\n      const hierarchy = (isMeasure(dimension) ? [] : dimension.hierarchy) ?? [];\n\n      /**\n       * When there are multiple hierarchies, we only want to select leaves from\n       * the first hierarchy.\n       */\n      let hasSeenMultiHierarchyNode = false;\n      const leaves = getLeaves(hierarchy, {\n        ignoreNode: (hv) => {\n          if (isMultiHierarchyNode(hv)) {\n            if (hasSeenMultiHierarchyNode) {\n              return true;\n            } else {\n              hasSeenMultiHierarchyNode = true;\n              return false;\n            }\n          } else {\n            // normal node\n            return false;\n          }\n        },\n      });\n\n      dispatch({\n        type: \"CHART_FIELD_CHANGED\",\n        value: {\n          locale,\n          field,\n          componentId: dimensionId,\n          selectedValues: leaves,\n        },\n      });\n\n      if (!get(chartConfig, `fields[\"${field}\"].paletteId`)) {\n        return;\n      }\n\n      if (isColorInConfig(chartConfig)) {\n        const palette =\n          categoricalPalettes.find(\n            (p) => p.value === chartConfig.fields.color.paletteId\n          ) ?? categoricalPalettes[0];\n        dispatch({\n          type: \"COLOR_FIELD_SET\",\n          value:\n            chartConfig.fields.color.type === \"single\"\n              ? {\n                  type: chartConfig.fields.color.type,\n                  paletteId: palette.value,\n                  color: palette.colors[0],\n                }\n              : {\n                  type: chartConfig.fields.color.type,\n                  paletteId: palette.value,\n                  colorMapping: mapValueIrisToColor({\n                    paletteId: palette.value,\n                    dimensionValues: dimension.values,\n                  }),\n                },\n        });\n      } else {\n        const palette = categoricalPalettes[0];\n        const colorConfigPath = isTableConfig(chartConfig)\n          ? \"columnStyle\"\n          : undefined;\n        dispatch({\n          type: \"CHART_PALETTE_CHANGED\",\n          value: {\n            field,\n            colorConfigPath,\n            paletteId: palette.value,\n            colorMapping: mapValueIrisToColor({\n              paletteId: palette.value,\n              dimensionValues: dimension.values,\n            }),\n          },\n        });\n      }\n\n      return;\n    }\n\n    dispatch({\n      type: \"CHART_FIELD_DELETED\",\n      value: {\n        locale,\n        field,\n      },\n    });\n  });\n\n  let value: string | undefined;\n\n  if (isConfiguring(state)) {\n    const chartConfig = getChartConfig(state);\n    value = getFieldComponentId(chartConfig.fields, field) ?? FIELD_VALUE_NONE;\n  }\n\n  return {\n    name: field,\n    value,\n    onChange: handleChange,\n  };\n};\n\ntype UseChartOptionSelectFieldProps<V> = {\n  field: EncodingFieldType;\n  path: string;\n  getValue?: (key: string) => V | undefined;\n  getKey?: (value: V) => string;\n};\n\nexport const useChartOptionSelectField = <V extends {} = string>(\n  props: UseChartOptionSelectFieldProps<V>\n): SelectProps => {\n  const { field, path, getValue, getKey } = props;\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState();\n  const handleChange = useCallback<(e: SelectChangeEvent<unknown>) => void>(\n    (e) => {\n      const value = e.target.value as string;\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field,\n          path,\n          value: getValue ? getValue(value) : value,\n        },\n      });\n    },\n    [dispatch, locale, field, path, getValue]\n  );\n\n  let value: V | undefined;\n\n  if (isConfiguring(state)) {\n    value = get(\n      getChartConfig(state),\n      `fields[\"${field}\"].${path}`,\n      FIELD_VALUE_NONE\n    );\n  }\n\n  return {\n    name: path,\n    value: getKey ? getKey(value!) : (value as unknown as string),\n    onChange: handleChange,\n  };\n};\n\nexport const useChartOptionSliderField = ({\n  field,\n  path,\n  min,\n  max,\n  defaultValue,\n}: {\n  field: EncodingFieldType | null;\n  path: string;\n  min: number;\n  max: number;\n  defaultValue: number;\n}) => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState();\n\n  const onChange = useEvent((e: ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    const isValidNumber = /^\\d+$/.test(value) || value === \"\";\n\n    if (isValidNumber) {\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field,\n          path,\n          value: Math.max(min, Math.min(+value, max)),\n        },\n      });\n    }\n  });\n\n  const value = isConfiguring(state)\n    ? +getChartOptionField(state, field, path)\n    : defaultValue;\n\n  return {\n    name: path,\n    value,\n    onChange,\n  };\n};\n\ntype UseChartOptionRadioFieldProps<V extends string | number> = {\n  field: EncodingFieldType | null;\n  path: string;\n  value: V;\n};\n\nexport const useChartOptionRadioField = <V extends string | number>(\n  props: UseChartOptionRadioFieldProps<V>\n): FieldProps => {\n  const { field, path, value } = props;\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const handleChange = useCallback(() => {\n    dispatch({\n      type: \"CHART_FIELD_UPDATED\",\n      value: {\n        locale,\n        field,\n        path,\n        value,\n      },\n    });\n  }, [dispatch, locale, field, path, value]);\n  const stateValue = getChartOptionField(state, field, path);\n  const checked = stateValue ? stateValue === value : undefined;\n\n  return {\n    name: path,\n    value,\n    checked,\n    onChange: handleChange,\n  };\n};\n\nexport const useChartOptionBooleanField = ({\n  path,\n  field,\n  defaultValue = \"\",\n}: {\n  path: string;\n  field: EncodingFieldType | null;\n  defaultValue: boolean | string;\n}): FieldProps => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState();\n\n  const onChange = useCallback<(e: ChangeEvent<HTMLInputElement>) => void>(\n    (e) => {\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          path,\n          field,\n          value: e.currentTarget.checked,\n        },\n      });\n    },\n    [locale, dispatch, path, field]\n  );\n  const stateValue = isConfiguring(state)\n    ? getChartOptionField(state, field, path, defaultValue)\n    : defaultValue;\n  const checked = stateValue ? stateValue : false;\n\n  return {\n    name: path,\n    checked,\n    onChange,\n  };\n};\n\nexport const overrideChecked = (\n  chartConfig: ChartConfig,\n  field: string\n): boolean => {\n  return isComboChartConfig(chartConfig) && field === \"y\";\n};\n\ntype UseActiveFieldProps = {\n  value: string;\n};\n\nexport const useActiveChartField = (\n  props: UseActiveFieldProps\n): FieldProps & {\n  onClick: (x: string) => void;\n} => {\n  const { value } = props;\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const onClick = useCallback(() => {\n    dispatch({\n      type: \"CHART_ACTIVE_FIELD_CHANGE\",\n      value,\n    });\n  }, [dispatch, value]);\n  const checked = chartConfig.activeField === value;\n\n  return {\n    value,\n    checked,\n    onClick,\n  };\n};\n\nexport const useActiveLayoutField = (\n  props: UseActiveFieldProps\n): FieldProps & {\n  onClick: (x: string) => void;\n} => {\n  const { value } = props;\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const onClick = useCallback(() => {\n    dispatch({\n      type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value,\n    });\n  }, [dispatch, value]);\n  const checked = state.layout.activeField === value;\n\n  return {\n    value,\n    checked,\n    onClick,\n  };\n};\n\n// Specific ------------------------------------------------------------------\nexport const getNewChartConfig = ({\n  chartType,\n  chartConfig,\n  state,\n  dimensions,\n  measures,\n}: {\n  chartType: ChartType;\n  chartConfig: ChartConfig;\n  state: ConfiguratorState;\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  const cubes = isConfiguring(state)\n    ? getChartConfig(state, state.activeChartKey).cubes\n    : chartConfig.cubes;\n\n  return getInitialConfig({\n    chartType,\n    iris: cubes.map((cube) => ({ iri: cube.iri, joinBy: cube.joinBy })),\n    dimensions,\n    measures,\n  });\n};\n\nexport const useAddOrEditChartType = (\n  chartKey: string,\n  type: \"add\" | \"edit\" = \"edit\",\n  dimensions: Dimension[],\n  measures: Measure[]\n): {\n  value: ChartType;\n  addOrEditChartType: (chartType: ChartType) => void;\n} => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState();\n  const chartConfig = getChartConfig(state, chartKey);\n  const addOrEditChartType = useEvent((chartType: ChartType) => {\n    if (type === \"edit\") {\n      dispatch({\n        type: \"CHART_TYPE_CHANGED\",\n        value: {\n          locale,\n          chartKey,\n          chartType,\n        },\n      });\n    } else {\n      dispatch({\n        type: \"CHART_CONFIG_ADD\",\n        value: {\n          chartConfig: getNewChartConfig({\n            chartType,\n            chartConfig,\n            state,\n            dimensions,\n            measures,\n          }),\n          locale,\n        },\n      });\n    }\n  });\n\n  const value = get(chartConfig, \"chartType\");\n\n  return {\n    addOrEditChartType,\n    value,\n  };\n};\n\n// Used in the configurator filters\nexport const useSingleFilterSelect = (\n  filters: GetConfiguratorStateAction<\"FILTER_SET_SINGLE\">[\"value\"][\"filters\"]\n) => {\n  const [state, dispatch] = useConfiguratorState();\n  const onChange = useCallback<\n    (\n      e:\n        | Pick<SelectChangeEvent<unknown>, \"target\">\n        | { target: { value: string } }\n    ) => void\n  >(\n    (e) => {\n      const value = e.target.value as string;\n\n      if (value === FIELD_VALUE_NONE) {\n        dispatch({\n          type: \"FILTER_REMOVE_SINGLE\",\n          value: {\n            filters,\n          },\n        });\n      } else {\n        dispatch({\n          type: \"FILTER_SET_SINGLE\",\n          value: {\n            filters,\n            value: value === \"\" ? FIELD_VALUE_NONE : value,\n          },\n        });\n      }\n    },\n    [dispatch, filters]\n  );\n\n  let value = FIELD_VALUE_NONE;\n\n  if (isConfiguring(state)) {\n    const chartConfig = getChartConfig(state);\n    for (const filter of filters) {\n      const { cubeIri, dimensionId } = filter;\n      const cube = chartConfig.cubes.find((cube) => cube.iri === cubeIri);\n\n      if (cube) {\n        value = get(cube, [\"filters\", dimensionId, \"value\"], FIELD_VALUE_NONE);\n      }\n    }\n  } else if (isLayouting(state)) {\n    value = get(\n      state.dashboardFilters,\n      [\"dataFilters\", \"filters\", filters[0].dimensionId, \"value\"],\n      FIELD_VALUE_NONE\n    ) as string;\n  }\n\n  return {\n    value,\n    onChange,\n  };\n};\n\n// Used in the Table Chart options\nexport const useSingleFilterField = ({\n  filters,\n  value,\n}: {\n  filters: GetConfiguratorStateAction<\"FILTER_SET_SINGLE\">[\"value\"][\"filters\"];\n  value: string;\n}): FieldProps => {\n  const [state, dispatch] = useConfiguratorState();\n  const onChange = useCallback<(e: ChangeEvent<HTMLInputElement>) => void>(\n    (e) => {\n      dispatch({\n        type: \"FILTER_SET_SINGLE\",\n        value: {\n          filters: filters,\n          value: e.currentTarget.value,\n        },\n      });\n    },\n    [dispatch, filters]\n  );\n\n  const cubeIri = filters[0].cubeIri;\n  const dimensionId = filters[0].dimensionId;\n  const chartConfig = getChartConfig(state);\n  const cube = chartConfig.cubes.find((cube) => cube.iri === cubeIri);\n  const stateValue = isConfiguring(state)\n    ? get(cube, [\"filters\", dimensionId, \"value\"], \"\")\n    : \"\";\n  const checked = stateValue === value;\n\n  return {\n    name: dimensionId,\n    value: value ? value : stateValue,\n    checked,\n    onChange,\n  };\n};\n\nexport const isMultiFilterFieldChecked = (\n  filters: Filters,\n  dimensionId: string,\n  value: string\n) => {\n  const filter = filters[dimensionId];\n  const fieldChecked =\n    filter?.type === \"multi\" ? (filter.values?.[value] ?? false) : false;\n\n  return fieldChecked || !filter;\n};\n\nconst MultiFilterContext = createContext({\n  activeKeys: new Set() as Set<string>,\n  allValues: [] as string[],\n  cubeIri: \"\",\n  dimensionId: \"\",\n  colorConfigPath: undefined as string | undefined,\n  getValueColor: (_: string) => \"\" as string,\n});\n\nexport const useMultiFilterContext = () => {\n  return useContext(MultiFilterContext);\n};\n\nexport const MultiFilterContextProvider = ({\n  dimension,\n  colorConfigPath,\n  children,\n  getValueColor,\n}: {\n  dimension: Dimension;\n  children: ReactNode;\n  colorConfigPath?: string;\n  getValueColor: (value: string) => string;\n}) => {\n  const [state] = useConfiguratorState();\n  const activeFilter = getFilterValue(state, dimension);\n\n  const allValues = useMemo(() => {\n    return dimension.values.map((d) => `${d.value}`) ?? [];\n  }, [dimension.values]);\n  const activeKeys: Set<string> = useMemo(() => {\n    const activeKeys = activeFilter\n      ? activeFilter.type === \"single\"\n        ? [String(activeFilter.value)]\n        : activeFilter.type === \"multi\"\n          ? Object.keys(activeFilter.values)\n          : []\n      : allValues;\n\n    return new Set(activeKeys);\n  }, [activeFilter, allValues]);\n\n  const ctx = useMemo(() => {\n    return {\n      allValues,\n      activeKeys,\n      cubeIri: dimension.cubeIri,\n      dimensionId: dimension.id,\n      colorConfigPath,\n      getValueColor,\n    };\n  }, [\n    allValues,\n    dimension.cubeIri,\n    dimension.id,\n    activeKeys,\n    colorConfigPath,\n    getValueColor,\n  ]);\n\n  return (\n    <MultiFilterContext.Provider value={ctx}>\n      {children}\n    </MultiFilterContext.Provider>\n  );\n};\n\nexport const useMetaField = ({\n  type,\n  metaKey,\n  locale,\n  value,\n}: {\n  type: \"chart\" | \"layout\";\n  metaKey: string;\n  locale: string;\n  value?: string;\n}): FieldProps => {\n  const [, dispatch] = useConfiguratorState();\n  const onChange = useCallback<(e: ChangeEvent<HTMLInputElement>) => void>(\n    (e) => {\n      let dispatchType: \"CHART_META_CHANGE\" | \"LAYOUT_META_CHANGE\";\n\n      switch (type) {\n        case \"chart\":\n          dispatchType = \"CHART_META_CHANGE\";\n          break;\n        case \"layout\":\n          dispatchType = \"LAYOUT_META_CHANGE\";\n          break;\n        default:\n          const _exhaustiveCheck: never = type;\n          return _exhaustiveCheck;\n      }\n\n      dispatch({\n        type: dispatchType,\n        value: {\n          path: `${metaKey}.${locale}`,\n          value: e.currentTarget.value,\n        },\n      });\n    },\n    [type, dispatch, metaKey, locale]\n  );\n\n  return {\n    name: `${metaKey}-${locale}`,\n    value,\n    onChange,\n  };\n};\n","import {\n  ChartConfig,\n  ConfiguratorState,\n  ConfiguratorStateConfiguringChart,\n  ConfiguratorStateSelectingDataSet,\n  DataSource,\n} from \"@/config-types\";\nimport { DEFAULT_DATA_SOURCE } from \"@/domain/data-source\";\nimport { CONFIGURATOR_STATE_VERSION } from \"@/utils/chart-config/constants\";\n\nexport const getInitialConfiguringConfigBasedOnCube = (props: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n}): ConfiguratorStateConfiguringChart => {\n  const { chartConfig, dataSource } = props;\n  return {\n    version: CONFIGURATOR_STATE_VERSION,\n    state: \"CONFIGURING_CHART\",\n    dataSource,\n    layout: {\n      type: \"tab\",\n      meta: {\n        title: {\n          de: \"\",\n          en: \"\",\n          fr: \"\",\n          it: \"\",\n        },\n        description: {\n          de: \"\",\n          en: \"\",\n          fr: \"\",\n          it: \"\",\n        },\n        label: {\n          de: \"\",\n          en: \"\",\n          fr: \"\",\n          it: \"\",\n        },\n      },\n      blocks: [{ type: \"chart\", key: chartConfig.key, initialized: false }],\n      activeField: undefined,\n    },\n    chartConfigs: [chartConfig],\n    activeChartKey: chartConfig.key,\n    dashboardFilters: {\n      timeRange: {\n        active: false,\n        timeUnit: \"\",\n        presets: {\n          from: \"\",\n          to: \"\",\n        },\n      },\n      dataFilters: {\n        componentIds: [],\n        filters: {},\n      },\n    },\n  };\n};\n\nexport const INITIAL_STATE: ConfiguratorState = {\n  version: CONFIGURATOR_STATE_VERSION,\n  state: \"INITIAL\",\n  dataSource: DEFAULT_DATA_SOURCE,\n};\n\nexport const SELECTING_DATASET_STATE: ConfiguratorStateSelectingDataSet = {\n  ...INITIAL_STATE,\n  version: CONFIGURATOR_STATE_VERSION,\n  state: \"SELECTING_DATASET\",\n  dataSource: DEFAULT_DATA_SOURCE,\n  chartConfigs: undefined,\n  layout: undefined,\n  activeChartKey: undefined,\n};\n","import { DataSource } from \"@/config-types\";\nimport { DataCubeComponents } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { client } from \"@/graphql/client\";\nimport { VersionedJoinBy } from \"@/graphql/join\";\nimport { joinDimensions } from \"@/graphql/join\";\nimport {\n  DataCubeComponentFilter,\n  DataCubeComponentsDocument,\n  DataCubeComponentsQuery,\n  DataCubeComponentsQueryVariables,\n} from \"@/graphql/query-hooks\";\nimport { Locale } from \"@/locales/locales\";\n\n/**\n * Reads components from client cache, reading cube by cube.\n * Components are not joined in cache, but transformed here.\n */\nexport const getCachedComponents = ({\n  locale,\n  dataSource,\n  cubeFilters,\n}: {\n  locale: Locale;\n  dataSource: DataSource;\n  cubeFilters: DataCubeComponentFilter[];\n}): DataCubeComponents | undefined => {\n  const queries = cubeFilters\n    .map((cubeFilter) => {\n      return client.readQuery<\n        DataCubeComponentsQuery,\n        DataCubeComponentsQueryVariables\n      >(DataCubeComponentsDocument, {\n        locale,\n        sourceType: dataSource.type,\n        sourceUrl: dataSource.url,\n        cubeFilter: {\n          iri: cubeFilter.iri,\n          componentIds: undefined,\n          joinBy: cubeFilter.joinBy,\n          loadValues: true,\n        },\n      });\n    })\n    .filter(truthy);\n\n  const joinBy: VersionedJoinBy = Object.fromEntries(\n    cubeFilters\n      .map((cubeFilter) => {\n        return [cubeFilter.iri, cubeFilter.joinBy];\n      })\n      .filter(truthy)\n  );\n\n  return {\n    dimensions: joinDimensions({\n      dimensions: queries\n        .filter((x) => x.data)\n        .map((x) => x.data?.dataCubeComponents?.dimensions!)\n        .flat(),\n      joinBy: joinBy,\n    }),\n    measures: queries.flatMap((q) => q.data?.dataCubeComponents.measures!),\n  };\n};\n","import produce, {\n  createDraft,\n  current,\n  Draft,\n  isDraft,\n  setAutoFreeze,\n} from \"immer\";\nimport { WritableDraft } from \"immer/dist/types/types-external\";\nimport get from \"lodash/get\";\nimport isEqual from \"lodash/isEqual\";\nimport setWith from \"lodash/setWith\";\nimport sortBy from \"lodash/sortBy\";\nimport unset from \"lodash/unset\";\nimport { Reducer } from \"use-immer\";\n\nimport {\n  getChartConfigAdjustedToChartType,\n  getFieldComponentIds,\n  getGroupedFieldIds,\n  getHiddenFieldIds,\n} from \"@/charts\";\nimport {\n  getChartFieldChangeSideEffect,\n  getChartFieldDeleteSideEffect,\n  getChartFieldOptionChangeSideEffect,\n} from \"@/charts/chart-config-ui-options\";\nimport {\n  availableHandlesByBlockType,\n  COLS,\n  getInitialTileHeight,\n  getInitialTileWidth,\n  MIN_H,\n} from \"@/components/react-grid\";\nimport {\n  ChartConfig,\n  ColorMapping,\n  ColumnStyleCategory,\n  ConfiguratorState,\n  DashboardFiltersConfig,\n  DashboardTimeRangeFilter,\n  enableLayouting,\n  Filters,\n  GenericFields,\n  isAreaConfig,\n  isColorInConfig,\n  isMapConfig,\n  isSegmentInConfig,\n  isTableConfig,\n  ReactGridLayoutType,\n  SingleColorField,\n} from \"@/config-types\";\nimport { getChartConfig, makeMultiFilter } from \"@/config-utils\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport {\n  addDatasetInConfig,\n  getPreviousState,\n  getStateWithCurrentDataSource,\n  hasChartConfigs,\n  isConfiguring,\n  isLayouting,\n  removeDatasetInConfig,\n} from \"@/configurator/configurator-state\";\nimport { ConfiguratorStateAction } from \"@/configurator/configurator-state/actions\";\nimport {\n  getInitialConfiguringConfigBasedOnCube,\n  SELECTING_DATASET_STATE,\n} from \"@/configurator/configurator-state/initial\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { toggleInteractiveFilterDataDimension } from \"@/configurator/interactive-filters/interactive-filters-config-state\";\nimport { Dimension, isGeoDimension, isJoinByComponent } from \"@/domain/data\";\nimport {\n  getOriginalDimension,\n  getOriginalIds,\n  isJoinByCube,\n} from \"@/graphql/join\";\nimport { PossibleFilterValue } from \"@/graphql/query-hooks\";\nimport { DEFAULT_CATEGORICAL_PALETTE_ID } from \"@/palettes\";\nimport { findInHierarchy } from \"@/rdf/tree-utils\";\nimport { theme } from \"@/themes/theme\";\nimport { getCachedComponents } from \"@/urql-cache\";\nimport { assert } from \"@/utils/assert\";\nimport { unreachableError } from \"@/utils/unreachable\";\n\n/**\n * Setting auto-freeze behavior to false, to prevent hard-to-trace bugs.\n * It looks like the state is sometimes being mutated in a way that is not\n * expected by immer - I'd prefer to not be constrained by the auto-freeze\n * behavior.\n *\n * Also see https://immerjs.github.io/immer/freezing.\n */\nsetAutoFreeze(false);\n\n/**\n * Is responsible for inferring filters when changing chart type, or when\n * changing some chart fields. Makes sure that we are always showing the\n * non-\"duplicated\" data (with the correct filters for key dimensions).\n */\nexport const deriveFiltersFromFields = produce(\n  (\n    draft: ChartConfig,\n    options: {\n      /** Possibly joined dimensions */\n      dimensions: Dimension[];\n      possibleFilters?: PossibleFilterValue[];\n    }\n  ) => {\n    const { dimensions, possibleFilters } = options;\n\n    const getCubeDimensions = (dimensions: Dimension[], cubeIri: string) => {\n      return dimensions.filter(\n        (d) => d.cubeIri === cubeIri || isJoinByCube(d.cubeIri)\n      );\n    };\n\n    if (draft.chartType === \"table\") {\n      // As dimensions in tables behave differently than in other chart types,\n      // they need to be handled in a different way.\n      const hiddenFieldIds = getHiddenFieldIds(draft.fields);\n      const groupedDimensionIds = getGroupedFieldIds(draft.fields);\n      const isHidden = (dim: Dimension) => hiddenFieldIds.has(dim.id);\n      const isGrouped = (dim: Dimension) => groupedDimensionIds.has(dim.id);\n      draft.cubes.forEach((cube) => {\n        const cubeDimensions = getCubeDimensions(dimensions, cube.iri);\n        cubeDimensions.forEach((dim) => {\n          applyTableDimensionToFilters({\n            cubeIri: cube.iri,\n            filters: cube.filters,\n            dimension: dim,\n            isHidden: isHidden(dim),\n            isGrouped: isGrouped(dim),\n            possibleFilter: possibleFilters?.find((f) => f.id === dim.id),\n          });\n        });\n      });\n    } else {\n      const fieldDimensionIds = getFieldComponentIds(draft.fields);\n      const isField = (dim: Dimension) => fieldDimensionIds.has(dim.id);\n      draft.cubes.forEach((cube) => {\n        const cubeDimensions = getCubeDimensions(dimensions, cube.iri);\n        const sortedCubeDimensions = sortBy(\n          cubeDimensions,\n          (d) => (isGeoDimension(d) ? -1 : 1),\n          (d) => (d.hierarchy ? -1 : 1)\n        );\n        sortedCubeDimensions.forEach((dim) => {\n          applyNonTableDimensionToFilters({\n            cubeIri: cube.iri,\n            filters: cube.filters,\n            dimension: isJoinByComponent(dim)\n              ? getOriginalDimension(dim, cube)\n              : dim,\n            isField: isField(dim),\n            possibleFilter: possibleFilters?.find((f) => f.id === dim.id),\n          });\n        });\n      });\n    }\n  }\n);\n\nexport const applyTableDimensionToFilters = (props: {\n  cubeIri: string;\n  filters: Filters;\n  dimension: Dimension;\n  isHidden: boolean;\n  isGrouped: boolean;\n  possibleFilter?: PossibleFilterValue;\n}) => {\n  const { filters, dimension, isHidden, isGrouped, possibleFilter, cubeIri } =\n    props;\n  const originalIri = isJoinByComponent(dimension)\n    ? dimension.originalIds.find((c) => c.cubeIri === cubeIri)?.dimensionId\n    : dimension.id;\n  assert(originalIri !== undefined, \"Dimension should have an IRI\");\n  const currentFilter = filters[originalIri];\n  const shouldBecomeSingleFilter = isHidden && !isGrouped;\n\n  if (currentFilter) {\n    switch (currentFilter.type) {\n      case \"single\":\n        if (!shouldBecomeSingleFilter) {\n          delete filters[originalIri];\n        }\n        break;\n      case \"multi\":\n        if (shouldBecomeSingleFilter && dimension.isKeyDimension) {\n          filters[originalIri] = {\n            type: \"single\",\n            value:\n              Object.keys(currentFilter.values)[0] ?? dimension.values[0].value,\n          };\n        }\n        break;\n      case \"range\":\n        break;\n      default:\n        const _exhaustiveCheck: never = currentFilter;\n        return _exhaustiveCheck;\n    }\n  } else if (shouldBecomeSingleFilter && dimension.isKeyDimension) {\n    filters[originalIri] = {\n      type: \"single\",\n      // TODO, possibly in case of join by dimensions, we could get a value that is not part\n      // of the full range of values\n      value: possibleFilter?.value ?? dimension.values[0].value,\n    };\n  }\n};\n\nexport const applyNonTableDimensionToFilters = (props: {\n  cubeIri: string;\n  filters: Filters;\n  dimension: Dimension;\n  isField: boolean;\n  possibleFilter?: PossibleFilterValue;\n}) => {\n  const { filters, dimension, isField, possibleFilter, cubeIri } = props;\n  const originalIri = isJoinByComponent(dimension)\n    ? dimension.originalIds.find((c) => c.cubeIri === cubeIri)?.dimensionId\n    : dimension.id;\n  assert(originalIri !== undefined, \"Dimension should have an IRI\");\n  const currentFilter = filters[originalIri];\n\n  if (currentFilter) {\n    switch (currentFilter.type) {\n      case \"single\":\n        if (isField) {\n          // When a dimension is either x, y or segment, we want to clear the filter.\n          delete filters[originalIri];\n        }\n        break;\n      // Multi-filters are not allowed in the left panel.\n      case \"multi\":\n        if (!isField) {\n          const hierarchyTopMost = dimension.hierarchy\n            ? findInHierarchy(dimension.hierarchy, (v) => !!v.hasValue)\n            : undefined;\n          const filterValue = hierarchyTopMost\n            ? hierarchyTopMost.value\n            : (Object.keys(currentFilter.values)[0] ??\n              dimension.values[0].value);\n          filters[originalIri] = {\n            type: \"single\",\n            value: filterValue,\n          };\n        }\n        break;\n      case \"range\":\n        if (!isField) {\n          // Range-filters are not allowed in the left panel.\n          filters[originalIri] = {\n            type: \"single\",\n            value: currentFilter.from,\n          };\n        }\n        break;\n      default:\n        const _exhaustiveCheck: never = currentFilter;\n        return _exhaustiveCheck;\n    }\n  } else if (!isField && dimension.isKeyDimension) {\n    // If this scenario appears, it means that current filter is undefined -\n    // which means it must be converted to a single-filter (if it's a keyDimension,\n    // otherwise a 'No filter' option should be selected by default).\n    // Find the topmost hierarchy value\n    const hierarchyTopMost = dimension.hierarchy\n      ? findInHierarchy(dimension.hierarchy, (v) => !!v.hasValue)\n      : undefined;\n    const filterValue = hierarchyTopMost\n      ? hierarchyTopMost.value\n      : (possibleFilter?.value ?? dimension.values[0]?.value);\n\n    if (filterValue) {\n      filters[dimension.id] = {\n        type: \"single\",\n        value: filterValue,\n      };\n    }\n  }\n};\n\nexport const transitionStepNext = (\n  draft: ConfiguratorState,\n  options?: {\n    chartConfig?: ChartConfig;\n  }\n): ConfiguratorState => {\n  const { chartConfig } = options ?? {};\n\n  switch (draft.state) {\n    case \"SELECTING_DATASET\":\n      if (chartConfig) {\n        return getInitialConfiguringConfigBasedOnCube({\n          dataSource: draft.dataSource,\n          chartConfig,\n        });\n      }\n      break;\n    case \"CONFIGURING_CHART\":\n      return {\n        ...draft,\n        state: enableLayouting(draft) ? \"LAYOUTING\" : \"PUBLISHING\",\n        activeChartKey: draft.chartConfigs[0].key,\n      };\n    case \"LAYOUTING\":\n      return {\n        ...draft,\n        state: \"PUBLISHING\",\n      };\n\n    case \"INITIAL\":\n    case \"PUBLISHING\":\n    case \"PUBLISHED\":\n      break;\n    default:\n      throw unreachableError(draft);\n  }\n\n  return draft;\n};\nconst transitionStepPrevious = (\n  draft: ConfiguratorState,\n  to?: Exclude<ConfiguratorState[\"state\"], \"INITIAL\" | \"PUBLISHING\">\n): ConfiguratorState => {\n  const stepTo = to ?? getPreviousState(draft);\n\n  if (draft.state === \"INITIAL\" || draft.state === \"SELECTING_DATASET\") {\n    return draft;\n  }\n  switch (stepTo) {\n    case \"SELECTING_DATASET\":\n      return {\n        ...draft,\n        layout: undefined,\n        chartConfigs: undefined,\n        activeChartKey: undefined,\n        state: stepTo,\n      };\n    case \"CONFIGURING_CHART\":\n      return {\n        ...draft,\n        state: stepTo,\n        layout: {\n          ...draft.layout,\n          activeField: undefined,\n        },\n        chartConfigs: draft.chartConfigs.map((chartConfig) => ({\n          ...chartConfig,\n          activeField: undefined,\n        })),\n        activeChartKey: draft.chartConfigs[0].key,\n      };\n    case \"LAYOUTING\":\n      return {\n        ...draft,\n        state: stepTo,\n      };\n  }\n\n  return draft;\n};\n\nexport const handleChartFieldChanged = (\n  draft: ConfiguratorState,\n  action: Extract<ConfiguratorStateAction, { type: \"CHART_FIELD_CHANGED\" }>\n) => {\n  if (!isConfiguring(draft)) {\n    return draft;\n  }\n\n  const chartConfig = getChartConfig(draft);\n  const {\n    locale,\n    field,\n    componentId,\n    selectedValues: actionSelectedValues,\n  } = action.value;\n  const f = get(chartConfig.fields, field);\n  const dataCubesComponents = getCachedComponents({\n    locale,\n    dataSource: draft.dataSource,\n    cubeFilters: chartConfig.cubes.map((cube) => ({\n      iri: cube.iri,\n      joinBy: cube.joinBy,\n    })),\n  });\n  const dimensions = dataCubesComponents?.dimensions ?? [];\n  const measures = dataCubesComponents?.measures ?? [];\n  const components = [...dimensions, ...measures];\n  const component = components.find((d) => d.id === componentId);\n  const selectedValues = actionSelectedValues ?? component?.values ?? [];\n\n  if (f) {\n    // Reset field properties, excluding component id.\n    (chartConfig.fields as GenericFields)[field] = {\n      componentId,\n    };\n  }\n\n  const sideEffect = getChartFieldChangeSideEffect(chartConfig, field);\n  sideEffect?.(componentId, {\n    chartConfig,\n    dimensions,\n    measures,\n    initializing: !f,\n    selectedValues,\n    field,\n    oldField: f,\n  });\n\n  // Remove the component from interactive data filters.\n  const componentIds =\n    chartConfig.interactiveFiltersConfig.dataFilters.componentIds.filter(\n      (d) => d !== componentId\n    );\n  const active = componentIds.length > 0;\n  chartConfig.interactiveFiltersConfig.dataFilters = {\n    active,\n    componentIds,\n    defaultValueOverrides: Object.fromEntries(\n      Object.entries(\n        chartConfig.interactiveFiltersConfig.dataFilters.defaultValueOverrides\n      ).filter(([k]) => k !== componentId)\n    ),\n    filterTypes: Object.fromEntries(\n      Object.entries(\n        chartConfig.interactiveFiltersConfig.dataFilters.filterTypes\n      ).filter(([k]) => k !== componentId)\n    ),\n  };\n\n  const newConfig = deriveFiltersFromFields(chartConfig, { dimensions });\n  const index = draft.chartConfigs.findIndex((d) => d.key === chartConfig.key);\n  draft.chartConfigs[index] = newConfig;\n\n  return draft;\n};\n\nexport const handleChartFieldDeleted = (\n  draft: ConfiguratorState,\n  action: Extract<ConfiguratorStateAction, { type: \"CHART_FIELD_DELETED\" }>\n) => {\n  if (!isConfiguring(draft)) {\n    return draft;\n  }\n\n  const { locale, field } = action.value;\n  const chartConfig = getChartConfig(draft);\n  delete (chartConfig.fields as GenericFields)[field];\n  const dataCubesComponents = getCachedComponents({\n    locale,\n    dataSource: draft.dataSource,\n    cubeFilters: chartConfig.cubes.map((cube) => ({\n      iri: cube.iri,\n      joinBy: cube.joinBy,\n    })),\n  });\n  if (action.value.field === \"segment\") {\n    if (chartConfig.interactiveFiltersConfig) {\n      chartConfig.interactiveFiltersConfig.calculation.active = false;\n      chartConfig.interactiveFiltersConfig.calculation.type = \"identity\";\n    }\n\n    if (isColorInConfig(chartConfig)) {\n      const newColorField: SingleColorField = {\n        type: \"single\",\n        paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n        color: theme.palette.primary.main,\n      };\n      chartConfig.fields.color = newColorField;\n    }\n  }\n\n  const dimensions = dataCubesComponents?.dimensions ?? [];\n  const newConfig = deriveFiltersFromFields(chartConfig, { dimensions });\n  const index = draft.chartConfigs.findIndex((d) => d.key === chartConfig.key);\n  draft.chartConfigs[index] = newConfig;\n\n  const sideEffect = getChartFieldDeleteSideEffect(chartConfig, field);\n  sideEffect?.({ chartConfig });\n\n  return draft;\n};\n\nexport const handleChartFieldUpdated = (\n  draft: ConfiguratorState,\n  action: Extract<ConfiguratorStateAction, { type: \"CHART_FIELD_UPDATED\" }>\n) => {\n  if (isConfiguring(draft)) {\n    const { locale, path, field, value } = action.value;\n    const chartConfig = getChartConfig(draft);\n    const updatePath = field === null ? path : `fields[\"${field}\"].${path}`;\n    const dataCubesComponents = getCachedComponents({\n      locale,\n      dataSource: draft.dataSource,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        joinBy: cube.joinBy,\n      })),\n    });\n\n    const dimensions = dataCubesComponents?.dimensions ?? [];\n    const measures = dataCubesComponents?.measures ?? [];\n\n    if (field) {\n      const sideEffect = getChartFieldOptionChangeSideEffect(\n        chartConfig,\n        field,\n        path\n      );\n      sideEffect?.(value, {\n        chartConfig,\n        dimensions,\n        measures,\n        field,\n        oldField: get(chartConfig.fields, field),\n      });\n    }\n\n    if (value === FIELD_VALUE_NONE) {\n      unset(chartConfig, updatePath);\n    } else {\n      setWith(chartConfig, updatePath, value, Object);\n    }\n  }\n\n  return draft;\n};\n\nexport const updateColorMapping = (\n  draft: ConfiguratorState,\n  action: Extract<\n    ConfiguratorStateAction,\n    { type: \"CHART_CONFIG_UPDATE_COLOR_MAPPING\" }\n  >\n) => {\n  if (isConfiguring(draft)) {\n    const {\n      field,\n      colorConfigPath,\n      colorMapping: oldColorMapping,\n      values,\n      random,\n      customPalette,\n    } = action.value;\n    const chartConfig = getChartConfig(draft);\n    const path = colorConfigPath\n      ? [\"fields\", field, colorConfigPath]\n      : [\"fields\", field];\n    let colorMapping: ColorMapping | undefined;\n\n    if (isTableConfig(chartConfig)) {\n      const fieldValue: ColumnStyleCategory | undefined = get(\n        chartConfig,\n        path\n      );\n\n      if (fieldValue) {\n        colorMapping = mapValueIrisToColor({\n          paletteId: fieldValue.paletteId,\n          dimensionValues: values,\n          colorMapping: oldColorMapping,\n          random,\n          customPalette,\n        });\n      }\n    } else {\n      const { paletteId } = get(chartConfig, path);\n      colorMapping = mapValueIrisToColor({\n        paletteId,\n        dimensionValues: values,\n        colorMapping: oldColorMapping,\n        random,\n        customPalette,\n      });\n    }\n\n    if (colorMapping) {\n      setWith(chartConfig, path.concat(\"colorMapping\"), colorMapping, Object);\n    }\n  }\n\n  return draft;\n};\n\nconst handleInteractiveFilterChanged = (\n  draft: ConfiguratorState,\n  action: Extract<\n    ConfiguratorStateAction,\n    { type: \"INTERACTIVE_FILTER_CHANGED\" }\n  >\n) => {\n  if (isConfiguring(draft)) {\n    const chartConfig = getChartConfig(draft);\n    setWith(chartConfig, \"interactiveFiltersConfig\", action.value, Object);\n  }\n\n  return draft;\n};\n\nexport const setRangeFilter = (\n  draft: ConfiguratorState,\n  action: Extract<\n    ConfiguratorStateAction,\n    { type: \"CHART_CONFIG_FILTER_SET_RANGE\" }\n  >\n) => {\n  const { dimension, from, to } = action.value;\n  const chartConfig = getChartConfig(draft);\n  const adjustFilter = (cubeIri: string, dimensionId: string) => {\n    const cube = chartConfig.cubes.find((cube) => cube.iri === cubeIri);\n\n    if (cube) {\n      cube.filters[dimensionId] = {\n        type: \"range\",\n        from,\n        to,\n      };\n    }\n  };\n\n  if (dimension.isJoinByDimension) {\n    for (const { cubeIri, dimensionId } of dimension.originalIds) {\n      adjustFilter(cubeIri, dimensionId);\n    }\n  } else {\n    adjustFilter(dimension.cubeIri, dimension.id);\n  }\n\n  if (chartConfig.interactiveFiltersConfig) {\n    chartConfig.interactiveFiltersConfig.timeRange = {\n      componentId: dimension.id,\n      active: chartConfig.interactiveFiltersConfig.timeRange.active,\n      presets: {\n        type: \"range\",\n        from,\n        to,\n      },\n    };\n  }\n};\n\nconst handleAddNewChartConfig = (\n  draft: ConfiguratorState,\n  chartConfig: ChartConfig\n) => {\n  if (isConfiguring(draft) || isLayouting(draft)) {\n    draft.chartConfigs.push(chartConfig);\n    draft.activeChartKey = chartConfig.key;\n    draft.layout.blocks.push({\n      key: chartConfig.key,\n      type: \"chart\",\n      initialized: false,\n    });\n\n    ensureDashboardLayoutIsCorrect(draft);\n  }\n\n  return draft;\n};\n\nconst reducer_: Reducer<ConfiguratorState, ConfiguratorStateAction> = (\n  draft,\n  action\n) => {\n  switch (action.type) {\n    case \"INITIALIZED\":\n      // Never restore from an UNINITIALIZED state\n      return action.value.state === \"INITIAL\"\n        ? getStateWithCurrentDataSource(SELECTING_DATASET_STATE)\n        : action.value;\n    case \"DATASOURCE_CHANGED\":\n      draft.dataSource = action.value;\n\n      return draft;\n\n    case \"CHART_TYPE_CHANGED\":\n      if (isConfiguring(draft)) {\n        const { locale, chartKey, chartType, isAddingNewCube } = action.value;\n        const chartConfig = getChartConfig(draft, chartKey);\n        const dataCubesComponents = getCachedComponents({\n          locale,\n          dataSource: draft.dataSource,\n          cubeFilters: chartConfig.cubes.map((cube) => ({\n            iri: cube.iri,\n            joinBy: cube.joinBy,\n          })),\n        });\n        const dimensions = dataCubesComponents?.dimensions;\n        const measures = dataCubesComponents?.measures;\n\n        if (dimensions && measures) {\n          const newConfig = deriveFiltersFromFields(\n            getChartConfigAdjustedToChartType({\n              chartConfig: current(chartConfig),\n              newChartType: chartType,\n              dimensions,\n              measures,\n              isAddingNewCube,\n            }),\n            { dimensions }\n          );\n\n          const index = draft.chartConfigs.findIndex(\n            (d) => d.key === chartConfig.key\n          );\n          draft.chartConfigs[index] = newConfig;\n        }\n      }\n\n      return draft;\n\n    case \"CHART_ACTIVE_FIELD_CHANGE\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        chartConfig.activeField = action.value;\n      }\n\n      return draft;\n\n    case \"CHART_FIELD_CHANGED\":\n      return handleChartFieldChanged(draft, action);\n\n    case \"CHART_SHOW_LEGEND_TITLE_CHANGED\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n\n        if (isSegmentInConfig(chartConfig) && chartConfig.fields.segment) {\n          chartConfig.fields.segment.showTitle = action.value;\n        }\n        const index = draft.chartConfigs.findIndex(\n          (d) => d.key === chartConfig.key\n        );\n        draft.chartConfigs[index] = chartConfig;\n      }\n      return draft;\n\n    case \"CHART_FIELD_DELETED\":\n      return handleChartFieldDeleted(draft, action);\n\n    case \"CHART_FIELD_UPDATED\":\n      return handleChartFieldUpdated(draft, action);\n\n    case \"COLOR_FIELD_SET\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        setWith(\n          chartConfig,\n          `fields.color.paletteId`,\n          action.value.paletteId,\n          Object\n        );\n        setWith(\n          chartConfig,\n          `fields.color.${action.value.type === \"single\" ? \"color\" : \"colorMapping\"}`,\n          action.value.type === \"single\"\n            ? action.value.color\n            : action.value.colorMapping,\n          Object\n        );\n      }\n\n      return draft;\n    case \"CHART_PALETTE_CHANGED\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        const commonPath = `fields[\"${action.value.field}\"].${\n          action.value.colorConfigPath ? `${action.value.colorConfigPath}.` : \"\"\n        }`;\n\n        setWith(\n          chartConfig,\n          `${commonPath}palette`,\n          action.value.paletteId,\n          Object\n        );\n        setWith(\n          chartConfig,\n          `${commonPath}colorMapping`,\n          action.value.colorMapping,\n          Object\n        );\n      }\n\n      return draft;\n\n    case \"CHART_PALETTE_RESET\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        setWith(\n          chartConfig,\n          `fields[\"${action.value.field}\"].${\n            action.value.colorConfigPath\n              ? `${action.value.colorConfigPath}.`\n              : \"\"\n          }colorMapping`,\n          action.value.colorMapping,\n          Object\n        );\n      }\n\n      return draft;\n\n    case \"CHART_COLOR_CHANGED\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        setWith(\n          chartConfig,\n          `fields[\"${action.value.field}\"].${\n            action.value.colorConfigPath\n              ? `${action.value.colorConfigPath}.`\n              : \"\"\n          }colorMapping[\"${action.value.value}\"]`,\n          action.value.color,\n          Object\n        );\n      }\n      return draft;\n\n    case \"CHART_META_CHANGE\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        setWith(\n          chartConfig,\n          `meta.${action.value.path}`,\n          action.value.value,\n          Object\n        );\n      }\n\n      return draft;\n\n    case \"CUSTOM_LAYER_ADD\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n\n        if (isMapConfig(chartConfig)) {\n          chartConfig.baseLayer.customLayers.push(action.value.layer);\n        }\n      }\n\n      return draft;\n\n    case \"CUSTOM_LAYER_UPDATE\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n\n        if (isMapConfig(chartConfig)) {\n          const { layer } = action.value;\n          const i = chartConfig.baseLayer.customLayers.findIndex(\n            (l) => l.type === layer.type && l.id === layer.id\n          );\n\n          if (i !== -1) {\n            chartConfig.baseLayer.customLayers[i] = layer;\n          }\n        }\n      }\n\n      return draft;\n\n    case \"CUSTOM_LAYER_REMOVE\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n\n        if (isMapConfig(chartConfig)) {\n          const { type, id } = action.value;\n          chartConfig.baseLayer.customLayers =\n            chartConfig.baseLayer.customLayers.filter(\n              (layer) => !(layer.type === type && layer.id === id)\n            );\n        }\n      }\n\n      return draft;\n\n    case \"CUSTOM_LAYER_SWAP\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n\n        if (isMapConfig(chartConfig)) {\n          const { oldIndex, newIndex } = action.value;\n          const customLayers = chartConfig.baseLayer.customLayers;\n          const newCustomLayers = [...customLayers];\n          const [removed] = newCustomLayers.splice(oldIndex, 1);\n          newCustomLayers.splice(newIndex, 0, removed);\n          chartConfig.baseLayer.customLayers = newCustomLayers;\n        }\n      }\n\n      return draft;\n\n    case \"INTERACTIVE_FILTER_CHANGED\":\n      return handleInteractiveFilterChanged(draft, action);\n\n    case \"CHART_CONFIG_REPLACED\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        const index = draft.chartConfigs.findIndex(\n          (d) => d.key === chartConfig.key\n        );\n        draft.chartConfigs[index] = deriveFiltersFromFields(\n          action.value.chartConfig,\n          { dimensions: action.value.dataCubesComponents.dimensions }\n        );\n      }\n\n      return draft;\n\n    case \"FILTER_SET_SINGLE\":\n      if (isConfiguring(draft)) {\n        const { filters, value } = action.value;\n        const chartConfig = getChartConfig(draft);\n\n        /*\n         * We are getting a list of filters, since setting a single filter in the UI\n         * in the case of joined dimensions, sets multiple filters inside the chart\n         * configuration.\n         */\n        for (const filter of filters) {\n          const { cubeIri, dimensionId } = filter;\n          const cube = chartConfig.cubes.find((cube) => cube.iri === cubeIri);\n\n          if (cube) {\n            cube.filters[dimensionId] = {\n              type: \"single\",\n              value,\n            };\n          } else {\n            console.warn(\n              `Could not set filter, no cube in chart config was found with iri ${cubeIri}`\n            );\n          }\n        }\n      } else if (isLayouting(draft)) {\n        const { filters, value } = action.value;\n        const { dimensionId } = filters[0];\n        if (draft.dashboardFilters) {\n          draft.dashboardFilters.dataFilters.filters[dimensionId] = {\n            type: \"single\",\n            value,\n          };\n        }\n      }\n\n      return draft;\n\n    case \"FILTER_REMOVE_SINGLE\":\n      if (isConfiguring(draft)) {\n        const { filters } = action.value;\n        const chartConfig = getChartConfig(draft);\n\n        for (const filter of filters) {\n          const { cubeIri, dimensionId } = filter;\n          const cube = chartConfig.cubes.find((cube) => cube.iri === cubeIri);\n\n          if (cube) {\n            delete cube.filters[dimensionId];\n            const newIFConfig = toggleInteractiveFilterDataDimension(\n              chartConfig.interactiveFiltersConfig,\n              dimensionId,\n              false\n            );\n            chartConfig.interactiveFiltersConfig = newIFConfig;\n          }\n        }\n      } else if (isLayouting(draft)) {\n        const { filters } = action.value;\n        const { dimensionId } = filters[0];\n        if (draft.dashboardFilters) {\n          delete draft.dashboardFilters.dataFilters.filters[dimensionId];\n        }\n      }\n\n      return draft;\n\n    case \"CHART_CONFIG_UPDATE_COLOR_MAPPING\":\n      return updateColorMapping(draft, action);\n\n    case \"CHART_CONFIG_FILTER_SET_MULTI\":\n      if (isConfiguring(draft)) {\n        const { cubeIri, dimensionId, values } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const resolvedCubeIris = isJoinByCube(cubeIri)\n          ? getOriginalIds(cubeIri, chartConfig)\n          : [cubeIri];\n\n        for (const resolvedCubeIri of resolvedCubeIris) {\n          const cube = chartConfig.cubes.find(\n            (cube) =>\n              cube.iri === resolvedCubeIri ||\n              cube.joinBy?.includes(resolvedCubeIri)\n          );\n\n          if (cube) {\n            cube.filters[dimensionId] = makeMultiFilter(values);\n          }\n        }\n      }\n\n      return draft;\n\n    case \"CHART_CONFIG_FILTER_RESET_RANGE\":\n      if (isConfiguring(draft)) {\n        const { cubeIri, dimensionId } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const cube = chartConfig.cubes.find((cube) => cube.iri === cubeIri);\n\n        if (cube) {\n          delete cube.filters[dimensionId];\n        }\n      }\n\n      return draft;\n\n    case \"CHART_CONFIG_FILTER_SET_RANGE\":\n      if (isConfiguring(draft)) {\n        setRangeFilter(draft, action);\n      }\n\n      return draft;\n\n    case \"CHART_CONFIG_FILTERS_UPDATE\":\n      if (isConfiguring(draft)) {\n        const { cubeIri, filters } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const cube = chartConfig.cubes.find((cube) => cube.iri === cubeIri);\n\n        if (cube) {\n          cube.filters = filters;\n        }\n      }\n\n      return draft;\n\n    case \"IMPUTATION_TYPE_CHANGED\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        if (isAreaConfig(chartConfig)) {\n          chartConfig.fields.y.imputationType = action.value.type;\n        }\n      }\n\n      return draft;\n\n    // State transitions\n    case \"STEP_NEXT\":\n      return transitionStepNext(draft);\n\n    case \"STEP_PREVIOUS\":\n      return transitionStepPrevious(draft, action.to);\n\n    // Special state transitions\n    case \"PUBLISH_FAILED\":\n      if (draft.state === \"PUBLISHING\") {\n        return transitionStepPrevious(draft);\n      }\n      return draft;\n\n    case \"PUBLISHED\":\n      return draft;\n\n    case \"CHART_CONFIG_ADD\":\n      if (isConfiguring(draft) || isLayouting(draft)) {\n        const chartConfig =\n          createDraft(action.value.chartConfig) ?? getChartConfig(draft);\n        const dataCubesComponents = getCachedComponents({\n          locale: action.value.locale,\n          dataSource: draft.dataSource,\n          cubeFilters: chartConfig.cubes.map((cube) => ({\n            iri: cube.iri,\n            joinBy: cube.joinBy,\n          })),\n        });\n\n        if (dataCubesComponents) {\n          const cubes = current(chartConfig.cubes);\n          const newConfig = deriveFiltersFromFields(\n            {\n              ...action.value.chartConfig,\n              // Need to finalize the cubes draft to avoid revoked proxy errors\n              cubes,\n            },\n            { dimensions: dataCubesComponents.dimensions }\n          );\n          handleAddNewChartConfig(draft, newConfig);\n        }\n      }\n\n      return draft;\n\n    case \"CHART_CONFIG_ADD_NEW_DATASET\":\n      if (isConfiguring(draft)) {\n        handleAddNewChartConfig(draft, action.value.chartConfig);\n      }\n\n      return draft;\n\n    case \"DATASET_ADD\":\n      if (isConfiguring(draft)) {\n        addDatasetInConfig(draft, action.value);\n        return draft;\n      }\n      break;\n\n    case \"DATASET_REMOVE\":\n      if (isConfiguring(draft)) {\n        removeDatasetInConfig(draft, action.value);\n\n        return draft;\n      }\n\n      break;\n\n    case \"CHART_CONFIG_REMOVE\":\n      if (isConfiguring(draft) || isLayouting(draft)) {\n        const index = draft.chartConfigs.findIndex(\n          (d) => d.key === action.value.chartKey\n        );\n        const removedKey = draft.chartConfigs[index].key;\n        draft.chartConfigs.splice(index, 1);\n        draft.layout.blocks = draft.layout.blocks.filter(\n          (block) => block.key !== removedKey\n        );\n\n        if (removedKey === draft.activeChartKey) {\n          draft.activeChartKey = draft.chartConfigs[Math.max(index - 1, 0)].key;\n        }\n      } else {\n        console.warn(\n          \"Ignoring CHART_CONFIG_REMOVE as state is incompatible with action\"\n        );\n        console.log(current(draft));\n      }\n\n      ensureDashboardLayoutIsCorrect(draft);\n\n      return draft;\n\n    case \"CHART_CONFIG_REORDER\":\n      if (isConfiguring(draft) || draft.state === \"LAYOUTING\") {\n        const { oldIndex, newIndex } = action.value;\n        const [removed] = draft.chartConfigs.splice(oldIndex, 1);\n        draft.chartConfigs.splice(newIndex, 0, removed);\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_ADD\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        chartConfig.annotations.push(action.value);\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_HIGHLIGHT_TYPE_CHANGE\":\n      if (isConfiguring(draft)) {\n        const { key, highlightType } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const annotation = chartConfig.annotations.find((a) => a.key === key);\n\n        if (annotation) {\n          annotation.highlightType = highlightType;\n        }\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_COLOR_CHANGE\":\n      if (isConfiguring(draft)) {\n        const { key, color } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const annotation = chartConfig.annotations.find((a) => a.key === key);\n\n        if (annotation) {\n          annotation.color = color;\n        }\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_DEFAULT_OPEN_CHANGE\":\n      if (isConfiguring(draft)) {\n        const { key, defaultOpen } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const annotation = chartConfig.annotations.find((a) => a.key === key);\n\n        if (annotation) {\n          annotation.defaultOpen = defaultOpen;\n        }\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_TEXT_CHANGE\":\n      if (isConfiguring(draft)) {\n        const { key, locale, value } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const annotation = chartConfig.annotations.find((a) => a.key === key);\n\n        if (annotation) {\n          annotation.text[locale] = value;\n        }\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_TEXT_CLEAR\":\n      if (isConfiguring(draft)) {\n        const { key } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const annotation = chartConfig.annotations.find((a) => a.key === key);\n\n        if (annotation) {\n          annotation.text = {\n            en: \"\",\n            de: \"\",\n            fr: \"\",\n            it: \"\",\n          };\n        }\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_REMOVE\":\n      if (isConfiguring(draft)) {\n        const chartConfig = getChartConfig(draft);\n        chartConfig.annotations = chartConfig.annotations.filter(\n          (a) => a.key !== action.value.key\n        );\n        chartConfig.activeField = undefined;\n      }\n\n      return draft;\n\n    case \"CHART_ANNOTATION_TARGETS_CHANGE\":\n      if (isConfiguring(draft)) {\n        const { key, targets } = action.value;\n        const chartConfig = getChartConfig(draft);\n        const annotation = chartConfig.annotations.find((a) => a.key === key);\n\n        if (annotation) {\n          annotation.targets = targets;\n        }\n      }\n\n      return draft;\n\n    case \"LIMIT_SET\":\n      if (isConfiguring(draft)) {\n        const { measureId, ...limit } = action.value;\n        const chartConfig = getChartConfig(draft);\n\n        if (!chartConfig.limits[measureId]) {\n          chartConfig.limits[measureId] = [limit];\n        } else {\n          const limitToAddIndex = chartConfig.limits[measureId].findIndex(\n            (d) => {\n              if (d.related.length !== limit.related.length) {\n                return false;\n              }\n\n              return d.related.every((r) =>\n                limit.related.some(\n                  (nr) =>\n                    r.dimensionId === nr.dimensionId && r.value === nr.value\n                )\n              );\n            }\n          );\n\n          if (limitToAddIndex !== -1) {\n            chartConfig.limits[measureId][limitToAddIndex] = limit;\n          } else {\n            chartConfig.limits[measureId].push(limit);\n          }\n        }\n      }\n\n      return draft;\n\n    case \"LIMIT_REMOVE\":\n      if (isConfiguring(draft)) {\n        const { measureId, related } = action.value;\n        const chartConfig = getChartConfig(draft);\n\n        const limits = chartConfig.limits[measureId] ?? [];\n\n        const limitToRemoveIndex = limits.findIndex((d) => {\n          if (d.related.length !== related.length) {\n            return false;\n          }\n\n          return d.related.every((r) => {\n            return related.some((nr) => {\n              return r.dimensionId === nr.dimensionId && r.value === nr.value;\n            });\n          });\n        });\n\n        if (limitToRemoveIndex === -1) {\n          return draft;\n        }\n\n        if (limits.length === 1) {\n          delete chartConfig.limits[measureId];\n        } else {\n          chartConfig.limits[measureId] = limits.filter(\n            (_, index) => index !== limitToRemoveIndex\n          );\n        }\n      }\n\n      return draft;\n\n    case \"LAYOUT_BLOCK_SWAP\":\n      if (isConfiguring(draft) || draft.state === \"LAYOUTING\") {\n        const { oldIndex, newIndex } = action.value;\n        const oldBlock = draft.layout.blocks[oldIndex];\n        const newBlock = draft.layout.blocks[newIndex];\n        draft.layout.blocks[oldIndex] = newBlock;\n        draft.layout.blocks[newIndex] = oldBlock;\n      }\n\n      return draft;\n\n    case \"SWITCH_ACTIVE_CHART\":\n      if (\n        isConfiguring(draft) ||\n        draft.state === \"LAYOUTING\" ||\n        draft.state === \"PUBLISHED\"\n      ) {\n        draft.activeChartKey = action.value;\n      }\n\n      return draft;\n\n    case \"LAYOUT_CHANGED\":\n      if (draft.state === \"LAYOUTING\" || draft.state === \"PUBLISHED\") {\n        if (!isEqual(draft.layout, action.value)) {\n          draft.layout = action.value;\n          ensureDashboardLayoutIsCorrect(draft);\n        }\n      }\n\n      return draft;\n\n    case \"LAYOUT_ACTIVE_FIELD_CHANGE\":\n      if (draft.state === \"LAYOUTING\") {\n        draft.layout.activeField = action.value;\n      }\n\n      return draft;\n\n    case \"LAYOUT_META_CHANGE\":\n      if (draft.state === \"LAYOUTING\") {\n        setWith(\n          draft,\n          `layout.meta.${action.value.path}`,\n          action.value.value,\n          Object\n        );\n      }\n      return draft;\n\n    case \"CONFIGURE_CHART\":\n      const newDraft = transitionStepPrevious(draft, \"CONFIGURING_CHART\");\n      assert(isConfiguring(newDraft), \"Should be configuring after edit\");\n      newDraft.activeChartKey = action.value.chartKey;\n      return newDraft;\n\n    case \"DASHBOARD_TIME_RANGE_FILTER_UPDATE\":\n      if (isLayouting(draft)) {\n        setWith(draft, \"dashboardFilters.timeRange\", action.value, Object);\n      }\n      return draft;\n\n    case \"DASHBOARD_TIME_RANGE_FILTER_REMOVE\":\n      if (isLayouting(draft)) {\n        setWith(\n          draft,\n          \"dashboardFilters.timeRange\",\n          {\n            active: false,\n            timeUnit: \"\",\n            presets: {\n              from: \"\",\n              to: \"\",\n            },\n          } as DashboardTimeRangeFilter,\n          Object\n        );\n      }\n      return draft;\n\n    case \"DASHBOARD_DATA_FILTER_ADD\":\n      if (isLayouting(draft) && draft.dashboardFilters) {\n        const { dimensionId } = action.value;\n        const newFilters: DashboardFiltersConfig = {\n          ...draft.dashboardFilters,\n          dataFilters: {\n            ...draft.dashboardFilters.dataFilters,\n            componentIds: [\n              ...draft.dashboardFilters.dataFilters.componentIds,\n              dimensionId,\n            ],\n          },\n        };\n        draft.dashboardFilters = newFilters;\n      }\n      return draft;\n\n    case \"DASHBOARD_DATA_FILTERS_SET\":\n      if (isLayouting(draft) && draft.dashboardFilters) {\n        draft.dashboardFilters.dataFilters = action.value;\n      }\n      return draft;\n\n    case \"DASHBOARD_DATA_FILTER_REMOVE\":\n      if (isLayouting(draft) && draft.dashboardFilters) {\n        const { dimensionId } = action.value;\n        const newFilters: DashboardFiltersConfig = {\n          ...draft.dashboardFilters,\n          dataFilters: {\n            ...draft.dashboardFilters.dataFilters,\n            componentIds:\n              draft.dashboardFilters.dataFilters.componentIds.filter(\n                (d) => d !== dimensionId\n              ),\n          },\n        };\n        draft.dashboardFilters = newFilters;\n      }\n\n      return draft;\n\n    default:\n      throw unreachableError(action);\n  }\n};\n\n/** Turn this on for the reducer to log state, action and result */\nconst reducerLogging: false = false;\nconst withLogging = <TState, TAction extends { type: unknown }>(\n  reducer: Reducer<TState, TAction>\n) => {\n  return (state: Draft<TState>, action: TAction) => {\n    const res = reducer(state, action);\n    console.log(\n      `Action: ${action.type}`,\n      action,\n      isDraft(state) ? current(state) : state\n    );\n    return res;\n  };\n};\nexport const reducer = reducerLogging ? withLogging(reducer_) : reducer_;\n\nexport const ensureDashboardLayoutIsCorrect = (\n  draft: WritableDraft<ConfiguratorState>\n) => {\n  if (\n    hasChartConfigs(draft) &&\n    draft.layout.type === \"dashboard\" &&\n    draft.layout.layout === \"canvas\"\n  ) {\n    const { blocks, layouts } = draft.layout;\n\n    for (const [breakpoint, _breakpointLayouts] of Object.entries(layouts)) {\n      const breakpointLayouts = [..._breakpointLayouts];\n      const breakpointLayoutKeys = breakpointLayouts.map((l) => l.i);\n      const newBlocks = blocks.filter((block) => {\n        return !breakpointLayoutKeys.includes(block.key);\n      });\n      const keysToRemove = breakpointLayoutKeys.filter(\n        (key) => !blocks.find((block) => block.key === key)\n      );\n      const cols = COLS[breakpoint as keyof typeof COLS];\n      const { x, y } = getPreferredEmptyCellCoords({\n        layouts: breakpointLayouts,\n        cols,\n      });\n      let w = 0;\n      let h = 0;\n\n      for (const block of newBlocks) {\n        switch (block.type) {\n          case \"chart\":\n            w = getInitialTileWidth();\n            h = getInitialTileHeight();\n            break;\n          case \"text\":\n            w = 1;\n            h = 1;\n            break;\n          default:\n            const _exhaustiveCheck: never = block;\n            return _exhaustiveCheck;\n        }\n\n        breakpointLayouts.push({\n          i: block.key,\n          x,\n          y,\n          w,\n          h,\n          minH: MIN_H,\n          resizeHandles: availableHandlesByBlockType[block.type],\n        });\n      }\n\n      for (const key of keysToRemove) {\n        const index = breakpointLayouts.findIndex((l) => l.i === key);\n        breakpointLayouts.splice(index, 1);\n      }\n\n      draft.layout.layouts = {\n        ...draft.layout.layouts,\n        [breakpoint]: breakpointLayouts,\n      };\n    }\n  }\n};\n\nconst getPreferredEmptyCellCoords = ({\n  layouts,\n  cols,\n}: {\n  layouts: ReactGridLayoutType[];\n  cols: number;\n}) => {\n  const makeKey = (x: number, y: number) => `${x},${y}`;\n  const occupiedCells = new Set<string>();\n\n  for (const layout of layouts) {\n    for (let dx = 0; dx < layout.w; dx++) {\n      for (let dy = 0; dy < layout.h; dy++) {\n        occupiedCells.add(makeKey(layout.x + dx, layout.y + dy));\n      }\n    }\n  }\n\n  let x = 0;\n  let y = 0;\n\n  while (true) {\n    const key = makeKey(x, y);\n\n    if (!occupiedCells.has(key)) {\n      return { x, y };\n    }\n\n    x++;\n\n    if (x >= cols) {\n      x = 0;\n      y++;\n    }\n  }\n};\n","import { ConfiguratorState } from \"@/config-types\";\n\nconst LOCALSTORAGE_PREFIX = \"vizualize-configurator-state\";\nexport const getLocalStorageKey = (chartId: string) =>\n  `${LOCALSTORAGE_PREFIX}:${chartId}`;\n\nexport const saveChartLocally = (chartId: string, state: ConfiguratorState) => {\n  window.localStorage.setItem(\n    getLocalStorageKey(chartId),\n    JSON.stringify(state)\n  );\n  return;\n};\n","import { Client } from \"urql\";\n\nimport { getEnabledChartTypes, getInitialConfig } from \"@/charts\";\nimport { getPossibleFiltersQueryVariables } from \"@/charts/shared/possible-filters\";\nimport {\n  ConfiguratorState,\n  ConfiguratorStateConfiguringChart,\n  DataSource,\n  decodeConfiguratorState,\n} from \"@/config-types\";\nimport { SELECTING_DATASET_STATE } from \"@/configurator/configurator-state/initial\";\nimport { executeDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport {\n  DataCubePreviewDocument,\n  DataCubePreviewQuery,\n  DataCubePreviewQueryVariables,\n  PossibleFiltersDocument,\n  PossibleFiltersQuery,\n  PossibleFiltersQueryVariables,\n} from \"@/graphql/query-hooks\";\nimport { fetchChartConfig } from \"@/utils/chart-config/api\";\nimport {\n  getLatestCubeIri,\n  upgradeConfiguratorState,\n} from \"@/utils/chart-config/upgrade-cube\";\nimport { migrateConfiguratorState } from \"@/utils/chart-config/versioning\";\n\nimport { getLocalStorageKey } from \"./local-storage\";\nimport { deriveFiltersFromFields, transitionStepNext } from \"./reducer\";\n\nimport {\n  getFiltersByMappingStatus,\n  getStateWithCurrentDataSource,\n} from \"./index\";\n\nexport const initChartStateFromCube = async (\n  client: Client,\n  cubeIri: string,\n  dataSource: DataSource,\n  locale: string\n): Promise<ConfiguratorState | undefined> => {\n  const latestCubeIri =\n    await // Technically we already have most recent iri assured by useRedirectToLatestCube, but\n    // just to be extra sure, we fetch it again here.\n    getLatestCubeIri(cubeIri, {\n      client,\n      dataSource,\n    });\n\n  const { data: dataCubePreview } = await client\n    .query<DataCubePreviewQuery, DataCubePreviewQueryVariables>(\n      DataCubePreviewDocument,\n      {\n        sourceType: dataSource.type,\n        sourceUrl: dataSource.url,\n        locale,\n        cubeFilter: { iri: cubeIri },\n      }\n    )\n    .toPromise();\n\n  const previewDimensions = dataCubePreview?.dataCubePreview.dimensions ?? [];\n  const previewMeasures = dataCubePreview?.dataCubePreview.measures ?? [];\n  const componentIds = previewDimensions.some((d) => !d.isKeyDimension)\n    ? [\n        ...previewDimensions.filter((d) => d.isKeyDimension).map((d) => d.id),\n        ...previewMeasures.map((d) => d.id),\n      ]\n    : // As the query with undefined component ids is also used in other parts of the app,\n      // we want to benefit from the cache and not refetch the data if we already have it.\n      undefined;\n\n  const { data: components } = await executeDataCubesComponentsQuery(client, {\n    sourceType: dataSource.type,\n    sourceUrl: dataSource.url,\n    locale,\n    cubeFilters: [\n      {\n        iri: latestCubeIri,\n        componentIds,\n        loadValues: true,\n      },\n    ],\n  });\n\n  if (!components?.dataCubesComponents) {\n    throw Error(`Could not fetch components for ${latestCubeIri}!`);\n  }\n\n  const { dimensions, measures } = components.dataCubesComponents;\n  const { enabledChartTypes } = getEnabledChartTypes({\n    dimensions,\n    measures,\n    cubeCount: 1,\n  });\n  const initialChartConfig = getInitialConfig({\n    chartType: enabledChartTypes[0],\n    iris: [{ iri: latestCubeIri }],\n    dimensions,\n    measures,\n  });\n  const temporaryChartConfig = deriveFiltersFromFields(initialChartConfig, {\n    dimensions,\n  });\n  const { unmappedFilters } = getFiltersByMappingStatus(temporaryChartConfig, {\n    cubeIri: latestCubeIri,\n  });\n  const shouldFetchPossibleFilters = Object.keys(unmappedFilters).length > 0;\n  const variables = getPossibleFiltersQueryVariables({\n    cubeIri: latestCubeIri,\n    dataSource,\n    unmappedFilters,\n  });\n  const { data: possibleFilters } = await client\n    .query<\n      PossibleFiltersQuery,\n      PossibleFiltersQueryVariables\n    >(PossibleFiltersDocument, variables, { pause: !shouldFetchPossibleFilters })\n    .toPromise();\n\n  if (!possibleFilters?.possibleFilters && shouldFetchPossibleFilters) {\n    throw Error(`Could not fetch possible filters for ${latestCubeIri}!`);\n  }\n\n  const chartConfig = deriveFiltersFromFields(initialChartConfig, {\n    dimensions,\n    possibleFilters: possibleFilters?.possibleFilters,\n  });\n\n  return transitionStepNext(\n    getStateWithCurrentDataSource(SELECTING_DATASET_STATE),\n    { chartConfig }\n  );\n};\n\n/**\n * Tries to parse state from localStorage.\n * If state is invalid, it is removed from localStorage.\n */\nexport const initChartStateFromLocalStorage = async (\n  client: Client,\n  chartId: string\n): Promise<ConfiguratorState | undefined> => {\n  const storedState = window.localStorage.getItem(getLocalStorageKey(chartId));\n\n  if (!storedState) {\n    return;\n  }\n\n  let state: ConfiguratorState | undefined;\n  try {\n    const rawState = JSON.parse(storedState);\n    const migratedState = await migrateConfiguratorState(rawState);\n    state = decodeConfiguratorState(migratedState);\n  } catch (e) {\n    console.error(\"Error while parsing stored state\", e);\n  }\n\n  if (state) {\n    return upgradeConfiguratorState(state, {\n      client,\n      dataSource: state.dataSource,\n    });\n  }\n\n  console.warn(\n    \"Attempted to restore invalid state. Removing from localStorage.\",\n    state\n  );\n  window.localStorage.removeItem(getLocalStorageKey(chartId));\n};\n\nexport const initChartStateFromChartCopy = async (\n  client: Client,\n  fromChartId: string\n): Promise<ConfiguratorStateConfiguringChart | undefined> => {\n  const config = await fetchChartConfig(fromChartId);\n\n  if (config?.data) {\n    // Do not keep the previous chart key\n    delete config.data.key;\n    const state = (await migrateConfiguratorState({\n      ...config.data,\n      state: \"CONFIGURING_CHART\",\n    })) as ConfiguratorStateConfiguringChart;\n    return await upgradeConfiguratorState(state, {\n      client,\n      dataSource: state.dataSource,\n    });\n  }\n};\n\nexport const initChartStateFromChartEdit = async (\n  client: Client,\n  fromChartId: string,\n  state?: string\n): Promise<ConfiguratorStateConfiguringChart | undefined> => {\n  const config = await fetchChartConfig(fromChartId);\n\n  if (config?.data) {\n    const configState = (await migrateConfiguratorState({\n      ...config.data,\n      state: state ?? \"CONFIGURING_CHART\",\n    })) as ConfiguratorStateConfiguringChart;\n    return await upgradeConfiguratorState(configState, {\n      client,\n      dataSource: configState.dataSource,\n    });\n  }\n};\n","import { ParsedUrlQuery } from \"querystring\";\n\nimport { PUBLISHED_STATE } from \"@prisma/client\";\nimport { NextRouter, useRouter } from \"next/router\";\nimport {\n  createContext,\n  Dispatch,\n  PropsWithChildren,\n  useContext,\n  useEffect,\n  useMemo,\n} from \"react\";\nimport { Client, useClient } from \"urql\";\nimport { useImmerReducer } from \"use-immer\";\n\nimport {\n  ChartConfig,\n  ConfiguratorState,\n  ConfiguratorStatePublishing,\n} from \"@/config-types\";\nimport { ConfiguratorStateAction } from \"@/configurator/configurator-state/actions\";\nimport {\n  initChartStateFromChartCopy,\n  initChartStateFromChartEdit,\n  initChartStateFromCube,\n  initChartStateFromLocalStorage,\n} from \"@/configurator/configurator-state/init\";\nimport { INITIAL_STATE } from \"@/configurator/configurator-state/initial\";\nimport { saveChartLocally } from \"@/configurator/configurator-state/local-storage\";\nimport { reducer } from \"@/configurator/configurator-state/reducer\";\nimport { ParsedConfig } from \"@/db/config\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useUser } from \"@/login/utils\";\nimport { useDataSourceStore } from \"@/stores/data-source\";\nimport {\n  createConfig,\n  fetchChartConfig,\n  updateConfig,\n} from \"@/utils/chart-config/api\";\nimport { createId } from \"@/utils/create-id\";\nimport { getRouterChartId } from \"@/utils/router/helpers\";\n\nconst ConfiguratorStateContext = createContext<\n  [ConfiguratorState, Dispatch<ConfiguratorStateAction>] | undefined\n>(undefined);\n\ntype ConfiguratorStateProviderProps = PropsWithChildren<{\n  chartId: string;\n  initialState?: ConfiguratorState;\n  allowDefaultRedirect?: boolean;\n}>;\n\nexport const ConfiguratorStateProvider = (\n  props: ConfiguratorStateProviderProps\n) => {\n  return (\n    <ConfiguratorStateProviderInternal\n      // Ensure that the state is reset by using the `chartId` as `key`\n      key={props.chartId}\n      {...props}\n    />\n  );\n};\n\nexport const useConfiguratorState = <T extends ConfiguratorState>(\n  predicate?: (s: ConfiguratorState) => s is T\n) => {\n  const ctx = useContext(ConfiguratorStateContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need an <ConfiguratorStateProvider> to useConfiguratorState\"\n    );\n  }\n\n  const [state, dispatch] = ctx;\n\n  if (predicate && !predicate(state)) {\n    throw Error(\"State does not respect type guard\");\n  }\n\n  return [state, dispatch] as [T, typeof dispatch];\n};\n\nexport const useReadOnlyConfiguratorState = <T extends ConfiguratorState>(\n  predicate?: (s: ConfiguratorState) => s is T\n) => {\n  const ctx = useContext(ConfiguratorStateContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need an <ConfiguratorStateProvider> to useConfiguratorState\"\n    );\n  }\n\n  const [state] = ctx;\n\n  if (predicate && !predicate(state)) {\n    throw Error(\"State does not respect type guard\");\n  }\n\n  return state as T;\n};\n\nconst preparePublishingState = (\n  state: ConfiguratorStatePublishing,\n  chartConfigs: ChartConfig[],\n  activeChartKey?: string\n): ConfiguratorStatePublishing => {\n  return {\n    ...state,\n    chartConfigs: [\n      ...chartConfigs.map((chartConfig) => {\n        return {\n          ...chartConfig,\n          cubes: chartConfig.cubes.map((cube) => {\n            return {\n              ...cube,\n              // Ensure that the filters are in the correct order, as JSON\n              // does not guarantee order (and we need this as interactive\n              // filters are dependent on the order of the filters).\n              filters: Object.fromEntries(\n                Object.entries(cube.filters).map(([k, v], i) => {\n                  return [k, { ...v, position: i }];\n                })\n              ),\n            };\n          }),\n        };\n      }),\n    ],\n    // Technically, we do not need to store the active chart key, as\n    // it's only used in the edit mode, but it makes it easier to manage\n    // the state when retrieving the chart from the database. Potentially,\n    // it might also be useful for other things in the future (e.g. when we\n    // have multiple charts in the \"stepper mode\", and we'd like to start\n    // the story from a specific point and e.g. toggle back and forth between\n    // the different charts).\n    activeChartKey: activeChartKey ?? state.chartConfigs[0].key,\n  };\n};\n\nconst handlePublishSuccess = async (\n  chartId: string,\n  push: NextRouter[\"push\"]\n) => {\n  /**\n   * EXPERIMENTAL: Post back created chart ID to opener and close window.\n   *\n   * This allows the chart creation workflow to be integrated with other tools like a CMS\n   */\n\n  // FIXME: Check for more than just opener?\n  const opener = window.opener;\n  if (opener) {\n    opener.postMessage(`CHART_ID:${chartId}`, \"*\");\n    window.close();\n    return;\n  }\n\n  await push({\n    pathname: `/v/${chartId}`,\n    query: { publishSuccess: true },\n  });\n};\n\nasync function initializeChartState(\n  chartId: string,\n  query: ParsedUrlQuery,\n  client: Client,\n  dataSource: { type: \"sql\" | \"sparql\"; url: string },\n  locale: string\n) {\n  if (chartId === \"new\") {\n    if (query.copy && typeof query.copy === \"string\") {\n      return initChartStateFromChartCopy(client, query.copy);\n    } else if (query.edit && typeof query.edit === \"string\") {\n      return initChartStateFromChartEdit(\n        client,\n        query.edit,\n        typeof query.state === \"string\" ? query.state : undefined\n      );\n    } else if (query.cube && typeof query.cube === \"string\") {\n      return initChartStateFromCube(client, query.cube, dataSource, locale);\n    }\n  } else if (chartId !== \"published\") {\n    return initChartStateFromLocalStorage(client, chartId);\n  }\n}\n\nexport async function publishState(\n  user: ReturnType<typeof useUser>,\n  key: string,\n  state: Extract<ConfiguratorState, { state: \"PUBLISHING\" }>,\n\n  /** Will be called for all configs that have been shared (multiple ones in case of layout:singleURLs) */\n  onSaveConfig: (savedConfig: { key: string }, i: number, total: number) => void\n) {\n  switch (state.layout.type) {\n    case \"singleURLs\":\n      const { publishableChartKeys, meta, blocks } = state.layout;\n      const reversedChartKeys = publishableChartKeys.slice().reverse();\n\n      // Charts are published in order, keep the current tab open with first chart\n      // subSequent charts are opened in a new window\n      return allSequential(reversedChartKeys, async (chartKey, i) => {\n        const preparedConfig = preparePublishingState(\n          {\n            ...state,\n            // Ensure that the layout is reset to single-chart mode\n            layout: {\n              type: \"tab\",\n              meta,\n              blocks,\n              activeField: undefined,\n            },\n          },\n          state.chartConfigs.filter((d) => d.key === chartKey) as ChartConfig[],\n          chartKey\n        );\n\n        const result = await createConfig({\n          data: preparedConfig,\n          published_state: PUBLISHED_STATE.PUBLISHED,\n        });\n        onSaveConfig(result, i + 1, reversedChartKeys.length);\n\n        return result;\n      });\n    default:\n      let dbConfig: ParsedConfig | undefined;\n\n      if (key && user) {\n        const config = await fetchChartConfig(key);\n\n        if (config && config.user_id === user.id) {\n          dbConfig = config;\n        }\n      }\n\n      const preparedConfig = preparePublishingState(state, state.chartConfigs);\n\n      const result = await (dbConfig && user\n        ? updateConfig({\n            data: preparedConfig,\n            key: dbConfig.key,\n            published_state: PUBLISHED_STATE.PUBLISHED,\n          })\n        : createConfig({\n            data: preparedConfig,\n            published_state: PUBLISHED_STATE.PUBLISHED,\n          }));\n\n      onSaveConfig(result, 0, 1);\n      return result;\n  }\n}\n\nconst allSequential = async <TInput, TOutput>(\n  input: TInput[],\n  cb: (item: TInput, i: number) => TOutput\n) => {\n  const res = [];\n  for (let i = 0; i < input.length; i++) {\n    const r = input[i];\n    const result = await cb(r, i);\n    res.push(result);\n  }\n  return res;\n};\n\nconst ConfiguratorStateProviderInternal = (\n  props: ConfiguratorStateProviderProps\n) => {\n  const {\n    chartId,\n    initialState,\n    allowDefaultRedirect = true,\n    children,\n  } = props;\n  const { dataSource } = useDataSourceStore();\n  const initialStateWithDataSource = useMemo(() => {\n    return initialState ? initialState : { ...INITIAL_STATE, dataSource };\n  }, [initialState, dataSource]);\n  const locale = useLocale();\n  const stateAndDispatch = useImmerReducer(reducer, initialStateWithDataSource);\n  const [state, dispatch] = stateAndDispatch;\n  const { asPath, push, replace, query } = useRouter();\n  const user = useUser();\n  const client = useClient();\n\n  // Initialize state on page load.\n  useEffect(() => {\n    let stateToInitialize = initialStateWithDataSource;\n    const initialize = async () => {\n      try {\n        const newChartState = await initializeChartState(\n          chartId,\n          query,\n          client,\n          dataSource,\n          locale\n        );\n\n        if (!newChartState && allowDefaultRedirect && chartId !== \"published\") {\n          replace(`/create/new`);\n        }\n        stateToInitialize = newChartState ?? stateToInitialize;\n      } finally {\n        dispatch({ type: \"INITIALIZED\", value: stateToInitialize });\n      }\n    };\n\n    initialize();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (state.state === \"INITIAL\" || state.state === \"SELECTING_DATASET\") {\n      dispatch({ type: \"DATASOURCE_CHANGED\", value: dataSource });\n    }\n  }, [dataSource, dispatch, state.state]);\n\n  useEffect(() => {\n    try {\n      switch (state.state) {\n        case \"CONFIGURING_CHART\":\n        case \"LAYOUTING\":\n          const savedChartId =\n            chartId === \"new\"\n              ? query.edit && typeof query.edit === \"string\"\n                ? query.edit\n                : createId()\n              : chartId;\n          if (chartId === \"new\") {\n            replace(`/create/${savedChartId}`);\n          }\n          saveChartLocally(savedChartId, state);\n          return;\n\n        case \"PUBLISHING\":\n          (async () => {\n            try {\n              const key = getRouterChartId(asPath);\n\n              if (!key) {\n                return;\n              }\n\n              return publishState(\n                user,\n                key,\n                state,\n                async (result, i, total) => {\n                  if (state.layout.type === \"singleURLs\" && i < total) {\n                    // Open new tab for each chart, except the first one\n                    return window.open(`/${locale}/v/${result.key}`, \"_blank\");\n                  }\n\n                  await handlePublishSuccess(result.key, push);\n                }\n              );\n            } catch (e) {\n              console.error(e);\n              dispatch({ type: \"PUBLISH_FAILED\" });\n            }\n          })();\n\n          return;\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }, [\n    state,\n    dispatch,\n    chartId,\n    push,\n    asPath,\n    locale,\n    query.from,\n    replace,\n    user,\n    query.edit,\n  ]);\n\n  return (\n    <ConfiguratorStateContext.Provider value={stateAndDispatch}>\n      {children}\n    </ConfiguratorStateContext.Provider>\n  );\n};\n","import produce, { current } from \"immer\";\nimport get from \"lodash/get\";\nimport pickBy from \"lodash/pickBy\";\nimport set from \"lodash/set\";\n\nimport { getEnabledChartTypes, getInitialConfig } from \"@/charts\";\nimport { getChartSpec } from \"@/charts/chart-config-ui-options\";\nimport {\n  ChartConfig,\n  ConfiguratorState,\n  ConfiguratorStateConfiguringChart,\n  ConfiguratorStateLayouting,\n  ConfiguratorStatePublished,\n  ConfiguratorStatePublishing,\n  enableLayouting,\n  FilterValue,\n  GenericField,\n  isColorFieldInConfig,\n} from \"@/config-types\";\nimport {\n  extractSingleFilters,\n  getChartConfig,\n  getChartConfigFilters,\n  isSingleFilters,\n} from \"@/config-utils\";\nimport { getInitialConfiguringConfigBasedOnCube } from \"@/configurator/configurator-state/initial\";\nimport { deriveFiltersFromFields } from \"@/configurator/configurator-state/reducer\";\nimport { Dimension, ObservationValue } from \"@/domain/data\";\nimport { DEFAULT_DATA_SOURCE } from \"@/domain/data-source\";\nimport { mkJoinById, VersionedJoinBy } from \"@/graphql/join\";\nimport { Locale } from \"@/locales/locales\";\nimport { getDataSourceFromLocalStorage } from \"@/stores/data-source\";\nimport { getCachedComponents } from \"@/urql-cache\";\n\nimport { ConfiguratorStateAction } from \"./actions\";\n\nexport {\n  ConfiguratorStateProvider,\n  useConfiguratorState,\n  useReadOnlyConfiguratorState,\n} from \"./context\";\nexport { initChartStateFromChartEdit, initChartStateFromCube } from \"./init\";\nexport { saveChartLocally } from \"./local-storage\";\n\nexport type GetConfiguratorStateAction<\n  T extends ConfiguratorStateAction[\"type\"],\n> = Extract<ConfiguratorStateAction, { type: T }>;\n\nexport const getStateWithCurrentDataSource = (state: ConfiguratorState) => {\n  const dataSource = getDataSourceFromLocalStorage();\n\n  return {\n    ...state,\n    dataSource: dataSource ?? DEFAULT_DATA_SOURCE,\n  };\n};\n\nexport const getPreviousState = (\n  draft: ConfiguratorState\n): Exclude<ConfiguratorState[\"state\"], \"INITIAL\" | \"PUBLISHING\"> => {\n  switch (draft.state) {\n    case \"SELECTING_DATASET\":\n      return draft.state;\n    case \"CONFIGURING_CHART\":\n      return \"SELECTING_DATASET\";\n    case \"LAYOUTING\":\n      return \"CONFIGURING_CHART\";\n    case \"PUBLISHING\":\n      if (enableLayouting(draft)) {\n        return \"LAYOUTING\";\n      }\n\n      return \"CONFIGURING_CHART\";\n    default:\n      return \"SELECTING_DATASET\";\n  }\n};\n// FIXME: should by handled better, as color is a subfield and not actual field.\n// Side effects in ui encodings?\nconst getNonGenericFieldValues = (chartConfig: ChartConfig): string[] => {\n  const ids: string[] = [];\n\n  if (isColorFieldInConfig(chartConfig)) {\n    if (chartConfig.fields.areaLayer?.color.type === \"categorical\") {\n      ids.push(chartConfig.fields.areaLayer.color.componentId);\n    }\n\n    if (chartConfig.fields.symbolLayer?.color.type === \"categorical\") {\n      ids.push(chartConfig.fields.symbolLayer.color.componentId);\n    }\n  }\n\n  return ids;\n};\n\n/** Get all filters by mapping status.\n *\n * We need to handle some fields differently due to the way the chart config\n * is structured at the moment (MapColorField) is a subfield of areaLayer and\n * symbolLayer fields.\n */\nexport const getFiltersByMappingStatus = (\n  chartConfig: ChartConfig,\n  options: {\n    /** Treat original iris of joinBy dimension as fields (currently joinBy dimension\n     * can only be mapped to a field).\n     *\n     * This ensures that we won't apply single filters to original joinBy dimensions.\n     *  */\n    joinByIds?: string[];\n    cubeIri?: string;\n  }\n) => {\n  const { joinByIds, cubeIri } = options;\n  const genericFieldValues = Object.values<GenericField>(\n    // @ts-ignore - we are only interested in component ids\n    chartConfig.fields\n  ).map((d) => d.componentId);\n  const nonGenericFieldValues = getNonGenericFieldValues(chartConfig);\n  const ids = new Set([\n    ...genericFieldValues,\n    ...nonGenericFieldValues,\n    ...(joinByIds ?? []),\n  ]);\n  const filters = getChartConfigFilters(chartConfig.cubes, { cubeIri });\n  const mappedFilters = pickBy(filters, (_, id) => ids.has(id));\n  const unmappedFilters = pickBy(filters, (_, id) => !ids.has(id));\n\n  if (!isSingleFilters(unmappedFilters)) {\n    console.warn(\"Unmapped filters must be single filters!\");\n  }\n\n  return {\n    mappedFilters,\n    mappedFiltersIds: ids,\n    unmappedFilters: extractSingleFilters(unmappedFilters),\n  };\n};\n\nexport const getChartOptionField = (\n  state: ConfiguratorStateConfiguringChart,\n  field: string | null,\n  path: string,\n  defaultValue: string | boolean = \"\"\n) => {\n  const chartConfig = getChartConfig(state);\n\n  return get(\n    chartConfig,\n    field === null ? path : `fields[\"${field}\"].${path}`,\n    defaultValue\n  );\n};\n\nexport const getFilterValue = (\n  state: ConfiguratorState,\n  dimension: Dimension\n): FilterValue | undefined => {\n  if (state.state === \"INITIAL\" || state.state === \"SELECTING_DATASET\") {\n    return;\n  }\n\n  const chartConfig = getChartConfig(state);\n  const filters = getChartConfigFilters(chartConfig.cubes, { joined: true });\n\n  return filters[dimension.id];\n};\n\nexport const moveFilterField = produce(\n  (\n    chartConfig: ChartConfig,\n    {\n      dimension,\n      delta,\n      possibleValues,\n    }: {\n      dimension: Dimension;\n      delta: number;\n      possibleValues: ObservationValue[];\n    }\n  ) => {\n    const cube = chartConfig.cubes.find(\n      (cube) => cube.iri === dimension.cubeIri\n    );\n\n    if (!cube) {\n      return;\n    }\n\n    // Use getOwnPropertyNames instead of keys since the spec ensures that\n    // the order of the keys received is in insertion order\n    // https://262.ecma-international.org/6.0/#sec-ordinary-object-internal-methods-and-internal-slots-ownpropertykeys\n    const keys = Object.getOwnPropertyNames(cube.filters);\n    const fieldIndex = Object.keys(cube.filters).indexOf(dimension.id);\n\n    if (fieldIndex === 0 && delta === -1) {\n      return;\n    }\n\n    if (fieldIndex === keys.length - 1 && delta === 1) {\n      return;\n    }\n\n    if (fieldIndex === -1 && delta !== -1) {\n      return;\n    }\n\n    const replacedIndex =\n      fieldIndex === -1 ? keys.length - 1 : fieldIndex + delta;\n    const replaced = keys[replacedIndex];\n    keys[replacedIndex] = dimension.id;\n\n    if (fieldIndex === -1) {\n      keys.push(replaced);\n    } else {\n      keys[fieldIndex] = replaced;\n    }\n\n    cube.filters = Object.fromEntries(\n      keys.map((k) => [\n        k,\n        cube.filters[k] ?? { type: \"single\", value: possibleValues[0] },\n      ])\n    );\n  }\n);\n\nexport const isConfiguring = (\n  s: ConfiguratorState\n): s is ConfiguratorStateConfiguringChart => {\n  return s.state === \"CONFIGURING_CHART\";\n};\n\nexport const isLayouting = (\n  s: ConfiguratorState\n): s is ConfiguratorStateLayouting => {\n  return s.state === \"LAYOUTING\";\n};\n\nexport const isLayoutingFreeCanvas = (\n  s: ConfiguratorStateWithChartConfigs\n): s is ConfiguratorStateLayouting => {\n  return (\n    !isConfiguring(s) &&\n    s.layout.type === \"dashboard\" &&\n    s.layout.layout === \"canvas\"\n  );\n};\n\nexport const isPublishing = (\n  s: ConfiguratorState\n): s is ConfiguratorStatePublishing => {\n  return s.state === \"PUBLISHING\";\n};\n\nexport const isPublished = (\n  s: ConfiguratorState\n): s is ConfiguratorStatePublished => {\n  return s.state === \"PUBLISHED\";\n};\n\nexport const hasChartConfigs = (\n  s: ConfiguratorState\n): s is ConfiguratorStateWithChartConfigs => {\n  return \"chartConfigs\" in s;\n};\n\nexport type ConfiguratorStateWithChartConfigs = Extract<\n  ConfiguratorState,\n  { chartConfigs: ChartConfig[] }\n>;\n\nexport const addDatasetInConfig = function (\n  config: ConfiguratorStateConfiguringChart,\n  options: {\n    iri: string;\n    joinBy: VersionedJoinBy;\n  }\n) {\n  const chartConfig = getChartConfig(config, config.activeChartKey);\n  const { iri, joinBy } = options;\n\n  // Set new join by in existing cubes\n  for (let i = 0; i < chartConfig.cubes.length; i++) {\n    const cubeJoinBy = joinBy[chartConfig.cubes[i].iri];\n    chartConfig.cubes[i].joinBy = cubeJoinBy;\n  }\n  chartConfig.cubes.push({\n    iri,\n    joinBy: joinBy[iri],\n    filters: {},\n  });\n\n  // Need to go over fields, and replace any IRI part of the joinBy by \"joinBy__<index>\"\n  const { encodings } = getChartSpec(chartConfig);\n  const encodingAndFields = encodings.map(\n    (e) =>\n      [\n        e,\n        chartConfig.fields[e.field as keyof typeof chartConfig.fields] as any,\n      ] as const\n  );\n  for (const [encoding, field] of encodingAndFields) {\n    if (!field) {\n      continue;\n    }\n    for (const idAttribute of encoding.idAttributes) {\n      const value = get(field, idAttribute);\n      const joinByIris = Object.keys(joinBy);\n      const index = (() => {\n        for (const iri of joinByIris) {\n          const index = joinBy[iri].indexOf(value);\n          if (index > -1) {\n            return index;\n          }\n        }\n        return undefined;\n      })();\n      if (index !== undefined && index > -1) {\n        set(field, idAttribute, mkJoinById(index));\n      }\n    }\n  }\n};\n\nexport const removeDatasetInConfig = function (\n  draft: ConfiguratorStateConfiguringChart,\n  options: {\n    iri: string;\n    locale: Locale;\n  }\n) {\n  const { locale, iri: removedCubeIri } = options;\n  const chartConfig = getChartConfig(draft);\n  const newCubes = chartConfig.cubes.filter((c) => c.iri !== removedCubeIri);\n  const dataCubesComponents = getCachedComponents({\n    locale,\n    dataSource: draft.dataSource,\n    cubeFilters: newCubes.map((cube) => ({\n      iri: cube.iri,\n      joinBy: newCubes.length > 1 ? cube.joinBy : undefined,\n    })),\n  });\n\n  if (!dataCubesComponents) {\n    throw Error(\n      \"Error while removing dataset: Could not find cached dataCubesComponents\"\n    );\n  }\n\n  const { dimensions, measures } = dataCubesComponents;\n  const remainingCubeIris = chartConfig.cubes\n    .filter((c) => c.iri !== removedCubeIri)\n    .map(({ iri }) => ({ iri }));\n  const { enabledChartTypes } = getEnabledChartTypes({\n    dimensions,\n    measures,\n    cubeCount: remainingCubeIris.length,\n  });\n  const initialConfig = getInitialConfig({\n    chartType: enabledChartTypes.includes(chartConfig.chartType)\n      ? chartConfig.chartType\n      : enabledChartTypes[0],\n    iris: remainingCubeIris,\n    dimensions,\n    measures,\n    meta: current(chartConfig.meta),\n  });\n  const newChartConfig = deriveFiltersFromFields(initialConfig, {\n    dimensions,\n  });\n  const initConfig = getInitialConfiguringConfigBasedOnCube({\n    dataSource: draft.dataSource,\n    chartConfig: newChartConfig,\n  });\n  const newConfig = {\n    ...initConfig.chartConfigs[0],\n    key: chartConfig.key,\n  } as ChartConfig;\n  const index = draft.chartConfigs.findIndex((d) => d.key === chartConfig.key);\n  const withFilters = deriveFiltersFromFields(newConfig, { dimensions });\n\n  // Re-put the join by inside the cubes\n  const joinByByCubes = Object.fromEntries(\n    chartConfig.cubes.map((cube) => [cube.iri, cube.joinBy] as const)\n  );\n\n  for (const cube of withFilters.cubes) {\n    const joinBy = joinByByCubes[cube.iri];\n    if (joinBy) {\n      // TODO Should there be dimensions in the joinBy that should be removed ?\n      cube.joinBy = joinBy;\n    }\n  }\n\n  draft.chartConfigs[index] = withFilters;\n\n  return draft;\n};\n","import { CircularProgress } from \"@mui/material\";\nimport dynamic from \"next/dynamic\";\nimport { Suspense } from \"react\";\n\nimport { useFlag } from \"@/flags\";\n\nimport { DebugPanelProps } from \"./debug-panel\";\n\nconst LazyDebugPanel = dynamic(\n  () => import(\"./debug-panel\").then((mod) => mod.DebugPanel),\n  { ssr: false }\n);\n\nexport const DebugPanel = (props: DebugPanelProps) => {\n  const flagActive = useFlag(\"debug\");\n  const show = flagActive ?? process.env.NODE_ENV === \"development\";\n\n  if (!show) {\n    return null;\n  }\n\n  return (\n    <Suspense fallback={<CircularProgress />}>\n      <LazyDebugPanel {...props} />\n    </Suspense>\n  );\n};\n","import { Modifier } from \"@dnd-kit/core\";\nimport { getEventCoordinates } from \"@dnd-kit/utilities\";\n\ntype SnapToCursorOptions = {\n  xOffset?: number;\n};\n\nexport const createSnapCornerToCursor = (\n  options: SnapToCursorOptions\n): Modifier => {\n  const { xOffset = 0 } = options;\n  return (props) => {\n    const { transform, activeNodeRect, activatorEvent } = props;\n\n    if (activatorEvent) {\n      const activatorCoordinates = getEventCoordinates(activatorEvent);\n\n      if (!activatorCoordinates || !activeNodeRect) {\n        return transform;\n      }\n\n      return {\n        ...transform,\n        x: transform.x + activeNodeRect.width + xOffset,\n        y: transform.y,\n      };\n    }\n\n    return transform;\n  };\n};\n","import {\n  DndContext,\n  DragOverlay,\n  Over,\n  pointerWithin,\n  useDraggable,\n  useDroppable,\n} from \"@dnd-kit/core\";\nimport { Trans } from \"@lingui/macro\";\nimport { Box, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport Head from \"next/head\";\nimport {\n  forwardRef,\n  ReactNode,\n  useCallback,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { LoadingStateProvider } from \"@/charts/shared/chart-loading-state\";\nimport { ActionElementsContainer } from \"@/components/action-elements-container\";\nimport { ChartDataTablePreview } from \"@/components/chart-data-table-preview/ui\";\nimport { ChartErrorBoundary } from \"@/components/chart-error-boundary\";\nimport { ChartFootnotes } from \"@/components/chart-footnotes\";\nimport {\n  ChartPanelLayout,\n  ChartWrapper,\n  ChartWrapperProps,\n} from \"@/components/chart-panel\";\nimport {\n  ChartControls,\n  ChartMoreButton,\n  useChartStyles,\n} from \"@/components/chart-shared\";\nimport {\n  ChartTablePreviewProvider,\n  ChartTablePreviewWrapper,\n  useChartTablePreview,\n} from \"@/components/chart-table-preview\";\nimport { ChartWithFilters } from \"@/components/chart-with-filters\";\nimport { DashboardInteractiveFilters } from \"@/components/dashboard-interactive-filters\";\nimport { DebugPanel } from \"@/components/debug-panel\";\nimport { DragHandle, useDragOverClasses } from \"@/components/drag-handle\";\nimport { Flex } from \"@/components/flex\";\nimport { Checkbox } from \"@/components/form\";\nimport { HEADER_HEIGHT_CSS_VAR } from \"@/components/header-constants\";\nimport { HintWarning } from \"@/components/hint\";\nimport {\n  createMetadataPanelStore,\n  MetadataPanelStoreContext,\n} from \"@/components/metadata-panel-store\";\nimport {\n  DndTextBlock,\n  renderBaseTextBlock,\n  TextBlock,\n} from \"@/components/text-block\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ChartConfig,\n  DataSource,\n  hasChartConfigs,\n  isConfiguring,\n  Layout,\n  LayoutBlock,\n  LayoutTextBlock,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport { Description, Title } from \"@/configurator/components/annotators\";\nimport {\n  useDataCubesComponentsQuery,\n  useDataCubesMetadataQuery,\n} from \"@/graphql/hooks\";\nimport { DataCubePublicationStatus } from \"@/graphql/resolver-types\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { InteractiveFiltersChartProvider } from \"@/stores/interactive-filters\";\nimport { useTransitionStore } from \"@/stores/transition\";\nimport { useTheme } from \"@/themes\";\nimport { createSnapCornerToCursor } from \"@/utils/dnd\";\nimport { DISABLE_SCREENSHOT_ATTR_KEY } from \"@/utils/use-screenshot\";\n\nexport const ChartPreview = ({ dataSource }: { dataSource: DataSource }) => {\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const editing = isConfiguring(state);\n  const { layout } = state;\n  const metadataPanelStore = useMemo(() => {\n    return createMetadataPanelStore();\n  }, []);\n\n  return (\n    <MetadataPanelStoreContext.Provider value={metadataPanelStore}>\n      {layout.type === \"dashboard\" && !editing ? (\n        <DashboardPreview dataSource={dataSource} layoutType={layout.layout} />\n      ) : layout.type === \"singleURLs\" && !editing ? (\n        <SingleURLsPreview dataSource={dataSource} layout={layout} />\n      ) : (\n        // Important to keep the key here to force re-rendering of the chart when\n        // we switch tabs in the configurator, otherwise we end up with the wrong\n        // data in the downstream hooks (useDataCubesMetadataQuery, etc.)\n        <>\n          {!isConfiguring(state) ? (\n            <DashboardInteractiveFilters\n              key={state.chartConfigs.map((x) => x.key).join(\",\")}\n              sx={{ mb: 4 }}\n            />\n          ) : null}\n          <ChartTablePreviewProvider key={state.activeChartKey}>\n            <ChartWrapper\n              editing={editing}\n              layout={layout}\n              chartKey={state.activeChartKey}\n            >\n              <ChartPreviewInner dataSource={dataSource} />\n            </ChartWrapper>\n          </ChartTablePreviewProvider>\n        </>\n      )}\n    </MetadataPanelStoreContext.Provider>\n  );\n};\n\nconst DRAG_OVERLAY_WIDTH = 400;\nconst snapCornerToCursor = createSnapCornerToCursor({\n  xOffset: -DRAG_OVERLAY_WIDTH,\n});\n\nconst useStyles = makeStyles<Theme>(() => ({\n  canvasChartPanelLayout: {\n    // Provide some space at the bottom of the canvas layout to make it possible\n    // to resize vertically the last charts\n    paddingBottom: \"10rem\",\n  },\n}));\n\nconst DashboardPreview = ({\n  dataSource,\n  layoutType,\n  editing,\n}: {\n  dataSource: DataSource;\n  layoutType: Extract<Layout, { type: \"dashboard\" }>[\"layout\"];\n  editing?: boolean;\n}) => {\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const theme = useTheme();\n  const transition = useTransitionStore();\n  const [isDragging, setIsDragging] = useState(false);\n  const [activeBlock, setActiveBlock] = useState<LayoutBlock | null>(null);\n  const [over, setOver] = useState<Over | null>(null);\n  const classes = useStyles();\n  const renderChart = useCallback(\n    (chartConfig: ChartConfig) => {\n      return layoutType === \"canvas\" ? (\n        <ReactGridChartPreview\n          key={chartConfig.key}\n          chartKey={chartConfig.key}\n          dataSource={dataSource}\n          layout={state.layout}\n          editing={editing}\n        />\n      ) : (\n        <DndChartPreview\n          key={chartConfig.key}\n          chartKey={chartConfig.key}\n          dataSource={dataSource}\n          layout={state.layout}\n          editing={editing}\n        />\n      );\n    },\n    [dataSource, editing, layoutType, state.layout]\n  );\n  const renderTextBlock = useCallback(\n    (block: LayoutTextBlock) => {\n      return layoutType === \"canvas\" ? (\n        renderBaseTextBlock(block)\n      ) : (\n        <DndTextBlock block={block} />\n      );\n    },\n    [layoutType]\n  );\n  const renderBlock = useCallback(\n    (block: LayoutBlock) => {\n      switch (block.type) {\n        case \"chart\":\n          const chartConfig = state.chartConfigs.find(\n            (c) => c.key === block.key\n          ) as ChartConfig;\n          return renderChart(chartConfig);\n        case \"text\":\n          return renderTextBlock(block);\n        default:\n          const _exhaustiveCheck: never = block;\n          return _exhaustiveCheck;\n      }\n    },\n    [state.chartConfigs, renderChart, renderTextBlock]\n  );\n\n  if (layoutType === \"canvas\") {\n    return (\n      // Force re-rendering of the canvas layout when the chart configs change\n      // to properly initialize the height of the new charts\n      <div key={state.chartConfigs.map((c) => c.key).join(\",\")}>\n        <ChartPanelLayout\n          renderBlock={renderBlock}\n          layoutType={layoutType}\n          className={classes.canvasChartPanelLayout}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <DndContext\n      autoScroll={{ layoutShiftCompensation: false }}\n      collisionDetection={pointerWithin}\n      onDragStart={(e) => {\n        transition.setEnable(false);\n        setIsDragging(true);\n        const block = state.layout.blocks.find(\n          (b) => b.key === e.active.id\n        ) as LayoutBlock;\n        setActiveBlock(block);\n      }}\n      onDragMove={(e) => {\n        if (e.over?.id !== over?.id && e.over?.id !== activeBlock?.key) {\n          setOver(e.over);\n        }\n      }}\n      onDragEnd={(e) => {\n        transition.setEnable(true);\n        setIsDragging(false);\n        setActiveBlock(null);\n        setOver(null);\n\n        const { active, over } = e;\n\n        if (!active || !over) {\n          return;\n        }\n\n        dispatch({\n          type: \"LAYOUT_BLOCK_SWAP\",\n          value: {\n            oldIndex: state.layout.blocks.findIndex((b) => b.key === active.id),\n            newIndex: state.layout.blocks.findIndex((b) => b.key === over.id),\n          },\n        });\n      }}\n    >\n      <ChartPanelLayout renderBlock={renderBlock} layoutType={layoutType} />\n      {isDragging ? (\n        <DragOverlay\n          zIndex={1000}\n          modifiers={[snapCornerToCursor]}\n          style={{\n            opacity: over ? 0.8 : 1,\n            width: DRAG_OVERLAY_WIDTH,\n            height: \"fit-content\",\n            border: `2px solid ${\n              over ? theme.palette.primary.main : \"transparent\"\n            }`,\n            cursor: \"grabbing\",\n          }}\n        >\n          {activeBlock ? (\n            activeBlock.type === \"chart\" ? (\n              <ChartWrapper chartKey=\"dragged\">\n                <ChartPreviewInner\n                  dataSource={dataSource}\n                  chartKey={activeBlock.key}\n                  actionElementSlot={<DragHandle dragging />}\n                />\n              </ChartWrapper>\n            ) : (\n              <TextBlock block={activeBlock} />\n            )\n          ) : null}\n        </DragOverlay>\n      ) : null}\n    </DndContext>\n  );\n};\n\ntype CommonChartPreviewProps = ChartWrapperProps & {\n  chartKey: string;\n  dataSource: DataSource;\n};\n\nconst ReactGridChartPreview = forwardRef<\n  HTMLDivElement,\n  CommonChartPreviewProps\n>((props, ref) => {\n  const { children, chartKey, dataSource, ...rest } = props;\n  return (\n    <ChartTablePreviewProvider>\n      <ChartWrapper {...rest} ref={ref} chartKey={chartKey}>\n        <ChartPreviewInner\n          dataSource={dataSource}\n          chartKey={chartKey}\n          actionElementSlot={<DragHandle dragging />}\n        >\n          {children}\n        </ChartPreviewInner>\n      </ChartWrapper>\n    </ChartTablePreviewProvider>\n  );\n});\n\nconst DndChartPreview = (props: CommonChartPreviewProps) => {\n  const { children, className, chartKey, dataSource, ...rest } = props;\n  const {\n    setActivatorNodeRef,\n    setNodeRef: setDraggableNodeRef,\n    attributes,\n    listeners,\n    isDragging,\n  } = useDraggable({ id: chartKey });\n  const {\n    setNodeRef: setDroppableNodeRef,\n    isOver,\n    active,\n  } = useDroppable({ id: chartKey });\n  const setRef = useCallback(\n    (node: HTMLElement | null) => {\n      setDraggableNodeRef(node);\n      setDroppableNodeRef(node);\n    },\n    [setDraggableNodeRef, setDroppableNodeRef]\n  );\n  const dragOverClasses = useDragOverClasses({\n    isDragging,\n    isDragActive: !!active,\n    isDragOver: isOver,\n  });\n\n  return (\n    <ChartTablePreviewProvider>\n      <ChartWrapper\n        {...rest}\n        ref={setRef}\n        {...attributes}\n        chartKey={chartKey}\n        className={clsx(className, dragOverClasses.root)}\n        style={{\n          display: active ? \"flex\" : \"contents\",\n          flexDirection: \"column\",\n        }}\n      >\n        <ChartPreviewInner\n          dataSource={dataSource}\n          chartKey={chartKey}\n          actionElementSlot={\n            <DragHandle\n              ref={setActivatorNodeRef}\n              dragging={isDragging}\n              {...listeners}\n            />\n          }\n        />\n      </ChartWrapper>\n    </ChartTablePreviewProvider>\n  );\n};\n\nconst SingleURLsPreview = ({\n  dataSource,\n  layout,\n}: {\n  dataSource: DataSource;\n  layout: Extract<Layout, { type: \"singleURLs\" }>;\n}) => {\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const renderBlock = useCallback(\n    (block: LayoutBlock) => {\n      if (block.type !== \"chart\") {\n        return <></>;\n      }\n\n      const { key } = block;\n      const checked = layout.publishableChartKeys.includes(key);\n      const { publishableChartKeys: keys } = layout;\n\n      return (\n        <ChartTablePreviewProvider>\n          <ChartWrapper chartKey={key}>\n            <ChartPreviewInner\n              dataSource={dataSource}\n              chartKey={key}\n              actionElementSlot={\n                <Checkbox\n                  checked={checked}\n                  disabled={keys.length === 1 && checked}\n                  onChange={() => {\n                    dispatch({\n                      type: \"LAYOUT_CHANGED\",\n                      value: {\n                        ...layout,\n                        publishableChartKeys: checked\n                          ? keys.filter((k) => k !== key)\n                          : state.chartConfigs\n                              .map((c) => c.key)\n                              .filter((k) => keys.includes(k) || k === key),\n                      },\n                    });\n                  }}\n                  label=\"\"\n                />\n              }\n            />\n          </ChartWrapper>\n        </ChartTablePreviewProvider>\n      );\n    },\n    [dataSource, dispatch, layout, state.chartConfigs]\n  );\n\n  return <ChartPanelLayout layoutType=\"vertical\" renderBlock={renderBlock} />;\n};\n\nconst ChartPreviewInner = ({\n  children,\n  dataSource,\n  chartKey,\n  actionElementSlot,\n}: {\n  children?: ReactNode;\n  dataSource: DataSource;\n  chartKey?: string | null;\n  actionElementSlot?: ReactNode;\n}) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const [state, dispatch] = useConfiguratorState();\n  const configuring = isConfiguring(state);\n  const chartConfig = getChartConfig(state, chartKey);\n  const locale = useLocale();\n  const chartClasses = useChartStyles({ removeBorder: false });\n  const commonQueryVariables = {\n    sourceType: dataSource.type,\n    sourceUrl: dataSource.url,\n    locale,\n  };\n  const [{ data: metadata }] = useDataCubesMetadataQuery({\n    variables: {\n      ...commonQueryVariables,\n      cubeFilters: chartConfig.cubes.map((cube) => ({ iri: cube.iri })),\n    },\n  });\n  const componentIds = undefined;\n  const [{ data: components }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      ...commonQueryVariables,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        componentIds,\n        filters: cube.filters,\n        joinBy: cube.joinBy,\n      })),\n    },\n  });\n  const { isTable } = useChartTablePreview();\n  const dimensions = components?.dataCubesComponents.dimensions;\n  const measures = components?.dataCubesComponents.measures;\n  const allComponents = useMemo(() => {\n    if (!dimensions || !measures) {\n      return [];\n    }\n\n    return [...dimensions, ...measures];\n  }, [dimensions, measures]);\n\n  return (\n    <Box\n      ref={ref}\n      className={clsx(\n        chartClasses.root,\n        configuring ? chartClasses.editing : chartClasses.pastEditing\n      )}\n    >\n      {children}\n      <ChartErrorBoundary resetKeys={[state]}>\n        {hasChartConfigs(state) && (\n          <>\n            <Head>\n              <title key=\"title\">\n                {!chartConfig.meta.title[locale]\n                  ? // FIXME: adapt to design\n                    metadata?.dataCubesMetadata.map((d) => d.title).join(\", \")\n                  : chartConfig.meta.title[locale]}{\" \"}\n                - visualize.admin.ch\n              </title>\n            </Head>\n            <LoadingStateProvider>\n              <InteractiveFiltersChartProvider chartConfigKey={chartConfig.key}>\n                <Flex\n                  sx={{\n                    height: \"fit-content\",\n                    justifyContent:\n                      configuring || chartConfig.meta.title[locale]\n                        ? \"space-between\"\n                        : \"flex-end\",\n                    alignItems: \"flex-start\",\n                    gap: 2,\n                  }}\n                >\n                  {configuring || chartConfig.meta.title[locale] ? (\n                    <Title\n                      text={chartConfig.meta.title[locale]}\n                      smaller\n                      onClick={\n                        configuring\n                          ? () =>\n                              dispatch({\n                                type: \"CHART_ACTIVE_FIELD_CHANGE\",\n                                value: \"title\",\n                              })\n                          : undefined\n                      }\n                      {...{\n                        [DISABLE_SCREENSHOT_ATTR_KEY]:\n                          !chartConfig.meta.title[locale],\n                      }}\n                    />\n                  ) : (\n                    // We need to have a span here to keep the space between the\n                    // title and the chart (subgrid layout)\n                    <span style={{ height: 1 }} />\n                  )}\n                  <ActionElementsContainer>\n                    <ChartMoreButton\n                      chartKey={chartConfig.key}\n                      chartWrapperNode={ref.current}\n                      components={allComponents}\n                    />\n                    {actionElementSlot}\n                  </ActionElementsContainer>\n                </Flex>\n                {configuring || chartConfig.meta.description[locale] ? (\n                  <Description\n                    text={chartConfig.meta.description[locale]}\n                    smaller={state.layout.type === \"dashboard\"}\n                    onClick={\n                      configuring\n                        ? () => {\n                            dispatch({\n                              type: \"CHART_ACTIVE_FIELD_CHANGE\",\n                              value: \"description\",\n                            });\n                          }\n                        : undefined\n                    }\n                    {...{\n                      [DISABLE_SCREENSHOT_ATTR_KEY]:\n                        !chartConfig.meta.description[locale],\n                    }}\n                  />\n                ) : (\n                  // We need to have a span here to keep the space between the\n                  // title and the chart (subgrid layout)\n                  <span style={{ height: 1 }} />\n                )}\n                <Box sx={{ mt: 4 }}>\n                  {metadata?.dataCubesMetadata.some(\n                    (d) =>\n                      d.publicationStatus === DataCubePublicationStatus.Draft\n                  ) && (\n                    <Box sx={{ mb: 4 }}>\n                      <HintWarning>\n                        <Trans id=\"dataset.publicationStatus.draft.warning\">\n                          Careful, this dataset is only a draft.\n                          <br />\n                          <strong>Don&apos;t use for reporting!</strong>\n                        </Trans>\n                      </HintWarning>\n                    </Box>\n                  )}\n                </Box>\n                <ChartControls\n                  dataSource={dataSource}\n                  chartConfig={chartConfig}\n                  dashboardFilters={state.dashboardFilters}\n                  metadataPanelProps={{\n                    components: allComponents,\n                    top: HEADER_HEIGHT_CSS_VAR,\n                  }}\n                />\n                <ChartTablePreviewWrapper>\n                  {isTable ? (\n                    <ChartDataTablePreview\n                      dataSource={dataSource}\n                      chartConfig={chartConfig}\n                      dashboardFilters={state.dashboardFilters}\n                      sx={{ width: \"100%\", maxHeight: \"100%\" }}\n                    />\n                  ) : (\n                    <ChartWithFilters\n                      dataSource={dataSource}\n                      componentIds={componentIds}\n                      chartConfig={chartConfig}\n                      dashboardFilters={state.dashboardFilters}\n                    />\n                  )}\n                </ChartTablePreviewWrapper>\n                <ChartFootnotes\n                  dataSource={dataSource}\n                  chartConfig={chartConfig}\n                  dashboardFilters={state.dashboardFilters}\n                  components={allComponents}\n                />\n                {/* Wrap in div for subgrid layout */}\n                <div className=\"debug-panel\">\n                  <DebugPanel configurator interactiveFilters />\n                </div>\n              </InteractiveFiltersChartProvider>\n            </LoadingStateProvider>\n          </>\n        )}\n      </ChartErrorBoundary>\n    </Box>\n  );\n};\n","import { ReactNode, useCallback, useEffect, useRef, useState } from \"react\";\n\n/**\n * Holds a temporary snack state\n */\nexport const useLocalSnack = () => {\n  type Snack = {\n    message: string | ReactNode;\n    variant: \"success\" | \"error\";\n    duration?: number;\n  };\n  const timeoutRef = useRef<ReturnType<typeof setTimeout>>();\n  const [snack, setSnack] = useState(undefined as Snack | undefined);\n\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n\n  return [\n    snack,\n    useCallback(function enqueue(snack: Snack | undefined) {\n      setSnack(snack);\n      if (snack) {\n        timeoutRef.current = setTimeout(() => {\n          setSnack(undefined);\n        }, snack.duration || 5000);\n      }\n    }, []),\n\n    useCallback(function dismiss() {\n      setSnack(undefined);\n    }, []),\n  ] as const;\n};\n","import { Button, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\n\nexport const ConfirmButton = ({ onClick }: { onClick: () => void }) => {\n  const classes = useStyles();\n\n  return (\n    <Button className={classes.root} size=\"sm\" onClick={onClick}>\n      <Typography component=\"span\">Ok</Typography>\n    </Button>\n  );\n};\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  root: {\n    alignSelf: \"flex-end\",\n    marginTop: theme.spacing(2),\n    paddingLeft: theme.spacing(5),\n    paddingRight: theme.spacing(5),\n  },\n}));\n","import { Box } from \"@mui/material\";\nimport { useEffect, useRef } from \"react\";\n\nimport { Meta } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  isAnnotatorField,\n  isConfiguring,\n  isLayouting,\n  useConfiguratorState,\n} from \"@/configurator\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ConfirmButton } from \"@/configurator/components/confirm-button\";\nimport { MetaInputField } from \"@/configurator/components/field\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { useOrderedLocales } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const ChartAnnotatorSelector = () => {\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n\n  return (\n    <AnnotatorOptions\n      type=\"chart\"\n      activeField={chartConfig.activeField}\n      meta={chartConfig.meta}\n    />\n  );\n};\n\nexport const LayoutAnnotatorSelector = () => {\n  const [state] = useConfiguratorState(isLayouting);\n\n  return (\n    <AnnotatorOptions\n      type=\"layout\"\n      activeField={state.layout.activeField}\n      meta={state.layout.meta}\n    />\n  );\n};\n\nconst AnnotatorOptions = ({\n  type,\n  activeField,\n  meta,\n}: {\n  type: \"chart\" | \"layout\";\n  activeField: string | undefined;\n  meta: Meta;\n}) => {\n  const [_, dispatch] = useConfiguratorState();\n  const orderedLocales = useOrderedLocales();\n  const panelRef = useRef<HTMLDivElement>(null);\n  const handleClosePanel = useEvent(() => {\n    dispatch({\n      type:\n        type === \"chart\"\n          ? \"CHART_ACTIVE_FIELD_CHANGE\"\n          : \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value: undefined,\n    });\n  });\n\n  useEffect(() => {\n    if (panelRef?.current) {\n      panelRef.current.focus();\n    }\n  }, [activeField]);\n\n  if (!activeField || !isAnnotatorField(activeField)) {\n    return null;\n  }\n\n  return (\n    <Box\n      ref={panelRef}\n      role=\"tabpanel\"\n      id={`annotator-panel-${activeField}`}\n      aria-labelledby={`annotator-tab-${activeField}`}\n      tabIndex={-1}\n      sx={{ overflowX: \"hidden\", overflowY: \"auto\" }}\n    >\n      <ControlSection hideTopBorder>\n        <SectionTitle closable>{getFieldLabel(activeField)}</SectionTitle>\n        <ControlSectionContent>\n          {orderedLocales.map((locale) => (\n            <div key={`${locale}-${activeField}`}>\n              <MetaInputField\n                type={type}\n                inputType={activeField === \"label\" ? \"text\" : \"markdown\"}\n                metaKey={activeField}\n                locale={locale}\n                label={getFieldLabel(locale)}\n                value={meta[activeField][locale]}\n                disableToolbar={{\n                  blockType: true,\n                  listToggles: activeField === \"title\",\n                  link: activeField === \"title\",\n                }}\n              />\n            </div>\n          ))}\n          <ConfirmButton onClick={handleClosePanel} />\n        </ControlSectionContent>\n      </ControlSection>\n    </Box>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { useMemo } from \"react\";\n\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ConfirmButton } from \"@/configurator/components/confirm-button\";\nimport { TextBlockInputField } from \"@/configurator/components/field\";\nimport { isLayouting } from \"@/configurator/configurator-state\";\nimport { useOrderedLocales } from \"@/locales/use-locale\";\nimport { useConfiguratorState } from \"@/src\";\nimport { assert } from \"@/utils/assert\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const LayoutBlocksSelector = () => {\n  const orderedLocales = useOrderedLocales();\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const { layout } = state;\n  const { blocks } = layout;\n  const activeBlock = useMemo(() => {\n    const activeBlock = blocks.find(\n      (block) => block.key === layout.activeField\n    );\n\n    if (activeBlock) {\n      // For now we only support text blocks\n      assert(activeBlock.type === \"text\", \"Active block must be a text block\");\n    }\n\n    return activeBlock;\n  }, [blocks, layout.activeField]);\n\n  const handleClosePanel = useEvent(() => {\n    dispatch({\n      type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value: undefined,\n    });\n  });\n\n  return activeBlock ? (\n    <div\n      key={activeBlock.key}\n      role=\"tabpanel\"\n      id={`control-panel-block-${activeBlock.key}`}\n      aria-labelledby={`tab-block-${activeBlock.key}`}\n      tabIndex={-1}\n    >\n      <ControlSection hideTopBorder>\n        <SectionTitle closable>\n          <Trans id=\"controls.section.block-options.block.text\">\n            Text object\n          </Trans>\n        </SectionTitle>\n        <ControlSectionContent>\n          {orderedLocales.map((locale) => (\n            <TextBlockInputField key={locale} locale={locale} />\n          ))}\n          <ConfirmButton onClick={handleClosePanel} />\n        </ControlSectionContent>\n      </ControlSection>\n    </div>\n  ) : null;\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Button, Typography } from \"@mui/material\";\nimport isEqual from \"lodash/isEqual\";\nimport omit from \"lodash/omit\";\nimport { useMemo } from \"react\";\n\nimport { Checkbox, MarkdownInput, Radio, RadioGroup } from \"@/components/form\";\nimport { Markdown } from \"@/components/markdown\";\nimport { useDisclosure } from \"@/components/use-disclosure\";\nimport { Annotation, AnnotationTarget } from \"@/config-types\";\nimport { isSegmentInConfig } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { getDefaultHighlightAnnotation } from \"@/configurator/components/chart-annotations/utils\";\nimport { ControlTab } from \"@/configurator/components/chart-controls/control-tab\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ConfiguratorDrawer } from \"@/configurator/components/drawers\";\nimport { ColorPicker } from \"@/configurator/components/field\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { useConfiguratorState } from \"@/configurator/configurator-state\";\nimport { isConfiguring } from \"@/configurator/configurator-state\";\nimport { Dimension } from \"@/domain/data\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { Icon } from \"@/icons\";\nimport { Locale } from \"@/locales/locales\";\nimport { useLocale, useOrderedLocales } from \"@/locales/use-locale\";\nimport { PRIMARY_COLOR } from \"@/themes/palette\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const ChartAnnotationsSelector = () => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const activeField = chartConfig.activeField;\n  const annotation = chartConfig.annotations.find(\n    (annotation) => annotation.key === activeField\n  );\n\n  const [{ data: componentsData }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      locale,\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        joinBy: cube.joinBy,\n        loadValues: true,\n      })),\n    },\n  });\n\n  const dimensions = useMemo(() => {\n    return componentsData?.dataCubesComponents.dimensions ?? [];\n  }, [componentsData]);\n\n  const annotationLabel = useMemo(() => {\n    return getAnnotationLabel({ annotation, dimensions });\n  }, [annotation, dimensions]);\n\n  const handleStyleTypeChange = useEvent(\n    (highlightType: Annotation[\"highlightType\"]) => {\n      if (!annotation || annotation.highlightType === highlightType) {\n        return;\n      }\n\n      dispatch({\n        type: \"CHART_ANNOTATION_HIGHLIGHT_TYPE_CHANGE\",\n        value: {\n          key: annotation.key,\n          highlightType,\n        },\n      });\n\n      if (highlightType === \"filled\" && !annotation.color) {\n        dispatch({\n          type: \"CHART_ANNOTATION_COLOR_CHANGE\",\n          value: {\n            key: annotation.key,\n            color: PRIMARY_COLOR,\n          },\n        });\n      }\n    }\n  );\n\n  const handleColorChange = useEvent((color: string) => {\n    if (!annotation || annotation.color === color) {\n      return;\n    }\n\n    dispatch({\n      type: \"CHART_ANNOTATION_COLOR_CHANGE\",\n      value: {\n        key: annotation.key,\n        color,\n      },\n    });\n  });\n\n  const handleDelete = useEvent(() => {\n    if (!annotation) {\n      return;\n    }\n\n    dispatch({\n      type: \"CHART_ANNOTATION_REMOVE\",\n      value: {\n        key: annotation.key,\n      },\n    });\n  });\n\n  const handleClearText = useEvent((key: string) => {\n    dispatch({\n      type: \"CHART_ANNOTATION_TEXT_CLEAR\",\n      value: {\n        key,\n      },\n    });\n  });\n\n  const handleClose = useEvent(() => {\n    if (!annotation) {\n      return;\n    }\n\n    const defaultHighlightAnnotation = getDefaultHighlightAnnotation();\n\n    if (\n      isEqual(omit(annotation, \"key\"), omit(defaultHighlightAnnotation, \"key\"))\n    ) {\n      handleClearText(annotation.key);\n    }\n\n    dispatch({\n      type: \"CHART_ACTIVE_FIELD_CHANGE\",\n      value: undefined,\n    });\n  });\n\n  const handleDefaultOpenChange = useEvent((defaultOpen: boolean) => {\n    if (!annotation || annotation.defaultOpen === defaultOpen) {\n      return;\n    }\n\n    dispatch({\n      type: \"CHART_ANNOTATION_DEFAULT_OPEN_CHANGE\",\n      value: {\n        key: annotation.key,\n        defaultOpen,\n      },\n    });\n  });\n\n  const drawerState = useDisclosure();\n\n  if (!annotation) {\n    return null;\n  }\n\n  const hasTargets = annotation.targets.length > 0;\n  const hasText = Object.values(annotation.text).some((t) => t);\n  const label = annotation.text[locale];\n  const isSegmented =\n    isSegmentInConfig(chartConfig) &&\n    \"segment\" in chartConfig.fields &&\n    !!chartConfig.fields.segment;\n\n  return (\n    <>\n      <ControlSection hideTopBorder>\n        <SectionTitle closable onClose={handleClose}>\n          <Trans id=\"controls.annotations.highlight.section.element.title\">\n            Annotate element\n          </Trans>\n        </SectionTitle>\n        <ControlSectionContent>\n          <Typography variant=\"h6\" component=\"p\">\n            {annotationLabel ||\n              t({\n                id: \"controls.annotations.highlight.section.element.cta\",\n                message: \"Select an element in the chart...\",\n              })}\n          </Typography>\n        </ControlSectionContent>\n      </ControlSection>\n      {isSegmented ? null : (\n        <ControlSection collapse>\n          <SectionTitle>\n            <Trans id=\"controls.annotations.highlight.section.style.title\">\n              Style\n            </Trans>\n          </SectionTitle>\n          <ControlSectionContent gap=\"xl\">\n            <RadioGroup>\n              <Radio\n                label={t({\n                  id: \"controls.text-only\",\n                  message: \"Text box only\",\n                })}\n                value=\"none\"\n                checked={annotation.highlightType === \"none\"}\n                disabled={!hasTargets}\n                onChange={() => handleStyleTypeChange(\"none\")}\n              />\n              <Radio\n                label={t({\n                  id: \"controls.fill-and-text\",\n                  message: \"Fill and text box\",\n                })}\n                value=\"filled\"\n                checked={annotation.highlightType === \"filled\"}\n                disabled={!hasTargets}\n                onChange={() => handleStyleTypeChange(\"filled\")}\n              />\n            </RadioGroup>\n            {annotation.highlightType === \"filled\" && annotation.color && (\n              <ColorPicker\n                label={annotation.color}\n                color={annotation.color}\n                symbol=\"square\"\n                onChange={handleColorChange}\n              />\n            )}\n          </ControlSectionContent>\n        </ControlSection>\n      )}\n      <ControlSection collapse>\n        <SectionTitle>\n          <Trans id=\"controls.annotations.highlight.section.annotation.title\">\n            Annotation\n          </Trans>\n        </SectionTitle>\n        <ControlSectionContent px=\"none\">\n          <ControlTab\n            upperLabel={\n              label\n                ? undefined\n                : t({\n                    id: \"controls.annotations.annotation\",\n                    message: \"Annotation\",\n                  })\n            }\n            mainLabel={\n              <Markdown>\n                {label ||\n                  t({\n                    id: \"controls.annotations.annotation.add.text\",\n                    message: \"Add text...\",\n                  })}\n              </Markdown>\n            }\n            icon=\"text\"\n            onClick={drawerState.open}\n            value=\"text\"\n            disabled={!hasTargets}\n          />\n          <Button\n            variant=\"text\"\n            color=\"primary\"\n            size=\"xs\"\n            disabled={!hasTargets || !hasText}\n            onClick={() => handleClearText(annotation.key)}\n            sx={{ width: \"fit-content\", ml: 4 }}\n          >\n            <Trans id=\"controls.annotations.annotation.clear-text\">\n              Clear text\n            </Trans>\n          </Button>\n        </ControlSectionContent>\n      </ControlSection>\n      <ControlSection collapse>\n        <SectionTitle>\n          <Trans id=\"controls.annotations.highlight.section.display.title\">\n            Display\n          </Trans>\n        </SectionTitle>\n        <ControlSectionContent>\n          <Checkbox\n            label={t({\n              id: \"controls.annotations.highlight.section.display.default-open\",\n              message: \"Show open by default\",\n            })}\n            checked={annotation.defaultOpen}\n            disabled={!hasTargets || !hasText}\n            onChange={() => handleDefaultOpenChange(!annotation.defaultOpen)}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      <AnnotationDrawer opened={drawerState.isOpen} close={drawerState.close} />\n      <ControlSection hideTopBorder style={{ marginTop: \"auto\" }}>\n        <ControlSectionContent>\n          <Button\n            variant=\"outlined\"\n            size=\"sm\"\n            color=\"error\"\n            startIcon={<Icon name=\"trash\" size={20} />}\n            onClick={handleDelete}\n          >\n            <Trans id=\"controls.annotations.delete\">Delete</Trans>\n          </Button>\n        </ControlSectionContent>\n      </ControlSection>\n    </>\n  );\n};\n\nconst AnnotationDrawer = ({\n  opened,\n  close,\n}: {\n  opened: boolean;\n  close: () => void;\n}) => {\n  const orderedLocales = useOrderedLocales();\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const activeField = chartConfig.activeField;\n  const annotation = chartConfig.annotations.find(\n    (annotation) => annotation.key === activeField\n  );\n\n  const handleTextChange = useEvent((locale: Locale, value: string) => {\n    if (!annotation) {\n      return;\n    }\n\n    dispatch({\n      type: \"CHART_ANNOTATION_TEXT_CHANGE\",\n      value: {\n        key: annotation.key,\n        locale,\n        value,\n      },\n    });\n  });\n\n  if (!annotation) {\n    return null;\n  }\n\n  return (\n    <ConfiguratorDrawer open={opened} hideBackdrop>\n      <div\n        role=\"tabpanel\"\n        id={`annotations-panel-${activeField}`}\n        aria-labelledby={`annotations-tab-${activeField}`}\n        tabIndex={-1}\n        style={{ overflowX: \"hidden\", overflowY: \"auto\" }}\n      >\n        <ControlSection hideTopBorder>\n          <SectionTitle onClose={close}>\n            <Trans id=\"controls.annotations.highlight.section.annotation.title\">\n              Annotation\n            </Trans>\n          </SectionTitle>\n          <ControlSectionContent>\n            {orderedLocales.map((locale) => (\n              <div key={`${locale}-${activeField}`}>\n                <MarkdownInput\n                  name={`annotation-${locale}`}\n                  label={getFieldLabel(locale)}\n                  value={annotation.text[locale]}\n                  characterLimit={500}\n                  disablePlugins={{\n                    headings: true,\n                  }}\n                  disableToolbar={{\n                    blockType: true,\n                    listToggles: true,\n                    link: true,\n                  }}\n                  onChange={(e) => {\n                    handleTextChange(locale, e.currentTarget.value);\n                  }}\n                />\n              </div>\n            ))}\n          </ControlSectionContent>\n        </ControlSection>\n      </div>\n    </ConfiguratorDrawer>\n  );\n};\n\nconst getAnnotationLabel = ({\n  annotation,\n  dimensions,\n}: {\n  annotation?: Annotation;\n  dimensions: Dimension[];\n}) => {\n  if (!annotation) {\n    return;\n  }\n\n  return annotation.targets\n    .map((target) => {\n      if (target) {\n        return getTargetLabel(target, { dimensions });\n      }\n\n      return \"\";\n    })\n    .sort()\n    .join(\", \");\n};\n\nconst getTargetLabel = (\n  target: AnnotationTarget,\n  { dimensions }: { dimensions: Dimension[] }\n) => {\n  if (!target) {\n    return;\n  }\n\n  const component = dimensions.find((d) => d.id === target.componentId);\n\n  if (!component) {\n    return;\n  }\n\n  const value = component.values.find((v) => v.value === target.value);\n\n  if (!value) {\n    return;\n  }\n\n  return `${component.label}: ${value.label}`;\n};\n","import { t } from \"@lingui/macro\";\n\nimport { Icon } from \"@/icons\";\n\nexport const MoveDragButton = () => {\n  return (\n    <span\n      title={t({ id: \"Drag filters to reorganize\" })}\n      style={{ cursor: \"move\" }}\n    >\n      <Icon name=\"dragIndicator\" />\n    </span>\n  );\n};\n","import { Badge, BadgeProps } from \"@mui/material\";\n\nimport { getChartConfig, useChartConfigFilters } from \"@/config-utils\";\nimport { useControlSectionContext } from \"@/configurator/components/chart-controls/section\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\n\nexport const FiltersBadge = ({ sx }: { sx?: BadgeProps[\"sx\"] }) => {\n  const ctx = useControlSectionContext();\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const filters = useChartConfigFilters(chartConfig);\n\n  return (\n    <Badge\n      invisible={ctx.isOpen}\n      badgeContent={\n        Object.values(filters).filter((d) => d.type === \"single\").length\n      }\n      color=\"secondary\"\n      sx={{ display: \"block\", ...sx }}\n    />\n  );\n};\n\nexport const DatasetsBadge = ({ sx }: { sx?: BadgeProps[\"sx\"] }) => {\n  const ctx = useControlSectionContext();\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const datasetsCount = chartConfig.cubes.length;\n\n  return <Badge invisible={ctx.isOpen} badgeContent={datasetsCount} sx={sx} />;\n};\n","import { Trans } from \"@lingui/macro\";\n\nimport { ConfiguratorAddButton } from \"@/components/add-button\";\nimport { Annotation } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { getDefaultHighlightAnnotation } from \"@/configurator/components/chart-annotations/utils\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useEvent } from \"@/utils/use-event\";\n\nconst MAX_ANNOTATIONS = 3;\n\nexport const AddAnnotationButton = () => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const { annotations } = chartConfig;\n  const handleAddAnnotation = useEvent((type: Annotation[\"type\"]) => {\n    let annotation: Annotation;\n\n    switch (type) {\n      case \"highlight\":\n        annotation = getDefaultHighlightAnnotation();\n        break;\n      default:\n        const _exhaustiveCheck: never = type;\n        return _exhaustiveCheck;\n    }\n\n    dispatch({\n      type: \"CHART_ANNOTATION_ADD\",\n      value: annotation,\n    });\n    dispatch({\n      type: \"CHART_ACTIVE_FIELD_CHANGE\",\n      value: annotation.key,\n    });\n  });\n\n  return annotations.length < MAX_ANNOTATIONS ? (\n    <>\n      <ConfiguratorAddButton\n        onClick={() => handleAddAnnotation(\"highlight\")}\n        sx={{ mx: 4 }}\n      >\n        <Trans id=\"controls.annotations.add\">Add</Trans>\n      </ConfiguratorAddButton>\n    </>\n  ) : null;\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\n\nimport { Markdown } from \"@/components/markdown\";\nimport { Annotation, supportsAnnotations } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { AddAnnotationButton } from \"@/configurator/components/chart-annotations/add-annotation-button\";\nimport { ControlTab } from \"@/configurator/components/chart-controls/control-tab\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { Icon } from \"@/icons\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const ChartAnnotations = () => {\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n\n  if (!supportsAnnotations(chartConfig)) {\n    return null;\n  }\n\n  return (\n    <ControlSection\n      role=\"tablist\"\n      aria-labelledby=\"controls-annotations\"\n      collapse\n      defaultExpanded={false}\n    >\n      <SectionTitle id=\"controls-annotations\">\n        <Trans id=\"controls.section.annotations\">Annotations</Trans>\n      </SectionTitle>\n      <ControlSectionContent gap=\"none\" px=\"none\">\n        {chartConfig.annotations.map((annotation) => (\n          <ChartAnnotationTab key={annotation.key} annotation={annotation} />\n        ))}\n        <AddAnnotationButton />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n\nconst ChartAnnotationTab = ({ annotation }: { annotation: Annotation }) => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n\n  const label = annotation.text[locale];\n  const value = chartConfig.activeField ?? \"\";\n\n  const handleClick = useEvent(() => {\n    dispatch({\n      type: \"CHART_ACTIVE_FIELD_CHANGE\",\n      value: annotation.key,\n    });\n  });\n\n  return (\n    <ControlTab\n      upperLabel={\n        label\n          ? undefined\n          : t({\n              id: \"controls.annotations.label\",\n              message: \"Label\",\n            })\n      }\n      mainLabel={\n        <Markdown>\n          {label ||\n            t({\n              id: \"controls.annotations.annotation.add.text\",\n              message: \"Add text...\",\n            })}\n        </Markdown>\n      }\n      icon=\"text\"\n      rightIcon={\n        <Typography component=\"span\" color=\"text.primary\">\n          <Icon name=\"pen\" />\n        </Typography>\n      }\n      value={value}\n      onClick={handleClick}\n    />\n  );\n};\n","import { t } from \"@lingui/macro\";\n\nimport { ChartConfig } from \"@/config-types\";\nimport { ChartOptionCheckboxField } from \"@/configurator/components/field\";\n\nexport const ShowFilterAreaOpen = ({\n  chartConfig,\n}: {\n  chartConfig: ChartConfig;\n}) => (\n  <ChartOptionCheckboxField\n    label={t({\n      id: \"controls.section.data.filters.default-open\",\n      message: \"Show filter area open\",\n    })}\n    field={null}\n    path=\"interactiveFiltersConfig.dataFilters.defaultOpen\"\n    disabled={!chartConfig.interactiveFiltersConfig.dataFilters.active}\n  />\n);\n","import { SetStateAction, useCallback, useEffect, useState } from \"react\";\n\nexport const useLocalState = <T>(\n  key: string,\n  initialValue: T\n): [T, (value: SetStateAction<T>) => void] => {\n  const [state, setState] = useState<T>(() => {\n    const storedValue = localStorage.getItem(key);\n    return storedValue ? JSON.parse(storedValue) : initialValue;\n  });\n\n  useEffect(() => {\n    localStorage.setItem(key, JSON.stringify(state));\n  }, [key, state]);\n\n  const updateState = useCallback((value: SetStateAction<T>) => {\n    setState(value);\n  }, []);\n\n  return [state, updateState];\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Box, Link } from \"@mui/material\";\nimport { useCallback } from \"react\";\n\nimport { HintWarning } from \"@/components/hint\";\nimport { useLocalState } from \"@/utils/use-local-state\";\n\nexport const useCautionAlert = () => {\n  const [isOpen, setIsOpen] = useLocalState(\"add-dataset-caution-alert\", true);\n\n  return {\n    isOpen,\n    open: useCallback(() => setIsOpen(true), [setIsOpen]),\n    close: useCallback(() => setIsOpen(false), [setIsOpen]),\n  };\n};\n\nexport const CautionAlert = ({ onConfirm }: { onConfirm: () => void }) => {\n  return (\n    <HintWarning>\n      <Trans id=\"dataset.search.caution.body\">\n        The linking of different datasets carries risks such as data\n        inconsistencies, scalability issues, and unexpected correlations. Be\n        sure to use to merge datasets only when you are confident that data\n        should be merged together.\n      </Trans>\n      <Box sx={{ mt: 1 }}>\n        <Link\n          onClick={(ev) => {\n            ev.preventDefault();\n            onConfirm();\n          }}\n          href=\"#\"\n        >\n          <Trans id=\"dataset.search.caution.acknowledge\">\n            Understood, I&apos;ll proceed cautiously.\n          </Trans>\n        </Link>\n      </Box>\n    </HintWarning>\n  );\n};\n","// eslint-disable-next-line no-restricted-imports\nimport { groupBy, mapValues } from \"lodash\";\n\nimport { isDimensionOfTimeUnit, PartialSearchCube } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { mkVersionedJoinBy, VersionedJoinBy } from \"@/graphql/join\";\n\nimport { SearchOptions } from \"./types\";\n\nexport const findDimensionForOption = (\n  option: SearchOptions,\n  dimensions: PartialSearchCube[\"dimensions\"]\n) => {\n  const type = option.type;\n  switch (type) {\n    case \"temporal\":\n      return dimensions?.find((d) => isDimensionOfTimeUnit(d, option.timeUnit));\n    case \"shared\":\n      return dimensions?.find((d) =>\n        d.termsets.some((t) =>\n          option.termsets.map((t) => t.iri).includes(t.iri)\n        )\n      );\n    default:\n      const exhaustiveCheck: never = type;\n      return exhaustiveCheck;\n  }\n};\n\nexport const inferJoinBy = (\n  options: SearchOptions[],\n  newCube: PartialSearchCube\n): VersionedJoinBy => {\n  const tmp = options.map((option) => {\n    const rightDimension = findDimensionForOption(option, newCube?.dimensions);\n    if (!rightDimension) {\n      console.log(\"No dimension found for option\", option);\n      return {};\n    }\n\n    const originalIdsByCube = groupBy(option.originalIds, (x) => {\n      return x.cubeIri;\n    });\n    return {\n      ...mapValues(originalIdsByCube, (x) => x.map((x) => x.dimensionId)),\n      [newCube.iri]: [rightDimension?.id].filter(truthy),\n    };\n  });\n\n  const result = tmp.reduce((acc, curr) => {\n    Object.entries(curr).forEach(([key, value]) => {\n      if (!acc[key]) {\n        acc[key] = [];\n      }\n      if (value) {\n        acc[key].push(...value);\n      }\n    });\n    return acc;\n  }, {} as VersionedJoinBy);\n\n  return mkVersionedJoinBy(result);\n};\n","import {\n  dialogActionsClasses,\n  dialogClasses,\n  dialogContentClasses,\n  dialogTitleClasses,\n  paperClasses,\n} from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\n\nexport const useStyles = makeStyles((theme: Theme) => ({\n  addButton: {\n    transition: \"opacity 0.25s ease\",\n  },\n  dialog: {\n    \"--dialog-padding\": \"60px\",\n    [`& .${dialogTitleClasses.root}`]: {\n      padding: \"var(--dialog-padding)\",\n      paddingBottom: 0,\n    },\n    [`& .${dialogContentClasses.root}`]: {\n      padding: \"var(--dialog-padding)\",\n      paddingTop: \"2rem\",\n    },\n    [`& .${dialogActionsClasses.root}`]: {\n      padding: \"var(--dialog-padding)\",\n      paddingTop: 0,\n    },\n    [`& .${dialogClasses.paper}`]: {\n      minHeight: \"calc(100vh - calc(30px * 2))\",\n    },\n  },\n  dialogCloseArea: {\n    position: \"absolute\",\n    top: \"1rem\",\n    right: \"1rem\",\n    display: \"flex\",\n    gap: \"0.5rem\",\n    alignItems: \"center\",\n  },\n  newAnnotation: {\n    color: theme.palette.success.main,\n  },\n  listTag: {\n    whiteSpace: \"break-spaces\",\n  },\n  listItemSecondary: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    alignItems: \"center\",\n    gap: 1,\n    paddingTop: theme.spacing(1),\n  },\n  previewSelect: {\n    width: 302,\n  },\n  previewSelectPaper: {\n    [`& .${paperClasses.root}`]: {\n      marginTop: \"0.25rem\",\n    },\n  },\n}));\n","import { Trans } from \"@lingui/macro\";\nimport { LoadingButton } from \"@mui/lab\";\nimport {\n  Box,\n  Button,\n  DialogActions,\n  DialogContent,\n  Stack,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableRow,\n  Tooltip,\n  Typography,\n  TypographyProps,\n} from \"@mui/material\";\nimport clsx from \"clsx\";\nimport groupBy from \"lodash/groupBy\";\nimport maxBy from \"lodash/maxBy\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nimport { FirstTenRowsCaption } from \"@/browse/ui/first-ten-rows-caption\";\nimport { Error as ErrorHint, Loading } from \"@/components/hint\";\nimport { Tag } from \"@/components/tag\";\nimport { ChartConfig, DataSource } from \"@/config-types\";\nimport { SearchOptions } from \"@/configurator/components/add-dataset-drawer/types\";\nimport { useStyles } from \"@/configurator/components/add-dataset-drawer/use-styles\";\nimport {\n  Dimension,\n  isJoinByComponent,\n  isStandardErrorDimension,\n  Measure,\n  PartialSearchCube,\n} from \"@/domain/data\";\nimport {\n  useDataCubesMetadataQuery,\n  useDataCubesObservationsQuery,\n} from \"@/graphql/hooks\";\nimport {\n  getCubeFiltersFromVersionedJoinBy,\n  joinDimensions,\n} from \"@/graphql/join\";\nimport { VersionedJoinBy } from \"@/graphql/join\";\nimport {\n  DataCubeComponentsQuery,\n  useDataCubeComponentsQuery,\n} from \"@/graphql/query-hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nconst NewAnnotation = (props: TypographyProps) => {\n  const classes = useStyles();\n\n  return (\n    <Typography\n      className={clsx(classes.newAnnotation, props.className)}\n      lineHeight={1}\n      variant=\"caption\"\n      {...props}\n    >\n      <Trans id=\"dataset.search.preview.new-dimension\">New</Trans>\n    </Typography>\n  );\n};\n\nexport const PreviewDataTable = ({\n  chartConfig,\n  dataSource,\n  existingCubes,\n  currentComponents,\n  inferredJoinBy,\n  otherCube,\n  onClickBack,\n  onConfirm,\n  addingDataset,\n}: {\n  chartConfig: ChartConfig;\n  dataSource: DataSource;\n  existingCubes: { iri: string }[];\n  currentComponents:\n    | DataCubeComponentsQuery[\"dataCubeComponents\"]\n    | undefined\n    | null;\n  searchDimensionsSelected: SearchOptions[];\n  otherCube: PartialSearchCube;\n  onClickBack: () => void;\n  onConfirm: () => void;\n  addingDataset: boolean;\n  inferredJoinBy: VersionedJoinBy;\n}) => {\n  const locale = useLocale();\n  const commonQueryVariables = {\n    sourceType: dataSource.type,\n    sourceUrl: dataSource.url,\n    locale,\n  };\n\n  const [otherCubeComponentsQuery] = useDataCubeComponentsQuery({\n    variables: {\n      ...commonQueryVariables,\n      cubeFilter: { iri: otherCube.iri },\n    },\n    pause: !otherCube,\n  });\n\n  const otherCubeComponents = otherCubeComponentsQuery.data?.dataCubeComponents;\n\n  const isFetchingComponents = otherCubeComponentsQuery.fetching;\n\n  const isQueryPaused = !otherCubeComponents || !currentComponents;\n\n  const cubeFilters = getCubeFiltersFromVersionedJoinBy(inferredJoinBy);\n\n  const [observations] = useDataCubesObservationsQuery({\n    chartConfig,\n    variables: {\n      locale,\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      cubeFilters,\n    },\n    pause: isQueryPaused,\n  });\n  const [currentCubes] = useDataCubesMetadataQuery({\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale: locale,\n      cubeFilters: existingCubes.map((cube) => ({ iri: cube.iri })),\n    },\n  });\n\n  const isFetching =\n    isFetchingComponents || observations.fetching || currentCubes.fetching;\n\n  const allColumns = useMemo(() => {\n    const shouldIncludeColumnInPreview = (d: Dimension | Measure) =>\n      !isStandardErrorDimension(d);\n    const currentDimensions = (currentComponents?.dimensions ?? []).filter(\n      (x) => shouldIncludeColumnInPreview(x)\n    );\n    const currentMeasures = (currentComponents?.measures ?? []).filter((x) =>\n      shouldIncludeColumnInPreview(x)\n    );\n    const otherDimensions = (otherCubeComponents?.dimensions ?? []).filter(\n      (x) => shouldIncludeColumnInPreview(x)\n    );\n    const otherMeasures = (otherCubeComponents?.measures ?? []).filter((x) =>\n      shouldIncludeColumnInPreview(x)\n    );\n\n    const joinedColumns = joinDimensions({\n      dimensions: [...currentDimensions, ...otherDimensions],\n      joinBy: inferredJoinBy,\n    });\n\n    const {\n      join: joinedJoinDimensions = [],\n      other: joinedOtherDimensions = [],\n      current: joinedCurrentDimensions = [],\n    } = groupBy(joinedColumns, (d) => {\n      const isJoinBy = isJoinByComponent(d);\n      return isJoinBy\n        ? \"join\"\n        : d.cubeIri === otherCube.iri\n          ? \"other\"\n          : \"current\";\n    });\n\n    return [\n      ...joinedJoinDimensions,\n      ...joinedOtherDimensions,\n      ...otherMeasures,\n      ...joinedCurrentDimensions,\n      ...currentMeasures,\n    ];\n  }, [\n    currentComponents?.dimensions,\n    currentComponents?.measures,\n    inferredJoinBy,\n    otherCube.iri,\n    otherCubeComponents?.dimensions,\n    otherCubeComponents?.measures,\n  ]);\n\n  const [selectedColumnsRaw, setSelectedColumns] = useState<\n    undefined | string[]\n  >(undefined);\n  useEffect(() => {\n    if (\n      otherCubeComponents?.dimensions &&\n      otherCubeComponents.measures &&\n      selectedColumnsRaw === undefined\n    ) {\n      setSelectedColumns(allColumns.map((x) => x.id));\n    }\n  }, [\n    allColumns,\n    otherCubeComponents?.dimensions,\n    otherCubeComponents?.measures,\n    selectedColumnsRaw,\n  ]);\n  const selectedColumns = useMemo(\n    () => selectedColumnsRaw ?? [],\n    [selectedColumnsRaw]\n  );\n\n  const selectedColumnsById = useMemo(\n    () => Object.fromEntries(selectedColumns.map((x) => [x, true])),\n    [selectedColumns]\n  );\n\n  const previewObservations = useMemo(() => {\n    const data = observations.data?.dataCubesObservations.data ?? [];\n    const bestObservation = maxBy(data, (obs) => {\n      return allColumns.reduce((acc, dim) => acc + (obs[dim.id] ? 1 : 0), 0);\n    });\n\n    const amount = 8;\n    const index = bestObservation ? data.indexOf(bestObservation) : 0;\n    const clampedIndex = Math.max(0, Math.min(index, data.length - amount));\n    return data.slice(clampedIndex, clampedIndex + amount);\n  }, [allColumns, observations.data?.dataCubesObservations.data]);\n\n  return (\n    <>\n      <DialogContent sx={{ overflowX: \"hidden\" }}>\n        <Box sx={{ display: \"flex\", flexDirection: \"column\", gap: \"1rem\" }}>\n          <Typography variant=\"h2\">\n            <Trans id=\"dataset.search.preview.title\">\n              Review available dimensions\n            </Trans>\n          </Typography>\n          <Typography variant=\"body1\">\n            <Trans id=\"dataset.search.preview.description\">\n              Review all available dimensions before continuing to edit your\n              visualization.\n            </Trans>\n          </Typography>\n          <div>\n            <Typography variant=\"h6\" mb={1}>\n              <Trans id=\"dataset.search.preview.datasets\">Datasets</Trans>\n            </Typography>\n            <Stack direction=\"column\" spacing={1}>\n              <Typography variant=\"caption\">\n                {currentCubes.data?.dataCubesMetadata\n                  .map((metadata) => metadata.title)\n                  .join(\", \")}\n              </Typography>\n              <div>\n                <NewAnnotation />\n                <br />\n                <Typography variant=\"caption\" mt={-1} component=\"div\">\n                  {otherCube.title}\n                </Typography>\n              </div>\n            </Stack>\n          </div>\n          {isFetching ? <Loading delayMs={0} /> : null}\n          {observations.error ? (\n            <ErrorHint>\n              <Box\n                component=\"details\"\n                sx={{ width: \"100%\", cursor: \"pointer\" }}\n              >\n                <summary>{observations.error.name}</summary>\n                {observations.error.message}\n              </Box>\n            </ErrorHint>\n          ) : null}\n        </Box>\n        {otherCubeComponents ? (\n          <>\n            {observations.data?.dataCubesObservations ? (\n              <Box\n                sx={{\n                  display: \"flex\",\n                  flexDirection: \"column\",\n                  alignItems: \"flex-end\",\n                  gap: 2,\n                }}\n              >\n                <Box\n                  sx={{\n                    overflowX: \"scroll\",\n                    width: \"100%\",\n                    mt: 6,\n                    mb: 4,\n                    boxShadow: 4,\n                  }}\n                >\n                  <Table>\n                    <TableHead>\n                      <TableRow>\n                        {allColumns.map((column) =>\n                          !!selectedColumnsById[column.id] ? (\n                            <TableCell\n                              key={column.id}\n                              sx={{ minWidth: 200, maxWidth: 300 }}\n                            >\n                              {column.cubeIri === otherCube.iri && (\n                                <NewAnnotation />\n                              )}\n                              {isJoinByComponent(column) ? (\n                                <>\n                                  <Tooltip\n                                    arrow\n                                    title={\n                                      <>\n                                        {column.originalIds\n                                          .map((o) => o.description)\n                                          .join(\", \")}\n                                      </>\n                                    }\n                                    placement=\"right\"\n                                  >\n                                    <Tag type=\"dimension\">Joined</Tag>\n                                  </Tooltip>\n                                </>\n                              ) : null}\n                              <br />\n                              <Typography variant=\"h5\">\n                                {column.label}\n                              </Typography>\n                            </TableCell>\n                          ) : null\n                        )}\n                      </TableRow>\n                    </TableHead>\n                    <TableBody>\n                      {previewObservations.map((observation, index) => (\n                        <TableRow key={index}>\n                          {allColumns.map((column) =>\n                            !!selectedColumnsById[column.id] ? (\n                              <TableCell key={column.id}>\n                                {observation[column.id]}\n                              </TableCell>\n                            ) : null\n                          )}\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </Box>\n                <FirstTenRowsCaption />\n              </Box>\n            ) : null}\n          </>\n        ) : null}\n      </DialogContent>\n      <DialogActions\n        sx={{\n          display: \"flex\",\n          flexDirection: \"column\",\n          alignItems: \"flex-end\",\n          gap: 1,\n          px: 4,\n          pt: \"0 !important\",\n          pb: \"2rem !important\",\n        }}\n      >\n        <Box sx={{ display: \"flex\", gap: 2 }}>\n          <Button variant=\"outlined\" onClick={onClickBack}>\n            <Trans id=\"button.back\">Back</Trans>\n          </Button>\n          <LoadingButton\n            loading={addingDataset}\n            variant=\"contained\"\n            onClick={onConfirm}\n          >\n            <Trans id=\"button.confirm\">Confirm</Trans>\n          </LoadingButton>\n        </Box>\n      </DialogActions>\n    </>\n  );\n};\n","import { useEventCallback } from \"@mui/material\";\nimport { useState } from \"react\";\nimport { useClient } from \"urql\";\n\nimport { getEnabledChartTypes } from \"@/charts\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  addDatasetInConfig,\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { PartialSearchCube } from \"@/domain/data\";\nimport { executeDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { VersionedJoinBy } from \"@/graphql/join\";\nimport { useLocale } from \"@/locales/use-locale\";\n\n/**\n * Adds a dataset to the current chart configuration.\n * Is currently responsible for finding the correct joinBy dimension.\n */\nexport const useAddDataset = () => {\n  const [hookState, setHookState] = useState({\n    fetching: false,\n    otherIri: null as null | string,\n  });\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const { type: sourceType, url: sourceUrl } = state.dataSource;\n  const locale = useLocale();\n  const client = useClient();\n  const addDataset = useEventCallback(\n    async ({\n      otherCube,\n      joinBy,\n    }: {\n      otherCube: PartialSearchCube;\n      joinBy: VersionedJoinBy;\n    }) => {\n      const iri = otherCube.iri;\n      setHookState((hs) => ({ ...hs, fetching: true, otherIri: iri }));\n      try {\n        const addDatasetOptions = {\n          iri,\n          joinBy,\n        };\n        const nextState = structuredClone(state);\n        addDatasetInConfig(nextState, addDatasetOptions);\n        const chartConfig = getChartConfig(nextState, state.activeChartKey);\n\n        const res = await executeDataCubesComponentsQuery(client, {\n          locale,\n          sourceType,\n          sourceUrl,\n          cubeFilters: chartConfig.cubes.map((cube) => ({\n            iri: cube.iri,\n            joinBy: cube.joinBy,\n            componentIds: undefined,\n            loadValues: true,\n          })),\n        });\n\n        if (res.error || !res.data) {\n          throw Error(\"Could not fetch dimensions and measures\");\n        }\n\n        dispatch({\n          type: \"DATASET_ADD\",\n          value: addDatasetOptions,\n        });\n        const { dimensions, measures } = res.data.dataCubesComponents;\n        const { enabledChartTypes } = getEnabledChartTypes({\n          dimensions,\n          measures,\n          cubeCount: chartConfig.cubes.length,\n        });\n        dispatch({\n          type: \"CHART_TYPE_CHANGED\",\n          value: {\n            locale,\n            chartKey: state.activeChartKey,\n            chartType: enabledChartTypes[0],\n            isAddingNewCube: true,\n          },\n        });\n      } finally {\n        setHookState((hs) => ({ ...hs, fetching: false, otherIri: null }));\n      }\n    }\n  );\n\n  return [hookState, { addDataset }] as const;\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Button,\n  ButtonBase,\n  Checkbox,\n  CircularProgress,\n  Collapse,\n  DialogContent,\n  DialogProps,\n  DialogTitle,\n  Divider,\n  Grow,\n  IconButton,\n  IconButtonProps,\n  Input,\n  ListItemText,\n  MenuItem,\n  Select,\n  SelectChangeEvent,\n  Typography,\n  useEventCallback,\n} from \"@mui/material\";\nimport groupBy from \"lodash/groupBy\";\nimport keyBy from \"lodash/keyBy\";\nimport uniq from \"lodash/uniq\";\nimport {\n  type KeyboardEvent,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { DatasetResults } from \"@/browse/ui/dataset-results\";\nimport { SearchDatasetDraftsControl } from \"@/browse/ui/search-dataset-drafts-control\";\nimport { SearchDatasetResultsCount } from \"@/browse/ui/search-dataset-results-count\";\nimport { SearchDatasetSortControl } from \"@/browse/ui/search-dataset-sort-control\";\nimport { Flex } from \"@/components/flex\";\nimport { Tag } from \"@/components/tag\";\nimport { VisuallyHidden } from \"@/components/visually-hidden\";\nimport { ConfiguratorStateConfiguringChart } from \"@/config-types\";\nimport {\n  CautionAlert,\n  useCautionAlert,\n} from \"@/configurator/components/add-dataset-drawer/caution-alert\";\nimport { inferJoinBy } from \"@/configurator/components/add-dataset-drawer/infer-join-by\";\nimport { PreviewDataTable } from \"@/configurator/components/add-dataset-drawer/preview-table\";\nimport { SearchOptions } from \"@/configurator/components/add-dataset-drawer/types\";\nimport { useAddDataset } from \"@/configurator/components/add-dataset-drawer/use-add-dataset\";\nimport { useStyles } from \"@/configurator/components/add-dataset-drawer/use-styles\";\nimport { RightDrawer } from \"@/configurator/components/drawers\";\nimport {\n  ComponentTermsets,\n  Dimension,\n  isTemporalDimensionWithTimeUnit,\n  PartialSearchCube,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport {\n  useDataCubesComponentsQuery,\n  useDataCubesComponentTermsetsQuery,\n} from \"@/graphql/hooks\";\nimport { ComponentId, parseComponentId } from \"@/graphql/make-component-id\";\nimport {\n  SearchCubeFilterType,\n  SearchCubeResultOrder,\n  useSearchCubesQuery,\n} from \"@/graphql/query-hooks\";\nimport { Icon } from \"@/icons\";\nimport SvgIcClose from \"@/icons/components/IcClose\";\nimport SvgIcInfoCircle from \"@/icons/components/IcInfoCircle\";\nimport { Locale } from \"@/locales/locales\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEventEmitter } from \"@/utils/event-emitter\";\n\nconst DialogCloseButton = (props: IconButtonProps) => {\n  return (\n    <IconButton\n      {...props}\n      sx={{\n        position: \"absolute\",\n        top: \"1.5rem\",\n        right: \"1.5rem\",\n        ...props.sx,\n      }}\n    >\n      <SvgIcClose width={24} height={24} fontSize={24} />\n    </IconButton>\n  );\n};\n\nconst extractSearchOptions = (\n  dimensions: Dimension[],\n  termsets: ComponentTermsets[]\n): SearchOptions[] => {\n  const temporalDimensions =\n    dimensions.filter(isTemporalDimensionWithTimeUnit) ?? [];\n  const sharedDimensions = termsets ?? [];\n  const sharedDimensionsByFirstTermset = groupBy(\n    sharedDimensions,\n    (x) => x.termsets[0].iri\n  );\n  const sharedDimensionIds = sharedDimensions.map((dim) => dim.iri);\n  const sharedDimensionHasBeenAdded = new Set();\n\n  return [\n    ...temporalDimensions\n      // There are cases, e.g. for AMDP cubes, that a temporal dimension contains\n      // termsets (TemporalEntityDimension). When this happens, we prefer to show\n      // the dimension as a shared dimension.\n      .filter((dim) => !sharedDimensionIds.includes(dim.id))\n      .map((x) => {\n        return {\n          type: \"temporal\" as const,\n          id: x.id as ComponentId,\n          originalIds: x.originalIds ?? [\n            {\n              cubeIri: x.cubeIri,\n              dimensionId: x.id,\n            },\n          ],\n          label: x.label,\n          timeUnit: x.timeUnit,\n        };\n      }),\n    ...sharedDimensions\n      .map((x) => {\n        const parsedIri = parseComponentId(x.iri as ComponentId);\n        const firstTermset = x.termsets[0].iri;\n        const hasBeenAdded = sharedDimensionHasBeenAdded.has(firstTermset);\n        if (!parsedIri || hasBeenAdded) {\n          return;\n        }\n\n        sharedDimensionHasBeenAdded.add(firstTermset);\n\n        const allDimensions = sharedDimensionsByFirstTermset[firstTermset];\n        const label = allDimensions.map((d) => d.label).join(\", \");\n        const originalIds = allDimensions.map((ct) => {\n          return {\n            cubeIri: ct.cubeIri,\n            dimensionId: ct.iri as ComponentId,\n          };\n        });\n\n        return {\n          type: \"shared\" as const,\n          id: x.iri,\n          label: label,\n          termsets: x.termsets,\n          originalIds,\n        };\n      })\n      .filter(truthy),\n  ];\n};\n\nconst useMergeDatasetsData = ({\n  state,\n  locale,\n  pause,\n}: {\n  state: ConfiguratorStateConfiguringChart;\n  locale: Locale;\n  pause: boolean;\n}) => {\n  const commonQueryVariables = {\n    sourceType: state.dataSource.type,\n    sourceUrl: state.dataSource.url,\n    locale,\n  };\n\n  const activeChartConfig = state.chartConfigs.find(\n    (chartConfig) => chartConfig.key === state.activeChartKey\n  );\n\n  if (!activeChartConfig) {\n    throw Error(\"Could not find active chart config\");\n  }\n\n  const currentCubes = activeChartConfig.cubes;\n\n  // Getting cube dimensions, to find temporal dimensions\n  const [cubesComponentQuery] = useDataCubesComponentsQuery({\n    chartConfig: activeChartConfig,\n    variables: {\n      ...commonQueryVariables,\n      cubeFilters: currentCubes.map((cube) => ({\n        iri: cube.iri,\n        joinBy: cube.joinBy,\n      })),\n    },\n    pause,\n  });\n\n  // Getting cube termsets, to then search for cubes with at least one matching termset\n  const [cubeComponentTermsets] = useDataCubesComponentTermsetsQuery({\n    pause,\n    variables: {\n      locale,\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      cubeFilters: currentCubes.map((cube) => ({ iri: cube.iri })),\n    },\n  });\n\n  return {\n    components: cubesComponentQuery.data?.dataCubesComponents,\n    dimensions: cubesComponentQuery.data?.dataCubesComponents.dimensions ?? [],\n    termsets: cubeComponentTermsets.data?.dataCubeComponentTermsets ?? [],\n    fetching: cubesComponentQuery.fetching || cubeComponentTermsets.fetching,\n    ready:\n      cubesComponentQuery.data !== undefined &&\n      cubeComponentTermsets.data !== undefined,\n  };\n};\n\ntype SearchDimension = ReturnType<typeof extractSearchOptions>[number];\nconst isTemporalDimension = (\n  x: SearchDimension\n): x is Extract<SearchDimension, { type: \"temporal\" }> => x.type === \"temporal\";\n\nconst isSharedDimension = (\n  x: SearchDimension\n): x is Extract<SearchDimension, { type: \"shared\" }> => x.type === \"shared\";\n\nexport const AddDatasetDrawer = ({\n  state,\n  ...props\n}: {\n  state: ConfiguratorStateConfiguringChart;\n} & DialogProps) => {\n  const locale = useLocale();\n  const classes = useStyles();\n\n  const [query, setQuery] = useState(\"\");\n  const [order, setOrder] = useState<SearchCubeResultOrder>(\n    SearchCubeResultOrder.Score\n  );\n  const [includeDrafts, setIncludeDrafts] = useState(false);\n\n  const activeChartConfig = state.chartConfigs.find(\n    (chartConfig) => chartConfig.key === state.activeChartKey\n  );\n\n  if (!activeChartConfig) {\n    throw Error(\"Could not find active chart config\");\n  }\n\n  const currentCubes = activeChartConfig.cubes;\n\n  const {\n    dimensions,\n    termsets,\n    components,\n    ready: isMergeDatasetDataReady,\n    fetching: isMergeDatasetsDataFetching,\n  } = useMergeDatasetsData({\n    state,\n    locale,\n    pause: !props.open,\n  });\n\n  const [otherCube, setOtherCube] = useState<PartialSearchCube>();\n  const [{ fetching: addingDataset }, { addDataset }] = useAddDataset();\n\n  const { searchDimensionOptions, searchDimensionOptionsById } = useMemo(() => {\n    const options = extractSearchOptions(dimensions, termsets);\n    return {\n      searchDimensionOptions: options,\n      searchDimensionOptionsById: keyBy(options, (x) => x.id),\n    };\n  }, [dimensions, termsets]);\n\n  const [selectedSearchDimensions, setSelectedSearchDimensions] = useState<\n    typeof searchDimensionOptions | undefined\n  >(undefined);\n\n  // Initial setting of the selected search dimensions\n  useEffect(() => {\n    if (selectedSearchDimensions === undefined && termsets && components) {\n      setSelectedSearchDimensions(searchDimensionOptions);\n    }\n  }, [components, searchDimensionOptions, selectedSearchDimensions, termsets]);\n\n  const selectedSharedDimensions =\n    selectedSearchDimensions?.filter(isSharedDimension);\n\n  const selectedTemporalDimension = (selectedSearchDimensions ?? []).find(\n    isTemporalDimension\n  );\n\n  const isSearchQueryPaused =\n    !isMergeDatasetDataReady || !selectedSearchDimensions?.length;\n\n  const [searchQuery] = useSearchCubesQuery({\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      query,\n      order,\n      includeDrafts,\n      fetchDimensionTermsets: true,\n      filters: [\n        selectedTemporalDimension\n          ? {\n              type: SearchCubeFilterType.TemporalDimension,\n              value: selectedTemporalDimension.timeUnit,\n            }\n          : null,\n        selectedSharedDimensions && selectedSharedDimensions.length > 0\n          ? {\n              type: SearchCubeFilterType.DataCubeTermset,\n              value: uniq(\n                selectedSharedDimensions.flatMap((x) =>\n                  x.termsets.map((x) => x.iri)\n                )\n              ).join(\";\"),\n            }\n          : null,\n      ].filter(truthy),\n    },\n    pause: isSearchQueryPaused,\n  });\n\n  const rawSearchCubes = useMemo(() => {\n    const relevantCubeIris = currentCubes.map((d) => d.iri);\n    return (\n      searchQuery.data?.searchCubes.filter(\n        (d) => !relevantCubeIris.includes(d.cube.iri)\n      ) ?? []\n    );\n  }, [currentCubes, searchQuery.data?.searchCubes]);\n\n  const searchCubes = useMemo(() => {\n    if (currentCubes.length === 1) {\n      return rawSearchCubes;\n    } else {\n      return rawSearchCubes.filter((result) => {\n        const inferred = inferJoinBy(\n          selectedSearchDimensions ?? [],\n          result.cube\n        );\n        const resultJoinBy = inferred[result.cube.iri];\n\n        // TODO Verify that this is correct\n        // The idea is that we want to be sure that the cube has the same join by dimensions\n        // as the other cubes\n        return (\n          (resultJoinBy &&\n            resultJoinBy.length === selectedSearchDimensions?.length) ??\n          0\n        );\n      });\n    }\n  }, [rawSearchCubes, currentCubes, selectedSearchDimensions]);\n\n  const handleChangeSearchDimensions = (ev: SelectChangeEvent<string[]>) => {\n    const {\n      target: { value },\n    } = ev;\n    setSelectedSearchDimensions(\n      // On autofill we get a stringified value.\n      (typeof value === \"string\" ? value.split(\",\") : value)\n        ?.map((x) => {\n          return searchDimensionOptionsById[x];\n        })\n        .filter(truthy)\n    );\n  };\n\n  const handleClose: DialogProps[\"onClose\"] = useEventCallback((ev, reason) => {\n    props.onClose?.(ev, reason);\n    setQuery(\"\");\n    setSelectedSearchDimensions(undefined);\n    setOtherCube(undefined);\n  });\n\n  const handleClickOtherCube = (otherCube: PartialSearchCube) => {\n    setOtherCube(otherCube);\n  };\n\n  const { isOpen, open, close } = useCautionAlert();\n\n  const ee = useEventEmitter();\n\n  const inferredJoinBy = useMemo(\n    () =>\n      otherCube\n        ? inferJoinBy(selectedSearchDimensions ?? [], otherCube)\n        : undefined,\n    [selectedSearchDimensions, otherCube]\n  );\n\n  const handleConfirm = useEventCallback(async () => {\n    if (!components || !otherCube || !inferredJoinBy) {\n      return null;\n    }\n\n    await addDataset({\n      joinBy: inferredJoinBy,\n      otherCube: otherCube,\n    });\n    handleClose({}, \"escapeKeyDown\");\n\n    setTimeout(() => {\n      ee.emit(\"dataset-added\", { datasetIri: otherCube.iri });\n    }, 100);\n  });\n\n  const inputRef = useRef<HTMLInputElement>();\n\n  const handleKeyDown = useEventCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === \"Enter\") {\n        setQuery(e.currentTarget.value);\n      }\n    }\n  );\n\n  const handleReset = useEventCallback(() => {\n    setQuery(\"\");\n  });\n\n  return (\n    <RightDrawer {...props} onClose={handleClose}>\n      <Box className={classes.dialogCloseArea}>\n        {otherCube ? null : (\n          <Grow in={!isOpen}>\n            <div>\n              <IconButton onClick={() => open()}>\n                <SvgIcInfoCircle />\n              </IconButton>\n            </div>\n          </Grow>\n        )}\n        <DialogCloseButton\n          onClick={(ev) => handleClose(ev, \"escapeKeyDown\")}\n          sx={{ position: \"static\" }}\n        />\n      </Box>\n      {otherCube ? null : (\n        <>\n          <DialogTitle sx={{ typography: \"h2\" }}>\n            {t({\n              id: \"chart.datasets.add-dataset-dialog.title\",\n              message: \"Select dataset with shared dimensions\",\n            })}\n          </DialogTitle>\n          <DialogContent>\n            <Collapse in={isOpen}>\n              <Box sx={{ mb: 4 }}>\n                <CautionAlert onConfirm={close} />\n              </Box>\n            </Collapse>\n            <Typography variant=\"body1\" mb=\"2rem\">\n              <Trans id=\"chart.datasets.add-dataset-dialog.description\">\n                You can only combine datasets that share dimensions with the\n                same unit and resolution. By default, dimensions matching the\n                current chart are selected.\n              </Trans>\n            </Typography>\n            <Box display=\"flex\" alignItems=\"center\" gap=\"0.5rem\" mb=\"1rem\">\n              <Input\n                key={query}\n                id=\"search\"\n                inputProps={{ ref: inputRef }}\n                defaultValue={query}\n                placeholder={t({ id: \"dataset.search.placeholder\" })}\n                autoComplete=\"off\"\n                onKeyDown={handleKeyDown}\n                endAdornment={\n                  query !== \"\" ? (\n                    <ButtonBase data-testid=\"clearSearch\" onClick={handleReset}>\n                      <VisuallyHidden>\n                        <Trans id=\"controls.search.clear\">\n                          Clear search field\n                        </Trans>\n                      </VisuallyHidden>\n                      <Icon name=\"close\" />\n                    </ButtonBase>\n                  ) : (\n                    <ButtonBase data-testid=\"submitSearch\" type=\"submit\">\n                      <VisuallyHidden>\n                        <Trans id=\"dataset.search.label\">Search</Trans>\n                      </VisuallyHidden>\n                      <Icon name=\"search\" />\n                    </ButtonBase>\n                  )\n                }\n                sx={{ width: \"50%\" }}\n              />\n              <Select\n                multiple\n                value={(selectedSearchDimensions ?? []).map((x) => x.id)}\n                onChange={handleChangeSearchDimensions}\n                renderValue={(selected) =>\n                  isMergeDatasetsDataFetching ? (\n                    <CircularProgress size={12} />\n                  ) : selected.length === 0 ? (\n                    <Typography variant=\"body2\">\n                      {t({\n                        id: \"dataset.search.search-options.no-options-selected\",\n                      })}\n                    </Typography>\n                  ) : (\n                    selected.map((id, i) => {\n                      const value = searchDimensionOptionsById[id];\n                      return i < 2 ? (\n                        <Tag\n                          key={value.id}\n                          type=\"dimension\"\n                          sx={{ py: 0, mr: 2 }}\n                        >\n                          {value.label}\n                        </Tag>\n                      ) : i === 2 ? (\n                        <Tag key=\"more\" type=\"dimension\" sx={{ py: 0, mr: 2 }}>\n                          <Trans id=\"dataset.search.search-options.more-2-options-selected\">\n                            {selected.length - 2} more\n                          </Trans>\n                        </Tag>\n                      ) : null;\n                    })\n                  )\n                }\n                sx={{ width: \"50%\" }}\n              >\n                {searchDimensionOptions.map((sd) => (\n                  <MenuItem\n                    key={sd.label}\n                    value={sd.id}\n                    sx={{\n                      gap: 2,\n                      backgroundColor: \"transparent !important\",\n\n                      \"&:hover\": {\n                        backgroundColor: (t) =>\n                          `${t.palette.cobalt[50]} !important`,\n                      },\n                    }}\n                  >\n                    <Checkbox\n                      checked={\n                        selectedSearchDimensions &&\n                        !!selectedSearchDimensions.find((x) => x.id === sd.id)\n                      }\n                    />\n                    <ListItemText\n                      primary={<Tag type=\"dimension\">{sd.label}</Tag>}\n                    />\n                  </MenuItem>\n                ))}\n              </Select>\n              <Button\n                style={{ minWidth: \"fit-content\" }}\n                onClick={() => {\n                  if (inputRef.current) {\n                    setQuery(inputRef.current.value);\n                  }\n                }}\n              >\n                {t({ id: \"dataset.search.label\" })}\n              </Button>\n            </Box>\n\n            <Flex\n              sx={{\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                mb: 2,\n              }}\n            >\n              <SearchDatasetResultsCount cubes={searchCubes} />\n              <Flex sx={{ alignItems: \"center\", gap: 5 }}>\n                <SearchDatasetDraftsControl\n                  checked={includeDrafts}\n                  onChange={setIncludeDrafts}\n                />\n                <Divider flexItem orientation=\"vertical\" />\n                <SearchDatasetSortControl value={order} onChange={setOrder} />\n              </Flex>\n            </Flex>\n\n            {selectedSearchDimensions?.length === 0 ? (\n              <Typography variant=\"body1\">\n                <Trans id=\"dataset.search.at-least-one-compatible-dimension-selected\">\n                  At least one compatible dimension must be selected.\n                </Trans>\n              </Typography>\n            ) : (\n              <DatasetResults\n                cubes={searchCubes}\n                fetching={searchQuery.fetching || isMergeDatasetsDataFetching}\n                error={searchQuery.error}\n                datasetResultProps={({ cube }) => ({\n                  disableTitleLink: false,\n                  showDimensions: true,\n                  showTags: true,\n                  onClickTitle: (e) => {\n                    e.preventDefault();\n                    handleClickOtherCube(cube);\n                  },\n                })}\n              />\n            )}\n          </DialogContent>\n        </>\n      )}\n      {otherCube && inferredJoinBy ? (\n        <PreviewDataTable\n          key={otherCube.iri}\n          chartConfig={activeChartConfig}\n          dataSource={state.dataSource}\n          currentComponents={components}\n          existingCubes={currentCubes}\n          otherCube={otherCube}\n          inferredJoinBy={inferredJoinBy}\n          addingDataset={addingDataset}\n          onConfirm={handleConfirm}\n          onClickBack={() => setOtherCube(undefined)}\n          searchDimensionsSelected={selectedSearchDimensions ?? []}\n        />\n      ) : null}\n    </RightDrawer>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Button,\n  IconButton,\n  Theme,\n  tooltipClasses,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport uniqBy from \"lodash/uniqBy\";\nimport { useMemo, useState } from \"react\";\nimport { useClient } from \"urql\";\n\nimport { Flex } from \"@/components/flex\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport { useMetadataPanelStoreActions } from \"@/components/metadata-panel-store\";\nimport { useDisclosure } from \"@/components/use-disclosure\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { AddDatasetDrawer } from \"@/configurator/components/add-dataset-drawer/add-dataset-drawer\";\nimport { DatasetsBadge } from \"@/configurator/components/badges\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { DataCubeMetadata } from \"@/domain/data\";\nimport {\n  executeDataCubesComponentsQuery,\n  useDataCubesMetadataQuery,\n} from \"@/graphql/hooks\";\nimport { Icon } from \"@/icons\";\nimport SvgIcTrash from \"@/icons/components/IcTrash\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEventEmitter } from \"@/utils/event-emitter\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  row: {\n    borderLeft: \"0.25rem solid transparent\",\n    paddingLeft: \"0.25rem\",\n    marginLeft: \"-0.5rem\",\n    transition: \"border-left-color 1s ease\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n  },\n  added: {\n    transition: \"border-left-color 0.25s ease\",\n    borderLeftColor: theme.palette.success.main,\n  },\n  tooltipPopper: {\n    [`& .${tooltipClasses.tooltip}`]: {\n      maxWidth: \"none\",\n      padding: \"0.75rem\",\n      backgroundColor: theme.palette.success.light,\n      color: theme.palette.success.main,\n      lineHeight: 1.5,\n      whiteSpace: \"nowrap\",\n    },\n    [`& .${tooltipClasses.arrow}`]: {\n      color: theme.palette.success.light,\n    },\n  },\n}));\n\nconst DatasetRow = ({\n  canRemove,\n  handleDatasetClick,\n  cube,\n  added,\n  onRemoveAdded,\n}: {\n  canRemove: boolean;\n  handleDatasetClick: () => void;\n  cube: DataCubeMetadata;\n  /** When the dataset has been added just not */\n  added?: boolean;\n  onRemoveAdded?: () => void;\n}) => {\n  const locale = useLocale();\n  const client = useClient();\n  const classes = useStyles();\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const [loading, setLoading] = useState(false);\n\n  return (\n    <MaybeTooltip\n      title={\n        <Box alignItems=\"center\" display=\"flex\" gap=\"0.75rem\">\n          <Box color=\"success.main\">\n            <Icon name=\"checkmarkCircle\" />\n          </Box>\n          {t({\n            id: \"dataset.search.preview.added-dataset\",\n            message:\n              \"New dataset added. You can now use its data in the chart(s).\",\n          })}\n        </Box>\n      }\n      tooltipProps={{\n        open: added,\n        placement: \"right\",\n        PopperProps: {\n          onClick: () => onRemoveAdded?.(),\n          className: classes.tooltipPopper,\n        },\n      }}\n    >\n      <div\n        key={cube.iri}\n        className={clsx(classes.row, { [classes.added]: added })}\n      >\n        <Flex\n          sx={{ flexDirection: \"column\", alignItems: \"flex-start\", gap: 1 }}\n        >\n          <Button\n            variant=\"text\"\n            color=\"primary\"\n            size=\"sm\"\n            onClick={handleDatasetClick}\n          >\n            <Trans id=\"dataset.footnotes.dataset\">Dataset</Trans>\n          </Button>\n          <Typography variant=\"body3\">{cube.title}</Typography>\n        </Flex>\n        <div>\n          {canRemove ? (\n            <IconButton\n              disabled={loading}\n              onClick={async () => {\n                try {\n                  const chartConfig = getChartConfig(state);\n                  const newCubes = chartConfig.cubes.filter(\n                    (c) => c.iri !== cube.iri\n                  );\n                  await executeDataCubesComponentsQuery(client, {\n                    locale,\n                    sourceUrl: state.dataSource.url,\n                    sourceType: state.dataSource.type,\n                    cubeFilters: newCubes.map((cube) => ({\n                      iri: cube.iri,\n                      joinBy: newCubes.length > 1 ? cube.joinBy : undefined,\n                      loadValues: true,\n                    })),\n                  });\n                  dispatch({\n                    type: \"DATASET_REMOVE\",\n                    value: { locale, iri: cube.iri },\n                  });\n                } catch (e) {\n                  console.error(e);\n                } finally {\n                  setLoading(false);\n                }\n              }}\n              sx={{ padding: 2, transform: \"translate(8px, -8px)\" }}\n            >\n              <SvgIcTrash />\n            </IconButton>\n          ) : null}\n        </div>\n      </div>\n    </MaybeTooltip>\n  );\n};\n\nexport const DatasetsControlSection = () => {\n  const [state] = useConfiguratorState(isConfiguring);\n  const locale = useLocale();\n  const commonQueryVariables = {\n    sourceType: state.dataSource.type,\n    sourceUrl: state.dataSource.url,\n    locale,\n  };\n  const { setOpen, setActiveSection } = useMetadataPanelStoreActions();\n  const cubes = useMemo(() => {\n    const activeChartConfig = state.chartConfigs.find(\n      (x) => x.key === state.activeChartKey\n    );\n    const cubes = uniqBy(activeChartConfig?.cubes ?? [], (x) => x.iri);\n    return cubes;\n  }, [state.activeChartKey, state.chartConfigs]);\n  const [metadataQuery] = useDataCubesMetadataQuery({\n    variables: {\n      ...commonQueryVariables,\n      cubeFilters: cubes.map((cube) => ({\n        iri: cube.iri,\n      })),\n    },\n  });\n  const {\n    isOpen: isDatasetDialogOpen,\n    open: openDatasetDialog,\n    close: closeDatasetDialog,\n  } = useDisclosure();\n\n  const [addedIri, setAddedIri] = useState<string | null>(null);\n  useEventEmitter(\"dataset-added\", (ev) => {\n    setTimeout(() => {\n      setAddedIri(ev.datasetIri);\n    }, 300);\n    setTimeout(() => {\n      setAddedIri(null);\n    }, 5000);\n  });\n\n  const handleDatasetClick = () => {\n    setOpen(true);\n    setActiveSection(\"general\");\n  };\n\n  return (\n    <ControlSection\n      role=\"tablist\"\n      aria-labelledby=\"controls-data\"\n      collapse\n      defaultExpanded\n      hideTopBorder\n    >\n      <SectionTitle id=\"controls-data\">\n        <Trans id=\"controls.section.datasets.title\">Datasets</Trans>{\" \"}\n        <DatasetsBadge sx={{ ml: \"auto\", mr: 2 }} />\n      </SectionTitle>\n      <ControlSectionContent data-testid=\"configurator-datasets\">\n        <Flex sx={{ flexDirection: \"column\", gap: 6 }}>\n          {metadataQuery.data?.dataCubesMetadata.map((cube) => {\n            return (\n              <DatasetRow\n                key={cube.iri}\n                handleDatasetClick={handleDatasetClick}\n                canRemove={cubes.length > 1}\n                added={addedIri === cube.iri}\n                cube={cube}\n              />\n            );\n          })}\n        </Flex>\n        <Flex sx={{ justifyContent: \"end\" }}>\n          <Button\n            variant=\"text\"\n            size=\"sm\"\n            color=\"primary\"\n            startIcon={<Icon name=\"plus\" size={20} />}\n            onClick={openDatasetDialog}\n          >\n            {t({ id: \"chart.datasets.add\", message: \"Add dataset\" })}\n          </Button>\n        </Flex>\n        <AddDatasetDrawer\n          state={state}\n          open={isDatasetDialogOpen}\n          onClose={closeDatasetDialog}\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\n\nimport { getFieldComponentId } from \"@/charts\";\nimport { ANIMATION_FIELD_SPEC } from \"@/charts/chart-config-ui-options\";\nimport {\n  ConfiguratorStateConfiguringChart,\n  isAnimationInConfig,\n} from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  ControlSectionSkeleton,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ControlTabField } from \"@/configurator/components/field\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const InteractiveFiltersConfigurator = ({\n  state,\n}: {\n  state: ConfiguratorStateConfiguringChart;\n}) => {\n  const { dataSource } = state;\n  const chartConfig = getChartConfig(state);\n  const { fields } = chartConfig;\n  const locale = useLocale();\n  const [{ data }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        joinBy: cube.joinBy,\n        loadValues: true,\n      })),\n    },\n  });\n\n  if (data?.dataCubesComponents) {\n    const { dimensions, measures } = data.dataCubesComponents;\n    const allComponents = [...dimensions, ...measures];\n\n    const animationComponent = allComponents.find(\n      (d) => d.id === getFieldComponentId(fields, \"animation\")\n    );\n    const canFilterAnimation = isAnimationInConfig(chartConfig);\n\n    if (!canFilterAnimation) {\n      return null;\n    }\n\n    return (\n      <ControlSection\n        role=\"tablist\"\n        aria-labelledby=\"controls-interactive-filters\"\n        collapse\n        defaultExpanded={false}\n      >\n        <SectionTitle id=\"controls-interactive-filters\">\n          <Trans id=\"controls.section.interactive.filters\">Animations</Trans>\n        </SectionTitle>\n        <ControlSectionContent gap=\"none\" px=\"none\">\n          {/* Animation is technically a field, so we need to use an appropriate component. */}\n          <ControlTabField\n            chartConfig={chartConfig}\n            fieldComponents={animationComponent ? [animationComponent] : []}\n            value=\"animation\"\n            labelId={null}\n            {...ANIMATION_FIELD_SPEC.getDisabledState?.(\n              chartConfig,\n              dimensions,\n              []\n            )}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n    );\n  } else {\n    return (\n      <ControlSection\n        role=\"tablist\"\n        aria-labelledby=\"controls-interactive-filters\"\n        collapse\n        defaultExpanded={false}\n      >\n        <SectionTitle id=\"controls-interactive-filters\">\n          <Trans id=\"controls.section.interactive.filters\">Animations</Trans>\n        </SectionTitle>\n        <ControlSectionSkeleton showTitle={false} sx={{ mt: 0 }} />\n      </ControlSection>\n    );\n  }\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Button,\n  CircularProgress,\n  IconButton,\n  Menu,\n  MenuItem,\n  Theme,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport groupBy from \"lodash/groupBy\";\nimport isEmpty from \"lodash/isEmpty\";\nimport isEqual from \"lodash/isEqual\";\nimport pickBy from \"lodash/pickBy\";\nimport sortBy from \"lodash/sortBy\";\nimport uniq from \"lodash/uniq\";\nimport {\n  Fragment,\n  ReactNode,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  DragDropContext,\n  Draggable,\n  Droppable,\n  OnDragEndResponder,\n} from \"react-beautiful-dnd\";\nimport { useClient } from \"urql\";\n\nimport { getChartSpec } from \"@/charts/chart-config-ui-options\";\nimport { useQueryFilters } from \"@/charts/shared/chart-helpers\";\nimport {\n  getPossibleFiltersQueryVariables,\n  skipPossibleFiltersQuery,\n} from \"@/charts/shared/possible-filters\";\nimport { Flex } from \"@/components/flex\";\nimport { Switch } from \"@/components/form\";\nimport { HEADER_HEIGHT_CSS_VAR } from \"@/components/header-constants\";\nimport {\n  MetadataPanel,\n  OpenMetadataPanelWrapper,\n} from \"@/components/metadata-panel\";\nimport { MoveDragButton } from \"@/components/move-drag-button\";\nimport { useDisclosure } from \"@/components/use-disclosure\";\nimport {\n  ChartConfig,\n  ConfiguratorStateConfiguringChart,\n  ConfiguratorStatePublishing,\n  DashboardFiltersConfig,\n  DataSource,\n  Filters,\n  isMapConfig,\n} from \"@/config-types\";\nimport { getChartConfig, getChartConfigFilters } from \"@/config-utils\";\nimport { ChartAnnotator } from \"@/configurator/components/annotators\";\nimport { FiltersBadge } from \"@/configurator/components/badges\";\nimport { ChartAnnotations } from \"@/configurator/components/chart-annotations/chart-annotations\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  ControlSectionSkeleton,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ShowFilterAreaOpen } from \"@/configurator/components/chart-controls/show-filter-area-open\";\nimport { ChartTypeSelector } from \"@/configurator/components/chart-type-selector\";\nimport { DatasetsControlSection } from \"@/configurator/components/dataset-control-section\";\nimport {\n  ControlTabField,\n  DataFilterSelect,\n  DataFilterTemporal,\n  dimensionToFieldProps,\n  OnOffControlTabField,\n} from \"@/configurator/components/field\";\nimport { canRenderDatePickerField } from \"@/configurator/components/field-date-picker\";\nimport {\n  getFiltersByMappingStatus,\n  isConfiguring,\n  moveFilterField,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useInteractiveDataFilterToggle } from \"@/configurator/interactive-filters/interactive-filters-config-state\";\nimport { InteractiveFiltersConfigurator } from \"@/configurator/interactive-filters/interactive-filters-configurator\";\nimport {\n  Dimension,\n  isStandardErrorDimension,\n  isTemporalDimension,\n  Measure,\n} from \"@/domain/data\";\nimport { isMostRecentValue } from \"@/domain/most-recent-value\";\nimport { truthy } from \"@/domain/types\";\nimport {\n  useDataCubesComponentsQuery,\n  useDataCubesMetadataQuery,\n  useDataCubesObservationsQuery,\n} from \"@/graphql/hooks\";\nimport { isJoinByCube } from \"@/graphql/join\";\nimport {\n  PossibleFiltersDocument,\n  PossibleFiltersQuery,\n  PossibleFiltersQueryVariables,\n} from \"@/graphql/query-hooks\";\nimport { Icon } from \"@/icons\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { InteractiveFiltersChartProvider } from \"@/stores/interactive-filters\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const DataFilterSelectGeneric = ({\n  rawDimension,\n  filterDimensionIds,\n  index,\n  disabled,\n  onRemove,\n  sideControls,\n  disableLabel,\n}: {\n  rawDimension: Dimension;\n  filterDimensionIds: string[];\n  index: number;\n  disabled?: boolean;\n  onRemove?: () => void;\n  sideControls?: ReactNode;\n  disableLabel?: boolean;\n}) => {\n  const locale = useLocale();\n  const [state] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n  const [{ data, fetching }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => {\n        const rawFilters = pickBy(cube.filters, (_, key) =>\n          filterDimensionIds.includes(key)\n        );\n\n        return {\n          iri: cube.iri,\n          joinBy: cube.joinBy,\n          componentIds: [rawDimension.id],\n          filters: Object.keys(rawFilters).length > 0 ? rawFilters : undefined,\n          loadValues: true,\n        };\n      }),\n    },\n    keepPreviousData: true,\n  });\n\n  const dimension =\n    data?.dataCubesComponents?.dimensions.find(\n      (d) => d.cubeIri === rawDimension.cubeIri\n    ) ?? rawDimension;\n\n  const sharedProps = {\n    dimension,\n    label: disableLabel ? null : (\n      <>\n        <OpenMetadataPanelWrapper component={dimension}>\n          <Typography variant=\"caption\">\n            {`${index + 1}. ${dimension.label}`}\n          </Typography>\n        </OpenMetadataPanelWrapper>\n        <Flex\n          sx={{\n            alignSelf: \"flex-end\",\n            alignItems: \"center\",\n            gap: 1,\n            marginRight: sideControls && dimension.isKeyDimension ? 7 : 0,\n          }}\n        >\n          <InteractiveDataFilterToggle id={dimension.id} />\n          {dimension.isKeyDimension ? null : (\n            <IconButton\n              disabled={disabled}\n              size=\"small\"\n              onClick={onRemove}\n              sx={{ p: 0, transform: \"translateY(-5%)\" }}\n            >\n              <Icon name=\"trash\" size={16} />\n            </IconButton>\n          )}\n        </Flex>\n      </>\n    ),\n    sideControls,\n    id: `select-single-filter-${index}`,\n    disabled: fetching || disabled,\n    optional: !dimension.isKeyDimension,\n    loading: fetching,\n  };\n\n  if (\n    isTemporalDimension(dimension) &&\n    canRenderDatePickerField(dimension.timeUnit)\n  ) {\n    return (\n      <DataFilterTemporal\n        {...sharedProps}\n        dimension={dimension}\n        timeUnit={dimension.timeUnit}\n      />\n    );\n  } else {\n    return (\n      <DataFilterSelect {...sharedProps} hierarchy={dimension.hierarchy} />\n    );\n  }\n};\n\n/**\n * This runs every time the state changes and it ensures that the selected filters\n * return at least 1 observation. Otherwise filters are reloaded.\n */\nconst useEnsurePossibleFilters = ({\n  state,\n}: {\n  state: ConfiguratorStateConfiguringChart | ConfiguratorStatePublishing;\n}) => {\n  const [, dispatch] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n  const [fetching, setFetching] = useState(false);\n  const [error, setError] = useState<Error>();\n  const lastFilters = useRef<Record<string, Filters>>({});\n  const client = useClient();\n  const joinByIds = useMemo(() => {\n    return chartConfig.cubes.flatMap((cube) => cube.joinBy).filter(truthy);\n  }, [chartConfig.cubes]);\n\n  useEffect(() => {\n    const run = async () => {\n      chartConfig.cubes.forEach(async (cube) => {\n        const { mappedFilters, unmappedFilters } = getFiltersByMappingStatus(\n          chartConfig,\n          { cubeIri: cube.iri, joinByIds }\n        );\n\n        if (\n          skipPossibleFiltersQuery(\n            lastFilters.current[cube.iri],\n            unmappedFilters\n          )\n        ) {\n          return;\n        }\n\n        lastFilters.current[cube.iri] = unmappedFilters;\n        setFetching(true);\n        const variables = getPossibleFiltersQueryVariables({\n          cubeIri: cube.iri,\n          dataSource: state.dataSource,\n          unmappedFilters,\n        });\n        const { data, error } = await client\n          .query<\n            PossibleFiltersQuery,\n            PossibleFiltersQueryVariables\n          >(PossibleFiltersDocument, variables)\n          .toPromise();\n\n        if (error || !data) {\n          setError(error);\n          setFetching(false);\n          console.error(\"Could not fetch possible filters\", error);\n\n          return;\n        }\n\n        setError(undefined);\n        setFetching(false);\n\n        const filters = Object.assign(\n          Object.fromEntries(\n            data.possibleFilters.map((x) => [\n              x.id,\n              { type: x.type, value: x.value },\n            ])\n          ) as Filters,\n          mappedFilters\n        );\n\n        const oldFilters = getChartConfigFilters(chartConfig.cubes, {\n          cubeIri: cube.iri,\n        });\n\n        // Replace resolved values with potential dynamic max values to not\n        // override the dynamic max value with the resolved value\n        for (const [key, value] of Object.entries(oldFilters)) {\n          if (\n            value.type === \"single\" &&\n            isMostRecentValue(value.value) &&\n            filters[key]\n          ) {\n            filters[key] = {\n              type: \"single\",\n              value: `${value.value}`,\n            };\n          }\n        }\n\n        if (!isEqual(filters, oldFilters) && !isEmpty(filters)) {\n          dispatch({\n            type: \"CHART_CONFIG_FILTERS_UPDATE\",\n            value: {\n              cubeIri: cube.iri,\n              filters,\n            },\n          });\n        }\n      });\n    };\n\n    run();\n  }, [\n    client,\n    dispatch,\n    chartConfig,\n    chartConfig.cubes,\n    state.dataSource,\n    joinByIds,\n  ]);\n\n  return { error, fetching };\n};\n\nexport const getFilterReorderCubeFilters = (\n  chartConfig: ChartConfig,\n  { joinByIds }: { joinByIds: string[] }\n) => {\n  return chartConfig.cubes.map(({ iri, joinBy }) => {\n    const { unmappedFilters } = getFiltersByMappingStatus(chartConfig, {\n      cubeIri: iri,\n      joinByIds,\n    });\n\n    return {\n      iri,\n      filters:\n        Object.keys(unmappedFilters).length > 0 ? unmappedFilters : undefined,\n      joinBy,\n      loadValues: true,\n    };\n  });\n};\n\nconst useFilterReorder = ({\n  onAddDimensionFilter,\n}: {\n  onAddDimensionFilter?: () => void;\n} = {}) => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const locale = useLocale();\n  const filters = getChartConfigFilters(chartConfig.cubes, { joined: true });\n  const joinByIds = useMemo(() => {\n    return chartConfig.cubes.flatMap((cube) => cube.joinBy).filter(truthy);\n  }, [chartConfig.cubes]);\n  const { mappedFiltersIds } = useMemo(() => {\n    return getFiltersByMappingStatus(chartConfig, { joinByIds });\n  }, [chartConfig, joinByIds]);\n\n  const variables = useMemo(() => {\n    const cubeFilters = getFilterReorderCubeFilters(chartConfig, {\n      joinByIds,\n    });\n\n    // This is important for urql not to think that filters\n    // are the same  while the order of the keys has changed.\n    // If this is not present, we'll have outdated dimension\n    // values after we change the filter order\n    const reQueryKey = cubeFilters.reduce((acc, d) => {\n      return `${acc}${d.iri}${JSON.stringify(d.filters)}`;\n    }, \"\");\n\n    return {\n      cubeFilters,\n      reQueryKey: reQueryKey ? reQueryKey : undefined,\n    };\n  }, [chartConfig, joinByIds]);\n\n  const [\n    { data: componentsData, fetching: componentsFetching },\n    executeComponentsQuery,\n  ] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      ...variables,\n    },\n    keepPreviousData: true,\n  });\n\n  useEffect(() => {\n    executeComponentsQuery({\n      variables: {\n        sourceType: state.dataSource.type,\n        sourceUrl: state.dataSource.url,\n        locale,\n        ...variables,\n      },\n    });\n  }, [\n    variables,\n    executeComponentsQuery,\n    state.dataSource.type,\n    state.dataSource.url,\n    locale,\n  ]);\n\n  const dimensions = componentsData?.dataCubesComponents?.dimensions;\n  const measures = componentsData?.dataCubesComponents?.measures;\n\n  // Handlers\n  const handleMove = useEvent((dimensionId: string, delta: number) => {\n    if (!dimensions || !measures) {\n      return;\n    }\n\n    const dimension = dimensions.find((d) => d.id === dimensionId);\n\n    if (dimension) {\n      const newChartConfig = moveFilterField(chartConfig, {\n        dimension,\n        delta,\n        possibleValues: dimension ? dimension.values.map((d) => d.value) : [],\n      });\n\n      dispatch({\n        type: \"CHART_CONFIG_REPLACED\",\n        value: {\n          chartConfig: newChartConfig,\n          dataCubesComponents: {\n            dimensions,\n            measures,\n          },\n        },\n      });\n    }\n  });\n\n  const handleAddDimensionFilter = useEvent((dimension: Dimension) => {\n    onAddDimensionFilter?.();\n    const filterValue = dimension.values[0];\n    dispatch({\n      type: \"FILTER_SET_SINGLE\",\n      value: {\n        filters: dimensionToFieldProps(dimension),\n        value: `${filterValue.value}`,\n      },\n    });\n  });\n\n  const handleRemoveDimensionFilter = useEvent((dimension: Dimension) => {\n    dispatch({\n      type: \"FILTER_REMOVE_SINGLE\",\n      value: {\n        filters: dimensionToFieldProps(dimension),\n      },\n    });\n  });\n\n  const handleDragEnd: OnDragEndResponder = useEvent((result) => {\n    const sourceIndex = result.source?.index;\n    const destinationIndex = result.destination?.index;\n    if (\n      typeof sourceIndex !== \"number\" ||\n      typeof destinationIndex !== \"number\" ||\n      result.source === result.destination\n    ) {\n      return;\n    }\n    const delta = destinationIndex - sourceIndex;\n    handleMove(result.draggableId, delta);\n  });\n\n  const { fetching: possibleFiltersFetching } = useEnsurePossibleFilters({\n    state,\n  });\n  const fetching = possibleFiltersFetching || componentsFetching;\n  const {\n    filterDimensions,\n    filterDimensionsByCubeIri,\n    addableDimensions,\n    addableDimensionsByCubeIri,\n    missingDimensions,\n  } = useMemo(() => {\n    const keysOrder = Object.fromEntries(\n      Object.keys(filters).map((k, i) => [k, i])\n    );\n    const filterDimensions = sortBy(\n      dimensions?.filter(\n        (dim) =>\n          !mappedFiltersIds.has(dim.id) && keysOrder[dim.id] !== undefined\n      ) ?? [],\n      [(x) => keysOrder[x.id] ?? Infinity]\n    );\n    const filterDimensionsByCubeIri = groupBy(\n      filterDimensions,\n      (d) => d.cubeIri\n    );\n    const allCubeIris = uniq(dimensions?.map((d) => d.cubeIri));\n\n    // Make sure we don't forget about merged cubes that have non-key-dimensions\n    // available, but no key dimension available (might be the case when merging)\n    // cubes by a lot of key dimensions that get joinBy cube iri then.\n    for (const iri of allCubeIris) {\n      if (!filterDimensionsByCubeIri[iri]) {\n        filterDimensionsByCubeIri[iri] = [];\n      }\n    }\n\n    const addableDimensions =\n      dimensions?.filter(\n        (dim) =>\n          !mappedFiltersIds.has(dim.id) &&\n          keysOrder[dim.id] === undefined &&\n          !isStandardErrorDimension(dim)\n      ) ?? [];\n    const addableDimensionsByCubeIri = groupBy(\n      addableDimensions,\n      (d) => d.cubeIri\n    );\n    const missingDimensions = dimensions?.filter(\n      (d) => d.isKeyDimension && addableDimensions?.includes(d)\n    );\n\n    return {\n      filterDimensions,\n      filterDimensionsByCubeIri,\n      addableDimensions,\n      addableDimensionsByCubeIri,\n      missingDimensions,\n    };\n  }, [dimensions, filters, mappedFiltersIds]);\n\n  // Technically it's possible to have a key dimension that is not in the filters\n  // and not mapped. This could be achieved for example by manually modifying the\n  // localStorage state and removing a filter. This is a safety net to ensure that\n  // the relevant key dimensions are always in the filters.\n  useEffect(() => {\n    if (missingDimensions && missingDimensions.length > 0) {\n      missingDimensions.forEach(handleAddDimensionFilter);\n    }\n  }, [handleAddDimensionFilter, missingDimensions]);\n\n  return {\n    handleRemoveDimensionFilter,\n    handleAddDimensionFilter,\n    handleDragEnd,\n    fetching,\n    dimensions,\n    measures,\n    filterDimensions,\n    filterDimensionsByCubeIri,\n    addableDimensions,\n    addableDimensionsByCubeIri,\n  };\n};\n\nconst useStyles = makeStyles<Theme, { fetching: boolean }>((theme) => ({\n  loadingIndicator: {\n    color: theme.palette.grey[700],\n    display: \"inline-block\",\n    marginLeft: 8,\n  },\n  filterRow: {\n    overflow: \"hidden\",\n    width: \"100%\",\n    marginBottom: theme.spacing(5),\n\n    \"& > *\": {\n      overflow: \"hidden\",\n    },\n\n    \"&:last-child\": {\n      marginBottom: 0,\n    },\n  },\n  addDimensionContainer: {\n    \"& .menu-button\": {\n      background: \"transparent\",\n      border: 0,\n      padding: 0,\n    },\n  },\n}));\n\nconst InteractiveDataFilterToggle = ({ id }: { id: string }) => {\n  const { checked, onChange } = useInteractiveDataFilterToggle(id);\n\n  return (\n    <Switch\n      size=\"sm\"\n      label={t({\n        id: \"controls.filters.interactive.toggle\",\n        message: \"Interactive\",\n      })}\n      checked={checked}\n      onChange={onChange}\n    />\n  );\n};\n\nexport const ChartConfigurator = ({\n  state,\n}: {\n  state: ConfiguratorStateConfiguringChart;\n}) => {\n  const locale = useLocale();\n  const chartConfig = getChartConfig(state);\n  const [\n    {\n      data: dataCubesMetadataData,\n      fetching: fetchingDataCubesMetadata,\n      error: dataCubesMetadataError,\n    },\n  ] = useDataCubesMetadataQuery({\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => ({ iri: cube.iri })),\n    },\n    pause: chartConfig.cubes.length === 1,\n  });\n  const cubes = dataCubesMetadataData?.dataCubesMetadata;\n  const {\n    fetching: fetchingData,\n    handleRemoveDimensionFilter,\n    handleDragEnd,\n    dimensions,\n    measures,\n    filterDimensions,\n    filterDimensionsByCubeIri,\n    addableDimensions,\n    addableDimensionsByCubeIri,\n  } = useFilterReorder();\n  const { fetching: fetchingPossibleFilters, error: possibleFiltersError } =\n    useEnsurePossibleFilters({\n      state,\n    });\n  const error = dataCubesMetadataError || possibleFiltersError;\n  const fetching =\n    fetchingPossibleFilters || fetchingData || fetchingDataCubesMetadata;\n  const classes = useStyles({ fetching });\n  const components = useMemo(() => {\n    return [...(dimensions ?? []), ...(measures ?? [])];\n  }, [dimensions, measures]);\n\n  if (components.length === 0) {\n    return (\n      <>\n        <ControlSectionSkeleton />\n        <ControlSectionSkeleton />\n      </>\n    );\n  }\n\n  return (\n    <InteractiveFiltersChartProvider chartConfigKey={chartConfig.key}>\n      <DatasetsControlSection />\n      <ControlSection\n        role=\"tablist\"\n        aria-labelledby=\"controls-chart-type\"\n        collapse\n      >\n        <SectionTitle id=\"controls-chart-type\">\n          <Trans id=\"controls.select.chart.type\">Chart Type</Trans>\n        </SectionTitle>\n        <ControlSectionContent>\n          <ChartTypeSelector\n            showHelp={false}\n            chartKey={chartConfig.key}\n            state={state}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      <ControlSection\n        role=\"tablist\"\n        aria-labelledby=\"controls-chart-options\"\n        collapse\n      >\n        <SectionTitle id=\"controls-chart-options\">\n          <Trans id=\"controls.section.chart.options\">Chart Options</Trans>\n        </SectionTitle>\n        <ControlSectionContent gap=\"none\" px=\"none\" role=\"tablist\">\n          <ChartFields\n            dataSource={state.dataSource}\n            chartConfig={chartConfig}\n            dashboardFilters={state.dashboardFilters}\n            dimensions={dimensions}\n            measures={measures}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      {filterDimensions.length === 0 &&\n      addableDimensions &&\n      addableDimensions.length === 0 ? null : (\n        <ControlSection collapse>\n          <SectionTitle id=\"controls-data\">\n            <Trans id=\"controls.section.data.filters\">Filters</Trans>{\" \"}\n            {fetching ? (\n              <CircularProgress\n                size={12}\n                className={classes.loadingIndicator}\n              />\n            ) : null}\n            <FiltersBadge sx={{ ml: \"auto\", mr: 2 }} />\n          </SectionTitle>\n          <ControlSectionContent\n            aria-labelledby=\"controls-data\"\n            data-testid=\"configurator-filters\"\n          >\n            {error ? (\n              <Typography variant=\"body2\" color=\"error\">\n                <Trans id=\"controls.section.data.filters.possible-filters-error\">\n                  An error happened while fetching possible filters, please\n                  retry later or reload the page.\n                </Trans>\n              </Typography>\n            ) : null}\n            {filterDimensions.length === 0 ? (\n              <Typography\n                variant=\"body2\"\n                color=\"text.secondary\"\n                sx={{ mb: -4 }}\n              >\n                <Trans id=\"controls.section.data.filters.none\">\n                  No filters\n                </Trans>\n              </Typography>\n            ) : (\n              <Box sx={{ my: 2 }}>\n                <ShowFilterAreaOpen chartConfig={chartConfig} />\n              </Box>\n            )}\n            {Object.entries(filterDimensionsByCubeIri)\n              .sort((a, b) =>\n                isJoinByCube(a[0])\n                  ? -1\n                  : isJoinByCube(b[0])\n                    ? 1\n                    : a[0].localeCompare(b[0])\n              )\n              .map(([cubeIri, dims]) => {\n                const cubeTitle = cubes?.find(\n                  (cube) => cube.iri === cubeIri\n                )?.title;\n                const cubeAddableDims = addableDimensionsByCubeIri[cubeIri];\n\n                return dims.length > 0 ? (\n                  <Fragment key={cubeIri}>\n                    <Box sx={{ py: 2 }}>\n                      {cubeTitle ? (\n                        <Typography\n                          variant=\"caption\"\n                          component=\"p\"\n                          sx={{ mb: 3, color: \"text.secondary\" }}\n                        >\n                          {cubeTitle}\n                        </Typography>\n                      ) : null}\n                      <DragDropContext onDragEnd={handleDragEnd}>\n                        <Droppable droppableId=\"filters\">\n                          {(provided) => (\n                            <Box\n                              {...provided.droppableProps}\n                              ref={provided.innerRef}\n                            >\n                              {dims.map((dim, i) => (\n                                <Draggable\n                                  key={dim.id}\n                                  isDragDisabled={fetching}\n                                  draggableId={dim.id}\n                                  index={i}\n                                >\n                                  {(provided) => (\n                                    <div\n                                      ref={provided.innerRef}\n                                      className={classes.filterRow}\n                                      {...provided.dragHandleProps}\n                                      {...provided.draggableProps}\n                                    >\n                                      <DataFilterSelectGeneric\n                                        key={dim.id}\n                                        rawDimension={dim}\n                                        filterDimensionIds={filterDimensions\n                                          .filter((d) => d.cubeIri === cubeIri)\n                                          .slice(0, i)\n                                          .map((d) => d.id)}\n                                        index={i}\n                                        disabled={fetching}\n                                        onRemove={() =>\n                                          handleRemoveDimensionFilter(dim)\n                                        }\n                                        sideControls={<MoveDragButton />}\n                                      />\n                                    </div>\n                                  )}\n                                </Draggable>\n                              ))}\n                              {provided.placeholder}\n                            </Box>\n                          )}\n                        </Droppable>\n                      </DragDropContext>\n                    </Box>\n                    {cubeAddableDims && cubeAddableDims.length > 0 ? (\n                      <AddFilterButton dims={cubeAddableDims} />\n                    ) : null}\n                  </Fragment>\n                ) : null;\n              })}\n          </ControlSectionContent>\n        </ControlSection>\n      )}\n      <ChartAnnotator />\n      <ChartAnnotations />\n      {chartConfig.chartType !== \"table\" && (\n        <InteractiveFiltersConfigurator state={state} />\n      )}\n      <MetadataPanel\n        dataSource={state.dataSource}\n        chartConfig={chartConfig}\n        dashboardFilters={state.dashboardFilters}\n        components={components}\n        top={HEADER_HEIGHT_CSS_VAR}\n        renderToggle={false}\n      />\n    </InteractiveFiltersChartProvider>\n  );\n};\n\nconst AddFilterButton = ({ dims }: { dims: Dimension[] }) => {\n  const ref = useRef<HTMLButtonElement>(null);\n  const {\n    isOpen: isMenuOpen,\n    open: openMenu,\n    close: closeMenu,\n  } = useDisclosure();\n  const { handleAddDimensionFilter } = useFilterReorder({\n    onAddDimensionFilter: () => closeMenu(),\n  });\n  const classes = useStyles({ fetching: false });\n\n  return (\n    <Box className={classes.addDimensionContainer}>\n      <Button\n        variant=\"outlined\"\n        size=\"sm\"\n        ref={ref}\n        onClick={openMenu}\n        startIcon={<Icon name=\"plus\" size={20} />}\n      >\n        <Trans id=\"controls.add-filter\">Add filter</Trans>\n      </Button>\n      <Menu anchorEl={ref.current} open={isMenuOpen} onClose={closeMenu}>\n        {dims.map((dim) => (\n          <MenuItem key={dim.id} onClick={() => handleAddDimensionFilter(dim)}>\n            {dim.label}\n          </MenuItem>\n        ))}\n      </Menu>\n    </Box>\n  );\n};\n\nconst ChartFields = ({\n  dataSource,\n  chartConfig,\n  dashboardFilters,\n  dimensions,\n  measures,\n}: {\n  dataSource: DataSource;\n  chartConfig: ChartConfig;\n  dashboardFilters: DashboardFiltersConfig | undefined;\n  dimensions?: Dimension[];\n  measures?: Measure[];\n}) => {\n  const components = [...(dimensions ?? []), ...(measures ?? [])];\n  const queryFilters = useQueryFilters({ chartConfig, dashboardFilters });\n  const locale = useLocale();\n  const [{ data: observationsData }] = useDataCubesObservationsQuery({\n    chartConfig,\n    variables: {\n      locale,\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      cubeFilters: queryFilters,\n    },\n  });\n  const observations = observationsData?.dataCubesObservations?.data ?? [];\n\n  return (\n    <>\n      {getChartSpec(chartConfig)\n        .encodings.filter((d) => !d.hide)\n        .map(({ field, getDisabledState, idAttributes }) => {\n          const componentIds = idAttributes\n            .flatMap(\n              (x) =>\n                // componentId or componentIds\n                (chartConfig.fields as any)[field]?.[x] as string | string[]\n            )\n            .filter(truthy);\n          const fieldComponents = componentIds\n            .map((cId) => components.find((d) => cId === d.id))\n            .filter(truthy);\n          const baseLayer = isMapConfig(chartConfig) && field === \"baseLayer\";\n          const customLayers =\n            isMapConfig(chartConfig) && field === \"customLayers\";\n\n          return baseLayer ? (\n            <OnOffControlTabField\n              key={field}\n              value={field}\n              icon=\"baseLayer\"\n              label={<Trans id=\"chart.map.layers.base\">Base map</Trans>}\n              active={chartConfig.baseLayer.show}\n            />\n          ) : customLayers ? (\n            <OnOffControlTabField\n              key={field}\n              value={field}\n              icon=\"customLayers\"\n              label={\n                <Trans id=\"chart.map.layers.custom-layers\">Import map</Trans>\n              }\n              active={\n                chartConfig.baseLayer.show &&\n                chartConfig.baseLayer.customLayers.length > 0\n              }\n            />\n          ) : (\n            <ControlTabField\n              key={field}\n              chartConfig={chartConfig}\n              fieldComponents={\n                isMapConfig(chartConfig) && field === \"symbolLayer\"\n                  ? chartConfig.fields.symbolLayer\n                    ? fieldComponents\n                    : undefined\n                  : fieldComponents\n              }\n              value={field}\n              labelId={`${chartConfig.chartType}.${field}`}\n              {...getDisabledState?.(chartConfig, components, observations)}\n            />\n          );\n        })}\n    </>\n  );\n};\n","import { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { ChartOptionCheckboxField } from \"@/configurator/components/field\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { canUseAbbreviations } from \"@/configurator/components/ui-helpers\";\nimport { Component } from \"@/domain/data\";\n\nexport const Abbreviations = ({\n  field,\n  path,\n  component,\n}: {\n  field: EncodingFieldType;\n  path?: string;\n  component: Component | undefined;\n}) => {\n  const disabled = !canUseAbbreviations(component);\n\n  return (\n    <ChartOptionCheckboxField\n      data-testid=\"use-abbreviations\"\n      label={getFieldLabel(\"abbreviations\")}\n      field={field}\n      path={path ? `${path}.useAbbreviations` : \"useAbbreviations\"}\n      disabled={disabled}\n    />\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, Tooltip, Typography } from \"@mui/material\";\n\nimport { Flex } from \"@/components/flex\";\nimport { RadioGroup } from \"@/components/form\";\nimport { type AnimationField as AnimationFieldType } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  ChartOptionRadioField,\n  ChartOptionSwitchField,\n} from \"@/configurator/components/field\";\nimport SvgIcInfoCircle from \"@/icons/components/IcInfoCircle\";\n\nexport const AnimationField = ({ field }: { field: AnimationFieldType }) => {\n  return (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"animation\">\n        <Trans id=\"controls.section.animation.settings\">\n          Animation Settings\n        </Trans>\n      </SectionTitle>\n      <ControlSectionContent component=\"fieldset\" gap=\"none\" sx={{ mt: 2 }}>\n        <ChartOptionSwitchField\n          label={t({\n            id: \"controls.section.animation.show-play-button\",\n            message: \"Show Play button\",\n          })}\n          field=\"animation\"\n          path=\"showPlayButton\"\n        />\n        {field.showPlayButton && (\n          <>\n            <Box mt={4}>\n              <Typography variant=\"caption\" component=\"p\" sx={{ mb: 1 }}>\n                <Trans id=\"controls.section.animation.duration\">\n                  Animation Duration\n                </Trans>\n              </Typography>\n              <RadioGroup>\n                {[10, 30, 60].map((d) => (\n                  <ChartOptionRadioField\n                    key={d}\n                    label={`${d}s`}\n                    field=\"animation\"\n                    path=\"duration\"\n                    value={d}\n                  />\n                ))}\n              </RadioGroup>\n            </Box>\n            <Box mt={4}>\n              <Flex alignItems=\"center\" sx={{ gap: 1, mb: 1 }}>\n                <Typography variant=\"caption\" component=\"p\">\n                  <Trans id=\"controls.section.animation.type\">\n                    Animation Type\n                  </Trans>\n                </Typography>\n                <Tooltip\n                  arrow\n                  title={t({\n                    id: \"controls.section.animation.type.explanation\",\n                    message:\n                      \"Use the Stepped type to make the animation jump between data points at fixed intervals. This mode is useful when you want to animate data using a time dimension with a non-uniform distribution of dates.\",\n                  })}\n                >\n                  <Typography\n                    sx={{ color: \"primary.main\", lineHeight: \"0 !important\" }}\n                  >\n                    <SvgIcInfoCircle width={16} height={16} />\n                  </Typography>\n                </Tooltip>\n              </Flex>\n              <RadioGroup>\n                <ChartOptionRadioField\n                  label={t({\n                    id: \"controls.section.animation.type.continuous\",\n                    message: \"Continuous\",\n                  })}\n                  field=\"animation\"\n                  path=\"type\"\n                  value=\"continuous\"\n                />\n                <ChartOptionRadioField\n                  label={t({\n                    id: \"controls.section.animation.type.stepped\",\n                    message: \"Stepped\",\n                  })}\n                  field=\"animation\"\n                  path=\"type\"\n                  value=\"stepped\"\n                />\n              </RadioGroup>\n            </Box>\n            <Box display=\"flex\" alignItems=\"center\" mt={5} gap=\"0.5rem\">\n              <ChartOptionSwitchField\n                label={t({\n                  id: \"controls.section.animation.dynamic-scaling\",\n                  message: \"Dynamic Scaling\",\n                })}\n                field=\"animation\"\n                path=\"dynamicScales\"\n              />\n              <Tooltip\n                arrow\n                title={t({\n                  id: \"controls.section.animation.dynamic-scaling.explanation\",\n                  message:\n                    \"Enable dynamic scaling to adjust the chart's scale based on the data range, ensuring optimal visualization.\",\n                })}\n              >\n                <Typography\n                  sx={{ color: \"primary.main\", lineHeight: \"0 !important\" }}\n                >\n                  <SvgIcInfoCircle width={16} height={16} />\n                </Typography>\n              </Tooltip>\n            </Box>\n          </>\n        )}\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { useEffect } from \"react\";\n\nimport { getMap } from \"@/charts/map/ref\";\nimport { MapConfig } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  ChartOptionCheckboxField,\n  ChartOptionSwitchField,\n} from \"@/configurator/components/field\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const BaseLayerField = ({ chartConfig }: { chartConfig: MapConfig }) => {\n  const locale = useLocale();\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n  const locked = chartConfig.baseLayer.locked;\n\n  useEffect(() => {\n    if (locked) {\n      const map = getMap();\n\n      if (!map) {\n        return;\n      }\n\n      const bbox = map.getBounds().toArray();\n\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field: null,\n          path: \"baseLayer.bbox\",\n          value: bbox,\n        },\n      });\n    } else {\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field: null,\n          path: \"baseLayer.bbox\",\n          value: undefined,\n        },\n      });\n    }\n  }, [dispatch, locale, locked]);\n\n  return (\n    <ControlSection hideTopBorder>\n      <SectionTitle closable>\n        <Trans id=\"chart.map.layers.base\">Base map</Trans>\n      </SectionTitle>\n      <ControlSectionContent gap=\"lg\">\n        <ChartOptionCheckboxField\n          label={t({\n            id: \"chart.map.layers.base.show\",\n            message: \"Show\",\n          })}\n          field={null}\n          path=\"baseLayer.show\"\n        />\n        <ChartOptionSwitchField\n          label={t({\n            id: \"chart.map.layers.base.view.locked\",\n            message: \"Locked view\",\n          })}\n          field={null}\n          path=\"baseLayer.locked\"\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\n\nimport { RadioGroup } from \"@/components/form\";\nimport { MaybeTooltip } from \"@/components/maybe-tooltip\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  ChartOptionRadioField,\n  ChartOptionSwitchField,\n} from \"@/configurator/components/field\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\n\nexport const CalculationField = ({\n  disabled,\n  warnMessage,\n}: {\n  disabled?: boolean;\n  warnMessage?: string;\n}) => {\n  return (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"normalize\" warnMessage={warnMessage}>\n        <Trans id=\"controls.select.calculation.mode\">Chart mode</Trans>\n      </SectionTitle>\n      <ControlSectionContent>\n        <RadioGroup>\n          <ChartOptionRadioField\n            label={getFieldLabel(\"identity\")}\n            field={null}\n            path=\"interactiveFiltersConfig.calculation.type\"\n            value=\"identity\"\n            disabled={disabled}\n          />\n          <ChartOptionRadioField\n            label={getFieldLabel(\"percent\")}\n            field={null}\n            path=\"interactiveFiltersConfig.calculation.type\"\n            value=\"percent\"\n            disabled={disabled}\n          />\n        </RadioGroup>\n        <ChartOptionSwitchField\n          label={\n            <MaybeTooltip\n              tooltipProps={{ enterDelay: 600 }}\n              title={\n                <Trans id=\"controls.filters.interactive.calculation\">\n                  Allow users to change chart mode\n                </Trans>\n              }\n            >\n              <div>\n                <Trans id=\"controls.filters.interactive.toggle\">\n                  Interactive\n                </Trans>\n              </div>\n            </MaybeTooltip>\n          }\n          field={null}\n          path=\"interactiveFiltersConfig.calculation.active\"\n          disabled={disabled}\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, Stack, Typography } from \"@mui/material\";\nimport get from \"lodash/get\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { EncodingSpec } from \"@/charts/chart-config-ui-options\";\nimport {\n  DEFAULT_FIXED_COLOR_FIELD_OPACITY,\n  DEFAULT_OTHER_COLOR_FIELD_OPACITY,\n} from \"@/charts/map/constants\";\nimport { RadioGroup } from \"@/components/form\";\nimport {\n  ChartConfig,\n  ColorFieldType,\n  ColorScaleType,\n  ComponentType,\n} from \"@/config-types\";\nimport { ColorPalette } from \"@/configurator/components/chart-controls/color-palette\";\nimport { ColorRampField } from \"@/configurator/components/chart-controls/color-ramp\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { Abbreviations } from \"@/configurator/components/chart-options-selector/abbreviations\";\nimport { makeGetFieldOptionGroups } from \"@/configurator/components/chart-options-selector/utils\";\nimport {\n  ChartOptionRadioField,\n  ChartOptionSelectField,\n  ChartOptionSliderField,\n  ColorPickerField,\n} from \"@/configurator/components/field\";\nimport { DimensionValuesMultiFilter } from \"@/configurator/components/filters\";\nimport {\n  Component,\n  Dimension,\n  getComponentsFilteredByType,\n  isMeasure,\n  Measure,\n} from \"@/domain/data\";\n\nexport const ColorComponentField = ({\n  chartConfig,\n  encoding,\n  component,\n  componentTypes,\n  dimensions,\n  measures,\n  getFieldOptionGroups,\n  optional,\n  enableUseAbbreviations,\n}: {\n  chartConfig: ChartConfig;\n  encoding: EncodingSpec;\n  component: Component;\n  componentTypes: ComponentType[];\n  dimensions: Dimension[];\n  measures: Measure[];\n  getFieldOptionGroups: ReturnType<typeof makeGetFieldOptionGroups>;\n  optional: boolean;\n  enableUseAbbreviations: boolean;\n}) => {\n  const field = encoding.field;\n  const nbOptions = component.values.length;\n\n  const fieldComponents = useMemo(() => {\n    return getComponentsFilteredByType({\n      dimensionTypes: componentTypes,\n      dimensions,\n      measures,\n    });\n  }, [componentTypes, dimensions, measures]);\n  const getOption = useCallback(\n    (c: Component) => ({ value: c.id, label: c.label }),\n    []\n  );\n  const options = useMemo(() => {\n    return chartConfig.cubes.length === 1 ? fieldComponents.map(getOption) : [];\n  }, [chartConfig.cubes.length, fieldComponents, getOption]);\n  const optionGroups = useMemo(() => {\n    return chartConfig.cubes.length > 1\n      ? getFieldOptionGroups({ fieldComponents, getOption })\n      : undefined;\n  }, [\n    chartConfig.cubes.length,\n    fieldComponents,\n    getFieldOptionGroups,\n    getOption,\n  ]);\n\n  const nbColorOptions = useMemo(() => {\n    return Array.from(\n      { length: Math.min(7, Math.max(0, nbOptions - 2)) },\n      (_, i) => i + 3\n    ).map((d) => ({ value: d, label: `${d}` }));\n  }, [nbOptions]);\n\n  const colorComponentId = get(chartConfig, [\n    \"fields\",\n    encoding.field,\n    \"color\",\n    \"componentId\",\n  ]) as string | undefined;\n  const colorComponent = [...dimensions, ...measures].find(\n    (d) => d.id === colorComponentId\n  );\n  const colorType = get(chartConfig, [\n    \"fields\",\n    field,\n    \"color\",\n    \"type\",\n  ]) as ColorFieldType;\n  const colorScaleType = get(chartConfig, [\n    \"fields\",\n    field,\n    \"color\",\n    \"scaleType\",\n  ]) as ColorScaleType | undefined;\n  const nbClass = get(chartConfig, [\"fields\", field, \"color\", \"nbClass\"]) as\n    | number\n    | undefined;\n\n  return (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"swatch\">\n        <Trans id=\"controls.color\">Color</Trans>\n      </SectionTitle>\n      <ControlSectionContent>\n        <ChartOptionSelectField\n          id=\"color-component\"\n          label={t({\n            id: \"controls.select.measure\",\n            message: \"Select a measure\",\n          })}\n          field={field}\n          path=\"color.componentId\"\n          options={options}\n          optionGroups={optionGroups}\n          optional={optional}\n        />\n        {enableUseAbbreviations && (\n          <Box sx={{ mt: 1 }}>\n            <Abbreviations\n              field={field}\n              path=\"color\"\n              component={colorComponent}\n            />\n          </Box>\n        )}\n        {field === \"symbolLayer\" && (\n          <Box sx={{ mt: 1 }}>\n            <ChartOptionSliderField\n              field={field}\n              path=\"color.opacity\"\n              label={t({\n                id: \"controls.color.opacity\",\n                message: \"Opacity\",\n              })}\n              min={0}\n              max={100}\n              step={10}\n              defaultValue={\n                colorType === \"fixed\"\n                  ? DEFAULT_FIXED_COLOR_FIELD_OPACITY\n                  : DEFAULT_OTHER_COLOR_FIELD_OPACITY\n              }\n            />\n          </Box>\n        )}\n        {colorType === \"fixed\" ? (\n          <>\n            <ColorPickerField\n              label={t({\n                id: \"controls.color.select\",\n                message: \"Select a color\",\n              })}\n              field={field}\n              path=\"color.value\"\n            />\n          </>\n        ) : colorType === \"categorical\" ? (\n          colorComponentId &&\n          component.id !== colorComponentId &&\n          colorComponent &&\n          !isMeasure(colorComponent) ? (\n            <DimensionValuesMultiFilter\n              dimension={colorComponent}\n              field={field}\n              colorConfigPath=\"color\"\n              colorComponent={colorComponent}\n            />\n          ) : (\n            <ColorPalette\n              field=\"symbolLayer\"\n              colorConfigPath=\"color\"\n              component={colorComponent}\n            />\n          )\n        ) : colorType === \"numerical\" ? (\n          <div>\n            <ColorRampField field={field} path=\"color\" nSteps={nbClass} />\n            <Typography variant=\"caption\" component=\"p\" sx={{ mb: 1 }}>\n              <Trans id=\"controls.scale.type\">Scale type</Trans>\n            </Typography>\n            <RadioGroup>\n              <ChartOptionRadioField\n                label={t({\n                  id: \"controls.color.scale.type.continuous\",\n                  message: \"Continuous\",\n                })}\n                field={field}\n                path=\"color.scaleType\"\n                value=\"continuous\"\n              />\n              {nbOptions >= 3 && (\n                <ChartOptionRadioField\n                  label={t({\n                    id: \"controls.color.scale.type.discrete\",\n                    message: \"Discrete\",\n                  })}\n                  field={field}\n                  path=\"color.scaleType\"\n                  value=\"discrete\"\n                />\n              )}\n            </RadioGroup>\n          </div>\n        ) : null}\n        {colorScaleType === \"discrete\" && nbOptions >= 3 ? (\n          <Stack spacing={2}>\n            <ChartOptionSelectField\n              id=\"color-scale-interpolation\"\n              label={t({\n                id: \"controls.color.scale.interpolation\",\n                message: \"Interpolation\",\n              })}\n              field={field}\n              path=\"color.interpolationType\"\n              options={[\n                {\n                  label: t({\n                    id: \"controls.color.scale.discretization.quantize\",\n                    message: \"Quantize (equal intervals)\",\n                  }),\n                  value: \"quantize\",\n                },\n                {\n                  label: t({\n                    id: \"controls.color.scale.discretization.quantiles\",\n                    message: \"Quantiles (equal distribution of values)\",\n                  }),\n                  value: \"quantile\",\n                },\n                {\n                  label: t({\n                    id: \"controls.color.scale.discretization.jenks\",\n                    message: \"Jenks (natural breaks)\",\n                  }),\n                  value: \"jenks\",\n                },\n              ]}\n            />\n            <ChartOptionSelectField<number>\n              id=\"number-of-colors\"\n              label={t({\n                id: \"controls.color.scale.number.of.classes\",\n                message: \"Number of classes\",\n              })}\n              field={field}\n              path=\"color.nbClass\"\n              options={nbColorOptions}\n              getValue={(d) => +d}\n            />\n          </Stack>\n        ) : null}\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\nimport { groups } from \"d3-array\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { LegendSymbol } from \"@/charts/shared/legend-color\";\nimport { Flex } from \"@/components/flex\";\nimport { Select, SelectOptionGroup } from \"@/components/form\";\nimport {\n  ComboChartConfig,\n  ComboLineColumnConfig,\n  ComboLineDualConfig,\n  ComboLineSingleConfig,\n} from \"@/config-types\";\nimport { ColorPalette } from \"@/configurator/components/chart-controls/color-palette\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ColorPickerField } from \"@/configurator/components/field\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport {\n  Component,\n  isNumericalMeasure,\n  Measure,\n  NumericalMeasure,\n} from \"@/domain/data\";\nimport { useLocale } from \"@/locales/use-locale\";\n\ntype ComboYFieldProps<T extends ComboChartConfig> = {\n  chartConfig: T;\n  measures: Measure[];\n};\n\nexport const ComboYField = <T extends ComboChartConfig>({\n  chartConfig,\n  measures,\n}: ComboYFieldProps<T>) => {\n  switch (chartConfig.chartType) {\n    case \"comboLineSingle\": {\n      return (\n        <ComboLineSingleYField chartConfig={chartConfig} measures={measures} />\n      );\n    }\n    case \"comboLineDual\": {\n      return (\n        <ComboLineDualYField chartConfig={chartConfig} measures={measures} />\n      );\n    }\n    case \"comboLineColumn\":\n      return (\n        <ComboLineColumnYField chartConfig={chartConfig} measures={measures} />\n      );\n    default:\n      const _exhaustiveCheck: never = chartConfig;\n      return _exhaustiveCheck;\n  }\n};\n\nconst getComboOptionGroups = (\n  measures: NumericalMeasure[],\n  disable: (measure: NumericalMeasure) => boolean\n) => {\n  const noUnitLabel = t({\n    id: \"controls.chart.combo.y.no-unit\",\n    message: \"No unit\",\n  });\n\n  return groups(measures, (d) => d.unit ?? noUnitLabel).map(\n    ([unit, measures]) => {\n      return [\n        { label: unit, value: unit },\n        measures.map((measure) => {\n          return {\n            value: measure.id,\n            label: measure.label,\n            disabled: disable(measure),\n          };\n        }),\n      ];\n    }\n  ) as SelectOptionGroup[];\n};\n\nconst ComboLineSingleYField = ({\n  chartConfig,\n  measures,\n}: ComboYFieldProps<ComboLineSingleConfig>) => {\n  const locale = useLocale();\n  const [, dispatch] = useConfiguratorState(isConfiguring);\n  const { fields } = chartConfig;\n  const { y } = fields;\n\n  const numericalMeasures = useMemo(() => {\n    return measures.filter(isNumericalMeasure);\n  }, [measures]);\n\n  const unit = useMemo(() => {\n    const uniqueUnits = Array.from(\n      new Set(\n        y.componentIds.map((id) => {\n          const measure = numericalMeasures.find((m) => m.id === id);\n          return measure?.unit;\n        })\n      )\n    );\n\n    if (uniqueUnits.length > 1) {\n      throw Error(\"ChartComboYField can only be used with single-unit charts!\");\n    }\n\n    return uniqueUnits[0];\n  }, [numericalMeasures, y.componentIds]);\n\n  const getOptionGroups = useCallback(\n    (\n      iri: string | null,\n      {\n        allowNone,\n        enableAll,\n      }: {\n        allowNone?: boolean;\n        enableAll?: boolean;\n      } = {}\n    ) => {\n      const options = getComboOptionGroups(numericalMeasures, (m) => {\n        return !m.unit\n          ? true\n          : enableAll\n            ? false\n            : m.unit !== unit ||\n              (y.componentIds.includes(m.id) && m.id !== iri);\n      });\n\n      if (allowNone) {\n        options.unshift([\n          { label: \"\", value: \"\" },\n          [\n            {\n              label: t({\n                id: \"controls.none\",\n                message: \"None\",\n              }),\n              value: FIELD_VALUE_NONE,\n              isNoneValue: true,\n            },\n          ],\n        ]);\n      }\n\n      return options;\n    },\n    [numericalMeasures, y.componentIds, unit]\n  );\n\n  const { addNewMeasureOptions, showAddNewMeasureButton } = useMemo(() => {\n    const addNewMeasureOptions = getOptionGroups(null, { allowNone: true });\n\n    return {\n      addNewMeasureOptions,\n      showAddNewMeasureButton:\n        addNewMeasureOptions.flatMap(([_, v]) => v).filter((d) => !d.disabled)\n          .length > 1,\n    };\n  }, [getOptionGroups]);\n\n  return (\n    <>\n      <ControlSection collapse>\n        <SectionTitle iconName=\"numerical\">Measures</SectionTitle>\n        <ControlSectionContent component=\"fieldset\" gap=\"none\" sx={{ mt: 2 }}>\n          <Typography variant=\"caption\" sx={{ mb: 2 }}>\n            <Trans id=\"controls.chart.combo.y.combine-same-unit\">\n              Note that you can only combine measures of the same unit.\n            </Trans>\n          </Typography>\n          <Typography variant=\"caption\" sx={{ mb: 2 }}>\n            <Trans id=\"controls.chart.combo.y.common-unit\">Common unit</Trans>:{\" \"}\n            <b>{unit ?? t({ id: \"controls.none\", message: \"None\" })}</b>\n          </Typography>\n          {y.componentIds.map((id, i) => {\n            // If there are multiple measures, we allow the user to remove any measure.\n            const allowNone = y.componentIds.length > 1;\n            // If there is only one measure, we allow the user to select any measure.\n            const enableAll = i === 0 && y.componentIds.length === 1;\n            const options = getOptionGroups(id, { allowNone, enableAll });\n\n            return (\n              <Select\n                key={id}\n                size=\"sm\"\n                id={`measure-${id}`}\n                hint={\n                  !showAddNewMeasureButton && y.componentIds.length === 1\n                    ? t({\n                        id: \"controls.chart.combo.y.no-compatible-measures\",\n                        message: \"No compatible measures to combine!\",\n                      })\n                    : undefined\n                }\n                options={[]}\n                optionGroups={options}\n                sort={false}\n                value={id}\n                onChange={(e) => {\n                  const newId = e.target.value as string;\n                  let newComponentIds: string[];\n\n                  if (newId === FIELD_VALUE_NONE) {\n                    newComponentIds = y.componentIds.filter((d) => d !== id);\n                  } else {\n                    newComponentIds = [...y.componentIds];\n                    newComponentIds.splice(i, 1, newId);\n                  }\n\n                  dispatch({\n                    type: \"CHART_FIELD_UPDATED\",\n                    value: {\n                      locale,\n                      field: \"y\",\n                      path: \"componentIds\",\n                      value: newComponentIds,\n                    },\n                  });\n                }}\n                sx={{ mb: 2 }}\n              />\n            );\n          })}\n          {showAddNewMeasureButton && (\n            <Select\n              id=\"measure-add\"\n              label={t({\n                id: \"controls.sorting.addDimension\",\n                message: \"Add dimension\",\n              })}\n              options={[]}\n              optionGroups={addNewMeasureOptions}\n              sort={false}\n              onChange={(e) => {\n                const id = e.target.value as string;\n\n                if (id !== FIELD_VALUE_NONE) {\n                  dispatch({\n                    type: \"CHART_FIELD_UPDATED\",\n                    value: {\n                      locale,\n                      field: \"y\",\n                      path: \"componentIds\",\n                      value: [...y.componentIds, id],\n                    },\n                  });\n                }\n              }}\n              value={FIELD_VALUE_NONE}\n            />\n          )}\n        </ControlSectionContent>\n      </ControlSection>\n      <ColorSelection\n        values={y.componentIds.map((id) => ({ id, symbol: \"line\" }))}\n        measures={measures}\n      />\n    </>\n  );\n};\n\nconst ComboLineDualYField = ({\n  chartConfig,\n  measures,\n}: ComboYFieldProps<ComboLineDualConfig>) => {\n  const locale = useLocale();\n  const [, dispatch] = useConfiguratorState(isConfiguring);\n  const { fields } = chartConfig;\n  const { y } = fields;\n\n  const numericalMeasures = useMemo(() => {\n    return measures.filter(isNumericalMeasure);\n  }, [measures]);\n\n  const { leftAxisMeasure, rightAxisMeasure } = useMemo(() => {\n    const leftAxisMeasure = numericalMeasures.find(\n      (m) => m.id === y.leftAxisComponentId\n    ) as Measure;\n    const rightAxisMeasure = numericalMeasures.find(\n      (m) => m.id === y.rightAxisComponentId\n    ) as Measure;\n\n    return {\n      leftAxisMeasure,\n      rightAxisMeasure,\n    };\n  }, [numericalMeasures, y.leftAxisComponentId, y.rightAxisComponentId]);\n\n  if (leftAxisMeasure.unit === rightAxisMeasure.unit) {\n    throw Error(\"ChartComboYField can only be used with dual-unit charts!\");\n  }\n\n  const getOptionGroups = useCallback(\n    (orientation: \"left\" | \"right\") => {\n      return getComboOptionGroups(numericalMeasures, (m) => {\n        return orientation === \"left\"\n          ? m.unit === rightAxisMeasure.unit\n          : m.unit === leftAxisMeasure.unit;\n      });\n    },\n    [leftAxisMeasure.unit, numericalMeasures, rightAxisMeasure.unit]\n  );\n\n  return (\n    <>\n      <ControlSection collapse>\n        <SectionTitle iconName=\"numerical\">Measures</SectionTitle>\n        <ControlSectionContent component=\"fieldset\" gap=\"none\" sx={{ mt: 2 }}>\n          <Typography variant=\"caption\" sx={{ mb: 4 }}>\n            <Trans id=\"controls.chart.combo.y.combine-different-unit\">\n              Note that you can only combine measures of different units.\n            </Trans>\n          </Typography>\n          <Select\n            size=\"sm\"\n            id={`measure-${y.leftAxisComponentId}`}\n            options={[]}\n            optionGroups={getOptionGroups(\"left\")}\n            sort={false}\n            label={t({\n              id: \"controls.chart.combo.y.left-axis-measure\",\n              message: \"Left axis measure\",\n            })}\n            value={y.leftAxisComponentId}\n            onChange={(e) => {\n              const newId = e.target.value as string;\n              dispatch({\n                type: \"CHART_FIELD_UPDATED\",\n                value: {\n                  locale,\n                  field: \"y\",\n                  path: \"leftAxisComponentId\",\n                  value: newId,\n                },\n              });\n            }}\n            sx={{ mb: 2 }}\n          />\n          <Select\n            id={`measure-${y.rightAxisComponentId}`}\n            size=\"sm\"\n            options={[]}\n            optionGroups={getOptionGroups(\"right\")}\n            sort={false}\n            label={t({\n              id: \"controls.chart.combo.y.right-axis-measure\",\n              message: \"Right axis measure\",\n            })}\n            value={y.rightAxisComponentId}\n            onChange={(e) => {\n              const newId = e.target.value as string;\n              dispatch({\n                type: \"CHART_FIELD_UPDATED\",\n                value: {\n                  locale,\n                  field: \"y\",\n                  path: \"rightAxisComponentId\",\n                  value: newId,\n                },\n              });\n            }}\n            sx={{ mb: 2 }}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      <ColorSelection\n        values={[\n          { id: y.leftAxisComponentId, symbol: \"line\" },\n          { id: y.rightAxisComponentId, symbol: \"line\" },\n        ]}\n        measures={measures}\n      />\n    </>\n  );\n};\n\nconst ComboLineColumnYField = ({\n  chartConfig,\n  measures,\n}: ComboYFieldProps<ComboLineColumnConfig>) => {\n  const locale = useLocale();\n  const [, dispatch] = useConfiguratorState(isConfiguring);\n  const { fields } = chartConfig;\n  const { y } = fields;\n\n  const numericalMeasures = useMemo(() => {\n    return measures.filter(isNumericalMeasure);\n  }, [measures]);\n\n  const { lineMeasure, columnMeasure } = useMemo(() => {\n    const lineMeasure = numericalMeasures.find(\n      (m) => m.id === y.lineComponentId\n    ) as Measure;\n    const columnMeasure = numericalMeasures.find(\n      (m) => m.id === y.columnComponentId\n    ) as Measure;\n\n    return {\n      lineMeasure,\n      columnMeasure,\n    };\n  }, [numericalMeasures, y.columnComponentId, y.lineComponentId]);\n\n  if (lineMeasure.unit === columnMeasure.unit) {\n    throw Error(\"ChartComboYField can only be used with dual-unit charts!\");\n  }\n\n  const getOptionGroups = useCallback(\n    (type: \"line\" | \"column\") => {\n      return getComboOptionGroups(numericalMeasures, (m) => {\n        return type === \"line\"\n          ? m.unit === columnMeasure.unit\n          : m.unit === lineMeasure.unit;\n      });\n    },\n    [columnMeasure.unit, lineMeasure.unit, numericalMeasures]\n  );\n\n  return (\n    <>\n      <ControlSection collapse>\n        <SectionTitle iconName=\"numerical\">Measures</SectionTitle>\n        <ControlSectionContent component=\"fieldset\" gap=\"none\" sx={{ mt: 2 }}>\n          <Typography variant=\"caption\" sx={{ mb: 4 }}>\n            <Trans id=\"controls.chart.combo.y.combine-different-unit\">\n              Note that you can only combine measures of different units.\n            </Trans>\n          </Typography>\n          <Select\n            id={`measure-${y.columnComponentId}`}\n            size=\"sm\"\n            options={[]}\n            optionGroups={getOptionGroups(\"column\")}\n            sort={false}\n            label={t({\n              id: \"controls.chart.combo.y.column-measure\",\n              message: \"Left axis (column)\",\n            })}\n            value={y.columnComponentId}\n            onChange={(e) => {\n              const newId = e.target.value as string;\n              dispatch({\n                type: \"CHART_FIELD_UPDATED\",\n                value: {\n                  locale,\n                  field: \"y\",\n                  path: \"columnComponentId\",\n                  value: newId,\n                },\n              });\n            }}\n            sx={{ mb: 2 }}\n          />\n          <Select\n            id={`measure-${y.lineComponentId}`}\n            size=\"sm\"\n            options={[]}\n            optionGroups={getOptionGroups(\"line\")}\n            sort={false}\n            label={t({\n              id: \"controls.chart.combo.y.line-measure\",\n              message: \"Right axis (line)\",\n            })}\n            value={y.lineComponentId}\n            onChange={(e) => {\n              const newId = e.target.value as string;\n              dispatch({\n                type: \"CHART_FIELD_UPDATED\",\n                value: {\n                  locale,\n                  field: \"y\",\n                  path: \"lineComponentId\",\n                  value: newId,\n                },\n              });\n            }}\n            sx={{ mb: 2 }}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      <ColorSelection\n        values={\n          y.lineAxisOrientation === \"left\"\n            ? [\n                { id: y.lineComponentId, symbol: \"line\" },\n                { id: y.columnComponentId, symbol: \"square\" },\n              ]\n            : [\n                { id: y.columnComponentId, symbol: \"square\" },\n                { id: y.lineComponentId, symbol: \"line\" },\n              ]\n        }\n        measures={measures}\n      />\n    </>\n  );\n};\n\nconst ColorSelection = ({\n  values,\n  measures,\n}: {\n  values: { id: string; symbol: LegendSymbol }[];\n  measures: Measure[];\n}) => {\n  return (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"swatch\">\n        <Trans id=\"controls.section.layout-options\">Layout Options</Trans>\n      </SectionTitle>\n      <ControlSectionContent component=\"fieldset\" gap=\"none\" sx={{ mt: 2 }}>\n        <ColorPalette\n          field=\"y\"\n          component={\n            {\n              __typename: \"\",\n              values: values.map(({ id }) => ({\n                value: id,\n                label: id,\n              })),\n            } as any as Component\n          }\n        />\n        <Flex flexDirection=\"column\" sx={{ gap: 2, mt: 5 }}>\n          {values.map(({ id, symbol }) => {\n            return (\n              <div key={id}>\n                <ColorPickerField\n                  field=\"color\"\n                  path={`colorMapping[\"${id}\"]`}\n                  label={measures.find((d) => d.id === id)!.label}\n                  symbol={symbol}\n                />\n              </div>\n            );\n          })}\n        </Flex>\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, Typography } from \"@mui/material\";\nimport { ReactNode, useEffect, useState } from \"react\";\n\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { Flex } from \"@/components/flex\";\nimport { Checkbox, Input } from \"@/components/form\";\nimport { ChartConfig, ConversionUnit } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { Component } from \"@/domain/data\";\nimport { ComponentId } from \"@/graphql/make-component-id\";\nimport { Locale } from \"@/locales/locales\";\nimport { useLocale, useOrderedLocales } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const ConversionUnitsField = ({\n  chartConfig,\n  field,\n  components,\n}: {\n  chartConfig: ChartConfig;\n  field: EncodingFieldType;\n  components: Component[];\n}) => {\n  switch (chartConfig.chartType) {\n    case \"area\":\n    case \"column\":\n    case \"line\":\n    case \"pie\":\n    case \"scatterplot\": {\n      const component = components.find(\n        (c) => c.id === (chartConfig.fields as any)[field].componentId\n      );\n\n      if (!component) {\n        return null;\n      }\n\n      const conversionUnit =\n        chartConfig.conversionUnitsByComponentId[component.id];\n      const originalUnit = component.originalUnit;\n      const checked = !!conversionUnit;\n\n      return (\n        <ConversionUnitSection\n          checked={checked}\n          conversionUnits={[{ componentId: component.id, originalUnit }]}\n        >\n          {checked ? (\n            <ConversionUnitContent\n              componentId={component.id}\n              originalUnit={originalUnit}\n              conversionUnit={conversionUnit}\n            />\n          ) : null}\n        </ConversionUnitSection>\n      );\n    }\n    case \"bar\": {\n      const component = components.find(\n        (c) => c.id === (chartConfig.fields as any)[field].componentId\n      );\n\n      if (!component) {\n        return null;\n      }\n\n      const conversionUnit =\n        chartConfig.conversionUnitsByComponentId[component.id];\n      const originalUnit = component.originalUnit;\n      const checked = !!conversionUnit;\n\n      return (\n        <ConversionUnitSection\n          checked={checked}\n          conversionUnits={[{ componentId: component.id, originalUnit }]}\n        >\n          {checked ? (\n            <ConversionUnitContent\n              componentId={component.id}\n              originalUnit={originalUnit}\n              conversionUnit={conversionUnit}\n            />\n          ) : null}\n        </ConversionUnitSection>\n      );\n    }\n    case \"map\": {\n      const activeField = field as keyof typeof chartConfig.fields;\n\n      switch (activeField) {\n        case \"areaLayer\": {\n          const areaLayer = chartConfig.fields.areaLayer;\n          const color = areaLayer?.color;\n          const numericalColor =\n            color?.type === \"numerical\" ? color : undefined;\n          const colorComponent = components.find(\n            (c) => c.id === numericalColor?.componentId\n          );\n\n          if (!colorComponent) {\n            return null;\n          }\n\n          const conversionUnit =\n            chartConfig.conversionUnitsByComponentId[colorComponent.id];\n          const originalUnit = colorComponent.unit;\n          const checked = !!conversionUnit;\n\n          return (\n            <ConversionUnitSection\n              checked={checked}\n              conversionUnits={[\n                { componentId: colorComponent.id, originalUnit },\n              ]}\n            >\n              {checked ? (\n                <ConversionUnitContent\n                  componentId={colorComponent.id}\n                  originalUnit={originalUnit}\n                  conversionUnit={conversionUnit}\n                />\n              ) : null}\n            </ConversionUnitSection>\n          );\n        }\n        case \"symbolLayer\": {\n          const symbolLayer = chartConfig.fields.symbolLayer;\n          const sizeComponent = components.find(\n            (c) => c.id === symbolLayer?.measureId\n          );\n          const color = symbolLayer?.color;\n          const numericalColor =\n            color?.type === \"numerical\" ? color : undefined;\n          const colorComponent = components.find(\n            (c) => c.id === numericalColor?.componentId\n          );\n\n          if (!sizeComponent && !colorComponent) {\n            return null;\n          }\n\n          const sizeConversionUnit =\n            chartConfig.conversionUnitsByComponentId[sizeComponent?.id ?? \"\"];\n          const originalSizeUnit = sizeComponent?.unit;\n          const colorConversionUnit =\n            chartConfig.conversionUnitsByComponentId[colorComponent?.id ?? \"\"];\n          const originalColorUnit = colorComponent?.unit;\n          const checked = !!sizeConversionUnit || !!colorConversionUnit;\n\n          return (\n            <ConversionUnitSection\n              checked={checked}\n              conversionUnits={[\n                {\n                  componentId: sizeComponent?.id,\n                  originalUnit: originalSizeUnit,\n                },\n                {\n                  componentId: colorComponent?.id,\n                  originalUnit: originalColorUnit,\n                },\n              ]}\n            >\n              {checked && sizeComponent ? (\n                <div>\n                  <Typography variant=\"body3\" fontWeight=\"bold\">\n                    <Trans id=\"controls.size\">Size</Trans>:{\" \"}\n                    {sizeComponent.label}\n                  </Typography>\n                  <ConversionUnitContent\n                    componentId={sizeComponent.id}\n                    originalUnit={originalSizeUnit}\n                    conversionUnit={sizeConversionUnit}\n                  />\n                </div>\n              ) : null}\n              {checked && colorComponent ? (\n                <div>\n                  <Typography variant=\"body3\" fontWeight=\"bold\">\n                    <Trans id=\"controls.color\">Color</Trans>:{\" \"}\n                    {colorComponent.label}\n                  </Typography>\n                  <ConversionUnitContent\n                    componentId={colorComponent.id}\n                    originalUnit={originalColorUnit}\n                    conversionUnit={colorConversionUnit}\n                  />\n                </div>\n              ) : null}\n            </ConversionUnitSection>\n          );\n        }\n        case \"animation\":\n          return null;\n        default:\n          const _exhaustiveCheck: never = activeField;\n          return _exhaustiveCheck;\n      }\n    }\n    case \"table\":\n      return null;\n    case \"comboLineSingle\": {\n      const component = components.find(\n        (c) => c.id === chartConfig.fields.y.componentIds[0]\n      );\n\n      if (!component) {\n        return null;\n      }\n\n      const conversionUnit =\n        chartConfig.conversionUnitsByComponentId[component.id];\n      const originalUnit = component.unit;\n      const checked = !!conversionUnit;\n\n      return (\n        <ConversionUnitSection\n          checked={checked}\n          conversionUnits={[{ componentId: component.id, originalUnit }]}\n        >\n          {checked ? (\n            <ConversionUnitContent\n              componentId={component.id}\n              originalUnit={originalUnit}\n              conversionUnit={conversionUnit}\n            />\n          ) : null}\n        </ConversionUnitSection>\n      );\n    }\n    case \"comboLineColumn\": {\n      const lineComponent = components.find(\n        (c) => c.id === chartConfig.fields.y.lineComponentId\n      );\n\n      if (!lineComponent) {\n        return null;\n      }\n\n      const columnComponent = components.find(\n        (c) => c.id === chartConfig.fields.y.columnComponentId\n      );\n\n      if (!columnComponent) {\n        return null;\n      }\n\n      const lineConversionUnit =\n        chartConfig.conversionUnitsByComponentId[lineComponent.id];\n      const originalLineUnit = lineComponent.unit;\n      const columnConversionUnit =\n        chartConfig.conversionUnitsByComponentId[columnComponent.id];\n      const originalColumnUnit = columnComponent.unit;\n      const checked = !!lineConversionUnit || !!columnConversionUnit;\n\n      return (\n        <ConversionUnitSection\n          checked={checked}\n          conversionUnits={[\n            { componentId: lineComponent.id, originalUnit: originalLineUnit },\n            {\n              componentId: columnComponent.id,\n              originalUnit: originalColumnUnit,\n            },\n          ]}\n        >\n          {checked && columnComponent ? (\n            <div>\n              <Typography variant=\"body3\" fontWeight=\"bold\">\n                {columnComponent.label}\n              </Typography>\n              <ConversionUnitContent\n                componentId={columnComponent.id}\n                originalUnit={originalColumnUnit}\n                conversionUnit={columnConversionUnit}\n              />\n            </div>\n          ) : null}\n          {checked && lineComponent ? (\n            <div>\n              <Typography variant=\"body3\" fontWeight=\"bold\">\n                {lineComponent.label}\n              </Typography>\n              <ConversionUnitContent\n                componentId={lineComponent.id}\n                originalUnit={originalLineUnit}\n                conversionUnit={lineConversionUnit}\n              />\n            </div>\n          ) : null}\n        </ConversionUnitSection>\n      );\n    }\n    case \"comboLineDual\": {\n      const leftComponent = components.find(\n        (c) => c.id === chartConfig.fields.y.leftAxisComponentId\n      );\n\n      if (!leftComponent) {\n        return null;\n      }\n\n      const rightComponent = components.find(\n        (c) => c.id === chartConfig.fields.y.rightAxisComponentId\n      );\n\n      if (!rightComponent) {\n        return null;\n      }\n\n      const leftConversionUnit =\n        chartConfig.conversionUnitsByComponentId[leftComponent.id];\n      const originalLeftUnit = leftComponent.unit;\n      const rightConversionUnit =\n        chartConfig.conversionUnitsByComponentId[rightComponent.id];\n      const originalRightUnit = rightComponent.unit;\n      const checked = !!leftConversionUnit || !!rightConversionUnit;\n\n      return (\n        <ConversionUnitSection\n          checked={checked}\n          conversionUnits={[\n            { componentId: leftComponent.id, originalUnit: originalLeftUnit },\n            { componentId: rightComponent.id, originalUnit: originalRightUnit },\n          ]}\n        >\n          {checked && leftComponent ? (\n            <div>\n              <Typography variant=\"body3\" fontWeight=\"bold\">\n                {leftComponent.label}\n              </Typography>\n              <ConversionUnitContent\n                componentId={leftComponent.id}\n                originalUnit={originalLeftUnit}\n                conversionUnit={leftConversionUnit}\n              />\n            </div>\n          ) : null}\n          {checked && rightComponent ? (\n            <div>\n              <Typography variant=\"body3\" fontWeight=\"bold\">\n                {rightComponent.label}\n              </Typography>\n              <ConversionUnitContent\n                componentId={rightComponent.id}\n                originalUnit={originalRightUnit}\n                conversionUnit={rightConversionUnit}\n              />\n            </div>\n          ) : null}\n        </ConversionUnitSection>\n      );\n    }\n    default:\n      const _exhaustiveCheck: never = chartConfig;\n      return _exhaustiveCheck;\n  }\n};\n\nconst ConversionUnitSection = ({\n  children,\n  checked,\n  conversionUnits,\n}: {\n  children: ReactNode;\n  checked: boolean;\n  conversionUnits: {\n    componentId: ComponentId | undefined;\n    originalUnit: string | undefined;\n  }[];\n}) => {\n  const locale = useLocale();\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n  const handleToggle = useEvent(() => {\n    if (!checked) {\n      conversionUnits.forEach(({ componentId, originalUnit }) => {\n        if (componentId) {\n          dispatch({\n            type: \"CHART_FIELD_UPDATED\",\n            value: {\n              locale,\n              field: null,\n              path: `conversionUnitsByComponentId[\"${componentId}\"]`,\n              value: getDefaultConversionUnit({\n                originalUnit,\n              }),\n            },\n          });\n        }\n      });\n    } else {\n      conversionUnits.forEach(({ componentId }) => {\n        dispatch({\n          type: \"CHART_FIELD_UPDATED\",\n          value: {\n            locale,\n            field: null,\n            path: `conversionUnitsByComponentId[\"${componentId}\"]`,\n            value: FIELD_VALUE_NONE,\n          },\n        });\n      });\n    }\n  });\n\n  return (\n    <ControlSection collapse defaultExpanded={checked}>\n      <SectionTitle iconName=\"balance\">\n        <Trans id=\"controls.convert-unit\">Unit Conversion</Trans>\n      </SectionTitle>\n      <ControlSectionContent gap=\"lg\">\n        <Checkbox\n          label={t({\n            id: \"controls.convert-unit.enable\",\n            message: \"Enable unit conversion\",\n          })}\n          checked={checked}\n          onChange={handleToggle}\n        />\n        {children}\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n\nconst ConversionUnitContent = ({\n  componentId,\n  originalUnit,\n  conversionUnit,\n}: {\n  componentId: ComponentId;\n  originalUnit: string | undefined;\n  conversionUnit: ConversionUnit;\n}) => {\n  const locale = useLocale();\n  const orderedLocales = useOrderedLocales();\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n  const definedConversionUnit =\n    conversionUnit ?? getDefaultConversionUnit({ originalUnit });\n\n  const handleMultiplierChange = useEvent((newMultiplier: number) => {\n    dispatch({\n      type: \"CHART_FIELD_UPDATED\",\n      value: {\n        locale,\n        field: null,\n        path: `conversionUnitsByComponentId[\"${componentId}\"]`,\n        value: {\n          multiplier: newMultiplier,\n          labels: definedConversionUnit.labels,\n        },\n      },\n    });\n  });\n\n  const handleLabelChange = useEvent((locale: Locale, value: string) => {\n    dispatch({\n      type: \"CHART_FIELD_UPDATED\",\n      value: {\n        locale,\n        field: null,\n        path: `conversionUnitsByComponentId[\"${componentId}\"]`,\n        value: {\n          multiplier: definedConversionUnit.multiplier,\n          labels: {\n            ...definedConversionUnit.labels,\n            [locale]: value,\n          },\n        },\n      },\n    });\n  });\n\n  return (\n    <Box sx={{ mt: 2 }}>\n      <Flex sx={{ flexDirection: \"column\", gap: 2 }}>\n        <Typography variant=\"body3\">\n          <Trans id=\"controls.convert-unit.original\">\n            Original unit:{\" \"}\n            {originalUnit || t({ id: \"controls.none\", message: \"None\" })}\n          </Trans>\n        </Typography>\n        <MultiplierInput\n          value={definedConversionUnit.multiplier}\n          onCommit={handleMultiplierChange}\n        />\n      </Flex>\n      <Flex sx={{ flexDirection: \"column\", gap: 1 }}>\n        <Typography variant=\"body3\">\n          <Trans id=\"controls.convert-unit.custom-labels\">\n            Custom unit labels\n          </Trans>\n        </Typography>\n        {orderedLocales.map((locale) => (\n          <Input\n            key={locale}\n            label={getFieldLabel(locale)}\n            name={`unit-label-${locale}`}\n            value={definedConversionUnit.labels[locale]}\n            onChange={(e) => handleLabelChange(locale, e.target.value)}\n          />\n        ))}\n      </Flex>\n    </Box>\n  );\n};\n\nconst MultiplierInput = ({\n  value,\n  onCommit,\n}: {\n  value: number;\n  onCommit: (newValue: number) => void;\n}) => {\n  const [inputValue, setInputValue] = useState(`${value}`);\n  const [error, setError] = useState<string | undefined>(undefined);\n\n  useEffect(() => {\n    setInputValue(`${value}`);\n  }, [value]);\n\n  const handleCommit = () => {\n    const parsed = parseFloat(inputValue);\n\n    if (isNaN(parsed)) {\n      setError(\n        t({\n          id: \"controls.convert-unit.invalid-number-error\",\n          message: \"Please enter a valid number\",\n        })\n      );\n\n      return;\n    }\n\n    if (parsed <= 0) {\n      setError(\n        t({\n          id: \"controls.convert-unit.positive-number-error\",\n          message: \"Multiplier must be greater than 0\",\n        })\n      );\n\n      return;\n    }\n\n    setError(undefined);\n    onCommit(parsed);\n  };\n\n  return (\n    <Input\n      type=\"number\"\n      label={t({\n        id: \"controls.convert-unit.multiplier\",\n        message: \"Multiplier\",\n      })}\n      name=\"multiplier\"\n      value={inputValue}\n      onChange={(e) => setInputValue(e.currentTarget.value)}\n      onBlur={handleCommit}\n      onKeyDown={(e) => {\n        if (e.key === \"Enter\") {\n          handleCommit();\n        }\n      }}\n      error={!!error}\n      errorMessage={error}\n    />\n  );\n};\n\nconst getDefaultConversionUnit = ({\n  originalUnit,\n}: {\n  originalUnit: string | undefined;\n}): ConversionUnit => {\n  const label = originalUnit ?? \"\";\n\n  return {\n    multiplier: 1,\n    labels: {\n      de: label,\n      fr: label,\n      it: label,\n      en: label,\n    },\n  };\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport get from \"lodash/get\";\nimport { useCallback } from \"react\";\n\nimport { Select } from \"@/components/form\";\nimport { ChartConfig, IMPUTATION_TYPES, ImputationType } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\n\nexport const ImputationField = ({\n  chartConfig,\n}: {\n  chartConfig: ChartConfig;\n}) => {\n  const [, dispatch] = useConfiguratorState(isConfiguring);\n  const getImputationTypeLabel = (type: ImputationType) => {\n    switch (type) {\n      case \"none\":\n        return t({\n          id: \"controls.imputation.type.none\",\n          message: \"-\",\n        });\n      case \"zeros\":\n        return t({\n          id: \"controls.imputation.type.zeros\",\n          message: \"Zeros\",\n        });\n      case \"linear\":\n        return t({\n          id: \"controls.imputation.type.linear\",\n          message: \"Linear interpolation\",\n        });\n      default:\n        const _exhaustiveCheck: never = type;\n        return _exhaustiveCheck;\n    }\n  };\n  const updateImputationType = useCallback<(type: ImputationType) => void>(\n    (type) => {\n      dispatch({\n        type: \"IMPUTATION_TYPE_CHANGED\",\n        value: {\n          type,\n        },\n      });\n    },\n    [dispatch]\n  );\n\n  const imputationType: ImputationType = get(\n    chartConfig,\n    [\"fields\", \"y\", \"imputationType\"],\n    \"none\"\n  );\n\n  return (\n    <ControlSection collapse>\n      <SectionTitle\n        iconName=\"infoCircle\"\n        warnMessage={\n          imputationType === \"none\"\n            ? t({\n                id: \"controls.section.imputation.explanation\",\n                message:\n                  \"For this chart type, replacement values should be assigned to missing values. Decide on the imputation logic or switch to another chart type.\",\n              })\n            : undefined\n        }\n      >\n        <Trans id=\"controls.section.imputation\">Missing values</Trans>\n      </SectionTitle>\n      <ControlSectionContent component=\"fieldset\" gap=\"none\">\n        <Select\n          id=\"imputation-type\"\n          label={getFieldLabel(\"imputation\")}\n          options={IMPUTATION_TYPES.map((d) => ({\n            value: d,\n            label: getImputationTypeLabel(d),\n          }))}\n          value={imputationType}\n          onChange={(e) => {\n            updateImputationType(e.target.value as ImputationType);\n          }}\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Typography } from \"@mui/material\";\n\nimport {\n  EncodingFieldType,\n  EncodingOptionChartSubType,\n  EncodingSpec,\n} from \"@/charts/chart-config-ui-options\";\nimport { LegendSymbol } from \"@/charts/shared/legend-color\";\nimport { Flex } from \"@/components/flex\";\nimport { RadioGroup } from \"@/components/form\";\nimport {\n  ChartConfig,\n  isBarConfig,\n  isColorInConfig,\n  RegularChartConfig,\n} from \"@/config-types\";\nimport { ColorPalette } from \"@/configurator/components/chart-controls/color-palette\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  ChartOptionRadioField,\n  ColorPickerField,\n} from \"@/configurator/components/field\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { Component, Measure } from \"@/domain/data\";\n\nexport const LayoutField = ({\n  encoding,\n  component,\n  chartConfig,\n  components,\n  hasColorPalette,\n  hasSubType,\n  measures,\n}: {\n  encoding: EncodingSpec;\n  component: Component | undefined;\n  chartConfig: RegularChartConfig;\n  components: Component[];\n  hasColorPalette: boolean;\n  hasSubType: boolean;\n  measures: Measure[];\n}) => {\n  const activeField = chartConfig.activeField as EncodingFieldType | undefined;\n\n  if (!activeField) {\n    return null;\n  }\n\n  const hasColorField = isColorInConfig(chartConfig);\n  const values: { id: string; symbol: LegendSymbol }[] = hasColorField\n    ? chartConfig.fields.color.type === \"single\"\n      ? [\n          {\n            id: isBarConfig(chartConfig)\n              ? chartConfig.fields.x.componentId\n              : chartConfig.fields.y.componentId,\n            symbol: \"line\",\n          },\n        ]\n      : Object.keys(chartConfig.fields.color.colorMapping).map((key) => ({\n          id: key,\n          symbol: \"line\",\n        }))\n    : [];\n\n  return encoding.options || hasColorPalette ? (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"swatch\">\n        <Trans id=\"controls.section.layout-options\">Layout Options</Trans>\n      </SectionTitle>\n      <ControlSectionContent gap=\"lg\">\n        {hasSubType && (\n          <ChartSubType\n            encoding={encoding}\n            chartConfig={chartConfig}\n            components={components}\n            disabled={!component}\n          />\n        )}\n        <ColorPalette\n          field={activeField}\n          // Faking a component here, because we don't have a real one.\n          // We use measure iris as dimension values, because that's how\n          // the color mapping is done.\n          component={\n            {\n              __typename: \"\",\n              values: values.map(({ id }) => ({\n                value: id,\n                label: id,\n              })),\n            } as any as Component\n          }\n        />\n        {hasColorField && chartConfig.fields.color.type === \"single\" && (\n          <ColorPickerField\n            field=\"color\"\n            path=\"color\"\n            label={measures.find((d) => d.id === values[0].id)!.label}\n          />\n        )}\n      </ControlSectionContent>\n    </ControlSection>\n  ) : null;\n};\n\nconst ChartSubType = ({\n  encoding,\n  chartConfig,\n  components,\n  disabled,\n}: {\n  encoding: EncodingSpec;\n  chartConfig: ChartConfig;\n  components: Component[];\n  disabled?: boolean;\n}) => {\n  const chartSubType = encoding.options\n    ?.chartSubType as EncodingOptionChartSubType;\n  const values = chartSubType.getValues(chartConfig, components);\n\n  return (\n    <Flex flexDirection=\"column\" sx={{ gap: 1 }}>\n      <Typography variant=\"caption\">\n        <Trans id=\"controls.select.column.layout\">Column layout</Trans>\n      </Typography>\n      <RadioGroup>\n        {values.map((d) => (\n          <ChartOptionRadioField\n            key={d.value}\n            label={getFieldLabel(d.value)}\n            field={encoding.field}\n            path=\"type\"\n            value={d.value}\n            disabled={disabled || d.disabled}\n            warnMessage={d.warnMessage}\n          />\n        ))}\n      </RadioGroup>\n    </Flex>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, Typography } from \"@mui/material\";\nimport get from \"lodash/get\";\nimport dynamic from \"next/dynamic\";\nimport { useMemo } from \"react\";\n\nimport { LegendItem } from \"@/charts/shared/legend-color\";\nimport { Flex } from \"@/components/flex\";\nimport { Radio, RadioGroup, Switch } from \"@/components/form\";\nimport { ChartConfig } from \"@/config-types\";\nimport {\n  getAxisDimension,\n  getMaybeValidChartConfigLimit,\n  getSupportsLimitSymbols,\n  useChartConfigFilters,\n} from \"@/config-utils\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { Dimension, Measure } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { getPalette } from \"@/palettes\";\nimport { Limit } from \"@/rdf/limits\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { useUserPalettes } from \"@/utils/use-user-palettes\";\n\nconst ColorPickerMenu = dynamic(\n  () =>\n    import(\"../chart-controls/color-picker\").then((mod) => mod.ColorPickerMenu),\n  { ssr: false }\n);\n\nexport const LimitsField = ({\n  chartConfig,\n  dimensions,\n  measure,\n}: {\n  chartConfig: ChartConfig;\n  dimensions: Dimension[];\n  measure: Measure;\n}) => {\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n  const filters = useChartConfigFilters(chartConfig);\n  const onToggle = useEvent((checked: boolean, limit: Limit) => {\n    const actionProps = {\n      measureId: measure.id,\n      related: limit.related.map((r) => ({\n        dimensionId: r.dimensionId,\n        value: r.value,\n      })),\n    };\n\n    if (checked) {\n      dispatch({\n        type: \"LIMIT_SET\",\n        value: { ...actionProps, color: \"#ff0000\", lineType: \"solid\" },\n      });\n    } else {\n      dispatch({\n        type: \"LIMIT_REMOVE\",\n        value: actionProps,\n      });\n    }\n  });\n  const axisDimension = getAxisDimension({ chartConfig, dimensions });\n  const availableLimitOptions = useMemo(() => {\n    return measure.limits\n      .map((limit) => {\n        const {\n          limit: maybeLimit,\n          wouldBeValid,\n          relatedAxisDimensionValueLabel,\n        } = getMaybeValidChartConfigLimit({\n          chartConfig,\n          measureId: measure.id,\n          axisDimension,\n          limit,\n          filters,\n        });\n\n        if (!wouldBeValid) {\n          return;\n        }\n\n        const {\n          color = \"#ffffff\",\n          lineType = \"solid\",\n          symbolType = \"circle\",\n        } = maybeLimit ?? {};\n\n        return {\n          relatedAxisDimensionValueLabel,\n          limit,\n          maybeLimit,\n          color,\n          lineType,\n          symbolType,\n        };\n      })\n      .filter(truthy);\n  }, [axisDimension, chartConfig, filters, measure.id, measure.limits]);\n\n  const { data: userPalettes } = useUserPalettes();\n  const paletteId = get(chartConfig, \"fields.color.paletteId\");\n  const colors = getPalette({\n    paletteId,\n    fallbackPalette: userPalettes?.find((d) => d.paletteId === paletteId)\n      ?.colors,\n  });\n  const supportsLimitSymbols = getSupportsLimitSymbols(chartConfig);\n\n  return availableLimitOptions.length > 0 ? (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"target\">\n        <Trans id=\"controls.section.targets-and-limit-values\">\n          Targets & limit values\n        </Trans>\n      </SectionTitle>\n      <ControlSectionContent component=\"fieldset\">\n        {availableLimitOptions.map(\n          (\n            {\n              relatedAxisDimensionValueLabel,\n              maybeLimit,\n              limit,\n              color,\n              lineType,\n              symbolType,\n            },\n            i\n          ) => {\n            /** It means that the limit is rendered as overarching line, not tied\n             * to any axis dimension value. */\n            const hasNoAxisDimension =\n              relatedAxisDimensionValueLabel === undefined;\n\n            return (\n              <Box key={i} sx={{ mb: 2 }}>\n                <Flex\n                  flexDirection=\"column\"\n                  sx={{\n                    gap: 4,\n                    mb:\n                      limit.type === \"value-range\" || supportsLimitSymbols\n                        ? 4\n                        : 0,\n                  }}\n                >\n                  <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 3 }}>\n                    <Switch\n                      id={`limit-${i}`}\n                      label={t({\n                        id: \"controls.section.targets-and-limit-values.show-target\",\n                        message: \"Show target\",\n                      })}\n                      checked={!!maybeLimit}\n                      onChange={(e) => {\n                        onToggle(e.target.checked, limit);\n                      }}\n                    />\n                  </Box>\n                  <Flex\n                    justifyContent=\"space-between\"\n                    alignItems=\"center\"\n                    width=\"100%\"\n                  >\n                    <LegendItem\n                      label={limit.name}\n                      color={color}\n                      symbol=\"square\"\n                    />\n                    <ColorPickerMenu\n                      colors={colors}\n                      selectedHexColor={color}\n                      onChange={(color) => {\n                        dispatch({\n                          type: \"LIMIT_SET\",\n                          value: {\n                            measureId: measure.id,\n                            related: limit.related,\n                            color,\n                            lineType,\n                            symbolType,\n                          },\n                        });\n                      }}\n                      disabled={!maybeLimit}\n                    />\n                  </Flex>\n                </Flex>\n                {limit.type === \"single\" && supportsLimitSymbols ? (\n                  <div>\n                    <Typography variant=\"h6\" component=\"p\" sx={{ mb: 2 }}>\n                      <Trans id=\"controls.section.targets-and-limit-values.symbol-type\">\n                        Select symbol type\n                      </Trans>\n                    </Typography>\n                    <RadioGroup>\n                      <Radio\n                        name={`limit-${i}-symbol-type-dot`}\n                        label={t({ id: \"controls.symbol.dot\", message: \"Dot\" })}\n                        value=\"dot\"\n                        checked={symbolType === \"circle\"}\n                        onChange={() => {\n                          dispatch({\n                            type: \"LIMIT_SET\",\n                            value: {\n                              measureId: measure.id,\n                              related: limit.related,\n                              color,\n                              lineType,\n                              symbolType: \"circle\",\n                            },\n                          });\n                        }}\n                        disabled={!maybeLimit}\n                      />\n                      <Radio\n                        name={`limit-${i}-symbol-type-cross`}\n                        label={t({\n                          id: \"controls.symbol.cross\",\n                          message: \"Cross\",\n                        })}\n                        value=\"cross\"\n                        checked={symbolType === \"cross\"}\n                        onChange={() => {\n                          dispatch({\n                            type: \"LIMIT_SET\",\n                            value: {\n                              measureId: measure.id,\n                              related: limit.related,\n                              color,\n                              lineType,\n                              symbolType: \"cross\",\n                            },\n                          });\n                        }}\n                        disabled={!maybeLimit}\n                      />\n                      <Radio\n                        name={`limit-${i}-symbol-type-triangle`}\n                        label={t({\n                          id: \"controls.symbol.triangle\",\n                          message: \"Triangle\",\n                        })}\n                        value=\"triangle\"\n                        checked={symbolType === \"triangle\"}\n                        onChange={() => {\n                          dispatch({\n                            type: \"LIMIT_SET\",\n                            value: {\n                              measureId: measure.id,\n                              related: limit.related,\n                              color,\n                              lineType,\n                              symbolType: \"triangle\",\n                            },\n                          });\n                        }}\n                        disabled={!maybeLimit}\n                      />\n                    </RadioGroup>\n                  </div>\n                ) : null}\n                {limit.type !== \"single\" ||\n                !supportsLimitSymbols ||\n                hasNoAxisDimension ? (\n                  <div>\n                    <Typography variant=\"body3\" component=\"p\" sx={{ my: 2 }}>\n                      <Trans id=\"controls.section.targets-and-limit-values.line-type\">\n                        Select line type\n                      </Trans>\n                    </Typography>\n                    <RadioGroup>\n                      <Radio\n                        name={`limit-${i}-line-type-solid`}\n                        label={t({\n                          id: \"controls.line.solid\",\n                          message: \"Solid\",\n                        })}\n                        value=\"solid\"\n                        checked={lineType === \"solid\"}\n                        onChange={() => {\n                          dispatch({\n                            type: \"LIMIT_SET\",\n                            value: {\n                              measureId: measure.id,\n                              related: limit.related,\n                              color,\n                              lineType: \"solid\",\n                              symbolType,\n                            },\n                          });\n                        }}\n                        disabled={!maybeLimit}\n                      />\n                      <Radio\n                        name={`limit-${i}-line-type-dashed`}\n                        label={t({\n                          id: \"controls.line.dashed\",\n                          message: \"Dashed\",\n                        })}\n                        value=\"dashed\"\n                        checked={lineType === \"dashed\"}\n                        onChange={() => {\n                          dispatch({\n                            type: \"LIMIT_SET\",\n                            value: {\n                              measureId: measure.id,\n                              related: limit.related,\n                              color,\n                              lineType: \"dashed\",\n                              symbolType,\n                            },\n                          });\n                        }}\n                        disabled={!maybeLimit}\n                      />\n                    </RadioGroup>\n                  </div>\n                ) : null}\n              </Box>\n            );\n          }\n        )}\n      </ControlSectionContent>\n    </ControlSection>\n  ) : null;\n};\n","import { Trans } from \"@lingui/macro\";\nimport get from \"lodash/get\";\n\nimport {\n  EncodingFieldType,\n  EncodingSpec,\n} from \"@/charts/chart-config-ui-options\";\nimport { ChartConfig, isMapConfig } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  DimensionValuesMultiFilter,\n  TimeFilter,\n} from \"@/configurator/components/filters\";\nimport {\n  Component,\n  Dimension,\n  isMeasure,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  Measure,\n} from \"@/domain/data\";\n\nexport const MultiFilterField = ({\n  chartConfig,\n  component,\n  encoding,\n  field,\n  dimensions,\n  measures,\n}: {\n  chartConfig: ChartConfig;\n  component: Component | undefined;\n  encoding: EncodingSpec;\n  field: EncodingFieldType;\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  const colorComponentId = get(\n    chartConfig,\n    isMapConfig(chartConfig)\n      ? `fields[\"${field}\"].color.componentId`\n      : `fields.segment.componentId`\n  );\n  const colorComponent = [...dimensions, ...measures].find(\n    (d) => d.id === colorComponentId\n  );\n\n  return encoding.filters && component ? (\n    <ControlSection data-testid=\"chart-edition-multi-filters\" collapse>\n      <SectionTitle disabled={!component} iconName=\"filter\">\n        <Trans id=\"controls.section.filter\">Filter</Trans>\n      </SectionTitle>\n      <ControlSectionContent component=\"fieldset\" gap=\"none\">\n        <legend style={{ display: \"none\" }}>\n          <Trans id=\"controls.section.filter\">Filter</Trans>\n        </legend>\n        {/* For temporal-based segments, we want to treat values as nominal. */}\n        {(isTemporalDimension(component) ||\n          isTemporalEntityDimension(component)) &&\n        field !== \"segment\" ? (\n          <TimeFilter\n            dimension={component}\n            disableInteractiveFilters={encoding.disableInteractiveFilters}\n          />\n        ) : (\n          component &&\n          !isMeasure(component) && (\n            <DimensionValuesMultiFilter\n              dimension={component}\n              field={field}\n              colorComponent={colorComponent}\n            />\n          )\n        )}\n      </ControlSectionContent>\n    </ControlSection>\n  ) : null;\n};\n","import { t } from \"@lingui/macro\";\nimport { Stack } from \"@mui/material\";\nimport get from \"lodash/get\";\nimport { useMemo, useState } from \"react\";\n\nimport {\n  EncodingFieldType,\n  EncodingOption,\n} from \"@/charts/chart-config-ui-options\";\nimport { Flex } from \"@/components/flex\";\nimport { Checkbox, Input } from \"@/components/form\";\nimport { ChartConfig } from \"@/config-types\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport { Observation } from \"@/domain/data\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const ScaleDomain = ({\n  chartConfig,\n  field,\n  observations,\n  getDefaultDomain,\n}: {\n  chartConfig: ChartConfig;\n  field: EncodingFieldType;\n  observations: Observation[];\n  getDefaultDomain: Extract<\n    EncodingOption,\n    { field: \"adjustScaleDomain\" }\n  >[\"getDefaultDomain\"];\n}) => {\n  const locale = useLocale();\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n  const domain = get(chartConfig, `fields[\"${field}\"].customDomain`) as\n    | [number, number]\n    | undefined;\n  const checked = !!domain;\n  const disabled =\n    chartConfig.interactiveFiltersConfig.calculation.type === \"percent\";\n\n  const defaultDomain = useMemo(() => {\n    return getDefaultDomain({ chartConfig, observations });\n  }, [chartConfig, getDefaultDomain, observations]);\n\n  const handleToggle = useEvent(() => {\n    dispatch({\n      type: \"CHART_FIELD_UPDATED\",\n      value: {\n        locale,\n        field,\n        path: \"customDomain\",\n        value: checked ? FIELD_VALUE_NONE : defaultDomain,\n      },\n    });\n  });\n\n  const handleChange = useEvent((newDomain: [number, number]) => {\n    dispatch({\n      type: \"CHART_FIELD_UPDATED\",\n      value: {\n        locale,\n        field,\n        path: \"customDomain\",\n        value: newDomain,\n      },\n    });\n  });\n\n  return (\n    <Stack\n      gap={2}\n      style={disabled ? { opacity: 0.5, pointerEvents: \"none\" } : {}}\n    >\n      <Checkbox\n        label={t({\n          id: \"controls.adjust-scale-domain\",\n          message: \"Adjust scale domain\",\n        })}\n        checked={checked}\n        onChange={handleToggle}\n      />\n      {checked ? (\n        <Flex justifyContent=\"space-between\" gap={2}>\n          <DomainInput\n            label=\"min\"\n            value={domain[0]}\n            validate={(d) => ({\n              error:\n                d < domain[1]\n                  ? null\n                  : t({\n                      id: \"controls.adjust-scale-domain.min-error\",\n                      message: \"Min must be smaller than max\",\n                    }),\n            })}\n            onCommit={(d) => handleChange([d, domain[1]])}\n          />\n          <DomainInput\n            label=\"max\"\n            value={domain[1]}\n            validate={(d) => ({\n              error:\n                d > domain[0]\n                  ? null\n                  : t({\n                      id: \"controls.adjust-scale-domain.max-error\",\n                      message: \"Max must be bigger than min\",\n                    }),\n            })}\n            onCommit={(d) => handleChange([domain[0], d])}\n          />\n        </Flex>\n      ) : null}\n    </Stack>\n  );\n};\n\nconst DomainInput = ({\n  label,\n  value,\n  onCommit,\n  validate,\n}: {\n  label: string;\n  value: number;\n  onCommit: (newValue: number) => void;\n  validate: (newValue: number) => { error: string | null };\n}) => {\n  const [inputValue, setInputValue] = useState(`${value}`);\n  const [error, setError] = useState<string | undefined>(undefined);\n\n  const handleCommit = () => {\n    const parsed = parseFloat(inputValue);\n\n    if (isNaN(parsed)) {\n      setError(\n        t({\n          id: \"controls.adjust-scale-domain.invalid-number-error\",\n          message: \"Please enter a valid number\",\n        })\n      );\n\n      return;\n    }\n\n    const { error } = validate(parsed);\n\n    if (error) {\n      setError(error);\n\n      return;\n    }\n\n    setError(undefined);\n    onCommit(parsed);\n  };\n\n  return (\n    <Input\n      type=\"number\"\n      label={label}\n      name={label}\n      value={inputValue}\n      onChange={(e) => setInputValue(e.currentTarget.value)}\n      onBlur={handleCommit}\n      onKeyDown={(e) => {\n        if (e.key === \"Enter\") {\n          handleCommit();\n        }\n      }}\n      error={!!error}\n      errorMessage={error}\n    />\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Stack, Typography } from \"@mui/material\";\n\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { RadioGroup } from \"@/components/form\";\nimport { ChartConfig, ShowDotsSize } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  ChartOptionRadioField,\n  ChartOptionSwitchField,\n} from \"@/configurator/components/field\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const ShowDotsField = ({\n  fields,\n  field,\n}: {\n  fields: ChartConfig[\"fields\"];\n  field: EncodingFieldType | null;\n}) => {\n  const locale = useLocale();\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n  const disabled =\n    \"y\" in fields &&\n    (!(\"showDots\" in fields.y) ||\n      (\"showDots\" in fields.y && !fields.y.showDots));\n\n  return (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"lineChart\">\n        <Trans id=\"controls.section.data-points\">Data Points</Trans>\n      </SectionTitle>\n      <ControlSectionContent>\n        <Stack direction=\"column\" gap={4}>\n          <ChartOptionSwitchField\n            path=\"showDots\"\n            field={field}\n            onChange={(e) => {\n              const { checked } = e.target;\n\n              if (\"y\" in fields && !(\"showDots\" in fields.y)) {\n                const value: ShowDotsSize = \"Large\";\n                dispatch({\n                  type: \"CHART_FIELD_UPDATED\",\n                  value: {\n                    locale,\n                    field: \"y\",\n                    path: \"showDotsSize\",\n                    value,\n                  },\n                });\n              }\n\n              dispatch({\n                type: \"CHART_FIELD_UPDATED\",\n                value: {\n                  locale,\n                  field,\n                  path: \"showDots\",\n                  value: checked,\n                },\n              });\n            }}\n            label={t({ id: \"controls.section.show-dots\" })}\n          />\n          <Typography variant=\"caption\" sx={{ mt: 2 }}>\n            <Trans id=\"controls.section.dots-size\">Select a Size</Trans>\n          </Typography>\n          <RadioGroup>\n            <ChartShowDotRadio\n              size=\"Small\"\n              label={t({\n                id: \"controls.section.dots-size.small\",\n                message: \"Small\",\n              })}\n              disabled={disabled}\n            />\n            <ChartShowDotRadio\n              size=\"Medium\"\n              label={t({\n                id: \"controls.section.dots-size.medium\",\n                message: \"Medium\",\n              })}\n              disabled={disabled}\n            />\n            <ChartShowDotRadio\n              size=\"Large\"\n              label={t({\n                id: \"controls.section.dots-size.large\",\n                message: \"Large\",\n              })}\n              disabled={disabled}\n            />\n          </RadioGroup>\n        </Stack>\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n\nconst ChartShowDotRadio = ({\n  size,\n  label,\n  disabled,\n}: {\n  size: ShowDotsSize;\n  label: string;\n  disabled: boolean;\n}) => {\n  return (\n    <ChartOptionRadioField\n      key={size}\n      field=\"y\"\n      path=\"showDotsSize\"\n      value={size}\n      label={label}\n      disabled={disabled}\n    />\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { ChartConfig, ComponentType } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { makeGetFieldOptionGroups } from \"@/configurator/components/chart-options-selector/utils\";\nimport { ChartOptionSelectField } from \"@/configurator/components/field\";\nimport {\n  Component,\n  Dimension,\n  getComponentsFilteredByType,\n  Measure,\n} from \"@/domain/data\";\n\nexport const SizeField = ({\n  chartConfig,\n  field,\n  componentTypes,\n  dimensions,\n  measures,\n  getFieldOptionGroups,\n  optional,\n}: {\n  chartConfig: ChartConfig;\n  field: EncodingFieldType;\n  componentTypes: ComponentType[];\n  dimensions: Dimension[];\n  measures: Measure[];\n  getFieldOptionGroups: ReturnType<typeof makeGetFieldOptionGroups>;\n  optional: boolean;\n}) => {\n  const fieldComponents = useMemo(() => {\n    return getComponentsFilteredByType({\n      dimensionTypes: componentTypes,\n      dimensions,\n      measures,\n    });\n  }, [componentTypes, dimensions, measures]);\n  const getOption = useCallback(\n    (c: Component) => ({ value: c.id, label: c.label }),\n    []\n  );\n  const options = useMemo(() => {\n    return chartConfig.cubes.length === 1 ? fieldComponents.map(getOption) : [];\n  }, [chartConfig.cubes.length, fieldComponents, getOption]);\n  const optionGroups = useMemo(() => {\n    return chartConfig.cubes.length > 1\n      ? getFieldOptionGroups({ fieldComponents, getOption })\n      : undefined;\n  }, [\n    chartConfig.cubes.length,\n    fieldComponents,\n    getFieldOptionGroups,\n    getOption,\n  ]);\n\n  return (\n    <ControlSection collapse>\n      <SectionTitle iconName=\"size\">\n        {t({\n          id: \"controls.size\",\n          message: \"Size\",\n        })}\n      </SectionTitle>\n      <ControlSectionContent>\n        <ChartOptionSelectField\n          id=\"size-measure\"\n          label={t({\n            id: \"controls.select.measure\",\n            message: \"Select a measure\",\n          })}\n          field={field}\n          path=\"measureId\"\n          options={options}\n          optionGroups={optionGroups}\n          optional={optional}\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport get from \"lodash/get\";\nimport { useCallback } from \"react\";\n\nimport { DEFAULT_SORTING } from \"@/charts\";\nimport {\n  EncodingFieldType,\n  EncodingSortingOption,\n} from \"@/charts/chart-config-ui-options\";\nimport { Radio, RadioGroup, Select } from \"@/components/form\";\nimport { ChartConfig, SortingType } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const SortingField = ({\n  chartConfig,\n  field,\n  encodingSortingOptions,\n  disabled = false,\n}: {\n  chartConfig: ChartConfig;\n  field: EncodingFieldType;\n  encodingSortingOptions: EncodingSortingOption[];\n  disabled?: boolean;\n}) => {\n  const locale = useLocale();\n  const [, dispatch] = useConfiguratorState(isConfiguring);\n\n  const getSortingTypeLabel = (type: SortingType) => {\n    switch (type) {\n      case \"byDimensionLabel\":\n        return t({ id: \"controls.sorting.byDimensionLabel\", message: \"Name\" });\n      case \"byMeasure\":\n        return t({ id: \"controls.sorting.byMeasure\", message: \"Measure\" });\n      case \"byTotalSize\":\n        return t({ id: \"controls.sorting.byTotalSize\", message: \"Total size\" });\n      case \"byAuto\":\n        return t({ id: \"controls.sorting.byAuto\", message: \"Automatic\" });\n      default:\n        const _exhaustiveCheck: never = type;\n        return _exhaustiveCheck;\n    }\n  };\n\n  const updateSortingOption = useCallback(\n    ({\n      sortingType,\n      sortingOrder,\n    }: {\n      sortingType: EncodingSortingOption[\"sortingType\"];\n      sortingOrder: \"asc\" | \"desc\";\n    }) => {\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field,\n          path: \"sorting\",\n          value: { sortingType, sortingOrder },\n        },\n      });\n    },\n    [locale, dispatch, field]\n  );\n\n  const activeSortingType = get(\n    chartConfig,\n    [\"fields\", field, \"sorting\", \"sortingType\"],\n    DEFAULT_SORTING[\"sortingType\"]\n  );\n\n  // FIXME: Remove this once it's properly encoded in chart-config-ui-options\n  const sortingOrderOptions = encodingSortingOptions.find(\n    (o) => o.sortingType === activeSortingType\n  )?.sortingOrder;\n  const activeSortingOrder = get(\n    chartConfig,\n    [\"fields\", field, \"sorting\", \"sortingOrder\"],\n    sortingOrderOptions?.[0] ?? \"asc\"\n  );\n\n  return (\n    <ControlSection collapse>\n      <SectionTitle disabled={disabled} iconName=\"sort\">\n        <Trans id=\"controls.section.sorting\">Sort</Trans>\n      </SectionTitle>\n      <ControlSectionContent>\n        <Select\n          id=\"sort-by\"\n          size=\"sm\"\n          label={getFieldLabel(\"sortBy\")}\n          options={encodingSortingOptions?.map((d) => {\n            const disabledState = d.getDisabledState?.(chartConfig);\n\n            return {\n              value: d.sortingType,\n              label: getSortingTypeLabel(d.sortingType),\n              ...disabledState,\n            };\n          })}\n          value={activeSortingType}\n          disabled={disabled}\n          onChange={(e) => {\n            updateSortingOption({\n              sortingType: e.target\n                .value as EncodingSortingOption[\"sortingType\"],\n              sortingOrder: activeSortingOrder,\n            });\n          }}\n        />\n        <RadioGroup>\n          {sortingOrderOptions &&\n            sortingOrderOptions.map((sortingOrder) => {\n              const subType = get(\n                chartConfig,\n                [\"fields\", \"segment\", \"type\"],\n                \"\"\n              );\n              const chartSubType = `${chartConfig.chartType}.${subType}`;\n\n              return (\n                <Radio\n                  key={sortingOrder}\n                  label={getFieldLabel(\n                    `${chartSubType}.${activeSortingType}.${sortingOrder}`\n                  )}\n                  value={sortingOrder}\n                  checked={sortingOrder === activeSortingOrder}\n                  disabled={disabled}\n                  onChange={(e) => {\n                    if (e.currentTarget.checked) {\n                      updateSortingOption({\n                        sortingType: activeSortingType,\n                        sortingOrder,\n                      });\n                    }\n                  }}\n                />\n              );\n            })}\n        </RadioGroup>\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport groupBy from \"lodash/groupBy\";\n\nimport { SelectOption, SelectOptionGroup } from \"@/components/form\";\nimport { Component, DataCubeMetadata } from \"@/domain/data\";\nimport { isJoinByCube } from \"@/graphql/join\";\n\nexport const makeGetFieldOptionGroups =\n  ({ cubesMetadata }: { cubesMetadata: DataCubeMetadata[] }) =>\n  ({\n    fieldComponents,\n    getOption,\n  }: {\n    fieldComponents: Component[];\n    getOption: (component: Component) => SelectOption;\n  }): SelectOptionGroup[] => {\n    const fieldComponentsByCubeIri = groupBy(fieldComponents, (d) => d.cubeIri);\n\n    return Object.entries(fieldComponentsByCubeIri).map(([cubeIri, dims]) => {\n      return [\n        {\n          label: isJoinByCube(cubeIri)\n            ? t({ id: \"dimension.joined\" })\n            : cubesMetadata.find((d) => d.iri === cubeIri)?.title,\n          value: cubeIri,\n        },\n        dims.map(getOption),\n      ];\n    });\n  };\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Alert,\n  alertClasses,\n  Box,\n  Chip,\n  Table,\n  TableBody,\n  TableCell,\n  TableRow,\n  Theme,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\n\nimport { Icon } from \"@/icons\";\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  alert: {\n    marginBottom: theme.spacing(2),\n    boxShadow: \"none\",\n    padding: theme.spacing(1),\n    flexShrink: 1,\n  },\n  table: {\n    marginBottom: theme.spacing(1),\n    \"& .MuiTableCell-root\": {\n      padding: theme.spacing(0.5, 1),\n      borderBottom: \"none\",\n    },\n  },\n  attributeName: {\n    fontWeight: 500,\n  },\n  chips: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    gap: theme.spacing(0.5),\n  },\n  chip: {\n    fontSize: \"0.7rem\",\n  },\n  booleanIcon: {\n    fontSize: \"1rem\",\n  },\n}));\n\ninterface ProviderExtraInfo {\n  canListLayers?: boolean;\n  canDisplayLayers?: boolean;\n  canDisplayOnMapGeoAdmin?: boolean;\n  workingLayers?: string[];\n  note?: string;\n}\n\nexport const ProviderInfoAlert = ({\n  extraInfo,\n}: {\n  extraInfo: ProviderExtraInfo;\n}) => {\n  const classes = useStyles();\n\n  const booleanAttributes = [\n    {\n      key: \"canListLayers\",\n      label: t({\n        id: \"provider-info.can-list-layers\",\n        message: \"Can list layers\",\n      }),\n    },\n    {\n      key: \"canDisplayLayers\",\n      label: t({\n        id: \"provider-info.can-display-layers\",\n        message: \"Can display layers\",\n      }),\n    },\n    {\n      key: \"canDisplayOnMapGeoAdmin\",\n      label: t({\n        id: \"provider-info.can-display-on-map-geo-admin\",\n        message: \"Can display on map.geo.admin.ch\",\n      }),\n    },\n  ];\n\n  const hasAttributes = Object.keys(extraInfo).some(\n    (key) =>\n      key !== \"note\" && extraInfo[key as keyof ProviderExtraInfo] !== undefined\n  );\n\n  return (\n    <Alert\n      severity=\"info\"\n      className={classes.alert}\n      elevation={0}\n      sx={{\n        py: 1,\n        px: 2,\n        [`& .${alertClasses.message}`]: {\n          flexDirection: \"column\",\n          display: \"flex\",\n          gap: 1,\n          width: \"100%\",\n        },\n      }}\n      slotProps={{}}\n    >\n      <div>\n        <Trans id=\"provider-info.title\">\n          The WMS / WMTS support is currently in beta and there are some\n          limitations with this provider, please see the following information.\n        </Trans>\n      </div>\n      {hasAttributes && (\n        <Table size=\"small\" className={classes.table}>\n          <TableBody>\n            {booleanAttributes.map((attr) => {\n              const value = extraInfo[attr.key as keyof ProviderExtraInfo];\n              if (value === undefined) return null;\n\n              return (\n                <TableRow key={attr.key}>\n                  <TableCell className={classes.attributeName}>\n                    {attr.label}\n                  </TableCell>\n                  <TableCell>\n                    {value ? (\n                      <Icon\n                        name=\"checkmark\"\n                        color=\"success\"\n                        className={classes.booleanIcon}\n                      />\n                    ) : (\n                      <Icon\n                        name=\"close\"\n                        color=\"error\"\n                        className={classes.booleanIcon}\n                      />\n                    )}\n                  </TableCell>\n                </TableRow>\n              );\n            })}\n\n            {extraInfo.workingLayers?.length ? (\n              <TableRow>\n                <TableCell className={classes.attributeName}>\n                  {t({\n                    id: \"provider-info.working-layers\",\n                    message: \"Working layers\",\n                  })}\n                </TableCell>\n                <TableCell>\n                  <Box className={classes.chips}>\n                    {extraInfo.workingLayers.map((layer) => (\n                      <Chip\n                        key={layer}\n                        label={layer}\n                        size=\"small\"\n                        className={classes.chip}\n                      />\n                    ))}\n                  </Box>\n                </TableCell>\n              </TableRow>\n            ) : null}\n          </TableBody>\n        </Table>\n      )}\n\n      {extraInfo.note && <div>{extraInfo.note}</div>}\n    </Alert>\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport {\n  Autocomplete,\n  createFilterOptions,\n  TextField,\n  Theme,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport sortBy from \"lodash/sortBy\";\nimport { useMemo } from \"react\";\n\nimport { guessUrlType } from \"@/charts/map/wms-wmts-endpoint-utils\";\nimport { ProviderInfoAlert } from \"@/charts/map/wms-wmts-provider-info\";\nimport wmsWmtsProvidersExtra_ from \"@/charts/map/wms-wmts-providers-extra.json\";\nimport wmsWmtsProviders from \"@/charts/map/wms-wmts-providers.json\";\nimport { useFlag } from \"@/flags\";\n\nconst wmsWmtsProvidersExtra = wmsWmtsProvidersExtra_ as Record<\n  string,\n  {\n    hidden?: boolean;\n    note?: string;\n    canListLayers?: boolean;\n    canDisplayLayers?: boolean;\n    canDisplayOnMapGeoAdmin?: boolean;\n    workingLayers?: string[];\n  }\n>;\n\ntype ProviderUrl = string;\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  listbox: {\n    maxHeight: 300,\n    \"& li\": {\n      whiteSpace: \"nowrap\",\n      textOverflow: \"ellipsis\",\n      overflow: \"hidden\",\n      fontSize: theme.typography.body2.fontSize,\n      display: \"block\",\n      minWidth: 0,\n    },\n  },\n  paper: {\n    minHeight: 300,\n    width: 500,\n  },\n  input: {\n    \"&&\": {\n      fontSize: theme.typography.body2.fontSize,\n    },\n  },\n  chip: {\n    marginRight: theme.spacing(1),\n    marginLeft: theme.spacing(-2),\n    fontSize: \"0.75rem\",\n    color: theme.palette.text.secondary,\n    backgroundColor: theme.palette.background.paper,\n  },\n}));\n\nconst inferUrlGroup = (host: string) => {\n  return host.split(\".\").slice(-2).join(\".\");\n};\n\nexport const ProviderAutocomplete = ({\n  value,\n  onChange,\n}: {\n  value: ProviderUrl | null;\n  onChange: (newValue: ProviderUrl | null) => void;\n}) => {\n  const classes = useStyles();\n  const extraInfo = value ? wmsWmtsProvidersExtra[value] : undefined;\n  const showExtraInfo = useFlag(\"wmts-show-extra-info\");\n  const options = useMemo(() => {\n    const options = wmsWmtsProviders\n      .filter((p) => {\n        return !wmsWmtsProvidersExtra[p] || !wmsWmtsProvidersExtra[p].hidden;\n      })\n      .map((provider) => {\n        const url = new URL(provider);\n        const group = inferUrlGroup(url.host);\n        return {\n          url: url,\n          host: url.host,\n          label: url.href.replace(`${url.protocol}//`, \"\"),\n          group: group,\n          value: provider,\n          type: guessUrlType(provider),\n        };\n      });\n\n    // Need to sort by group to remove warning in the console\n    return sortBy(options, (option) => option.group);\n  }, []);\n\n  const filterOptions = useMemo(() => {\n    return createFilterOptions({\n      stringify: (option: (typeof options)[number]) => {\n        if (typeof option === \"string\") {\n          return option;\n        }\n        return `${option.url}`;\n      },\n    });\n  }, []);\n  return (\n    <>\n      <Autocomplete\n        options={options}\n        value={value}\n        freeSolo\n        filterOptions={filterOptions}\n        groupBy={(option) => option.group}\n        // @ts-ignore\n        getOptionLabel={(option) =>\n          typeof option === \"string\" ? option : option.label\n        }\n        onChange={(_ev, newValue) =>\n          onChange(\n            typeof newValue === \"string\" ? newValue : (newValue?.value ?? null)\n          )\n        }\n        size=\"small\"\n        ListboxProps={{\n          className: classes.listbox,\n        }}\n        slotProps={{\n          paper: {\n            elevation: 6,\n            className: classes.paper,\n          },\n        }}\n        renderInput={(params) => (\n          <TextField\n            {...params}\n            placeholder={t({\n              id: \"wmts-providers-autocomplete.placeholder\",\n              message: \"WMTS WMS URL\",\n            })}\n            variant=\"outlined\"\n            margin=\"normal\"\n            fullWidth\n            size=\"small\"\n            InputProps={{\n              ...params.InputProps,\n              slotProps: {\n                input: {\n                  className: classes.input,\n                },\n              },\n            }}\n          />\n        )}\n      />\n      {extraInfo && showExtraInfo && (\n        <ProviderInfoAlert extraInfo={extraInfo} />\n      )}\n    </>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { TreeItem, TreeView } from \"@mui/lab\";\nimport {\n  Box,\n  Checkbox,\n  Collapse,\n  IconButton,\n  Input,\n  Popover,\n  Theme,\n  Tooltip,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport sortBy from \"lodash/sortBy\";\nimport uniqBy from \"lodash/uniqBy\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport createStore from \"zustand\";\n\nimport { RemoteLayer } from \"@/charts/map/types\";\nimport { RemoteWMSLayer } from \"@/charts/map/wms-utils\";\nimport {\n  isRemoteLayerCRSSupported,\n  makeKey,\n  useWMTSorWMSLayers,\n} from \"@/charts/map/wms-wmts-endpoint-utils\";\nimport { ProviderAutocomplete } from \"@/charts/map/wms-wmts-providers-autocomplete\";\nimport { RemoteWMTSLayer } from \"@/charts/map/wmts-utils\";\nimport { Flex } from \"@/components/flex\";\nimport { HintError, Spinner } from \"@/components/hint\";\nimport { Tree, useSelectTree } from \"@/components/select-tree\";\nimport { Icon } from \"@/icons\";\nimport SvgIcChevronRight from \"@/icons/components/IcChevronRight\";\nimport SvgIcClose from \"@/icons/components/IcClose\";\nimport SvgIcInfoCircle from \"@/icons/components/IcInfoCircle\";\nimport { mapTree, visitHierarchy } from \"@/rdf/tree-utils\";\n\nconst useTreeItemStyles = makeStyles({\n  // Necessary to use $content below\n  content: {},\n  root: {\n    \"&:hover > div > $iconContainer\": {\n      opacity: 1,\n    },\n    \"--depth\": 1,\n    \"& &\": {\n      \"--depth\": 2,\n    },\n    \"& & &\": {\n      \"--depth\": 3,\n    },\n    \"& & & &\": {\n      \"--depth\": 4,\n    },\n    \"& & & & &\": {\n      \"--depth\": 5,\n    },\n    \"& $content\": {\n      paddingLeft: \"calc(var(--depth) * 10px)\",\n    },\n  },\n  iconContainer: {\n    opacity: 0.5,\n\n    \"&:empty\": {\n      display: \"none\",\n    },\n  },\n  label: {\n    \"&&\": {\n      padding: \"0.25rem\",\n    },\n  },\n  group: {\n    // The padding is done on the content inside the row for the hover\n    // effect to extend until the edge of the popover\n    marginLeft: 0,\n  },\n});\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  treeRow: {\n    display: \"flex\",\n    gap: \"0.5rem\",\n    fontSize: theme.typography.body2.fontSize,\n    width: \"100%\",\n    alignItems: \"center\",\n  },\n  label: {\n    flexGrow: 1,\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n    whiteSpace: \"nowrap\",\n    lineHeight: \"1.5rem\",\n  },\n  warnIcon: {\n    color: theme.palette.warning.main,\n  },\n}));\n\nconst LegendButton = ({\n  layer,\n}: {\n  layer: RemoteWMTSLayer | RemoteWMSLayer;\n}) => {\n  const [showLegend, setShowLegend] = useState<\n    | {\n        value: string;\n        element: HTMLButtonElement;\n      }\n    | undefined\n  >();\n  return (\n    <>\n      <IconButton\n        data-value={layer.path}\n        size=\"small\"\n        onClick={(ev) => {\n          return setShowLegend({\n            value: layer.path,\n            element: ev.currentTarget,\n          });\n        }}\n      >\n        <SvgIcInfoCircle />\n      </IconButton>\n      <Popover\n        elevation={6}\n        anchorEl={showLegend?.element}\n        open={!!showLegend}\n        onClose={() => setShowLegend(undefined)}\n      >\n        <Box sx={{ p: 2, position: \"relative\", width: 300 }}>\n          <Typography variant=\"h5\" gutterBottom>\n            <Trans id=\"wmts.legend-title\">Legend</Trans>\n          </Typography>\n          <IconButton\n            sx={{ position: \"absolute\", top: \"0.25rem\", right: \"0.25rem\" }}\n            size=\"small\"\n            onClick={() => setShowLegend(undefined)}\n          >\n            <SvgIcClose />\n          </IconButton>\n          {showLegend && (\n            // eslint-disable-next-line @next/next/no-img-element\n            <img src={layer?.legendUrl} style={{ maxWidth: \"100%\" }} alt=\"\" />\n          )}\n        </Box>\n      </Popover>\n    </>\n  );\n};\n\nconst TreeRow = ({\n  layer,\n  className,\n  classes,\n  label,\n  value,\n  initialChecked,\n  onCheck,\n}: {\n  layer: RemoteLayer;\n  className?: string;\n  classes: ReturnType<typeof useStyles>;\n  label: string;\n  value: string;\n  initialChecked?: boolean;\n  onCheck: (layer: RemoteLayer, checked: boolean) => void;\n}) => {\n  const [checked, setChecked] = useState(initialChecked ?? false);\n  const handleChangeCheckbox = useCallback(() => {\n    return setChecked((c) => {\n      const newValue = !c;\n      onCheck(layer, newValue);\n      return newValue;\n    });\n  }, [layer, onCheck]);\n\n  return (\n    <div className={className}>\n      {layer.id ? (\n        <Checkbox\n          inputProps={{\n            // @ts-ignore\n            \"data-value\": value,\n          }}\n          onClick={handleChangeCheckbox}\n          checked={checked}\n        />\n      ) : null}\n      <div className={classes.label} onClick={handleChangeCheckbox}>\n        {label}\n      </div>\n      {layer && layer.legendUrl ? <LegendButton layer={layer} /> : null}\n      {isRemoteLayerCRSSupported(layer) ? null : (\n        <Tooltip\n          title={t({\n            id: \"wmts.layer-not-supported-crs\",\n            message: \"Layer not supported, no supported CRS\",\n          })}\n        >\n          <span>\n            <Icon name=\"warningCircleFilled\" className={classes.warnIcon} />\n          </span>\n        </Tooltip>\n      )}\n    </div>\n  );\n};\n\nconst useInputValueStore = createStore<{\n  inputValue: string;\n  setInputValue: (inputValue: string) => void;\n  provider: string | null;\n  setProvider: (provider: string | null) => void;\n}>((set) => ({\n  inputValue: \"\",\n  setInputValue: (inputValue: string) => {\n    set({ inputValue });\n  },\n  provider: null,\n  setProvider: (provider: string | null) => {\n    set({ provider });\n  },\n}));\n\nexport const WMTSSelector = ({\n  onLayerCheck,\n  selected,\n}: {\n  onLayerCheck: (layer: RemoteLayer, checked: boolean) => void;\n  selected: string[];\n}) => {\n  const treeItemClasses = useTreeItemStyles();\n\n  const classes = useStyles();\n\n  const { provider, setProvider, inputValue, setInputValue } =\n    useInputValueStore();\n\n  const endpoints = useMemo(() => (provider ? [provider] : []), [provider]);\n\n  const { data: groupedLayers, error, status } = useWMTSorWMSLayers(endpoints);\n  const { wms: wmsLayers, wmts: wmtsLayers } = useMemo(() => {\n    return (\n      groupedLayers ?? {\n        wms: [],\n        wmts: [],\n      }\n    );\n  }, [groupedLayers]);\n\n  const allLayers = useMemo(\n    () => uniqBy([...wmsLayers, ...wmtsLayers], (x) => x.path),\n    [wmsLayers, wmtsLayers]\n  );\n\n  const layersByPath = useMemo(() => {\n    const res: Record<string, RemoteLayer> = {};\n    visitHierarchy(allLayers, (x) => {\n      if (res[x.path]) {\n        return;\n      }\n      res[x.path] = x;\n    });\n    return res;\n  }, [allLayers]);\n\n  const selectedSet = useMemo(() => {\n    return new Set(selected);\n  }, [selected]);\n\n  const options = useMemo(() => {\n    return mapTree(allLayers, ({ children, ...x }) => ({\n      ...x,\n      hasValue: true,\n      value: x.path,\n      label: x.title,\n      id: x.path,\n      nodeId: x.path,\n      itemId: x.path,\n    }));\n  }, [allLayers]);\n\n  const {\n    filteredOptions: unsortedFilteredOptions,\n    expanded,\n    handleInputChange,\n    handleNodeToggle,\n    handleClickResetInput,\n    defaultExpanded,\n  } = useSelectTree({\n    value: \"\",\n    options,\n    inputValue,\n    onChangeInputValue: setInputValue,\n  });\n\n  const filteredOptions = useMemo(() => {\n    return mapTree(\n      sortBy(unsortedFilteredOptions, (x) => x.label),\n      (x) => ({\n        ...x,\n        children: sortBy(x.children, (y) => y.label),\n      })\n    );\n  }, [unsortedFilteredOptions]);\n\n  const renderTreeContent = useCallback(\n    (nodesData: Tree) => {\n      return (\n        <>\n          {nodesData.map(({ value, label, children, selectable }) => {\n            return (\n              <TreeItem\n                key={value}\n                nodeId={value}\n                size=\"small\"\n                classes={treeItemClasses}\n                defaultExpanded={defaultExpanded}\n                label={\n                  <TreeRow\n                    className={classes.treeRow}\n                    classes={classes}\n                    layer={layersByPath[value]}\n                    label={label}\n                    value={value}\n                    onCheck={onLayerCheck}\n                    initialChecked={selectedSet.has(\n                      makeKey(layersByPath[value])\n                    )}\n                  />\n                }\n                expandIcon={\n                  children && children.length > 0 ? <SvgIcChevronRight /> : null\n                }\n                TransitionComponent={Collapse}\n                ContentProps={{\n                  // @ts-expect-error - TS says we cannot put a data attribute\n                  // on the HTML element, but we know we can.\n                  \"data-selectable\": selectable,\n                  \"data-children\": children && children.length > 0,\n                }}\n              >\n                {children ? renderTreeContent(children) : null}\n              </TreeItem>\n            );\n          })}\n        </>\n      );\n    },\n    [\n      treeItemClasses,\n      defaultExpanded,\n      classes,\n      layersByPath,\n      onLayerCheck,\n      selectedSet,\n    ]\n  );\n\n  return (\n    <Flex\n      style={{\n        flexDirection: \"column\",\n        width: \"100%\",\n        maxWidth: \"100%\",\n        overflow: \"hidden\",\n      }}\n    >\n      {error ? (\n        <HintError>\n          <Trans id=\"wmts.error-invalid-url\">Invalid URL</Trans>\n        </HintError>\n      ) : null}\n      <ProviderAutocomplete\n        value={provider}\n        onChange={(newValue) => setProvider(newValue)}\n      />\n      {provider && (\n        <Input\n          size=\"sm\"\n          value={inputValue}\n          autoFocus\n          startAdornment={<Icon name=\"search\" size={18} />}\n          placeholder={t({\n            id: \"wmts.search-placeholder\",\n            message: \"Search in imported maps...\",\n          })}\n          endAdornment={\n            inputValue.length > 0 ? (\n              <IconButton size=\"small\" onClick={handleClickResetInput}>\n                <Icon name=\"close\" size={16} />\n              </IconButton>\n            ) : null\n          }\n          onChange={handleInputChange}\n          sx={{\n            px: 2,\n            py: 1,\n\n            \"& .MuiInput-input\": {\n              px: 1,\n            },\n          }}\n        />\n      )}\n      {status === \"fetching\" ? (\n        <Box textAlign=\"center\" p={2}>\n          <Spinner size={24} />\n        </Box>\n      ) : null}\n      <TreeView\n        expanded={expanded}\n        onNodeToggle={handleNodeToggle}\n        style={{ flexGrow: 1, overflow: \"auto\" }}\n      >\n        {renderTreeContent(filteredOptions)}\n      </TreeView>\n    </Flex>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Button,\n  DrawerProps,\n  IconButton,\n  Typography,\n  useEventCallback,\n} from \"@mui/material\";\nimport uniq from \"lodash/uniq\";\nimport { ReactNode, useCallback, useMemo, useState } from \"react\";\nimport {\n  DragDropContext,\n  Draggable,\n  Droppable,\n  OnDragEndResponder,\n} from \"react-beautiful-dnd\";\n\nimport { RemoteLayer } from \"@/charts/map/types\";\nimport { RemoteWMSLayer } from \"@/charts/map/wms-utils\";\nimport {\n  getLayerKey,\n  makeKey,\n  useWMTSorWMSLayers,\n} from \"@/charts/map/wms-wmts-endpoint-utils\";\nimport { WMTSSelector } from \"@/charts/map/wms-wmts-selector\";\nimport { RemoteWMTSLayer } from \"@/charts/map/wmts-utils\";\nimport { Switch } from \"@/components/form\";\nimport { MoveDragButton } from \"@/components/move-drag-button\";\nimport { MapConfig, WMSCustomLayer, WMTSCustomLayer } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  ControlSectionSkeleton,\n  SectionTitle,\n  useSectionTitleStyles,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ConfiguratorDrawer } from \"@/configurator/components/drawers\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { truthy } from \"@/domain/types\";\nimport { Icon } from \"@/icons\";\n\nconst LeftDrawer = ({\n  children,\n  open,\n  onClose,\n  onExited,\n}: {\n  children: ReactNode;\n  open?: DrawerProps[\"open\"];\n  onClose?: DrawerProps[\"onClose\"];\n  onExited?: () => void;\n}) => {\n  return (\n    <ConfiguratorDrawer\n      anchor=\"left\"\n      open={open}\n      variant=\"temporary\"\n      onClose={onClose}\n      SlideProps={{\n        onExited: onExited,\n      }}\n      hideBackdrop\n    >\n      {children}\n    </ConfiguratorDrawer>\n  );\n};\n\nexport const CustomLayersSelector = () => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state) as MapConfig;\n  const configLayers = chartConfig.baseLayer.customLayers;\n  const endpoints = useMemo(() => {\n    return uniq(configLayers.map((layer) => layer.endpoint)).filter(truthy);\n  }, [configLayers]);\n  const {\n    data: groupedLayers,\n    error,\n    status: layersStatus,\n  } = useWMTSorWMSLayers(endpoints);\n  const {\n    wms: wmsLayers,\n    wmts: wmtsLayers,\n    byKey: layersByKey,\n  } = groupedLayers!;\n\n  const handleDragEnd: OnDragEndResponder = useEventCallback((e) => {\n    const oldIndex = e.source.index;\n    const newIndex = e.destination?.index;\n\n    if (typeof newIndex !== \"number\" || e.source === e.destination) {\n      return;\n    }\n\n    dispatch({\n      type: \"CUSTOM_LAYER_SWAP\",\n      value: {\n        oldIndex: configLayers.length - 1 - oldIndex,\n        newIndex: configLayers.length - 1 - newIndex,\n      },\n    });\n  });\n\n  const handleCheckLayer = useCallback(\n    (layer: RemoteWMSLayer | RemoteWMTSLayer | null, checked: boolean) => {\n      const valueType = layer?.type;\n\n      if (!valueType) {\n        return;\n      }\n\n      if (!checked) {\n        dispatch({\n          type: \"CUSTOM_LAYER_REMOVE\",\n          value: {\n            type: valueType,\n            id: layer.id,\n          },\n        });\n        return;\n      } else {\n        switch (valueType) {\n          case \"wms\":\n            dispatch({\n              type: \"CUSTOM_LAYER_ADD\",\n              value: {\n                layer: {\n                  type: \"wms\",\n                  id: layer.id,\n                  isBehindAreaLayer: false,\n                  syncTemporalFilters: false,\n                  endpoint: layer.endpoint,\n                },\n              },\n            });\n            break;\n          case \"wmts\":\n            dispatch({\n              type: \"CUSTOM_LAYER_ADD\",\n              value: {\n                layer: {\n                  type: \"wmts\",\n                  id: layer.id,\n                  url: layer.url,\n                  isBehindAreaLayer: false,\n                  syncTemporalFilters: false,\n                  endpoint: layer.endpoint,\n                },\n              },\n            });\n            break;\n          default:\n            const _exhaustiveCheck: never = valueType;\n            return _exhaustiveCheck;\n        }\n      }\n    },\n    [dispatch]\n  );\n\n  const [addingLayer, setAddingLayer] = useState(false);\n  const getParsedLayer = useMemo(() => {\n    return (configLayer: WMTSCustomLayer | WMSCustomLayer) => {\n      const key = getLayerKey(configLayer);\n      return layersByKey[key];\n    };\n  }, [layersByKey]);\n  const sectionTitleClasses = useSectionTitleStyles({\n    sectionOpen: true,\n    interactive: true,\n  });\n  const selectedLayers = useMemo(() => {\n    return configLayers.map((layer) => {\n      return makeKey(layer);\n    });\n  }, [configLayers]);\n  const handleLayerCheck = useCallback(\n    (layer: RemoteLayer, checked: boolean) => {\n      return handleCheckLayer(layer, checked);\n    },\n    [handleCheckLayer]\n  );\n\n  return error ? (\n    <Typography mx={2} color=\"error\">\n      {error.message}\n    </Typography>\n  ) : !wmsLayers || !wmtsLayers ? (\n    <ControlSectionSkeleton />\n  ) : (\n    <ControlSection hideTopBorder>\n      <SectionTitle closable>\n        <Trans id=\"chart.map.layers.custom-layers\">Import map</Trans>\n      </SectionTitle>\n      <LeftDrawer open={addingLayer} onClose={() => setAddingLayer(false)}>\n        <div>\n          <div\n            className={sectionTitleClasses.root}\n            onClick={() => setAddingLayer(false)}\n          >\n            <Typography variant=\"h6\" className={sectionTitleClasses.text}>\n              <Icon name=\"chevronLeft\" />\n              <Trans id=\"wmts.custom-layer.section-title\">\n                Add custom layer\n              </Trans>\n            </Typography>\n          </div>\n        </div>\n        <Box px={4}>\n          {addingLayer ? (\n            <WMTSSelector\n              onLayerCheck={handleLayerCheck}\n              selected={selectedLayers}\n            />\n          ) : null}\n        </Box>\n      </LeftDrawer>\n      <ControlSectionContent gap=\"lg\">\n        {configLayers.length === 0 && (\n          <Typography variant=\"body3\" color=\"text.secondary\">\n            <Trans id=\"chart.map.layers.no-layers\">No imported maps</Trans>\n          </Typography>\n        )}\n\n        {layersStatus === \"success\" ? (\n          <DragDropContext onDragEnd={handleDragEnd}>\n            <Droppable droppableId=\"layers\">\n              {(provided) => (\n                <div {...provided.droppableProps} ref={provided.innerRef}>\n                  {[...configLayers].reverse().map((configLayer, i) => {\n                    return (\n                      <DraggableLayer\n                        key={`${configLayer.type}-${configLayer.id}`}\n                        configLayer={configLayer}\n                        parsedLayer={getParsedLayer(configLayer)}\n                        index={i}\n                      />\n                    );\n                  })}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n        ) : null}\n\n        {layersStatus === \"fetching\" ? (\n          <div style={{ width: \"100%\" }}>\n            <ControlSectionSkeleton />\n          </div>\n        ) : null}\n\n        <div>\n          <Button variant=\"contained\" onClick={() => setAddingLayer(true)}>\n            <Trans id=\"chart.map.layers.add-layer\">Add map</Trans>\n          </Button>\n        </div>\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n\nconst DraggableLayer = ({\n  configLayer,\n  index,\n  parsedLayer,\n}: {\n  configLayer: WMSCustomLayer | WMTSCustomLayer;\n  index: number;\n  parsedLayer: RemoteWMSLayer | RemoteWMTSLayer;\n}) => {\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n  const value = configLayer.id;\n\n  const enableTemporalFiltering = useMemo(() => {\n    switch (configLayer.type) {\n      case \"wms\":\n        return false;\n      case \"wmts\":\n        return (\n          parsedLayer?.availableDimensionValues &&\n          parsedLayer.availableDimensionValues.length > 1\n        );\n      default:\n        const _exhaustiveCheck: never = configLayer;\n        return _exhaustiveCheck;\n    }\n  }, [configLayer, parsedLayer?.availableDimensionValues]);\n\n  const handleRemoveClick = () => {\n    dispatch({\n      type: \"CUSTOM_LAYER_REMOVE\",\n      value: {\n        type: configLayer.type,\n        id: configLayer.id,\n      },\n    });\n  };\n\n  return (\n    <Draggable key={value} draggableId={value} index={index}>\n      {(provided) => (\n        <Box\n          ref={provided.innerRef}\n          {...provided.dragHandleProps}\n          {...provided.draggableProps}\n          sx={{ mb: 3 }}\n        >\n          <Box\n            sx={{\n              display: \"flex\",\n              alignItems: \"center\",\n              gap: 1,\n            }}\n          >\n            <Typography variant=\"body3\" sx={{ flexGrow: 1 }}>\n              {parsedLayer?.title ?? \"Unknown layer\"}\n            </Typography>\n            <IconButton onClick={handleRemoveClick}>\n              <Icon name=\"trash\" />\n            </IconButton>\n            <MoveDragButton />\n          </Box>\n          <Box display=\"flex\" flexDirection=\"column\" width=\"100%\" gap={1}>\n            <Switch\n              label={t({\n                id: \"chart.map.layers.base.behind-area-layer\",\n                message: \"Behind area layer\",\n              })}\n              checked={configLayer.isBehindAreaLayer}\n              onChange={(e) => {\n                dispatch({\n                  type: \"CUSTOM_LAYER_UPDATE\",\n                  value: {\n                    layer: {\n                      ...configLayer,\n                      isBehindAreaLayer: e.target.checked,\n                    },\n                  },\n                });\n              }}\n            />\n            {configLayer.type === \"wmts\" ? (\n              <Switch\n                label={t({\n                  id: \"chart.map.layers.base.enable-temporal-filtering\",\n                  message: \"Sync with temporal filters\",\n                })}\n                checked={configLayer.syncTemporalFilters}\n                disabled={!enableTemporalFiltering}\n                onChange={(e) => {\n                  dispatch({\n                    type: \"CUSTOM_LAYER_UPDATE\",\n                    value: {\n                      layer: {\n                        ...configLayer,\n                        syncTemporalFilters: e.target.checked,\n                      },\n                    },\n                  });\n                }}\n              />\n            ) : null}\n          </Box>\n        </Box>\n      )}\n    </Draggable>\n  );\n};\n","import produce from \"immer\";\nimport { DraggableLocation } from \"react-beautiful-dnd\";\n\nimport {\n  SortingOrder,\n  TableConfig,\n  TableSortingOption,\n} from \"../../config-types\";\nimport { getOrderedTableColumns } from \"../components/ui-helpers\";\n\nexport const moveFields = produce(\n  (\n    chartConfig: TableConfig,\n    {\n      source,\n      destination,\n    }: {\n      source: DraggableLocation;\n      destination: DraggableLocation;\n    }\n  ): TableConfig => {\n    const fieldsArray = getOrderedTableColumns(chartConfig.fields);\n    let groupFields = fieldsArray.filter((f) => f.isGroup);\n    let columnFields = fieldsArray.filter((f) => !f.isGroup);\n\n    let sourceFields =\n      source.droppableId === \"columns\" ? columnFields : groupFields;\n    let destinationFields =\n      destination.droppableId === \"columns\" ? columnFields : groupFields;\n\n    // Move from source to destination\n    destinationFields.splice(\n      destination.index,\n      0,\n      sourceFields.splice(source.index, 1)[0]\n    );\n\n    // Update indexes and isGroup status for each field after moving\n    groupFields.forEach((f, i) => {\n      f.index = i;\n      f.isGroup = true;\n    });\n    columnFields.forEach((f, i) => {\n      f.index = groupFields.length + i;\n      f.isGroup = false;\n    });\n\n    return chartConfig;\n  }\n);\n\n/**\n * When toggling `isGroup` of a field, we need to make sure the fields are correctly ordered\n */\nexport const updateIsGroup = produce(\n  (\n    chartConfig: TableConfig,\n    {\n      field,\n      value,\n    }: {\n      field: string;\n      value: boolean;\n    }\n  ): TableConfig => {\n    if (!chartConfig.fields[field]) {\n      return chartConfig;\n    }\n\n    // Update field\n    chartConfig.fields[field].isGroup = value;\n\n    // Get fields _without_ field that is updated\n    const fieldsArray = getOrderedTableColumns(chartConfig.fields);\n    const groupFields = fieldsArray.filter(\n      (f) => f.isGroup && f !== chartConfig.fields[field]\n    );\n    const columnFields = fieldsArray.filter(\n      (f) => !f.isGroup && f !== chartConfig.fields[field]\n    );\n\n    const allFields = [\n      ...groupFields,\n      // Always place between groups and columns (it will end up at the bottom of the groups or top of columns)\n      chartConfig.fields[field],\n      ...columnFields,\n    ];\n\n    // Update index for each field\n    allFields.forEach((f, i) => {\n      f.index = i;\n    });\n\n    return chartConfig;\n  }\n);\n\n/**\n * When toggling `isHidden` of a field, we need to make sure the fields are correctly ordered\n */\nexport const updateIsHidden = produce(\n  (\n    chartConfig: TableConfig,\n    {\n      field,\n      value,\n    }: {\n      field: string;\n      value: boolean;\n    }\n  ): TableConfig => {\n    if (!chartConfig.fields[field]) {\n      return chartConfig;\n    }\n\n    chartConfig.fields[field].isHidden = value;\n\n    return chartConfig;\n  }\n);\n\nexport const addSortingOption = produce(\n  (chartConfig: TableConfig, option: TableSortingOption): TableConfig => {\n    chartConfig.sorting.push(option);\n\n    return chartConfig;\n  }\n);\n\nexport const changeSortingOption = produce(\n  (\n    chartConfig: TableConfig,\n    { index, option }: { index: number; option: TableSortingOption }\n  ): TableConfig => {\n    chartConfig.sorting[index] = option;\n\n    return chartConfig;\n  }\n);\n\nexport const removeSortingOption = produce(\n  (chartConfig: TableConfig, { index }: { index: number }): TableConfig => {\n    chartConfig.sorting.splice(index, 1);\n\n    return chartConfig;\n  }\n);\n\nexport const changeSortingOptionOrder = produce(\n  (\n    chartConfig: TableConfig,\n    { index, sortingOrder }: { index: number; sortingOrder: SortingOrder }\n  ): TableConfig => {\n    if (chartConfig.sorting[index]) {\n      chartConfig.sorting[index].sortingOrder = sortingOrder;\n    }\n\n    return chartConfig;\n  }\n);\n\nexport const moveSortingOptions = produce(\n  (\n    chartConfig: TableConfig,\n    {\n      source,\n      destination,\n    }: {\n      source: DraggableLocation;\n      destination: DraggableLocation;\n    }\n  ): TableConfig => {\n    // Move from source to destination\n    chartConfig.sorting.splice(\n      destination.index,\n      0,\n      chartConfig.sorting.splice(source.index, 1)[0]\n    );\n\n    return chartConfig;\n  }\n);\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Button,\n  SelectChangeEvent,\n  Theme,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { ascending } from \"d3-array\";\nimport { ChangeEvent, ReactNode, useCallback } from \"react\";\nimport {\n  DragDropContext,\n  Draggable,\n  Droppable,\n  OnDragEndResponder,\n} from \"react-beautiful-dnd\";\n\nimport { Radio, RadioGroup, Select } from \"@/components/form\";\nimport { VisuallyHidden } from \"@/components/visually-hidden\";\nimport {\n  ConfiguratorStateConfiguringChart,\n  TableConfig,\n  TableSortingOption,\n} from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ControlSection,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { useOrderedTableColumns } from \"@/configurator/components/ui-helpers\";\nimport { useConfiguratorState } from \"@/configurator/configurator-state\";\nimport {\n  addSortingOption,\n  changeSortingOption,\n  changeSortingOptionOrder,\n  moveSortingOptions,\n  removeSortingOption,\n} from \"@/configurator/table/table-config-state\";\nimport { Dimension, isNumericalMeasure, Measure } from \"@/domain/data\";\nimport { Icon } from \"@/icons\";\nimport { useEvent } from \"@/utils/use-event\";\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  sortingItemContainer: {\n    padding: theme.spacing(4),\n    paddingRight: theme.spacing(0),\n\n    borderTop: `1px solid ${theme.palette.divider}`,\n  },\n  sortingItemBox: {\n    \"&:first-of-type $sortingItemContainer\": {\n      borderTopWidth: 0,\n    },\n  },\n  selectWrapper: {\n    lineHeight: \"1rem\",\n    textAlign: \"left\",\n    marginBottom: theme.spacing(4),\n  },\n  removeButton: {\n    padding: 0,\n    paddingRight: theme.spacing(6),\n    cursor: \"pointer\",\n    marginLeft: \"auto\",\n    minWidth: 0,\n    minHeight: 0,\n  },\n  iconWrapper: {\n    // @ts-ignore\n    color: theme.palette.secondary.disabled,\n\n    \"&:hover\": {\n      color: theme.palette.secondary.main,\n    },\n  },\n}));\n\nconst TableSortingOptionItem = ({\n  dimensions,\n  measures,\n  componentId,\n  index,\n  chartConfig,\n  sortingOrder,\n  sideControls,\n}: {\n  dimensions: Dimension[];\n  measures: Measure[];\n  index: number;\n  chartConfig: TableConfig;\n  sideControls?: ReactNode;\n} & TableSortingOption) => {\n  const [, dispatch] = useConfiguratorState();\n  const classes = useStyles();\n  const component = [...dimensions, ...measures].find(\n    ({ id }) => id === componentId\n  );\n\n  const onRemove = useEvent(() => {\n    dispatch({\n      type: \"CHART_CONFIG_REPLACED\",\n      value: {\n        chartConfig: removeSortingOption(chartConfig, {\n          index,\n        }),\n        dataCubesComponents: {\n          dimensions,\n          measures,\n        },\n      },\n    });\n  });\n\n  const onChangeSortingOrder = useEvent((e: ChangeEvent<HTMLInputElement>) => {\n    dispatch({\n      type: \"CHART_CONFIG_REPLACED\",\n      value: {\n        chartConfig: changeSortingOptionOrder(chartConfig, {\n          index,\n          sortingOrder: e.currentTarget.value as \"asc\" | \"desc\",\n        }),\n        dataCubesComponents: {\n          dimensions,\n          measures,\n        },\n      },\n    });\n  });\n\n  const sortingType = isNumericalMeasure(component)\n    ? \"byMeasure\"\n    : \"byDimensionLabel\";\n\n  return component ? (\n    <Box className={classes.sortingItemContainer}>\n      <Typography className={classes.selectWrapper}>\n        <ChangeTableSortingOption\n          index={index}\n          dimensions={dimensions}\n          measures={measures}\n          chartConfig={chartConfig}\n          sideControls={sideControls}\n        />\n      </Typography>\n      <RadioGroup>\n        <Radio\n          name={`${componentId}-sortingOrder`}\n          value=\"asc\"\n          checked={sortingOrder === \"asc\"}\n          onChange={onChangeSortingOrder}\n          label={getFieldLabel(`sorting.${sortingType}.asc`)}\n        />\n        <Radio\n          name={`${componentId}-sortingOrder`}\n          value=\"desc\"\n          checked={sortingOrder === \"desc\"}\n          onChange={onChangeSortingOrder}\n          label={getFieldLabel(`sorting.${sortingType}.desc`)}\n        />\n        <Button\n          variant=\"text\"\n          className={classes.removeButton}\n          onClick={onRemove}\n        >\n          <VisuallyHidden>\n            <Trans id=\"controls.sorting.removeOption\">\n              Remove sorting dimension\n            </Trans>\n          </VisuallyHidden>\n          <Box className={classes.iconWrapper} aria-hidden=\"true\">\n            <Icon name=\"trash\" size={20} />\n          </Box>\n        </Button>\n      </RadioGroup>\n    </Box>\n  ) : null;\n};\n\nconst AddTableSortingOption = ({\n  dimensions,\n  measures,\n  chartConfig,\n}: {\n  dimensions: Dimension[];\n  measures: Measure[];\n  chartConfig: TableConfig;\n}) => {\n  const [, dispatch] = useConfiguratorState();\n\n  const onChange = useCallback(\n    (e: SelectChangeEvent<unknown>) => {\n      const { value } = e.target;\n      const component = [...dimensions, ...measures].find(\n        ({ id }) => id === value\n      );\n\n      if (component) {\n        dispatch({\n          type: \"CHART_CONFIG_REPLACED\",\n          value: {\n            chartConfig: addSortingOption(chartConfig, {\n              componentId: component.id,\n              componentType: component.__typename,\n              sortingOrder: \"asc\",\n            }),\n            dataCubesComponents: {\n              dimensions,\n              measures,\n            },\n          },\n        });\n      }\n    },\n    [chartConfig, dimensions, dispatch, measures]\n  );\n\n  const columns = useOrderedTableColumns(chartConfig.fields);\n\n  const options = [\n    {\n      value: \"-\",\n      label: t({\n        id: \"controls.sorting.selectDimension\",\n        message: \"Select a dimension...\",\n      }),\n      disabled: true,\n    },\n    ...columns\n      .flatMap((c) => {\n        if (\n          chartConfig.sorting.some(\n            ({ componentId }) => componentId === c.componentId\n          )\n        ) {\n          return [];\n        }\n\n        const component = [...dimensions, ...measures].find(\n          ({ id }) => id === c.componentId\n        );\n\n        return component\n          ? [{ value: component.id, label: component.label }]\n          : [];\n      })\n      .sort((a, b) => ascending(a.label, b.label)),\n  ];\n\n  return (\n    <Select\n      id=\"add-tablesorting\"\n      size=\"sm\"\n      value=\"-\"\n      options={options}\n      sort={false}\n      label={t({\n        id: \"controls.sorting.addDimension\",\n        message: \"Add dimension\",\n      })}\n      onChange={onChange}\n    />\n  );\n};\n\nconst ChangeTableSortingOption = ({\n  dimensions,\n  measures,\n  chartConfig,\n  index,\n  sideControls,\n}: {\n  dimensions: Dimension[];\n  measures: Measure[];\n  chartConfig: TableConfig;\n  index: number;\n  sideControls?: ReactNode;\n}) => {\n  const [, dispatch] = useConfiguratorState();\n\n  const onChange = useCallback(\n    (e: SelectChangeEvent<unknown>) => {\n      const { value } = e.target;\n      const component = [...dimensions, ...measures].find(\n        ({ id }) => id === value\n      );\n\n      if (component) {\n        dispatch({\n          type: \"CHART_CONFIG_REPLACED\",\n          value: {\n            chartConfig: changeSortingOption(chartConfig, {\n              index,\n              option: {\n                componentId: component.id,\n                componentType: component.__typename,\n                sortingOrder: \"asc\",\n              },\n            }),\n            dataCubesComponents: {\n              dimensions,\n              measures,\n            },\n          },\n        });\n      }\n    },\n    [chartConfig, dimensions, dispatch, index, measures]\n  );\n\n  const columns = useOrderedTableColumns(chartConfig.fields);\n  const { componentId } = chartConfig.sorting[index];\n  const options = columns.flatMap((c) => {\n    const component = [...dimensions, ...measures].find(\n      ({ id }) => id === c.componentId\n    );\n\n    return component ? [{ value: component.id, label: component.label }] : [];\n  });\n\n  return (\n    <Select\n      id={`change-sorting-option-${index}`}\n      size=\"sm\"\n      value={componentId}\n      options={options}\n      label={t({ id: \"controls.sorting.sortBy\", message: \"Sort by\" })}\n      onChange={onChange}\n      sideControls={sideControls}\n    />\n  );\n};\n\nexport const TableSortingOptions = ({\n  state,\n  dimensions,\n  measures,\n}: {\n  state: ConfiguratorStateConfiguringChart;\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  const [, dispatch] = useConfiguratorState();\n  const chartConfig = getChartConfig(state);\n  const { activeField } = chartConfig;\n  const classes = useStyles();\n\n  const onDragEnd = useCallback<OnDragEndResponder>(\n    ({ source, destination }) => {\n      if (!destination || chartConfig.chartType !== \"table\") {\n        return;\n      }\n\n      dispatch({\n        type: \"CHART_CONFIG_REPLACED\",\n        value: {\n          chartConfig: moveSortingOptions(chartConfig, {\n            source,\n            destination,\n          }),\n          dataCubesComponents: {\n            dimensions,\n            measures,\n          },\n        },\n      });\n    },\n    [chartConfig, dimensions, dispatch, measures]\n  );\n\n  if (!activeField || chartConfig.chartType !== \"table\") {\n    return null;\n  }\n\n  const { sorting } = chartConfig;\n\n  return (\n    <DragDropContext onDragEnd={onDragEnd}>\n      <ControlSection hideTopBorder>\n        <SectionTitle closable>\n          <Trans id=\"controls.section.tableSorting\">Table Sorting</Trans>\n        </SectionTitle>\n        <Droppable droppableId=\"table-sorting\" type=\"table-sorting\">\n          {({ innerRef, placeholder }) => {\n            return (\n              <div>\n                <Box ref={innerRef}>\n                  {sorting.map((option, i) => {\n                    return (\n                      <Draggable\n                        key={option.componentId}\n                        draggableId={option.componentId}\n                        index={i}\n                      >\n                        {(\n                          { innerRef, draggableProps, dragHandleProps },\n                          { isDragging }\n                        ) => {\n                          return (\n                            <Box\n                              ref={innerRef}\n                              {...draggableProps}\n                              className={classes.sortingItemBox}\n                              sx={{\n                                position: \"relative\",\n                                boxShadow: isDragging ? \"tooltip\" : undefined,\n                              }}\n                              style={{\n                                ...draggableProps.style,\n                              }}\n                            >\n                              <TableSortingOptionItem\n                                {...option}\n                                index={i}\n                                dimensions={dimensions}\n                                measures={measures}\n                                chartConfig={chartConfig}\n                                sideControls={\n                                  <Box\n                                    sx={{\n                                      color: isDragging\n                                        ? \"secondary.main\"\n                                        : \"secondary.light\",\n\n                                      \"&:hover\": {\n                                        color: \"secondary.main\",\n                                      },\n                                    }}\n                                    {...dragHandleProps}\n                                  >\n                                    <Icon name=\"dragndrop\" />\n                                  </Box>\n                                }\n                              />\n                            </Box>\n                          );\n                        }}\n                      </Draggable>\n                    );\n                  })}\n                </Box>\n                {placeholder}\n                <Box\n                  sx={{\n                    py: 4,\n                    px: 4,\n                    borderTopColor: \"divider\",\n                    borderTopStyle: \"solid\",\n                    borderTopWidth: 1,\n                  }}\n                >\n                  <AddTableSortingOption\n                    dimensions={dimensions}\n                    measures={measures}\n                    chartConfig={chartConfig}\n                  />\n                </Box>\n              </div>\n            );\n          }}\n        </Droppable>\n      </ControlSection>\n    </DragDropContext>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box } from \"@mui/material\";\nimport get from \"lodash/get\";\nimport { ChangeEvent, useCallback } from \"react\";\n\nimport { EncodingFieldType } from \"@/charts/chart-config-ui-options\";\nimport { Checkbox } from \"@/components/form\";\nimport { HintError } from \"@/components/hint\";\nimport {\n  ColumnStyle,\n  ConfiguratorStateConfiguringChart,\n  isTableConfig,\n  TableConfig,\n} from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { ColorPalette } from \"@/configurator/components/chart-controls/color-palette\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  ChartOptionCheckboxField,\n  ChartOptionSelectField,\n  ColorPickerField,\n} from \"@/configurator/components/field\";\nimport {\n  DimensionValuesMultiFilter,\n  DimensionValuesSingleFilter,\n  TimeFilter,\n} from \"@/configurator/components/filters\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport { FieldProps } from \"@/configurator/config-form\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { TableSortingOptions } from \"@/configurator/table/table-chart-sorting-options\";\nimport {\n  updateIsGroup,\n  updateIsHidden,\n} from \"@/configurator/table/table-config-state\";\nimport {\n  Component,\n  Dimension,\n  isDimension,\n  isNumericalMeasure,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  Measure,\n} from \"@/domain/data\";\nimport {\n  getDefaultCategoricalPalette,\n  getDefaultCategoricalPaletteId,\n  getDefaultDivergingSteppedPalette,\n} from \"@/palettes\";\n\nconst useTableColumnGroupHiddenField = ({\n  path,\n  field,\n  dimensions,\n  measures,\n}: {\n  path: \"isGroup\" | \"isHidden\";\n  field: string;\n  dimensions: Dimension[];\n  measures: Measure[];\n}): FieldProps => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const onChange = useCallback<(e: ChangeEvent<HTMLInputElement>) => void>(\n    (e) => {\n      if (!isTableConfig(chartConfig)) {\n        return;\n      }\n\n      const updater = path === \"isGroup\" ? updateIsGroup : updateIsHidden;\n      const newChartConfig = updater(chartConfig, {\n        field,\n        value: e.currentTarget.checked,\n      });\n\n      dispatch({\n        type: \"CHART_CONFIG_REPLACED\",\n        value: {\n          chartConfig: newChartConfig,\n          dataCubesComponents: {\n            dimensions,\n            measures,\n          },\n        },\n      });\n    },\n    [chartConfig, path, field, dispatch, dimensions, measures]\n  );\n  const stateValue = get(chartConfig, `fields[\"${field}\"].${path}`, \"\");\n  const checked = stateValue ? stateValue : false;\n\n  return {\n    name: path,\n    checked,\n    onChange,\n  };\n};\n\nconst ChartOptionGroupHiddenField = ({\n  label,\n  field,\n  path,\n  defaultChecked,\n  disabled = false,\n  dimensions,\n  measures,\n}: {\n  label: string;\n  field: string;\n  path: \"isGroup\" | \"isHidden\";\n  defaultChecked?: boolean;\n  disabled?: boolean;\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  const fieldProps = useTableColumnGroupHiddenField({\n    field,\n    path,\n    dimensions,\n    measures,\n  });\n\n  return (\n    <Checkbox\n      disabled={disabled}\n      label={label}\n      {...fieldProps}\n      checked={fieldProps.checked ?? defaultChecked}\n    />\n  );\n};\n\nexport const TableColumnOptions = ({\n  state,\n  dimensions,\n  measures,\n}: {\n  state: ConfiguratorStateConfiguringChart;\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  const chartConfig = getChartConfig(state);\n  const { activeField: _activeField } = chartConfig;\n  const activeField = _activeField as EncodingFieldType | undefined;\n\n  if (!activeField || chartConfig.chartType !== \"table\") {\n    return null;\n  }\n\n  // FIXME: table encoding should be added to UI encodings\n  // @ts-ignore\n  if (activeField === \"table-sorting\") {\n    return (\n      <TableSortingOptions\n        state={state}\n        dimensions={dimensions}\n        measures={measures}\n      />\n    );\n  }\n\n  const activeFieldComponentId = chartConfig.fields[activeField]?.componentId;\n  // It's a dimension which is not mapped to an encoding field, so we show the filter!\n  // FIXME: activeField and encodingField should match? to remove type assertion\n  if (!activeFieldComponentId) {\n    return null;\n  }\n\n  // Active field is always a component id, like in filters\n  const allComponents = [...dimensions, ...measures];\n  const component = allComponents.find((d) => d.id === activeField);\n\n  if (!component) {\n    return <HintError smaller>No component {activeField}</HintError>;\n  }\n\n  const { isGroup, isHidden } = chartConfig.fields[activeField];\n\n  const columnStyleOptions = isNumericalMeasure(component)\n    ? [\n        {\n          value: \"text\",\n          label: t({ id: \"columnStyle.text\", message: `Text` }),\n        },\n        {\n          value: \"heatmap\",\n          label: t({ id: \"columnStyle.heatmap\", message: `Heat Map` }),\n        },\n        {\n          value: \"bar\",\n          label: t({ id: \"columnStyle.bar\", message: `Bar Chart` }),\n        },\n      ]\n    : isTemporalDimension(component)\n      ? [\n          {\n            value: \"text\",\n            label: t({ id: \"columnStyle.text\", message: `Text` }),\n          },\n        ]\n      : [\n          {\n            value: \"text\",\n            label: t({ id: \"columnStyle.text\", message: `Text` }),\n          },\n          {\n            value: \"category\",\n            label: t({ id: \"columnStyle.categories\", message: `Categories` }),\n          },\n        ];\n\n  return (\n    <div\n      key={`control-panel-table-column-${activeField}`}\n      role=\"tabpanel\"\n      id={`control-panel-table-column-${activeField}`}\n      aria-labelledby={`tab-${activeField}`}\n      tabIndex={-1}\n    >\n      <ControlSection hideTopBorder>\n        <SectionTitle closable>{component.label}</SectionTitle>\n        <ControlSectionContent>\n          {component.__typename !== \"NumericalMeasure\" && (\n            <ChartOptionGroupHiddenField\n              label={t({\n                id: \"controls.table.column.group\",\n                message: \"Use to group\",\n              })}\n              field={activeField}\n              path=\"isGroup\"\n              dimensions={dimensions}\n              measures={measures}\n            />\n          )}\n          <ChartOptionGroupHiddenField\n            label={t({\n              id: \"controls.table.column.hide\",\n              message: \"Hide column\",\n            })}\n            field={activeField}\n            path=\"isHidden\"\n            dimensions={dimensions}\n            measures={measures}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      {(isGroup || !isHidden) && (\n        <ControlSection collapse>\n          <SectionTitle iconName=\"formatting\">\n            <Trans id=\"controls.section.columnstyle\">Column Style</Trans>\n          </SectionTitle>\n          <ControlSectionContent sx={{ mt: 2 }}>\n            <ChartOptionSelectField<ColumnStyle>\n              id=\"columnStyle\"\n              label={t({\n                id: \"controls.select.columnStyle\",\n                message: \"Column Style\",\n              })}\n              options={columnStyleOptions}\n              getValue={(type) => {\n                switch (type) {\n                  case \"text\":\n                    return {\n                      type: \"text\",\n                      textStyle: \"regular\",\n                      textColor: \"#333\",\n                      columnColor: \"#fff\",\n                    };\n                  case \"category\":\n                    const paletteId = getDefaultCategoricalPaletteId(component);\n\n                    return {\n                      type: \"category\",\n                      textStyle: \"regular\",\n                      paletteId,\n                      colorMapping: mapValueIrisToColor({\n                        paletteId,\n                        dimensionValues: component.values,\n                      }),\n                    };\n                  case \"heatmap\":\n                    return {\n                      type: \"heatmap\",\n                      textStyle: \"regular\",\n                      paletteId: getDefaultDivergingSteppedPalette().value,\n                    };\n                  case \"bar\":\n                    return {\n                      type: \"bar\",\n                      textStyle: \"regular\",\n                      barColorPositive:\n                        getDefaultCategoricalPalette().colors[0],\n                      barColorNegative:\n                        getDefaultCategoricalPalette().colors[1],\n                      barColorBackground: \"#ccc\",\n                      barShowBackground: false,\n                    };\n                  default:\n                    return undefined;\n                }\n              }}\n              getKey={(d) => d.type}\n              field={activeField}\n              path=\"columnStyle\"\n            />\n            <ColumnStyleSubOptions\n              chartConfig={chartConfig}\n              activeField={activeField}\n              component={component}\n            />\n          </ControlSectionContent>\n        </ControlSection>\n      )}\n      {isTemporalDimension(component) ||\n      isTemporalEntityDimension(component) ? (\n        <ControlSection collapse>\n          <SectionTitle disabled={!component} iconName=\"filter\">\n            <Trans id=\"controls.section.filter\">Filter</Trans>\n          </SectionTitle>\n          <ControlSectionContent component=\"fieldset\">\n            <legend style={{ display: \"none\" }}>\n              <Trans id=\"controls.section.filter\">Filter</Trans>\n            </legend>\n            <TimeFilter dimension={component} />\n          </ControlSectionContent>\n        </ControlSection>\n      ) : isDimension(component) ? (\n        <ControlSection collapse>\n          <SectionTitle disabled={!component} iconName=\"filter\">\n            <Trans id=\"controls.section.filter\">Filter</Trans>\n          </SectionTitle>\n          <ControlSectionContent component=\"fieldset\">\n            <legend style={{ display: \"none\" }}>\n              <Trans id=\"controls.section.filter\">Filter</Trans>\n            </legend>\n            {component.isKeyDimension && isHidden && !isGroup ? (\n              <DimensionValuesSingleFilter dimension={component} />\n            ) : (\n              <DimensionValuesMultiFilter\n                field={component.id}\n                dimension={component}\n                colorComponent={component}\n                colorConfigPath=\"columnStyle\"\n              />\n            )}\n          </ControlSectionContent>\n        </ControlSection>\n      ) : null}\n    </div>\n  );\n};\n\nconst ColumnStyleSubOptions = ({\n  chartConfig,\n  activeField,\n  component,\n}: {\n  chartConfig: TableConfig;\n  activeField: EncodingFieldType;\n  component: Component;\n}) => {\n  const type = chartConfig.fields[activeField].columnStyle.type;\n  return (\n    <>\n      <ChartOptionSelectField<string>\n        id=\"columnStyle.textStyle\"\n        label={t({\n          id: \"controls.select.columnStyle.textStyle\",\n          message: \"Text Style\",\n        })}\n        options={[\n          {\n            value: \"regular\",\n            label: t({\n              id: \"columnStyle.textStyle.regular\",\n              message: `Regular`,\n            }),\n          },\n          {\n            value: \"bold\",\n            label: t({ id: \"columnStyle.textStyle.bold\", message: `Bold` }),\n          },\n        ]}\n        field={activeField}\n        path=\"columnStyle.textStyle\"\n      />\n      {type === \"text\" ? (\n        <>\n          <ColorPickerField\n            label={t({\n              id: \"controls.select.columnStyle.textColor\",\n              message: \"Text Color\",\n            })}\n            field={activeField}\n            path=\"columnStyle.textColor\"\n          />\n          <ColorPickerField\n            label={t({\n              id: \"controls.select.columnStyle.columnColor\",\n              message: \"Column Background\",\n            })}\n            field={activeField}\n            path=\"columnStyle.columnColor\"\n          />\n        </>\n      ) : type === \"category\" ? (\n        <>\n          <ColorPalette\n            field={activeField}\n            colorConfigPath=\"columnStyle\"\n            component={component}\n          />\n        </>\n      ) : type === \"heatmap\" ? (\n        <>\n          <ColorPalette\n            field={activeField}\n            colorConfigPath=\"columnStyle\"\n            component={component}\n          />\n        </>\n      ) : type === \"bar\" ? (\n        <Box my={2}>\n          <ColorPickerField\n            label={t({\n              id: \"controls.select.columnStyle.barColorPositive\",\n              message: \"Positive Bar Color\",\n            })}\n            field={activeField}\n            path=\"columnStyle.barColorPositive\"\n          />\n          <ColorPickerField\n            label={t({\n              id: \"controls.select.columnStyle.barColorNegative\",\n              message: \"Negative Bar Color\",\n            })}\n            field={activeField}\n            path=\"columnStyle.barColorNegative\"\n          />\n          <ColorPickerField\n            label={t({\n              id: \"controls.select.columnStyle.barColorBackground\",\n              message: \"Bar Background\",\n            })}\n            field={activeField}\n            path=\"columnStyle.barColorBackground\"\n          />\n          <ChartOptionCheckboxField\n            label={t({\n              id: \"controls.select.columnStyle.barShowBackground\",\n              message: \"Show Bar Background\",\n            })}\n            field={activeField}\n            path=\"columnStyle.barShowBackground\"\n          />\n        </Box>\n      ) : null}\n    </>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box } from \"@mui/material\";\nimport get from \"lodash/get\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { getFieldComponentId } from \"@/charts\";\nimport {\n  ANIMATION_FIELD_SPEC,\n  EncodingFieldType,\n  EncodingSpec,\n  getChartSpec,\n} from \"@/charts/chart-config-ui-options\";\nimport { useQueryFilters } from \"@/charts/shared/chart-helpers\";\nimport { Flex } from \"@/components/flex\";\nimport { SelectOption } from \"@/components/form\";\nimport { InfoIconTooltip } from \"@/components/info-icon-tooltip\";\nimport {\n  ChartConfig,\n  GenericField,\n  isAnimationInConfig,\n  isComboChartConfig,\n  isMapConfig,\n  isTableConfig,\n  MapConfig,\n  RegularChartConfig,\n} from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  ControlSectionSkeleton,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { Abbreviations } from \"@/configurator/components/chart-options-selector/abbreviations\";\nimport { AnimationField } from \"@/configurator/components/chart-options-selector/animation-field\";\nimport { BaseLayerField } from \"@/configurator/components/chart-options-selector/base-layer-field\";\nimport { CalculationField } from \"@/configurator/components/chart-options-selector/calculation-field\";\nimport { ColorComponentField } from \"@/configurator/components/chart-options-selector/color-component-field\";\nimport { ComboYField } from \"@/configurator/components/chart-options-selector/combo-y-field\";\nimport { ConversionUnitsField } from \"@/configurator/components/chart-options-selector/conversion-units-field\";\nimport { ImputationField } from \"@/configurator/components/chart-options-selector/imputation-field\";\nimport { LayoutField } from \"@/configurator/components/chart-options-selector/layout-field\";\nimport { LimitsField } from \"@/configurator/components/chart-options-selector/limits-field\";\nimport { MultiFilterField } from \"@/configurator/components/chart-options-selector/multi-filter-field\";\nimport { ScaleDomain } from \"@/configurator/components/chart-options-selector/scale-domain\";\nimport { ShowDotsField } from \"@/configurator/components/chart-options-selector/show-dots-field\";\nimport { SizeField } from \"@/configurator/components/chart-options-selector/size-field\";\nimport { SortingField } from \"@/configurator/components/chart-options-selector/sorting-field\";\nimport { makeGetFieldOptionGroups } from \"@/configurator/components/chart-options-selector/utils\";\nimport { CustomLayersSelector } from \"@/configurator/components/custom-layers-selector\";\nimport {\n  ChartFieldField,\n  ChartOptionCheckboxField,\n  ChartOptionSwitchField,\n} from \"@/configurator/components/field\";\nimport { getFieldLabel } from \"@/configurator/components/field-i18n\";\nimport { getComponentLabel } from \"@/configurator/components/ui-helpers\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { TableColumnOptions } from \"@/configurator/table/table-chart-options\";\nimport {\n  Component,\n  CUSTOM_SORT_ENABLED_COMPONENTS,\n  DataCubeMetadata,\n  Dimension,\n  getComponentsFilteredByType,\n  isMeasure,\n  isStandardErrorDimension,\n  Measure,\n  Observation,\n} from \"@/domain/data\";\nimport { useFlag } from \"@/flags\";\nimport {\n  useDataCubesComponentsQuery,\n  useDataCubesMetadataQuery,\n  useDataCubesObservationsQuery,\n} from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const ChartOptionsSelector = () => {\n  const [state] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const { dataSource } = state;\n  const { activeField } = chartConfig;\n  const locale = useLocale();\n  const [{ data: metadataData, fetching: fetchingMetadata }] =\n    useDataCubesMetadataQuery({\n      variables: {\n        locale,\n        sourceType: dataSource.type,\n        sourceUrl: dataSource.url,\n        cubeFilters: chartConfig.cubes.map((cube) => ({ iri: cube.iri })),\n      },\n    });\n  const cubesMetadata = metadataData?.dataCubesMetadata;\n  const [{ data: componentsData, fetching: fetchingComponents }] =\n    useDataCubesComponentsQuery({\n      chartConfig,\n      variables: {\n        sourceType: dataSource.type,\n        sourceUrl: dataSource.url,\n        locale,\n        cubeFilters: chartConfig.cubes.map((cube) => ({\n          iri: cube.iri,\n          joinBy: cube.joinBy,\n          loadValues: true,\n        })),\n      },\n      keepPreviousData: true,\n    });\n  const dimensions = componentsData?.dataCubesComponents.dimensions;\n  const measures = componentsData?.dataCubesComponents.measures;\n  const queryFilters = useQueryFilters({\n    chartConfig,\n    dashboardFilters: state.dashboardFilters,\n  });\n  const [{ data: observationsData, fetching: fetchingObservations }] =\n    useDataCubesObservationsQuery({\n      chartConfig,\n      variables: {\n        sourceType: dataSource.type,\n        sourceUrl: dataSource.url,\n        locale,\n        cubeFilters: queryFilters,\n      },\n      pause: fetchingComponents,\n      keepPreviousData: true,\n    });\n  const observations = observationsData?.dataCubesObservations?.data;\n\n  const fetching =\n    fetchingMetadata || fetchingComponents || fetchingObservations;\n\n  return cubesMetadata && dimensions && measures && observations ? (\n    <Box\n      sx={{\n        // We need these overflow parameters to allow iOS scrolling.\n        overflowX: \"hidden\",\n        overflowY: \"auto\",\n        pointerEvents: fetching ? \"none\" : \"auto\",\n        opacity: fetching ? 0.7 : 1,\n        transition: \"opacity 0.2s\",\n      }}\n    >\n      {activeField ? (\n        isTableConfig(chartConfig) ? (\n          <TableColumnOptions\n            state={state}\n            dimensions={dimensions}\n            measures={measures}\n          />\n        ) : (\n          <ActiveFieldSwitch\n            chartConfig={chartConfig}\n            dimensions={dimensions}\n            measures={measures}\n            observations={observations}\n            cubesMetadata={cubesMetadata}\n          />\n        )\n      ) : null}\n    </Box>\n  ) : (\n    <>\n      <ControlSectionSkeleton />\n      <ControlSectionSkeleton />\n    </>\n  );\n};\n\nconst ActiveFieldSwitch = ({\n  dimensions,\n  measures,\n  chartConfig,\n  observations,\n  cubesMetadata,\n}: {\n  chartConfig: ChartConfig;\n  dimensions: Dimension[];\n  measures: Measure[];\n  observations: Observation[];\n  cubesMetadata: DataCubeMetadata[];\n}) => {\n  const activeField = chartConfig.activeField as EncodingFieldType | undefined;\n\n  if (!activeField) {\n    return null;\n  }\n\n  const chartSpec = getChartSpec(chartConfig);\n\n  // Animation field is a special field that is not part of the encodings,\n  // but rather is selected from interactive filters menu.\n  const animatable =\n    isAnimationInConfig(chartConfig) &&\n    chartSpec.interactiveFilters.includes(\"animation\");\n  const baseEncodings = chartSpec.encodings;\n  const encodings = animatable\n    ? [...baseEncodings, ANIMATION_FIELD_SPEC]\n    : baseEncodings;\n  const encoding = encodings.find(\n    (e) => e.field === activeField\n  ) as EncodingSpec;\n\n  const activeFieldComponentId = getFieldComponentId(\n    chartConfig.fields,\n    activeField\n  );\n  const component = [...dimensions, ...measures].find(\n    (d) => d.id === activeFieldComponentId\n  );\n\n  return (\n    <EncodingOptionsPanel\n      encoding={encoding}\n      chartConfig={chartConfig}\n      field={activeField}\n      component={component}\n      dimensions={dimensions}\n      measures={measures}\n      observations={observations}\n      cubesMetadata={cubesMetadata}\n    />\n  );\n};\n\nconst EncodingOptionsPanel = ({\n  encoding,\n  field,\n  chartConfig,\n  component,\n  dimensions,\n  measures,\n  observations,\n  cubesMetadata,\n}: {\n  encoding: EncodingSpec;\n  chartConfig: ChartConfig;\n  field: EncodingFieldType;\n  component: Component | undefined;\n  dimensions: Dimension[];\n  measures: Measure[];\n  observations: Observation[];\n  cubesMetadata: DataCubeMetadata[];\n}) => {\n  const { fields } = chartConfig;\n  const fieldLabelHint: Record<EncodingFieldType, string> = {\n    animation: t({\n      id: \"controls.select.dimension\",\n      message: \"Select a dimension\",\n    }),\n    x: t({\n      id: \"controls.select.dimension\",\n      message: \"Select a dimension\",\n    }),\n    y: t({\n      id: \"controls.select.measure\",\n      message: \"Select a measure\",\n    }),\n    color: t({\n      id: \"controls.select.color\",\n      message: \"Select a color\",\n    }),\n    segment: t({\n      id: \"controls.select.dimension\",\n      message: \"Select a dimension\",\n    }),\n    baseLayer: t({\n      id: \"controls.select.dimension\",\n      message: \"Select a dimension\",\n    }),\n    areaLayer: t({\n      id: \"controls.select.dimension\",\n      message: \"Select a dimension\",\n    }),\n    symbolLayer: t({\n      id: \"controls.select.dimension\",\n      message: \"Select a dimension\",\n    }),\n    customLayers: t({\n      id: \"controls.select.dimension\",\n      message: \"Select a dimension\",\n    }),\n  };\n  const otherFields = Object.keys(fields).filter(\n    (f) => (fields as any)[f].hasOwnProperty(\"componentId\") && field !== f\n  );\n  const otherFieldsIds = otherFields.map((f) => (fields as any)[f].componentId);\n\n  const fieldComponents = useMemo(() => {\n    return getComponentsFilteredByType({\n      dimensionTypes: encoding.componentTypes,\n      dimensions,\n      measures,\n    });\n  }, [dimensions, encoding.componentTypes, measures]);\n\n  const getFieldOptionGroups = useMemo(() => {\n    return makeGetFieldOptionGroups({ cubesMetadata });\n  }, [cubesMetadata]);\n\n  const getOption = useCallback(\n    (c: Component) => {\n      return {\n        value: c.id,\n        label: getComponentLabel(c),\n        disabled:\n          ((encoding.exclusive === undefined || encoding.exclusive === true) &&\n            otherFieldsIds.includes(c.id)) ||\n          isStandardErrorDimension(c),\n      } as SelectOption;\n    },\n    [encoding.exclusive, otherFieldsIds]\n  );\n\n  const options = useMemo(() => {\n    return chartConfig.cubes.length === 1 ? fieldComponents.map(getOption) : [];\n  }, [chartConfig.cubes.length, fieldComponents, getOption]);\n  const optionGroups = useMemo(() => {\n    return chartConfig.cubes.length > 1\n      ? getFieldOptionGroups({ fieldComponents, getOption })\n      : undefined;\n  }, [\n    chartConfig.cubes.length,\n    fieldComponents,\n    getFieldOptionGroups,\n    getOption,\n  ]);\n\n  const components = useMemo(() => {\n    return [...measures, ...dimensions];\n  }, [measures, dimensions]);\n\n  const fieldComponent = useMemo(() => {\n    const encodingId = (\n      (fields as any)?.[encoding.field] as GenericField | undefined\n    )?.componentId;\n\n    return components.find((d) => d.id === encodingId);\n  }, [components, fields, encoding.field]);\n\n  const hasStandardError = useMemo(() => {\n    return !!components.find((d) =>\n      d.related?.some(\n        (r) => r.type === \"StandardError\" && r.id === component?.id\n      )\n    );\n  }, [components, component]);\n\n  const hasConfidenceInterval = useMemo(() => {\n    const upperBoundComponent = components.find((d) =>\n      d.related?.some(\n        (r) => r.type === \"ConfidenceUpperBound\" && r.id === component?.id\n      )\n    );\n    const lowerBoundComponent = components.find((d) =>\n      d.related?.some(\n        (r) => r.type === \"ConfidenceLowerBound\" && r.id === component?.id\n      )\n    );\n\n    return !!upperBoundComponent && !!lowerBoundComponent;\n  }, [components, component]);\n\n  const hasColorPalette = !!encoding.options?.colorPalette;\n  const hasSubType = !!encoding.options?.chartSubType;\n\n  const limitMeasure =\n    isMapConfig(chartConfig) && chartConfig.activeField === \"symbolLayer\"\n      ? measures.find((m) => m.id === chartConfig.fields.symbolLayer?.measureId)\n      : isMeasure(component)\n        ? component\n        : undefined;\n\n  const chartScaleDomainEnabled = useFlag(\"custom-scale-domain\");\n  const unitConversionEnabled = useFlag(\"convert-units\");\n\n  return (\n    <div\n      key={`control-panel-${encoding.field}`}\n      role=\"tabpanel\"\n      id={`control-panel-${encoding.field}`}\n      aria-labelledby={`tab-${encoding.field}`}\n      tabIndex={-1}\n    >\n      {/* Only show component select if necessary */}\n      {encoding.componentTypes.length > 0 && (\n        <ControlSection hideTopBorder>\n          <SectionTitle closable>\n            {getFieldLabel(`${chartConfig.chartType}.${encoding.field}`)}\n          </SectionTitle>\n          <ControlSectionContent gap=\"lg\">\n            {!encoding.customComponent && (\n              <ChartFieldField\n                field={encoding.field}\n                label={fieldLabelHint[encoding.field]}\n                optional={encoding.optional}\n                options={options}\n                optionGroups={optionGroups}\n                components={components}\n              />\n            )}\n            {encoding.options?.showValues ? (\n              <ChartOptionCheckboxField\n                path=\"showValues\"\n                field={encoding.field}\n                label={t({ id: \"controls.section.show-total-values\" })}\n                disabled={\n                  encoding.options.showValues.getDisabledState?.(chartConfig)\n                    .disabled\n                }\n              />\n            ) : null}\n            {encoding.options?.adjustScaleDomain &&\n            fieldComponent &&\n            chartScaleDomainEnabled ? (\n              <ScaleDomain\n                chartConfig={chartConfig}\n                field={field}\n                observations={observations}\n                getDefaultDomain={\n                  encoding.options.adjustScaleDomain.getDefaultDomain\n                }\n              />\n            ) : null}\n            {encoding.options?.showStandardError && hasStandardError && (\n              <Flex alignItems=\"center\" sx={{ gap: 1 }}>\n                <ChartOptionSwitchField\n                  path=\"showStandardError\"\n                  field={encoding.field}\n                  defaultValue\n                  label={t({ id: \"controls.section.show-standard-error\" })}\n                />\n                <InfoIconTooltip\n                  enterDelay={600}\n                  PopperProps={{ sx: { maxWidth: 160 } }}\n                  title={\n                    <Trans id=\"controls.section.show-standard-error.explanation\">\n                      Show uncertainties extending from data points to represent\n                      standard errors\n                    </Trans>\n                  }\n                />\n              </Flex>\n            )}\n            {encoding.options?.showConfidenceInterval &&\n              hasConfidenceInterval && (\n                <Box\n                  sx={{\n                    display: \"flex\",\n                    gap: 1,\n                    alignItems: \"center\",\n                    mt: 3,\n                  }}\n                >\n                  <ChartOptionSwitchField\n                    path=\"showConfidenceInterval\"\n                    field={encoding.field}\n                    defaultValue\n                    label={t({\n                      id: \"controls.section.show-confidence-interval\",\n                    })}\n                  />\n                  <InfoIconTooltip\n                    enterDelay={600}\n                    PopperProps={{ sx: { maxWidth: 160 } }}\n                    title={\n                      <Trans id=\"controls.section.show-confidence-interval.explanation\">\n                        Show uncertainties extending from data points to\n                        represent confidence intervals\n                      </Trans>\n                    }\n                  />\n                </Box>\n              )}\n            {encoding.options?.useAbbreviations && (\n              <Abbreviations field={field} component={fieldComponent} />\n            )}\n          </ControlSectionContent>\n        </ControlSection>\n      )}\n      {encoding.options?.showDots && (\n        <ShowDotsField fields={chartConfig.fields} field={field} />\n      )}\n      {isComboChartConfig(chartConfig) && encoding.field === \"y\" && (\n        <ComboYField chartConfig={chartConfig} measures={measures} />\n      )}\n      {fieldComponent && (hasSubType || hasColorPalette) && (\n        <LayoutField\n          encoding={encoding}\n          component={component}\n          // Combo charts use their own drawer.\n          chartConfig={chartConfig as RegularChartConfig}\n          components={components}\n          hasColorPalette={hasColorPalette}\n          hasSubType={hasSubType}\n          measures={measures}\n        />\n      )}\n      {encoding.options?.imputation?.shouldShow(chartConfig, observations) && (\n        <ImputationField chartConfig={chartConfig} />\n      )}\n      {encoding.options?.calculation && get(fields, \"segment\") && (\n        <CalculationField\n          {...encoding.options.calculation.getDisabledState?.(chartConfig)}\n        />\n      )}\n      {field === \"baseLayer\" && (\n        <BaseLayerField chartConfig={chartConfig as MapConfig} />\n      )}\n      {field === \"customLayers\" && <CustomLayersSelector />}\n      {encoding.sorting &&\n        component &&\n        CUSTOM_SORT_ENABLED_COMPONENTS.includes(component.__typename) && (\n          <SortingField\n            chartConfig={chartConfig}\n            field={field}\n            encodingSortingOptions={encoding.sorting}\n          />\n        )}\n      {encoding.options?.size && component && (\n        <SizeField\n          chartConfig={chartConfig}\n          field={field}\n          componentTypes={encoding.options.size.componentTypes}\n          optional={encoding.options.size.optional}\n          dimensions={dimensions}\n          measures={measures}\n          getFieldOptionGroups={getFieldOptionGroups}\n        />\n      )}\n      {limitMeasure ? (\n        <LimitsField\n          chartConfig={chartConfig}\n          dimensions={dimensions}\n          measure={limitMeasure}\n        />\n      ) : null}\n      {encoding.options?.colorComponent && component && (\n        <ColorComponentField\n          chartConfig={chartConfig}\n          encoding={encoding}\n          component={component}\n          componentTypes={encoding.options.colorComponent.componentTypes}\n          dimensions={dimensions}\n          measures={measures}\n          optional={encoding.options.colorComponent.optional}\n          enableUseAbbreviations={\n            encoding.options.colorComponent.enableUseAbbreviations\n          }\n          getFieldOptionGroups={getFieldOptionGroups}\n        />\n      )}\n      {unitConversionEnabled && encoding.options?.convertUnit && (\n        <ConversionUnitsField\n          chartConfig={chartConfig}\n          field={field}\n          components={components}\n        />\n      )}\n      <MultiFilterField\n        chartConfig={chartConfig}\n        component={component}\n        encoding={encoding}\n        field={field}\n        dimensions={dimensions}\n        measures={measures}\n      />\n      {fieldComponent &&\n        field === \"animation\" &&\n        isAnimationInConfig(chartConfig) &&\n        chartConfig.fields.animation && (\n          <AnimationField field={chartConfig.fields.animation} />\n        )}\n    </div>\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Menu,\n  MenuItem,\n  Stack,\n  Switch,\n  SwitchProps,\n  Typography,\n} from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport capitalize from \"lodash/capitalize\";\nimport omit from \"lodash/omit\";\nimport {\n  MouseEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { DataFilterGenericDimensionProps } from \"@/charts/shared/chart-data-filters\";\nimport { useCombinedTemporalDimension } from \"@/charts/shared/use-combined-temporal-dimension\";\nimport { ConfiguratorAddButton } from \"@/components/add-button\";\nimport { Select } from \"@/components/form\";\nimport { Markdown } from \"@/components/markdown\";\nimport {\n  FREE_CANVAS_BREAKPOINTS,\n  generateLayout,\n} from \"@/components/react-grid\";\nimport {\n  DashboardTimeRangeFilter,\n  LayoutDashboard,\n  LayoutTextBlock,\n  ReactGridLayoutType,\n} from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport { LayoutAnnotator } from \"@/configurator/components/annotators\";\nimport { DataFilterSelectGeneric } from \"@/configurator/components/chart-configurator\";\nimport { ControlTab } from \"@/configurator/components/chart-controls/control-tab\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport {\n  canRenderDatePickerField,\n  DatePickerField,\n  DatePickerFieldProps,\n} from \"@/configurator/components/field-date-picker\";\nimport { IconButton } from \"@/configurator/components/icon-button\";\nimport { timeUnitToFormatter } from \"@/configurator/components/ui-helpers\";\nimport {\n  isLayouting,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport {\n  canDimensionBeTimeFiltered,\n  Dimension,\n  TemporalDimension,\n  TemporalEntityDimension,\n} from \"@/domain/data\";\nimport { useTimeFormatLocale, useTimeFormatUnit } from \"@/formatters\";\nimport { useConfigsCubeComponents } from \"@/graphql/hooks\";\nimport { Icon } from \"@/icons\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useDashboardInteractiveFilters } from \"@/stores/interactive-filters\";\nimport { createId } from \"@/utils/create-id\";\nimport { getTimeFilterOptions } from \"@/utils/time-filter-options\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const LayoutConfigurator = () => {\n  return (\n    <>\n      <LayoutAnnotator />\n      <LayoutLayoutConfigurator />\n      <LayoutSharedFiltersConfigurator />\n      <LayoutBlocksConfigurator />\n    </>\n  );\n};\n\nconst LayoutLayoutConfigurator = () => {\n  const [state] = useConfiguratorState(isLayouting);\n  const { layout } = state;\n  switch (layout.type) {\n    case \"dashboard\":\n      return (\n        <ControlSection\n          role=\"tablist\"\n          aria-labelledby=\"controls-layout-options\"\n          collapse\n        >\n          <SectionTitle id=\"controls-layout-options\">\n            <Trans id=\"controls.section.layout-options\">Layout Options</Trans>\n          </SectionTitle>\n          <ControlSectionContent gap=\"none\">\n            <Box sx={{ display: \"flex\", gap: \"0.75rem\", m: 2 }}>\n              <DashboardLayoutButton type=\"tall\" layout={layout} />\n              <DashboardLayoutButton type=\"vertical\" layout={layout} />\n              <DashboardLayoutButton type=\"canvas\" layout={layout} />\n            </Box>\n          </ControlSectionContent>\n        </ControlSection>\n      );\n    default:\n      return null;\n  }\n};\n\nconst LayoutSharedFiltersConfigurator = () => {\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const { layout } = state;\n  const { potentialTimeRangeFilterIds, potentialDataFilterIds } =\n    useDashboardInteractiveFilters();\n  const { timeRange, dataFilters } = state.dashboardFilters ?? {};\n\n  const locale = useLocale();\n  const [{ data, fetching }] = useConfigsCubeComponents({\n    variables: {\n      state,\n      locale,\n    },\n  });\n  const dimensions = useMemo(\n    () => data?.dataCubesComponents.dimensions ?? [],\n    [data?.dataCubesComponents.dimensions]\n  );\n\n  const formatLocale = useTimeFormatLocale();\n  const timeFormatUnit = useTimeFormatUnit();\n\n  const combinedTemporalDimension = useCombinedTemporalDimension();\n\n  const handleTimeRangeFilterToggle: SwitchProps[\"onChange\"] = useEvent(\n    (_, checked) => {\n      if (checked) {\n        const options = getTimeFilterOptions({\n          dimension: combinedTemporalDimension,\n          formatLocale,\n          timeFormatUnit,\n        });\n\n        const from = options.sortedOptions[0]?.date;\n        const to = options.sortedOptions.at(-1)?.date;\n        const formatDate =\n          timeUnitToFormatter[combinedTemporalDimension.timeUnit];\n\n        if (!from || !to) {\n          return;\n        }\n\n        dispatch({\n          type: \"DASHBOARD_TIME_RANGE_FILTER_UPDATE\",\n          value: {\n            active: true,\n            timeUnit: combinedTemporalDimension.timeUnit,\n            presets: {\n              from: formatDate(from),\n              to: formatDate(to),\n            },\n          },\n        });\n      } else {\n        dispatch({\n          type: \"DASHBOARD_TIME_RANGE_FILTER_REMOVE\",\n        });\n      }\n    }\n  );\n\n  const handleDataFiltersToggle = useEvent(\n    (checked: boolean, componentId: string) => {\n      if (checked) {\n        dispatch({\n          type: \"DASHBOARD_DATA_FILTERS_SET\",\n          value: {\n            componentIds: dataFilters?.componentIds\n              ? [...dataFilters.componentIds, componentId].sort((a, b) => {\n                  const aIndex =\n                    dimensions.find((d) => d.id === a)?.order ??\n                    dimensions.findIndex((d) => d.id === a) ??\n                    0;\n                  const bIndex =\n                    dimensions.find((d) => d.id === b)?.order ??\n                    dimensions.findIndex((d) => d.id === b) ??\n                    0;\n                  return aIndex - bIndex;\n                })\n              : [componentId],\n            filters: dataFilters?.filters ?? {},\n          },\n        });\n        const value = dimensions.find((d) => d.id === componentId)?.values[0]\n          .value as string;\n        dispatch({\n          type: \"FILTER_SET_SINGLE\",\n          value: {\n            filters: [{ cubeIri: \"\", dimensionId: componentId }],\n            value,\n          },\n        });\n      } else {\n        dispatch({\n          type: \"DASHBOARD_DATA_FILTER_REMOVE\",\n          value: {\n            dimensionId: componentId,\n          },\n        });\n        dispatch({\n          type: \"FILTER_REMOVE_SINGLE\",\n          value: {\n            filters: [{ cubeIri: \"\", dimensionId: componentId }],\n          },\n        });\n      }\n    }\n  );\n\n  switch (layout.type) {\n    case \"tab\":\n    case \"dashboard\":\n      if (\n        (!timeRange || potentialTimeRangeFilterIds.length === 0) &&\n        (!dataFilters || potentialDataFilterIds.length === 0)\n      ) {\n        return null;\n      }\n\n      return (\n        <ControlSection\n          role=\"tablist\"\n          aria-labelledby=\"controls-shared-filters\"\n          collapse\n        >\n          <SectionTitle id=\"controls-shared-filters\">\n            <Trans id=\"controls.section.shared-filters\">Shared filters</Trans>\n          </SectionTitle>\n          <ControlSectionContent>\n            <Stack gap=\"0.5rem\">\n              {timeRange && combinedTemporalDimension.values.length ? (\n                <>\n                  <div\n                    style={{\n                      display: \"flex\",\n                      justifyContent: \"space-between\",\n                      alignItems: \"center\",\n                      width: \"100%\",\n                    }}\n                  >\n                    <Typography variant=\"body3\">\n                      {combinedTemporalDimension.label}\n                    </Typography>\n                    <Switch\n                      data-testid=\"dashboard-time-range-filter-toggle\"\n                      checked={timeRange.active}\n                      onChange={handleTimeRangeFilterToggle}\n                    />\n                  </div>\n                  {timeRange.active ? (\n                    <DashboardFiltersOptions\n                      timeRangeFilter={timeRange}\n                      timeRangeCombinedDimension={combinedTemporalDimension}\n                    />\n                  ) : null}\n                </>\n              ) : null}\n              {dataFilters ? (\n                <>\n                  {potentialDataFilterIds.map((id, i) => {\n                    const dim = dimensions.find((d) => d.id === id);\n\n                    if (!dim) {\n                      return null;\n                    }\n\n                    const checked = dataFilters.componentIds.includes(dim.id);\n\n                    return (\n                      <div\n                        key={dim.id}\n                        style={{ display: \"flex\", flexDirection: \"column\" }}\n                      >\n                        <div\n                          style={{\n                            display: \"flex\",\n                            justifyContent: \"space-between\",\n                            alignItems: \"center\",\n                          }}\n                        >\n                          <Typography variant=\"body3\">{dim.label}</Typography>\n                          <Switch\n                            checked={checked}\n                            onChange={(_, checked) => {\n                              handleDataFiltersToggle(checked, dim.id);\n                            }}\n                          />\n                        </div>\n                        {checked ? (\n                          <Box sx={{ mb: 1 }}>\n                            <DataFilterSelectGeneric\n                              rawDimension={dim}\n                              filterDimensionIds={[]}\n                              index={i}\n                              disabled={fetching}\n                              disableLabel\n                            />\n                          </Box>\n                        ) : null}\n                      </div>\n                    );\n                  })}\n                </>\n              ) : null}\n            </Stack>\n          </ControlSectionContent>\n        </ControlSection>\n      );\n    default:\n      return null;\n  }\n};\n\nconst DashboardFiltersOptions = ({\n  timeRangeFilter,\n  timeRangeCombinedDimension,\n}: {\n  timeRangeFilter: DashboardTimeRangeFilter | undefined;\n  timeRangeCombinedDimension: Dimension;\n}) => {\n  if (!timeRangeFilter) {\n    return null;\n  }\n\n  if (\n    !canDimensionBeTimeFiltered(timeRangeCombinedDimension) ||\n    !canRenderDatePickerField(timeRangeCombinedDimension.timeUnit)\n  ) {\n    return null;\n  }\n\n  return (\n    <DashboardTimeRangeFilterOptions\n      filter={timeRangeFilter}\n      dimension={timeRangeCombinedDimension}\n    />\n  );\n};\n\nconst DashboardTimeRangeFilterOptions = ({\n  filter,\n  dimension,\n}: {\n  filter: DashboardTimeRangeFilter;\n  dimension: TemporalDimension | TemporalEntityDimension;\n}) => {\n  const { timeUnit, timeFormat } = dimension;\n  const timeFormatUnit = useTimeFormatUnit();\n  const formatLocale = useTimeFormatLocale();\n  const formatDate = formatLocale.format(timeFormat);\n  const parseDate = formatLocale.parse(timeFormat);\n  const [state, dispatch] = useConfiguratorState();\n  const dashboardInteractiveFilters = useDashboardInteractiveFilters();\n\n  const { sortedOptions, sortedValues } = useMemo(() => {\n    return getTimeFilterOptions({\n      dimension,\n      formatLocale,\n      timeFormatUnit,\n    });\n  }, [dimension, formatLocale, timeFormatUnit]);\n\n  const minDate = sortedOptions[0].date;\n  const maxDate = sortedOptions[sortedOptions.length - 1].date;\n  const timeRange = [\n    parseDate(filter.presets.from) as Date,\n    parseDate(filter.presets.to) as Date,\n  ];\n\n  const updateChartStoresFrom = useCallback(\n    (newDate: Date) => {\n      Object.entries(dashboardInteractiveFilters.stores).forEach(\n        ([chartKey, [getInteractiveFiltersState]]) => {\n          const { interactiveFiltersConfig } = getChartConfig(state, chartKey);\n          const interactiveFiltersState = getInteractiveFiltersState();\n          const { from, to } = interactiveFiltersState.timeRange;\n          const setTimeRangeFilter = interactiveFiltersState.setTimeRange;\n\n          if (from && to && interactiveFiltersConfig.timeRange.componentId) {\n            setTimeRangeFilter(newDate, to);\n          }\n        }\n      );\n    },\n    [dashboardInteractiveFilters.stores, state]\n  );\n\n  const updateChartStoresTo = useCallback(\n    (newDate: Date) => {\n      Object.entries(dashboardInteractiveFilters.stores).forEach(\n        ([chartKey, [getInteractiveFiltersState]]) => {\n          const { interactiveFiltersConfig } = getChartConfig(state, chartKey);\n          const interactiveFiltersState = getInteractiveFiltersState();\n          const { from, to } = interactiveFiltersState.timeRange;\n          const setTimeRangeFilter = interactiveFiltersState.setTimeRange;\n\n          if (from && to && interactiveFiltersConfig.timeRange.componentId) {\n            setTimeRangeFilter(from, newDate);\n          }\n        }\n      );\n    },\n    [dashboardInteractiveFilters.stores, state]\n  );\n\n  const handleChangeFromDate: DatePickerFieldProps[\"onChange\"] = (ev) => {\n    const newDate = parseDate(ev.target.value);\n    if (!newDate) {\n      return;\n    }\n    dispatch({\n      type: \"DASHBOARD_TIME_RANGE_FILTER_UPDATE\",\n      value: {\n        ...filter,\n        presets: {\n          ...filter.presets,\n          from: formatDate(newDate),\n        },\n      },\n    });\n    updateChartStoresFrom(newDate);\n  };\n\n  const handleChangeFromGeneric: DataFilterGenericDimensionProps[\"onChange\"] = (\n    ev\n  ) => {\n    dispatch({\n      type: \"DASHBOARD_TIME_RANGE_FILTER_UPDATE\",\n      value: {\n        ...filter,\n        presets: {\n          ...filter.presets,\n          from: ev.target.value as string,\n        },\n      },\n    });\n    const parsedDate = parseDate(ev.target.value as string);\n    if (parsedDate) {\n      updateChartStoresFrom(parsedDate);\n    }\n  };\n\n  const handleChangeToDate: DatePickerFieldProps[\"onChange\"] = (ev) => {\n    const newDate = parseDate(ev.target.value);\n    if (!newDate) {\n      return;\n    }\n    dispatch({\n      type: \"DASHBOARD_TIME_RANGE_FILTER_UPDATE\",\n      value: {\n        ...filter,\n        presets: {\n          ...filter.presets,\n          to: formatDate(newDate),\n        },\n      },\n    });\n    updateChartStoresTo(newDate);\n  };\n\n  const handleChangeToGeneric: DataFilterGenericDimensionProps[\"onChange\"] = (\n    ev\n  ) => {\n    dispatch({\n      type: \"DASHBOARD_TIME_RANGE_FILTER_UPDATE\",\n      value: {\n        ...filter,\n        presets: {\n          ...filter.presets,\n          to: ev.target.value as string,\n        },\n      },\n    });\n    const parsedDate = parseDate(ev.target.value as string);\n    if (parsedDate) {\n      updateChartStoresTo(parsedDate);\n    }\n  };\n\n  return (\n    <div>\n      <Stack\n        data-testid=\"dashboard-time-range-filters\"\n        direction=\"row\"\n        gap=\"0.5rem\"\n        alignItems=\"center\"\n        divider={\n          <Box position=\"relative\" top=\"0.5rem\">\n            -\n          </Box>\n        }\n      >\n        {canRenderDatePickerField(timeUnit) ? (\n          <DatePickerField\n            name=\"dashboard-time-range-filter-from\"\n            value={timeRange[0]}\n            onChange={handleChangeFromDate}\n            isDateDisabled={(date) => {\n              return (\n                date > timeRange[1] || !sortedValues.includes(formatDate(date))\n              );\n            }}\n            timeUnit={timeUnit}\n            dateFormat={formatDate}\n            minDate={minDate}\n            maxDate={maxDate}\n            label={t({ id: \"controls.filters.select.from\", message: \"From\" })}\n            parseDate={parseDate}\n          />\n        ) : (\n          <Select\n            id=\"dashboard-time-range-filter-from\"\n            label={t({ id: \"controls.filters.select.from\", message: \"From\" })}\n            options={sortedOptions}\n            value={filter.presets.from}\n            onChange={handleChangeFromGeneric}\n          />\n        )}\n        {canRenderDatePickerField(timeUnit) ? (\n          <DatePickerField\n            name=\"dashboard-time-range-filter-to\"\n            value={timeRange[1]}\n            onChange={handleChangeToDate}\n            isDateDisabled={(date) => {\n              return (\n                date < timeRange[0] || !sortedValues.includes(formatDate(date))\n              );\n            }}\n            timeUnit={timeUnit}\n            dateFormat={formatDate}\n            minDate={minDate}\n            maxDate={maxDate}\n            label={t({ id: \"controls.filters.select.to\", message: \"To\" })}\n            parseDate={parseDate}\n          />\n        ) : (\n          <Select\n            id=\"dashboard-time-range-filter-to\"\n            label={t({ id: \"controls.filters.select.to\", message: \"To\" })}\n            options={sortedOptions}\n            value={filter.presets.to}\n            onChange={handleChangeToGeneric}\n          />\n        )}\n      </Stack>\n    </div>\n  );\n};\n\nconst LayoutBlocksConfigurator = () => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const { layout } = state;\n  const { blocks } = layout;\n  const classes = useLayoutBlocksStyles();\n  const onClick = useEvent((blockKey: string) => {\n    dispatch({\n      type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value: blockKey,\n    });\n  });\n\n  return layout.type === \"dashboard\" ? (\n    <ControlSection role=\"tablist\" aria-labelledby=\"controls-blocks\" collapse>\n      <SectionTitle id=\"controls-blocks\">\n        <Trans id=\"controls.section.block-options\">Objects</Trans>\n      </SectionTitle>\n      <ControlSectionContent gap=\"none\">\n        <div>\n          {blocks\n            .filter(\n              (block): block is LayoutTextBlock & { initialized: boolean } =>\n                block.type === \"text\"\n            )\n            .map((block) => (\n              <ControlTab\n                key={block.key}\n                id={`tab-block-${block.key}`}\n                mainLabel={\n                  <div style={{ pointerEvents: \"none\" }}>\n                    <Markdown>{block.text[locale]}</Markdown>\n                  </div>\n                }\n                checked={state.layout.activeField === block.key}\n                onClick={() => onClick(block.key)}\n                value={state.layout.activeField ?? \"\"}\n                icon=\"text\"\n                rightIcon={<Icon className={classes.tabRightIcon} name=\"pen\" />}\n              />\n            ))}\n        </div>\n        <AddLayoutBlocks />\n      </ControlSectionContent>\n    </ControlSection>\n  ) : null;\n};\n\nconst useLayoutBlocksStyles = makeStyles<Theme>((theme) => ({\n  tabRightIcon: {\n    color: theme.palette.primary.main,\n  },\n}));\n\nconst AddLayoutBlocks = () => {\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const { layout } = state;\n  const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null);\n  const handleOpen = useEvent((e: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(e.currentTarget);\n  });\n  const handleClose = useEvent(() => {\n    setAnchorEl(null);\n  });\n  const handleAddTextBlock = useEvent(() => {\n    const key = createId();\n    dispatch({\n      type: \"LAYOUT_CHANGED\",\n      value: {\n        ...layout,\n        blocks: [\n          ...layout.blocks,\n          {\n            type: \"text\",\n            key,\n            text: {\n              de: \"\",\n              fr: \"\",\n              it: \"\",\n              en: \"\",\n            },\n            initialized: false,\n          },\n        ],\n      },\n    });\n    dispatch({\n      type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value: key,\n    });\n    handleClose();\n  });\n  const classes = useAddTextBlocksStyles();\n\n  return (\n    <>\n      <ConfiguratorAddButton onClick={handleOpen}>\n        <Trans id=\"controls.section.block-options.block-add\">Add object</Trans>\n      </ConfiguratorAddButton>\n      <Menu anchorEl={anchorEl} open={!!anchorEl} onClose={handleClose}>\n        <MenuItem className={classes.menuItem} onClick={handleAddTextBlock}>\n          <Icon name=\"text\" className={classes.menuItemIcon} />\n          <Typography className={classes.menuItemText} variant=\"body2\">\n            <Trans id=\"controls.section.block-options.block-add.text\">\n              Add text\n            </Trans>\n          </Typography>\n        </MenuItem>\n      </Menu>\n    </>\n  );\n};\n\nconst useAddTextBlocksStyles = makeStyles<Theme>((theme) => ({\n  menuItem: {\n    minWidth: 200,\n    padding: theme.spacing(3),\n  },\n  menuItemIcon: {\n    marginRight: \"0.75rem\",\n  },\n  menuItemText: {\n    color: theme.palette.grey[700],\n  },\n}));\n\nconst migrateLayout = (\n  layout: LayoutDashboard,\n  newLayoutType: LayoutDashboard[\"layout\"],\n  blocks: LayoutDashboard[\"blocks\"]\n): LayoutDashboard => {\n  if (newLayoutType === \"canvas\") {\n    const defaultLayout = generateLayout({\n      count: blocks.length,\n      layout: \"tiles\",\n    }).map((l, i) => ({\n      ...l,\n      i: blocks[i].key,\n    }));\n    const layouts: Record<\n      keyof typeof FREE_CANVAS_BREAKPOINTS,\n      ReactGridLayoutType[]\n    > = {\n      xl: defaultLayout,\n      lg: defaultLayout,\n      md: defaultLayout,\n      sm: defaultLayout,\n    };\n    return {\n      ...layout,\n      layout: newLayoutType,\n      layouts,\n      blocks: blocks.map((block) => {\n        return {\n          ...block,\n          initialized: false,\n        };\n      }),\n    };\n  } else {\n    return {\n      ...omit(layout, \"layouts\"),\n      layout: newLayoutType,\n    };\n  }\n};\n\nconst DashboardLayoutButton = ({\n  type,\n  layout,\n}: {\n  type: LayoutDashboard[\"layout\"];\n  layout: LayoutDashboard;\n}) => {\n  const [config, dispatch] = useConfiguratorState(isLayouting);\n  const ref = useRef<LayoutDashboard>();\n  const checked = layout.layout === type;\n  useEffect(() => {\n    if (checked) {\n      ref.current = layout;\n    }\n\n    if (ref.current) {\n      // Keep blocks in sync, so that they do not get lost when switching layouts.\n      ref.current.blocks = layout.blocks;\n    }\n  }, [layout, checked]);\n  const handleClick = useEvent(() => {\n    if (ref.current?.layout === type) {\n      dispatch({\n        type: \"LAYOUT_CHANGED\",\n        value: ref.current,\n      });\n    } else {\n      dispatch({\n        type: \"LAYOUT_CHANGED\",\n        value: migrateLayout(layout, type, config.layout.blocks),\n      });\n    }\n  });\n\n  return (\n    <IconButton\n      label={`layout${capitalize(type)}`}\n      checked={checked}\n      onClick={handleClick}\n    />\n  );\n};\n","import { t } from \"@lingui/macro\";\nimport {\n  Divider,\n  Theme,\n  ToggleButton,\n  ToggleButtonGroup,\n  Tooltip,\n  useTheme,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport { ReactNode, useMemo, useState } from \"react\";\n\nimport { FREE_CANVAS_BREAKPOINTS } from \"@/components/react-grid\";\nimport { Icon, IconName } from \"@/icons\";\nimport { theme } from \"@/themes/theme\";\n\ntype PreviewBreakpoint = keyof typeof FREE_CANVAS_BREAKPOINTS;\n\nexport const usePreviewBreakpoint = () => {\n  const [breakpoint, setBreakpoint] = useState<PreviewBreakpoint | null>(null);\n  return {\n    previewBreakpoint: breakpoint,\n    setPreviewBreakpoint: setBreakpoint,\n  };\n};\n\nexport const PreviewContainer = ({\n  children,\n  breakpoint,\n  singleColumn,\n}: {\n  children: ReactNode;\n  breakpoint: PreviewBreakpoint | null;\n  singleColumn?: boolean;\n}) => {\n  const classes = useStyles();\n  const { breakpoints } = useTheme();\n  const width = useMemo(() => {\n    if (breakpoint) {\n      switch (breakpoint) {\n        case \"xl\":\n          return breakpoints.values.lg - 1;\n        case \"lg\":\n          return breakpoints.values.md - 1;\n        case \"md\":\n          return breakpoints.values.sm - 1;\n        case \"sm\":\n          return FREE_CANVAS_BREAKPOINTS.md;\n        default:\n          const _exhaustiveCheck: never = breakpoint;\n          return _exhaustiveCheck;\n      }\n    }\n    return singleColumn ? theme.breakpoints.values.lg - 1 : \"100%\";\n  }, [breakpoint, breakpoints, singleColumn]);\n  return (\n    <div className={classes.container}>\n      <div\n        className={classes.chartContainer}\n        style={{ width, paddingTop: breakpoint ? \"0.5rem\" : 0 }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport const PreviewBreakpointToggleMenu = ({\n  value,\n  onChange,\n}: {\n  value: PreviewBreakpoint | null;\n  onChange: (value: PreviewBreakpoint | null) => void;\n}) => {\n  const classes = useStyles();\n  const previewBreakpointOptions: {\n    breakpoint: PreviewBreakpoint;\n    iconName: IconName;\n    title: string;\n  }[] = [\n    {\n      breakpoint: \"xl\",\n      iconName: \"desktop\",\n      title: t({\n        id: \"controls.layout.preview-xl\",\n        message: \"Preview using extra large width\",\n      }),\n    },\n    {\n      breakpoint: \"lg\",\n      iconName: \"laptop\",\n      title: t({\n        id: \"controls.layout.preview-lg\",\n        message: \"Preview using large width\",\n      }),\n    },\n    {\n      breakpoint: \"md\",\n      iconName: \"tablet\",\n      title: t({\n        id: \"controls.layout.preview-md\",\n        message: \"Preview using medium width\",\n      }),\n    },\n    {\n      breakpoint: \"sm\",\n      iconName: \"mobile\",\n      title: t({\n        id: \"controls.layout.preview-sm\",\n        message: \"Preview using small width\",\n      }),\n    },\n  ];\n\n  return (\n    <ToggleButtonGroup\n      className={classes.toggleButtonGroup}\n      value={value}\n      exclusive\n    >\n      {previewBreakpointOptions.map(({ breakpoint, iconName, title }) => {\n        return [\n          <Tooltip\n            key={`${breakpoint}-tooltip`}\n            title={title}\n            arrow\n            enterDelay={1000}\n          >\n            <ToggleButton\n              className={clsx(classes.toggleButton, {\n                [classes.toggleButtonSelected]: value === breakpoint,\n              })}\n              value={breakpoint}\n              onClick={() => onChange(breakpoint)}\n            >\n              <Icon name={iconName} size={16} />\n            </ToggleButton>\n          </Tooltip>,\n          breakpoint !== \"sm\" ? (\n            <Divider\n              key={`${breakpoint}-divider`}\n              className={classes.divider}\n              orientation=\"vertical\"\n              flexItem\n            />\n          ) : null,\n        ];\n      })}\n    </ToggleButtonGroup>\n  );\n};\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  container: {\n    width: \"100%\",\n    height: \"calc(100% - 2rem)\",\n    overflowY: \"auto\",\n    padding: theme.spacing(6, 0, 6, 6),\n  },\n  chartContainer: {\n    margin: \"0 auto\",\n    paddingBottom: \"2rem\",\n    paddingRight: theme.spacing(6),\n  },\n  toggleButtonGroup: {\n    marginLeft: \"auto\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  toggleButton: {\n    border: \"none\",\n    backgroundColor: theme.palette.background.paper,\n    color: theme.palette.text.primary,\n    \"&:hover\": {\n      backgroundColor: theme.palette.background.paper,\n      color: theme.palette.primary.main,\n    },\n  },\n  toggleButtonSelected: {\n    color: theme.palette.primary.main,\n  },\n  divider: {\n    alignSelf: \"center\",\n    borderLeft: `2px solid ${theme.palette.divider} !important`,\n    height: 16,\n    marginLeft: \"-1px !important\",\n    backgroundColor: theme.palette.divider,\n  },\n}));\n","import { Button, ButtonProps, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\n\nimport { Icon } from \"@/icons\";\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  root: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: 42,\n    height: 32,\n    background: theme.palette.background.paper,\n    color: theme.palette.primary.main,\n    \"&:hover\": {\n      background: theme.palette.background.paper,\n    },\n  },\n}));\n\nexport const ShowDrawerButton = (props: ButtonProps) => {\n  const { className, variant = \"text\", ...rest } = props;\n  const classes = useStyles();\n\n  return (\n    <Button className={clsx(classes.root, className)} {...rest}>\n      <Icon name=\"doublearrow\" />\n    </Button>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Box, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { ReactNode } from \"react\";\nimport { Draggable, Droppable } from \"react-beautiful-dnd\";\n\nimport { MoveDragButton } from \"@/components/move-drag-button\";\nimport { TableColumn } from \"@/config-types\";\nimport { DraggableTab } from \"@/configurator/components/chart-controls/control-tab\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { getIconName } from \"@/configurator/components/ui-helpers\";\nimport { useActiveChartField } from \"@/configurator/config-form\";\nimport { Component, Dimension, Measure } from \"@/domain/data\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  filterRow: {\n    display: \"grid\",\n    gridTemplateColumns: \"auto min-content\",\n    overflow: \"hidden\",\n    width: \"100%\",\n    gridColumnGap: theme.spacing(2),\n    gridTemplateRows: \"min-content min-content\",\n    gridTemplateAreas: '\"description drag-button\" \"select drag-button\"',\n\n    \"& > *\": {\n      overflow: \"hidden\",\n    },\n  },\n  dragButtons: {\n    gridArea: \"drag-button\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexGrow: 0,\n    flexShrink: 0,\n    marginRight: theme.spacing(4),\n  },\n}));\n\nexport const TabDropZone = ({\n  id,\n  title,\n  items,\n  dimensions,\n  measures,\n  isDropDisabled,\n  emptyComponent,\n}: {\n  id: string;\n  title: ReactNode;\n  items: TableColumn[];\n  dimensions: Dimension[];\n  measures: Measure[];\n  isDropDisabled?: boolean;\n  emptyComponent?: ReactNode;\n}) => {\n  const classes = useStyles();\n  const components = [...dimensions, ...measures];\n\n  return (\n    <Droppable droppableId={id} isDropDisabled={isDropDisabled}>\n      {({ innerRef, placeholder }) => {\n        return (\n          <ControlSection collapse>\n            <SectionTitle>{title}</SectionTitle>\n            <ControlSectionContent\n              role=\"tablist\"\n              aria-labelledby={`controls-${id}`}\n              px=\"none\"\n            >\n              <div\n                ref={innerRef}\n                style={{ position: \"relative\", minHeight: 60, padding: 0 }}\n              >\n                {items.length === 0 && emptyComponent ? emptyComponent : null}\n                {items.map(({ componentId, index, isHidden }, i) => {\n                  return (\n                    <Draggable\n                      key={componentId}\n                      draggableId={componentId}\n                      index={i}\n                    >\n                      {(\n                        { innerRef, draggableProps, dragHandleProps },\n                        { isDragging }\n                      ) => {\n                        const component = components.find(\n                          (d) => d.id === componentId\n                        );\n\n                        return (\n                          <Box\n                            ref={innerRef}\n                            {...draggableProps}\n                            {...dragHandleProps}\n                            className={classes.filterRow}\n                          >\n                            {component ? (\n                              <DraggableTabField\n                                key={componentId}\n                                component={component}\n                                value={componentId}\n                                upperLabel={\n                                  <Trans id=\"table.column.no\">\n                                    Column {index + 1}\n                                  </Trans>\n                                }\n                                isDragging={isDragging}\n                                disabled={isHidden}\n                              />\n                            ) : null}\n                            <Box className={classes.dragButtons}>\n                              <MoveDragButton />\n                            </Box>\n                          </Box>\n                        );\n                      }}\n                    </Draggable>\n                  );\n                })}\n                {placeholder}\n              </div>\n            </ControlSectionContent>\n          </ControlSection>\n        );\n      }}\n    </Droppable>\n  );\n};\n\nconst DraggableTabField = ({\n  component,\n  value,\n  isDragging,\n  upperLabel,\n  disabled,\n}: {\n  component: Component;\n  value: string;\n  disabled?: boolean;\n  isDragging: boolean;\n  upperLabel: ReactNode;\n}) => {\n  const field = useActiveChartField({ value });\n  const iconName = getIconName(\n    `tableColumn${component.__typename}${disabled ? \"Hidden\" : \"\"}`\n  );\n\n  return (\n    <DraggableTab\n      component={component}\n      value={`${field.value}`}\n      upperLabel={upperLabel}\n      checked={field.checked}\n      onClick={field.onClick}\n      isDragging={isDragging}\n      disabled={disabled}\n      iconName={iconName}\n    />\n  );\n};\n","import { sanitizeUrl } from \"@braintree/sanitize-url\";\nimport { t, Trans } from \"@lingui/macro\";\nimport { SelectChangeEvent } from \"@mui/material\";\nimport { KeyboardEvent, useEffect, useMemo, useState } from \"react\";\n\nimport { Input, Select } from \"@/components/form\";\nimport { TableConfig } from \"@/config-types\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ChartOptionCheckboxField } from \"@/configurator/components/field\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { Dimension } from \"@/domain/data\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const TableLinksSection = ({\n  chartConfig,\n  dimensions,\n}: {\n  chartConfig: TableConfig;\n  dimensions: Dimension[];\n}) => {\n  const locale = useLocale();\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n\n  const dimensionOptions = useMemo(() => {\n    return dimensions.map((d) => ({\n      value: d.id,\n      label: d.label,\n    }));\n  }, [dimensions]);\n\n  const handleLinkComponentIdChange = useEvent(\n    (e: SelectChangeEvent<unknown>) => {\n      const linkComponentId = e.target.value as string;\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field: null,\n          path: \"links.componentId\",\n          value: linkComponentId,\n        },\n      });\n\n      if (chartConfig.links.targetComponentId === \"\") {\n        dispatch({\n          type: \"CHART_FIELD_UPDATED\",\n          value: {\n            locale,\n            field: null,\n            path: \"links.targetComponentId\",\n            value: linkComponentId,\n          },\n        });\n      }\n    }\n  );\n\n  const handleTargetComponentIdChange = useEvent(\n    (e: SelectChangeEvent<unknown>) => {\n      const targetComponentId = e.target.value as string;\n      dispatch({\n        type: \"CHART_FIELD_UPDATED\",\n        value: {\n          locale,\n          field: null,\n          path: \"links.targetComponentId\",\n          value: targetComponentId,\n        },\n      });\n    }\n  );\n\n  return (\n    <ControlSection collapse defaultExpanded={false}>\n      <SectionTitle id=\"controls-links\">\n        <Trans id=\"controls.section.links\">Links</Trans>\n      </SectionTitle>\n      <ControlSectionContent>\n        <ChartOptionCheckboxField\n          label={t({\n            id: \"controls.tableSettings.showLinks\",\n            message: \"Enable links\",\n          })}\n          field={null}\n          path=\"links.enabled\"\n        />\n        <BaseUrlInput\n          value={chartConfig.links.baseUrl}\n          disabled={!chartConfig.links.enabled}\n        />\n        <Select\n          id=\"links.componentId\"\n          size=\"sm\"\n          label={t({\n            id: \"controls.tableSettings.linkComponentId\",\n            message: \"Source Column\",\n          })}\n          options={dimensionOptions}\n          value={chartConfig.links.componentId}\n          name=\"links.componentId\"\n          disabled={!chartConfig.links.enabled}\n          onChange={handleLinkComponentIdChange}\n        />\n        <Select\n          id=\"links.targetComponentId\"\n          size=\"sm\"\n          label={t({\n            id: \"controls.tableSettings.targetComponentId\",\n            message: \"Target Column\",\n          })}\n          options={dimensionOptions}\n          value={chartConfig.links.targetComponentId}\n          name=\"links.targetComponentId\"\n          disabled={!chartConfig.links.enabled}\n          onChange={handleTargetComponentIdChange}\n        />\n      </ControlSectionContent>\n    </ControlSection>\n  );\n};\n\nconst BaseUrlInput = ({\n  value,\n  disabled,\n}: {\n  value: string;\n  disabled: boolean;\n}) => {\n  const locale = useLocale();\n  const [_, dispatch] = useConfiguratorState(isConfiguring);\n\n  const [inputValue, setInputValue] = useState(value);\n  const [isValid, setIsValid] = useState(true);\n\n  useEffect(() => {\n    setInputValue(value);\n  }, [value]);\n\n  const updateBaseUrl = useEvent((newValue: string) => {\n    dispatch({\n      type: \"CHART_FIELD_UPDATED\",\n      value: {\n        locale,\n        field: null,\n        path: \"links.baseUrl\",\n        value: newValue,\n      },\n    });\n  });\n\n  const handleCommit = useEvent(() => {\n    if (inputValue === \"\") {\n      setIsValid(true);\n      updateBaseUrl(\"\");\n\n      return;\n    }\n\n    const sanitizedUrl = sanitizeUrl(inputValue);\n\n    if (sanitizedUrl === \"about:blank\") {\n      setIsValid(false);\n      updateBaseUrl(\"\");\n\n      return;\n    }\n\n    try {\n      const url = new URL(sanitizedUrl);\n      const normalizedUrl = normalizeUrl(url);\n\n      updateBaseUrl(normalizedUrl);\n      setIsValid(true);\n      setInputValue(normalizedUrl);\n    } catch {\n      setIsValid(false);\n    }\n  });\n\n  const handleKeyDown = useEvent((e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\") {\n      handleCommit();\n    }\n  });\n\n  return (\n    <Input\n      type=\"url\"\n      label={t({\n        id: \"controls.tableSettings.baseUrl\",\n        message: \"Base URL\",\n      })}\n      name=\"links.baseUrl\"\n      placeholder=\"https://example.com/\"\n      value={inputValue}\n      disabled={disabled}\n      error={!isValid}\n      errorMessage={t({\n        id: \"controls.tableSettings.baseUrlInvalid\",\n        message: \"Please enter a valid URL\",\n      })}\n      onChange={(e) => setInputValue(e.target.value)}\n      onBlur={handleCommit}\n      onKeyDown={handleKeyDown}\n    />\n  );\n};\n\nconst normalizeUrl = (url: URL) => {\n  if (!url.pathname.endsWith(\"/\")) {\n    url.pathname = url.pathname + \"/\";\n  }\n\n  return url.toString();\n};\n","import { useCallback, useState } from \"react\";\nimport { DraggableLocation, OnDragStartResponder } from \"react-beautiful-dnd\";\n\nimport { ConfiguratorStateConfiguringChart, TableConfig } from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { moveFields } from \"@/configurator/table/table-config-state\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nexport const useTableChartController = (\n  state: ConfiguratorStateConfiguringChart\n) => {\n  const locale = useLocale();\n  const [, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state) as TableConfig;\n  const [{ data: components }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        joinBy: cube.joinBy,\n        loadValues: true,\n      })),\n    },\n  });\n\n  const [currentDraggableId, setCurrentDraggableId] = useState<string | null>(\n    null\n  );\n\n  const handleDragEnd = useCallback(\n    ({\n      source,\n      destination,\n    }: {\n      source: DraggableLocation;\n      destination?: DraggableLocation | null;\n    }) => {\n      setCurrentDraggableId(null);\n\n      if (\n        !destination ||\n        chartConfig.chartType !== \"table\" ||\n        !components?.dataCubesComponents\n      ) {\n        return;\n      }\n\n      const newChartConfig = moveFields(chartConfig, {\n        source,\n        destination,\n      });\n\n      dispatch({\n        type: \"CHART_CONFIG_REPLACED\",\n        value: {\n          chartConfig: newChartConfig,\n          dataCubesComponents: components.dataCubesComponents,\n        },\n      });\n    },\n    [chartConfig, components?.dataCubesComponents, dispatch]\n  );\n\n  const handleDragStart = useCallback<OnDragStartResponder>(\n    ({ draggableId }) => {\n      setCurrentDraggableId(draggableId);\n    },\n    []\n  );\n\n  return {\n    dimensions: components?.dataCubesComponents.dimensions,\n    measures: components?.dataCubesComponents.measures,\n    currentDraggableId,\n    handleDragStart,\n    handleDragEnd,\n    chartConfig,\n  };\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { DragDropContext } from \"react-beautiful-dnd\";\n\nimport { Loading } from \"@/components/hint\";\nimport { ConfiguratorStateConfiguringChart } from \"@/configurator\";\nimport { TabDropZone } from \"@/configurator/components/chart-controls/drag-and-drop-tab\";\nimport {\n  ControlSection,\n  ControlSectionContent,\n  SectionTitle,\n} from \"@/configurator/components/chart-controls/section\";\nimport { ShowFilterAreaOpen } from \"@/configurator/components/chart-controls/show-filter-area-open\";\nimport { ChartTypeSelector } from \"@/configurator/components/chart-type-selector\";\nimport { DatasetsControlSection } from \"@/configurator/components/dataset-control-section\";\nimport {\n  ChartAnnotatorTabField,\n  ChartOptionCheckboxField,\n} from \"@/configurator/components/field\";\nimport { useOrderedTableColumns } from \"@/configurator/components/ui-helpers\";\nimport { TableLinksSection } from \"@/configurator/table/configurator/links-section\";\nimport { useTableChartController } from \"@/configurator/table/table-chart-configurator.hook\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  emptyGroups: {\n    textAlign: \"center\",\n    border: \"1px dashed\",\n    borderColor: theme.palette.divider,\n    margin: theme.spacing(2),\n    color: theme.palette.text.secondary,\n    borderRadius: 8,\n    padding: theme.spacing(2),\n  },\n}));\n\nconst EmptyGroups = () => {\n  const classes = useStyles();\n\n  return (\n    <Typography variant=\"body3\" component=\"div\" className={classes.emptyGroups}>\n      <Trans id=\"controls.groups.empty-help\">\n        Drag and drop columns here to make groups.\n      </Trans>\n    </Typography>\n  );\n};\n\nexport const ChartConfiguratorTable = ({\n  state,\n}: {\n  state: ConfiguratorStateConfiguringChart;\n}) => {\n  const {\n    dimensions,\n    measures,\n    currentDraggableId,\n    chartConfig,\n    handleDragEnd,\n    handleDragStart,\n  } = useTableChartController(state);\n\n  const fieldsArray = useOrderedTableColumns(chartConfig.fields);\n\n  if (!dimensions || !measures) {\n    return <Loading />;\n  }\n\n  const groupFields = [...fieldsArray.filter((f) => f.isGroup)];\n  const columnFields = [...fieldsArray.filter((f) => !f.isGroup)];\n\n  const currentDraggedField =\n    currentDraggableId !== null ? chartConfig.fields[currentDraggableId] : null;\n  const isGroupsDropDisabled =\n    currentDraggedField?.componentType === \"NumericalMeasure\";\n\n  return (\n    <>\n      <DatasetsControlSection />\n      <ControlSection\n        role=\"tablist\"\n        aria-labelledby=\"controls-chart-type\"\n        collapse\n      >\n        <SectionTitle id=\"controls-chart-type\">\n          <Trans id=\"controls.select.chart.type\">Chart Type</Trans>\n        </SectionTitle>\n        <ControlSectionContent gap=\"none\">\n          <ChartTypeSelector\n            showHelp={false}\n            state={state}\n            chartKey={chartConfig.key}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      <ControlSection collapse>\n        <SectionTitle>\n          <Trans id=\"controls.section.tableoptions\">Table Options</Trans>\n        </SectionTitle>\n        <ControlSectionContent\n          gap=\"none\"\n          px=\"none\"\n          role=\"tablist\"\n          aria-labelledby=\"controls-settings\"\n        >\n          <ChartAnnotatorTabField\n            key=\"sorting\"\n            value=\"table-sorting\"\n            icon=\"sort\"\n            mainLabel={<Trans id=\"controls.table.sorting\">Sorting</Trans>}\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      <ControlSection collapse>\n        <SectionTitle id=\"controls-data\">\n          <Trans id=\"controls.section.data.filters\">Filters</Trans>\n        </SectionTitle>\n        <ControlSectionContent sx={{ my: 2 }}>\n          <ShowFilterAreaOpen chartConfig={chartConfig} />\n          <ChartOptionCheckboxField\n            label={t({\n              id: \"controls.tableSettings.showSearch\",\n              message: \"Show Search\",\n            })}\n            field={null}\n            path=\"settings.showSearch\"\n          />\n        </ControlSectionContent>\n      </ControlSection>\n      <DragDropContext\n        onDragEnd={(result) =>\n          handleDragEnd({\n            source: result.source,\n            destination: result.destination,\n          })\n        }\n        onDragStart={handleDragStart}\n      >\n        <TabDropZone\n          id=\"groups\"\n          title={<Trans id=\"controls.section.groups\">Groups</Trans>}\n          dimensions={dimensions}\n          measures={measures}\n          items={groupFields}\n          isDropDisabled={isGroupsDropDisabled}\n          emptyComponent={<EmptyGroups />}\n        />\n        <TabDropZone\n          id=\"columns\"\n          title={<Trans id=\"controls.section.columns\">Columns</Trans>}\n          dimensions={dimensions}\n          measures={measures}\n          items={columnFields}\n        />\n      </DragDropContext>\n      <TableLinksSection chartConfig={chartConfig} dimensions={dimensions} />\n    </>\n  );\n};\n","import { ReactNode } from \"react\";\nimport reactStringReplace from \"react-string-replace\";\n\nexport const replaceLinks = (\n  str: string,\n  replacer: (label: string, link: string) => ReactNode\n) => {\n  return reactStringReplace(str, /(\\[.*\\]\\(.*\\))/, (match) => {\n    const splitIndex = match.indexOf(\"](\");\n    const label = match.slice(1, splitIndex);\n    const link = match.slice(splitIndex + 2, match.length - 1);\n    return replacer(label, link);\n  });\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport {\n  Box,\n  Grow,\n  Link,\n  Tooltip,\n  Typography,\n  useEventCallback,\n} from \"@mui/material\";\nimport Button, { ButtonProps } from \"@mui/material/Button\";\nimport { PUBLISHED_STATE } from \"@prisma/client\";\nimport * as clipboard from \"clipboard-polyfill/text\";\nimport NextLink from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useSession } from \"next-auth/react\";\nimport { enqueueSnackbar } from \"notistack\";\nimport {\n  PropsWithChildren,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n} from \"react\";\nimport { useClient } from \"urql\";\nimport { useDebounce } from \"use-debounce\";\n\nimport { SelectDatasetStep } from \"@/browse/ui/select-dataset-step\";\nimport { extractChartConfigComponentIds } from \"@/charts/shared/chart-helpers\";\nimport { ChartPreview } from \"@/components/chart-preview\";\nimport { HEADER_HEIGHT_CSS_VAR } from \"@/components/header-constants\";\nimport { Loading } from \"@/components/hint\";\nimport {\n  createMetadataPanelStore,\n  MetadataPanelStoreContext,\n} from \"@/components/metadata-panel-store\";\nimport { useLocalSnack } from \"@/components/use-local-snack\";\nimport {\n  ConfiguratorState,\n  ConfiguratorStateLayouting,\n  enableLayouting,\n  MetaKey,\n} from \"@/config-types\";\nimport { getChartConfig } from \"@/config-utils\";\nimport {\n  ChartAnnotatorSelector,\n  LayoutAnnotatorSelector,\n} from \"@/configurator/components/annotator-options\";\nimport { Description, Title } from \"@/configurator/components/annotators\";\nimport { LayoutBlocksSelector } from \"@/configurator/components/block-options-selector\";\nimport { ChartAnnotationsSelector } from \"@/configurator/components/chart-annotations/chart-annotations-selector\";\nimport { isAnnotationField } from \"@/configurator/components/chart-annotations/utils\";\nimport { ChartConfigurator } from \"@/configurator/components/chart-configurator\";\nimport { ChartOptionsSelector } from \"@/configurator/components/chart-options-selector\";\nimport {\n  ConfiguratorDrawer,\n  DRAWER_WIDTH,\n} from \"@/configurator/components/drawers\";\nimport { IconButton } from \"@/configurator/components/icon-button\";\nimport {\n  LAYOUT_HEADER_HEIGHT,\n  PanelBodyWrapper,\n  PanelHeaderLayout,\n  PanelHeaderWrapper,\n  PanelLayout,\n} from \"@/configurator/components/layout\";\nimport { LayoutConfigurator } from \"@/configurator/components/layout-configurator\";\nimport {\n  PreviewBreakpointToggleMenu,\n  PreviewContainer,\n  usePreviewBreakpoint,\n} from \"@/configurator/components/preview-breakpoint\";\nimport { ShowDrawerButton } from \"@/configurator/components/show-drawer-button\";\nimport {\n  hasChartConfigs,\n  initChartStateFromChartEdit,\n  isConfiguring,\n  isLayouting,\n  saveChartLocally,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { ChartConfiguratorTable } from \"@/configurator/table/table-chart-configurator\";\nimport { useUserConfig } from \"@/domain/user-configs\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { Icon } from \"@/icons\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useDataSourceStore } from \"@/stores/data-source\";\nimport {\n  InteractiveFiltersChartProvider,\n  InteractiveFiltersProvider,\n} from \"@/stores/interactive-filters\";\nimport { createConfig, updateConfig } from \"@/utils/chart-config/api\";\nimport { objectToHashString } from \"@/utils/hash-utils\";\nimport { getRouterChartId } from \"@/utils/router/helpers\";\nimport { replaceLinks } from \"@/utils/ui-strings\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { useMutate } from \"@/utils/use-fetch-data\";\n\nexport const BackButton = ({\n  size = \"xs\",\n  children,\n  onClick,\n  ...props\n}: { children: ReactNode } & ButtonProps) => {\n  return (\n    <Button\n      variant=\"outlined\"\n      size={size}\n      startIcon={<Icon name=\"arrowLeft\" size={20} />}\n      onClick={onClick}\n      {...props}\n    >\n      {children}\n    </Button>\n  );\n};\n\nexport const isAnnotatorField = (\n  field: string | undefined\n): field is MetaKey => {\n  return field === \"title\" || field === \"description\" || field === \"label\";\n};\n\nconst useAssureCorrectDataSource = (stateGuard: ConfiguratorState[\"state\"]) => {\n  const [state] = useConfiguratorState();\n  const { dataSource, setDataSource } = useDataSourceStore();\n\n  useEffect(() => {\n    if (state.state !== stateGuard) {\n      return;\n    }\n\n    if (state.dataSource.url !== dataSource.url) {\n      setDataSource(state.dataSource);\n    }\n  }, [\n    dataSource.url,\n    setDataSource,\n    state.dataSource,\n    state.state,\n    stateGuard,\n  ]);\n};\n\nconst NextStepButton = ({ children }: PropsWithChildren<{}>) => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(hasChartConfigs);\n  const chartConfig = getChartConfig(state);\n  const componentIds = extractChartConfigComponentIds({ chartConfig });\n  const [{ data: components }] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: state.dataSource.type,\n      sourceUrl: state.dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        componentIds,\n        filters: cube.filters,\n        joinBy: cube.joinBy,\n        loadValues: true,\n      })),\n    },\n  });\n\n  const handleClick = useEvent(() => {\n    if (components?.dataCubesComponents) {\n      dispatch({\n        type: \"STEP_NEXT\",\n        dataCubesComponents: components.dataCubesComponents,\n      });\n    }\n  });\n\n  return (\n    <Button\n      variant=\"contained\"\n      size=\"sm\"\n      endIcon={<Icon name=\"arrowRight\" size={20} />}\n      onClick={handleClick}\n    >\n      {children}\n    </Button>\n  );\n};\n\nconst SaveDraftButton = ({ chartId }: { chartId: string | undefined }) => {\n  const { data: config, invalidate: invalidateConfig } = useUserConfig(chartId);\n  const session = useSession();\n  const client = useClient();\n\n  const [state, dispatch] = useConfiguratorState();\n\n  const [snack, enqueueSnackbar, dismissSnack] = useLocalSnack();\n  const [debouncedSnack] = useDebounce(snack, 500);\n  const { asPath, replace } = useRouter();\n\n  const createConfigMut = useMutate(createConfig);\n  const updatePublishedStateMut = useMutate(updateConfig);\n  const loggedInId = session.data?.user.id;\n\n  const handleClick = useEventCallback(async () => {\n    try {\n      if (config?.user_id && loggedInId) {\n        const updated = await updatePublishedStateMut.mutate({\n          data: state,\n          published_state: PUBLISHED_STATE.DRAFT,\n          key: config.key,\n        });\n\n        if (updated) {\n          if (asPath !== `/create/${updated.key}`) {\n            replace(`/create/new?edit=${updated.key}`);\n          }\n        } else {\n          throw Error(\"Could not update draft\");\n        }\n      } else if (state) {\n        const saved = await createConfigMut.mutate({\n          data: state,\n          user_id: loggedInId,\n          published_state: PUBLISHED_STATE.DRAFT,\n        });\n        if (saved) {\n          const config = await initChartStateFromChartEdit(\n            client,\n            saved.key,\n            state.state\n          );\n\n          if (!config) {\n            return;\n          }\n\n          dispatch({ type: \"INITIALIZED\", value: config });\n          saveChartLocally(saved.key, config);\n          replace(`/create/${saved.key}`, undefined, {\n            shallow: true,\n          });\n        } else {\n          throw Error(\"Could not save draft\");\n        }\n      }\n\n      enqueueSnackbar({\n        message: (\n          <>\n            {replaceLinks(\n              t({\n                id: \"button.save-draft.saved\",\n                message: \"Draft saved in [My visualizations](/profile)\",\n              }),\n              (label, href) => {\n                return (\n                  <div>\n                    <NextLink href={href} passHref legacyBehavior>\n                      <Link sx={{ color: \"primary.main\" }}>{label}</Link>\n                    </NextLink>\n                  </div>\n                );\n              }\n            )}\n          </>\n        ),\n        variant: \"success\",\n      });\n\n      invalidateConfig();\n    } catch (e) {\n      console.log(\n        `Error while saving draft: ${e instanceof Error ? e.message : e}`\n      );\n      enqueueSnackbar({\n        message: t({\n          id: \"button.save-draft.error\",\n          message: \"Could not save draft\",\n        }),\n        variant: \"error\",\n      });\n    }\n\n    setTimeout(() => {\n      updatePublishedStateMut.reset();\n      createConfigMut.reset();\n    }, 2000);\n  });\n\n  const hasUpdated = !!(updatePublishedStateMut.data || createConfigMut.data);\n  const [debouncedHasUpdated] = useDebounce(hasUpdated, 300);\n\n  if (!loggedInId) {\n    return null;\n  }\n\n  return (\n    <Tooltip\n      arrow\n      title={debouncedSnack?.message ?? \"\"}\n      open={!!snack}\n      disableFocusListener\n      disableHoverListener\n      disableTouchListener\n      onClose={() => dismissSnack()}\n    >\n      <Button\n        variant=\"outlined\"\n        size=\"sm\"\n        endIcon={\n          hasUpdated || debouncedHasUpdated ? (\n            <Grow in={hasUpdated}>\n              <span>\n                <Icon name=\"checkmark\" />\n              </span>\n            </Grow>\n          ) : null\n        }\n        onClick={handleClick}\n      >\n        <Trans id=\"button.save-draft\">Save draft</Trans>\n      </Button>\n    </Tooltip>\n  );\n};\n\nconst CopyPreviewLinkButton = () => {\n  const locale = useLocale();\n  const [state] = useConfiguratorState();\n\n  const handleClick = () => {\n    const hashString = objectToHashString(state);\n    clipboard.writeText(`${window.origin}/${locale}/preview${hashString}`);\n    enqueueSnackbar({\n      message: t({\n        id: \"button.copy-preview-link.success\",\n        message: \"Preview link copied!\",\n      }),\n      variant: \"success\",\n    });\n  };\n\n  return (\n    <Tooltip\n      title={t({\n        id: \"button.copy-preview-link.explanation\",\n        message:\n          \"Get a chart link with configuration stored in the URL without having to publish it.\",\n      })}\n      disableInteractive\n    >\n      <Button size=\"sm\" variant=\"outlined\" onClick={handleClick}>\n        <Trans id=\"button.copy-preview-link\">Copy preview link</Trans>\n      </Button>\n    </Tooltip>\n  );\n};\n\nconst LayoutChartButton = () => {\n  return (\n    <NextStepButton>\n      <Trans id=\"button.layout\">Proceed to layout options</Trans>\n    </NextStepButton>\n  );\n};\n\nconst PublishChartButton = ({ chartId }: { chartId: string | undefined }) => {\n  const session = useSession();\n  const { data: config } = useUserConfig(chartId);\n  const editingPublishedChart =\n    session.data?.user.id &&\n    config?.user_id === session.data.user.id &&\n    config.published_state === \"PUBLISHED\";\n\n  return (\n    <NextStepButton>\n      {editingPublishedChart ? (\n        <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 2 }}>\n          <Tooltip\n            title={t({\n              id: \"button.update.warning\",\n              message:\n                \"Keep in mind that updating this visualization will affect all the places where it might be already embedded!\",\n            })}\n          >\n            <div>\n              <Icon name=\"warningCircle\" />\n            </div>\n          </Tooltip>\n          <Trans id=\"button.update\">Update this visualization</Trans>\n        </Box>\n      ) : (\n        <Trans id=\"button.publish\">Publish</Trans>\n      )}\n    </NextStepButton>\n  );\n};\n\nconst ConfigureChartStep = () => {\n  const [state, dispatch] = useConfiguratorState();\n  const configuring = isConfiguring(state);\n  const chartConfig = getChartConfig(state);\n  const router = useRouter();\n  const handleClosePanel = useEvent(() => {\n    dispatch({\n      type: \"CHART_ACTIVE_FIELD_CHANGE\",\n      value: undefined,\n    });\n  });\n  const handlePrevious = useEvent(() => {\n    if (!configuring) {\n      return;\n    }\n\n    router.push(\n      {\n        pathname: `/browse`,\n        query: {\n          dataset: chartConfig.cubes[0].iri,\n        },\n      },\n      undefined,\n      { shallow: true }\n    );\n  });\n\n  useAssureCorrectDataSource(\"CONFIGURING_CHART\");\n\n  if (!configuring) {\n    return null;\n  }\n\n  const chartId = getRouterChartId(router.asPath);\n\n  return (\n    <InteractiveFiltersChartProvider chartConfigKey={chartConfig.key}>\n      <PanelLayout type=\"LM\">\n        <PanelHeaderLayout type=\"LMR\">\n          <PanelHeaderWrapper type=\"L\">\n            <BackButton size=\"sm\" onClick={handlePrevious}>\n              <Trans id=\"controls.nav.back-to-preview\">Back to preview</Trans>\n            </BackButton>\n          </PanelHeaderWrapper>\n          <PanelHeaderWrapper\n            type=\"R\"\n            sx={{\n              display: \"flex\",\n              flexShrink: 0,\n              alignItems: \"start\",\n              justifyContent: \"flex-end\",\n              gap: \"0.5rem\",\n            }}\n          >\n            <CopyPreviewLinkButton />\n            <SaveDraftButton chartId={chartId} />\n            {enableLayouting(state) ? (\n              <LayoutChartButton />\n            ) : (\n              <PublishChartButton chartId={chartId} />\n            )}\n          </PanelHeaderWrapper>\n        </PanelHeaderLayout>\n        <PanelBodyWrapper\n          type=\"L\"\n          style={{\n            flexGrow: 1,\n            display: \"flex\",\n            height: \"100%\",\n            flexDirection: \"column\",\n          }}\n        >\n          {chartConfig.chartType === \"table\" ? (\n            <ChartConfiguratorTable state={state} />\n          ) : (\n            // Need to use key to force re-render when switching between charts\n            // or adding / removing cubes to fix stale data issues\n            <ChartConfigurator\n              key={`${chartConfig.key}_${chartConfig.cubes.length}`}\n              state={state}\n            />\n          )}\n        </PanelBodyWrapper>\n        <PanelBodyWrapper\n          type=\"M\"\n          sx={{ overflowX: \"hidden\", overflowY: \"auto\", p: 6 }}\n        >\n          <ChartPreview dataSource={state.dataSource} />\n        </PanelBodyWrapper>\n        <ConfiguratorDrawer\n          anchor=\"left\"\n          open={!!chartConfig.activeField}\n          hideBackdrop\n          onClose={handleClosePanel}\n        >\n          <div\n            data-testid=\"panel-drawer\"\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              flex: 1,\n              width: DRAWER_WIDTH,\n            }}\n          >\n            {isAnnotatorField(chartConfig.activeField) ? (\n              <ChartAnnotatorSelector />\n            ) : isAnnotationField(chartConfig.activeField) ? (\n              <ChartAnnotationsSelector />\n            ) : (\n              <ChartOptionsSelector />\n            )}\n          </div>\n        </ConfiguratorDrawer>\n      </PanelLayout>\n    </InteractiveFiltersChartProvider>\n  );\n};\n\nconst LayoutingStep = () => {\n  const locale = useLocale();\n  const [state, dispatch] = useConfiguratorState(isLayouting);\n  const handleClosePanel = useEvent(() => {\n    dispatch({\n      type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n      value: undefined,\n    });\n  });\n  const handlePrevious = useEvent(() => {\n    if (state.state !== \"LAYOUTING\") {\n      return;\n    }\n\n    dispatch({ type: \"STEP_PREVIOUS\" });\n  });\n\n  useAssureCorrectDataSource(\"LAYOUTING\");\n  const { asPath } = useRouter();\n\n  const layoutRef = useRef(state.layout);\n  useEffect(() => {\n    if (layoutRef.current?.type === state.layout.type) {\n      layoutRef.current = state.layout;\n    }\n  }, [state.layout]);\n\n  const { previewBreakpoint, setPreviewBreakpoint } = usePreviewBreakpoint();\n\n  const handleLayoutChange = useCallback(\n    (\n      newLayoutType: ConfiguratorStateLayouting[\"layout\"][\"type\"],\n      newLayoutCallback: () => void\n    ) => {\n      if (newLayoutType === state.layout.type) {\n        return;\n      }\n\n      if (layoutRef.current?.type === newLayoutType) {\n        dispatch({\n          type: \"LAYOUT_CHANGED\",\n          value: {\n            ...layoutRef.current,\n            meta: state.layout.meta,\n            activeField: undefined,\n          },\n        });\n      } else {\n        newLayoutCallback();\n      }\n\n      setPreviewBreakpoint(null);\n    },\n    [dispatch, setPreviewBreakpoint, state.layout.meta, state.layout.type]\n  );\n\n  if (state.state !== \"LAYOUTING\") {\n    return null;\n  }\n\n  const isSingleURLs = state.layout.type === \"singleURLs\";\n  const chartId = getRouterChartId(asPath);\n\n  const centerLayout = !!(isSingleURLs || previewBreakpoint);\n\n  return (\n    <PanelLayout type={centerLayout ? \"M\" : \"LM\"}>\n      <PanelHeaderLayout type=\"LMR\">\n        <PanelHeaderWrapper type=\"L\">\n          <BackButton size=\"sm\" onClick={handlePrevious}>\n            <Trans id=\"controls.nav.back-to-configurator\">\n              Back to editing\n            </Trans>\n          </BackButton>\n        </PanelHeaderWrapper>\n        <PanelHeaderWrapper\n          type=\"M\"\n          sx={{ display: \"flex\", gap: 4, mx: \"auto\" }}\n        >\n          <IconButton\n            label=\"layoutTab\"\n            checked={state.layout.type === \"tab\"}\n            onClick={() =>\n              handleLayoutChange(\"tab\", () => {\n                dispatch({\n                  type: \"LAYOUT_CHANGED\",\n                  value: {\n                    type: \"tab\",\n                    meta: state.layout.meta,\n                    blocks: state.layout.blocks,\n                    activeField: undefined,\n                  },\n                });\n              })\n            }\n          />\n          <IconButton\n            label=\"layoutDashboard\"\n            checked={state.layout.type === \"dashboard\"}\n            onClick={() =>\n              handleLayoutChange(\"dashboard\", () => {\n                dispatch({\n                  type: \"LAYOUT_CHANGED\",\n                  value: {\n                    type: \"dashboard\",\n                    meta: state.layout.meta,\n                    blocks: state.layout.blocks,\n                    layout: \"tall\",\n                    activeField: undefined,\n                  },\n                });\n              })\n            }\n          />\n          <IconButton\n            label=\"layoutSingleURLs\"\n            checked={state.layout.type === \"singleURLs\"}\n            onClick={() =>\n              handleLayoutChange(\"singleURLs\", () => {\n                dispatch({\n                  type: \"LAYOUT_CHANGED\",\n                  value: {\n                    type: \"singleURLs\",\n                    publishableChartKeys: state.chartConfigs.map(\n                      (chartConfig) => chartConfig.key\n                    ),\n                    meta: state.layout.meta,\n                    blocks: state.layout.blocks,\n                    activeField: undefined,\n                  },\n                });\n              })\n            }\n          />\n        </PanelHeaderWrapper>\n        <PanelHeaderWrapper\n          type=\"R\"\n          sx={{\n            display: \"flex\",\n            alignItems: \"start\",\n            justifyContent: \"flex-end\",\n            gap: \"0.5rem\",\n          }}\n        >\n          <CopyPreviewLinkButton />\n          <SaveDraftButton chartId={chartId} />\n          <PublishChartButton chartId={chartId} />\n        </PanelHeaderWrapper>\n      </PanelHeaderLayout>\n      <PanelBodyWrapper\n        type=\"L\"\n        sx={{\n          zIndex: 2,\n          position: \"absolute\",\n          left: centerLayout ? -DRAWER_WIDTH : 0,\n          top: centerLayout ? LAYOUT_HEADER_HEIGHT : 0,\n          width: DRAWER_WIDTH,\n          height: \"100%\",\n          transition: \"left 0.3s\",\n        }}\n      >\n        <LayoutConfigurator />\n      </PanelBodyWrapper>\n      <PanelBodyWrapper\n        type=\"M\"\n        style={{ overflowY: \"hidden\", overflowX: \"auto\" }}\n      >\n        <Box sx={{ display: \"flex\", px: 6, py: 4 }}>\n          {!isSingleURLs && previewBreakpoint && (\n            <ShowDrawerButton onClick={() => setPreviewBreakpoint(null)} />\n          )}\n          <PreviewBreakpointToggleMenu\n            value={previewBreakpoint}\n            onChange={(value) => {\n              dispatch({\n                type: \"LAYOUT_CHANGED\",\n                value: {\n                  ...state.layout,\n                  activeField: undefined,\n                },\n              });\n              setPreviewBreakpoint(previewBreakpoint === value ? null : value);\n            }}\n          />\n        </Box>\n        <PreviewContainer\n          breakpoint={previewBreakpoint}\n          singleColumn={isSingleURLs}\n        >\n          <Box\n            sx={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              gap: 1,\n              mt: 3,\n              mb: isSingleURLs ? 6 : 4,\n            }}\n          >\n            {isSingleURLs ? (\n              <Typography\n                variant=\"h3\"\n                sx={{ fontWeight: \"normal\", color: \"secondary.active\" }}\n              >\n                <Trans id=\"controls.layout.singleURLs.publish\">\n                  Select the charts to publish separately. After proceeding to\n                  publish, the selected charts will be opened in individual\n                  tabs.\n                </Trans>\n              </Typography>\n            ) : (\n              <>\n                <Title\n                  text={state.layout.meta.title[locale]}\n                  onClick={() => {\n                    if (state.layout.activeField !== \"title\") {\n                      dispatch({\n                        type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n                        value: \"title\",\n                      });\n                    }\n                  }}\n                />\n                <Description\n                  text={state.layout.meta.description[locale]}\n                  onClick={() => {\n                    if (state.layout.activeField !== \"description\") {\n                      dispatch({\n                        type: \"LAYOUT_ACTIVE_FIELD_CHANGE\",\n                        value: \"description\",\n                      });\n                    }\n                  }}\n                />\n              </>\n            )}\n          </Box>\n          {/* We need to reset the key to prevent overwriting of the layout */}\n          <ChartPreview key={previewBreakpoint} dataSource={state.dataSource} />\n        </PreviewContainer>\n      </PanelBodyWrapper>\n      <ConfiguratorDrawer\n        anchor=\"left\"\n        open={!!state.layout.activeField}\n        hideBackdrop\n        onClose={handleClosePanel}\n      >\n        <div style={{ width: DRAWER_WIDTH }} data-testid=\"panel-drawer\">\n          {isAnnotatorField(state.layout.activeField) ? (\n            <LayoutAnnotatorSelector />\n          ) : (\n            <LayoutBlocksSelector />\n          )}\n        </div>\n      </ConfiguratorDrawer>\n    </PanelLayout>\n  );\n};\n\nconst PublishStep = () => {\n  const [state] = useConfiguratorState();\n\n  if (state.state !== \"PUBLISHING\") {\n    return null;\n  }\n\n  return (\n    <PanelLayout type=\"LM\">\n      <PanelBodyWrapper type=\"M\" sx={{ p: 6 }}>\n        <ChartPreview dataSource={state.dataSource} />\n      </PanelBodyWrapper>\n    </PanelLayout>\n  );\n};\n\nexport const Configurator = () => {\n  const { pathname } = useRouter();\n  const [configuratorState] = useConfiguratorState();\n  const isLoadingConfigureChartStep =\n    configuratorState.state === \"INITIAL\" && pathname === \"/create/[chartId]\";\n  const metadataPanelStore = useMemo(() => {\n    return createMetadataPanelStore();\n  }, []);\n\n  return isLoadingConfigureChartStep ? (\n    <LoadingConfigureChartStep />\n  ) : configuratorState.state === \"SELECTING_DATASET\" ? (\n    <SelectDatasetStep variant=\"page\" />\n  ) : configuratorState.state === \"INITIAL\" ? null : (\n    <InteractiveFiltersProvider chartConfigs={configuratorState.chartConfigs}>\n      {configuratorState.state === \"CONFIGURING_CHART\" && (\n        <MetadataPanelStoreContext.Provider value={metadataPanelStore}>\n          <ConfigureChartStep />\n        </MetadataPanelStoreContext.Provider>\n      )}\n      {configuratorState.state === \"LAYOUTING\" && <LayoutingStep />}\n      {configuratorState.state === \"PUBLISHING\" && <PublishStep />}\n    </InteractiveFiltersProvider>\n  );\n};\n\nconst LoadingConfigureChartStep = () => {\n  return (\n    <Box\n      sx={{\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        width: \"100%\",\n        height: `calc(100vh - ${HEADER_HEIGHT_CSS_VAR})`,\n      }}\n    >\n      <Loading delayMs={0} />\n    </Box>\n  );\n};\n","export * from \"./components/configurator\";\nexport * from \"./config-form\";\nexport * from \"../config-types\";\nexport * from \"./configurator-state\";\n","import produce from \"immer\";\nimport get from \"lodash/get\";\nimport { useEffect } from \"react\";\nimport { ChangeEvent } from \"react\";\n\nimport {\n  InteractiveDataFilterType,\n  InteractiveFiltersConfig,\n} from \"@/config-types\";\nimport { getChartConfig, useChartConfigFilters } from \"@/config-utils\";\nimport {\n  isConfiguring,\n  useConfiguratorState,\n} from \"@/configurator/configurator-state\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const useInteractiveFiltersToggle = () => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const onChange = useEvent((e: ChangeEvent<HTMLInputElement>) => {\n    if (chartConfig.interactiveFiltersConfig.legend) {\n      const newConfig = produce(\n        chartConfig.interactiveFiltersConfig,\n        (draft) => {\n          draft.legend.active = e.currentTarget.checked;\n        }\n      );\n\n      dispatch({\n        type: \"INTERACTIVE_FILTER_CHANGED\",\n        value: newConfig,\n      });\n    }\n  });\n\n  const stateValue = get(chartConfig, \"interactiveFiltersConfig.legend.active\");\n  const checked = stateValue ? stateValue : false;\n\n  return {\n    name: \"legend\",\n    checked,\n    onChange,\n  };\n};\n\n/**\n * Toggles a single data filter\n */\nexport const useInteractiveDataFilterToggle = (\n  dimensionId: string,\n  filterType: InteractiveDataFilterType = \"single\"\n) => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const onChange = useEvent(() => {\n    const { interactiveFiltersConfig } = chartConfig;\n    const newIFConfig = toggleInteractiveFilterDataDimension(\n      interactiveFiltersConfig,\n      dimensionId,\n      undefined,\n      filterType\n    );\n\n    dispatch({\n      type: \"INTERACTIVE_FILTER_CHANGED\",\n      value: newIFConfig,\n    });\n  });\n  const checked =\n    chartConfig.interactiveFiltersConfig.dataFilters.componentIds.includes(\n      dimensionId\n    );\n\n  return {\n    name: \"dataFilters\",\n    checked,\n    onChange,\n  };\n};\n\n// Add or remove a dimension from the interactive  data filters dimensions list\nexport const toggleInteractiveFilterDataDimension = produce(\n  (\n    config: InteractiveFiltersConfig,\n    id: string,\n    newValue?: boolean,\n    filterType?: InteractiveDataFilterType\n  ): InteractiveFiltersConfig => {\n    const currentComponentIds = config.dataFilters.componentIds;\n    const shouldAdd =\n      newValue === undefined ? !currentComponentIds.includes(id) : newValue;\n    const newComponentIds = shouldAdd\n      ? [...currentComponentIds, id]\n      : config.dataFilters.componentIds.filter((d) => d !== id);\n\n    const newDefaultValueOverrides = {\n      ...config.dataFilters.defaultValueOverrides,\n    };\n\n    if (!shouldAdd) {\n      delete newDefaultValueOverrides[id];\n    }\n\n    const newFilterTypes = { ...config.dataFilters.filterTypes };\n    if (!shouldAdd) {\n      delete newFilterTypes[id];\n    } else if (filterType) {\n      newFilterTypes[id] = filterType;\n    }\n\n    const newDataFilters: NonNullable<InteractiveFiltersConfig>[\"dataFilters\"] =\n      {\n        ...config.dataFilters,\n        componentIds: newComponentIds,\n        defaultValueOverrides: newDefaultValueOverrides,\n        filterTypes: newFilterTypes,\n      };\n    newDataFilters.active = newComponentIds.length > 0;\n\n    return {\n      ...config,\n      dataFilters: newDataFilters,\n    };\n  }\n);\n\n/**\n * Toggles a time range filter\n */\nexport const useInteractiveTimeRangeToggle = () => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const toggle = useEvent(() => {\n    const { interactiveFiltersConfig } = chartConfig;\n    const newIFConfig = toggleInteractiveTimeRangeFilter(\n      interactiveFiltersConfig\n    );\n\n    dispatch({\n      type: \"INTERACTIVE_FILTER_CHANGED\",\n      value: newIFConfig,\n    });\n  });\n  const checked = chartConfig.interactiveFiltersConfig.timeRange.active;\n\n  return { checked, toggle };\n};\n\nconst toggleInteractiveTimeRangeFilter = (config: InteractiveFiltersConfig) => {\n  if (!config?.timeRange) {\n    return config;\n  }\n\n  const newTimeRange = {\n    ...config.timeRange,\n    active: !config.timeRange.active,\n  };\n\n  return { ...config, timeRange: newTimeRange };\n};\n\nexport const useDefaultValueOverride = (dimensionId: string) => {\n  const [state, dispatch] = useConfiguratorState(isConfiguring);\n  const chartConfig = getChartConfig(state);\n  const filters = useChartConfigFilters(chartConfig);\n  const currentValue =\n    chartConfig.interactiveFiltersConfig.dataFilters.defaultValueOverrides[\n      dimensionId\n    ] ?? [];\n\n  const onChange = useEvent((newValue: string[]) => {\n    const newConfig = produce(chartConfig.interactiveFiltersConfig, (draft) => {\n      if (newValue.length === 0) {\n        delete draft.dataFilters.defaultValueOverrides[dimensionId];\n      } else {\n        draft.dataFilters.defaultValueOverrides[dimensionId] = newValue;\n      }\n    });\n\n    dispatch({\n      type: \"INTERACTIVE_FILTER_CHANGED\",\n      value: newConfig,\n    });\n  });\n\n  useEffect(() => {\n    const f = filters[dimensionId];\n    const override =\n      chartConfig.interactiveFiltersConfig.dataFilters.defaultValueOverrides[\n        dimensionId\n      ];\n\n    if (f?.type === \"multi\" && override && Array.isArray(override)) {\n      const invalidValues = override.filter((v) => !f.values[v]);\n\n      if (invalidValues.length > 0) {\n        const validValues = override.filter((v) => f.values[v]);\n        const newConfig = produce(\n          chartConfig.interactiveFiltersConfig,\n          (draft) => {\n            if (validValues.length > 0) {\n              draft.dataFilters.defaultValueOverrides[dimensionId] =\n                validValues;\n            } else {\n              delete draft.dataFilters.defaultValueOverrides[dimensionId];\n            }\n          }\n        );\n        dispatch({\n          type: \"INTERACTIVE_FILTER_CHANGED\",\n          value: newConfig,\n        });\n      }\n    }\n  }, [chartConfig.interactiveFiltersConfig, filters, dimensionId, dispatch]);\n\n  return {\n    value: currentValue,\n    onChange,\n  };\n};\n","import { ascending } from \"d3-array\";\n\nimport { Component } from \"@/domain/data\";\n\nexport const getSortedComponents = (components: Component[]) => {\n  return [...components].sort((a, b) => {\n    return ascending(a.order ?? Infinity, b.order ?? Infinity);\n  });\n};\n","import { ObservationValue } from \"@/domain/data\";\n\n/** We can pin some filters' values to max value dynamically, so that when a new\n * value is added to the dataset, it will be automatically used as default filter\n * value for published charts.\n */\nexport const VISUALIZE_MOST_RECENT_VALUE = \"VISUALIZE_MOST_RECENT_VALUE\";\n\n/** Checks if a given filter value is supposed to be dynamiaclly pinned to max\n * value.\n */\nexport const isMostRecentValue = (\n  value: ObservationValue\n): value is \"VISUALIZE_MOST_RECENT_VALUE\" => {\n  return value === VISUALIZE_MOST_RECENT_VALUE;\n};\n","import { useCallback } from \"react\";\n\nimport { ParsedConfigWithViewCount } from \"@/db/config\";\nimport {\n  fetchChartConfig,\n  fetchChartConfigs,\n  fetchChartViewCount,\n} from \"@/utils/chart-config/api\";\nimport { useFetchData, UseFetchDataOptions } from \"@/utils/use-fetch-data\";\n\nexport const userConfigsKey = [\"userConfigs\"];\nconst userConfigKey = (t: string) => [\"userConfigs\", t];\n\nexport const useUserConfigs = (\n  options?: UseFetchDataOptions<ParsedConfigWithViewCount[]>\n) => {\n  const queryFn = useCallback(async () => {\n    const configs = await fetchChartConfigs();\n\n    const configsWithViewCount = await Promise.all(\n      configs.map(async (config) => {\n        return {\n          ...config,\n          viewCount: await fetchChartViewCount(config.key),\n        };\n      })\n    );\n\n    return configsWithViewCount;\n  }, []);\n\n  const result = useFetchData({\n    queryKey: userConfigsKey,\n    queryFn,\n    options,\n  });\n\n  return result;\n};\n\nexport const useUserConfig = (\n  chartId: string | undefined,\n  options?: UseFetchDataOptions\n) => {\n  const queryFn = useCallback(async () => {\n    const [config, viewCount] = await Promise.all([\n      fetchChartConfig(chartId!),\n      fetchChartViewCount(chartId!),\n    ]);\n\n    if (!config) {\n      throw new Error(\"Config not found\");\n    }\n\n    return {\n      ...config,\n      viewCount,\n    };\n  }, [chartId]);\n\n  const result = useFetchData({\n    queryKey: userConfigKey(chartId!),\n    queryFn,\n    options: {\n      pause: !chartId,\n      ...options,\n    },\n  });\n\n  return result;\n};\n","import { format } from \"d3-format\";\nimport { NumberValue } from \"d3-scale\";\nimport { timeDay, timeHour, timeMinute, timeMonth, timeYear } from \"d3-time\";\nimport { timeParse } from \"d3-time-format\";\nimport keyBy from \"lodash/keyBy\";\nimport memoize from \"lodash/memoize\";\nimport { useMemo } from \"react\";\n\nimport { parseDate } from \"@/configurator/components/ui-helpers\";\nimport {\n  Component,\n  isNumericalMeasure,\n  isTemporalDimension,\n  NumericalMeasure,\n  TemporalDimension,\n  TemporalEntityDimension,\n} from \"@/domain/data\";\nimport { TimeUnit } from \"@/graphql/query-hooks\";\nimport { getD3FormatLocale, getD3TimeFormatLocale } from \"@/locales/locales\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nconst DIMENSION_VALUE_UNDEFINED = \"https://cube.link/Undefined\";\nconst NO_AVAILABLE_VALUE_RETURN_REPLACEMENT = \"\";\n\nconst isNamedNodeDimension = (d: Component) => {\n  const first = d.values?.[0];\n  return first && first.label !== first.value;\n};\n\nconst isDataCubeNamedNodeDimension = (d: Component) => {\n  return isNamedNodeDimension(d as Component);\n};\n\nconst namedNodeFormatter = (d: Component) => {\n  const valuesByIri = keyBy(d.values, (x) => x.value);\n  return (v: string) => {\n    return valuesByIri[v]?.label || v;\n  };\n};\n\nconst currencyFormatter = (d: NumericalMeasure) => {\n  const formatLocale = getD3FormatLocale();\n  const minDecimals = d.resolution ?? d.currencyExponent ?? 2;\n  const maxDecimals = 8;\n  const baseFormatter = formatLocale.format(`,.${maxDecimals}f`);\n  return (v: number) => {\n    const formatted = baseFormatter(v);\n    const l = formatted.length;\n\n    // TODO Decimal separator should be based on locale\n    const dot = formatted.indexOf(\".\");\n\n    let lastSignificantIndex = formatted.length - maxDecimals + minDecimals - 1;\n    for (let i = l - maxDecimals + minDecimals; i < l; i++) {\n      if (formatted[i] !== \"0\") {\n        lastSignificantIndex = i;\n      }\n    }\n    return formatted.substring(\n      0,\n      lastSignificantIndex +\n        (minDecimals === 0 || dot === lastSignificantIndex ? 0 : 1)\n    );\n  };\n};\n\nexport const getFormattersForLocale = memoize((locale) => {\n  const { format } = getD3TimeFormatLocale(locale);\n  return {\n    empty: () => \"-\",\n    second: format(\"%d.%m.%Y %H:%M:%S\"),\n    minute: format(\"%d.%m.%Y %H:%M\"),\n    hour: format(\"%d.%m.%Y %H:%M\"),\n    day: format(\"%d.%m.%Y\"),\n    month: format(\"%m.%Y\"),\n    year: format(\"%Y\"),\n  };\n});\n\nconst useLocalFormatters = () => {\n  const locale = useLocale();\n  return getFormattersForLocale(locale);\n};\n\nexport const dateFormatterFromDimension = (\n  dim: TemporalDimension | TemporalEntityDimension,\n  localFormatters: LocalDateFormatters,\n  formatDateAuto: (d: Date | string | null) => string\n) => {\n  if (\n    dim.timeFormat &&\n    dim.timeUnit &&\n    localFormatters[dim.timeUnit.toLowerCase() as keyof typeof localFormatters]\n  ) {\n    const formatter =\n      localFormatters[\n        dim.timeUnit.toLowerCase() as keyof typeof localFormatters\n      ];\n    const parser = timeParse(dim.timeFormat);\n    const timezoneParser = timeParse(`${dim.timeFormat}%Z`);\n\n    return (d: string | null) => {\n      if (!d) {\n        return localFormatters.empty();\n      }\n\n      const parsed = parser(d) ?? timezoneParser(d);\n\n      return parsed ? formatter(parsed) : localFormatters.empty();\n    };\n  }\n\n  return formatDateAuto;\n};\n\ntype Formatter = (x: string) => string;\n\nexport const formatIdentity = (x: string | number | Date | null) => {\n  return x !== DIMENSION_VALUE_UNDEFINED && x !== null\n    ? `${x}`\n    : NO_AVAILABLE_VALUE_RETURN_REPLACEMENT;\n};\n\nconst decimalFormatter = (dim: NumericalMeasure, formatNumber: Formatter) => {\n  const res = dim.resolution;\n  const hasResolution = typeof res === \"number\";\n  const formatting = `${hasResolution ? `.${res}` : \"\"}~e`;\n  const expFormatter = format(formatting);\n  return (v: string) => {\n    const p = parseFloat(v);\n    const a = Math.abs(p);\n    if (p === 0) {\n      return formatNumber(v);\n    } else if (a > 999_999_999 || a < 0.0001) {\n      return expFormatter(p);\n    } else {\n      return v;\n    }\n  };\n};\n\nconst getDimensionFormatters = ({\n  components,\n  formatNumber,\n  formatDateAuto,\n  dateFormatters,\n}: {\n  components: Component[];\n  formatNumber: (d: number | string) => string;\n  formatDateAuto: (d: Date | string | null) => string;\n  dateFormatters: LocalDateFormatters;\n}) => {\n  return Object.fromEntries(\n    components.map((d) => {\n      let formatter: (s: any) => string;\n      if (isNumericalMeasure(d)) {\n        if (d.isCurrency) {\n          formatter = currencyFormatter(d);\n        } else if (d.isDecimal) {\n          formatter = decimalFormatter(d, formatNumber);\n        } else {\n          formatter = formatNumber;\n        }\n      } else if (isTemporalDimension(d)) {\n        formatter = dateFormatterFromDimension(\n          d,\n          dateFormatters,\n          formatDateAuto\n        );\n      } else if (isDataCubeNamedNodeDimension(d)) {\n        formatter = namedNodeFormatter(d);\n      } else if (\n        // It makes no sense to format numeric values of ordinal dimensions\n        // as numbers.\n        d.isNumerical &&\n        d.__typename !== \"OrdinalDimension\" &&\n        d.__typename !== \"OrdinalMeasure\"\n      ) {\n        formatter = formatNumber;\n      } else {\n        formatter = formatIdentity;\n      }\n\n      return [d.id, formatter];\n    })\n  );\n};\n\nexport const useDimensionFormatters = (components: Component[]) => {\n  const formatNumber = useFormatNumber() as unknown as (\n    d: number | string\n  ) => string;\n  const formatDateAuto = useFormatFullDateAuto();\n  const dateFormatters = useLocalFormatters();\n\n  return useMemo(() => {\n    return getDimensionFormatters({\n      components,\n      formatNumber,\n      formatDateAuto,\n      dateFormatters,\n    });\n  }, [components, formatNumber, formatDateAuto, dateFormatters]);\n};\n\nexport const getFormatFullDateAuto = (formatters: LocalDateFormatters) => {\n  return (dateInput: Date | string | null) => {\n    if (dateInput === null) {\n      return formatters.empty();\n    }\n\n    const date =\n      typeof dateInput === \"string\" ? parseDate(dateInput) : dateInput;\n\n    return (\n      timeMinute(date) < date\n        ? formatters.second\n        : timeHour(date) < date\n          ? formatters.minute\n          : timeDay(date) < date\n            ? formatters.hour\n            : timeMonth(date) < date\n              ? formatters.day\n              : timeYear(date) < date\n                ? formatters.month\n                : formatters.year\n    )(date);\n  };\n};\n\ntype LocalDateFormatters = ReturnType<typeof getFormattersForLocale>;\n\n/**\n * Formats dates automatically based on their precision in LONG form.\n *\n * Use wherever dates are displayed without being in context of other dates (e.g. in tooltips)\n */\nexport const useFormatFullDateAuto = () => {\n  const formatters = useLocalFormatters();\n\n  return useMemo(() => {\n    return getFormatFullDateAuto(formatters);\n  }, [formatters]);\n};\n\n/**\n * Parses and formats ISO *dates* of form 2002-01-01.\n */\nexport const useFormatDate = () => {\n  const locale = useLocale();\n  const formatter = useMemo(() => {\n    const { format, parse } = getD3TimeFormatLocale(locale);\n\n    const parseDate = parse(\"%Y-%m-%d\");\n    const formatDate = format(\"%d.%m.%Y\");\n\n    return (date: string) => {\n      const d = parseDate(date);\n      return d ? formatDate(d) : null;\n    };\n  }, [locale]);\n\n  return formatter;\n};\n\n/**\n * Parses and formats ISO *dates* of form 2002-01-01.\n */\nexport const useTimeFormatLocale = () => {\n  const locale = useLocale();\n  const formatter = useMemo(() => {\n    return getD3TimeFormatLocale(locale);\n  }, [locale]);\n\n  return formatter;\n};\n\nconst timeFormats = new Map<TimeUnit, string>([\n  [TimeUnit.Year, \"%Y\"],\n  [TimeUnit.Month, \"%b %Y\"],\n  [TimeUnit.Week, \"%d.%m.%Y\"],\n  [TimeUnit.Day, \"%d.%m.%Y\"],\n  [TimeUnit.Hour, \"%d.%m.%Y %H:%M\"],\n  [TimeUnit.Minute, \"%d.%m.%Y %H:%M\"],\n  [TimeUnit.Second, \"%d.%m.%Y %H:%M:%S\"],\n]);\n\nexport const useTimeFormatUnit = () => {\n  const locale = useLocale();\n  const formatter = useMemo(() => {\n    const { format } = getD3TimeFormatLocale(locale);\n\n    return (dateInput: Date | string, timeUnit: TimeUnit) => {\n      const date =\n        typeof dateInput === \"string\" ? parseDate(dateInput) : dateInput;\n\n      const timeFormat =\n        timeFormats.get(timeUnit) ?? timeFormats.get(TimeUnit.Day)!;\n      const f = format(timeFormat);\n\n      return f(date);\n    };\n  }, [locale]);\n\n  return formatter;\n};\n\nconst getFormatNumber = (props?: { decimals: number | \"auto\" }) => {\n  const { decimals = 2 } = props ?? {};\n  const { format } = getD3FormatLocale();\n  // Only valid for up to 6 decimals!\n  // See https://262.ecma-international.org/6.0/#sec-number.prototype.toprecision, 12c.\n  const specifier = decimals === \"auto\" ? \",~f\" : `,.${decimals}~f`;\n  const formatter = format(specifier);\n\n  return (d: NumberValue | null | undefined) => {\n    if (d === null || d === undefined) {\n      return \"\";\n    }\n    return `${formatter(d)}`;\n  };\n};\n\nexport const useFormatNumber = (props?: { decimals: number | \"auto\" }) => {\n  return useMemo(() => {\n    return getFormatNumber(props);\n  }, [props]);\n};\n\nexport const useFormatInteger = () => {\n  return useMemo(() => {\n    const { format } = getD3FormatLocale();\n    const formatter = format(\",.0~f\");\n    return (x: NumberValue | null | undefined) => {\n      if (x === null || x === undefined) {\n        return \"\";\n      }\n      return formatter(x);\n    };\n  }, []);\n};\n\n/**\n * Formats dates automatically based on their precision in SHORT form.\n *\n * Use wherever dates are displayed in context of other dates (e.g. on time axes)\n */\nexport const useFormatShortDateAuto = () => {\n  const locale = useLocale();\n  const formatter = useMemo(() => {\n    const { format } = getD3TimeFormatLocale(locale);\n\n    const formatSecond = format(\":%S\");\n    const formatMinute = format(\"%H:%M\");\n    const formatHour = format(\"%H\");\n    const formatDay = format(\"%d\");\n    const formatMonth = format(\"%b\");\n    const formatYear = format(\"%Y\");\n\n    return (date: Date) => {\n      return (\n        timeMinute(date) < date\n          ? formatSecond\n          : timeHour(date) < date\n            ? formatMinute\n            : timeDay(date) < date\n              ? formatHour\n              : timeMonth(date) < date\n                ? formatDay\n                : timeYear(date) < date\n                  ? formatMonth\n                  : formatYear\n      )(date);\n    };\n  }, [locale]);\n\n  return formatter;\n};\n\nexport const formatNumberWithUnit = (\n  nb: number | null,\n  formatter: (n: number) => string,\n  unit?: string | null\n) => {\n  if (nb === null || nb === undefined) {\n    return \"-\";\n  }\n  return `${formatter(nb)}${unit ? ` ${unit}` : \"\"}`;\n};\n","import { SOURCES_BY_URL } from \"@/domain/data-source/constants\";\n\n/** As Lindas supports caching requests per given id, we can utilize this function\n * to query endpoint that will cache the results per given cube iri.\n *\n * This means that if we query the same endpoint with the same cube iri, we will\n * get the cached results, unless the cache is invalidated.\n *\n * If cubeIri is not provided, we default to a general cached endpoint, which\n * has much higher cache invalidation time (two minutes as of writing this comment).\n */\nexport const getMaybeCachedSparqlUrl = ({\n  endpointUrl,\n  cubeIri,\n}: {\n  endpointUrl: string;\n  cubeIri: string | undefined;\n}) => {\n  if (SOURCES_BY_URL[endpointUrl]?.supportsCachingPerCubeIri && cubeIri) {\n    return `${endpointUrl}/${cubeIri}`;\n  }\n\n  return endpointUrl;\n};\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { Client, useClient } from \"urql\";\n\nimport {\n  ChartConfig,\n  ConfiguratorState,\n  ConversionUnit,\n  hasChartConfigs,\n} from \"@/configurator\";\nimport {\n  DataCubeComponents,\n  DataCubeMetadata,\n  DataCubesObservations,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { Locale } from \"@/locales/locales\";\nimport { LimitSingle, LimitTimeRange, LimitValueRange } from \"@/rdf/limits\";\nimport { assert } from \"@/utils/assert\";\n\nimport { joinDimensions, mergeObservations } from \"./join\";\nimport {\n  DataCubeComponentFilter,\n  DataCubeComponentsDocument,\n  DataCubeComponentsQuery,\n  DataCubeComponentsQueryVariables,\n  DataCubeComponentTermsetsDocument,\n  DataCubeComponentTermsetsQuery,\n  DataCubeComponentTermsetsQueryVariables,\n  DataCubeMetadataDocument,\n  DataCubeMetadataFilter,\n  DataCubeMetadataQuery,\n  DataCubeMetadataQueryVariables,\n  DataCubeObservationFilter,\n  DataCubeObservationsDocument,\n  DataCubeObservationsQuery,\n  DataCubeObservationsQueryVariables,\n} from \"./query-hooks\";\n\nconst queryResultsCache = new Map<string, any>();\n\nconst useQueryKey = (options: object) => {\n  return useMemo(() => {\n    return JSON.stringify(options);\n  }, [options]);\n};\n\nexport const makeUseQuery =\n  <\n    T extends {\n      chartConfig?: ChartConfig;\n      variables: object & { locale: string };\n      pause?: boolean;\n    },\n    V,\n  >({\n    fetch,\n    check,\n    transform,\n  }: {\n    check?: (variables: T[\"variables\"]) => void;\n    fetch: (\n      client: Client,\n      options: T[\"variables\"],\n      onFetching?: () => void\n    ) => Promise<{\n      data?: V;\n      error?: Error;\n      fetching: boolean;\n    }>;\n    transform?: (\n      data: { data?: V | null; error?: Error; fetching: boolean },\n      options: {\n        locale: string;\n        conversionUnitsByComponentId: ChartConfig[\"conversionUnitsByComponentId\"];\n      }\n    ) => { data?: V | null; error?: Error; fetching: boolean };\n  }) =>\n  (options: T & { keepPreviousData?: boolean }) => {\n    const client = useClient();\n    const { keepPreviousData } = options;\n    const queryKey = useQueryKey(options);\n    const cachedResult = queryResultsCache.get(queryKey);\n    const [rawResult, setRawResult] = useState<{\n      queryKey: string | null;\n      data?: V | null;\n      error?: Error;\n      fetching: boolean;\n    }>(\n      cachedResult || { fetching: !options.pause, queryKey: null, data: null }\n    );\n    const currentQueryRef = useRef<string>();\n\n    if (!options.pause && check) {\n      check(options.variables);\n    }\n\n    const executeQuery = useCallback(\n      async (options: { variables: T[\"variables\"] }) => {\n        const currentQuery = queryKey;\n        currentQueryRef.current = currentQuery;\n\n        setRawResult((prev) => ({\n          ...prev,\n          fetching: false,\n          data:\n            prev.queryKey === queryKey || keepPreviousData ? prev.data : null,\n          queryKey,\n        }));\n\n        if (check) {\n          check(options.variables);\n        }\n\n        const result = await fetch(client, options.variables, () => {\n          if (currentQueryRef.current === currentQuery) {\n            setRawResult((prev) => ({\n              ...prev,\n              fetching: true,\n            }));\n          }\n        });\n\n        if (currentQueryRef.current === currentQuery) {\n          const finalResult = { ...result, queryKey };\n          queryResultsCache.set(queryKey, finalResult);\n          setRawResult(finalResult);\n        }\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [queryKey]\n    );\n\n    useEffect(() => {\n      if (options.pause) {\n        return;\n      }\n\n      executeQuery(options);\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [queryKey, options.pause]);\n\n    const result = useMemo(() => {\n      if (!transform || !options.chartConfig?.conversionUnitsByComponentId) {\n        return rawResult;\n      }\n\n      return transform(rawResult, {\n        locale: options.variables.locale,\n        conversionUnitsByComponentId:\n          options.chartConfig.conversionUnitsByComponentId,\n      });\n    }, [\n      rawResult,\n      options.variables.locale,\n      options.chartConfig?.conversionUnitsByComponentId,\n    ]);\n\n    return [result, executeQuery] as const;\n  };\n\ntype DataCubesMetadataOptions = {\n  variables: Omit<DataCubeMetadataQueryVariables, \"cubeFilter\"> & {\n    cubeFilters: DataCubeMetadataFilter[];\n  };\n  pause?: boolean;\n};\n\ntype DataCubesMetadataData = {\n  dataCubesMetadata: DataCubeMetadata[];\n};\n\nconst executeDataCubesMetadataQuery = async (\n  client: Client,\n  variables: DataCubesMetadataOptions[\"variables\"],\n  /** Callback triggered when data fetching starts (cache miss). */\n  onFetching?: () => void\n) => {\n  const { locale, sourceType, sourceUrl, cubeFilters } = variables;\n\n  const queries = await Promise.all(\n    cubeFilters.map((cubeFilter) => {\n      const cubeVariables = { locale, sourceType, sourceUrl, cubeFilter };\n      const cached = client.readQuery<\n        DataCubeMetadataQuery,\n        DataCubeMetadataQueryVariables\n      >(DataCubeMetadataDocument, cubeVariables);\n\n      if (cached) {\n        return Promise.resolve(cached);\n      }\n\n      onFetching?.();\n\n      return client\n        .query<\n          DataCubeMetadataQuery,\n          DataCubeMetadataQueryVariables\n        >(DataCubeMetadataDocument, cubeVariables)\n        .toPromise();\n    })\n  );\n  const error = queries.find((q) => q.error)?.error;\n  const fetching = !error && queries.some((q) => !q.data);\n\n  return {\n    data:\n      error || fetching\n        ? undefined\n        : { dataCubesMetadata: queries.map((q) => q.data!.dataCubeMetadata) },\n    error,\n    fetching,\n  };\n};\n\nexport const useDataCubesMetadataQuery = makeUseQuery<\n  DataCubesMetadataOptions,\n  DataCubesMetadataData\n>({\n  fetch: executeDataCubesMetadataQuery,\n});\n\nexport type DataCubesComponentsOptions = {\n  variables: Omit<DataCubeComponentsQueryVariables, \"cubeFilter\"> & {\n    cubeFilters: DataCubeComponentFilter[];\n  };\n  pause?: boolean;\n};\n\ntype DataCubesComponentsData = {\n  dataCubesComponents: DataCubeComponents;\n};\n\nexport const executeDataCubesComponentsQuery = async (\n  client: Client,\n  variables: DataCubesComponentsOptions[\"variables\"],\n  /** Callback triggered when data fetching starts (cache miss). */\n  onFetching?: () => void\n) => {\n  const { locale, sourceType, sourceUrl, cubeFilters } = variables;\n  const joinBy = Object.fromEntries(\n    cubeFilters\n      .map((x) => {\n        return [x.iri, x.joinBy];\n      })\n      .filter(truthy)\n  );\n  const queries = await Promise.all(\n    cubeFilters.map((cubeFilter) => {\n      const cubeVariables = {\n        locale,\n        sourceType,\n        sourceUrl,\n        cubeFilter,\n      };\n\n      const cached = client.readQuery<\n        DataCubeComponentsQuery,\n        DataCubeComponentsQueryVariables\n      >(DataCubeComponentsDocument, cubeVariables);\n\n      if (cached) {\n        return Promise.resolve(cached);\n      }\n\n      onFetching?.();\n\n      return client\n        .query<\n          DataCubeComponentsQuery,\n          DataCubeComponentsQueryVariables\n        >(DataCubeComponentsDocument, cubeVariables)\n        .toPromise();\n    })\n  );\n\n  const error = queries.find((q) => q.error)?.error;\n  const fetching = !error && queries.some((q) => !q.data);\n\n  if (error || fetching) {\n    console.log(\"Error or fetching\", { error, fetching });\n    return {\n      data: undefined,\n      error,\n      fetching,\n    };\n  }\n\n  const { dimensions: firstDimensions = [], measures: firstMeasures = [] } =\n    queries[0].data?.dataCubeComponents || {};\n  assert(firstDimensions !== undefined, \"Undefined dimensions\");\n  assert(firstMeasures !== undefined, \"Undefined measures\");\n\n  return {\n    data:\n      queries.length === 1\n        ? {\n            dataCubesComponents: {\n              dimensions: firstDimensions,\n              measures: firstMeasures,\n            },\n          }\n        : {\n            dataCubesComponents: {\n              dimensions: joinDimensions({\n                joinBy,\n                dimensions: queries\n                  .map((q) => {\n                    const dataCubeComponents = q.data?.dataCubeComponents;\n                    assert(\n                      dataCubeComponents !== undefined,\n                      \"Undefined dataCubeComponents\"\n                    );\n                    return dataCubeComponents.dimensions;\n                  })\n                  .filter(truthy)\n                  .flat(),\n              }),\n              measures: queries.flatMap((q) => {\n                const measures = q.data?.dataCubeComponents.measures;\n                assert(measures !== undefined, \"Undefined measures\");\n                return measures;\n              }),\n            },\n          },\n    error,\n    fetching,\n  };\n};\n\n/** Fetches components/dimensions along with the values */\nexport const useDataCubesComponentsQuery = makeUseQuery<\n  DataCubesComponentsOptions & { chartConfig: ChartConfig },\n  DataCubesComponentsData\n>({\n  fetch: executeDataCubesComponentsQuery,\n  transform: transformDataCubesComponents,\n});\n\n/**\n * Transforms the data from the data cubes components query, converting\n * the values to the overridden unit.\n *\n * @param data - The data from the data cubes components query.\n * @param options - The options for the data cubes components query.\n * @returns The transformed data.\n */\nexport function transformDataCubesComponents(\n  data: {\n    data?: DataCubesComponentsData | null;\n    error?: Error;\n    fetching: boolean;\n  },\n  options: {\n    locale: string;\n    conversionUnitsByComponentId: ChartConfig[\"conversionUnitsByComponentId\"];\n  }\n) {\n  const { locale, conversionUnitsByComponentId } = options;\n\n  if (\n    !data.data ||\n    !conversionUnitsByComponentId ||\n    Object.keys(conversionUnitsByComponentId).length === 0\n  ) {\n    return data;\n  }\n\n  return {\n    ...data,\n    data: {\n      ...data.data,\n      dataCubesComponents: {\n        ...data.data.dataCubesComponents,\n        measures: data.data.dataCubesComponents.measures.map((measure) => {\n          const conversionUnit = conversionUnitsByComponentId[measure.id];\n\n          if (!conversionUnit) {\n            return measure;\n          }\n\n          return {\n            ...measure,\n            unit: conversionUnit.labels[locale as Locale] ?? measure.unit,\n            originalUnit: measure.unit,\n            limits: measure.limits.map((limit) => {\n              switch (limit.type) {\n                case \"single\":\n                  const singleLimit: LimitSingle = {\n                    ...limit,\n                    value: convertValue(limit.value, conversionUnit),\n                  };\n\n                  return singleLimit;\n                case \"value-range\":\n                  const verticalRangeLimit: LimitValueRange = {\n                    ...limit,\n                    min: convertValue(limit.min, conversionUnit),\n                    max: convertValue(limit.max, conversionUnit),\n                  };\n\n                  return verticalRangeLimit;\n                case \"time-range\":\n                  const horizontalRangeLimit: LimitTimeRange = {\n                    ...limit,\n                    value: convertValue(limit.value, conversionUnit),\n                  };\n\n                  return horizontalRangeLimit;\n                default:\n                  const _exhaustiveCheck: never = limit;\n                  return _exhaustiveCheck;\n              }\n            }),\n            values: measure.values.map((value) => {\n              if (typeof value.value === \"number\") {\n                return {\n                  ...value,\n                  value: convertValue(value.value, conversionUnit),\n                };\n              }\n\n              if (typeof value.value === \"string\") {\n                return {\n                  ...value,\n                  value: convertValue(Number(value.value), conversionUnit),\n                };\n              }\n\n              return value;\n            }),\n          };\n        }),\n      },\n    },\n  };\n}\n\nconst convertValue = (value: number, conversionUnit: ConversionUnit) => {\n  return value * conversionUnit.multiplier;\n};\n\nexport type DataCubesObservationsOptions = {\n  variables: Omit<DataCubeComponentsQueryVariables, \"cubeFilter\"> & {\n    cubeFilters: DataCubeObservationFilter[];\n  };\n  pause?: boolean;\n};\n\ntype DataCubesObservationsData = {\n  dataCubesObservations: DataCubesObservations;\n};\n\nexport const executeDataCubesObservationsQuery = async (\n  client: Client,\n  variables: DataCubesObservationsOptions[\"variables\"],\n  /** Callback triggered when data fetching starts (cache miss). */\n  onFetching?: () => void\n) => {\n  const { locale, sourceType, sourceUrl, cubeFilters } = variables;\n\n  const queries = await Promise.all(\n    cubeFilters.map((cubeFilter) => {\n      const cubeVariables = { locale, sourceType, sourceUrl, cubeFilter };\n\n      const cached = client.readQuery<\n        DataCubeObservationsQuery,\n        DataCubeObservationsQueryVariables\n      >(DataCubeObservationsDocument, cubeVariables);\n\n      if (cached) {\n        return Promise.resolve(cached);\n      }\n\n      onFetching?.();\n\n      // If not in cache, execute the query\n      return client\n        .query<\n          DataCubeObservationsQuery,\n          DataCubeObservationsQueryVariables\n        >(DataCubeObservationsDocument, cubeVariables)\n        .toPromise();\n    })\n  );\n\n  const error = queries.find((q) => q.error)?.error;\n  const fetching = !error && queries.some((q) => !q.data);\n\n  if (error || fetching) {\n    return {\n      data: undefined,\n      error,\n      fetching,\n    };\n  }\n\n  const observations =\n    // If we are fetching data from multiple cubes, we need to merge them into one\n    queries.length > 1\n      ? mergeObservations(queries)\n      : // If we are fetching data from a single cube, we can just return the data\n        queries[0].data?.dataCubeObservations?.data!;\n\n  return {\n    data: {\n      dataCubesObservations: {\n        data: observations,\n        sparqlEditorUrls: queries.flatMap((q) => ({\n          cubeIri: q.operation.variables?.cubeFilter.iri!,\n          url: q.data?.dataCubeObservations?.sparqlEditorUrl!,\n        })),\n      },\n    },\n    error,\n    fetching,\n  };\n};\n\nexport const useDataCubesObservationsQuery = makeUseQuery<\n  DataCubesObservationsOptions & { chartConfig: ChartConfig },\n  DataCubesObservationsData\n>({\n  fetch: executeDataCubesObservationsQuery,\n  transform: transformDataCubesObservations,\n});\n\n/**\n * Transforms the data from the data cubes observations query, converting\n * the values to the overridden unit.\n *\n * @param data - The data from the data cubes observations query.\n * @param options - The options for the data cubes observations query.\n * @returns The transformed data.\n */\nexport function transformDataCubesObservations(\n  data: {\n    data?: DataCubesObservationsData | null;\n    error?: Error;\n    fetching: boolean;\n  },\n  options: {\n    locale: string;\n    conversionUnitsByComponentId: ChartConfig[\"conversionUnitsByComponentId\"];\n  }\n) {\n  const { conversionUnitsByComponentId } = options;\n\n  if (\n    !data.data ||\n    !conversionUnitsByComponentId ||\n    Object.keys(conversionUnitsByComponentId).length === 0\n  ) {\n    return data;\n  }\n\n  return {\n    ...data,\n    data: {\n      dataCubesObservations: {\n        ...data.data.dataCubesObservations,\n        data: data.data.dataCubesObservations.data.map((observation) => {\n          const newObservation = { ...observation };\n\n          Object.entries(conversionUnitsByComponentId).forEach(\n            ([componentId, conversionUnit]) => {\n              if (componentId in newObservation) {\n                const value = newObservation[componentId];\n\n                if (typeof value === \"number\") {\n                  newObservation[componentId] = convertValue(\n                    value,\n                    conversionUnit\n                  );\n                } else if (typeof value === \"string\") {\n                  newObservation[componentId] = convertValue(\n                    Number(value),\n                    conversionUnit\n                  );\n                }\n              }\n            }\n          );\n\n          return newObservation;\n        }),\n      },\n    },\n  };\n}\n\ntype FetchAllUsedCubeComponentsOptions = {\n  state: ConfiguratorState;\n  locale: Locale;\n};\n\n/**\n * Fetches all cubes components in one go. Is useful in contexts where we deal\n * with all the cubes at once, for example the shared dashboard filters.\n */\nconst executeFetchAllUsedCubeComponents = async (\n  client: Client,\n  variables: FetchAllUsedCubeComponentsOptions\n) => {\n  const { state, locale } = variables;\n  const { dataSource } = state;\n  assert(hasChartConfigs(state), \"Expected state with chart configs\");\n\n  const cubeFilters: DataCubeComponentFilter[][] = state.chartConfigs.map(\n    (config) => {\n      return config.cubes.map((x) => ({\n        iri: x.iri,\n        joinBy: x.joinBy,\n        loadValues: true,\n      }));\n    }\n  );\n\n  // executeDataCubesComponentsQuery dedupes queries through urql cache\n  const dataCubesComponents = await Promise.all(\n    cubeFilters.map((cf) =>\n      executeDataCubesComponentsQuery(client, {\n        cubeFilters: cf,\n        locale,\n        sourceType: dataSource.type,\n        sourceUrl: dataSource.url,\n      })\n    )\n  );\n\n  return {\n    error: dataCubesComponents.find((x) => x.error)?.error,\n    fetching: dataCubesComponents.some((x) => x.fetching),\n    data: {\n      dataCubesComponents: {\n        dimensions: dataCubesComponents.flatMap(\n          (x) => x?.data?.dataCubesComponents.dimensions ?? []\n        ),\n        measures: dataCubesComponents.flatMap(\n          (x) => x?.data?.dataCubesComponents.measures ?? []\n        ),\n      },\n    },\n  };\n};\n\nexport const useConfigsCubeComponents = makeUseQuery<\n  {\n    variables: FetchAllUsedCubeComponentsOptions;\n    pause?: boolean | undefined;\n  },\n  Awaited<ReturnType<typeof executeFetchAllUsedCubeComponents>>[\"data\"]\n>({\n  fetch: executeFetchAllUsedCubeComponents,\n});\n\ntype DataCubesComponentTermsetsOptions = {\n  variables: Omit<DataCubeComponentTermsetsQueryVariables, \"cubeFilter\"> & {\n    cubeFilters: DataCubeObservationFilter[];\n  };\n  pause?: boolean;\n};\n\n/**\n * Fetches all cubes termsets in one go.\n */\nconst executeDataCubesTermsetsQuery = async (\n  client: Client,\n  variables: DataCubesComponentTermsetsOptions[\"variables\"],\n  /** Callback triggered when data fetching starts (cache miss). */\n  onFetching?: () => void\n) => {\n  const { locale, sourceType, sourceUrl, cubeFilters } = variables;\n\n  const queries = await Promise.all(\n    cubeFilters.map((cubeFilter) => {\n      const cubeVariables = { locale, sourceType, sourceUrl, cubeFilter };\n\n      // Try to read from cache first\n      const cached = client.readQuery<\n        DataCubeComponentTermsetsQuery,\n        DataCubeComponentTermsetsQueryVariables\n      >(DataCubeComponentTermsetsDocument, cubeVariables);\n\n      if (cached) {\n        return Promise.resolve(cached);\n      }\n\n      onFetching?.();\n\n      // If not in cache, execute the query\n      return client\n        .query<\n          DataCubeComponentTermsetsQuery,\n          DataCubeComponentTermsetsQueryVariables\n        >(DataCubeComponentTermsetsDocument, cubeVariables)\n        .toPromise();\n    })\n  );\n\n  const error = queries.find((q) => q.error)?.error;\n  const fetching = !error && queries.some((q) => !q.data);\n\n  if (error || fetching) {\n    return {\n      data: undefined,\n      error,\n      fetching,\n    };\n  }\n\n  const termsets =\n    // If we are fetching data from multiple cubes, we need to merge them into one\n    (\n      queries.length > 1\n        ? queries.map((q) => q.data?.dataCubeComponentTermsets).flat()\n        : // If we are fetching data from a single cube, we can just return the data\n          queries[0].data?.dataCubeComponentTermsets!\n    ).filter(truthy);\n\n  return {\n    data: {\n      dataCubeComponentTermsets: termsets,\n    },\n    error,\n    fetching,\n  };\n};\n\nexport const useDataCubesComponentTermsetsQuery = makeUseQuery<\n  DataCubesComponentTermsetsOptions,\n  Awaited<ReturnType<typeof executeDataCubesTermsetsQuery>>[\"data\"]\n>({\n  fetch: executeDataCubesTermsetsQuery,\n});\n","import { ascending } from \"d3-array\";\nimport groupBy from \"lodash/groupBy\";\nimport omit from \"lodash/omit\";\nimport uniq from \"lodash/uniq\";\nimport uniqBy from \"lodash/uniqBy\";\nimport { BaseOf, Brand } from \"ts-brand\";\nimport { OperationResult } from \"urql\";\n\nimport { ChartConfig, Cube } from \"@/config-types\";\nimport {\n  Dimension,\n  isJoinByComponent,\n  JoinByComponent,\n  Observation,\n  ObservationValue,\n} from \"@/domain/data\";\nimport { ComponentId } from \"@/graphql/make-component-id\";\nimport {\n  DataCubeComponentsQuery,\n  DataCubeObservationsQuery,\n  DataCubeObservationsQueryVariables,\n  Exact,\n} from \"@/graphql/query-hooks\";\nimport { assert } from \"@/utils/assert\";\n\nconst JOIN_BY_CUBE_IRI = \"joinBy\";\n\nconst keyJoiner = \"$/$/$/\";\nconst joinByPrefix = `joinBy__`;\n\nexport const mkJoinById = (index: number) => `${joinByPrefix}${index}`;\nexport const isJoinById = (id: string) => id.startsWith(joinByPrefix);\nexport const isJoinByCube = (cubeIri: string) => cubeIri === JOIN_BY_CUBE_IRI;\n\nconst getJoinByIdIndex = (joinById: string) => {\n  return Number(joinById.slice(joinByPrefix.length));\n};\n\nexport const getOriginalDimension = (dim: JoinByComponent, cube: Cube) => {\n  assert(isJoinByComponent(dim), \"Dimension should be a join by at this point\");\n  const originalId = dim.originalIds.find(\n    (o) => o.cubeIri === cube.iri\n  )?.dimensionId;\n\n  if (!originalId) {\n    console.warn(\n      \"Could not find original id for joinBy dimension\",\n      dim,\n      cube.iri\n    );\n  }\n\n  assert(!!originalId, \"Original id should have been found\");\n\n  return {\n    ...dim,\n    id: originalId,\n  };\n};\n\nconst dimensionValueSorter = (\n  a: Dimension[\"values\"][number],\n  b: Dimension[\"values\"][number]\n) =>\n  ascending(\n    a.position ?? a.value ?? undefined,\n    b.position ?? b.value ?? undefined\n  );\n\n/** Use to exclude joinBy dimensions when fetching dimensions, and create\n * a new joinBy dimension with values from all joinBy dimensions.\n */\nexport const joinDimensions = (options: {\n  dimensions: DataCubeComponentsQuery[\"dataCubeComponents\"][\"dimensions\"];\n  joinBy: VersionedJoinBy;\n}) => {\n  const joinByDimensions: (Dimension & { joinByIndex: undefined | number })[] =\n    [];\n  const dimensions: Dimension[] = [];\n\n  const { dimensions: fetchedDimensions, joinBy } = options;\n\n  const dimensionsWithJoinByIndex = fetchedDimensions.flatMap(\n    (d): (Dimension & { joinByIndex: number | undefined })[] => {\n      // Extracts out the joinBy dimensions from the fetched dimensions\n      if (isJoinByComponent(d)) {\n        const index = getJoinByIdIndex(d.id);\n        const label = d.label.split(\", \");\n        return d.originalIds.map(\n          (originalId, i) =>\n            ({\n              ...omit(d, [\"originalIds\"]),\n              originalIds: [],\n              dimensionId: originalId.dimensionId,\n              id: originalId.dimensionId,\n              label: label[i],\n              cubeIri: originalId.cubeIri,\n              joinByIndex: index!,\n\n              // Not sure why we have to do a type assertion here :-(\n            }) as Dimension & {\n              joinByIndex: number;\n            }\n        );\n      } else {\n        const cubeJoinBy = joinBy[d.cubeIri];\n        const joinByIndex = cubeJoinBy?.indexOf(d.id as ComponentId);\n        return [\n          {\n            ...d,\n            joinByIndex:\n              // Set it directly to undefined if === -1\n              joinByIndex !== undefined && joinByIndex > -1\n                ? joinByIndex\n                : undefined,\n          },\n        ];\n      }\n    }\n  );\n\n  const {\n    false: queryNormalDimensions = [],\n    true: queryJoinByDimensions = [],\n  } = groupBy(dimensionsWithJoinByIndex, (d) => d.joinByIndex !== undefined);\n\n  joinByDimensions.push(...queryJoinByDimensions);\n  dimensions.push(\n    ...queryNormalDimensions.map((x) => omit(x, [\"joinByIndex\"]) as Dimension)\n  );\n\n  if (joinByDimensions.length >= 1) {\n    for (const [index, joinedDimensions] of Object.entries(\n      groupBy(joinByDimensions, (d) => d.joinByIndex)\n    ).reverse()) {\n      const joinByDimension: Dimension = {\n        ...(omit(joinedDimensions[0], [\n          \"joinByIndex\",\n          \"dimensionId\",\n        ]) as Dimension),\n        values: uniqBy(\n          joinedDimensions\n            .flatMap((d) => d.values ?? [])\n            .sort(dimensionValueSorter),\n          (x) => x.value\n        ),\n        id: mkJoinById(Number(index)) as ComponentId,\n        // Non-relevant, as we rely on the originalIris property.\n        cubeIri: JOIN_BY_CUBE_IRI,\n        // FIXME: adapt to design\n        label: uniq(joinedDimensions.map((d) => d.label)).join(\", \"),\n        isJoinByDimension: true,\n        originalIds: joinedDimensions.map((d) => ({\n          cubeIri: d.cubeIri,\n          dimensionId: d.id as ComponentId,\n          label: d.label,\n          description: d.description ?? \"\",\n        })),\n      };\n      dimensions.unshift(joinByDimension);\n    }\n  }\n\n  return dimensions;\n};\n\nexport const getOriginalIds = (joinById: string, chartConfig: ChartConfig) => {\n  const index = getJoinByIdIndex(joinById);\n\n  return chartConfig.cubes.map((cube) => {\n    const joinBy = cube.joinBy;\n    assert(joinBy !== undefined, \"Found joinBy id and cube has no join by\");\n\n    return joinBy[index];\n  });\n};\n\nexport const getResolvedJoinById = (cube: Cube, joinById: string) => {\n  if (!cube.joinBy) {\n    return;\n  }\n\n  const index = getJoinByIdIndex(joinById);\n\n  return cube.joinBy[index];\n};\n\ntype JoinByKey = string;\n\n/**\n * Use to merge observations coming from several DataCubesObservationQueries.\n *\n * Observations are merged by the value of the `joinBy` property of the cube filter.\n * The function does an outerJoin (returns all observations from all queries),\n * so if there are observations from different cubes with the same joinBy value,\n * they will be merged into one.\n */\nexport const mergeObservations = (\n  queries: OperationResult<\n    DataCubeObservationsQuery,\n    Exact<DataCubeObservationsQueryVariables>\n  >[]\n): Observation[] => {\n  const merged = queries.reduce<Record<JoinByKey, Observation>>((acc, q) => {\n    const joinBy = q.operation.variables?.cubeFilter.joinBy;\n    const obs = q.data?.dataCubeObservations.data;\n\n    if (!obs || !joinBy) {\n      return acc;\n    }\n\n    for (const o of obs) {\n      // Remove joinBy dimensions from the observation, to use explicit joinBy as key\n      const om = omit(o, joinBy) as Observation;\n\n      const key: ObservationValue | undefined = joinBy\n        .map((x) => o[x])!\n        .join(keyJoiner);\n\n      if (!key) {\n        continue;\n      }\n\n      for (let i = 0; i < joinBy.length; i++) {\n        if (o[joinBy[i]] !== undefined) {\n          om[mkJoinById(i) as keyof typeof om] = o[joinBy[i]];\n        }\n      }\n      const existing: Observation | undefined = acc[key];\n      acc[key] = Object.assign(existing ?? {}, om);\n    }\n\n    return acc;\n  }, {});\n\n  // Extract observations from the merged object indexed by joinBy value\n  return Object.values(merged);\n};\n\ntype JoinBy = Record<string, ComponentId[]>;\n\n/** Versioned cubeIri to dimensionIds */\nexport type VersionedJoinBy = Brand<JoinBy, \"VersionedJoinBy\">;\n\n/** Type only helpers to make handling of joinby typesafe */\nexport const mkVersionedJoinBy = (joinBy: JoinBy): VersionedJoinBy =>\n  joinBy as VersionedJoinBy;\n\nexport const getCubeFiltersFromVersionedJoinBy = (joinBy: VersionedJoinBy) => {\n  // We need to do the BaseOf otherwise Object.entries wrongly things\n  // branded properties are really there\n  return Object.entries(joinBy as BaseOf<VersionedJoinBy>).map(\n    ([cubeIri, joinBy]) => ({\n      iri: cubeIri,\n      joinBy,\n    })\n  );\n};\n","import mapKeys from \"lodash/mapKeys\";\n\nimport { Filters, SingleFilters } from \"@/config-types\";\n\nconst ID_SEPARATOR = \"(VISUALIZE.ADMIN_COMPONENT_ID_SEPARATOR)\";\n\nexport type ComponentId = string & { __componentId: true };\n\nexport const isComponentId = (string: string): string is ComponentId => {\n  return string.includes(ID_SEPARATOR);\n};\n\nexport const stringifyComponentId = ({\n  unversionedCubeIri,\n  unversionedComponentIri,\n}: {\n  unversionedCubeIri: string;\n  unversionedComponentIri: string;\n}): ComponentId =>\n  `${unversionedCubeIri}${ID_SEPARATOR}${unversionedComponentIri}` as ComponentId;\n\nexport const parseComponentId = (id: ComponentId) => {\n  const [unversionedCubeIri, unversionedComponentIri] = id.split(ID_SEPARATOR);\n\n  return {\n    unversionedCubeIri,\n    unversionedComponentIri: unversionedComponentIri || undefined,\n  };\n};\n\nexport const getFiltersByComponentIris = <T extends Filters | SingleFilters>(\n  filters: T\n) => {\n  return mapKeys(\n    filters,\n    (_, k) => parseComponentId(k as ComponentId).unversionedComponentIri ?? k\n  );\n};\n","import { t, Trans } from \"@lingui/macro\";\nimport { Box, Button } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport dynamic from \"next/dynamic\";\nimport { useEffect, useRef } from \"react\";\n\nimport { LegendItem } from \"@/charts/shared/legend-color\";\nimport { Flex } from \"@/components/flex\";\nimport { DisabledMessageIcon, Label } from \"@/components/form\";\nimport { CustomPaletteType } from \"@/config-types\";\nimport { ColorRamp } from \"@/configurator/components/chart-controls/color-ramp\";\nimport { Icon } from \"@/icons\";\nimport {\n  ColorItem,\n  createDivergingInterpolator,\n  createSequentialInterpolator,\n} from \"@/palettes\";\nimport { theme } from \"@/themes/theme\";\nimport { assert } from \"@/utils/assert\";\nimport { hasEnoughContrast } from \"@/utils/color-palette-utils\";\n\nconst ColorPickerMenu = dynamic(\n  () =>\n    import(\"../../../configurator/components/chart-controls/color-picker\").then(\n      (mod) => mod.ColorPickerMenu\n    ),\n  { ssr: false }\n);\n\nconst CATEGORICAL_MAX_ALLOWED_COLORS = 26;\nconst DIVERGING_MAX_ALLOWED_COLORS = 3;\n\nconst useStyles = makeStyles({\n  addColorButton: {\n    minWidth: \"fit-content\",\n    paddingLeft: 0,\n  },\n  categoricalColorListContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: theme.spacing(2),\n  },\n  colorItem: {\n    maxWidth: 304,\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n  colorItemContent: {\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    width: \"100%\",\n  },\n});\n\ntype ColorPaletteCreatorProps = {\n  onAdd: (color?: string) => void;\n  onRemove: (id: string) => void;\n  onUpdate: (color: string, id: string) => void;\n  colorValues: ColorItem[];\n  title: string;\n  type: CustomPaletteType[\"type\"];\n};\n\nexport const ColorPaletteCreator = (props: ColorPaletteCreatorProps) => {\n  const { type } = props;\n  switch (type) {\n    case \"diverging\":\n      return <DivergentColorPaletteCreator {...props} />;\n    case \"categorical\":\n      return <CategoricalColorPaletteCreator {...props} />;\n\n    case \"sequential\":\n      return <SequentialColorPaletteCreator {...props} />;\n    default:\n      const _exhaustiveCheck: never = type;\n      return _exhaustiveCheck;\n  }\n};\n\nconst SequentialColorPaletteCreator = (props: ColorPaletteCreatorProps) => {\n  const { onUpdate, onAdd, colorValues } = props;\n\n  assert(\n    colorValues.length > 0,\n    \"Sequential color palette must have at least one color\"\n  );\n  const baseColor = colorValues[0];\n\n  const colorResult = createSequentialInterpolator({\n    endColorHex: baseColor.color,\n  });\n\n  const lastStartingColorRef = useRef(colorResult.startingColorHex);\n\n  useEffect(() => {\n    if (\n      !colorResult.startingColorHex ||\n      colorResult.startingColorHex === lastStartingColorRef.current\n    ) {\n      return;\n    }\n\n    lastStartingColorRef.current = colorResult.startingColorHex;\n\n    if (colorValues[1]) {\n      if (colorValues[1].color !== colorResult.startingColorHex) {\n        onUpdate(colorResult.startingColorHex, colorValues[1].id);\n      }\n    } else {\n      onAdd(colorResult.startingColorHex);\n    }\n  }, [colorResult.startingColorHex, colorValues, onAdd, onUpdate]);\n\n  return (\n    <Flex flexDirection={\"column\"} gap={2}>\n      <Box>\n        <ColorRamp\n          height={24}\n          width={304}\n          colorInterpolator={colorResult.interpolator}\n        />\n      </Box>\n      <Box sx={{ fontSize: \"1rem\", pb: 2, maxWidth: 304 }}>\n        <Label htmlFor=\"custom-color-palette-base\">\n          <Trans id=\"controls.custom-color-palettes.base\">Base color</Trans>\n        </Label>\n        {baseColor && (\n          <ColorSelectionRow\n            type={\"sequential\"}\n            key={baseColor.id}\n            colorValues={[baseColor]}\n            {...baseColor}\n            onUpdate={onUpdate}\n          />\n        )}\n      </Box>\n    </Flex>\n  );\n};\n\nconst DivergentColorPaletteCreator = (props: ColorPaletteCreatorProps) => {\n  const { onAdd, onRemove, onUpdate, colorValues, title } = props;\n  const classes = useStyles();\n\n  const disabled =\n    DIVERGING_MAX_ALLOWED_COLORS <= colorValues.length || title.length === 0;\n\n  const [startColorHex, endColorHex, midColorHex] = colorValues;\n\n  const colorResult = createDivergingInterpolator({\n    endColorHex: endColorHex.color,\n    startColorHex: startColorHex.color,\n    options: {\n      midColorHex: midColorHex?.color,\n    },\n  });\n\n  return (\n    <>\n      <Flex flexDirection={\"column\"} gap={2}>\n        <Box>\n          <ColorRamp\n            height={24}\n            width={304}\n            colorInterpolator={colorResult.interpolator}\n          />\n        </Box>\n        <Box sx={{ fontSize: \"1rem\", pb: 2, maxWidth: 304 }}>\n          <Label htmlFor=\"custom-color-palette-start\">\n            <Trans id=\"controls.custom-color-palettes.start\">\n              Starting color\n            </Trans>\n          </Label>\n          {startColorHex && (\n            <ColorSelectionRow\n              type={\"diverging\"}\n              key={startColorHex.id}\n              colorValues={[startColorHex]}\n              {...startColorHex}\n              onUpdate={onUpdate}\n            />\n          )}\n        </Box>\n        {midColorHex && (\n          <Box sx={{ fontSize: \"1rem\", pb: 2, maxWidth: 304 }}>\n            <Label htmlFor=\"custom-color-palette-mid\">\n              <Trans id=\"controls.custom-color-palettes.mid\">\n                Middle color\n              </Trans>\n            </Label>\n            <ColorSelectionRow\n              type={\"diverging\"}\n              key={midColorHex.id}\n              colorValues={[midColorHex]}\n              {...midColorHex}\n              onUpdate={onUpdate}\n              onRemove={onRemove}\n            />\n          </Box>\n        )}\n        <Box sx={{ fontSize: \"1rem\", pb: 2, maxWidth: 304 }}>\n          <Label htmlFor=\"custom-color-palette-end\">\n            <Trans id=\"controls.custom-color-palettes.end\">Ending color</Trans>\n          </Label>\n          {endColorHex && (\n            <ColorSelectionRow\n              type={\"diverging\"}\n              key={endColorHex.id}\n              colorValues={[endColorHex]}\n              {...endColorHex}\n              onUpdate={onUpdate}\n            />\n          )}\n        </Box>\n      </Flex>\n      <Button\n        variant=\"text\"\n        fullWidth\n        className={classes.addColorButton}\n        disabled={disabled}\n        startIcon={<Icon name=\"plus\" />}\n        onClick={() => onAdd()}\n      >\n        <Trans id=\"controls.custom-color-palettes.add-color\">Add color</Trans>\n      </Button>\n    </>\n  );\n};\n\nconst CategoricalColorPaletteCreator = (props: ColorPaletteCreatorProps) => {\n  const { onAdd, onRemove, onUpdate, colorValues, title } = props;\n  const classes = useStyles();\n\n  const disabled =\n    CATEGORICAL_MAX_ALLOWED_COLORS <= colorValues.length || title.length === 0;\n\n  return (\n    <>\n      {colorValues.length > 0 && (\n        <Box className={classes.categoricalColorListContainer}>\n          {colorValues.map((item) => (\n            <ColorSelectionRow\n              type={\"categorical\"}\n              colorValues={colorValues}\n              key={item.id}\n              {...item}\n              onRemove={onRemove}\n              onUpdate={onUpdate}\n            />\n          ))}\n        </Box>\n      )}\n      <Button\n        variant=\"text\"\n        fullWidth\n        className={classes.addColorButton}\n        disabled={disabled}\n        startIcon={<Icon name=\"plus\" />}\n        onClick={() => onAdd()}\n      >\n        <Trans id=\"controls.custom-color-palettes.add-color\">Add color</Trans>\n      </Button>\n    </>\n  );\n};\n\ntype ColorSelectionRowProps = {\n  colorValues: ColorItem[];\n  type: CustomPaletteType[\"type\"];\n  onUpdate: (color: string, id: string) => void;\n  onRemove?: (id: string) => void;\n} & ColorItem;\n\nconst ColorSelectionRow = (props: ColorSelectionRowProps) => {\n  const { id, color, colorValues, onRemove, onUpdate, type } = props;\n  const classes = useStyles();\n\n  const warningContrast = hasEnoughContrast(color);\n\n  const getContrastWarning = () => {\n    switch (type) {\n      case \"categorical\":\n        return t({\n          id: \"controls.custom-color-palettes.categorical-contrast-warning\",\n        });\n      case \"sequential\":\n        return t({\n          id: \"controls.custom-color-palettes.sequential-contrast-warning\",\n        });\n      case \"diverging\":\n        return t({\n          id: \"controls.custom-color-palettes.diverging-contrast-warning\",\n        });\n      default:\n        const _exhaustiveCheck: never = type;\n        return _exhaustiveCheck;\n    }\n  };\n\n  return (\n    <Box className={classes.colorItem}>\n      <Flex className={classes.colorItemContent}>\n        <LegendItem label={color} color={color} symbol=\"square\" />\n        <Flex sx={{ alignItems: \"center\", gap: 2 }}>\n          {warningContrast && (\n            <DisabledMessageIcon message={getContrastWarning()} />\n          )}\n          <ColorPickerMenu\n            colorId={id}\n            colors={colorValues}\n            selectedHexColor={color}\n            onChange={(color) => onUpdate(color, id)}\n            onRemove={onRemove}\n          />\n        </Flex>\n      </Flex>\n    </Box>\n  );\n};\n","import { GetServerSideProps } from \"next\";\n\nimport { SelectDatasetStep } from \"@/browse/ui/select-dataset-step\";\nimport { AppLayout } from \"@/components/layout\";\nimport { ConfiguratorStateProvider } from \"@/configurator/configurator-state\";\n\nexport const getServerSideProps: GetServerSideProps = async ({ query }) => {\n  return {\n    props: {\n      hideHeader: query.odsiframe === \"true\",\n    },\n  };\n};\n\nexport function DatasetBrowser({ hideHeader }: { hideHeader: boolean }) {\n  return (\n    <AppLayout hideHeader={hideHeader}>\n      <ConfiguratorStateProvider chartId=\"new\" allowDefaultRedirect={false}>\n        <SelectDatasetStep variant=\"page\" />\n      </ConfiguratorStateProvider>\n    </AppLayout>\n  );\n}\n\nexport default DatasetBrowser;\n","import ParsingClient from \"sparql-http-client/ParsingClient\";\n\n/** Creates SPARQL query to fetch latest cube iri.\n * Works for both versioned and unversioned cubes.\n */\nconst getLatestCubeIriQuery = (cubeIri: string) => {\n  return `PREFIX cube: <https://cube.link/>\nPREFIX schema: <http://schema.org/>\n\nSELECT ?iri WHERE {\n  {\n    # Versioned cube.\n    SELECT ?iri ?version WHERE {\n      VALUES ?oldIri { <${cubeIri}> }\n      ?unversionedIri schema:hasPart ?oldIri .\n      ?unversionedIri schema:hasPart ?iri .\n      ?iri schema:version ?version .\n      ?iri schema:creativeWorkStatus ?status .\n      ?oldIri schema:creativeWorkStatus ?oldStatus .\n      FILTER(NOT EXISTS { ?iri schema:expires ?expires . } && ?status IN (?oldStatus, <https://ld.admin.ch/vocabulary/CreativeWorkStatus/Published>))\n    }\n    ORDER BY DESC(?version)\n  } UNION {\n    {\n      # Version history of a cube.\n      SELECT ?iri ?status ?version WHERE {\n        VALUES ?unversionedIri { <${cubeIri}> }\n        ?unversionedIri schema:hasPart ?iri .\n        ?iri schema:version ?version .\n        ?iri schema:creativeWorkStatus ?status .\n        FILTER(NOT EXISTS { ?iri schema:expires ?expires . })\n      }\n      ORDER BY DESC(?status) DESC(?version)\n    }\n  } UNION {\n    {\n      # Non-versioned cube.\n      SELECT ?iri ?status WHERE {\n        VALUES ?iri { <${cubeIri}> }\n        ?iri cube:observationConstraint ?shape .\n        ?iri schema:creativeWorkStatus ?status .\n        FILTER(NOT EXISTS { ?iri schema:expires ?expires . } && NOT EXISTS { ?unversionedIri schema:hasPart ?iri . })\n      }\n      ORDER BY DESC(?status)\n    }\n  }\n}\nLIMIT 1`;\n};\n\nexport const queryLatestCubeIri = async (\n  sparqlClient: ParsingClient,\n  iri: string\n): Promise<string | undefined> => {\n  const query = getLatestCubeIriQuery(iri);\n  const results = await sparqlClient.query.select(query, {\n    operation: \"postUrlencoded\",\n  });\n\n  return results[0]?.iri.value;\n};\n","import sortBy from \"lodash/sortBy\";\n\nimport { sortFilterValue } from \"@/configurator/components/filters\";\nimport { HierarchyValue } from \"@/domain/data\";\nimport { bfs } from \"@/utils/bfs\";\n\nexport const mapTree = <TIn extends { children?: TIn[] | null }, TOut>(\n  tree: TIn[],\n  cb: (h: TIn) => TOut\n) => {\n  return tree.map((t): TOut => {\n    return {\n      ...cb(t),\n      children: t.children ? mapTree(t.children, cb) : undefined,\n    };\n  });\n};\n\nconst filterTreeHelper = <T extends { children?: T[] | null }>(\n  tree: T[],\n  predicate: (h: T) => boolean\n) => {\n  return tree\n    .map((t): T => {\n      return {\n        ...t,\n        children: t.children\n          ? filterTreeHelper(t.children, predicate)\n          : undefined,\n      };\n    })\n    .filter(predicate);\n};\n\n/**\n * Given a tree and a list of nodes, will remove any parent / node that does not contain\n * at least of the provided nodes in their descendants.\n */\nexport const pruneTree = <T extends { children?: T[] | null }>(\n  tree: T[],\n  predicate: (v: T) => boolean\n): T[] => {\n  const isUsed = (v: T): boolean => {\n    if (predicate(v)) {\n      return true;\n    } else if (v.children) {\n      return v.children.some((child) => isUsed(child));\n    }\n    return false;\n  };\n\n  return filterTreeHelper(tree, isUsed);\n};\n\nconst sortTree = (tree: HierarchyValue[]): HierarchyValue[] => {\n  return tree.sort((a, b) => {\n    return b.depth - a.depth || sortFilterValue(a, b);\n  });\n};\n\n/** Sorts the tree by default chain of sorters (position -> identifier -> label). */\nexport const sortHierarchy = (tree: HierarchyValue[]): HierarchyValue[] => {\n  return sortTree(tree).map((d) => ({\n    ...d,\n    children: d.children ? sortHierarchy(d.children) : undefined,\n  }));\n};\n\n/**\n * Visits a hierarchy with depth first search\n */\nexport const visitHierarchy = <\n  TNode extends { children?: TNode[] | undefined },\n>(\n  tree: TNode[],\n  /** Will be run over all children. Return false to abort early */\n  visitor: (node: TNode) => void | false\n) => {\n  const q = [...tree];\n  while (q.length > 0) {\n    const node = q.shift()!;\n    const ret = visitor(node);\n    if (ret === false) {\n      break;\n    }\n    for (let c of node.children || []) {\n      q.push(c);\n    }\n  }\n};\n\n/**\n * Visits a hierarchy with depth first search\n */\nexport const findInHierarchy = (\n  tree: HierarchyValue[],\n  /** Will be run over all children. Return false to abort early */\n  finder: (node: HierarchyValue) => boolean\n) => {\n  let res = undefined as HierarchyValue | undefined;\n  visitHierarchy(tree, (node) => {\n    const found = finder(node);\n    if (found) {\n      res = node;\n      return false;\n    }\n  });\n  return res;\n};\n\nexport const getOptionsFromTree = (tree: HierarchyValue[]) => {\n  return sortBy(\n    bfs(tree, (node, { parents }) => ({\n      ...node,\n      parents,\n    })),\n    (node) => joinParents(node.parents)\n  );\n};\n\nexport const joinParents = (parents?: HierarchyValue[]) => {\n  return parents?.map((x) => x.label).join(\" > \") || \"\";\n};\n\nexport const flattenTree = (tree: HierarchyValue[]) => {\n  const res: HierarchyValue[] = [];\n  bfs(tree, (x) => res.push(x));\n  return res;\n};\n\nexport const regroupTrees = (\n  trees: (HierarchyValue & { hierarchyName?: string })[][]\n): HierarchyValue[] => {\n  if (trees.length < 2) {\n    return trees[0];\n  } else {\n    // We have multiple hierarchies\n    const goodTrees = trees.filter((x) => !!x[0] && !!x[0].hierarchyName);\n    const roots = new Set(goodTrees.map((x) => x[0].value));\n    if (roots.size > 1) {\n      throw Error(\"Cannot have multiple hierarchies not sharing the same root\");\n    }\n    return [\n      {\n        ...goodTrees[0][0],\n        children: goodTrees.map((t) => ({\n          value: t[0].hierarchyName!,\n          hasValue: false,\n          children: t[0].children,\n          dimensionId: t[0].dimensionId,\n          label: t[0].hierarchyName!,\n          depth: 0,\n        })),\n      },\n    ];\n  }\n};\n","/**\n * Entry point for app package\n */\n\nexport { I18nProvider } from \"@lingui/react\";\nexport {\n  Configurator,\n  ConfiguratorStateProvider,\n  useConfiguratorState,\n} from \"../configurator\";\nexport {\n  defaultLocale,\n  i18n,\n  locales,\n  parseLocaleString,\n} from \"../locales/locales\";\nexport { LocaleProvider, useLocale } from \"../locales/use-locale\";\nexport { DatasetBrowser } from \"../pages/browse\";\n","import { StoreApi, useStore } from \"zustand\";\n\nexport type UseBoundStoreWithSelector<S> = {\n  (): ExtractState<S>;\n  <T>(\n    selector: (state: ExtractState<S>) => T,\n    equals?: (a: T, b: T) => boolean\n  ): T;\n};\n\nexport const createBoundUseStoreWithSelector = ((store) => (selector, equals) =>\n  useStore(store, selector as never, equals)) as <S extends StoreApi<unknown>>(\n  store: S\n) => UseBoundStoreWithSelector<S>;\n\nexport type ExtractState<S> = S extends { getState: () => infer X } ? X : never;\n","import isEqual from \"lodash/isEqual\";\nimport uniq from \"lodash/uniq\";\nimport {\n  createContext,\n  PropsWithChildren,\n  useContext,\n  useMemo,\n  useRef,\n} from \"react\";\nimport create, { StateCreator, StoreApi, UseBoundStore } from \"zustand\";\n\nimport { getChartSpec } from \"@/charts/chart-config-ui-options\";\nimport {\n  CalculationType,\n  ChartConfig,\n  FilterValue,\n  FilterValueSingle,\n} from \"@/config-types\";\nimport { canDimensionBeMultiFiltered, Component } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { getOriginalIds, isJoinById } from \"@/graphql/join\";\nimport {\n  createBoundUseStoreWithSelector,\n  ExtractState,\n  UseBoundStoreWithSelector,\n} from \"@/stores/utils\";\nimport { assert } from \"@/utils/assert\";\n\nexport type InteractiveFiltersState = {\n  categories: {\n    [x: string]: boolean;\n  };\n  timeRange: {\n    from: Date | undefined;\n    to: Date | undefined;\n  };\n  timeSlider: TimeSlider;\n  dataFilters: DataFilters;\n  calculation: {\n    type: CalculationType | undefined;\n  };\n  annotations: {\n    [x: string]: boolean;\n  };\n};\n\nexport type DataFilters = Record<string, FilterValue>;\n\ntype TimeSlider =\n  | {\n      type: \"interval\";\n      value: Date | undefined;\n    }\n  | {\n      type: \"ordinal\";\n      value: string | undefined;\n    };\n\ntype InteractiveFiltersStateActions = {\n  addCategory: (category: string) => void;\n  removeCategory: (category: string) => void;\n  resetCategories: () => void;\n  setTimeRange: (from: Date, to: Date) => void;\n  setTimeSlider: (timeSlider: InteractiveFiltersState[\"timeSlider\"]) => void;\n  resetTimeSlider: () => void;\n  setDataFilters: (dataFilters: InteractiveFiltersState[\"dataFilters\"]) => void;\n  updateDataFilter: (\n    dimensionId: string,\n    dimensionValue: FilterValueSingle[\"value\"]\n  ) => void;\n  setMultiDataFilter: (dimensionId: string, values: string[]) => void;\n  addDataFilterValue: (dimensionId: string, value: string) => void;\n  removeDataFilterValue: (dimensionId: string, value: string) => void;\n  resetDataFilters: () => void;\n  setCalculationType: (calculationType: CalculationType) => void;\n  setAnnotations: (annotations: InteractiveFiltersState[\"annotations\"]) => void;\n  updateAnnotation: (key: string, show: boolean) => void;\n};\n\ntype State = InteractiveFiltersState & InteractiveFiltersStateActions;\n\nconst interactiveFiltersStoreCreator: StateCreator<State> = (set) => {\n  return {\n    categories: {},\n    addCategory: (category: string) => {\n      set((state) => ({\n        categories: { ...state.categories, [category]: true },\n      }));\n    },\n    removeCategory: (category: string) => {\n      set((state) => {\n        delete state.categories[category];\n        return { categories: { ...state.categories } };\n      });\n    },\n    resetCategories: () => {\n      set({\n        categories: {},\n      });\n    },\n    timeRange: {\n      from: undefined,\n      to: undefined,\n    },\n    setTimeRange: (from: Date, to: Date) => {\n      set({\n        timeRange: { from, to },\n      });\n    },\n    timeSlider: {\n      type: \"interval\",\n      value: undefined,\n    },\n    setTimeSlider: ({ type, value }: TimeSlider) => {\n      set({\n        timeSlider: { type, value } as TimeSlider,\n      });\n    },\n    resetTimeSlider: () => {\n      set((state) => ({\n        timeSlider: { ...state.timeSlider, value: undefined },\n      }));\n    },\n    dataFilters: {},\n    setDataFilters: (dataFilters: DataFilters) => {\n      set({ dataFilters });\n    },\n    updateDataFilter: (\n      dimensionId: string,\n      dimensionValue: FilterValueSingle[\"value\"]\n    ) => {\n      set((state) => ({\n        dataFilters: {\n          ...state.dataFilters,\n          [dimensionId]: {\n            type: \"single\",\n            value: dimensionValue,\n          },\n        },\n      }));\n    },\n    setMultiDataFilter: (dimensionId: string, values: string[]) => {\n      set((state) => ({\n        dataFilters: {\n          ...state.dataFilters,\n          [dimensionId]: {\n            type: \"multi\",\n            values: Object.fromEntries(values.map((v) => [v, true])),\n          },\n        },\n      }));\n    },\n    addDataFilterValue: (dimensionId: string, value: string) => {\n      set((state) => {\n        const currentFilter = state.dataFilters[dimensionId];\n\n        if (currentFilter?.type === \"single\") {\n          return {\n            dataFilters: {\n              ...state.dataFilters,\n              [dimensionId]: {\n                type: \"multi\",\n                values: {\n                  [currentFilter.value as string]: true,\n                  [value]: true,\n                },\n              },\n            },\n          };\n        }\n\n        if (currentFilter?.type === \"multi\") {\n          return {\n            dataFilters: {\n              ...state.dataFilters,\n              [dimensionId]: {\n                type: \"multi\",\n                values: {\n                  ...currentFilter.values,\n                  [value]: true,\n                },\n              },\n            },\n          };\n        }\n\n        return {\n          dataFilters: {\n            ...state.dataFilters,\n            [dimensionId]: {\n              type: \"multi\",\n              values: { [value]: true },\n            },\n          },\n        };\n      });\n    },\n    removeDataFilterValue: (dimensionId: string, value: string) => {\n      set((state) => {\n        const currentFilter = state.dataFilters[dimensionId];\n\n        if (currentFilter?.type === \"multi\") {\n          const newValues = { ...currentFilter.values };\n          delete newValues[value];\n\n          const remainingValues = Object.keys(newValues);\n\n          if (remainingValues.length === 1) {\n            return {\n              dataFilters: {\n                ...state.dataFilters,\n                [dimensionId]: {\n                  type: \"single\",\n                  value: remainingValues[0],\n                },\n              },\n            };\n          }\n\n          if (remainingValues.length === 0) {\n            const newDataFilters = { ...state.dataFilters };\n            delete newDataFilters[dimensionId];\n            return { dataFilters: newDataFilters };\n          }\n\n          return {\n            dataFilters: {\n              ...state.dataFilters,\n              [dimensionId]: {\n                type: \"multi\",\n                values: newValues,\n              },\n            },\n          };\n        }\n\n        if (currentFilter?.type === \"single\" && currentFilter.value === value) {\n          const newDataFilters = { ...state.dataFilters };\n          delete newDataFilters[dimensionId];\n          return { dataFilters: newDataFilters };\n        }\n\n        return { dataFilters: state.dataFilters };\n      });\n    },\n    resetDataFilters: () => {\n      set({ dataFilters: {} });\n    },\n    calculation: {\n      type: undefined,\n    },\n    setCalculationType: (calculationType: CalculationType) => {\n      set({ calculation: { type: calculationType } });\n    },\n    annotations: {},\n    setAnnotations: (annotations: InteractiveFiltersState[\"annotations\"]) => {\n      set({ annotations });\n    },\n    updateAnnotation: (key: string, show: boolean) => {\n      set((state) => ({\n        annotations: {\n          ...state.annotations,\n          [key]: show,\n        },\n      }));\n    },\n  };\n};\n\ntype InteractiveFiltersStore = StoreApi<State>;\nexport type InteractiveFiltersContextValue = [\n  UseBoundStore<StoreApi<State>>[\"getState\"],\n  UseBoundStoreWithSelector<StoreApi<State>>,\n  InteractiveFiltersStore,\n];\n\nconst InteractiveFiltersContext = createContext<\n  | {\n      potentialTimeRangeFilterIds: string[];\n      potentialDataFilterIds: string[];\n      stores: Record<ChartConfig[\"key\"], InteractiveFiltersContextValue>;\n    }\n  | undefined\n>(undefined);\n\nconst getPotentialTimeRangeFilterIds = (chartConfigs: ChartConfig[]) => {\n  const temporalDimensions = chartConfigs.flatMap((config) => {\n    const chartSpec = getChartSpec(config);\n    const temporalEncodings = chartSpec.encodings.filter((x) =>\n      x.componentTypes.some(\n        (x) => x === \"TemporalDimension\" || x === \"TemporalEntityDimension\"\n      )\n    );\n    const chartTemporalDimensions = temporalEncodings\n      .map((encoding) => {\n        const field =\n          encoding.field in config.fields\n            ? // @ts-expect-error ts(7053) - Not possible to narrow down here, but we check for undefined below\n              config.fields[encoding.field]\n            : undefined;\n        if (field && \"componentId\" in field) {\n          const candidateIds = isJoinById(field.componentId as string)\n            ? getOriginalIds(field.componentId, config)\n            : [field.componentId];\n\n          return candidateIds.map((componentId) => ({\n            componentId,\n            chartKey: config.key,\n          }));\n        }\n      })\n      .flat()\n      .filter(truthy);\n\n    return chartTemporalDimensions;\n  });\n\n  return temporalDimensions.map((dimension) => dimension.componentId);\n};\n\nexport const getPotentialDataFilterIds = (chartConfigs: ChartConfig[]) => {\n  const dimensionIdCounts = new Map<string, number>();\n\n  chartConfigs.forEach((config) => {\n    const dimensionIds = uniq(\n      config.cubes\n        .map((cube) => cube.filters)\n        .flatMap((filters) => {\n          return Object.entries(filters)\n            .filter(\n              ([_, filter]) =>\n                filter.type === \"single\" || filter.type === \"multi\"\n            )\n            .map(([dimensionId]) => dimensionId)\n            .concat(\n              config.chartType === \"table\"\n                ? Object.entries(config.fields)\n                    .map(([componentId, field]) =>\n                      canDimensionBeMultiFiltered({\n                        __typename: field.componentType,\n                      } as Component)\n                        ? componentId\n                        : undefined\n                    )\n                    .filter(truthy)\n                : []\n            );\n        })\n    );\n\n    dimensionIds.forEach((dimensionId) => {\n      dimensionIdCounts.set(\n        dimensionId,\n        (dimensionIdCounts.get(dimensionId) ?? 0) + 1\n      );\n    });\n  });\n\n  const sharedDimensionIds = Array.from(dimensionIdCounts.entries())\n    .filter(([_, count]) => count > 1)\n    .map(([dimensionId]) => dimensionId);\n\n  return sharedDimensionIds;\n};\n\n/**\n * Creates and provides all the interactive filters stores for the given chartConfigs.\n */\nexport const InteractiveFiltersProvider = ({\n  children,\n  chartConfigs,\n}: PropsWithChildren<{\n  chartConfigs: ChartConfig[];\n}>) => {\n  const storeRefs = useRef<Record<ChartConfig[\"key\"], StoreApi<State>>>({});\n  const boundSelectorRefs = useRef<\n    Record<ChartConfig[\"key\"], UseBoundStoreWithSelector<StoreApi<State>>>\n  >({});\n\n  const potentialTimeRangeFilterIds = useMemo(() => {\n    return getPotentialTimeRangeFilterIds(chartConfigs);\n  }, [chartConfigs]);\n  const potentialDataFilterIds = useMemo(() => {\n    return getPotentialDataFilterIds(chartConfigs);\n  }, [chartConfigs]);\n\n  const stores = useMemo<\n    Record<ChartConfig[\"key\"], InteractiveFiltersContextValue>\n  >(() => {\n    return Object.fromEntries(\n      chartConfigs.map((chartConfig) => {\n        const store =\n          storeRefs.current[chartConfig.key] ??\n          create(interactiveFiltersStoreCreator);\n\n        storeRefs.current[chartConfig.key] = store;\n\n        if (!boundSelectorRefs.current[chartConfig.key]) {\n          boundSelectorRefs.current[chartConfig.key] =\n            createBoundUseStoreWithSelector(store);\n        }\n\n        const ctxValue: InteractiveFiltersContextValue = [\n          store.getState,\n          boundSelectorRefs.current[chartConfig.key],\n          store,\n        ];\n\n        return [chartConfig.key, ctxValue];\n      })\n    );\n  }, [chartConfigs]);\n\n  const ctxValueRef = useRef<{\n    potentialTimeRangeFilterIds: string[];\n    potentialDataFilterIds: string[];\n    stores: Record<ChartConfig[\"key\"], InteractiveFiltersContextValue>;\n  }>();\n\n  const newCtxValue = {\n    potentialTimeRangeFilterIds,\n    potentialDataFilterIds,\n    stores,\n  };\n\n  if (!ctxValueRef.current || !isEqual(ctxValueRef.current, newCtxValue)) {\n    ctxValueRef.current = newCtxValue;\n  }\n\n  const ctxValue = ctxValueRef.current;\n\n  return (\n    <InteractiveFiltersContext.Provider value={ctxValue}>\n      {children}\n    </InteractiveFiltersContext.Provider>\n  );\n};\n\n/**\n * Provides the chartConfig key to children, so that they know which interactive filters\n * store they should use.\n */\nconst InteractiveFiltersChartContext = createContext<ChartConfig[\"key\"] | null>(\n  null\n);\n\nexport const InteractiveFiltersChartProvider = ({\n  chartConfigKey,\n  children,\n}: PropsWithChildren<{ chartConfigKey: ChartConfig[\"key\"] }>) => {\n  return (\n    <InteractiveFiltersChartContext.Provider value={chartConfigKey}>\n      {children}\n    </InteractiveFiltersChartContext.Provider>\n  );\n};\n\nexport const useChartInteractiveFilters = <T extends unknown>(\n  selector: (state: ExtractState<StoreApi<State>>) => T\n) => {\n  const ctx = useContext(InteractiveFiltersContext);\n  const key = useContext(InteractiveFiltersChartContext);\n\n  assert(\n    ctx,\n    `ctx=${ctx}. useChartInteractiveFilters must be called inside a InteractiveFiltersChartProvider.`\n  );\n  assert(\n    key,\n    `key=${key}. useChartInteractiveFilters must be called inside a InteractiveFiltersChartProvider.`\n  );\n\n  const [, useStore] = ctx.stores[key];\n\n  return useStore(selector);\n};\n\nexport const useInteractiveFiltersGetState = () => {\n  const ctx = useContext(InteractiveFiltersContext);\n  const key = useContext(InteractiveFiltersChartContext);\n\n  assert(\n    ctx,\n    \"useInteractiveFilters must be called inside a InteractiveFiltersContext.Provider!\"\n  );\n  assert(\n    key,\n    \"useInteractiveFilters must be called inside a InteractiveFiltersChartContext.Provider!\"\n  );\n\n  const [getState] = ctx.stores[key];\n\n  return getState;\n};\n\nexport const useDashboardInteractiveFilters = () => {\n  const ctx = useContext(InteractiveFiltersContext);\n\n  assert(\n    ctx,\n    \"useInteractiveFilters must be called inside a InteractiveFiltersContext.Provider!\"\n  );\n\n  return ctx;\n};\n\nexport const setDataFilter = (\n  store: InteractiveFiltersStore,\n  key: string,\n  value: string\n) => {\n  store.setState({\n    dataFilters: {\n      ...store.getState().dataFilters,\n      [key]: { type: \"single\", value },\n    },\n  });\n};\n","import create from \"zustand\";\n\nexport type TransitionStore = {\n  enable: boolean;\n  setEnable: (enable: boolean) => void;\n  brushing: boolean;\n  setBrushing: (isBrushing: boolean) => void;\n  duration: number;\n  setDuration: (duration: number) => void;\n  setDefaultDuration: () => void;\n};\n\nexport const useTransitionStore = create<TransitionStore>((set) => ({\n  enable: true,\n  setEnable: (enable) => set({ enable }),\n  brushing: false,\n  setBrushing: (brushing) => set({ brushing }),\n  duration: 400,\n  setDuration: (duration) => set({ duration }),\n  setDefaultDuration: () => set({ duration: 400 }),\n}));\n","import {\n  FederalBreakpointOverrides,\n  FederalColor,\n  FederalTypographyPropsVariantOverrides,\n  FederalTypographyVariants,\n  FederalTypographyVariantsOptions,\n} from \"@interactivethings/swiss-federal-ci\";\nimport type {} from \"@mui/lab/themeAugmentation\";\nimport { useTheme } from \"@mui/material\";\n\ndeclare module \"@mui/material\" {\n  interface TypographyVariants extends FederalTypographyVariants {}\n\n  interface TypographyVariantsOptions\n    extends FederalTypographyVariantsOptions {}\n}\n\ndeclare module \"@mui/material/Button\" {\n  interface ButtonPropsColorOverrides {\n    primary: true;\n    secondary: true;\n    inherit: true;\n\n    success: false;\n    error: true;\n    info: false;\n    warning: false;\n  }\n\n  interface ButtonPropsSizeOverrides {\n    small: false;\n    medium: false;\n    large: false;\n\n    xs: true;\n    sm: true;\n    md: true;\n    lg: true;\n    xl: true;\n  }\n}\n\ndeclare module \"@mui/material/InputBase\" {\n  interface InputBasePropsSizeOverrides {\n    small: false;\n    medium: false;\n\n    xs: true;\n    sm: true;\n    md: true;\n    lg: true;\n    xl: true;\n  }\n}\n\ndeclare module \"@mui/material/Typography\" {\n  interface TypographyPropsVariantOverrides\n    extends FederalTypographyPropsVariantOverrides {}\n}\n\ndeclare module \"@mui/material/styles\" {\n  interface BreakpointOverrides extends FederalBreakpointOverrides {}\n\n  interface Palette {\n    cobalt: FederalColor & {\n      main: string;\n    };\n    monochrome: FederalColor & {\n      main: string;\n    };\n    red: FederalColor & {\n      main: string;\n    };\n    orange: FederalColor & {\n      main: string;\n    };\n    yellow: FederalColor & {\n      main: string;\n    };\n    blue: FederalColor & {\n      main: string;\n    };\n    green: FederalColor & {\n      main: string;\n    };\n  }\n\n  interface PaletteOptions {\n    cobalt: FederalColor & {\n      main: string;\n    };\n    monochrome: FederalColor & {\n      main: string;\n    };\n    red: FederalColor & {\n      main: string;\n    };\n    orange: FederalColor & {\n      main: string;\n    };\n    yellow: FederalColor & {\n      main: string;\n    };\n    blue: FederalColor & {\n      main: string;\n    };\n    green: FederalColor & {\n      main: string;\n    };\n  }\n}\n\nexport { theme } from \"./theme\";\nexport { useTheme };\n","export const animationFrame = () => {\n  return new Promise((resolve) => requestAnimationFrame(resolve));\n};\n","/**\n * Generic assert conditions performing a Typescript assertion, making sure the\n * code running afterwards follows the condition, and providing this information\n * to Typescript.\n */\ntype Assert = (condition: unknown, message: string) => asserts condition;\nexport const assert: Assert = (\n  condition: unknown,\n  msg: string\n): asserts condition => {\n  if (!condition) {\n    throw Error(`AssertionError: ${msg}`);\n  }\n};\n","import SuperJSON from \"superjson\";\n\nexport const apiFetch = async <T>(\n  relativeUrl: string,\n  options?: {\n    method?: string;\n    data?: Record<string, unknown>;\n    headers?: Record<string, unknown>;\n  }\n): Promise<T> => {\n  const res = await fetch(\n    relativeUrl,\n    options?.data\n      ? {\n          method: options.method || \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            ...options.headers,\n          },\n          body: JSON.stringify(options.data),\n        }\n      : undefined\n  );\n  const json = await res.json();\n  if (json.success) {\n    return \"data\" in json &&\n      typeof json.data === \"object\" &&\n      json.data !== null &&\n      \"meta\" in json.data\n      ? (SuperJSON.deserialize(json.data) as T)\n      : (json.data as T);\n  } else {\n    throw Error(json.message);\n  }\n};\n","import { Config, PUBLISHED_STATE } from \"@prisma/client\";\nimport isUndefined from \"lodash/isUndefined\";\nimport omit from \"lodash/omit\";\nimport omitBy from \"lodash/omitBy\";\nimport { InferAPIResponse } from \"nextkit\";\n\nimport { ParsedConfig } from \"@/db/config\";\n\nimport { ConfiguratorState, CustomPaletteType } from \"../../config-types\";\nimport { apiFetch } from \"../api\";\nimport { createId } from \"../create-id\";\n\nimport type apiConfig from \"../../pages/api/config/[key]\";\nimport type apiConfigCreate from \"../../pages/api/config-create\";\nimport type apiConfigUpdate from \"../../pages/api/config-update\";\nimport type apiUserColorPalette from \"../../pages/api/user/color-palette\";\n\nexport type CreateCustomColorPalette = Omit<CustomPaletteType, \"paletteId\">;\nexport type UpdateCustomColorPalette = Partial<\n  Omit<CustomPaletteType, \"paletteId\">\n> &\n  Pick<CustomPaletteType, \"paletteId\">;\nexport type DeleteCustomColorPalette = Pick<CustomPaletteType, \"paletteId\">;\n\ntype CreateConfigOptions = {\n  key?: string;\n  user_id?: number;\n  published_state?: PUBLISHED_STATE;\n  data: ConfiguratorState;\n};\n\ntype UpdateConfigOptions = {\n  key: string;\n  published_state?: PUBLISHED_STATE;\n  data: ConfiguratorState;\n};\n\nconst prepareForServer = (configState: Partial<Config>) => {\n  return omitBy(\n    {\n      ...configState,\n      data:\n        \"data\" in configState\n          ? omit(configState[\"data\"] as {}, [\"state\"])\n          : undefined,\n    },\n    isUndefined\n  );\n};\n\nexport const createConfig = async (options: CreateConfigOptions) => {\n  return apiFetch<InferAPIResponse<typeof apiConfigCreate, \"POST\">>(\n    \"/api/config-create\",\n    {\n      method: \"POST\",\n      data: prepareForServer({\n        data: {\n          // Create a new chart ID, as the one in the state could be already\n          // used by a chart that has been published.\n          key: createId(),\n          ...options.data,\n        },\n        user_id: options.user_id,\n        published_state: options.published_state,\n      }),\n    }\n  );\n};\n\nexport const updateConfig = async (options: UpdateConfigOptions) => {\n  const { key, published_state } = options;\n\n  return apiFetch<InferAPIResponse<typeof apiConfigUpdate, \"POST\">>(\n    \"/api/config-update\",\n    {\n      method: \"POST\",\n      data: prepareForServer({\n        key,\n        data: {\n          key,\n          ...options.data,\n        },\n        published_state,\n      }),\n    }\n  );\n};\n\nexport const removeConfig = async (options: { key: string }) => {\n  const { key } = options;\n\n  return apiFetch<InferAPIResponse<typeof apiConfigUpdate, \"POST\">>(\n    \"/api/config-remove\",\n    {\n      method: \"POST\",\n      data: {\n        key,\n      },\n    }\n  );\n};\n\nexport const fetchChartConfig = async (id: string) => {\n  return await apiFetch<InferAPIResponse<typeof apiConfig, \"GET\">>(\n    `/api/config/${id}`\n  );\n};\n\nexport const fetchChartConfigs = async () => {\n  return await apiFetch<ParsedConfig[]>(`/api/config/list`);\n};\n\nexport const fetchChartViewCount = async (id: string) => {\n  return await apiFetch<number>(`/api/config/view?id=${id}`);\n};\n\nexport const createCustomColorPalette = async (\n  options: CreateCustomColorPalette\n) => {\n  return (await apiFetch<InferAPIResponse<typeof apiUserColorPalette, \"POST\">>(\n    \"/api/user/color-palette\",\n    {\n      method: \"POST\",\n      data: options,\n    }\n  )) as unknown as CustomPaletteType;\n};\n\nexport const getCustomColorPalettes = async (): Promise<\n  CustomPaletteType[]\n> => {\n  return (await apiFetch<InferAPIResponse<typeof apiUserColorPalette, \"GET\">>(\n    \"/api/user/color-palette\",\n    {\n      method: \"GET\",\n    }\n  )) as CustomPaletteType[];\n};\n\nexport const deleteCustomColorPalette = async (\n  options: DeleteCustomColorPalette\n) => {\n  await apiFetch<InferAPIResponse<typeof apiUserColorPalette, \"DELETE\">>(\n    \"/api/user/color-palette\",\n    {\n      method: \"DELETE\",\n      data: options,\n    }\n  );\n};\n\nexport const updateCustomColorPalette = async (\n  options: UpdateCustomColorPalette\n) => {\n  await apiFetch<InferAPIResponse<typeof apiUserColorPalette, \"PUT\">>(\n    \"/api/user/color-palette\",\n    {\n      method: \"PUT\",\n      data: options,\n    }\n  );\n};\n","export const CONFIGURATOR_STATE_VERSION = \"5.1.0\";\n\nexport const CHART_CONFIG_VERSION = \"5.1.0\";\n","import ParsingClient from \"sparql-http-client/ParsingClient\";\n\n/** Creates SPARQL query to fetch cube's version history. */\nconst getCubeUnversionedIriQuery = (cubeIri: string) => {\n  return `PREFIX schema: <http://schema.org/>\n\nSELECT ?unversionedIri WHERE {\n  ?unversionedIri schema:hasPart <${cubeIri}> .\n}`;\n};\n\nexport const queryCubeUnversionedIri = async (\n  sparqlClient: ParsingClient,\n  iri: string\n): Promise<string | undefined> => {\n  const query = getCubeUnversionedIriQuery(iri);\n  const results = await sparqlClient.query.select(query, {\n    operation: \"postUrlencoded\",\n  });\n\n  return results[0]?.unversionedIri.value;\n};\n","import ParsingClient from \"sparql-http-client/ParsingClient\";\nimport { Client } from \"urql\";\n\nimport { ConfiguratorState, DataSource } from \"@/config-types\";\nimport { hasChartConfigs } from \"@/configurator\";\nimport { getMaybeCachedSparqlUrl } from \"@/graphql/caching-utils\";\nimport {\n  DataCubeLatestIriDocument,\n  DataCubeLatestIriQuery,\n  DataCubeLatestIriQueryVariables,\n  DataCubeUnversionedIriDocument,\n  DataCubeUnversionedIriQuery,\n  DataCubeUnversionedIriQueryVariables,\n} from \"@/graphql/query-hooks\";\nimport { queryCubeUnversionedIri } from \"@/rdf/query-cube-unversioned-iri\";\nimport { queryLatestCubeIri } from \"@/rdf/query-latest-cube-iri\";\n\nconst makeUpgradeConfiguratorState =\n  <O>({\n    cubeIriUpdateFn,\n  }: {\n    cubeIriUpdateFn: (iri: string, options: O) => Promise<string>;\n  }) =>\n  async <V extends ConfiguratorState>(state: V, options: O): Promise<V> => {\n    if (!hasChartConfigs(state)) {\n      return state;\n    }\n\n    return {\n      ...state,\n      chartConfigs: await Promise.all(\n        state.chartConfigs.map(async (chartConfig) => ({\n          ...chartConfig,\n          cubes: await Promise.all(\n            chartConfig.cubes.map(async (cube) => ({\n              ...cube,\n              iri: await cubeIriUpdateFn(cube.iri, options),\n            }))\n          ),\n        }))\n      ),\n    };\n  };\n\nexport const getLatestCubeIri = async (\n  iri: string,\n  options: {\n    client: Client;\n    dataSource: DataSource;\n  }\n) => {\n  const { client, dataSource } = options;\n  const { data } = await client\n    .query<DataCubeLatestIriQuery, DataCubeLatestIriQueryVariables>(\n      DataCubeLatestIriDocument,\n      {\n        sourceUrl: dataSource.url,\n        sourceType: dataSource.type,\n        cubeFilter: { iri },\n      }\n    )\n    .toPromise();\n\n  return data?.dataCubeLatestIri ?? iri;\n};\n\nexport const getUnversionedCubeIri = async (\n  iri: string,\n  options: {\n    client: Client;\n    dataSource: DataSource;\n  }\n) => {\n  const { client, dataSource } = options;\n  const { data } = await client\n    .query<DataCubeUnversionedIriQuery, DataCubeUnversionedIriQueryVariables>(\n      DataCubeUnversionedIriDocument,\n      {\n        sourceUrl: dataSource.url,\n        sourceType: dataSource.type,\n        cubeFilter: { iri },\n      }\n    )\n    .toPromise();\n\n  return data?.dataCubeUnversionedIri ?? iri;\n};\n\nexport const upgradeConfiguratorState = makeUpgradeConfiguratorState({\n  cubeIriUpdateFn: getLatestCubeIri,\n});\n\nconst getLatestCubeIriServerSide = async (\n  iri: string,\n  options: {\n    dataSource: DataSource;\n  }\n) => {\n  const { dataSource } = options;\n  const client = new ParsingClient({\n    endpointUrl: getMaybeCachedSparqlUrl({\n      endpointUrl: dataSource.url,\n      cubeIri: iri,\n    }),\n  });\n  return (await queryLatestCubeIri(client, iri)) ?? iri;\n};\n\nexport const getUnversionedCubeIriServerSide = async (\n  cubeIri: string,\n  options: {\n    dataSource: DataSource;\n  }\n) => {\n  const { dataSource } = options;\n  const client = new ParsingClient({\n    endpointUrl: getMaybeCachedSparqlUrl({\n      endpointUrl: dataSource.url,\n      cubeIri,\n    }),\n  });\n  const iri = await queryCubeUnversionedIri(client, cubeIri);\n  return iri ?? cubeIri;\n};\n\nexport const upgradeConfiguratorStateServerSide = makeUpgradeConfiguratorState({\n  cubeIriUpdateFn: getLatestCubeIriServerSide,\n});\n","import { schemeCategory10 } from \"d3-scale-chromatic\";\nimport stringSimilarity from \"string-similarity-js\";\n\nimport { DEFAULT_OTHER_COLOR_FIELD_OPACITY } from \"@/charts/map/constants\";\nimport { ChartConfig, ConfiguratorState } from \"@/config-types\";\nimport { mapValueIrisToColor } from \"@/configurator/components/ui-helpers\";\nimport { FIELD_VALUE_NONE } from \"@/configurator/constants\";\nimport {\n  LEGACY_PROD_DATA_SOURCE_URL,\n  PROD_DATA_SOURCE_URL,\n} from \"@/domain/data-source/constants\";\nimport { client } from \"@/graphql/client\";\nimport { isJoinById } from \"@/graphql/join\";\nimport {\n  ComponentId,\n  parseComponentId,\n  stringifyComponentId,\n} from \"@/graphql/make-component-id\";\nimport { DEFAULT_CATEGORICAL_PALETTE_ID } from \"@/palettes\";\nimport {\n  CHART_CONFIG_VERSION,\n  CONFIGURATOR_STATE_VERSION,\n} from \"@/utils/chart-config/constants\";\nimport {\n  getUnversionedCubeIri,\n  getUnversionedCubeIriServerSide,\n} from \"@/utils/chart-config/upgrade-cube\";\nimport { createId } from \"@/utils/create-id\";\nimport { maybeWindow } from \"@/utils/maybe-window\";\n\ntype Migration = {\n  description: string;\n  from: string;\n  to: string;\n  up: (config: any, migrationProps?: any) => Promise<any>;\n  down: (config: any, migrationProps?: any) => Promise<any>;\n};\n\nexport const chartConfigMigrations: Migration[] = [\n  {\n    description: `MAP\n    baseLayer {\n      + locked\n      + bbox\n    }`,\n    from: \"1.0.0\",\n    to: \"1.0.1\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.0.1\" };\n\n      if (newConfig.chartType === \"map\") {\n        newConfig.baseLayer = {\n          show: newConfig.baseLayer.show,\n          locked: false,\n        };\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.0.0\" };\n\n      if (newConfig.chartType === \"map\") {\n        newConfig.baseLayer = {\n          show: newConfig.baseLayer.show,\n        };\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `MAP\n    symbolLayer {\n      + colors {\n        + type\n        + value\n        + opacity\n      }\n      - color\n    }`,\n    from: \"1.0.1\",\n    to: \"1.0.2\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.0.2\" };\n\n      if (newConfig.chartType === \"map\") {\n        const { fields } = newConfig;\n        const { symbolLayer } = fields;\n        const { show, componentIri, measureIri, color } = symbolLayer;\n        newConfig.fields.symbolLayer = {\n          show,\n          componentIri,\n          measureIri,\n          colors: {\n            type: \"fixed\",\n            value: color,\n            opacity: 80,\n          },\n        };\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.0.1\" };\n\n      if (newConfig.chartType === \"map\") {\n        const { fields } = newConfig;\n        const { symbolLayer } = fields;\n        const { show, componentIri, measureIri, colors } = symbolLayer;\n        newConfig.fields.symbolLayer = {\n          show,\n          componentIri,\n          measureIri,\n          color: colors.value,\n        };\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `MAP\n    areaLayer? {\n      - show\n    }\n    \n    symbolLayer? {\n      - show\n    }`,\n    from: \"1.0.2\",\n    to: \"1.1.0\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.1.0\" };\n\n      if (newConfig.chartType === \"map\") {\n        const { fields } = newConfig;\n        const { areaLayer, symbolLayer } = fields;\n        const { show: showAreaLayer, ...newAreaLayer } = areaLayer;\n        const { show: showSymbolLayer, ...newSymbolLayer } = symbolLayer;\n\n        if (showAreaLayer) {\n          newConfig.fields.areaLayer = {\n            ...newAreaLayer,\n          };\n        } else {\n          delete newConfig.fields.areaLayer;\n        }\n\n        if (showSymbolLayer) {\n          newConfig.fields.symbolLayer = {\n            ...newSymbolLayer,\n          };\n        } else {\n          delete newConfig.fields.symbolLayer;\n        }\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.0.2\" };\n\n      if (newConfig.chartType === \"map\") {\n        const { fields } = newConfig;\n        const { areaLayer, symbolLayer } = fields;\n\n        if (areaLayer) {\n          newConfig.fields.areaLayer = {\n            ...areaLayer,\n            show: true,\n          };\n        } else {\n          newConfig.fields.areaLayer = {\n            show: false,\n            componentIri: \"\",\n            measureIri: symbolLayer?.measureIri || \"\",\n            colorScaleType: \"continuous\",\n            colorScaleInterpolationType: \"linear\",\n            palette: \"oranges\",\n            nbClass: 5,\n          };\n        }\n\n        if (symbolLayer) {\n          newConfig.fields.symbolLayer = {\n            ...symbolLayer,\n            show: true,\n          };\n        } else {\n          newConfig.fields.symbolLayer = {\n            show: false,\n            // GeoShapes dimensions (Area Layer) can be used in Symbol Layer.\n            componentIri: areaLayer?.componentIri || \"\",\n            measureIri: areaLayer?.measureIri || \"\",\n            colors: {\n              type: \"fixed\",\n              value: \"#1f77b4\",\n              opacity: 80,\n            },\n          };\n        }\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `MAP\n    areaLayer {\n      - measureIri\n      - palette\n      - colorScaleType\n      - colorScaleInterpolationType\n      - nbClass\n      + color {\n        + type: \"numerical\"\n        + componentIri\n        + palette\n        + scaleType: \"continuous\"\n        + interpolationType: \"linear\"\n      } | {\n        + type: \"numerical\"\n        + componentIri\n        + palette\n        + scaleType: \"discrete\"\n        + nbClass\n      }\n    }\n  \n    symbolLayer {\n      - colors {\n        - type: \"fixed\"\n        - value\n        - opacity\n      } | {\n        - type: \"categorical\"\n        - componentIri\n        - palette\n        - ?colorMapping\n      } | {\n        type: \"continuous\"\n        - componentIri\n        - palette\n        - ?colorMapping\n      }\n      + color {\n        + type: \"fixed\"\n        + value\n        + opacity\n      } | {\n        + type: \"categorical\"\n        + componentIri\n        + palette\n        + colorMapping\n      } | {\n        + type: \"numerical\"\n        + componentIri\n        + palette\n        + scaleType: \"continuous\"\n        + interpolationType: \"linear\"\n      } | {\n        + type: \"numerical\"\n        + componentIri\n        + palette\n        + scaleType: \"discrete\"\n        + nbClass\n      }\n    }`,\n    from: \"1.1.0\",\n    to: \"1.1.1\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.1.1\" };\n\n      if (newConfig.chartType === \"map\") {\n        const { fields } = newConfig;\n        const { areaLayer, symbolLayer } = fields;\n\n        if (areaLayer) {\n          const {\n            componentIri,\n            measureIri,\n            palette,\n            colorScaleType,\n            colorScaleInterpolationType,\n            nbClass,\n          } = areaLayer;\n\n          newConfig.fields.areaLayer = {\n            componentIri,\n            color: {\n              type: \"numerical\",\n              componentIri: measureIri,\n              palette,\n              ...(colorScaleType === \"discrete\"\n                ? {\n                    scaleType: colorScaleType,\n                    interpolationType:\n                      colorScaleInterpolationType === \"linear\"\n                        ? \"quantize\"\n                        : colorScaleInterpolationType,\n                    nbClass,\n                  }\n                : {\n                    scaleType: colorScaleType,\n                    interpolationType: \"linear\",\n                  }),\n            },\n          };\n        }\n\n        if (symbolLayer) {\n          const { componentIri, measureIri, colors } = symbolLayer;\n\n          newConfig.fields.symbolLayer = {\n            componentIri,\n            measureIri,\n            color:\n              colors.type === \"fixed\" || colors.type === \"categorical\"\n                ? colors\n                : {\n                    type: \"numerical\",\n                    componentIri: colors.componentIri,\n                    palette: colors.palette,\n                    scaleType: \"continuous\",\n                    interpolationType: \"linear\",\n                  },\n          };\n        }\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.1.0\" };\n\n      if (newConfig.chartType === \"map\") {\n        const { fields } = newConfig;\n        const { areaLayer, symbolLayer } = fields;\n\n        if (areaLayer) {\n          const { componentIri, color } = areaLayer;\n\n          newConfig.fields.areaLayer = {\n            componentIri,\n            measureIri: color.componentIri,\n            palette: color.palette,\n            colorScaleType: color.scaleType,\n            colorInterpolationType: color.interpolationType,\n            nbClass: color.nbClass ?? 3,\n          };\n        }\n\n        if (symbolLayer) {\n          const { componentIri, measureIri, color } = symbolLayer;\n\n          newConfig.fields.symbolLayer = {\n            componentIri,\n            measureIri,\n            ...(color.type === \"fixed\" || color.type === \"categorical\"\n              ? color\n              : {\n                  type: \"continuous\",\n                  componentIri: color.componentIri,\n                  palette: color.palette,\n                }),\n          };\n        }\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `MAP\n    areaLayer - color can be categorical\n    `,\n    from: \"1.1.1\",\n    to: \"1.2.0\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.2.0\" };\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.1.1\" };\n\n      if (newConfig.chartType === \"map\") {\n        const { fields } = newConfig;\n        const { areaLayer } = fields;\n\n        if (areaLayer && areaLayer.color.type === \"categorical\") {\n          delete newConfig.fields.areaLayer;\n        }\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL\n    interactiveFiltersConfig {\n      time -> timeRange\n    }`,\n    from: \"1.2.0\",\n    to: \"1.2.1\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.2.1\" };\n\n      const { interactiveFiltersConfig } = newConfig;\n\n      if (interactiveFiltersConfig) {\n        newConfig.interactiveFiltersConfig = {\n          legend: newConfig.interactiveFiltersConfig.legend,\n          timeRange: newConfig.interactiveFiltersConfig.time,\n          dataFilters: newConfig.interactiveFiltersConfig.dataFilters,\n        };\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.2.0\" };\n\n      const { interactiveFiltersConfig } = newConfig;\n\n      if (interactiveFiltersConfig) {\n        newConfig.interactiveFiltersConfig = {\n          legend: newConfig.interactiveFiltersConfig.legend,\n          time: newConfig.interactiveFiltersConfig.timeRange,\n          dataFilters: newConfig.interactiveFiltersConfig.dataFilters,\n        };\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL\n    interactiveFiltersConfig {\n      + timeSlider\n    }`,\n    from: \"1.2.1\",\n    to: \"1.3.0\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.3.0\" };\n\n      const { interactiveFiltersConfig } = newConfig;\n\n      if (interactiveFiltersConfig) {\n        newConfig.interactiveFiltersConfig = {\n          ...newConfig.interactiveFiltersConfig,\n          timeSlider: {\n            componentIri: \"\",\n          },\n        };\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.2.1\" };\n\n      const { interactiveFiltersConfig } = newConfig;\n\n      if (interactiveFiltersConfig) {\n        newConfig.interactiveFiltersConfig = {\n          legend: newConfig.interactiveFiltersConfig.legend,\n          time: newConfig.interactiveFiltersConfig.time,\n          dataFilters: newConfig.interactiveFiltersConfig.dataFilters,\n        };\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL\n    fields {\n      + animation {\n        componentIri\n      }\n    }`,\n    from: \"1.3.0\",\n    to: \"1.4.0\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.4.0\" };\n\n      const { interactiveFiltersConfig } = newConfig;\n\n      if (interactiveFiltersConfig) {\n        const { legend, timeRange, timeSlider, dataFilters } =\n          interactiveFiltersConfig;\n\n        newConfig.interactiveFiltersConfig = { legend, timeRange, dataFilters };\n\n        if (\n          [\"column\", \"pie\", \"scatterplot\"].includes(newConfig.chartType) &&\n          timeSlider?.componentIri\n        ) {\n          newConfig.fields.animation = {\n            ...timeSlider,\n            showPlayButton: true,\n            duration: 30,\n            type: \"continuous\",\n            dynamicScales: false,\n          };\n        }\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.3.0\" };\n\n      const { fields } = config;\n      const { animation } = fields;\n\n      if (animation) {\n        delete newConfig.fields.animation;\n\n        if ([\"column\", \"pie\", \"scatterplot\"].includes(newConfig.chartType)) {\n          newConfig.interactiveFiltersConfig.timeSlider = {\n            componentIri: animation.componentIri,\n          };\n        } else {\n          newConfig.interactiveFiltersConfig.timeSlider = { componentIri: \"\" };\n        }\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL\n    interactiveFiltersConfig {\n      timeRange {\n        componentIri is tied to x.componentIri\n      }\n    }`,\n    from: \"1.4.0\",\n    to: \"1.4.1\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.4.1\" };\n\n      const { fields, interactiveFiltersConfig } = newConfig;\n      const { x } = fields;\n\n      if (\n        interactiveFiltersConfig &&\n        [\"area\", \"column\", \"line\"].includes(newConfig.chartType) &&\n        newConfig.interactiveFiltersConfig.timeRange.active\n      ) {\n        newConfig.interactiveFiltersConfig.timeRange = {\n          ...newConfig.interactiveFiltersConfig.timeRange,\n          componentIri: x.componentIri,\n        };\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.4.0\" };\n\n      const { interactiveFiltersConfig } = config;\n\n      if (interactiveFiltersConfig) {\n        newConfig.interactiveFiltersConfig.timeRange = {\n          ...newConfig.interactiveFiltersConfig.timeRange,\n          componentIri: \"\",\n        };\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL\n    interactiveFiltersConfig {\n      + calculation\n    }`,\n    from: \"1.4.1\",\n    to: \"1.4.2\",\n    up: (config) => {\n      let newConfig = { ...config, version: \"1.4.2\" };\n\n      const { interactiveFiltersConfig } = newConfig;\n\n      if (interactiveFiltersConfig) {\n        newConfig.interactiveFiltersConfig = {\n          ...newConfig.interactiveFiltersConfig,\n          calculation: {\n            active: false,\n            type: \"identity\",\n          },\n        };\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      let newConfig = { ...config, version: \"1.4.1\" };\n\n      const { interactiveFiltersConfig } = config;\n\n      if (interactiveFiltersConfig) {\n        const { calculation, ...rest } = interactiveFiltersConfig;\n        newConfig.interactiveFiltersConfig = rest;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL + key`,\n    from: \"1.4.2\",\n    to: \"2.0.0\",\n    up: (config, configuratorState) => {\n      const newConfig = { ...config, version: \"2.0.0\" };\n      newConfig.key = createId();\n      newConfig.meta = configuratorState.meta;\n      newConfig.activeField = configuratorState.activeField;\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"1.4.2\" };\n      delete newConfig.key;\n\n      return newConfig;\n    },\n  },\n  {\n    description: `+ combo charts`,\n    from: \"2.0.0\",\n    to: \"2.1.0\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"2.1.0\" };\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"2.0.0\" };\n\n      if (\n        [\"comboLineSingle\", \"comboLineDual\", \"comboLineColumn\"].includes(\n          newConfig.chartType\n        )\n      ) {\n        newConfig.chartType = \"line\";\n        newConfig.fields = {\n          x: newConfig.fields.x,\n          y: {\n            componentIri:\n              newConfig.chartType === \"comboLineSingle\"\n                ? newConfig.fields.y.componentIris[0]\n                : newConfig.chartType === \"comboLineDual\"\n                  ? newConfig.fields.y.leftAxisComponentIri\n                  : newConfig.fields.y.lineComponentIri,\n          },\n        };\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `combo charts {\n      y {\n        + palette\n        + colorMapping\n      }\n    }`,\n    from: \"2.1.0\",\n    to: \"2.2.0\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"2.2.0\" };\n\n      if (newConfig.chartType === \"comboLineSingle\") {\n        newConfig.fields.y.palette = DEFAULT_CATEGORICAL_PALETTE_ID;\n        newConfig.fields.y.colorMapping = mapValueIrisToColor({\n          paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n          dimensionValues: newConfig.fields.y.componentIris.map(\n            (iri: string) => ({ value: iri, label: iri })\n          ),\n        });\n      } else if (newConfig.chartType === \"comboLineDual\") {\n        newConfig.fields.y.palette = DEFAULT_CATEGORICAL_PALETTE_ID;\n        newConfig.fields.y.colorMapping = mapValueIrisToColor({\n          paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n          dimensionValues: [\n            newConfig.fields.y.leftAxisComponentIri,\n            newConfig.fields.y.rightAxisComponentIri,\n          ].map((iri) => ({\n            value: iri,\n            label: iri,\n          })),\n        });\n      } else if (newConfig.chartType === \"comboLineColumn\") {\n        newConfig.fields.y.palette = DEFAULT_CATEGORICAL_PALETTE_ID;\n        newConfig.fields.y.colorMapping = mapValueIrisToColor({\n          paletteId: DEFAULT_CATEGORICAL_PALETTE_ID,\n          dimensionValues: [\n            newConfig.fields.y.lineComponentIri,\n            newConfig.fields.y.columnComponentIri,\n          ].map((iri) => ({\n            value: iri,\n            label: iri,\n          })),\n        });\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"2.1.0\" };\n\n      if (\n        [\"comboLineSingle\", \"comboLineDual\", \"comboLineColumn\"].includes(\n          newConfig.chartType\n        )\n      ) {\n        delete newConfig.fields.y.palette;\n        delete newConfig.fields.y.colorMapping;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      + dataSet\n    }`,\n    from: \"2.2.0\",\n    to: \"2.3.0\",\n    up: (config, configuratorState) => {\n      const newConfig = { ...config, version: \"2.3.0\" };\n      const { dataSet } = configuratorState;\n      newConfig.dataSet = dataSet;\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"2.2.0\" };\n      delete newConfig.dataSet;\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      + cubes {\n        + iri\n        + filters\n        + joinBy?\n      }\n      - dataSet\n      - filters\n    }`,\n    from: \"2.3.0\",\n    to: \"3.0.0\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"3.0.0\" };\n      newConfig.cubes = [\n        {\n          iri: newConfig.dataSet,\n          filters: newConfig.filters,\n        },\n      ];\n      delete newConfig.dataSet;\n      delete newConfig.filters;\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"2.3.0\" };\n      newConfig.dataSet = newConfig.cubes[0].iri;\n      newConfig.filters = newConfig.cubes[0].filters;\n      delete newConfig.cubes;\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"3.0.0\",\n    to: \"3.1.0\",\n    description: `map {\n      color {\n        + opacity\n      }\n    }`,\n    up: (config) => {\n      const newConfig = { ...config, version: \"3.1.0\" };\n\n      if (newConfig.chartType === \"map\") {\n        if (newConfig.fields.areaLayer) {\n          newConfig.fields.areaLayer.color.opacity =\n            DEFAULT_OTHER_COLOR_FIELD_OPACITY;\n        }\n\n        if (newConfig.fields.symbolLayer) {\n          if (newConfig.fields.symbolLayer.color.type !== \"fixed\") {\n            newConfig.fields.symbolLayer.color.opacity =\n              DEFAULT_OTHER_COLOR_FIELD_OPACITY;\n          }\n        }\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"3.0.0\" };\n\n      if (newConfig.chartType === \"map\") {\n        if (newConfig.fields.areaLayer) {\n          delete newConfig.fields.areaLayer.color.opacity;\n        }\n\n        if (newConfig.fields.symbolLayer) {\n          if (newConfig.fields.symbolLayer.color.type !== \"fixed\") {\n            delete newConfig.fields.symbolLayer.color.opacity;\n          }\n        }\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      + cubes {\n        + publishIri\n      }\n    }`,\n    from: \"3.1.0\",\n    to: \"3.2.0\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"3.2.0\" };\n      newConfig.cubes = newConfig.cubes.map((cube: any) => ({\n        ...cube,\n        publishIri: cube.iri,\n      }));\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"3.1.0\" };\n      newConfig.cubes = newConfig.cubes.map((cube: any) => {\n        const { publishIri, ...rest } = cube;\n        return rest;\n      });\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      + cubes {\n        +- joinBy (string) -> joinBy (string[])\n      }\n    }`,\n    from: \"3.2.0\",\n    to: \"3.3.0\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"3.3.0\" };\n      newConfig.cubes = newConfig.cubes.map((cube: any) => {\n        if (typeof cube.joinBy === \"string\") {\n          cube.joinBy = [cube.joinBy];\n        }\n\n        return cube;\n      });\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"3.2.0\" };\n      newConfig.cubes = newConfig.cubes.map((cube: any) => {\n        if (cube.joinBy) {\n          cube.joinBy = cube.joinBy[0];\n        }\n\n        return cube;\n      });\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      meta {\n        + label\n      }\n    }`,\n    from: \"3.3.0\",\n    to: \"3.4.0\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"3.4.0\" };\n      newConfig.meta.label = {\n        de: \"\",\n        fr: \"\",\n        it: \"\",\n        en: \"\",\n      };\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"3.3.0\" };\n      delete newConfig.meta.label;\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      cubes {\n         + unversionedIri\n         - publishIri\n      }\n    }`,\n    from: \"3.4.0\",\n    to: \"4.0.0\",\n    up: async (config, configuratorState) => {\n      const unversionedCubeIris: string[] = [];\n      const getClosestUnversionedCubeIri = (id: string) => {\n        let score = 0;\n        let unversionedIri = \"\";\n\n        for (const iri of unversionedCubeIris) {\n          const s = stringSimilarity(id, iri);\n\n          if (s > score) {\n            score = s;\n            unversionedIri = iri;\n          }\n        }\n\n        return unversionedIri;\n      };\n\n      const newConfig = { ...config, version: \"4.0.0\" };\n      newConfig.cubes = await Promise.all(\n        newConfig.cubes.map(async (cube: any) => {\n          const { publishIri, ...rest } = cube;\n          const isServerSide = !maybeWindow();\n          const fn = isServerSide\n            ? async () => {\n                return await getUnversionedCubeIriServerSide(rest.iri, {\n                  dataSource: configuratorState.dataSource,\n                });\n              }\n            : async () => {\n                return await getUnversionedCubeIri(rest.iri, {\n                  client,\n                  dataSource: configuratorState.dataSource,\n                });\n              };\n          const unversionedIri = await fn();\n\n          unversionedCubeIris.push(unversionedIri);\n\n          return {\n            ...rest,\n            joinBy: rest.joinBy?.map((joinBy: string) =>\n              stringifyComponentId({\n                unversionedCubeIri: unversionedIri,\n                unversionedComponentIri: joinBy,\n              })\n            ),\n            filters: Object.fromEntries(\n              Object.entries(cube.filters).map(([k, v]) => [\n                stringifyComponentId({\n                  unversionedCubeIri: unversionedIri,\n                  unversionedComponentIri: k,\n                }),\n                v,\n              ])\n            ),\n          };\n        })\n      );\n\n      for (const [k, v] of Object.entries<any>(newConfig.fields)) {\n        if (typeof v !== \"object\") {\n          continue;\n        }\n\n        if (\"componentIris\" in v) {\n          v.componentIds = v.componentIris.map((iri: string) =>\n            isJoinById(iri)\n              ? iri\n              : stringifyComponentId({\n                  unversionedCubeIri: getClosestUnversionedCubeIri(iri),\n                  unversionedComponentIri: iri,\n                })\n          );\n          delete v.componentIris;\n        } else if (\"componentIri\" in v) {\n          v.componentId = isJoinById(v.componentIri)\n            ? v.componentIri\n            : v.componentIri\n              ? stringifyComponentId({\n                  unversionedCubeIri: getClosestUnversionedCubeIri(\n                    v.componentIri\n                  ),\n                  unversionedComponentIri: v.componentIri,\n                })\n              : \"\";\n          delete v.componentIri;\n        }\n\n        if (\"measureIri\" in v && v.measureIri !== FIELD_VALUE_NONE) {\n          v.measureId = isJoinById(v.measureIri)\n            ? v.measureIri\n            : v.measureIri\n              ? stringifyComponentId({\n                  unversionedCubeIri: getClosestUnversionedCubeIri(\n                    v.measureIri\n                  ),\n                  unversionedComponentIri: v.measureIri,\n                })\n              : \"\";\n          delete v.measureIri;\n        }\n\n        if (\n          (newConfig.chartType === \"comboLineColumn\" ||\n            newConfig.chartType === \"comboLineDual\" ||\n            newConfig.chartType === \"comboLineSingle\") &&\n          k === \"y\"\n        ) {\n          v.colorMapping = Object.fromEntries(\n            Object.entries(v.colorMapping).map(([k, v]) => [\n              stringifyComponentId({\n                unversionedCubeIri: getClosestUnversionedCubeIri(k),\n                unversionedComponentIri: k,\n              }),\n              v,\n            ])\n          );\n        }\n\n        // Maps\n        if (v.color && \"componentIri\" in v.color) {\n          v.color.componentId = isJoinById(v.color.componentIri)\n            ? v.color.componentIri\n            : stringifyComponentId({\n                unversionedCubeIri: getClosestUnversionedCubeIri(\n                  v.color.componentIri\n                ),\n                unversionedComponentIri: v.color.componentIri,\n              });\n          delete v.color.componentIri;\n        }\n\n        if (\"leftAxisComponentIri\" in v) {\n          v.leftAxisComponentId = isJoinById(v.leftAxisComponentIri)\n            ? v.leftAxisComponentIri\n            : stringifyComponentId({\n                unversionedCubeIri: getClosestUnversionedCubeIri(\n                  v.leftAxisComponentIri\n                ),\n                unversionedComponentIri: v.leftAxisComponentIri,\n              });\n          delete v.leftAxisComponentIri;\n        }\n\n        if (\"rightAxisComponentIri\" in v) {\n          v.rightAxisComponentId = isJoinById(v.rightAxisComponentIri)\n            ? v.rightAxisComponentIri\n            : stringifyComponentId({\n                unversionedCubeIri: getClosestUnversionedCubeIri(\n                  v.rightAxisComponentIri\n                ),\n                unversionedComponentIri: v.rightAxisComponentIri,\n              });\n          delete v.rightAxisComponentIri;\n        }\n\n        if (\"columnComponentIri\" in v) {\n          v.columnComponentId = isJoinById(v.columnComponentIri)\n            ? v.columnComponentIri\n            : stringifyComponentId({\n                unversionedCubeIri: getClosestUnversionedCubeIri(\n                  v.columnComponentIri\n                ),\n                unversionedComponentIri: v.columnComponentIri,\n              });\n          delete v.columnComponentIri;\n        }\n\n        if (\"lineComponentIri\" in v) {\n          v.lineComponentId = isJoinById(v.lineComponentIri)\n            ? v.lineComponentIri\n            : stringifyComponentId({\n                unversionedCubeIri: getClosestUnversionedCubeIri(\n                  v.lineComponentIri\n                ),\n                unversionedComponentIri: v.lineComponentIri,\n              });\n          delete v.lineComponentIri;\n        }\n\n        if (newConfig.chartType === \"table\") {\n          const componentId = isJoinById(k)\n            ? k\n            : stringifyComponentId({\n                unversionedCubeIri: getClosestUnversionedCubeIri(k),\n                unversionedComponentIri: k,\n              });\n          v.componentId = componentId;\n          delete v.componentIri;\n          newConfig.fields[componentId] = v;\n          delete newConfig.fields[k];\n        }\n      }\n\n      if (newConfig.chartType === \"table\") {\n        newConfig.sorting = newConfig.sorting.map((sorting: any) => {\n          const { componentIri, ...rest } = sorting;\n          return {\n            ...rest,\n            componentId: isJoinById(componentIri)\n              ? componentIri\n              : stringifyComponentId({\n                  unversionedCubeIri:\n                    getClosestUnversionedCubeIri(componentIri),\n                  unversionedComponentIri: componentIri,\n                }),\n          };\n        });\n      }\n\n      for (const v of Object.values<any>(\n        newConfig.interactiveFiltersConfig ?? {}\n      )) {\n        if (\"componentIris\" in v) {\n          v.componentIds = v.componentIris.map((iri: string) =>\n            isJoinById(iri)\n              ? iri\n              : stringifyComponentId({\n                  unversionedCubeIri: getClosestUnversionedCubeIri(iri),\n                  unversionedComponentIri: iri,\n                })\n          );\n          delete v.componentIris;\n        } else if (\"componentIri\" in v) {\n          v.componentId = isJoinById(v.componentIri)\n            ? v.componentIri\n            : v.componentIri\n              ? stringifyComponentId({\n                  unversionedCubeIri: getClosestUnversionedCubeIri(\n                    v.componentIri\n                  ),\n                  unversionedComponentIri: v.componentIri,\n                })\n              : \"\";\n          delete v.componentIri;\n        }\n      }\n\n      return newConfig;\n    },\n    down: async (config) => {\n      const newConfig = { ...config, version: \"3.4.0\" };\n\n      newConfig.cubes = newConfig.cubes.map(async (cube: any) => {\n        return {\n          ...cube,\n          joinBy: cube.joinBy?.map(\n            (joinBy: ComponentId) =>\n              parseComponentId(joinBy).unversionedComponentIri\n          ),\n          publishIri: cube.iri,\n          filters: Object.fromEntries(\n            Object.entries(cube.filters).map(([k, v]) => [\n              parseComponentId(k as ComponentId).unversionedComponentIri,\n              v,\n            ])\n          ),\n        };\n      });\n\n      for (const [_k, v] of Object.entries<any>(newConfig.fields)) {\n        if (typeof v !== \"object\") {\n          continue;\n        }\n\n        const k = _k as ComponentId;\n\n        if (\"componentIds\" in v) {\n          v.componentIris = v.componentIds.map(\n            (id: ComponentId) => parseComponentId(id).unversionedComponentIri\n          );\n          delete v.componentIds;\n        } else if (\"componentId\" in v) {\n          v.componentIri = v.componentId\n            ? parseComponentId(v.componentId).unversionedComponentIri\n            : \"\";\n          delete v.componentId;\n        }\n\n        if (\"measureId\" in v && v.measureId !== FIELD_VALUE_NONE) {\n          v.measureIri = v.measureId\n            ? parseComponentId(v.measureId).unversionedComponentIri\n            : \"\";\n          delete v.measureId;\n        }\n\n        if (\n          (newConfig.chartType === \"comboLineColumn\" ||\n            newConfig.chartType === \"comboLineDual\" ||\n            newConfig.chartType === \"comboLineSingle\") &&\n          k === \"y\"\n        ) {\n          v.colorMapping = Object.fromEntries(\n            Object.entries(v.colorMapping).map(([k, v]) => [\n              parseComponentId(k as ComponentId).unversionedComponentIri,\n              v,\n            ])\n          );\n        }\n\n        // Maps\n        if (v.color && \"componentId\" in v.color) {\n          v.color.componentIri = parseComponentId(\n            v.color.componentId\n          ).unversionedComponentIri;\n          delete v.color.componentId;\n        }\n\n        if (\"leftAxisComponentId\" in v) {\n          v.leftAxisComponentIri = parseComponentId(\n            v.leftAxisComponentId\n          ).unversionedComponentIri;\n          delete v.leftAxisComponentId;\n        }\n\n        if (\"rightAxisComponentId\" in v) {\n          v.rightAxisComponentIri = parseComponentId(\n            v.rightAxisComponentId\n          ).unversionedComponentIri;\n          delete v.rightAxisComponentId;\n        }\n\n        if (\"columnComponentId\" in v) {\n          v.columnComponentIri = parseComponentId(\n            v.columnComponentId\n          ).unversionedComponentIri;\n          delete v.columnComponentId;\n        }\n\n        if (\"lineComponentId\" in v) {\n          v.lineComponentIri = parseComponentId(\n            v.lineComponentId\n          ).unversionedComponentIri;\n          delete v.lineComponentId;\n        }\n\n        if (newConfig.chartType === \"table\") {\n          const componentIri = parseComponentId(k)\n            .unversionedComponentIri as string;\n          v.componentIri = componentIri;\n          delete v.componentId;\n          newConfig.fields[componentIri] = v;\n          delete newConfig.fields[k];\n        }\n      }\n\n      for (const v of Object.values<any>(\n        newConfig.interactiveFiltersConfig ?? {}\n      )) {\n        if (\"componentIds\" in v) {\n          v.componentIris = v.componentIds.map(\n            (id: ComponentId) => parseComponentId(id).unversionedComponentIri\n          );\n          delete v.componentIds;\n        } else if (\"componentId\" in v) {\n          v.componentIri = v.componentId\n            ? parseComponentId(v.componentId).unversionedComponentIri\n            : \"\";\n          delete v.componentId;\n        }\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      cubes {\n        - joinBy: null\n      }\n      fields {\n        segment {\n          - colorMapping\n        }\n        y {\n          - colorMapping\n        }\n        + color {\n          + type\n          + paletteId\n          + colorMapping / color\n        }\n      }\n    }`,\n    from: \"4.0.0\",\n    to: \"4.1.0\",\n    up: (config) => {\n      const newConfig = {\n        ...config,\n        version: \"4.1.0\",\n      };\n\n      // Fixes some rare cases of joinBy being null, when a cube was joined and\n      // un-joined. Previously we kept the undefined field there, which was\n      // converted to null via the database saving / fetching process, now we\n      // remove the property entirely when removing a dataset.\n      newConfig.cubes.forEach((cube: any) => {\n        if (cube.joinBy === null) {\n          delete cube.joinBy;\n        }\n      });\n\n      if (newConfig.chartType === \"table\") {\n        return newConfig;\n      }\n\n      if (newConfig.chartType === \"map\") {\n        if (\n          newConfig.fields.areaLayer?.color &&\n          \"palette\" in newConfig.fields.areaLayer.color\n        ) {\n          newConfig.fields.areaLayer.color.paletteId =\n            newConfig.fields.areaLayer.color.palette;\n          delete newConfig.fields.areaLayer.color.palette;\n        }\n\n        if (\n          newConfig.fields.symbolLayer?.color &&\n          \"palette\" in newConfig.fields.symbolLayer.color\n        ) {\n          newConfig.fields.symbolLayer.color.paletteId =\n            newConfig.fields.symbolLayer.color.palette;\n          delete newConfig.fields.symbolLayer.color.palette;\n        }\n\n        return newConfig;\n      }\n\n      if (!newConfig.fields?.color) {\n        const hasColorMapping = !!(\n          newConfig.fields?.y?.colorMapping ||\n          newConfig.fields?.segment?.colorMapping\n        );\n\n        if (!hasColorMapping) {\n          newConfig.fields = {\n            ...newConfig.fields,\n            color: {\n              type: \"single\",\n              paletteId: \"category10\",\n              color: schemeCategory10[0],\n            },\n          };\n        }\n      }\n\n      if (newConfig.fields?.segment?.colorMapping) {\n        newConfig.fields = {\n          ...newConfig.fields,\n          color: {\n            type: \"segment\",\n            paletteId: newConfig.fields.segment.palette || \"category10\",\n            colorMapping: newConfig.fields.segment.colorMapping,\n          },\n        };\n        delete newConfig.fields.segment.colorMapping;\n        delete newConfig.fields.segment.palette;\n      }\n\n      if (newConfig.fields?.y?.colorMapping) {\n        newConfig.fields = {\n          ...newConfig.fields,\n          color: {\n            type: \"measures\",\n            paletteId: newConfig.fields.y.palette || \"category10\",\n            colorMapping: newConfig.fields.y.colorMapping,\n          },\n        };\n        delete newConfig.fields.y.colorMapping;\n        delete newConfig.fields.y.palette;\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = {\n        ...config,\n        version: \"4.0.0\",\n      };\n\n      if (newConfig.chartType === \"table\") {\n        return newConfig;\n      }\n\n      if (newConfig.chartType === \"map\") {\n        if (\n          newConfig.fields.areaLayer?.color &&\n          \"paletteId\" in newConfig.fields.areaLayer.color\n        ) {\n          newConfig.fields.areaLayer.color.palette =\n            newConfig.fields.areaLayer.color.paletteId;\n          delete newConfig.fields.areaLayer.color.paletteId;\n        }\n\n        if (\n          newConfig.fields.symbolLayer?.color &&\n          \"paletteId\" in newConfig.fields.symbolLayer.color\n        ) {\n          newConfig.fields.symbolLayer.color.palette =\n            newConfig.fields.symbolLayer.color.paletteId;\n          delete newConfig.fields.symbolLayer.color.paletteId;\n        }\n\n        return newConfig;\n      }\n\n      if (newConfig.fields?.color) {\n        if (newConfig.fields.color.type === \"segment\") {\n          newConfig.fields = {\n            ...newConfig.fields,\n            segment: {\n              ...newConfig.fields.segment,\n              colorMapping: newConfig.fields.color.colorMapping,\n              palette: newConfig.fields.color.paletteId,\n            },\n          };\n        }\n\n        if (newConfig.fields.color.type === \"measures\") {\n          newConfig.fields = {\n            ...newConfig.fields,\n            y: {\n              ...newConfig.fields.y,\n              colorMapping: newConfig.fields.color.colorMapping,\n              palette: newConfig.fields.color.paletteId,\n            },\n          };\n        }\n\n        delete newConfig.fields.color;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"4.1.0\",\n    to: \"4.2.0\",\n    description: `all {\n      + limits\n    }`,\n    up: (config) => {\n      const newConfig = { ...config, version: \"4.2.0\" };\n\n      newConfig.limits = {};\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"4.1.0\" };\n\n      delete newConfig.limits;\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"4.2.0\",\n    to: \"4.3.0\",\n    description: `maps {\n      baseLayer {\n        + customLayers\n      }\n    }`,\n    up: (config) => {\n      const newConfig = { ...config, version: \"4.3.0\" };\n\n      if (newConfig.chartType === \"map\") {\n        newConfig.baseLayer.customLayers = [];\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"4.2.0\" };\n\n      if (newConfig.chartType === \"map\") {\n        delete newConfig.baseLayer.customLayers;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"4.3.0\",\n    to: \"4.4.0\",\n    description: `all {\n      fields {\n        segment {\n          + showValuesMapping\n        }\n      }\n    }`,\n    up: (config) => {\n      const newConfig = { ...config, version: \"4.4.0\" };\n\n      if (newConfig.fields.segment) {\n        newConfig.fields.segment.showValuesMapping = {};\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"4.3.0\" };\n\n      if (newConfig.fields.segment) {\n        delete newConfig.fields.segment.showValuesMapping;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"4.4.0\",\n    to: \"4.5.0\",\n    description: `all {\n      + conversionUnitsByComponentId\n    }`,\n    up: (config) => {\n      const newConfig = { ...config, version: \"4.5.0\" };\n\n      newConfig.conversionUnitsByComponentId = {};\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"4.4.0\" };\n\n      if (newConfig.conversionUnitsByComponentId) {\n        delete newConfig.conversionUnitsByComponentId;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"4.5.0\",\n    to: \"4.6.0\",\n    description: `ALL {\n      interactiveFiltersConfig can't be undefined anymore\n    }`,\n    up: (config) => {\n      const newConfig = { ...config, version: \"4.6.0\" };\n\n      if (!newConfig.interactiveFiltersConfig) {\n        newConfig.interactiveFiltersConfig = {\n          legend: {\n            active: false,\n            componentId: \"\",\n          },\n          timeRange: {\n            active: false,\n            componentId: \"\",\n            presets: {\n              type: \"range\",\n              from: \"\",\n              to: \"\",\n            },\n          },\n          dataFilters: {\n            active: false,\n            componentIds: [],\n            defaultValueOverrides: {},\n            filterTypes: {},\n            defaultOpen: true,\n          },\n          calculation: {\n            active: false,\n            type: \"identity\",\n          },\n        };\n      } else {\n        newConfig.interactiveFiltersConfig.dataFilters.defaultValueOverrides =\n          {};\n        newConfig.interactiveFiltersConfig.dataFilters.filterTypes =\n          Object.fromEntries(\n            newConfig.interactiveFiltersConfig.dataFilters.componentIds.map(\n              (id: string) => [id, \"single\"]\n            )\n          );\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"4.5.0\" };\n\n      if (newConfig.chartType === \"table\") {\n        newConfig.interactiveFiltersConfig = undefined;\n      } else if (newConfig.interactiveFiltersConfig) {\n        delete newConfig.interactiveFiltersConfig.dataFilters\n          .defaultValueOverrides;\n        delete newConfig.interactiveFiltersConfig.dataFilters.filterTypes;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"4.6.0\",\n    to: \"5.0.0\",\n    description: `all {\n        + annotations\n      }\n    `,\n    up: (config) => {\n      const newConfig = { ...config, version: \"5.0.0\" };\n      newConfig.annotations = [];\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"4.5.0\" };\n      delete newConfig.annotations;\n\n      return newConfig;\n    },\n  },\n  {\n    from: \"5.0.0\",\n    to: \"5.1.0\",\n    description: `table chart {\n      links {\n        + enabled\n        + baseUrl\n        + componentId\n      }\n    }`,\n    up: (config) => {\n      const newConfig = { ...config, version: \"5.1.0\" };\n\n      if (newConfig.chartType === \"table\") {\n        newConfig.links = {\n          enabled: false,\n          baseUrl: \"\",\n          componentId: \"\",\n          targetComponentId: \"\",\n        };\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"5.0.0\" };\n\n      if (newConfig.chartType === \"table\") {\n        delete newConfig.links;\n      }\n\n      return newConfig;\n    },\n  },\n];\n\nexport const migrateChartConfig = makeMigrate<ChartConfig>(\n  chartConfigMigrations,\n  {\n    defaultToVersion: CHART_CONFIG_VERSION,\n  }\n);\n\nconst makeBumpChartConfigVersionMigration = ({\n  fromVersion,\n  toVersion,\n  fromChartConfigVersion,\n  toChartConfigVersion,\n}: {\n  fromVersion: string;\n  toVersion: string;\n  fromChartConfigVersion: string;\n  toChartConfigVersion: string;\n}): Migration => {\n  return {\n    description: \"ALL (bump ChartConfig version)\",\n    from: fromVersion,\n    to: toVersion,\n    up: async (config) => {\n      const newConfig = { ...config, version: toVersion };\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        const migratedChartConfig = await migrateChartConfig(chartConfig, {\n          migrationProps: newConfig,\n          toVersion: toChartConfigVersion,\n        });\n        chartConfigs.push(migratedChartConfig);\n      }\n\n      newConfig.chartConfigs = chartConfigs;\n\n      return newConfig;\n    },\n    down: async (config) => {\n      const newConfig = { ...config, version: fromVersion };\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        const migratedChartConfig = await migrateChartConfig(chartConfig, {\n          migrationProps: newConfig,\n          toVersion: fromChartConfigVersion,\n        });\n        chartConfigs.push(migratedChartConfig);\n      }\n\n      newConfig.chartConfigs = chartConfigs;\n\n      return newConfig;\n    },\n  };\n};\n\nexport const configuratorStateMigrations: Migration[] = [\n  {\n    description: \"ALL\",\n    from: \"1.0.0\",\n    to: \"2.0.0\",\n    up: async (config) => {\n      const newConfig = { ...config, version: \"2.0.0\" };\n\n      const migratedChartConfig = await migrateChartConfig(\n        newConfig.chartConfig,\n        {\n          migrationProps: newConfig,\n          toVersion: \"2.0.0\",\n        }\n      );\n      newConfig.chartConfigs = [migratedChartConfig];\n      delete newConfig.chartConfig;\n      delete newConfig.activeField;\n      newConfig.meta = {\n        title: {\n          de: \"\",\n          fr: \"\",\n          it: \"\",\n          en: \"\",\n        },\n        description: {\n          de: \"\",\n          fr: \"\",\n          it: \"\",\n          en: \"\",\n        },\n      };\n      newConfig.activeChartKey = migratedChartConfig.key;\n\n      return newConfig;\n    },\n    down: async (config: any) => {\n      const newConfig = { ...config, version: \"1.0.0\" };\n      const chartConfig = newConfig.chartConfigs[0];\n      delete newConfig.chartConfigs;\n      delete newConfig.activeChartKey;\n      newConfig.meta = chartConfig.meta;\n      newConfig.activeField = chartConfig.activeField;\n      const migratedChartConfig = await migrateChartConfig(chartConfig, {\n        toVersion: \"1.4.2\",\n      });\n      newConfig.chartConfig = migratedChartConfig;\n\n      return newConfig;\n    },\n  },\n  {\n    description: \"ALL\",\n    from: \"2.0.0\",\n    to: \"3.0.0\",\n    up: async (config) => {\n      const newConfig = { ...config, version: \"3.0.0\" };\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        const migratedChartConfig = await migrateChartConfig(chartConfig, {\n          migrationProps: newConfig,\n          toVersion: \"2.3.0\",\n        });\n        chartConfigs.push(migratedChartConfig);\n      }\n\n      delete newConfig.dataSet;\n      newConfig.chartConfigs = chartConfigs;\n\n      return newConfig;\n    },\n    down: async (config) => {\n      const newConfig = { ...config, version: \"2.0.0\" };\n      let dataSet: string | undefined;\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        if (!dataSet) {\n          dataSet = chartConfig.dataSet;\n        }\n\n        // Only migrate chartConfigs with the same dataSet as configuratorState.\n        if (chartConfig.dataSet === dataSet) {\n          const migratedChartConfig = await migrateChartConfig(chartConfig, {\n            migrationProps: newConfig,\n            toVersion: \"2.2.0\",\n          });\n          chartConfigs.push(migratedChartConfig);\n        } else {\n          console.warn(\n            \"Cannot migrate chartConfig dataSet to configuratorState dataSet because they are not the same.\"\n          );\n        }\n      }\n\n      newConfig.dataSet = dataSet;\n\n      return newConfig;\n    },\n  },\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"3.0.0\",\n    toVersion: \"3.0.1\",\n    fromChartConfigVersion: \"2.3.0\",\n    toChartConfigVersion: \"3.0.0\",\n  }),\n  {\n    description: \"ALL + layout\",\n    from: \"3.0.1\",\n    to: \"3.1.0\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"3.1.0\" };\n      newConfig.layout = {\n        type: \"tab\",\n        meta: newConfig.meta,\n        activeField: undefined,\n      };\n      delete newConfig.meta;\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"3.0.1\" };\n      newConfig.meta = newConfig.layout.meta ?? {\n        title: {\n          de: \"\",\n          fr: \"\",\n          it: \"\",\n          en: \"\",\n        },\n        description: {\n          de: \"\",\n          fr: \"\",\n          it: \"\",\n          en: \"\",\n        },\n      };\n      delete newConfig.layout;\n\n      return newConfig;\n    },\n  },\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"3.1.0\",\n    toVersion: \"3.2.0\",\n    fromChartConfigVersion: \"3.1.0\",\n    toChartConfigVersion: \"3.2.0\",\n  }),\n  {\n    description: \"ALL (add dataSource in case it's missing)\",\n    from: \"3.2.0\",\n    to: \"3.2.1\",\n    up: (config) => {\n      const newConfig = { ...config, version: \"3.2.1\" };\n\n      if (!newConfig.dataSource) {\n        newConfig.dataSource = {\n          type: \"sparql\",\n          url: PROD_DATA_SOURCE_URL,\n        };\n      } else if (newConfig.dataSource.url === LEGACY_PROD_DATA_SOURCE_URL) {\n        newConfig.dataSource.url = PROD_DATA_SOURCE_URL;\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"3.2.0\" };\n\n      return newConfig;\n    },\n  },\n  {\n    description: \"ALL (add dashboardFilters)\",\n    from: \"3.2.1\",\n    to: \"3.3.0\",\n    up: (config) => {\n      const newConfig = {\n        ...config,\n        version: \"3.3.0\",\n        dashboardFilters: {\n          filters: [],\n        },\n      };\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = { ...config, version: \"3.2.1\" };\n      delete newConfig.dashboardFilters;\n\n      return newConfig;\n    },\n  },\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"3.3.0\",\n    toVersion: \"3.4.0\",\n    fromChartConfigVersion: \"3.2.0\",\n    toChartConfigVersion: \"3.3.0\",\n  }),\n  {\n    description: \"ALL (modify dashboardFilters)\",\n    from: \"3.4.0\",\n    to: \"3.5.0\",\n    up: (config) => {\n      const oldTimeRangeFilter = config.dashboardFilters.filters[0];\n      const newConfig = {\n        ...config,\n        version: \"3.5.0\",\n        dashboardFilters: {\n          timeRange: oldTimeRangeFilter\n            ? {\n                active: oldTimeRangeFilter.active,\n                timeUnit: \"\",\n                presets: {\n                  from: oldTimeRangeFilter.from ?? \"\",\n                  to: oldTimeRangeFilter.to ?? \"\",\n                },\n              }\n            : {\n                active: false,\n                timeUnit: \"\",\n                presets: {\n                  from: \"\",\n                  to: \"\",\n                },\n              },\n        },\n      };\n\n      return newConfig;\n    },\n    down: (config) => {\n      const oldTimeRangeFilter = config.dashboardFilters.timeRange;\n      const newConfig = {\n        ...config,\n        version: \"3.4.0\",\n        dashboardFilters: {\n          filters: [\n            {\n              type: \"timeRange\",\n              active: oldTimeRangeFilter.active,\n              componentIri: \"\",\n              presets: {\n                type: \"range\",\n                from: oldTimeRangeFilter.presets.from,\n                to: oldTimeRangeFilter.presets.to,\n              },\n            },\n          ],\n        },\n      };\n\n      return newConfig;\n    },\n  },\n  {\n    description: \"ALL (modify dashboardFilters)\",\n    from: \"3.5.0\",\n    to: \"3.6.0\",\n    up: (config) => {\n      const newConfig = {\n        ...config,\n        version: \"3.6.0\",\n        dashboardFilters: {\n          ...config.dashboardFilters,\n          dataFilters: {\n            componentIris: [],\n            filters: {},\n          },\n        },\n      };\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = {\n        ...config,\n        version: \"3.5.0\",\n        dashboardFilters: {\n          timeRange: config.dashboardFilters.timeRange,\n        },\n      };\n\n      return newConfig;\n    },\n  },\n  {\n    description: `ALL {\n      meta {\n        + label\n      }\n    } & bump ChartConfig version`,\n    from: \"3.6.0\",\n    to: \"3.7.0\",\n    up: async (config) => {\n      const { layout, ...rest } = config;\n      const { meta, ...restLayout } = layout;\n      const newConfig = {\n        ...rest,\n        version: \"3.7.0\",\n        layout: {\n          ...restLayout,\n          meta: {\n            ...meta,\n            label: {\n              de: \"\",\n              fr: \"\",\n              it: \"\",\n              en: \"\",\n            },\n          },\n        },\n      };\n\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        const migratedChartConfig = await migrateChartConfig(chartConfig, {\n          migrationProps: newConfig,\n          toVersion: \"3.4.0\",\n        });\n        chartConfigs.push(migratedChartConfig);\n      }\n\n      newConfig.chartConfigs = chartConfigs;\n\n      return newConfig;\n    },\n    down: async (config) => {\n      const { layout, ...rest } = config;\n      const { meta, ...restLayout } = layout.meta;\n      const { label, ...restMeta } = meta;\n      const newConfig = {\n        ...rest,\n        version: \"3.6.0\",\n        layout: {\n          ...restLayout,\n          meta: restMeta,\n        },\n      };\n\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        const migratedChartConfig = await migrateChartConfig(chartConfig, {\n          migrationProps: newConfig,\n          toVersion: \"3.3.0\",\n        });\n        chartConfigs.push(migratedChartConfig);\n      }\n\n      newConfig.chartConfigs = chartConfigs;\n\n      return newConfig;\n    },\n  },\n  {\n    description: \"ALL (add layoutsMetadata to free canvas layout)\",\n    from: \"3.7.0\",\n    to: \"3.8.0\",\n    up: (config) => {\n      const newConfig = {\n        ...config,\n        version: \"3.8.0\",\n      };\n\n      if (\n        newConfig.layout.type === \"dashboard\" &&\n        newConfig.layout.layout === \"canvas\"\n      ) {\n        newConfig.layout.layoutsMetadata = newConfig.chartConfigs.reduce(\n          (acc: any, chartConfig: any) => {\n            acc[chartConfig.key] = {\n              initialized: true,\n            };\n            return acc;\n          },\n          {}\n        );\n      }\n\n      return newConfig;\n    },\n    down: (config) => {\n      const newConfig = {\n        ...config,\n        version: \"3.7.0\",\n      };\n\n      if (\n        newConfig.layout.type === \"dashboard\" &&\n        newConfig.layout.layout === \"canvas\"\n      ) {\n        delete newConfig.layout.layoutsMetadata;\n      }\n\n      return newConfig;\n    },\n  },\n  {\n    description: \"ALL (bump ChartConfig version) + migrate dataFilters\",\n    from: \"3.8.0\",\n    to: \"4.0.0\",\n    up: async (config) => {\n      const newConfig = { ...config, version: \"4.0.0\" };\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        const migratedChartConfig = await migrateChartConfig(chartConfig, {\n          migrationProps: newConfig,\n          toVersion: \"4.0.0\",\n        });\n        chartConfigs.push(migratedChartConfig);\n      }\n\n      newConfig.chartConfigs = chartConfigs;\n\n      const dataFilters = newConfig.dashboardFilters.dataFilters;\n\n      for (const cIri of dataFilters.componentIris) {\n        cubeLoop: for (const cube of newConfig.chartConfigs.flatMap(\n          (c: any) => c.cubes\n        )) {\n          for (const fId of Object.keys(cube.filters)) {\n            if (fId.includes(cIri)) {\n              dataFilters.componentIris = [\n                ...dataFilters.componentIris.filter((c: string) => c !== cIri),\n                fId,\n              ];\n              dataFilters.filters[fId] = dataFilters.filters[cIri];\n              delete dataFilters.filters[cIri];\n              break cubeLoop;\n            }\n          }\n        }\n      }\n\n      dataFilters.componentIds = dataFilters.componentIris;\n      delete dataFilters.componentIris;\n      newConfig.dashboardFilters.dataFilters = dataFilters;\n\n      return newConfig;\n    },\n    down: async (config) => {\n      const newConfig = { ...config, version: \"3.8.0\" };\n      const chartConfigs = [];\n\n      for (const chartConfig of newConfig.chartConfigs) {\n        const migratedChartConfig = await migrateChartConfig(chartConfig, {\n          migrationProps: newConfig,\n          toVersion: \"3.4.0\",\n        });\n        chartConfigs.push(migratedChartConfig);\n      }\n\n      newConfig.chartConfigs = chartConfigs;\n\n      const dataFilters = newConfig.dashboardFilters.dataFilters;\n\n      for (const cId of dataFilters.componentIds) {\n        dataFilters.componentIds = [\n          ...dataFilters.componentIds.filter((c: string) => c !== cId),\n          parseComponentId(cId).unversionedComponentIri,\n        ];\n      }\n\n      for (const fId of Object.keys(dataFilters.filters)) {\n        dataFilters.filters[\n          parseComponentId(fId as ComponentId).unversionedComponentIri as string\n        ] = dataFilters.filters[fId];\n        delete dataFilters.filters[fId];\n      }\n\n      dataFilters.componentIris = dataFilters.componentIds;\n      delete dataFilters.componentIds;\n      newConfig.dashboardFilters.dataFilters = dataFilters;\n\n      return newConfig;\n    },\n  },\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"4.0.0\",\n    toVersion: \"4.1.0\",\n    fromChartConfigVersion: \"4.0.0\",\n    toChartConfigVersion: \"4.1.0\",\n  }),\n  {\n    description: `ALL {\n      layout {\n        + blocks\n        - layoutsMetadata\n      }\n    }`,\n    from: \"4.1.0\",\n    to: \"4.2.0\",\n    up: async (config) => {\n      const newConfig = { ...config, version: \"4.2.0\" };\n\n      if (newConfig.layout.layoutsMetadata) {\n        delete newConfig.layout.layoutsMetadata;\n      }\n\n      newConfig.layout.blocks = newConfig.chartConfigs.map(\n        (chartConfig: any) => {\n          return {\n            type: \"chart\",\n            key: chartConfig.key,\n            initialized: false,\n          };\n        }\n      );\n\n      return newConfig;\n    },\n    down: async (config) => {\n      const newConfig = { ...config, version: \"4.1.0\" };\n\n      if (\n        newConfig.layout.type === \"dashboard\" &&\n        newConfig.layout.layout === \"canvas\"\n      ) {\n        newConfig.layout.layoutsMetadata = Object.fromEntries(\n          newConfig.layout.blocks.map((block: any) => {\n            const { key, initialized } = block;\n            return [key, { initialized }];\n          })\n        );\n      }\n\n      delete newConfig.layout.blocks;\n\n      return newConfig;\n    },\n  },\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"4.2.0\",\n    toVersion: \"4.3.0\",\n    fromChartConfigVersion: \"4.1.0\",\n    toChartConfigVersion: \"4.2.0\",\n  }),\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"4.3.0\",\n    toVersion: \"4.4.0\",\n    fromChartConfigVersion: \"4.2.0\",\n    toChartConfigVersion: \"4.3.0\",\n  }),\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"4.4.0\",\n    toVersion: \"4.5.0\",\n    fromChartConfigVersion: \"4.3.0\",\n    toChartConfigVersion: \"4.4.0\",\n  }),\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"4.5.0\",\n    toVersion: \"4.6.0\",\n    fromChartConfigVersion: \"4.4.0\",\n    toChartConfigVersion: \"4.5.0\",\n  }),\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"4.6.0\",\n    toVersion: \"4.7.0\",\n    fromChartConfigVersion: \"4.5.0\",\n    toChartConfigVersion: \"4.6.0\",\n  }),\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"4.7.0\",\n    toVersion: \"5.0.0\",\n    fromChartConfigVersion: \"4.6.0\",\n    toChartConfigVersion: \"5.0.0\",\n  }),\n  makeBumpChartConfigVersionMigration({\n    fromVersion: \"5.0.0\",\n    toVersion: \"5.1.0\",\n    fromChartConfigVersion: \"5.0.0\",\n    toChartConfigVersion: \"5.1.0\",\n  }),\n];\n\nexport const migrateConfiguratorState = makeMigrate<ConfiguratorState>(\n  configuratorStateMigrations,\n  {\n    defaultToVersion: CONFIGURATOR_STATE_VERSION,\n  }\n);\n\nfunction makeMigrate<V>(\n  migrations: Migration[],\n  options: { defaultToVersion: string }\n) {\n  const { defaultToVersion } = options;\n\n  return async (\n    data: any,\n    options: {\n      fromVersion?: string;\n      toVersion?: string;\n      migrationProps?: any;\n    } = {}\n  ): Promise<V> => {\n    const {\n      fromVersion,\n      toVersion = defaultToVersion,\n      migrationProps,\n    } = options;\n    const migrate = async (\n      data: any,\n      {\n        fromVersion,\n      }: {\n        fromVersion?: string;\n      } = {}\n    ): Promise<any> => {\n      const fromVersionFinal = fromVersion ?? data.version ?? \"1.0.0\";\n      const direction = upOrDown(fromVersionFinal, toVersion);\n\n      if (direction === \"same\") {\n        return data;\n      }\n\n      const migration = migrations.find(\n        (d) => d[direction === \"up\" ? \"from\" : \"to\"] === fromVersionFinal\n      );\n\n      if (migration) {\n        const newData = await migration[direction](data, migrationProps);\n        return await migrate(newData, { fromVersion });\n      }\n    };\n\n    return await migrate(data, { fromVersion });\n  };\n}\n\nexport const upOrDown = (\n  fromVersion: string,\n  toVersion: string\n): \"up\" | \"down\" | \"same\" => {\n  const fromNumbers = fromVersion.split(\".\").map((d) => +d);\n  const toNumbers = toVersion.split(\".\").map((d) => +d);\n\n  for (let i = 0; i < fromNumbers.length; i++) {\n    if (fromNumbers[i] < toNumbers[i]) {\n      return \"up\";\n    }\n\n    if (fromNumbers[i] > toNumbers[i]) {\n      return \"down\";\n    }\n  }\n\n  return \"same\";\n};\n","import { nanoid } from \"nanoid\";\n\nexport const createId = () => nanoid(12);\n","type Object = Record<string, any>;\n\nconst KEY_SEPARATOR = \"__SEP__\";\nconst VALUE_SEPARATOR = \"=\";\nconst JOIN_SEPARATOR = \"||\";\nconst NUMBER_PREFIX = \"__NUM__\";\nconst NEWLINE_REPLACEMENT = \"__NL__\";\n\n/** Converts an object into a URL-friendly hash string. */\nexport const objectToHashString = (o: Object) => {\n  return `#${objectToKeyValuePairs(o).join(JOIN_SEPARATOR)}`;\n};\n\n/** Converts a URL-friendly hash string back into the original object. */\nexport const hashStringToObject = (hashString: string) => {\n  return keyValuePairsToObject(\n    decodeURIComponent(hashString.slice(1)).split(JOIN_SEPARATOR)\n  );\n};\n\nconst objectToKeyValuePairs = (o: Object) => {\n  const flatObject = flattenObject(o);\n  return Object.entries(flatObject).map(([k, v]) => {\n    return `${k}${VALUE_SEPARATOR}${v}`;\n  });\n};\n\nconst keyValuePairsToObject = (keyValuePairs: string[]) => {\n  const o: Object = {};\n  keyValuePairs.forEach((kv) => {\n    // Make sure we allow equal signs in the value - the first one is the actual separator.\n    const firstEqualIndex = kv.indexOf(VALUE_SEPARATOR);\n\n    if (firstEqualIndex === -1) {\n      return;\n    }\n\n    const k = kv.slice(0, firstEqualIndex);\n    const v = kv.slice(firstEqualIndex + 1);\n    o[k] = v;\n  });\n\n  return unflattenObject(o);\n};\n\nconst flattenObject = (o: Object, parentKey = \"\", result: Object = {}) => {\n  if (\n    typeof o === \"object\" &&\n    o !== null &&\n    !Array.isArray(o) &&\n    Object.keys(o).length === 0\n  ) {\n    result[parentKey] = \"{}\";\n\n    return result;\n  }\n\n  for (const k in o) {\n    if (o.hasOwnProperty(k)) {\n      const newKey = parentKey ? `${parentKey}${KEY_SEPARATOR}${k}` : k;\n      const v = o[k];\n\n      if (typeof v === \"object\" && v !== null && !Array.isArray(v)) {\n        if (Object.keys(v).length === 0) {\n          result[newKey] = \"{}\";\n        } else {\n          flattenObject(v, newKey, result);\n        }\n      } else if (Array.isArray(v)) {\n        if (v.length === 0) {\n          result[newKey] = \"[]\";\n        } else {\n          v.forEach((item, index) => {\n            const arrayKey = `${newKey}${KEY_SEPARATOR}${index}`;\n            if (typeof item === \"object\" && item !== null) {\n              flattenObject(item, arrayKey, result);\n            } else {\n              result[arrayKey] =\n                typeof item === \"string\"\n                  ? item.replace(/\\n/g, NEWLINE_REPLACEMENT)\n                  : `${item}`;\n            }\n          });\n        }\n      } else {\n        result[newKey] =\n          typeof v === \"number\"\n            ? `${NUMBER_PREFIX}${v}`\n            : typeof v === \"string\"\n              ? v.replace(/\\n/g, NEWLINE_REPLACEMENT)\n              : `${v}`;\n      }\n    }\n  }\n  return result;\n};\n\nconst parseValue = (v: any) => {\n  if (v === \"true\") return true;\n  if (v === \"false\") return false;\n  if (v === \"null\") return null;\n  if (v === \"undefined\") return undefined;\n  if (v === \"[]\") return [];\n  if (v === \"{}\") return {};\n  if (typeof v === \"string\" && v.startsWith(NUMBER_PREFIX)) {\n    const num = v.slice(NUMBER_PREFIX.length);\n\n    if (num !== \"\" && !isNaN(+num)) {\n      return +num;\n    }\n  }\n\n  if (typeof v === \"string\") {\n    return v.replace(new RegExp(NEWLINE_REPLACEMENT, \"g\"), \"\\n\");\n  }\n\n  return v;\n};\n\nconst unflattenObject = (o: Object) => {\n  const result: Object = {};\n\n  for (const rootKey in o) {\n    if (o.hasOwnProperty(rootKey)) {\n      const keys = rootKey.split(KEY_SEPARATOR);\n      keys.reduce((acc, k, i) => {\n        if (i === keys.length - 1) {\n          acc[k] = o[rootKey];\n        } else {\n          if (!(k in acc)) {\n            acc[k] = {};\n          }\n\n          return acc[k];\n        }\n\n        return acc;\n      }, result);\n    }\n  }\n\n  const transformArraysAndScalars = (obj: any) => {\n    if (typeof obj !== \"object\" || obj === null) {\n      return parseValue(obj);\n    }\n\n    for (const k in obj) {\n      if (obj.hasOwnProperty(k)) {\n        obj[k] = transformArraysAndScalars(obj[k]);\n      }\n    }\n\n    const keys = Object.keys(obj);\n\n    if (keys.length > 0 && keys.every((k) => !isNaN(Number(k)))) {\n      const sortedKeys = keys.sort((a, b) => Number(a) - Number(b));\n      const arr = sortedKeys.map((numKey) => obj[numKey]);\n\n      return arr;\n    }\n\n    return obj;\n  };\n\n  return transformArraysAndScalars(result);\n};\n","import { SelectTreeProps } from \"@/components/select-tree\";\nimport { DimensionValue, HierarchyValue } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { sortHierarchy } from \"@/rdf/tree-utils\";\n\nexport const hierarchyToOptions = (\n  hierarchy: HierarchyValue[],\n  possibleValues: DimensionValue[\"value\"][]\n) => {\n  const possibleValuesSet = possibleValues\n    ? new Set(possibleValues)\n    : undefined;\n  const transform = (\n    h: HierarchyValue\n  ): SelectTreeProps[\"options\"][number] | undefined => {\n    const children =\n      h.children && h.children.length > 0\n        ? h.children.map(transform).filter(truthy)\n        : undefined;\n\n    // Keep the value only if part of possibleValues or if it has children\n    if (\n      possibleValuesSet &&\n      !possibleValuesSet.has(h.value) &&\n      (!children || children.length === 0)\n    ) {\n      return undefined;\n    }\n    return {\n      ...h,\n      selectable: !!h.hasValue,\n      children,\n    };\n  };\n\n  return sortHierarchy(hierarchy).map(transform).filter(truthy);\n};\n\nexport const isMultiHierarchyNode = (hv: HierarchyValue) => {\n  // A bit hackish but should be fine for now\n  return hv.depth === -1;\n};\n","import { ReactNode } from \"react\";\n\nexport const interlace = <T extends unknown, I extends ReactNode>(\n  arr: T[],\n  interlacer: I | ((i: number) => I)\n) => {\n  const res = new Array(Math.max(arr.length * 2 - 1, 0));\n  for (let i = 0; i < arr.length; i++) {\n    res[i * 2] = arr[i];\n    if (i < arr.length - 1) {\n      res[i * 2 + 1] =\n        typeof interlacer === \"function\" ? interlacer(i) : interlacer;\n    }\n  }\n  return res;\n};\n","import { ascending, bisect } from \"d3-array\";\nimport { scaleLinear } from \"d3-scale\";\n\nimport { AnimationType } from \"@/config-types\";\n\nexport abstract class Observable {\n  private observers: Function[];\n\n  constructor() {\n    this.observers = [];\n  }\n\n  /** Used to keeping track of when to update the components using this. */\n  abstract getUpdateKey: () => string;\n\n  public subscribe = (fn: Function) => {\n    this.observers.push(fn);\n\n    return () => this.unsubscribe(fn);\n  };\n\n  public unsubscribe = (fn: Function) => {\n    this.observers = this.observers.filter((d) => d !== fn);\n  };\n\n  protected notify = () => {\n    this.observers.forEach((d) => d());\n  };\n}\n\nexport type TimelineProps =\n  | {\n      // Usual timeline based on the time dimension.\n      type: \"interval\";\n      animationType: AnimationType;\n      msDuration: number;\n      msValues: number[];\n      formatValue: (d: number) => string;\n    }\n  | {\n      // Special timeline for ordinal temporal dimensions,\n      // where the values are not continuous.\n      type: \"ordinal\";\n      animationType: AnimationType;\n      msDuration: number;\n      sortedData: string[];\n    };\n\n/** Observable timeline which encloses animation state and logic. */\nexport class Timeline extends Observable {\n  public type: \"interval\" | \"ordinal\";\n  private animationType: AnimationType;\n\n  // Animation state.\n  public playing = false;\n  /** Animation progress (0-1). */\n  private animationProgress = 1;\n  /** Duration of the animation in milliseconds. */\n  private animationDuration: number;\n  private requestAnimationFrameId: number | undefined;\n  /** Timestamp set when animation beings. */\n  private t: number | undefined;\n\n  // Timeline state.\n  private values: (number | string)[];\n  /** Milliseconds mapped to a timeline. */\n  private msValues: number[];\n  /** Based on current progress. */\n  private msValue: number;\n  /** Min and max values of msValues. */\n  private minMsValue: number;\n  private maxMsValue: number;\n  /** msValueScale(min value) = 0, msValueScale(max value) = 1 */\n  private msValueScale = scaleLinear();\n  /** msValues converted to relative values (0-1). */\n  private msRelativeValues: number[];\n  // Formatting utils (msValue => Date). Useful for rendering.\n  private formatValue: (d: number) => string;\n  private formattedMsExtent: [string, string];\n\n  constructor(props: TimelineProps) {\n    super();\n\n    const { type, animationType, msDuration } = props;\n    this.type = type;\n\n    let formatValue: (d: number) => string;\n\n    switch (props.type) {\n      case \"interval\":\n        formatValue = props.formatValue;\n        this.msValues = props.msValues.sort(ascending);\n        this.values = this.msValues;\n        break;\n      case \"ordinal\":\n        formatValue = (d: number) => {\n          return props.sortedData[Math.round(d / 1000)];\n        };\n        this.msValues = props.sortedData.map((_, i) => i * 1000);\n        this.values = props.sortedData;\n        break;\n    }\n\n    this.animationType = animationType;\n    this.animationDuration = msDuration;\n    const [min, max] = [\n      this.msValues[0],\n      this.msValues[this.msValues.length - 1],\n    ];\n    this.msValue = max;\n    this.minMsValue = min;\n    this.maxMsValue = max;\n    this.msValueScale = this.msValueScale.range([min, max]);\n    this.msRelativeValues = this.msValues.map(this.msValueScale.invert);\n    this.formatValue = formatValue;\n    this.formattedMsExtent = [min, max].map(formatValue) as [string, string];\n  }\n\n  public getUpdateKey = () => {\n    return `${this.playing}_${this.progress}`;\n  };\n\n  public start = () => {\n    if (!this.playing) {\n      if (this.animationProgress === 1) {\n        this.setProgress(0, true);\n      }\n\n      this.playing = true;\n      this.requestAnimationFrameId = requestAnimationFrame(\n        this.animate.bind(this)\n      );\n    }\n  };\n\n  private animate = (t: number) => {\n    if (this.t === undefined) {\n      this.t = t - this.animationProgress * this.animationDuration;\n    }\n\n    if (t - this.t > this.animationDuration) {\n      this.stop(false);\n      this.setProgress(1);\n    } else {\n      const progress = (t - this.t) / this.animationDuration;\n      this.setProgress(progress, true);\n\n      this.requestAnimationFrameId = requestAnimationFrame(\n        this.animate.bind(this)\n      );\n    }\n  };\n\n  public stop = (notify = true) => {\n    if (this.playing) {\n      this.playing = false;\n      this.t = undefined;\n\n      if (this.requestAnimationFrameId) {\n        cancelAnimationFrame(this.requestAnimationFrameId);\n        this.requestAnimationFrameId = undefined;\n      }\n\n      if (notify) {\n        this.notify();\n      }\n    }\n  };\n\n  /** Sets the animation progress and timeline value.\n   *\n   * For stepped type during the animation, the progress is calculated based on the\n   * artificial division (equal time segments to jump between values) and does not\n   * correspond to the actual progress of the slider.\n   */\n  public setProgress = (progress: number, triggeredByAnimation = false) => {\n    let value: number;\n\n    switch (this.animationType) {\n      case \"continuous\":\n        this.animationProgress = progress;\n        value = progress;\n\n        break;\n      case \"stepped\":\n        let i: number;\n\n        if (triggeredByAnimation) {\n          i = Math.floor(progress * this.msValues.length);\n        } else {\n          const msValue = Math.round(this.msValueScale(progress));\n          i = bisect(this.msValues, msValue) - 1;\n        }\n\n        const msRelativeValue = this.msRelativeValues[i];\n        this.animationProgress = i / (this.msValues.length - 1);\n        value = msRelativeValue;\n\n        break;\n    }\n\n    this.setValue(value);\n    this.notify();\n  };\n\n  private setValue = (progress: number) => {\n    const ms = Math.round(this.msValueScale(progress));\n    const i = bisect(this.msValues, ms) - 1;\n    this.msValue = this.msValues[i];\n  };\n\n  get domain() {\n    return this.msRelativeValues;\n  }\n\n  get value() {\n    return this.type === \"interval\"\n      ? this.msValue\n      : this.values[Math.round(this.msValue / 1000)];\n  }\n\n  get formattedValue() {\n    return this.formatValue(this.msValue);\n  }\n\n  get formattedExtent() {\n    return this.formattedMsExtent;\n  }\n\n  /** Timeline progress (0-1) (mapped to track background color of Slider). */\n  get progress() {\n    switch (this.animationType) {\n      case \"continuous\":\n        return this.animationProgress;\n      case \"stepped\":\n        return (\n          (this.msValue - this.minMsValue) / (this.maxMsValue - this.minMsValue)\n        );\n    }\n  }\n}\n","import {\n  DimensionValue,\n  getTemporalEntityValue,\n  ObservationValue,\n  TemporalDimension,\n  TemporalEntityDimension,\n} from \"@/domain/data\";\nimport { useTimeFormatLocale, useTimeFormatUnit } from \"@/formatters\";\n\nexport const getTimeFilterOptions = ({\n  dimension,\n  formatLocale,\n  timeFormatUnit,\n}: {\n  dimension: TemporalDimension | TemporalEntityDimension;\n  formatLocale: ReturnType<typeof useTimeFormatLocale>;\n  timeFormatUnit: ReturnType<typeof useTimeFormatUnit>;\n}) => {\n  const { timeFormat, timeUnit } = dimension;\n  const parseDate = getMaybeTimezoneDateParser({ formatLocale, timeFormat });\n  const formatDate = formatLocale.format(timeFormat);\n  const options: {\n    value: ObservationValue;\n    label: string;\n    date: Date;\n  }[] = [];\n\n  for (const dimensionValue of [\n    ...dimension.values,\n    // TODO: could be improved to be scoped to only currently activated limits\n    ...dimension.relatedLimitValues,\n  ]) {\n    let value: DimensionValue[\"value\"];\n\n    switch (dimension.__typename) {\n      case \"TemporalDimension\":\n        value = dimensionValue.value;\n        break;\n      case \"TemporalEntityDimension\":\n        value = getTemporalEntityValue(dimensionValue);\n        break;\n      default:\n        const _exhaustiveCheck: never = dimension;\n        return _exhaustiveCheck;\n    }\n\n    const date = parseDate(value);\n\n    if (date) {\n      options.push({\n        // By formatting the date, we remove potential timezone.\n        // FIXME: This might lead to issues with SPARQL filtering.\n        value: formatDate(date),\n        label: timeFormatUnit(date, timeUnit),\n        date,\n      });\n    }\n  }\n\n  const sortedOptions = options.sort(\n    (a, b) => a.date.getTime() - b.date.getTime()\n  );\n\n  return {\n    sortedOptions,\n    sortedValues: sortedOptions.map((d) => d.value),\n  };\n};\n\nconst getMaybeTimezoneDateParser = ({\n  formatLocale,\n  timeFormat,\n}: {\n  formatLocale: ReturnType<typeof useTimeFormatLocale>;\n  timeFormat: string;\n}) => {\n  const parse = formatLocale.parse(timeFormat);\n  const timezoneParse = formatLocale.parse(`${timeFormat}%Z`);\n\n  return (v: string | number | null) => {\n    return (parse(`${v}`) ?? timezoneParse(`${v}`)) as Date;\n  };\n};\n","/**\n * Use to assert exhaustiveness in TS.\n *\n * @param x Whatever\n *\n * @example\n * switch (sth) {\n *   case \"X\": // do something\n *   default:\n *     throw unreachableError(sth);\n * }\n */\nexport const unreachableError = (x: never): Error => {\n  return new Error(`This should be unreachable! but got ${x}`);\n};\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { stringifyVariables } from \"urql\";\n\ntype Status = \"idle\" | \"fetching\" | \"success\" | \"error\";\n\nexport type UseFetchDataOptions<TDefault = undefined> = {\n  pause?: boolean;\n  initialStatus?: Status;\n  defaultData: TDefault;\n};\n\ntype QueryKey = string[];\n\ntype QueryCacheValue<T> = {\n  data: T | null;\n  error: Error | null;\n  status: Status;\n};\n\n/**\n * Stores what has been queried through useFetchData. Is listened to by useCacheKey.\n */\nclass QueryCache {\n  cache: Map<string, QueryCacheValue<unknown>>;\n  listeners: [string, () => void][];\n  version: number;\n\n  constructor() {\n    this.cache = new Map();\n    this.listeners = [];\n    this.version = 0;\n  }\n\n  set(queryKey: QueryKey, value: QueryCacheValue<unknown>) {\n    this.cache.set(stringifyVariables(queryKey), value);\n    this.version++;\n    this.fire(queryKey);\n  }\n\n  get(queryKey: QueryKey) {\n    return (\n      this.cache.get(stringifyVariables(queryKey)) || {\n        data: null,\n        error: null,\n        status: \"idle\",\n      }\n    );\n  }\n\n  fire(queryKey: QueryKey) {\n    const key = stringifyVariables(queryKey);\n    this.listeners.forEach(([k, cb]) => key === k && cb());\n  }\n\n  listen(queryKey: QueryKey, cb: () => void) {\n    this.listeners.push([stringifyVariables(queryKey), cb]);\n    return () =>\n      void this.listeners.splice(\n        this.listeners.findIndex((c) => c[1] === cb),\n        1\n      );\n  }\n}\n\nconst cache = new QueryCache();\n\nconst useCacheKey = (cache: QueryCache, queryKey: QueryKey) => {\n  const [version, setVersion] = useState(cache.version);\n\n  useEffect(() => {\n    return cache.listen(queryKey, () => {\n      setVersion(() => cache.version);\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [cache, stringifyVariables(queryKey)]);\n\n  return version;\n};\n\n/**\n * Access remote data, very similar to useFetch from react-query. A global cache\n * is used to store the data. If data is not fetched, it will be fetched automatically.\n * Two useFetchData on the same queryKey will result in only 1 queryFn called. Both useFetchData\n * will share the same cache and data.\n */\nexport const useFetchData = <TData>({\n  queryKey,\n  queryFn,\n  options = {},\n}: {\n  queryKey: any[];\n  queryFn: () => Promise<TData>;\n  options?: Partial<UseFetchDataOptions<TData>>;\n}) => {\n  const { pause, defaultData } = options;\n\n  const cached = cache.get(queryKey) as QueryCacheValue<TData>;\n  const { data, error, status } = cached ?? {};\n\n  const fetchData = useCallback(async () => {\n    const cached = cache.get(queryKey);\n\n    if (cached?.status === \"fetching\") {\n      return;\n    }\n\n    cache.set(queryKey, { ...cache.get(queryKey), status: \"fetching\" });\n\n    try {\n      const result = await queryFn();\n\n      const cacheEntry = {\n        data: result,\n        error: null,\n        status: \"success\" as const,\n      };\n      cache.set(queryKey, cacheEntry);\n\n      return cacheEntry;\n    } catch (error) {\n      const cacheEntry = {\n        data: null,\n        error: error as Error,\n        status: \"error\" as const,\n      };\n      cache.set(queryKey, cacheEntry);\n\n      return cacheEntry;\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [stringifyVariables(queryKey)]);\n\n  useCacheKey(cache, queryKey);\n\n  useEffect(() => {\n    if (pause) {\n      cache.set(queryKey, { ...cache.get(queryKey), status: \"idle\" });\n\n      return;\n    }\n\n    if (cached.status === \"idle\") {\n      fetchData();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pause, fetchData, stringifyVariables(queryKey), cached.data]);\n\n  const invalidate = useCallback(() => {\n    fetchData();\n  }, [fetchData]);\n\n  return { data: data ?? defaultData, error, status, invalidate };\n};\n\n/**\n * Use this to populate (hydrate) the client store with the server side data\n */\nexport const useHydrate = <T>(queryKey: QueryKey, data: T) => {\n  const hasHydrated = useRef(false);\n\n  if (!hasHydrated.current) {\n    cache.set(queryKey, { data, error: null, status: \"success\" });\n    hasHydrated.current = true;\n  }\n};\n\n/**\n * Tracks a server mutation with loading/error states\n */\nexport const useMutate = <TArgs extends any[], TOutput>(\n  queryFn: (...args: TArgs) => Promise<TOutput>\n) => {\n  const [data, setData] = useState<Awaited<TOutput> | null>(null);\n  const [error, setError] = useState<Error | null>(null);\n  const [status, setStatus] = useState<Status>(\"idle\");\n\n  const mutate = useCallback(\n    async (...args: TArgs) => {\n      setStatus(\"fetching\");\n      try {\n        const result = await queryFn(...args);\n        setData(result);\n        setStatus(\"success\");\n        return result;\n      } catch (error) {\n        setError(error as Error);\n        setStatus(\"error\");\n      }\n    },\n    [queryFn]\n  );\n\n  const reset = useCallback(() => {\n    setData(null);\n    setError(null);\n    setStatus(\"idle\");\n  }, []);\n\n  return { data, error, status, mutate, reset };\n};\n","import { useLingui } from \"@lingui/react\";\n\nexport const useI18n = () => {\n  const { i18n } = useLingui();\n\n  return i18n;\n};\n","import { select } from \"d3-selection\";\nimport { toPng, toSvg } from \"html-to-image\";\nimport { addMetadata } from \"meta-png\";\nimport { useCallback, useState } from \"react\";\n\nimport { CHART_SVG_ID } from \"@/charts/shared/containers\";\nimport { TABLE_PREVIEW_WRAPPER_CLASS_NAME } from \"@/components/chart-table-preview\";\nimport { animationFrame } from \"@/utils/animation-frame\";\nimport { maybeWindow } from \"@/utils/maybe-window\";\n\ntype ScreenshotFileFormat = \"png\" | \"svg\";\n\nexport type UseScreenshotProps = {\n  type: ScreenshotFileFormat;\n  screenshotName: string;\n  screenshotNode?: HTMLElement | null;\n  modifyNode?: (\n    clonedNode: HTMLElement,\n    originalNode: HTMLElement\n  ) => Promise<void>;\n  pngMetadata?: { key: PNG_METADATA_KEY; value: string }[];\n};\n\nexport const useScreenshot = ({\n  type,\n  screenshotName,\n  screenshotNode,\n  modifyNode: _modifyNode,\n  pngMetadata,\n}: UseScreenshotProps) => {\n  const [loading, setLoading] = useState(false);\n  const modifyNode = useCallback(\n    async (clonedNode: HTMLElement, originalNode: HTMLElement) => {\n      removeDisabledElements(clonedNode);\n\n      if (_modifyNode) {\n        await _modifyNode(clonedNode, originalNode);\n      }\n    },\n    [_modifyNode]\n  );\n  const screenshot = useCallback(async () => {\n    if (screenshotNode) {\n      setLoading(true);\n      try {\n        await makeScreenshot({\n          type,\n          name: screenshotName,\n          node: screenshotNode,\n          modifyNode,\n          pngMetadata,\n        });\n      } catch (error) {\n        console.error(error);\n      } finally {\n        setLoading(false);\n      }\n    }\n  }, [screenshotNode, type, screenshotName, modifyNode, pngMetadata]);\n\n  return {\n    loading,\n    screenshot,\n  };\n};\n\n// https://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_PNG_files#2-Textual-information-chunks-the-metadata-in-PNG\n// We can use custom keys, but we should use keys already used by other software.\ntype PNG_METADATA_KEY =\n  | \"Title\"\n  | \"Author\"\n  | \"Description\"\n  | \"Copyright\"\n  | \"Creation Time\"\n  | \"Software\"\n  | \"Disclaimer\"\n  | \"Warning\"\n  | \"Source\"\n  | \"Comment\";\n\nconst makeScreenshot = async ({\n  type,\n  name,\n  node,\n  modifyNode,\n  pngMetadata,\n}: {\n  type: \"png\" | \"svg\";\n  name: string;\n  node: HTMLElement;\n  modifyNode?: (\n    clonedNode: HTMLElement,\n    originalNode: HTMLElement\n  ) => Promise<void>;\n  pngMetadata?: { key: PNG_METADATA_KEY; value: string }[];\n}) => {\n  const isUsingSafari = maybeWindow()\n    ? /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\n    : false;\n  // Add wrapper node to prevent overflow issues in the screenshot\n  const wrapperNode = document.createElement(\"div\");\n  wrapperNode.style.width = `${node.offsetWidth}px`;\n  document.body.appendChild(wrapperNode);\n\n  const clonedNode = node.cloneNode(true) as HTMLElement;\n\n  const canvasNodes = select(node)\n    .selectAll<HTMLCanvasElement, unknown>(\"canvas\")\n    .nodes();\n  const clonedCanvasNodes = select(clonedNode)\n    .selectAll<HTMLCanvasElement, unknown>(\"canvas\")\n    .nodes();\n\n  for (const canvasNode of canvasNodes) {\n    const clonedCanvasNode = clonedCanvasNodes[canvasNodes.indexOf(canvasNode)];\n    // Cloning the canvas element does not copy the content, so we need to\n    // manually copy it.\n    const ctx = clonedCanvasNode.getContext(\"2d\") as CanvasRenderingContext2D;\n    ctx.drawImage(canvasNode, 0, 0);\n    await animationFrame();\n  }\n\n  await modifyNode?.(clonedNode, node);\n  wrapperNode.appendChild(clonedNode);\n\n  // Make sure the whole chart is visible in the screenshot (currently only an\n  // issue with SVG-based, long bar charts).\n  const tableWrapper = clonedNode.querySelector(\n    `.${TABLE_PREVIEW_WRAPPER_CLASS_NAME}`\n  ) as HTMLElement | null;\n  const chartSvg = tableWrapper?.querySelector(`#${CHART_SVG_ID}`);\n  const chartSvgHeight = chartSvg?.getAttribute(\"height\");\n  const chartSvgParent = chartSvg?.parentElement;\n\n  if (tableWrapper && chartSvgHeight && chartSvgParent) {\n    tableWrapper.style.height = \"fit-content\";\n    chartSvgParent.style.height = `${chartSvgHeight}px`;\n    chartSvgParent.style.overflow = \"visible\";\n  }\n\n  await animationFrame();\n\n  // There's a bug with embedding the fonts in Safari, which appears only when\n  // downloading the image for the first time. On subsequent downloads, the\n  // font is embedded correctly. To work around this issue, we call the toPng\n  // function twice.\n  if (isUsingSafari && type === \"png\") {\n    await toPng(wrapperNode);\n  }\n\n  await (type === \"png\" ? toPng : toSvg)(wrapperNode)\n    .then((dataUrl) => {\n      const download = (dataUrl: string) => {\n        const a = document.createElement(\"a\");\n        a.href = dataUrl;\n        a.download = `${name}.${type}`;\n        a.click();\n      };\n\n      switch (type) {\n        case \"png\": {\n          let arrayBuffer: Uint8Array = Uint8Array.from(\n            atob(dataUrl.split(\",\")[1]),\n            (c) => c.charCodeAt(0)\n          );\n\n          pngMetadata?.forEach(({ key, value }) => {\n            arrayBuffer = addMetadata(arrayBuffer, key, value);\n          });\n\n          const dataUrlWithMetadata = `data:image/png;base64,${Buffer.from(\n            arrayBuffer\n          ).toString(\"base64\")}`;\n\n          return download(dataUrlWithMetadata);\n        }\n        case \"svg\":\n          return download(dataUrl);\n        default:\n          const _exhaustiveCheck: never = type;\n          return _exhaustiveCheck;\n      }\n    })\n    .catch((error) => console.error(error))\n    .finally(() => {\n      wrapperNode.remove();\n    });\n};\n\nexport const DISABLE_SCREENSHOT_ATTR_KEY = \"data-disable-screenshot\";\n/** Apply this attribute to elements that should not be included in the screenshot. */\nexport const DISABLE_SCREENSHOT_ATTR = {\n  [DISABLE_SCREENSHOT_ATTR_KEY]: true,\n};\nconst removeDisabledElements = (node: HTMLElement) => {\n  node\n    .querySelectorAll(`[${DISABLE_SCREENSHOT_ATTR_KEY}=\"true\"]`)\n    .forEach((el) => el.remove());\n};\n","import { useEffect, useState } from \"react\";\n\n/**\n * Becomes true after the specified duration has passed. Is reset when `reset` changes.\n */\nexport const useTimeout = (duration: number, reset: boolean): boolean => {\n  const [isTimeoutReached, setIsTimeoutReached] = useState(false);\n\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      setIsTimeoutReached(true);\n    }, duration);\n\n    return () => {\n      clearTimeout(timeout);\n    };\n  }, [duration, reset]);\n\n  useEffect(() => {\n    setIsTimeoutReached(false);\n  }, [reset]);\n\n  return isTimeoutReached;\n};\n","import { useMemo } from \"react\";\n\nimport { useUser } from \"@/login/utils\";\n\nimport { getCustomColorPalettes } from \"./chart-config/api\";\nimport { useFetchData } from \"./use-fetch-data\";\n\nexport const useUserPalettes = () => {\n  const user = useUser();\n\n  const queryKey = useMemo(() => [\"colorPalettes\", user?.id], [user?.id]);\n\n  return useFetchData({\n    queryKey,\n    queryFn: getCustomColorPalettes,\n    options: {\n      pause: !user?.id,\n    },\n  });\n};\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"chart-panel-layout-tall_root__kTIUE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"common\":\"markdown_common__MyYa4\",\"inheritFonts\":\"markdown_inheritFonts__aOOs4\"};","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */"],"names":["ComponentLabel","_ref","component","tooltipProps","linkToMetadataPanel","_jsx","OpenMetadataPanelWrapper","children","ComponentLabelInner","description","MaybeTooltip","title","_ref2","label","getLabelWithUnit","Typography","variant","color","textTransform","DataTablePreview","dimensions","measures","observations","sortBy","setSortBy","useState","sortDirection","setSortDirection","sortedComponents","useMemo","getSortedComponents","formatters","useDimensionFormatters","sortedObservations","compare","ascending","descending","valuesByLabel","uniqueMapBy","values","d","convert","isNumericalMeasure","isNumerical","v","get","position","sort","a","b","id","tooltipContainerRef","useRef","PopperProps","container","current","handleSort","useCallback","ref","style","width","_jsxs","Table","display","TableHead","sx","top","TableRow","map","TableCell","role","onClick","textAlign","whiteSpace","TableSortLabel","active","direction","IconComponent","SvgIcChevronDown","_objectSpread","transform","TableBody","obs","i","c","numerical","format","Loading","DateFormat","date","formatter","useFormatDate","formatted","_Fragment","DatasetResult","dataCube","iri","publicationStatus","themes","datePublished","creator","highlightedTitle","highlightedDescription","showTags","disableTitleLink","showDimensions","onClickTitle","cardProps","_objectWithoutProperties","_excluded","isDraft","DataCubePublicationStatus","Draft","router","useRouter","classes","useStyles","handleTitleClick","useEvent","e","defaultPrevented","query","previous","JSON","stringify","getBrowseParamsFromQuery","dataset","push","pathname","undefined","shallow","scroll","MotionCard","elevation","smoothPresenceProps","className","clsx","root","Stack","spacing","Flex","justifyContent","minHeight","Tag","type","Trans","titleClickable","fontWeight","Box","textWrapper","dangerouslySetInnerHTML","__html","flexWrap","gap","t","NextLink","href","encodeURIComponent","passHref","legacyBehavior","length","dimension","termsets","flexDirection","mt","termset","flexShrink","cursor","makeStyles","theme","padding","borderTop","palette","monochrome","borderRadius","boxShadow","transition","primary","main","overflow","WebkitLineClamp","WebkitBoxOrient","DatasetResults","fetching","error","cubes","datasetResultProps","LoadingDataError","message","cube","FirstTenRowsCaption","SearchDatasetDraftsControl","checked","onChange","Checkbox","i18n","_","name","value","SearchDatasetResultsCount","0","SearchDatasetSortControl","disableScore","options","SearchCubeResultOrder","Score","TitleAsc","CreatedDesc","filter","o","alignItems","htmlFor","Select","size","target","useRedirectToLatestCube","datasetIri","dataSource","locale","useLocale","hasRun","handleLoad","url","Array","isArray","endpointUrl","getMaybeCachedSparqlUrl","cubeIri","sparqlClient","ParsingClient","latestIri","queryLatestCubeIri","replace","getErrorQueryParams","useEffect","console","isReady","DatasetMetadataSingleCube","data","useDataCubeMetadataQuery","variables","cubeFilter","sourceType","sourceUrl","DatasetMetadata","dataCubeMetadata","showTitle","DataSetPreview","dataSetIri","dataCubeMetadataQuery","odsIframe","footnotesClasses","useFootnotesStyles","useMarginTop","metadata","fetchingMetadata","metadataError","previewData","fetchingPreview","previewError","useDataCubePreviewQuery","descriptionPresent","window","scrollTo","loadingWrapper","dataCubePreview","mb","HintError","components","1","header","Head","Paper","paper","tableOuterWrapper","tableInnerWrapper","footnotesWrapper","actions","DataDownloadMenu","filters","flexGrow","marginBottom","shadows","overflowX","marginTop","_ref3","SearchDatasetControls","browseState","inputRef","search","onSubmitSearch","includeDrafts","setIncludeDrafts","order","onSetOrder","onToggleIncludeDrafts","input","sleep","Divider","flexItem","orientation","SearchDatasetInput","onReset","searchFieldProps","setShowDraftCheckbox","searchLabel","placeholderLabel","pt","SearchField","defaultValue","InputProps","inputProps","onKeyPress","key","onFocus","placeholder","maxWidth","NavigationChip","backgroundColor","minWidth","height","typography","bgcolor","MaybeLink","disabled","props","NavigationItem","next","count","level","disableLink","countBg","setFilters","useBrowseContext","highlighted","newFiltersAdd","extraURLParams","pickBy","topic","Boolean","newFilters","f","__typename","encodeFilter","join","newFiltersRemove","removeFilterPath","MotionBox","accordionPresenceProps","Link","preventDefault","p","ButtonBase","removeFilterButton","SvgIcClose","cobalt","marginRight","text","NavigationSectionTitle","px","py","NavigationSection","items","currentFilter","counts","extra","disableLinks","isOpen","open","close","useDisclosure","topItems","orderBy","item","slice","Reorder","Group","axis","as","onReorder","Item","Button","endIcon","Icon","SubthemeFilters","subthemes","navigationOrder","DataCubeTheme","DataCubeOrganization","DataCubeTermset","DataCubeAbout","SearchFilters","orgs","disableNavLinks","result","truthy","themeFilter","organizationFilter","termsetFilter","keyBy","displayedThemes","displayedOrgs","org","displayedTermsets","themeNavigation","uniqBy","flatMap","organizationBackgroundColor","organizationNavigation","includes","termsetNavigation","InfoIconTooltip","navigations","element","nav","findIndex","Object","keys","AnimatePresence","rowGap","SelectDatasetBanner","useResizeObserver","document","documentElement","setProperty","__BANNER_MARGIN_CSS_VAR","show","bannerPresenceProps","outerWrapper","ContentWrapper","innerWrapper","content","paddingTop","paddingBottom","softJSONParse","parse","SelectDatasetStep","BrowseStateProvider","syncWithUrl","SelectDatasetStepInner","datasetPreviewProps","datasetResultsProps","propsDataset","onClickBackLink","onCreateChartFromDataset","state","useConfiguratorState","browseDataset","isOdsIframe","datasetPresent","debouncedQuery","useDebounce","leading","handleHeightChange","parent","postMessage","CHART_RESIZE_EVENT_TYPE","backLink","backParameters","buildURLFromBrowseParams","queryFilters","SearchCubeFilterType","useSearchCubesQuery","pause","allCubes","searchCubes","subthemeFilters","some","pageTitle","queryFilter","foundQueryFilter","TemporalDimension","find","borderBottom","mode","initial","opacity","animate","exit","duration","DURATION","pb","breakpoints","down","startIcon","sourceToLabel","darken","PanelLayout","panelLayout","PanelBodyWrapper","panelLeft","navPresenceProps","panelMiddle","Footer","mx","borderTopWidth","margin","_ref4","background","outline","up","_ref5","_ref6","overflowY","maxHeight","_ref7","_ref8","gridColumnStart","gridColumnEnd","marginLeft","_ref9","grey","onColorComponentScaleTypeChange","chartConfig","field","basePath","interpolationTypePath","nbClassPath","setWith","unset","onColorComponentIdChange","newField","DEFAULT_FIXED_COLOR_FIELD","currentColorComponentId","colorPalette","MULTI_FILTER_ENABLED_COMPONENTS","isOrdinalMeasure","paletteId","getDefaultCategoricalPaletteId","getDefaultCategoricalColorField","dimensionValues","getDefaultNumericalColorField","getDefaultSegmentSorting","sortingType","sortingOrder","getDisabledState","getAnimationField","warnMessage","AREA_SEGMENT_SORTING","COLUMN_SEGMENT_SORTING","BAR_SEGMENT_SORTING","PIE_SEGMENT_SORTING","ANIMATION_FIELD_SPEC","optional","idAttributes","componentTypes","ANIMATION_ENABLED_COMPONENTS","hide","disableInteractiveFilters","initializing","fields","animation","componentId","showPlayButton","dynamicScales","temporalDimensions","isTemporalDimension","isTemporalEntityDimension","isTemporalOrdinalDimension","fieldComponentsMap","fromEntries","entries","fieldHasComponentId","k","temporalFieldComponentIds","getFieldLabel","isSortingInConfig","segment","sorting","isMissingDataPresent","grouped","group","y","x","segments","from","Set","getSegment","checkForMissingValuesInSegments","disableStacked","scaleType","defaultSegmentOnChange","selectedValues","colorMapping","mapValueIrisToColor","showValuesMapping","DEFAULT_SORTING","multiFilter","makeMultiFilter","onMapFieldChange","initializeMapLayerField","getNonStackedDomain","getValue","min","max","extent","scaleLinear","domain","Math","nice","getChartSpec","chartConfigOptionsUISpec","chartType","area","encodings","schemeCategory10","showValues","adjustScaleDomain","getDefaultDomain","getY","parseOptionalNumericVariable","yScale","getStackedYScale","normalize","interactiveFiltersConfig","calculation","getX","parseStringVariable","convertUnit","SEGMENT_ENABLED_COMPONENTS","customDomain","onDelete","yId","missingDataPresent","imputationType","imputation","shouldShow","useAbbreviations","interactiveFilters","column","_ref10","showStandardError","showConfidenceInterval","_ref11","_ref12","yComponent","_ref13","chartSubType","getValues","disabledStacked","_ref14","bar","_ref15","_ref16","xScale","getStackedXScale","_ref17","xComponent","_ref18","xId","_ref19","line","_ref20","showDots","showDotsSize","_ref21","exclusive","colorComponent","enableUseAbbreviations","onComponentIdChange","onScaleTypeChange","pie","scatterplot","table","comboLineSingle","customComponent","componentIds","ids","getPalette","newColorMapping","comboLineDual","leftAxisComponentId","rightAxisComponentId","comboLineColumn","lineComponentId","lineColor","columnColor","columnComponentId","lineAxisOrientation","lineAxisLeft","firstId","secondId","getChartFieldChangeSideEffect","encoding","chartSpec","getChartFieldDeleteSideEffect","getChartFieldOptionChangeSideEffect","path","chartTypes","regularChartTypes","comboDifferentUnitChartTypes","comboSameUnitChartTypes","comboChartTypes","findPreferredDimension","preferredTypes","dim","preferredType","isKeyDimension","Error","getInitialInteractiveFiltersConfig","timeRangeComponentId","legend","timeRange","presets","to","dataFilters","defaultValueOverrides","filterTypes","defaultOpen","findBottommostLayers","leaves","hasSeenMultiHierarchyNode","bfs","hierarchy","node","isMultiHierarchyNode","IGNORE","hasValue","makeInitialFiltersForArea","areaLayer","getInitialAreaLayer","isGeoShapesDimension","measure","symbolLayer","getInitialSymbolLayer","isGeoDimension","measureId","FIELD_VALUE_NONE","META","en","de","fr","it","getInitialConfig","iris","meta","getGenericConfig","createId","version","CHART_CONFIG_VERSION","joinBy","annotations","limits","conversionUnitsByComponentId","activeField","numericalMeasures","areaXComponentId","DEFAULT_CATEGORICAL_PALETTE_ID","columnXComponentId","barXComponentId","lineXComponentId","geoDimensions","getGeoDimensions","geoShapesDimensions","areaDimension","showAreaLayer","baseLayer","locked","bbox","customLayers","showSymbolLayer","pieSegmentComponent","getCategoricalDimensions","piePalette","scatterplotSegmentComponent","scatterplotPalette","allDimensionsSorted","Infinity","settings","showSearch","showAllRows","links","enabled","baseUrl","targetComponentId","componentType","index","isGroup","isHidden","columnStyle","textStyle","textColor","mostCommonUnit","rollups","unit","yComponentIds","firstUnit","secondUnit","unreachableError","getChartConfigAdjustedToChartType","newChartType","isAddingNewCube","oldChartType","initialConfig","getAdjustedChartConfig","adjusters","chartConfigsAdjusters","pathOverrides","chartConfigsPathOverrides","oldChartConfig","newChartConfig","isConfigLeaf","configValue","isSegmentInConfig","go","newPath","overrides","override","getChartConfigWithAdjustedField","oldValue","interactiveFiltersAdjusters","produce","draft","oldComponentIds","fieldComponentIds","validComponentIds","newDefaultValueOverrides","removedComponentIds","forEach","canBeNormalized","mapValues","symbolType","_excluded2","_ref22","_ref23","_ref24","_ref25","_ref26","_ref27","getSingleColorField","oldColorField","_ref28","newSegment","newColor","yMeasure","maybeSegmentAndColorFields","convertTableFieldsToSegmentAndColorFields","oldColor","isColorInConfig","segmentDimension","oldSegment","adjustSegmentSorting","acceptedValues","getSegmentColorField","_ref29","_ref30","_ref31","_ref32","_ref33","_excluded3","_ref34","_ref35","_ref36","_ref37","_ref38","_ref39","_ref40","xMeasure","_ref41","_ref42","_ref43","_ref44","_ref45","_excluded4","_ref46","_ref47","_ref48","_ref49","_ref50","_ref51","_ref52","_ref53","_ref54","_ref55","_ref56","_excluded5","_ref57","_ref58","_ref59","_ref60","_ref61","_ref62","_ref63","_ref64","_ref65","_ref66","_ref67","_excluded6","_ref68","_ref69","_ref70","newMeasure","_ref71","_ref72","_ref73","_ref74","_ref75","_ref76","_ref77","_excluded7","_ref78","_ref79","_ref80","_ref81","_ref82","_ref83","_ref84","_ref85","_ref86","_ref87","oldCube","_ref88","_ref89","_ref90","_excluded8","_ref91","_ref92","_ref93","_ref94","_ref95","_ref96","_ref97","_ref98","_excluded9","_ref99","_ref100","_ref101","_ref102","_ref103","_ref104","_ref105","_excluded10","_ref106","_ref107","_ref108","rightMeasureId","numericalMeasureIds","leftMeasure","getLeftMeasure","preferredId","preferredLeftMeasure","rightMeasure","overrideLeftMeasure","lineId","lineOrientation","columnId","leftAxisId","_ref109","_ref110","_ref111","_ref112","_excluded11","_ref113","_ref114","_ref115","getMeasure","_ref116","categoricalEnabledChartTypes","geoEnabledChartTypes","multipleNumericalMeasuresEnabledChartTypes","timeEnabledChartTypes","getEnabledChartTypes","_ref117","cubeCount","ordinalMeasures","categoricalDimensions","possibleChartTypesDict","enableChartType","enableChartTypes","maybeDisableChartType","maybeDisableChartTypes","measuresWithUnit","uniqueUnits","unitCounts","rollup","chartTypesOrder","getChartTypeOrder","multiCubeBoost","enabledChartTypes","getFieldComponentIds","getGroupedFieldIds","getHiddenFieldIds","getFieldComponentId","_ref118","_ref119","_ref120","groupedColumns","actualComponent","getChartSymbol","DEFAULT_FIXED_COLOR_FIELD_OPACITY","DEFAULT_OTHER_COLOR_FIELD_OPACITY","interpolationType","DEFAULT_COLOR","FLY_TO_DURATION","RESET_DURATION","getMap","setMap","parseWMSLayer","layer","parentAttributes","parentPath","arguments","currentPath","endpoint","Name","Title","layerCrs","maybeArray","CRS","parseCrs","crs","uniq","res","Abstract","legendUrl","Style","LegendURL","OnlineResource","Layer","l","DEFAULT_WMS_URL","parseWMSContent","wmsData","parser","XMLParser","ignoreAttributes","attributeNamePrefix","parseAttributeValue","dataUrl","WMS_Capabilities","Capability","Request","GetMap","DCPType","HTTP","Get","attribution","Attribution","Service","layers","getWMSTile","wmsLayer","customLayer","beforeId","isRemoteLayerCRSSupported","warn","DeckGLWMSLayer","loadOptions","fetch","parsedUrl","URL","searchParams","set","toString","serviceType","isWmsUrl","test","isWmtsUrl","guessUrlType","fetchWMSorWMSLayersFromEndpoint","resp","parseWMTSContent","getLayerKey","indexByKey","wmsLayers","wmtsLayers","layersByKey","visitHierarchy","isCRSSupported","DEFAULT_DATA","wmts","wms","byKey","useWMTSorWMSLayers","endpoints","queryFn","allLayers","Promise","all","flat","groupBy","useFetchData","queryKey","defaultData","makeKey","match","groups","namespace","parseTileMatrixSets","_tileMatrixSet","tileMatrixSet","TileMatrix","TopLeftCorner","split","Number","tileMatrixes","supportedCRS","tm","scaleDenominator","ScaleDenominator","topLeftCorner","tileWidth","TileWidth","tileHeight","TileHeight","matrixWidth","MatrixWidth","matrixHeight","MatrixHeight","parseWMTSLayer","attributes","tileMatrixById","getTileUrl","tileMatrixSets","tileMatrixSetLinks","TileMatrixSetLink","tl","TileMatrixSet","ResourceURL","template","dimensionIdentifier","Dimension","availableDimensionValues","Value","defaultDimensionValue","Default","ts","mapArrayOrUnique","arr","cb","formatGetTileUrl","endsWith","parsed","Capabilities","getTileOperation","operation","getTileUrlRaw","Contents","tileMatrix","DEFAULT_WMTS_URL","getWMTSTile","wmtsLayer","espg3857TileMatrixSet","tms","tileLayerDataUrl","getWMTSLayerData","tileMatrixSetId","identifier","layerId","getWMTSLayerValue","TileLayer","tileSize","renderSubLayers","boundingBox","tile","BitmapLayer","image","bounds","identifierReplaced","syncTemporalFilters","makeGetClosestDatesFromDateRange","sortedData","getDate","fromTime","getTime","toTime","startIndex","bisectDateLeft","bisector","left","dStartLeft","dStartRight","startClosestDatum","endIndex","bisectDateRight","right","dEndLeft","dEndRight","endClosestDatum","groupPreparedFiltersByDimension","preparedFilters","preparedFilter","resolved","componentIdResolution","isJoinById","resolvedDimensionId","dimensionId","useChartDataFiltersState","dashboardFilters","dataFiltersConfig","configComponentIds","excludeDashboardFilters","isTableConfig","orderedIds","getOrderedTableColumns","setOpen","loading","useLoadingState","useQueryFilters","cubeQueryFilters","assert","unmappedFilters","mappedFilters","getFiltersByMappingStatus","joinByIds","unmappedKeys","unmappedEntries","unmappedComponentId","cubeComponentIds","componentIdPairs","originalId","resolvedId","getResolvedJoinById","interactiveFiltersList","existingEntry","groupedPreparedFilters","useEnsurePossibleInteractiveFilters","ChartDataFiltersToggle","ml","prev","LoadingIndicator","getInteractiveQueryFilters","nonInteractiveFilters","DataFilterGenericDimension","configFilter","isMulti","onMultiChange","_options","noneLabel","clearSelectionLabel","allOptions","clearSelectionOption","isNoneValue","fieldLabel","FieldLabel","displayValues","MultiSelect","DataFilterHierarchyDimension","noneOption","opts","hierarchyToOptions","filterTreeRecursively","unshift","handleChange","displayValue","SelectTree","DataFilterTemporalDimension","timeUnit","timeFormat","formatLocale","useTimeFormatLocale","formatDate","parseDate","minDate","maxDate","optionValues","extractDataPickerOptionsFromDimension","canRenderDatePickerField","DatePickerField","isDateDisabled","dateFormat","showClearButton","dispatch","loadingState","setError","lastFilters","client","useClient","getInteractiveFiltersState","useInteractiveFiltersGetState","setDataFilters","useChartInteractiveFilters","filtersByCubeIri","reduce","acc","dataFiltersActive","areDataFiltersActive","run","skipPossibleFiltersQuery","getPossibleFiltersQueryVariables","PossibleFiltersDocument","toPromise","assign","possibleFilters","interactiveFilter","filtersToUpdate","isEqual","isEmpty","shouldIncludeNode","filterNode","filteredChildren","child","selectable","useMaybeAbbreviations","valueLookup","labelLookup","abbreviationOrLabelLookup","Map","alternateName","getAbbreviationOrLabelByValue","lookedUpObservation","lookedUpLabel","useObservationLabels","getLabel","getId","lookup","prepareCubeQueryFilters","cubeFilters","animationField","interactiveDataFilters","dashboardFiltersComponentIds","resolvedInteractiveFiltersConfigComponentIds","getOriginalIds","interactiveActiveForKey","hasFilterValue","shouldApplyInteractiveFilter","omitBy","chartInteractiveFilters","resolvedChartInteractiveFilters","resolvedIds","isAnimationInConfig","getChartConfigFilters","cubeInteractiveDataFilters","getChartConfigFilterComponentIds","getMapChartConfigAdditionalFieldIds","additionalFields","getComboChartComponentIds","extractChartConfigsComponentIds","chartConfigs","extractChartConfigComponentIds","includeFilters","fieldIds","additionalFieldIds","isComboChartConfig","filterIds","IFKeys","IFIris","extractChartConfigUsedComponents","usePlottableData","isPlottable","useDimensionWithAbbreviations","makeUseParsedVariable","useOptionalNumericVariable","useStringVariable","useTemporalVariable","useTemporalEntityVariable","indexedValues","dimensionValue","getTemporalEntityValue","segmentKey","stackOffsetDivergingPositiveZeros","series","n","j","dy","yp","yn","m","getWideData","dataGrouped","getAxisValue","allSegments","dataGroupedEntries","dataGroupedWithImputedValues","imputedSeriesValues","imputeTemporalLinearSeries","dataSortedByX","observation","Date","getBaseWideData","getOptionalObservationProps","interpolateZerosValue","wideData","dataGroupedByXEntries","total","sum","getIdentityId","useGetIdentityY","useGetIdentityX","normalizeData","getTotalGroupValue","totalGroupValue","axisValue","SlugRe","getSlugifiedId","dataGroupedByX","LoadingState","Observable","constructor","_defineProperty","resolveState","_loading","notify","LoadingStateContext","createContext","ctx","useContext","useSyncExternalStore","subscribe","getUpdateKey","LoadingStateProvider","Provider","ChartContext","useChartState","useBaseVariables","useBandYVariables","dimensionsById","yDimension","yTimeUnit","timeFormatUnit","useTimeFormatUnit","formatYDate","toISOString","getYAbbreviationOrLabel","getYLabel","getYAsDate","getYTemporalEntity","yAxisLabel","useBandXVariables","xDimension","getXAbbreviationOrLabel","getXLabel","getXAsDate","getXTemporalEntity","xAxisLabel","xTimeUnit","formatXDate","useTemporalXVariables","getXTemporal","relatedLimitValues","getXAsString","useTemporalMaybeXVariables","shouldUseDynamicMinScaleValue","ScaleType","Interval","useNumericalXVariables","measuresById","getMinX","_getX","useNumericalYVariables","getMinY","_getY","useNumericalYErrorVariables","showYStandardError","yStandardErrorMeasure","useErrorMeasure","RelatedDimensionType","StandardError","getYStandardError","useErrorVariable","showYConfidenceInterval","yConfidenceIntervalUpperMeasure","ConfidenceUpperBound","getYConfidenceIntervalUpper","yConfidenceIntervalLowerMeasure","ConfidenceLowerBound","getYConfidenceIntervalLower","getYErrorPresent","getYErrorRange","useErrorRange","getFormattedYUncertainty","sd","cil","ciu","showYUncertainty","useNumericalXErrorVariables","showXStandardError","xStandardErrorMeasure","getXStandardError","showXConfidenceInterval","xConfidenceIntervalUpperMeasure","getXConfidenceIntervalUpper","xConfidenceIntervalLowerMeasure","getXConfidenceIntervalLower","getXErrorPresent","getXErrorRange","getFormattedXUncertainty","showXUncertainty","useSegmentVariables","getSegmentAbbreviationOrLabel","segmentsByAbbreviationOrLabel","getSegmentLabel","showValuesBySegmentMapping","useInteractiveFiltersVariables","getTimeRangeDate","getTimeRangeEntityDate","useLimitsVariables","measureLimit","minLimitValue","maxLimitValue","useChartData","sortData","timeRangeDimensionId","axisDimensionId","getAxisValueAsDate","allData","dimensionValuesObservations","limit","related","axisObservationValues","categories","timeSlider","interactiveTimeRange","timeRangeFromTime","timeRangeToTime","timeRangeFilters","timeRangeFilter","time","interactiveFromTime","interactiveToTime","hasChartConfigs","potentialTimeRangeFilterIds","useDashboardInteractiveFilters","interactiveTimeRangeFilters","interactiveTimeRangeFilter","animationComponentId","getAnimationDate","getAnimationOrdinalDate","interactiveTimeSliderFilters","interactiveTimeSliderFilter","ordinalDate","interactiveLegendFilters","legendItems","interactiveLegendFilter","chartData","overEvery","scalesData","segmentData","timeRangeData","paddingData","CalculationToggle","setCalculationType","Switch","chartContainer","ChartContainer","getChartConfig","isFreeCanvas","isLayoutingFreeCanvas","useObserverRef","CHART_SVG_ID","ChartSvg","enableTransition","useTransitionStore","enable","transitionDuration","margins","chartHeight","getAttribute","setAttribute","bottom","sel","select","attr","DISABLE_SCREENSHOT_ATTR","ChartControlsContainer","rest","embedParams","useEmbedQueryParams","optimizeSpace","interpolateTemporalLinearValue","previousValue","nextValue","previousTime","currentTime","nextTime","interpolate","presentDataIndexes","missingDataIndexes","missingDataIndex","nextPresentDataIndex","previousPresentDataIndex","isUsingImputation","isAreaConfig","getLegendGroups","groupsMap","valueOrder","legendContainer","gridTemplateColumns","gridAutoFlow","legendContainerNoGroups","legendGroup","columnGap","groupHeader","useLegendGroups","configState","useReadOnlyConfiguratorState","segmentField","LegendColor","memo","symbol","getLegendItemDimension","interactive","colors","getColorLabel","segmentComponent","LegendColorContent","configLimit","limitUnit","lineType","getColor","getItemDimension","numberOfOptions","removeOpacity","rgb","MapLegendColor","dimensionFilter","useChartConfigFilters","sortedValues","sorters","makeDimensionValueSorters","s","legendValues","observationLabels","sortedStringValues","isOrdinalDimension","has","rgbArrayToHex","addCategory","removeCategory","activeInteractiveFilters","soleItemChecked","handleToggle","formatNumber","useFormatNumber","decimals","g","colorValues","isLastGroup","headerLabelsArray","interlace","chevronKey","SvgIcChevronRight","LegendItem","onToggle","LegendIcon","fill","cx","cy","r","x1","x2","y1","y2","stroke","strokeWidth","vectorEffect","strokeDashoffset","strokeDasharray","points","viewBox","smaller","labelNode","wordBreak","orderedIsEqual","obj1","obj2","getPossibleFiltersQueryKey","filterKey","oldFilters","NORMALIZED_VALUE_DOMAIN","yMin","yMax","newYMin","newYMax","xMin","xMax","newXMin","newXMax","getStackedTooltipValueFormatter","measureUnit","dIdentity","rounded","round","fValue","formatNumberWithUnit","getStackedPosition","measureScale","fallbackMeasureValue","segmentSeries","seriesPoint","y0","useCombinedTemporalDimension","useConfigsCubeComponents","getCombinedTemporalDimension","dataCubesComponents","timeUnitDimensions","isTemporalDimensionWithTimeUnit","timeUnitOrder","timeUnitFormats","temporalEntity","dv","dateString","stringifyComponentId","unversionedCubeIri","unversionedComponentIri","Observer","prevWidth","useTimedPrevious","prevHeight","isResizing","INIT_SIZE","brushing","setEnableTransition","setEnable","ChartObserverContext","useSize","ActionElementsContainer","AddButton","ConfiguratorAddButton","commonBeforeStyles","ArrowMenuTopCenter","styled","Menu","paperClasses","ArrowMenuBottomCenter","ArrowMenuTopBottom","ArrowMenuBottomTop","ChartDataTablePreview","commonQueryVariables","metadataData","useDataCubesMetadataQuery","componentsData","fetchingComponents","useDataCubesComponentsQuery","observationsData","useDataCubesObservationsQuery","dataCubesMetadata","dataCubesObservations","ChartErrorBoundary","resetKeys","ErrorBoundary","FallbackComponent","ChartUnexpectedError","ChartFiltersList","loadValues","allFilters","namedFilters","filterValue","isMostRecentValue","mr","Fragment","fontSize","caption","CHART_FOOTNOTES_CLASS_NAME","ChartFootnotes","showVisualizeLink","hideFilters","hideMetadata","configKey","metadataPanelProps","usedComponents","hideLegend","shouldShowChartFootnotesLegend","ChartFootnotesLegend","dateModified","MetadataPanel","smallerToggle","VisualizeLink","createdWith","ChartFootnotesComboLineColumn","ChartFootnotesComboLineDual","ChartFootnotesComboLineSingle","ChartFootnotesLegendContainer","columnAxisComponent","lineAxisComponent","firstComponent","secondComponent","leftAxisComponent","rightAxisComponent","rel","textDecoration","chartPanelLayoutGridClasses","dragHandle","decodeLayouts","layouts","pipe","ReactGridLayoutsType","decode","fold","err","ChartPanelLayoutCanvas","blocks","renderBlock","layout","handleChangeLayouts","parsedLayouts","ChartGridLayout","resize","draggableHandle","onLayoutChange","allLayouts","FREE_CANVAS_BREAKPOINTS","ChartPanelLayoutTallRow","row","useTheme","isMobile","useMediaQuery","block","getChartPanelLayoutTallRows","rows","nextBlock","containerType","chartWrapper","freeCanvas","transitions","create","shortest","chartWrapperInner","isEditing","getChartWrapperId","chartKey","ChartWrapper","forwardRef","editing","ChartSelectionTabs","Wrappers","vertical","tall","canvas","ChartPanelLayout","layoutType","Wrapper","useSyncTextBlockHeight","DashboardInteractiveFilters","VisualizeTabList","TabList","border","tabsClasses","indicator","scrollButtons","divider","VisualizeTab","Tab","zIndex","borderBottomColor","TABS_STATE","popoverOpen","popoverType","activeChartKey","TabsStateContext","useTabsState","TabsStateProvider","editable","isConfiguring","isLayouting","isPublishing","TabsEditable","TabsFixed","isConfiguringChart","tabsState","setTabsState","popoverAnchorEl","setPopoverAnchorEl","handleClose","openAddDatasetPanel","useSearchDatasetPanelStore","switchChart","TabsInner","addable","draggable","onChartAdd","currentTarget","onChartEdit","onChartSwitch","anchorEl","anchorOrigin","horizontal","transformOrigin","onClose","PaperProps","gutterBottom","ChartTypeSelector","showHelp","showComparisonCharts","my","fullWidth","MenuActionItem","leadingIconName","DuplicateChartMenuActionItem","onSuccess","requireConfirmation","confirmationTitle","confirmationText","isPublished","PassthroughTab","_value","useTabsInnerStyles","tab","tabList","borderColor","tabClasses","scrollButton","pointerEvents","activeTabIndex","TabContext","DragDropContext","onDragEnd","destination","source","oldIndex","newIndex","Droppable","droppableId","provided","innerRef","ScrollButtonComponent","Draggable","draggableId","snapshot","draggableProps","_createElement","dragHandleProps","TabContent","iconName","getIconName","dragging","isDragging","onChevronDownClick","onSwitchClick","useIconStyles","borderTopLeftRadius","borderTopRightRadius","backgroundImage","chartIconWrapper","editIconWrapper","dragIconWrapper","showAddLabel","addLabel","pl","secondary","DragHandle","resolveMostRecentValue","VISUALIZE_MOST_RECENT_VALUE","useResolveMostRecentValue","ChartDataFilter","chartLoadingState","updateDataFilter","setMultiDataFilter","perCube","interactiveFiltersResolved","resolvedQueryFilters","filterKeys","keepPreviousData","setDataFilter","handleMultiChange","joined","configFilterValue","dataFilterValue","dataFilterValues","isMultiFilter","filterType","resolvedDataFilterValue","resolvedConfigFilterValue","multiValue","String","flex","ChartDataFiltersList","CHART_GRID_ROW_COUNT","useChartStyles","removeBorder","pastEditing","gridTemplateRows","gridRow","ChartControls","chartDataFilters","dashboardDataFilters","showFilters","chartFiltersState","gridTemplateAreas","gridArea","ChartMoreButton","chartWrapperNode","disableDatabaseRelatedActions","anchor","setAnchor","useEventCallback","setIsTableRaw","useChartTablePreview","disableButton","screenshotName","timeUnitToFormatter","Day","getPublishedActions","TableViewChartMenuActionItem","DownloadPNGImageMenuActionItem","screenshotNode","CopyChartMenuActionItem","ShareChartMenuActionItem","getUnpublishedActions","published","availableActions","IconButton","copyUrl","setCopyUrl","location","origin","shareUrl","setShareUrl","isTable","setIsTable","getChartIcon","modifyNode","useModifyNode","usePNGMetadata","screenshot","useScreenshot","pngMetadata","chartWithFiltersClasses","useChartWithFiltersClasses","clonedNode","originalNode","tablePreviewWrapper","querySelector","TABLE_PREVIEW_WRAPPER_CLASS_NAME","chart","chartWithFilters","clientHeight","footnotes","createElement","appendChild","createRoot","render","ThemeProvider","animationFrame","remove","selectAll","DISABLE_SCREENSHOT_COLOR_WIPE_KEY","DISABLE_SCREENSHOT_COLOR_WIPE_ATTR","publisher","contactPoints","contactPoint","email","publishURL","datasets","deburr","ChartTablePreviewContext","containerRef","containerHeight","computeContainerHeight","ChartTablePreviewProvider","configuratorState","getBoundingClientRect","ChartTablePreviewWrapper","empty","useChanges","currentValue","computeChanges","prevRef","prevValue","changes","isEqualFilter","fa","fb","computeFilterChanges","cur","allKeys","useFilterChanges","useSyncInteractiveFilters","resetCategories","setTimeRange","lastOverridesRef","isFirstRunRef","presetFrom","presetTo","presetFromStr","presetToStr","dashboardComponentIds","newPotentialInteractiveDataFilters","concat","currentDataFilters","dashboardFilter","allowed","isAllowed","val","lastOverride","overrideChanged","validOverrides","configuredFilterType","validValues","latestOverrides","interactiveCategoriesResetTrigger","calculationActive","calculationType","annotationsInitializedRef","interactiveAnnotations","updateAnnotation","annotation","ChartAreasVisualization","dynamic","__webpack_require__","then","bind","mod","loadableGenerated","webpack","ChartColumnsVisualization","ChartBarsVisualization","ChartComboLineSingleVisualization","ChartComboLineDualVisualization","ChartComboLineColumnVisualization","ChartLinesVisualization","ChartMapVisualization","ChartPieVisualization","ChartScatterplotVisualization","ChartTableVisualization","GenericChart","commonProps","observationQueryFilters","ChartWithFilters","displayName","layouting","showTimeRange","showDataFilters","scrollIntoView","behavior","DashboardTimeRangeSlider","mounted","DashboardDataFilters","useTimeRangeRangeStyles","slider","sliderClasses","track","rail","valueLabel","valueToTimeRange","presetToTimeRange","timeUnitToParser","toUnixSeconds","dashboardInteractiveFilters","valueLabelFormat","handleChangeSlider","newTimeRange","_getState","_useStore","store","stores","setState","mountedForSomeTime","useTimeout","combinedTemporalDimension","sliderRange","Slider","_ev","onChangeCommitted","step","valueLabelDisplay","marks","useDataFilterStyles","wrapper","saveDataFiltersSnapshot","getState","config","allPreparedFilters","DataFilter","cubeIris","entry","relevantChartConfigs","setValue","newValue","restoreSnapshot","DataDownloadStateContext","useDataDownloadState","DataDownloadStateProvider","isDownloading","FILE_FORMATS","makeColumnLabel","prepareData","dimensionParsers","columns","dimSorters","sorter","sortResult","formattedObs","formatIdentity","parsedValue","col","columnKeys","RawMenuItem","MenuItem","DataDownloadInnerMenu","fileName","CircularProgress","MenuListProps","DataDownloadMenuSection","subheader","getFullDataDownloadFilters","ListSubheader","fileFormat","DownloadMenuItem","useI18n","download","getDimensionParsers","workbook","Workbook","worksheet","addWorksheet","addRows","csv","writeBuffer","saveAs","Blob","xlsx","componentsResult","observationsResult","executeDataCubesComponentsQuery","executeDataCubesObservationsQuery","toUpperCase","dateFormatters","getFormattersForLocale","formatDateAuto","getFormatFullDateAuto","dateFormatterFromDimension","makeOpenDataLink","lang","creatorIri","workExamples","creatorSlug","sparqlEditorUrl","openDataLink","DatasetMetadataTitle","DatasetMetadataBody","DatasetMetadataLink","landingPage","external","DatasetSparqlQuery","DatasetTags","underline","DatasetMetadataTag","MUILink","useDragOverClasses","isDragOver","isDragActive","LEGACY_EMBED_QUERY_PARAMS","migrateEmbedQueryParam","param","EMBED_QUERY_PARAMS","isEmbedQueryParam","getEmbedParamsFromQuery","removeMoreOptionsButton","removeLabelsInteractivity","removeFootnotes","removeFilters","buildEmbedQueryParams","setEmbedQueryParam","updatedParams","nonEmbedParams","componentsProps","placement","Tooltip","arrow","disableInteractive","lineHeight","h1","h2","h3","h4","h5","h6","Markdown","ReactMarkdown","remarkPlugins","remarkGfm","rehypePlugins","rehypeRaw","rehypeSanitize","InlineMarkdown","inlineMarkdown","strong","em","ul","li","blockquote","code","br","skipHtml","componentsInheritFonts","_excluded12","_excluded13","_excluded14","_excluded15","_excluded16","_excluded17","MarkdownInheritFonts","createMetadataPanelStore","createStore","activeSection","selectedComponent","toggle","setActiveSection","section","setSelectedComponent","clearSelectedComponent","openComponent","reset","useMetadataPanelStore","selector","MetadataPanelStoreContext","useStore","useMetadataPanelStoreActions","defaultStore","JoinByChip","Chip","SvgIcJoint","warning","light","chipClasses","useDrawerStyles","DRAWER_WIDTH","paddingLeft","paddingRight","borderRight","useOtherStyles","toggleButton","tabPanel","tabPanelContent","dimensionButton","searchInputResultList","searchInputResult","openComponentInteractive","verticalAlign","openComponentNonInteractive","animationProps","handleClick","stopPropagation","allowMultipleOpen","renderToggle","drawerClasses","otherClasses","ee","useEventEmitter","emit","handleHashChange","events","on","off","slideProps","onEnter","onEntered","onExit","onExited","ToggleButton","Drawer","hideBackdrop","disableEnforceFocus","ModalProps","SlideProps","Header","CubesPanel","DataPanel","dataCubesMetadataData","fetchingDataCubesMetadata","dataCubesMetadataError","cubesMetadata","dataCubesObservationsData","dataCubesObservationsError","cubesObservations","TabPanel","sparqlEditorUrls","selectedDimension","inputValue","setInputValue","groupedComponents","isJoinByComponent","originalIds","getComponentLabel","omit","isJoinByDimension","metadataQuery","cubesByIri","sortedOptions","BackButton","ComponentTabPanel","expanded","Autocomplete","disablePortal","onInputChange","toLowerCase","ListboxProps","renderInput","params","TextField","endAdornment","InputAdornment","pr","renderOption","option","matches","insideWords","parts","highlight","textOverflow","clearIcon","getComponentDescription","cubesIri","cubesQuery","loadedComponent","delayMs","ComponentValues","SvgIcArrowRight","isStandardErrorDimension","isConfidenceUpperBoundDimension","isConfidenceLowerBoundDimension","MeasureValuesNumeric","DimensionValuesNominal","DimensionValuesTemporal","fontStyle","MultiSelectInput","readOnly","MultiSelectOption","isGroupHeader","disabledMessage","selectSizeToTypography","DisabledMessageIcon","selected","MultiSelectTags","getTagProps","deleteIcon","ownKeys","getOwnPropertySymbols","getOwnPropertyDescriptor","enumerable","apply","getOwnPropertyDescriptors","defineProperties","defineProperty","TransitionPopper","anchorX","anchorY","isClosing","setIsClosing","childrenRef","Popper","keepMounted","modifiers","phase","fn","el","elements","popper","TransitionProps","Grow","boundary","altBoundary","tether","mainAxis","altAxis","optionGroups","hint","sideControls","setWidth","setAnchorX","setAnchorY","setDimensions","rect","normalizedOptions","flatten","getSelectOptions","valueOptions","StableTransitionPopper","ClickAwayListener","onClickAway","Label","onOpen","multiple","disableCloseOnSelect","disableClearable","getOptionLabel","isOptionEqualToValue","getOptionDisabled","PopperComponent","renderTags","ResponsiveReactGridLayout","WidthProvider","Responsive","availableHandlesByBlockType","MIN_H","COLS","xl","lg","md","sm","ROW_HEIGHT","transitionProperty","boxSizing","userSelect","willChange","visibility","CHART_GRID_MIN_HEIGHT","allowHeightInitialization","setMounted","chartContainerClasses","useChartContainerStyles","enhancedLayouts","setEnhancedLayouts","chartLayouts","chartLayout","maxW","w","resizeHandles","minH","h","newLayouts","breakpoint","initialized","ceil","minWrapperHeight","scrollHeight","cols","rowHeight","useCSSTransforms","compactType","preventCollision","isResizable","getInitialTileWidth","MAX_W","getInitialTileHeight","generateLayout","range","_item","with","floor","exhaustive","useTreeItemStyles","iconContainer","useCustomTreeItemStyles","action","checkIcon","TreeItemContent","displayIcon","expansionIcon","icon","iconProp","nodeId","onMouseDown","other","hasChildren","handleItemClick","isSelectedInMulti","focused","handleExpansion","handleSelection","preventSelection","useTreeItem","handleMouseDown","ownClasses","handleClickLabel","handleSelect","TreeItem","MUITreeItem","ContentComponent","getFilteredOptions","rx","pruneTree","useSelectTree","controlledInputValue","onChangeInputValue","setInputValue_","useControlled","controlled","default","optionsRef","filteredOptions_","setFilteredOptions","filteredOptions","parentsRef","defaultExpanded","parents","setExpanded","handleInputChange","ev","curExpanded","flattenTree","handleNodeToggle","nodeIds","handleClickResetInput","openState","setOpenState","minMenuWidth","setMinMenuWidth","menuRef","labelsByValue","registerNode","handleOpen","clientLeft","handleNodeSelect","currentValues","treeItemClasses","treeItemTransitionProps","updatePosition","renderTreeContent","nodesData","nodeValue","expandIcon","TransitionComponent","Collapse","ContentProps","paperProps","menuTransitionProps","isAppearing","treeRef","handleKeyDown","inputNode","clientWidth","displayEmpty","onKeyDown","renderValue","Popover","slotProps","Input","autoFocus","startAdornment","TreeView","multiSelect","onNodeToggle","onNodeSelect","TagTypography","themeType","green","organizationType","blue","termsetType","unknownType","dimensionType","yellow","draftType","clickable","BlockMoreButton","blockKey","handleDuplicate","handleRemove","SvgIcMore","useTextBlockStyles","TEXT_BLOCK_WRAPPER_CLASS","TEXT_BLOCK_CONTENT_CLASS","TextBlock","handleTextBlockClick","isPropagationStopped","TextBlockActionElements","renderBaseTextBlock","DndTextBlock","setActivatorNodeRef","setNodeRef","setDraggableNodeRef","listeners","useDraggable","setDroppableNodeRef","isOver","useDroppable","setRef","dragOverClasses","useLayoutEffect","each","contentEl","wrapperEl","bp","DimensionType","MeasureType","ComponentType","FilterValueSingle","number","FilterValueMulti","FilterValueRange","string","FilterValue","Filters","SingleFilters","Description","Meta","InteractiveFiltersLegend","InteractiveFiltersTimeRange","DefaultValueOverrides","InteractiveDataFilterType","InteractiveFiltersDataConfig","boolean","CalculationType","InteractiveFiltersCalculation","InteractiveFiltersConfig","ColorMapping","SingleColorField","SegmentColorField","MeasuresColorField","GenericField","AnimationType","AnimationField","SortingOrder","SortingType","SortingField","ShowValuesBySegmentFieldExtension","shouldEnableSettingShowValuesBySegment","isBarConfig","isColumnConfig","Cube","AnnotationTarget","HighlightAnnotation","targets","highlightType","supportsAnnotations","Limit","ConversionUnit","multiplier","labels","GenericChartConfig","ShowTitleFieldExtension","ShowValuesFieldExtension","UncertaintyFieldExtension","CustomScaleDomainFieldExtension","ChartSubType","ColumnSegmentField","ColumnFields","ColumnConfig","BarSegmentField","BarFields","BarConfig","LineSegmentField","ShowDotsSize","LineFields","LineConfig","AreaSegmentField","ImputationType","IMPUTATION_TYPES","AreaFields","AreaConfig","ScatterPlotSegmentField","ScatterPlotFields","ScatterPlotConfig","PieSegmentField","PieFields","PieConfig","DivergingPaletteType","SequentialPaletteType","DimensionPaletteType","CategoricalPaletteType","DivergingPalette","SequentialPalette","CategoricalPalette","CustomPalette","ColumnTextStyle","ColumnStyleText","ColumnStyleCategory","ColumnStyleHeatmap","ColumnStyleBar","barColorPositive","barColorNegative","barColorBackground","barShowBackground","ColumnStyle","TableColumn","TableSettings","TableLinks","TableFields","TableSortingOption","TableConfig","BBox","ColorFieldOpacity","FixedColorField","CategoricalColorField","NumericalColorField","paletteType","nbClass","MapAreaLayer","MapSymbolLayer","BaseCustomLayer","isBehindAreaLayer","WMSCustomLayer","getWMSCustomLayers","WMTSCustomLayer","getWMTSCustomLayers","BaseLayer","MapFields","MapConfig","ComboLineSingleFields","ComboLineSingleConfig","ComboLineDualFields","ComboLineDualConfig","ComboLineColumnFields","ComboLineColumnConfig","RegularChartConfig","ComboChartConfig","ChartConfig","isComboLineSingleConfig","isComboLineDualConfig","isComboLineColumnConfig","isMapConfig","isColorFieldInConfig","DataSource","ResizeHandle","sw","nw","se","ne","ReactGridLayoutType","LayoutChartBlock","LayoutTextBlock","LayoutBlock","Layout","publishableChartKeys","DashboardTimeRangeFilter","DashboardDataFiltersConfig","DashboardFiltersConfig","Config","ConfiguratorStateInitial","ConfiguratorStateSelectingDataSet","ConfiguratorStateConfiguringChart","CONFIGURATOR_STATE_LAYOUTING","ConfiguratorStateLayouting","enableLayouting","ConfiguratorStatePublishing","ConfiguratorStatePublished","ConfiguratorState","decodeConfiguratorState","isFilterValueSingle","isSingleFilters","every","extractSingleFilters","relevantCubes","dimIdToJoinId","mkJoinById","useDefinitiveTemporalFilterValue","definitiveFilters","useDefinitiveFilters","temporalDims","temporalFilters","animationDim","timeSliderValue","formattedTimeSliderValue","closesValueIndex","bisectCenter","getMaybeValidChartConfigLimit","axisDimension","relatedAxisDimensionValue","relatedAxisDimensionValueLabel","relatedToFilterBy","maybeFilter","maybeFilterValue","wouldBeValid","measureConfigLimits","cr","lr","getAxisDimension","getLimitMeasure","useLimits","limitMeasure","maybeLimit","getSupportsLimitSymbols","DialogCloseButton","useAddChartConfigBasedOnNewDataset","useDataSourceStore","chartState","initChartStateFromCube","AddNewDatasetPanel","setDataSetIri","addNewDataset","handleExited","RightDrawer","ConfiguratorStateProvider","chartId","allowDefaultRedirect","ChartAnnotator","labelsMissing","ControlSection","collapse","SectionTitle","ControlSectionContent","ChartAnnotatorTabField","emptyValueWarning","mainLabel","LayoutAnnotator","hideTopBorder","LayoutAnnotatorTabField","ANNOTATION_FIELD_PREFIX","getAnnotationKey","isAnnotationField","startsWith","getDefaultHighlightAnnotation","ColorPalette","colorConfigPath","user","useUser","customColorPalettes","invalidate","useUserPalettes","defaultPalette","hasColors","hasDimensionColors","getDefaultCategoricalPalette","palettes","divergingSteppedPalettes","categoricalPalettes","currentPaletteName","currentPalette","handleChangePalette","handleChartConfigUpdate","selectedPalette","regularPalette","customPalette","setAnchorEl","handleOpenCreateColorPalette","handleCloseCreateColorPalette","focus","isValidValue","isPaletteValue","isCustomPaletteValue","valueToUse","MenuProps","selectMenuProps","ColorSquare","ColorPaletteMenuItem","ColorPaletteControls","ConfiguratorDrawer","ColorPaletteDrawerContent","useColorSquareStyles","borderBottomLeftRadius","borderBottomRightRadius","resetColorPalette","shuffleColors","random","fallbackPalette","colorMappingColors","nbMatchedColors","same","matchedColorsInPalette","ColorRamp","colorInterpolator","nSteps","_nSteps","getContext","clearRect","stepWidth","fillStyle","fillRect","imageRendering","ColorRampField","sequentialPalettes","divergingPalettes","currentPaletteId","currentCustomPalette","onSelectedItemChange","setType","selectedColorInterpolator","getFittingColorInterpolator","getColorInterpolator","PaletteSection","onTypeSelect","colorPalettes","handleAddColorPalette","customInterpolator","createSequentialInterpolator","createDivergingInterpolator","paddingY","paddingX","align","endColorHex","startColorHex","midColorHex","interpolator","ControlTabFieldInner","fieldComponents","labelId","isActive","overrideChecked","upperLabel","getLabels","ControlTabButton","ControlTabButtonInner","rightIcon","WarnIconTooltip","FieldEditIcon","componentLabels","edit","orange","iconStyles","SvgIcWarningCircle","SvgIcPen","OnOffControlTab","showIsActive","ControlTab","lowerLabel","DraggableTab","controlTabButton","controlTabButtonInnerIcon","autocompleteMenuContent","autocompleteHeader","autocompleteApplyButtonContainer","textInput","autocompleteApplyButton","setColorValues","getDefaultColorValues","titleInput","setTitleInput","isNotAvailable","setIsNotAvailable","createColorPalette","useMutate","createCustomColorPalette","updateColor","prevColors","removeColor","colorId","addColor","createColorId","saveColorPalette","mutate","captions","sequential","diverging","categorical","ColorPaletteCreator","onRemove","onUpdate","onAdd","useControlSectionStyles","controlSection","borderTopColor","borderTopStyle","useSectionTitleStyles","textDisabled","WebkitUserSelect","justifySelf","ControlSectionContext","_v","disclosure","useControlSectionContentStyles","controlSectionContent","_px","useControlSectionContext","in","closable","_closable","sectionOpen","Warning","ControlSectionSkeleton","Skeleton","addOrEditChartType","useAddOrEditChartType","ChartTypeSelectorMenu","currentChartType","testId","titleHint","justifyItems","MuiDrawer","HEADER_HEIGHT_CSS_VAR","PANEL_HEADER_CSS_VAR","TimeUnit","handleNoFilter","dateLimitProps","getDateRenderProps","DatePicker","OpenPickerIcon","inputFormat","getInputFormat","views","getViews","onAccept","keyboardInputValue","renderDay","day","dayPickerProps","PickersDay","hiddenLabel","Week","Month","Year","shouldDisableDate","shouldDisableYear","ColorPickerMenu","ssr","loadingIndicator","ControlTabField","useActiveChartField","OnOffControlTabField","DataFilterSelect","fieldProps","useSingleFilterSelect","dimensionToFieldProps","allValues","hierarchyOptions","canUseMostRecentValue","usesMostRecentValue","maxValue","pick","DataFilterTemporal","_label","isOptional","usesMostRecentDate","tabProps","useActiveLayoutField","MetaInputField","inputType","metaKey","disableToolbar","useMetaField","MarkdownInput","TextBlockInputField","activeBlock","handleChanged","useMultiFilterColorPicker","useMultiFilterContext","hasColorField","colorField","isMultiFilterFieldChecked","MultiFilterField","enableShowValue","ShowValuesMappingField","selectedHexColor","ChartOptionCheckboxField","SingleFilterField","useSingleFilterField","Radio","ColorPicker","ColorPickerField","isFetching","getOptionsWithMaybeOptional","getOptionGroupsWithMaybeOptional","ChartFieldField","useChartFieldField","allOptionGroups","ChartOptionRadioField","defaultChecked","useChartOptionRadioField","ChartOptionSliderField","useChartOptionSliderField","useChartOptionBooleanField","ChartOptionSelectField","getKey","useChartOptionSelectField","ChartOptionSwitchField","useLegendTitleVisibility","stateValue","EditorBrush","timeExtent","timeInterval","hideEndHandle","resizeRef","brushRef","brushWidth","timeScale","scaleTime","getClosestDimensionValue","brush","brushX","selection","xStart","xEnd","invert","pointer","call","move","fromPx","toPx","BRUSH_HEIGHT","optionColor","alignSelf","optionLabel","optionCheck","selectedValueRow","explodeParents","groupByParent","joinParents","sortFilterValue","localeCompare","numeric","sortFilterValues","getColorConfig","FilterControls","selectNone","allKeysLength","activeKeysLength","getHasColorMapping","colorConfig","filterDimensionId","MultiFilterContent","tree","isSegmentField","activeKeys","rawValues","sortedTree","flatOptions","optionsByValue","sortHierarchy","getOptionsFromTree","valueGroups","isHierarchyOptionSelectable","valuesByParent","handleOpenAutocomplete","pendingValuesRef","handleCloseAutocomplete","handleResetColorMapping","hasColorMapping","useEnsureUpToDateColorMapping","colorComponentValues","enableSettingShowValuesBySegment","showValuesMappingBooleans","interactiveDataFilterProps","useInteractiveDataFilterToggle","interactiveLegendFilterProps","useInteractiveFiltersToggle","interactiveFilterProps","visibleLegendProps","chartSymbol","defaultValueOverrideProps","useDefaultValueOverride","defaultValueOptions","InteractiveToggle","SvgIcRefresh","parentLabel","BreadcrumbChevron","SvgIcCheckmark","DrawerContent","enterDelay","hasOutdatedMapping","useBreadcrumbStyles","StyledAccordion","Accordion","TreeAccordionSummary","AccordionSummary","TreeAccordionDetails","AccordionDetails","TreeAccordion","depth","expandable","renderExpandButton","renderColorCheckbox","onSelect","getValueColor","disableGutters","unmountOnExit","validateChildren","areChildrenSelected","Tree","depthsMetadata","showColors","currentDepthsMetadata","setTextInput","pendingValues","setPendingValues","uniqueSelectableFlatOptions","maxDepth","newValues","getPathToColorConfigProperty","propertyPath","DimensionValuesMultiFilter","colorPath","MultiFilterContextProvider","TimeFilter","setFilterRange","activeFilter","getFilterValue","rangeActiveFilter","onChangeFrom","onChangeTo","getTimeFilterOptions","getClosestDatesFromDateRange","getTimeInterval","formatDateValue","fromOptions","toOptions","fromLabel","toLabel","InteractiveTimeRangeToggle","LeftRightFormContainer","closestFrom","closestTo","sideElementSize","useInteractiveTimeRangeToggle","DimensionValuesSingleFilter","sortedDimensionValues","valueComparator","shorter","iconSize","tabIndex","LAYOUT_HEADER_HEIGHT","MPanelLayout","LMPanelLayout","MRPanelLayout","LMRPanelLayout","panelHeaderLayout","LMRPanelHeaderLayout","LPanelHeaderWrapper","MPanelHeaderWrapper","RPanelHeaderWrapper","LPanelBodyWrapper","MPanelBodyWrapper","RPanelBodyWrapper","borderLeftColor","borderLeftWidth","borderLeftStyle","__PANEL_HEADER_CSS_VAR","PanelHeaderLayout","PanelHeaderWrapper","getLeaves","ignoreNode","isMeasure","hv","getChartOptionField","getNewChartConfig","fieldChecked","MultiFilterContext","dispatchType","getInitialConfiguringConfigBasedOnCube","CONFIGURATOR_STATE_VERSION","INITIAL_STATE","DEFAULT_DATA_SOURCE","SELECTING_DATASET_STATE","getCachedComponents","queries","readQuery","DataCubeComponentsDocument","joinDimensions","dataCubeComponents","q","setAutoFreeze","deriveFiltersFromFields","getCubeDimensions","isJoinByCube","hiddenFieldIds","groupedDimensionIds","isGrouped","cubeDimensions","applyTableDimensionToFilters","possibleFilter","fieldDimensionIds","isField","sortedCubeDimensions","applyNonTableDimensionToFilters","getOriginalDimension","originalIri","shouldBecomeSingleFilter","hierarchyTopMost","findInHierarchy","transitionStepNext","transitionStepPrevious","stepTo","getPreviousState","handleChartFieldChanged","actionSelectedValues","sideEffect","oldField","newConfig","handleChartFieldDeleted","newColorField","handleChartFieldUpdated","updatePath","updateColorMapping","oldColorMapping","fieldValue","handleInteractiveFilterChanged","setRangeFilter","adjustFilter","handleAddNewChartConfig","ensureDashboardLayoutIsCorrect","reducer","reducer_","getStateWithCurrentDataSource","commonPath","newCustomLayers","removed","splice","newIFConfig","toggleInteractiveFilterDataDimension","resolvedCubeIri","createDraft","addDatasetInConfig","removeDatasetInConfig","removedKey","log","_action$value","limitToAddIndex","nr","limitToRemoveIndex","oldBlock","newBlock","newDraft","_breakpointLayouts","breakpointLayouts","breakpointLayoutKeys","newBlocks","keysToRemove","getPreferredEmptyCellCoords","occupiedCells","dx","add","getLocalStorageKey","saveChartLocally","localStorage","setItem","latestCubeIri","getLatestCubeIri","DataCubePreviewDocument","previewDimensions","previewMeasures","initialChartConfig","shouldFetchPossibleFilters","initChartStateFromLocalStorage","storedState","getItem","rawState","migratedState","migrateConfiguratorState","upgradeConfiguratorState","removeItem","initChartStateFromChartCopy","fromChartId","fetchChartConfig","initChartStateFromChartEdit","ConfiguratorStateContext","ConfiguratorStateProviderInternal","predicate","preparePublishingState","handlePublishSuccess","opener","publishSuccess","initializeChartState","copy","publishState","onSaveConfig","reversedChartKeys","reverse","allSequential","preparedConfig","createConfig","published_state","PUBLISHED_STATE","PUBLISHED","dbConfig","user_id","updateConfig","initialState","initialStateWithDataSource","stateAndDispatch","useImmerReducer","asPath","stateToInitialize","initialize","newChartState","savedChartId","getRouterChartId","getDataSourceFromLocalStorage","getNonGenericFieldValues","mappedFiltersIds","moveFilterField","delta","possibleValues","getOwnPropertyNames","fieldIndex","indexOf","replacedIndex","replaced","cubeJoinBy","idAttribute","joinByIris","removedCubeIri","newCubes","remainingCubeIris","initConfig","withFilters","joinByByCubes","LazyDebugPanel","DebugPanel","useFlag","Suspense","fallback","ChartPreview","metadataPanelStore","ChartPreviewInner","SingleURLsPreview","DashboardPreview","snapCornerToCursor","createSnapCornerToCursor","xOffset","activeNodeRect","activatorEvent","getEventCoordinates","canvasChartPanelLayout","setIsDragging","setActiveBlock","over","setOver","renderChart","ReactGridChartPreview","DndChartPreview","renderTextBlock","DndContext","autoScroll","layoutShiftCompensation","collisionDetection","pointerWithin","onDragStart","onDragMove","DragOverlay","actionElementSlot","configuring","chartClasses","allComponents","InteractiveFiltersChartProvider","chartConfigKey","DISABLE_SCREENSHOT_ATTR_KEY","HintWarning","configurator","useLocalSnack","timeoutRef","snack","setSnack","clearTimeout","setTimeout","ConfirmButton","ChartAnnotatorSelector","AnnotatorOptions","LayoutAnnotatorSelector","orderedLocales","useOrderedLocales","panelRef","handleClosePanel","isAnnotatorField","blockType","listToggles","link","LayoutBlocksSelector","ChartAnnotationsSelector","annotationLabel","getAnnotationLabel","handleStyleTypeChange","PRIMARY_COLOR","handleColorChange","handleDelete","handleClearText","defaultHighlightAnnotation","handleDefaultOpenChange","drawerState","hasTargets","hasText","isSegmented","RadioGroup","AnnotationDrawer","opened","handleTextChange","characterLimit","disablePlugins","headings","getTargetLabel","MoveDragButton","FiltersBadge","Badge","invisible","badgeContent","DatasetsBadge","datasetsCount","AddAnnotationButton","handleAddAnnotation","ChartAnnotations","ChartAnnotationTab","ShowFilterAreaOpen","useLocalState","initialValue","storedValue","useCautionAlert","setIsOpen","CautionAlert","onConfirm","findDimensionForOption","isDimensionOfTimeUnit","inferJoinBy","newCube","tmp","rightDimension","originalIdsByCube","curr","mkVersionedJoinBy","addButton","dialog","dialogTitleClasses","dialogContentClasses","dialogActionsClasses","dialogClasses","dialogCloseArea","newAnnotation","success","listTag","listItemSecondary","previewSelect","previewSelectPaper","NewAnnotation","PreviewDataTable","existingCubes","currentComponents","inferredJoinBy","otherCube","onClickBack","addingDataset","otherCubeComponentsQuery","useDataCubeComponentsQuery","otherCubeComponents","isFetchingComponents","getCubeFiltersFromVersionedJoinBy","currentCubes","allColumns","shouldIncludeColumnInPreview","currentDimensions","currentMeasures","otherDimensions","otherMeasures","joinedColumns","joinedJoinDimensions","joinedOtherDimensions","joinedCurrentDimensions","isJoinBy","selectedColumnsRaw","setSelectedColumns","selectedColumns","selectedColumnsById","previewObservations","bestObservation","maxBy","clampedIndex","DialogContent","ErrorHint","DialogActions","LoadingButton","useAddDataset","hookState","setHookState","otherIri","addDataset","hs","addDatasetOptions","nextState","structuredClone","extractSearchOptions","sharedDimensions","sharedDimensionsByFirstTermset","sharedDimensionIds","sharedDimensionHasBeenAdded","parsedIri","parseComponentId","firstTermset","hasBeenAdded","allDimensions","ct","useMergeDatasetsData","activeChartConfig","cubesComponentQuery","cubeComponentTermsets","useDataCubesComponentTermsetsQuery","dataCubeComponentTermsets","ready","isSharedDimension","AddDatasetDrawer","setQuery","setOrder","isMergeDatasetDataReady","isMergeDatasetsDataFetching","setOtherCube","searchDimensionOptions","searchDimensionOptionsById","selectedSearchDimensions","setSelectedSearchDimensions","selectedSharedDimensions","selectedTemporalDimension","isSearchQueryPaused","searchQuery","fetchDimensionTermsets","rawSearchCubes","relevantCubeIris","resultJoinBy","inferred","reason","handleClickOtherCube","handleConfirm","handleReset","SvgIcInfoCircle","DialogTitle","autoComplete","VisuallyHidden","ListItemText","searchDimensionsSelected","borderLeft","added","tooltipPopper","tooltipClasses","tooltip","DatasetRow","canRemove","handleDatasetClick","onRemoveAdded","setLoading","SvgIcTrash","DatasetsControlSection","isDatasetDialogOpen","openDatasetDialog","closeDatasetDialog","addedIri","setAddedIri","InteractiveFiltersConfigurator","animationComponent","DataFilterSelectGeneric","rawDimension","filterDimensionIds","disableLabel","rawFilters","sharedProps","InteractiveDataFilterToggle","useEnsurePossibleFilters","setFetching","getFilterReorderCubeFilters","useFilterReorder","onAddDimensionFilter","reQueryKey","componentsFetching","executeComponentsQuery","handleMove","handleAddDimensionFilter","handleRemoveDimensionFilter","handleDragEnd","sourceIndex","destinationIndex","possibleFiltersFetching","filterDimensions","filterDimensionsByCubeIri","addableDimensions","addableDimensionsByCubeIri","missingDimensions","keysOrder","filterRow","addDimensionContainer","ChartConfigurator","fetchingData","fetchingPossibleFilters","possibleFiltersError","ChartFields","dims","cubeTitle","cubeAddableDims","droppableProps","isDragDisabled","AddFilterButton","isMenuOpen","openMenu","closeMenu","cId","Abbreviations","canUseAbbreviations","BaseLayerField","getBounds","toArray","CalculationField","ColorComponentField","getFieldOptionGroups","nbOptions","getComponentsFilteredByType","dimensionTypes","getOption","nbColorOptions","colorComponentId","colorType","colorScaleType","ComboYField","ComboLineSingleYField","ComboLineDualYField","ComboLineColumnYField","getComboOptionGroups","disable","noUnitLabel","getOptionGroups","allowNone","enableAll","addNewMeasureOptions","showAddNewMeasureButton","newComponentIds","newId","ColorSelection","leftAxisMeasure","rightAxisMeasure","lineMeasure","columnMeasure","ConversionUnitsField","conversionUnit","originalUnit","ConversionUnitSection","conversionUnits","ConversionUnitContent","numericalColor","sizeComponent","sizeConversionUnit","originalSizeUnit","colorConversionUnit","originalColorUnit","lineComponent","columnComponent","lineConversionUnit","originalLineUnit","columnConversionUnit","originalColumnUnit","leftComponent","rightComponent","leftConversionUnit","originalLeftUnit","rightConversionUnit","originalRightUnit","getDefaultConversionUnit","definedConversionUnit","handleMultiplierChange","newMultiplier","handleLabelChange","MultiplierInput","onCommit","handleCommit","parseFloat","isNaN","onBlur","errorMessage","ImputationField","getImputationTypeLabel","updateImputationType","LayoutField","hasColorPalette","hasSubType","LimitsField","actionProps","availableLimitOptions","userPalettes","supportsLimitSymbols","ScaleDomain","defaultDomain","newDomain","DomainInput","validate","ShowDotsField","ChartShowDotRadio","SizeField","encodingSortingOptions","getSortingTypeLabel","updateSortingOption","activeSortingType","sortingOrderOptions","activeSortingOrder","disabledState","subType","makeGetFieldOptionGroups","alert","attributeName","chips","chip","booleanIcon","ProviderInfoAlert","extraInfo","booleanAttributes","hasAttributes","Alert","severity","alertClasses","workingLayers","note","listbox","body2","inferUrlGroup","host","ProviderAutocomplete","wmsWmtsProvidersExtra","showExtraInfo","wmsWmtsProviders","hidden","provider","protocol","filterOptions","createFilterOptions","freeSolo","treeRow","warnIcon","LegendButton","showLegend","setShowLegend","src","alt","TreeRow","initialChecked","onCheck","setChecked","handleChangeCheckbox","useInputValueStore","setProvider","WMTSSelector","onLayerCheck","groupedLayers","status","layersByPath","selectedSet","mapTree","itemId","unsortedFilteredOptions","Spinner","LeftDrawer","CustomLayersSelector","configLayers","layersStatus","handleCheckLayer","valueType","addingLayer","setAddingLayer","getParsedLayer","configLayer","sectionTitleClasses","selectedLayers","handleLayerCheck","DraggableLayer","parsedLayer","enableTemporalFiltering","handleRemoveClick","moveFields","fieldsArray","groupFields","columnFields","sourceFields","destinationFields","updateIsGroup","allFields","updateIsHidden","addSortingOption","changeSortingOption","removeSortingOption","changeSortingOptionOrder","moveSortingOptions","sortingItemContainer","sortingItemBox","selectWrapper","removeButton","iconWrapper","TableSortingOptionItem","onChangeSortingOrder","ChangeTableSortingOption","AddTableSortingOption","useOrderedTableColumns","TableSortingOptions","useTableColumnGroupHiddenField","updater","ChartOptionGroupHiddenField","TableColumnOptions","_activeField","columnStyleOptions","getDefaultDivergingSteppedPalette","ColumnStyleSubOptions","isDimension","ChartOptionsSelector","fetchingObservations","ActiveFieldSwitch","animatable","baseEncodings","activeFieldComponentId","EncodingOptionsPanel","fieldLabelHint","otherFieldsIds","otherFields","hasOwnProperty","fieldComponent","encodingId","hasStandardError","hasConfidenceInterval","upperBoundComponent","lowerBoundComponent","chartScaleDomainEnabled","unitConversionEnabled","CUSTOM_SORT_ENABLED_COMPONENTS","LayoutConfigurator","LayoutLayoutConfigurator","LayoutSharedFiltersConfigurator","LayoutBlocksConfigurator","DashboardLayoutButton","potentialDataFilterIds","handleTimeRangeFilterToggle","at","handleDataFiltersToggle","aIndex","DashboardFiltersOptions","timeRangeCombinedDimension","canDimensionBeTimeFiltered","DashboardTimeRangeFilterOptions","updateChartStoresFrom","newDate","interactiveFiltersState","setTimeRangeFilter","updateChartStoresTo","parsedDate","useLayoutBlocksStyles","tabRightIcon","AddLayoutBlocks","handleAddTextBlock","useAddTextBlocksStyles","menuItem","menuItemIcon","menuItemText","migrateLayout","newLayoutType","defaultLayout","capitalize","usePreviewBreakpoint","setBreakpoint","previewBreakpoint","setPreviewBreakpoint","PreviewContainer","singleColumn","PreviewBreakpointToggleMenu","previewBreakpointOptions","ToggleButtonGroup","toggleButtonGroup","toggleButtonSelected","ShowDrawerButton","gridColumnGap","dragButtons","TabDropZone","isDropDisabled","emptyComponent","DraggableTabField","TableLinksSection","dimensionOptions","handleLinkComponentIdChange","linkComponentId","handleTargetComponentIdChange","BaseUrlInput","isValid","setIsValid","updateBaseUrl","sanitizedUrl","sanitizeUrl","normalizedUrl","normalizeUrl","useTableChartController","currentDraggableId","setCurrentDraggableId","handleDragStart","emptyGroups","EmptyGroups","ChartConfiguratorTable","currentDraggedField","isGroupsDropDisabled","replaceLinks","str","replacer","reactStringReplace","splitIndex","useAssureCorrectDataSource","stateGuard","setDataSource","NextStepButton","SaveDraftButton","invalidateConfig","useUserConfig","session","useSession","enqueueSnackbar","dismissSnack","debouncedSnack","createConfigMut","updatePublishedStateMut","loggedInId","updated","DRAFT","saved","hasUpdated","debouncedHasUpdated","disableFocusListener","disableHoverListener","disableTouchListener","CopyPreviewLinkButton","hashString","objectToHashString","clipboard","LayoutChartButton","PublishChartButton","editingPublishedChart","ConfigureChartStep","handlePrevious","LayoutingStep","layoutRef","handleLayoutChange","newLayoutCallback","isSingleURLs","centerLayout","PublishStep","Configurator","isLoadingConfigureChartStep","LoadingConfigureChartStep","InteractiveFiltersProvider","currentComponentIds","shouldAdd","newFilterTypes","newDataFilters","toggleInteractiveTimeRangeFilter","invalidValues","userConfigsKey","userConfigKey","useUserConfigs","configs","fetchChartConfigs","viewCount","fetchChartViewCount","isNamedNodeDimension","first","isDataCubeNamedNodeDimension","namedNodeFormatter","valuesByIri","currencyFormatter","getD3FormatLocale","minDecimals","resolution","currencyExponent","baseFormatter","dot","lastSignificantIndex","substring","memoize","getD3TimeFormatLocale","second","minute","hour","month","year","useLocalFormatters","localFormatters","timeParse","timezoneParser","decimalFormatter","formatting","hasResolution","expFormatter","abs","getDimensionFormatters","isCurrency","isDecimal","useFormatFullDateAuto","dateInput","timeMinute","timeHour","timeDay","timeMonth","timeYear","timeFormats","Hour","Minute","Second","getFormatNumber","useFormatInteger","useFormatShortDateAuto","formatSecond","formatMinute","formatHour","formatDay","formatMonth","formatYear","nb","SOURCES_BY_URL","supportsCachingPerCubeIri","queryResultsCache","useQueryKey","makeUseQuery","check","cachedResult","rawResult","setRawResult","currentQueryRef","executeQuery","finalResult","onFetching","cubeVariables","cached","DataCubeMetadataDocument","resolve","firstDimensions","firstMeasures","convertValue","DataCubeObservationsDocument","mergeObservations","dataCubeObservations","newObservation","cf","DataCubeComponentTermsetsDocument","JOIN_BY_CUBE_IRI","joinByPrefix","getJoinByIdIndex","joinById","dimensionValueSorter","joinByDimensions","fetchedDimensions","dimensionsWithJoinByIndex","joinByIndex","false","queryNormalDimensions","true","queryJoinByDimensions","joinedDimensions","joinByDimension","om","existing","ID_SEPARATOR","addColorButton","categoricalColorListContainer","colorItem","colorItemContent","DivergentColorPaletteCreator","CategoricalColorPaletteCreator","SequentialColorPaletteCreator","baseColor","colorResult","lastStartingColorRef","startingColorHex","ColorSelectionRow","DIVERGING_MAX_ALLOWED_COLORS","CATEGORICAL_MAX_ALLOWED_COLORS","warningContrast","hasEnoughContrast","getContrastWarning","__N_SSP","DatasetBrowser","hideHeader","AppLayout","__webpack_exports__","getLatestCubeIriQuery","results","filterTreeHelper","isUsed","sortTree","visitor","shift","ret","finder","createBoundUseStoreWithSelector","equals","interactiveFiltersStoreCreator","category","setTimeSlider","resetTimeSlider","addDataFilterValue","removeDataFilterValue","remainingValues","resetDataFilters","setAnnotations","InteractiveFiltersContext","getPotentialTimeRangeFilterIds","temporalEncodings","candidateIds","getPotentialDataFilterIds","dimensionIdCounts","dimensionIds","canDimensionBeMultiFiltered","storeRefs","boundSelectorRefs","ctxValue","ctxValueRef","newCtxValue","InteractiveFiltersChartContext","setBrushing","setDuration","setDefaultDuration","requestAnimationFrame","condition","msg","apiFetch","relativeUrl","method","headers","body","json","SuperJSON","prepareForServer","isUndefined","removeConfig","getCustomColorPalettes","deleteCustomColorPalette","updateCustomColorPalette","getCubeUnversionedIriQuery","queryCubeUnversionedIri","unversionedIri","makeUpgradeConfiguratorState","cubeIriUpdateFn","DataCubeLatestIriDocument","dataCubeLatestIri","getUnversionedCubeIri","DataCubeUnversionedIriDocument","dataCubeUnversionedIri","getUnversionedCubeIriServerSide","migrateChartConfig","makeMigrate","componentIri","measureIri","newAreaLayer","newSymbolLayer","colorScaleInterpolationType","colorInterpolationType","componentIris","leftAxisComponentIri","lineComponentIri","rightAxisComponentIri","columnComponentIri","dataSet","publishIri","unversionedCubeIris","getClosestUnversionedCubeIri","score","stringSimilarity","isServerSide","maybeWindow","_graphql_client__WEBPACK_IMPORTED_MODULE_5__","L","_k","defaultToVersion","makeBumpChartConfigVersionMigration","fromVersion","toVersion","fromChartConfigVersion","toChartConfigVersion","migratedChartConfig","migrationProps","LEGACY_PROD_DATA_SOURCE_URL","PROD_DATA_SOURCE_URL","oldTimeRangeFilter","restLayout","_layout$meta","restMeta","layoutsMetadata","cIri","cubeLoop","fId","migrations","migrate","fromVersionFinal","upOrDown","migration","newData","fromNumbers","toNumbers","nanoid","KEY_SEPARATOR","NUMBER_PREFIX","NEWLINE_REPLACEMENT","objectToKeyValuePairs","hashStringToObject","keyValuePairsToObject","decodeURIComponent","flattenObject","keyValuePairs","kv","firstEqualIndex","unflattenObject","parentKey","newKey","arrayKey","parseValue","num","rootKey","transformArraysAndScalars","obj","sortedKeys","numKey","possibleValuesSet","interlacer","observers","unsubscribe","Timeline","_this","formatValue","this","playing","progress","animationProgress","setProgress","requestAnimationFrameId","animationDuration","stop","cancelAnimationFrame","triggeredByAnimation","animationType","msValues","msValue","msValueScale","bisect","msRelativeValue","msRelativeValues","ms","msDuration","minMsValue","maxMsValue","formattedMsExtent","formattedValue","formattedExtent","getMaybeTimezoneDateParser","timezoneParse","QueryCache","cache","stringifyVariables","fire","listen","useCacheKey","setVersion","fetchData","cacheEntry","useHydrate","hasHydrated","setData","setStatus","useLingui","_modifyNode","removeDisabledElements","makeScreenshot","isUsingSafari","navigator","userAgent","wrapperNode","offsetWidth","cloneNode","canvasNodes","nodes","clonedCanvasNodes","canvasNode","drawImage","tableWrapper","chartSvg","chartSvgHeight","chartSvgParent","parentElement","toPng","toSvg","click","arrayBuffer","Uint8Array","atob","charCodeAt","addMetadata","Buffer","catch","finally","querySelectorAll","isTimeoutReached","setIsTimeoutReached","timeout","module","exports"],"sourceRoot":""}