{"version":3,"file":"static/chunks/74174.6109e301a065a5d5.js","mappings":"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","sources":["webpack://_N_E/./charts/pie/rendering-utils.ts","webpack://_N_E/./charts/pie/show-values-utils.ts","webpack://_N_E/./charts/pie/pie.tsx","webpack://_N_E/./charts/pie/pie-state-props.ts","webpack://_N_E/./charts/pie/pie-state.tsx","webpack://_N_E/./charts/pie/chart-pie.tsx","webpack://_N_E/./charts/shared/render-value-labels.ts","webpack://_N_E/./charts/shared/show-values-utils.ts","webpack://_N_E/./charts/shared/use-chart-formatters.ts","webpack://_N_E/./configurator/interactive-filters/time-slider.tsx"],"sourcesContent":["import { interpolate } from \"d3-interpolate\";\nimport { Selection } from \"d3-selection\";\nimport { Arc, PieArcDatum } from \"d3-shape\";\nimport { Transition } from \"d3-transition\";\n\nimport {\n  maybeTransition,\n  RenderOptions,\n} from \"@/charts/shared/rendering-utils\";\nimport { Observation } from \"@/domain/data\";\n\nexport type RenderDatum = {\n  key: string;\n  value: number;\n  arcDatum: PieArcDatum<Observation>;\n  color: string;\n  segment: string;\n};\n\ntype RenderPieOptions = RenderOptions & {\n  arcGenerator: Arc<any, any>;\n  onClick: (\n    observation: Observation,\n    { segment }: { segment?: string }\n  ) => void;\n  onHover: (\n    el: SVGPathElement,\n    observation: Observation,\n    { segment }: { segment: string }\n  ) => void;\n  onHoverOut: (el: SVGPathElement) => void;\n};\n\nexport const renderPies = (\n  g: Selection<SVGGElement, null, SVGGElement, unknown>,\n  renderData: RenderDatum[],\n  options: RenderPieOptions\n) => {\n  const { arcGenerator, transition, onClick, onHover, onHoverOut } = options;\n\n  g.selectAll<SVGPathElement, RenderDatum>(\"path\")\n    .data(renderData, (d) => d.key)\n    .join(\n      (enter) =>\n        enter\n          .append(\"path\")\n          .attr(\"data-index\", (_, i) => i)\n          .attr(\"fill\", (d) => d.color)\n          .attr(\"stroke\", \"black\")\n          .attr(\"stroke-width\", 0)\n          .on(\"click\", (_, d) => {\n            onClick(d.arcDatum.data, { segment: d.segment });\n          })\n          .on(\"mouseenter\", function (_, d) {\n            onHover(this, d.arcDatum.data, { segment: d.segment });\n          })\n          .on(\"mouseleave\", function () {\n            onHoverOut(this);\n          })\n          .call((enter) =>\n            maybeTransition(enter, {\n              transition,\n              s: (g) => g.attr(\"d\", (d) => arcGenerator(d.arcDatum)),\n              t: (g) => g.call(animatePath, arcGenerator),\n            })\n          ),\n      (update) =>\n        update.call((update) =>\n          maybeTransition(update, {\n            transition,\n            s: (g) =>\n              g\n                .attr(\"d\", (d) => arcGenerator(d.arcDatum))\n                .attr(\"fill\", (d) => d.color),\n            t: (g) =>\n              g.call(animatePath, arcGenerator).attr(\"fill\", (d) => d.color),\n          })\n        ),\n      (exit) =>\n        maybeTransition(exit, {\n          transition,\n          s: (g) => g.attr(\"d\", (d) => arcGenerator(d.arcDatum)).remove(),\n          t: (g) => g.call(animatePath, arcGenerator).remove(),\n        })\n    );\n};\n\nconst animatePath = (\n  g: Transition<SVGPathElement, RenderDatum, SVGGElement, unknown>,\n  arcGenerator: Arc<any, any>\n) => {\n  return g.attrTween(\"d\", function (d) {\n    const that = this as any;\n    // Previous arcDatum.\n    const _d = that.__d__ as PieArcDatum<Observation> | undefined;\n    const i = interpolate(_d ?? d.arcDatum, d.arcDatum);\n\n    return (t) => {\n      that.__d__ = i(t);\n      return arcGenerator(that.__d__) as string;\n    };\n  });\n};\n","import { Selection } from \"d3-selection\";\nimport { useMemo } from \"react\";\n\nimport { PieState } from \"@/charts/pie/pie-state\";\nimport { RenderDatum } from \"@/charts/pie/rendering-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { RenderTotalValueLabelDatum } from \"@/charts/shared/render-value-labels\";\nimport {\n  maybeTransition,\n  RenderOptions,\n} from \"@/charts/shared/rendering-utils\";\nimport {\n  getIsOverlapping,\n  useValueLabelFormatter,\n  ValueLabelFormatter,\n} from \"@/charts/shared/show-values-utils\";\nimport { useChartTheme } from \"@/charts/shared/use-chart-theme\";\nimport { PieFields } from \"@/config-types\";\nimport { Dimension, Measure } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { getTextWidth } from \"@/utils/get-text-width\";\n\nexport type ShowPieValueLabelsVariables = {\n  showValues: boolean;\n  valueLabelFormatter: ValueLabelFormatter;\n};\n\nexport const useShowPieValueLabelsVariables = (\n  y: PieFields[\"y\"],\n  {\n    dimensions,\n    measures,\n  }: {\n    dimensions: Dimension[];\n    measures: Measure[];\n  }\n): ShowPieValueLabelsVariables => {\n  const { showValues = false } = y;\n  const yMeasure = measures.find((d) => d.id === y.componentId);\n\n  if (!yMeasure) {\n    throw Error(\n      `No dimension <${y.componentId}> in cube! (useShowTemporalValueLabelsVariables)`\n    );\n  }\n\n  const valueLabelFormatter = useValueLabelFormatter({\n    measureId: yMeasure.id,\n    dimensions,\n    measures,\n  });\n\n  return {\n    showValues,\n    valueLabelFormatter,\n  };\n};\n\ntype RenderPieValueLabelDatum = RenderTotalValueLabelDatum & {\n  width: number;\n  connector: {\n    x1: number;\n    y1: number;\n  };\n};\n\nexport const useRenderPieValueLabelsData = ({\n  renderData,\n  outerRadius,\n}: {\n  renderData: RenderDatum[];\n  outerRadius: number;\n}) => {\n  const {\n    bounds: { width, height },\n    showValues,\n    valueLabelFormatter,\n  } = useChartState() as PieState;\n  const { labelFontSize: fontSize } = useChartTheme();\n  const valueLabelWidthsByIndex = useMemo(() => {\n    return renderData.reduce(\n      (acc, d, i) => {\n        const formattedValue = valueLabelFormatter(d.value);\n        const width = getTextWidth(formattedValue, { fontSize });\n        acc[i] = width;\n\n        return acc;\n      },\n      {} as Record<number, number>\n    );\n  }, [renderData, valueLabelFormatter, fontSize]);\n  const valueLabelsData: RenderPieValueLabelDatum[] = useMemo(() => {\n    if (!showValues || !width || !height) {\n      return [];\n    }\n\n    const previousArray: RenderPieValueLabelDatum[] = [];\n    const connectorOffset = 8;\n\n    return renderData\n      .map((d, i) => {\n        const labelWidth = valueLabelWidthsByIndex[i] ?? 0;\n        const a = (d.arcDatum.startAngle + d.arcDatum.endAngle - Math.PI) / 2;\n        const aSin = Math.sin(a);\n        const aCos = Math.cos(a);\n        const offset =\n          outerRadius + Math.min(36, Math.max(12 + labelWidth, 24)) * 1.5;\n        const x = offset * aCos;\n        const y = offset * aSin;\n        const valueLabel = valueLabelFormatter(d.value);\n\n        const datum: RenderPieValueLabelDatum = {\n          key: d.key,\n          x,\n          y,\n          valueLabel,\n          width: labelWidth,\n          connector: {\n            x1: (outerRadius + connectorOffset) * aCos,\n            y1: (outerRadius + connectorOffset) * aSin,\n          },\n        };\n\n        const isOverlapping =\n          getIsOverlapping({\n            previousArray,\n            current: datum,\n            labelHeight: fontSize,\n          }) ||\n          x - labelWidth / 2 < -width / 2 ||\n          x + labelWidth / 2 > width / 2;\n\n        if (isOverlapping) {\n          return null;\n        }\n\n        previousArray.push(datum);\n\n        return datum;\n      })\n      .filter(truthy);\n  }, [\n    showValues,\n    width,\n    height,\n    renderData,\n    valueLabelWidthsByIndex,\n    outerRadius,\n    valueLabelFormatter,\n    fontSize,\n  ]);\n\n  return valueLabelsData;\n};\n\nexport const renderPieValueLabelConnectors = (\n  g: Selection<SVGGElement, null, SVGGElement, unknown>,\n  data: RenderPieValueLabelDatum[],\n  options: RenderOptions & {}\n) => {\n  const { transition } = options;\n\n  g.selectAll<SVGLineElement, RenderPieValueLabelDatum>(\"line\")\n    .data(data, (d) => d.key)\n    .join(\n      (enter) =>\n        enter\n          .append(\"line\")\n          .attr(\"x1\", (d) => d.connector.x1)\n          .attr(\"y1\", (d) => d.connector.y1)\n          .attr(\"x2\", (d) => d.connector.x1)\n          .attr(\"y2\", (d) => d.connector.y1)\n          .attr(\"stroke\", \"black\")\n          .style(\"opacity\", 0)\n          .call((enter) =>\n            maybeTransition(enter, {\n              transition,\n              s: (g) =>\n                g\n                  .attr(\"x1\", (d) => d.connector.x1)\n                  .attr(\"y1\", (d) => d.connector.y1)\n                  .attr(\"x2\", (d) => d.x)\n                  .attr(\"y2\", (d) => d.y - 4)\n                  .style(\"opacity\", 1),\n            })\n          ),\n      (update) =>\n        maybeTransition(update, {\n          s: (g) =>\n            g\n              .attr(\"x1\", (d) => d.connector.x1)\n              .attr(\"y1\", (d) => d.connector.y1)\n              .attr(\"x2\", (d) => d.x)\n              .attr(\"y2\", (d) => d.y - 4)\n              .style(\"opacity\", 1),\n          transition,\n        }),\n      (exit) =>\n        maybeTransition(exit, {\n          transition,\n          s: (g) => g.style(\"opacity\", 0).remove(),\n        })\n    );\n};\n","import { select } from \"d3-selection\";\nimport { useEffect, useMemo, useRef } from \"react\";\n\nimport { PieState } from \"@/charts/pie/pie-state\";\nimport { RenderDatum, renderPies } from \"@/charts/pie/rendering-utils\";\nimport {\n  renderPieValueLabelConnectors,\n  useRenderPieValueLabelsData,\n} from \"@/charts/pie/show-values-utils\";\nimport { useIsEditingAnnotation } from \"@/charts/shared/annotation-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { renderTotalValueLabels } from \"@/charts/shared/render-value-labels\";\nimport {\n  renderContainer,\n  RenderContainerOptions,\n} from \"@/charts/shared/rendering-utils\";\nimport { useAnnotationInteractions } from \"@/charts/shared/use-annotation-interactions\";\nimport { useChartTheme } from \"@/charts/shared/use-chart-theme\";\nimport { Observation } from \"@/domain/data\";\nimport { useTransitionStore } from \"@/stores/transition\";\nimport { useEvent } from \"@/utils/use-event\";\n\nexport const Pie = () => {\n  const {\n    bounds: { width, height },\n    arcs,\n    arcGenerator,\n    outerRadius,\n    getSegment,\n    colors,\n    getRenderingKey,\n    getY,\n  } = useChartState() as PieState;\n  const isEditingAnnotation = useIsEditingAnnotation();\n  const { labelFontSize, fontFamily } = useChartTheme();\n  const enableTransition = useTransitionStore((state) => state.enable);\n  const transitionDuration = useTransitionStore((state) => state.duration);\n  const piesRef = useRef<SVGGElement>(null);\n  const labelsRef = useRef<SVGGElement>(null);\n  const connectorsRef = useRef<SVGGElement>(null);\n\n  const renderData = useMemo(() => {\n    return arcs.map((arcDatum) => {\n      const y = getY(arcDatum.data);\n      const segment = getSegment(arcDatum.data);\n\n      return {\n        key: getRenderingKey(arcDatum.data),\n        value: y === null || isNaN(y) ? 0 : y,\n        arcDatum,\n        color: colors(segment),\n        segment,\n      } satisfies RenderDatum;\n    });\n  }, [arcs, getY, getSegment, getRenderingKey, colors]);\n\n  const { onClick, onHover, onHoverOut } = useAnnotationInteractions({\n    focusingSegment: true,\n  });\n  const handleHover = useEvent(\n    (\n      el: SVGPathElement,\n      observation: Observation,\n      { segment }: { segment: string }\n    ) => {\n      if (!isEditingAnnotation) {\n        select(el).attr(\"stroke\", \"black\").attr(\"stroke-width\", 1);\n      }\n\n      onHover(observation, { segment });\n    }\n  );\n\n  const handleHoverOut = useEvent((el: SVGPathElement) => {\n    if (!isEditingAnnotation) {\n      select(el).attr(\"stroke\", \"black\").attr(\"stroke-width\", 0);\n    }\n    onHoverOut();\n  });\n\n  const valueLabelsData = useRenderPieValueLabelsData({\n    renderData,\n    outerRadius,\n  });\n\n  useEffect(() => {\n    const piesContainer = piesRef.current;\n    const labelsContainer = labelsRef.current;\n    const connectorsContainer = connectorsRef.current;\n\n    if (piesContainer && labelsContainer && connectorsContainer) {\n      const common: Pick<RenderContainerOptions, \"transform\" | \"transition\"> = {\n        transform: `translate(${width / 2} ${height / 2})`,\n        transition: {\n          enable: enableTransition,\n          duration: transitionDuration,\n        },\n      };\n      renderContainer(piesContainer, {\n        ...common,\n        id: \"pies\",\n        render: (g, opts) =>\n          renderPies(g, renderData, {\n            ...opts,\n            arcGenerator,\n            onClick,\n            onHover: handleHover,\n            onHoverOut: handleHoverOut,\n          }),\n      });\n      renderContainer(connectorsContainer, {\n        ...common,\n        id: \"connectors\",\n        render: (g, opts) =>\n          renderPieValueLabelConnectors(g, valueLabelsData, {\n            ...opts,\n          }),\n      });\n      renderContainer(labelsContainer, {\n        ...common,\n        id: \"labels\",\n        render: (g, opts) =>\n          renderTotalValueLabels(g, valueLabelsData, {\n            ...opts,\n            rotate: false,\n            dx: 0,\n            dy: 0,\n            fontFamily,\n            fontSize: labelFontSize,\n            strokeWidth: 8,\n          }),\n      });\n    }\n  }, [\n    arcGenerator,\n    enableTransition,\n    fontFamily,\n    handleHover,\n    handleHoverOut,\n    height,\n    labelFontSize,\n    onClick,\n    onHover,\n    onHoverOut,\n    renderData,\n    transitionDuration,\n    valueLabelsData,\n    width,\n  ]);\n\n  return (\n    <>\n      <g ref={piesRef} />\n      <g ref={connectorsRef} />\n      <g ref={labelsRef} />\n    </>\n  );\n};\n","import { usePlottableData } from \"@/charts/shared/chart-helpers\";\nimport {\n  BaseVariables,\n  ChartStateData,\n  NumericalYVariables,\n  RenderingVariables,\n  SegmentVariables,\n  useBaseVariables,\n  useChartData,\n  useNumericalYVariables,\n  useSegmentVariables,\n} from \"@/charts/shared/chart-state\";\nimport { useRenderingKeyVariable } from \"@/charts/shared/rendering-utils\";\nimport { useChartConfigFilters } from \"@/config-utils\";\nimport { PieConfig } from \"@/configurator\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type PieStateVariables = BaseVariables &\n  NumericalYVariables &\n  SegmentVariables &\n  RenderingVariables;\n\nexport const usePieStateVariables = (\n  props: ChartProps<PieConfig>\n): PieStateVariables => {\n  const {\n    chartConfig,\n    observations,\n    dimensions,\n    dimensionsById,\n    measuresById,\n  } = props;\n  const { fields } = chartConfig;\n  const { y, segment, animation } = fields;\n  const filters = useChartConfigFilters(chartConfig);\n\n  const baseVariables = useBaseVariables(chartConfig);\n  const numericalYVariables = useNumericalYVariables(\"pie\", y, {\n    measuresById,\n  });\n  const segmentVariables = useSegmentVariables(segment, {\n    dimensionsById,\n    observations,\n  });\n\n  const getRenderingKey = useRenderingKeyVariable(\n    dimensions,\n    filters,\n    animation\n  );\n\n  return {\n    ...baseVariables,\n    ...numericalYVariables,\n    ...segmentVariables,\n    getRenderingKey,\n  };\n};\n\nexport const usePieStateData = (\n  chartProps: ChartProps<PieConfig>,\n  variables: PieStateVariables\n): ChartStateData => {\n  const { chartConfig, observations } = chartProps;\n  const { getY, getSegmentAbbreviationOrLabel } = variables;\n  const plottableData = usePlottableData(observations, {\n    getY,\n  });\n\n  return useChartData(plottableData, {\n    chartConfig,\n    timeRangeDimensionId: undefined,\n    getSegmentAbbreviationOrLabel,\n  });\n};\n","import { ascending, sum } from \"d3-array\";\nimport { ScaleOrdinal, scaleOrdinal } from \"d3-scale\";\nimport { schemeCategory10 } from \"d3-scale-chromatic\";\nimport { Arc, arc, pie, PieArcDatum } from \"d3-shape\";\nimport orderBy from \"lodash/orderBy\";\nimport { PropsWithChildren, useCallback, useMemo } from \"react\";\n\nimport {\n  PieStateVariables,\n  usePieStateData,\n  usePieStateVariables,\n} from \"@/charts/pie/pie-state-props\";\nimport {\n  ShowPieValueLabelsVariables,\n  useShowPieValueLabelsVariables,\n} from \"@/charts/pie/show-values-utils\";\nimport { GetAnnotationInfo } from \"@/charts/shared/annotations\";\nimport {\n  AxisLabelSizeVariables,\n  getChartWidth,\n  useAxisLabelSizeVariables,\n  useChartBounds,\n} from \"@/charts/shared/chart-dimensions\";\nimport {\n  ChartContext,\n  ChartStateData,\n  CommonChartState,\n} from \"@/charts/shared/chart-state\";\nimport { TooltipInfo } from \"@/charts/shared/interaction/tooltip\";\nimport { useChartFormatters } from \"@/charts/shared/use-chart-formatters\";\nimport { InteractionProvider } from \"@/charts/shared/use-interaction\";\nimport { useSize } from \"@/charts/shared/use-size\";\nimport { PieConfig } from \"@/configurator\";\nimport { Observation } from \"@/domain/data\";\nimport { formatNumberWithUnit, useFormatNumber } from \"@/formatters\";\nimport { getPalette } from \"@/palettes\";\nimport {\n  getSortingOrders,\n  makeDimensionValueSorters,\n} from \"@/utils/sorting-values\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type PieState = CommonChartState &\n  PieStateVariables &\n  ShowPieValueLabelsVariables & {\n    chartType: \"pie\";\n    arcs: PieArcDatum<Observation>[];\n    arcGenerator: Arc<any, any>;\n    outerRadius: number;\n    segments: string[];\n    colors: ScaleOrdinal<string, string>;\n    getColorLabel: (segment: string) => string;\n    getAnnotationInfo: GetAnnotationInfo;\n    getTooltipInfo: (d: Observation) => TooltipInfo;\n    leftAxisLabelSize: AxisLabelSizeVariables;\n    leftAxisLabelOffsetTop: number;\n  };\n\nconst usePieState = (\n  chartProps: ChartProps<PieConfig>,\n  variables: PieStateVariables,\n  data: ChartStateData\n): PieState => {\n  const { chartConfig, dimensions, measures } = chartProps;\n  const {\n    yMeasure,\n    getY,\n    segmentDimension: _segmentDimension,\n    segmentsByAbbreviationOrLabel,\n    getSegment,\n    getSegmentAbbreviationOrLabel,\n    getSegmentLabel,\n    yAxisLabel,\n  } = variables;\n  // Segment dimension is guaranteed to be present, because it is required.\n  const segmentDimension = _segmentDimension!;\n  const { chartData, segmentData, allData } = data;\n  const { fields } = chartConfig;\n  const { y } = fields;\n\n  const { width, height } = useSize();\n  const formatNumber = useFormatNumber();\n  const formatters = useChartFormatters(chartProps);\n\n  const segmentsByValue = useMemo(() => {\n    return new Map(segmentDimension.values.map((d) => [d.value, d]));\n  }, [segmentDimension.values]);\n\n  // Map ordered segments to colors\n  const segmentFilter = chartConfig.cubes.find(\n    (d) => d.iri === segmentDimension.cubeIri\n  )?.filters[segmentDimension.id];\n  const { colors, allSegments, segments, ySum } = useMemo(() => {\n    const colors = scaleOrdinal<string, string>();\n    const measureBySegment = Object.fromEntries(\n      segmentData.map((d) => [getSegment(d), getY(d)])\n    );\n    const allUniqueSegments = Object.entries(measureBySegment)\n      .filter((x) => typeof x[1] === \"number\")\n      .map((x) => x[0]);\n    const uniqueSegments = Array.from(new Set(chartData.map(getSegment)));\n\n    const sorting = fields.segment.sorting;\n    const sorters = makeDimensionValueSorters(segmentDimension, {\n      sorting,\n      measureBySegment,\n      useAbbreviations: fields.segment.useAbbreviations,\n      dimensionFilter: segmentFilter,\n    });\n\n    const allSegments = orderBy(\n      allUniqueSegments,\n      sorters,\n      getSortingOrders(sorters, sorting)\n    );\n    const segments = allSegments.filter((d) => uniqueSegments.includes(d));\n\n    if (fields.segment && segmentDimension && fields.color) {\n      const orderedSegmentLabelsAndColors = allSegments.map((segment) => {\n        const dvIri =\n          segmentsByAbbreviationOrLabel.get(segment)?.value ||\n          segmentsByValue.get(segment)?.value ||\n          \"\";\n\n        return {\n          label: segment,\n          color:\n            fields.color.type === \"segment\"\n              ? (fields.color.colorMapping![dvIri] ?? schemeCategory10[0])\n              : schemeCategory10[0],\n        };\n      });\n\n      colors.domain(orderedSegmentLabelsAndColors.map((s) => s.label));\n      colors.range(orderedSegmentLabelsAndColors.map((s) => s.color));\n    } else {\n      colors.domain(allSegments);\n      colors.range(\n        getPalette({\n          paletteId: fields.color.paletteId,\n          colorField: fields.color,\n        })\n      );\n    }\n    // Do not let the scale be implicitly extended by children calling it\n    // on unknown values\n    colors.unknown(() => undefined);\n\n    const ySum = sum(chartData, getY);\n\n    return {\n      colors,\n      allSegments,\n      segments,\n      ySum,\n    };\n  }, [\n    fields.color,\n    fields.segment,\n    getSegment,\n    getY,\n    segmentData,\n    segmentDimension,\n    segmentsByAbbreviationOrLabel,\n    segmentsByValue,\n    segmentFilter,\n    chartData,\n  ]);\n\n  // Dimensions\n  const showValuesVariables = useShowPieValueLabelsVariables(y, {\n    dimensions,\n    measures,\n  });\n  const left = 40;\n  const right = left;\n  const leftAxisLabelSize = useAxisLabelSizeVariables({\n    label: yAxisLabel,\n    width,\n  });\n  const baseYMargin = showValuesVariables.showValues ? 90 : 50;\n  const margins = {\n    top: baseYMargin + leftAxisLabelSize.offset,\n    right,\n    bottom: baseYMargin,\n    left,\n  };\n  const chartWidth = getChartWidth({ width, left, right });\n  const bounds = useChartBounds({ width, chartWidth, height, margins });\n\n  // Pie data\n  // Sort the pie according to the segments\n  const pieSorter = useMemo(() => {\n    const segments = colors.domain();\n    const segmentIndex = Object.fromEntries(segments.map((s, i) => [s, i]));\n    return (a: Observation, b: Observation) => {\n      // We do not actually use segment sort order here, because the ascending/descending\n      // has already been done when segments where sorted\n      return ascending(\n        segmentIndex[getSegment(a)] ?? -1,\n        segmentIndex[getSegment(b)] ?? -1\n      );\n    };\n  }, [colors, getSegment]);\n\n  const getPieData = pie<Observation>()\n    .value((d) => getY(d) ?? 0)\n    .sort(pieSorter);\n\n  const valueFormatter = (value: number | null) => {\n    if (value === null) {\n      return \"-\";\n    }\n\n    const formattedValue = formatNumberWithUnit(\n      value,\n      formatters[yMeasure.id] ?? formatNumber,\n      yMeasure.unit\n    );\n    const percentage = value / ySum;\n    const rounded = Math.round(percentage * 100);\n\n    return `${rounded}% (${formattedValue})`;\n  };\n\n  const maxSide = Math.min(chartWidth, bounds.chartHeight) / 2;\n  const innerRadius = 0;\n  const outerRadius = maxSide;\n\n  const arcs = getPieData(chartData);\n  const arcGenerator = arc<$FixMe>()\n    .innerRadius(innerRadius)\n    .outerRadius(outerRadius);\n\n  const getAnnotationInfo: GetAnnotationInfo = useCallback(\n    (observation, { segment }) => {\n      const arc = arcs.find((d) => d.data === observation);\n\n      if (!arc) {\n        return {\n          x: 0,\n          y: 0,\n          color: colors(segment),\n        };\n      }\n\n      const startAngle = arc.startAngle;\n      const endAngle = arc.endAngle;\n      const midAngle = (startAngle + endAngle) / 2;\n\n      const x = Math.cos(midAngle - Math.PI / 2) * outerRadius + chartWidth / 2;\n      const y =\n        Math.sin(midAngle - Math.PI / 2) * outerRadius +\n        bounds.chartHeight / 2 -\n        4;\n\n      return {\n        x,\n        y,\n        color: colors(segment),\n      };\n    },\n    [arcs, bounds.chartHeight, chartWidth, colors, outerRadius]\n  );\n\n  const getTooltipInfo = (datum: Observation): TooltipInfo => {\n    const xAnchor = chartWidth / 2;\n    const yAnchor = -4;\n\n    const xPlacement = \"center\";\n    const yPlacement = \"top\";\n\n    return {\n      xAnchor,\n      yAnchor,\n      placement: { x: xPlacement, y: yPlacement },\n      value: getSegmentAbbreviationOrLabel(datum),\n      datum: {\n        value: valueFormatter(getY(datum)),\n        color: colors(getSegment(datum)) as string,\n      },\n      values: undefined,\n      withTriangle: false,\n    };\n  };\n\n  /** To correctly animate entering / exiting pie slices during the animation,\n   * there is a need to artificially keep all segments in the data, even if they\n   * are not present in the current data. This is done by adding a slice with\n   * value 0 for each missing segment.\n   */\n  const chartDataWithMissingSegments = useMemo(() => {\n    return chartData.concat(\n      allSegments\n        .filter((d) => !segments.includes(d))\n        .map((d) => {\n          return {\n            [segmentDimension!.id]: d,\n            [yMeasure.id]: 0,\n          } as Observation;\n        })\n    );\n  }, [chartData, allSegments, segmentDimension, segments, yMeasure.id]);\n\n  return {\n    chartType: \"pie\",\n    bounds,\n    chartData: chartDataWithMissingSegments,\n    allData,\n    arcs,\n    arcGenerator,\n    outerRadius,\n    segments,\n    colors,\n    getColorLabel: getSegmentLabel,\n    getAnnotationInfo,\n    getTooltipInfo,\n    leftAxisLabelSize,\n    leftAxisLabelOffsetTop: 0,\n    ...showValuesVariables,\n    ...variables,\n  };\n};\n\nconst PieChartProvider = (props: PropsWithChildren<ChartProps<PieConfig>>) => {\n  const { children, ...chartProps } = props;\n  const variables = usePieStateVariables(chartProps);\n  const data = usePieStateData(chartProps, variables);\n  const state = usePieState(chartProps, variables, data);\n\n  return (\n    <ChartContext.Provider value={state}>{children}</ChartContext.Provider>\n  );\n};\n\nexport const PieChart = (props: PropsWithChildren<ChartProps<PieConfig>>) => {\n  return (\n    <InteractionProvider>\n      <PieChartProvider {...props} />\n    </InteractionProvider>\n  );\n};\n","import { memo } from \"react\";\n\nimport { ChartDataWrapper } from \"@/charts/chart-data-wrapper\";\nimport { Pie } from \"@/charts/pie/pie\";\nimport { PieChart } from \"@/charts/pie/pie-state\";\nimport { useIsEditingAnnotation } from \"@/charts/shared/annotation-utils\";\nimport { Annotations } from \"@/charts/shared/annotations\";\nimport { AxisHeightTitle } from \"@/charts/shared/axis-height-title\";\nimport {\n  ChartContainer,\n  ChartControlsContainer,\n  ChartSvg,\n} from \"@/charts/shared/containers\";\nimport { HoverAnnotationDot } from \"@/charts/shared/interaction/hover-annotation-dot\";\nimport { Tooltip } from \"@/charts/shared/interaction/tooltip\";\nimport { LegendColor } from \"@/charts/shared/legend-color\";\nimport { OnlyNegativeDataHint } from \"@/components/hint\";\nimport { PieConfig } from \"@/config-types\";\nimport { useChartConfigFilters } from \"@/config-utils\";\nimport { TimeSlider } from \"@/configurator/interactive-filters/time-slider\";\n\nimport { ChartProps, VisualizationProps } from \"../shared/chart-props\";\n\nexport const ChartPieVisualization = (props: VisualizationProps<PieConfig>) => {\n  return <ChartDataWrapper {...props} Component={ChartPie} />;\n};\n\nconst ChartPie = memo((props: ChartProps<PieConfig>) => {\n  const { chartConfig, observations, dimensions, dimensionsById } = props;\n  const { fields, interactiveFiltersConfig } = chartConfig;\n  const somePositive = observations.some(\n    (d) => (d[fields?.y?.componentId] as number) > 0\n  );\n  const filters = useChartConfigFilters(chartConfig);\n  const isEditingAnnotation = useIsEditingAnnotation();\n\n  if (!somePositive) {\n    return <OnlyNegativeDataHint />;\n  }\n\n  return (\n    <PieChart {...props}>\n      <ChartContainer>\n        <ChartSvg>\n          <AxisHeightTitle />\n          <Pie />\n        </ChartSvg>\n        {isEditingAnnotation ? (\n          <HoverAnnotationDot />\n        ) : (\n          <Tooltip type=\"single\" />\n        )}\n      </ChartContainer>\n      <Annotations />\n      <ChartControlsContainer>\n        {fields.animation && (\n          <TimeSlider\n            filters={filters}\n            dimensions={dimensions}\n            {...fields.animation}\n          />\n        )}\n        <LegendColor\n          dimensionsById={dimensionsById}\n          chartConfig={chartConfig}\n          symbol=\"square\"\n          interactive={fields.segment && interactiveFiltersConfig.legend.active}\n          showTitle={fields.segment.showTitle}\n        />\n      </ChartControlsContainer>\n    </PieChart>\n  );\n});\n","import { BaseType, Selection } from \"d3-selection\";\n\nimport {\n  maybeTransition,\n  RenderOptions,\n} from \"@/charts/shared/rendering-utils\";\nimport { DISABLE_SCREENSHOT_COLOR_WIPE_KEY } from \"@/components/chart-shared\";\n\nexport type RenderTotalValueLabelDatum = {\n  key: string;\n  x: number;\n  y: number;\n  valueLabel: string;\n};\n\nexport const renderTotalValueLabels = (\n  g: Selection<SVGGElement, null, SVGGElement, unknown>,\n  data: RenderTotalValueLabelDatum[],\n  options: RenderOptions & {\n    rotate: boolean;\n    textAnchor?: \"start\" | \"middle\" | \"end\";\n    dx?: number;\n    dy?: number;\n    fontSize: number;\n    fontFamily: string;\n    strokeWidth?: number;\n  }\n) => {\n  const {\n    transition,\n    rotate,\n    textAnchor: _textAnchor,\n    dx = 0,\n    dy = -8,\n    fontFamily,\n    fontSize,\n    strokeWidth = 3,\n  } = options;\n  const textAnchor = _textAnchor ?? getValueLabelTextAnchor(rotate);\n\n  g.selectAll<SVGTextElement, RenderTotalValueLabelDatum>(\"text\")\n    .data(data, (d) => d.key)\n    .join(\n      (enter) =>\n        enter\n          .append(\"text\")\n          .attr(\"font-size\", fontSize)\n          .attr(\"font-family\", fontFamily)\n          .attr(\"text-anchor\", textAnchor)\n          .attr(\"paint-order\", \"stroke\")\n          .attr(\"stroke\", \"white\")\n          .attr(\"stroke-width\", strokeWidth)\n          .style(\"transform\", (d) =>\n            getValueLabelTransform(d, {\n              rotate,\n              labelHeight: fontSize,\n              dx,\n              dy,\n            })\n          )\n          .style(\"line-height\", 1)\n          .style(\"opacity\", 0)\n          .text((d) => d.valueLabel)\n          .call((enter) =>\n            maybeTransition(enter, {\n              transition,\n              s: (g) => g.style(\"opacity\", 1),\n            })\n          ),\n      (update) =>\n        maybeTransition(update, {\n          s: (g) =>\n            g\n              .attr(\"text-anchor\", textAnchor)\n              .style(\"transform\", (d) =>\n                getValueLabelTransform(d, {\n                  rotate,\n                  labelHeight: fontSize,\n                  dx,\n                  dy,\n                })\n              )\n              .style(\"opacity\", 1)\n              .text((d) => d.valueLabel),\n          transition,\n        }),\n      (exit) =>\n        maybeTransition(exit, {\n          transition,\n          s: (g) => g.style(\"opacity\", 0).remove(),\n        })\n    );\n};\n\nconst getValueLabelTransform = (\n  d: RenderTotalValueLabelDatum,\n  {\n    rotate,\n    labelHeight,\n    dx,\n    dy,\n  }: {\n    rotate: boolean;\n    labelHeight: number;\n    dx: number;\n    dy: number;\n  }\n) => {\n  if (rotate) {\n    return `translate(${d.x + labelHeight / 3}px, ${d.y - (labelHeight * 2) / 3}px) rotate(-90deg)`;\n  }\n\n  return `translate(${d.x + dx}px, ${d.y + dy}px) rotate(0deg)`;\n};\n\nconst getValueLabelTextAnchor = (rotate: boolean) => {\n  return rotate ? \"start\" : \"middle\";\n};\n\nexport const setSegmentWrapperValueLabelProps = <\n  T extends { valueLabel?: string; valueLabelColor?: string },\n>(\n  g: Selection<BaseType, T, SVGGElement, null>\n) => {\n  return g\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"align-items\", \"center\")\n    .style(\"width\", \"100%\")\n    .style(\"height\", \"100%\")\n    .style(\"padding\", \"2px\");\n};\n\nexport const setSegmentValueLabelProps = <\n  T extends { valueLabel?: string; valueLabelColor?: string },\n>(\n  g: Selection<BaseType, T, SVGGElement, null>\n) => {\n  return g\n    .attr(DISABLE_SCREENSHOT_COLOR_WIPE_KEY, true)\n    .style(\"overflow\", \"hidden\")\n    .style(\"font-size\", \"12px\")\n    .style(\"white-space\", \"nowrap\")\n    .style(\"text-overflow\", \"ellipsis\");\n};\n","import { ScaleLinear } from \"d3-scale\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { AreasState } from \"@/charts/area/areas-state\";\nimport { LinesState } from \"@/charts/line/lines-state\";\nimport {\n  NumericalValueGetter,\n  NumericalXErrorVariables,\n  NumericalYErrorVariables,\n  useChartState,\n} from \"@/charts/shared/chart-state\";\nimport { RenderTotalValueLabelDatum } from \"@/charts/shared/render-value-labels\";\nimport { useChartFormatters } from \"@/charts/shared/use-chart-formatters\";\nimport { useChartTheme } from \"@/charts/shared/use-chart-theme\";\nimport {\n  AreaFields,\n  BarFields,\n  ColumnFields,\n  LineFields,\n} from \"@/config-types\";\nimport { Dimension, Measure, Observation } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { formatNumberWithUnit, useFormatNumber } from \"@/formatters\";\nimport { getTextWidth } from \"@/utils/get-text-width\";\n\nexport type ShowBandValueLabelsVariables = {\n  offset: number;\n  getValueOffset: (observation: Observation) => number;\n  showValues: boolean;\n  rotateValues: boolean;\n  renderEveryNthValue: number;\n  valueLabelFormatter: ValueLabelFormatter;\n};\n\nexport const useShowBandValueLabelsVariables = (\n  measureField: BarFields[\"x\"] | ColumnFields[\"y\"],\n  {\n    chartData,\n    dimensions,\n    measures,\n    getValue,\n    getErrorRange,\n    scale,\n    bandwidth,\n  }: {\n    chartData: Observation[];\n    dimensions: Dimension[];\n    measures: Measure[];\n    getValue: NumericalValueGetter;\n    getErrorRange?:\n      | NumericalXErrorVariables[\"getXErrorRange\"]\n      | NumericalYErrorVariables[\"getYErrorRange\"];\n    scale: ScaleLinear<number, number>;\n    bandwidth?: number;\n  }\n): ShowBandValueLabelsVariables => {\n  const { showValues = false } = measureField;\n  const measure = measures.find((d) => d.id === measureField.componentId);\n\n  if (!measure) {\n    throw Error(\n      `No dimension <${measureField.componentId}> in cube! (useShowBandValueLabelsVariables)`\n    );\n  }\n\n  const disableRotation = !bandwidth;\n  const horizontal = disableRotation;\n  const { labelFontSize: fontSize } = useChartTheme();\n  const renderEveryNthValue =\n    disableRotation || bandwidth > fontSize\n      ? 1\n      : Math.ceil(fontSize / bandwidth);\n\n  const valueLabelFormatter = useValueLabelFormatter({\n    measureId: measure.id,\n    dimensions,\n    measures,\n  });\n\n  const getValueOffset: ShowBandValueLabelsVariables[\"getValueOffset\"] =\n    useCallback(\n      (observation: Observation) => {\n        const value = getValue(observation);\n\n        if (value === null) {\n          return 0;\n        }\n\n        const errorEnd = getErrorRange?.(observation)[1];\n\n        if (errorEnd === undefined) {\n          return 0;\n        }\n\n        if (horizontal) {\n          return scale(errorEnd - value);\n        }\n\n        return scale(errorEnd) - scale(value);\n      },\n      [getValue, getErrorRange, horizontal, scale]\n    );\n\n  const { offset, rotateValues } = useMemo(() => {\n    let offset = 0;\n    let rotateValues = false;\n\n    if (showValues) {\n      let maxWidth = 0;\n\n      chartData.forEach((d) => {\n        const value = getValue(d);\n        const formattedValue = valueLabelFormatter(value);\n        const width = getTextWidth(formattedValue, { fontSize });\n\n        if (!disableRotation && width - 2 > bandwidth) {\n          rotateValues = true;\n        }\n\n        if (width > maxWidth) {\n          maxWidth = width;\n        }\n      });\n\n      if (disableRotation || rotateValues) {\n        offset = maxWidth;\n      } else {\n        offset = fontSize;\n      }\n    }\n\n    return {\n      offset,\n      rotateValues,\n    };\n  }, [\n    showValues,\n    chartData,\n    disableRotation,\n    getValue,\n    valueLabelFormatter,\n    fontSize,\n    bandwidth,\n  ]);\n\n  return {\n    offset,\n    getValueOffset,\n    showValues,\n    rotateValues,\n    renderEveryNthValue,\n    valueLabelFormatter,\n  };\n};\n\nexport type ShowTemporalValueLabelsVariables = {\n  yOffset: number;\n  showValues: boolean;\n  valueLabelFormatter: ValueLabelFormatter;\n};\n\nexport const useShowTemporalValueLabelsVariables = (\n  y: AreaFields[\"y\"] | LineFields[\"y\"],\n  {\n    dimensions,\n    measures,\n    segment,\n  }: {\n    dimensions: Dimension[];\n    measures: Measure[];\n    segment: AreaFields[\"segment\"] | LineFields[\"segment\"];\n  }\n): ShowTemporalValueLabelsVariables => {\n  const { showValues: _showValues = false } = y;\n  const yMeasure = measures.find((d) => d.id === y.componentId);\n\n  if (!yMeasure) {\n    throw Error(\n      `No dimension <${y.componentId}> in cube! (useShowLineValueLabelsVariables)`\n    );\n  }\n\n  const { labelFontSize: fontSize } = useChartTheme();\n\n  const valueLabelFormatter = useValueLabelFormatter({\n    measureId: yMeasure.id,\n    dimensions,\n    measures,\n  });\n\n  const showValues = _showValues && !segment;\n\n  return {\n    yOffset: showValues ? fontSize : 0,\n    showValues,\n    valueLabelFormatter,\n  };\n};\n\ntype RenderTemporalValueLabelDatum = RenderTotalValueLabelDatum & {\n  width: number;\n};\n\nexport const useRenderTemporalValueLabelsData = () => {\n  const {\n    bounds: {\n      width,\n      height,\n      margins: { left, right },\n    },\n    showValues,\n    chartData,\n    xScale,\n    getX,\n    getXAsString,\n    yScale,\n    getY,\n    valueLabelFormatter,\n  } = useChartState() as AreasState | LinesState;\n  const { labelFontSize: fontSize } = useChartTheme();\n  const valueLabelWidthsByIndex = useMemo(() => {\n    return chartData.reduce((acc, d, i) => {\n      const formattedValue = valueLabelFormatter(getY(d));\n      const width = getTextWidth(formattedValue, { fontSize });\n      acc[i] = width;\n\n      return acc;\n    }, {}) as Record<number, number>;\n  }, [chartData, valueLabelFormatter, getY, fontSize]);\n  const valueLabelsData: RenderTemporalValueLabelDatum[] = useMemo(() => {\n    if (!showValues || !width || !height) {\n      return [];\n    }\n\n    const previousArray: RenderTemporalValueLabelDatum[] = [];\n\n    return chartData\n      .map((d, i) => {\n        const labelWidth = valueLabelWidthsByIndex[i] ?? 0;\n        const key = getXAsString(d);\n        const valueRaw = getY(d);\n        const xScaled = xScale(getX(d)) as number;\n        const value = valueRaw === null || isNaN(valueRaw) ? 0 : valueRaw;\n        const yRender = yScale(Math.max(value, 0));\n        const valueLabel = valueLabelFormatter(value);\n\n        const padding = 8;\n        const xScaledInBounds = Math.min(\n          Math.max(\n            Math.min(left - labelWidth / 2 + padding, labelWidth / 2),\n            xScaled\n          ),\n          width - right - left - labelWidth / 2 + padding\n        );\n\n        const datum: RenderTemporalValueLabelDatum = {\n          key,\n          x: xScaledInBounds,\n          y: yRender,\n          valueLabel,\n          width: labelWidth,\n        };\n\n        const isOverlapping = getIsOverlapping({\n          previousArray,\n          current: datum,\n          labelHeight: fontSize,\n        });\n\n        if (isOverlapping) {\n          return null;\n        }\n\n        previousArray.push(datum);\n\n        return datum;\n      })\n      .filter(truthy);\n  }, [\n    showValues,\n    width,\n    height,\n    chartData,\n    valueLabelWidthsByIndex,\n    getXAsString,\n    getY,\n    xScale,\n    getX,\n    yScale,\n    valueLabelFormatter,\n    left,\n    right,\n    fontSize,\n  ]);\n\n  return valueLabelsData;\n};\n\nexport const getIsOverlapping = ({\n  previousArray,\n  current,\n  labelHeight,\n  horizontalOffset = 8,\n}: {\n  previousArray: RenderTemporalValueLabelDatum[];\n  current: RenderTemporalValueLabelDatum;\n  labelHeight: number;\n  horizontalOffset?: number;\n}) => {\n  return previousArray.some((previous) => {\n    return (\n      Math.abs(current.x - previous.x) - horizontalOffset <\n        previous.width / 2 + current.width / 2 &&\n      Math.abs(current.y - previous.y) < labelHeight\n    );\n  });\n};\n\nexport type ValueLabelFormatter = ReturnType<typeof useValueLabelFormatter>;\n\nexport const useValueLabelFormatter = ({\n  measureId,\n  dimensions,\n  measures,\n  normalize,\n}: {\n  measureId: string;\n  dimensions: Dimension[];\n  measures: Measure[];\n  normalize?: boolean;\n}) => {\n  const formatPercent = useFormatNumber({ decimals: 0 });\n  const formatNumber = useFormatNumber({ decimals: \"auto\" });\n  const formatters = useChartFormatters({ dimensions, measures });\n  const valueFormatter = normalize\n    ? formatPercent\n    : (formatters[measureId] ?? formatNumber);\n\n  return useCallback(\n    (value: number | null) => {\n      return formatNumberWithUnit(value, valueFormatter);\n    },\n    [valueFormatter]\n  );\n};\n","import { useMemo } from \"react\";\n\nimport { useDimensionFormatters } from \"@/formatters\";\n\nimport { BaseChartProps } from \"./chart-props\";\n\nexport const useChartFormatters = (\n  chartProps: Pick<BaseChartProps, \"dimensions\" | \"measures\">\n) => {\n  const { dimensions, measures } = chartProps;\n  const components = useMemo(\n    () => [...dimensions, ...measures],\n    [dimensions, measures]\n  );\n\n  return useDimensionFormatters(components);\n};\n","import { Box, Button, sliderClasses, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport orderBy from \"lodash/orderBy\";\nimport {\n  ChangeEvent,\n  createContext,\n  useContext,\n  useEffect,\n  useMemo,\n} from \"react\";\nimport { useSyncExternalStore } from \"use-sync-external-store/shim\";\n\nimport { ChartState, useChartState } from \"@/charts/shared/chart-state\";\nimport { TableChartState } from \"@/charts/table/table-state\";\nimport { Slider as GenericSlider } from \"@/components/form\";\nimport { AnimationField, Filters, SortingField } from \"@/config-types\";\nimport { parseDate } from \"@/configurator/components/ui-helpers\";\nimport { hasChartConfigs } from \"@/configurator/configurator-state\";\nimport {\n  Dimension,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  isTemporalOrdinalDimension,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { Icon } from \"@/icons\";\nimport { useConfiguratorState } from \"@/src\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\nimport { Timeline, TimelineProps } from \"@/utils/observables\";\nimport {\n  getSortingOrders,\n  makeDimensionValueSorters,\n} from \"@/utils/sorting-values\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nconst TimelineContext = createContext<Timeline | undefined>(undefined);\n\nconst useTimeline = () => {\n  const timeline = useContext(TimelineContext);\n\n  if (!timeline) {\n    throw Error(\n      \"useTimeline must be called inside a TimelineContext.Provider!\"\n    );\n  }\n\n  useSyncExternalStore(timeline.subscribe, timeline.getUpdateKey);\n\n  return timeline;\n};\n\ntype TimeSliderProps = {\n  filters: Filters;\n  dimensions: Dimension[];\n} & AnimationField;\n\nexport const TimeSlider = (props: TimeSliderProps) => {\n  const {\n    componentId,\n    showPlayButton,\n    type: animationType,\n    duration: animationDuration,\n    filters,\n    dimensions,\n  } = props;\n\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const dimension = useMemo(() => {\n    return dimensions.find((d) => d.id === componentId);\n  }, [componentId, dimensions]);\n  const temporal = isTemporalDimension(dimension);\n  const temporalEntity = isTemporalEntityDimension(dimension);\n  const temporalOrdinal = isTemporalOrdinalDimension(dimension);\n\n  if (!(temporal || temporalEntity || temporalOrdinal)) {\n    throw Error(\"You can only use TimeSlider with temporal dimensions!\");\n  }\n\n  const timeFormatUnit = useTimeFormatUnit();\n  const timeUnit = \"timeUnit\" in dimension ? dimension.timeUnit : undefined;\n\n  // No TimeSlider for tables.\n  const chartState = useChartState() as NonNullable<\n    Exclude<ChartState, TableChartState>\n  >;\n  const dimensionFilter = filters[dimension.id];\n  const timelineProps: TimelineProps = useMemo(() => {\n    const commonProps = {\n      animationType,\n      msDuration: animationDuration * 1000,\n    };\n    const uniqueValues = Array.from(\n      new Set(\n        chartState.allData\n          .map((d) => d[dimension.id])\n          .filter(truthy) as string[]\n      )\n    );\n\n    if (temporal) {\n      const msValues = uniqueValues.map((d) => parseDate(d).getTime());\n      const formatValue = (d: number) => timeFormatUnit(new Date(d), timeUnit!);\n\n      return {\n        type: \"interval\",\n        msValues,\n        formatValue,\n        ...commonProps,\n      };\n    } else {\n      const sorting: NonNullable<SortingField[\"sorting\"]> = {\n        sortingType: \"byAuto\",\n        sortingOrder: \"asc\",\n      };\n      const sorters = makeDimensionValueSorters(dimension, {\n        dimensionFilter,\n        sorting,\n      });\n      const sortingOrders = getSortingOrders(sorters, sorting);\n      const sortedData = orderBy(uniqueValues, sorters, sortingOrders);\n\n      return {\n        type: \"ordinal\",\n        sortedData,\n        ...commonProps,\n      };\n    }\n  }, [\n    animationType,\n    animationDuration,\n    chartState.allData,\n    temporal,\n    dimension,\n    timeFormatUnit,\n    timeUnit,\n    dimensionFilter,\n  ]);\n\n  const timeline = useMemo(() => {\n    return new Timeline(timelineProps);\n  }, [timelineProps]);\n\n  if (state.dashboardFilters?.timeRange.active) {\n    return null;\n  }\n\n  return (\n    <TimelineContext.Provider value={timeline}>\n      <Root showPlayButton={showPlayButton} />\n    </TimelineContext.Provider>\n  );\n};\n\nconst Root = ({ showPlayButton }: { showPlayButton: boolean }) => {\n  const timeline = useTimeline();\n  const [min, max] = timeline.formattedExtent;\n\n  return (\n    <Box\n      {...DISABLE_SCREENSHOT_ATTR}\n      sx={{\n        display: \"flex\",\n        alignItems: \"center\",\n        gap: 5,\n        mb: 5,\n        mr: 2.5,\n      }}\n    >\n      {showPlayButton && <PlayButton />}\n      <div style={{ position: \"relative\", width: \"100%\" }}>\n        <Slider />\n        <Typography\n          variant=\"caption\"\n          sx={{ position: \"absolute\", left: 0, mt: 2 }}\n        >\n          {min}\n        </Typography>\n        <Typography\n          variant=\"caption\"\n          sx={{ position: \"absolute\", right: 0, mt: 2 }}\n        >\n          {max}\n        </Typography>\n      </div>\n    </Box>\n  );\n};\n\nconst PlayButton = () => {\n  const timeline = useTimeline();\n\n  const onClick = useEvent(() => {\n    timeline.playing ? timeline.stop() : timeline.start();\n  });\n\n  return (\n    <Button\n      onClick={onClick}\n      variant=\"outlined\"\n      style={{\n        minHeight: 32,\n        minWidth: 32,\n        padding: 0,\n        borderRadius: \"50%\",\n      }}\n    >\n      <Icon name={timeline.playing ? \"pause\" : \"play\"} size={16} />\n    </Button>\n  );\n};\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    width: \"100%\",\n\n    [`& .${sliderClasses.root}`]: {\n      height: \"6px\",\n\n      [`& .${sliderClasses.thumb}`]: {\n        width: \"16px\",\n        height: \"16px\",\n      },\n    },\n  },\n\n  playing: {\n    [`& .${sliderClasses.thumb}`]: {\n      transition: \"none\",\n    },\n\n    [`& .${sliderClasses.track}`]: {\n      transition: \"none\",\n    },\n  },\n}));\n\nconst Slider = () => {\n  const timeline = useTimeline();\n  const timeSlider = useChartInteractiveFilters((d) => d.timeSlider);\n  const setTimeSlider = useChartInteractiveFilters((d) => d.setTimeSlider);\n  const classes = useStyles();\n\n  const marks = useMemo(() => {\n    return timeline.domain.map((d) => ({ value: d })) ?? [];\n  }, [timeline.domain]);\n\n  const onChange = useEvent((e: ChangeEvent<HTMLInputElement>) => {\n    timeline.setProgress(+e.target.value);\n  });\n\n  const onClick = useEvent(() => {\n    timeline.stop();\n  });\n\n  useEffect(() => {\n    if (timeline.type !== timeSlider.type) {\n      setTimeSlider({\n        type: timeline.type,\n        value: undefined,\n      });\n    }\n\n    if (\n      timeline.type === \"interval\" &&\n      timeSlider.type === \"interval\" &&\n      timeSlider.value?.getTime() !== timeline.value\n    ) {\n      setTimeSlider({\n        type: \"interval\",\n        value: new Date(timeline.value),\n      });\n    }\n\n    if (\n      timeline.type === \"ordinal\" &&\n      timeSlider.type === \"ordinal\" &&\n      timeSlider?.value !== timeline.value\n    ) {\n      setTimeSlider({\n        type: \"ordinal\",\n        value: timeline.value as string,\n      });\n    }\n  }, [\n    timeline.value,\n    timeline.type,\n    timeSlider.type,\n    timeSlider.value,\n    setTimeSlider,\n  ]);\n\n  return (\n    <GenericSlider\n      name=\"time-slider\"\n      renderTextInput={false}\n      min={0}\n      max={1}\n      step={null}\n      marks={marks}\n      value={timeline.progress}\n      onChange={onChange}\n      onClick={onClick}\n      valueLabelDisplay=\"on\"\n      valueLabelFormat={timeline.formattedValue}\n      className={clsx(classes.root, timeline.playing && classes.playing)}\n    />\n  );\n};\n"],"names":["renderPies","g","renderData","options","arcGenerator","transition","onClick","onHover","onHoverOut","selectAll","data","d","key","join","enter","append","attr","_","i","color","on","arcDatum","segment","call","maybeTransition","s","t","animatePath","update","exit","remove","attrTween","that","_d","__d__","interpolate","useShowPieValueLabelsVariables","y","_ref","dimensions","measures","showValues","yMeasure","find","id","componentId","Error","valueLabelFormatter","useValueLabelFormatter","measureId","useRenderPieValueLabelsData","_ref2","outerRadius","bounds","width","height","useChartState","labelFontSize","fontSize","useChartTheme","valueLabelWidthsByIndex","useMemo","reduce","acc","formattedValue","value","getTextWidth","previousArray","map","labelWidth","a","startAngle","endAngle","Math","PI","aSin","sin","aCos","cos","offset","min","max","x","valueLabel","datum","connector","x1","connectorOffset","y1","getIsOverlapping","current","labelHeight","push","filter","truthy","renderPieValueLabelConnectors","style","Pie","arcs","getSegment","colors","getRenderingKey","getY","isEditingAnnotation","useIsEditingAnnotation","fontFamily","enableTransition","useTransitionStore","state","enable","transitionDuration","duration","piesRef","useRef","labelsRef","connectorsRef","isNaN","useAnnotationInteractions","focusingSegment","handleHover","useEvent","el","observation","select","handleHoverOut","valueLabelsData","useEffect","piesContainer","labelsContainer","connectorsContainer","common","transform","renderContainer","_objectSpread","render","opts","renderTotalValueLabels","rotate","dx","dy","strokeWidth","_jsxs","_Fragment","children","_jsx","ref","usePieStateVariables","props","chartConfig","observations","dimensionsById","measuresById","fields","animation","filters","useChartConfigFilters","baseVariables","useBaseVariables","numericalYVariables","useNumericalYVariables","segmentVariables","useSegmentVariables","useRenderingKeyVariable","usePieStateData","chartProps","variables","getSegmentAbbreviationOrLabel","plottableData","usePlottableData","useChartData","timeRangeDimensionId","undefined","usePieState","segmentDimension","_segmentDimension","segmentsByAbbreviationOrLabel","getSegmentLabel","yAxisLabel","chartData","segmentData","allData","useSize","formatNumber","useFormatNumber","formatters","useChartFormatters","segmentsByValue","Map","values","segmentFilter","cubes","iri","cubeIri","allSegments","segments","ySum","scaleOrdinal","measureBySegment","Object","fromEntries","allUniqueSegments","entries","uniqueSegments","Array","from","Set","sorting","sorters","makeDimensionValueSorters","useAbbreviations","dimensionFilter","orderBy","getSortingOrders","includes","orderedSegmentLabelsAndColors","dvIri","get","label","type","colorMapping","schemeCategory10","domain","range","getPalette","paletteId","colorField","unknown","sum","showValuesVariables","leftAxisLabelSize","useAxisLabelSizeVariables","baseYMargin","margins","top","right","bottom","left","chartWidth","getChartWidth","useChartBounds","pieSorter","segmentIndex","b","ascending","getPieData","pie","sort","valueFormatter","formatNumberWithUnit","unit","percentage","round","maxSide","chartHeight","arc","innerRadius","getAnnotationInfo","useCallback","midAngle","chartType","concat","getColorLabel","getTooltipInfo","xAnchor","yAnchor","placement","withTriangle","leftAxisLabelOffsetTop","PieChartProvider","_objectWithoutProperties","_excluded","ChartContext","Provider","PieChart","InteractionProvider","ChartPieVisualization","ChartDataWrapper","Component","ChartPie","memo","interactiveFiltersConfig","somePositive","some","ChartContainer","ChartSvg","AxisHeightTitle","HoverAnnotationDot","Tooltip","Annotations","ChartControlsContainer","TimeSlider","LegendColor","symbol","interactive","legend","active","showTitle","OnlyNegativeDataHint","textAnchor","_textAnchor","getValueLabelTextAnchor","getValueLabelTransform","text","setSegmentWrapperValueLabelProps","setSegmentValueLabelProps","DISABLE_SCREENSHOT_COLOR_WIPE_KEY","useShowBandValueLabelsVariables","measureField","getValue","getErrorRange","scale","bandwidth","measure","disableRotation","renderEveryNthValue","ceil","getValueOffset","errorEnd","rotateValues","maxWidth","forEach","useShowTemporalValueLabelsVariables","_showValues","yOffset","useRenderTemporalValueLabelsData","xScale","getX","getXAsString","yScale","valueRaw","xScaled","_ref3","horizontalOffset","previous","abs","_ref4","normalize","formatPercent","decimals","components","useDimensionFormatters","TimelineContext","createContext","useTimeline","timeline","useContext","useSyncExternalStore","subscribe","getUpdateKey","showPlayButton","animationType","animationDuration","useConfiguratorState","hasChartConfigs","dimension","temporal","isTemporalDimension","temporalEntity","isTemporalEntityDimension","temporalOrdinal","isTemporalOrdinalDimension","timeFormatUnit","useTimeFormatUnit","timeUnit","chartState","timelineProps","commonProps","msDuration","uniqueValues","msValues","parseDate","getTime","formatValue","Date","sortingType","sortingOrder","sortingOrders","sortedData","Timeline","dashboardFilters","timeRange","Root","formattedExtent","Box","DISABLE_SCREENSHOT_ATTR","sx","display","alignItems","gap","mb","mr","PlayButton","position","Slider","Typography","variant","mt","playing","stop","start","Button","minHeight","minWidth","padding","borderRadius","Icon","name","size","useStyles","makeStyles","root","sliderClasses","thumb","track","timeSlider","useChartInteractiveFilters","setTimeSlider","classes","marks","onChange","e","setProgress","target","GenericSlider","renderTextInput","step","progress","valueLabelDisplay","valueLabelFormat","className","clsx"],"sourceRoot":""}