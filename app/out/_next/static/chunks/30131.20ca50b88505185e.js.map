{"version":3,"file":"static/chunks/30131.20ca50b88505185e.js","mappings":"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","sources":["webpack://_N_E/./charts/map/helpers.ts","webpack://_N_E/./charts/map/custom-attribution.tsx","webpack://_N_E/./charts/map/dashed-scatterplot-layer.ts","webpack://_N_E/./charts/map/style-helpers.ts","webpack://_N_E/./charts/map/get-base-layer-style.ts","webpack://_N_E/./charts/map/map-tooltip.tsx","webpack://_N_E/./charts/map/map.tsx","webpack://_N_E/./charts/map/map-custom-layers-legend.tsx","webpack://_N_E/./charts/map/map-legend.tsx","webpack://_N_E/./charts/map/map-state-props.ts","webpack://_N_E/./charts/map/map-state.tsx","webpack://_N_E/./charts/map/chart-map.tsx","webpack://_N_E/./charts/shared/use-chart-formatters.ts","webpack://_N_E/./configurator/interactive-filters/time-slider.tsx"],"sourcesContent":["import { WebMercatorViewport } from \"@deck.gl/core\";\nimport { MapboxOverlay, MapboxOverlayProps } from \"@deck.gl/mapbox\";\nimport { extent } from \"d3-array\";\nimport { geoBounds } from \"d3-geo\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useControl, ViewState } from \"react-map-gl\";\nimport { feature } from \"topojson-client\";\n\nimport { BBox, Filters } from \"@/config-types\";\nimport {\n  AreaLayer,\n  GeoCoordinates,\n  GeoShapes,\n  Observation,\n  SymbolLayer,\n} from \"@/domain/data\";\nimport { useEvent } from \"@/utils/use-event\";\n\ntype MinMaxZoomViewState = Pick<\n  ViewState,\n  \"zoom\" | \"latitude\" | \"longitude\"\n> & {\n  minZoom: number;\n  maxZoom: number;\n  width: number;\n  height: number;\n};\n\nexport const BASE_VIEW_STATE: MinMaxZoomViewState = {\n  minZoom: 1,\n  maxZoom: 13,\n  latitude: 46.8182,\n  longitude: 8.2275,\n  zoom: 5,\n  width: 400,\n  height: 400,\n};\n\n/**\n * Compute map center along with a proper zoom level taking chart dimensions\n * into account.\n *\n * @param bbox Bounding box of the feature to be contained.\n * @param chartDimensions Chart's dimensions needed to correctly initialize view state\n * in locked mode.\n */\nconst getViewStateFromBounds = ({\n  width,\n  height,\n  bbox,\n  padding = 0,\n}: {\n  width: number;\n  height: number;\n  padding?: number;\n  bbox: BBox | undefined;\n}) => {\n  if (!bbox) {\n    return;\n  }\n\n  const viewport = new WebMercatorViewport({\n    ...BASE_VIEW_STATE,\n    width: width * (1 - padding),\n    height: height * (1 - padding),\n  });\n  const fitted = viewport.fitBounds(bbox);\n\n  return { ...BASE_VIEW_STATE, ...fitted };\n};\n\n/**\n * @param bbox Bounding box saved in chart config or bounding box of visible features.\n * @param chartDimensions Chart's dimensions needed to correctly initialize view state\n * in locked mode.\n * @param locked Boolean describing whether a map is locked (interactions disabled,\n * bbox saved in chart config and maintained during resizing) or not (interactions allowed,\n * initial view state dynamically adjusted to fit visible features).\n */\nexport type ViewStateInitializationProps = {\n  width: number;\n  height: number;\n  lockedBBox: BBox | undefined;\n  featuresBBox: BBox | undefined;\n};\n\n/**\n * Hook used by a map chart that controls its view state.\n *\n * In addition to keeping track on the current view state, it also exposes\n * the initial view state of the map and makes sure that it contains all features\n * in the first place (if the map was not initialized with a locked mode).\n */\nexport const useViewState = (props: ViewStateInitializationProps) => {\n  const { width, height, lockedBBox, featuresBBox } = props;\n  const lockedViewState = useMemo(() => {\n    return getViewStateFromBounds({\n      width,\n      height,\n      bbox: lockedBBox,\n    });\n  }, [width, height, lockedBBox]);\n  const defaultViewState = useMemo(() => {\n    return (\n      getViewStateFromBounds({\n        width,\n        height,\n        padding: 1 / 4,\n        bbox: featuresBBox,\n      }) ?? BASE_VIEW_STATE\n    );\n  }, [width, height, featuresBBox]);\n\n  // Locked view state takes precedence, as it must have come from a locked mode.\n  const [viewState, setViewState] = useState(\n    () => lockedViewState ?? defaultViewState\n  );\n  const onViewStateChange = useEvent(\n    ({ viewState }: { viewState: ViewState }) => {\n      setViewState((oldViewState) => ({ ...oldViewState, ...viewState }));\n    }\n  );\n\n  // Update view state when locked or default view state changes.\n  useEffect(() => {\n    setViewState(lockedViewState ?? defaultViewState);\n  }, [lockedViewState, defaultViewState]);\n\n  return { defaultViewState, viewState, onViewStateChange };\n};\n\nexport const getBBox = (\n  shapes?: AreaLayer[\"shapes\"],\n  symbols?: SymbolLayer[\"points\"]\n) => {\n  let shapesBbox: BBox | undefined;\n  let symbolsBbox: BBox | undefined;\n\n  if (shapes) {\n    const _shapesBbox = geoBounds(shapes);\n    if (!_shapesBbox.flat().some(isNaN)) {\n      shapesBbox = _shapesBbox;\n    }\n  }\n\n  if (symbols) {\n    const visiblePoints = symbols.filter(\n      (d) => d.properties.observation !== undefined\n    );\n\n    if (visiblePoints.length > 0) {\n      const [minLng, maxLng] = extent(visiblePoints, (d) => d.coordinates[0]);\n      const [minLat, maxLat] = extent(visiblePoints, (d) => d.coordinates[1]);\n\n      symbolsBbox = [\n        [minLng, minLat],\n        [maxLng, maxLat],\n      ] as BBox;\n    }\n  }\n\n  if (shapesBbox !== undefined) {\n    if (symbolsBbox !== undefined) {\n      const [minLng, maxLng] = [\n        Math.min(shapesBbox[0][0], symbolsBbox[0][0]),\n        Math.max(shapesBbox[1][0], symbolsBbox[1][0]),\n      ];\n      const [minLat, maxLat] = [\n        Math.min(shapesBbox[0][1], symbolsBbox[0][1]),\n        Math.max(shapesBbox[1][1], symbolsBbox[1][1]),\n      ];\n      const bbox = [\n        [minLng, minLat],\n        [maxLng, maxLat],\n      ] as BBox;\n\n      return bbox;\n    } else {\n      return shapesBbox;\n    }\n  } else {\n    return symbolsBbox;\n  }\n};\n\nexport const prepareFeatureCollection = ({\n  dimensionId,\n  topology,\n  filters,\n  observations,\n}: {\n  dimensionId: string;\n  topology: GeoShapes[\"topology\"];\n  filters: Filters[string];\n  observations: Observation[];\n}) => {\n  const activeFiltersIris = filters\n    ? filters.type === \"single\"\n      ? [filters.value]\n      : filters.type === \"multi\"\n        ? Object.keys(filters.values)\n        : undefined\n    : undefined;\n\n  const featureCollection = feature(\n    topology,\n    topology.objects.shapes\n  ) as AreaLayer[\"shapes\"];\n\n  // Completely hide unselected shapes (so they don't affect the legend, etc)\n  if (activeFiltersIris) {\n    featureCollection.features = featureCollection.features.filter((d) => {\n      return activeFiltersIris.includes(d.properties.iri);\n    });\n  }\n\n  featureCollection.features.forEach((f) => {\n    const observation = observations.find((o) => {\n      const iri = o[`${dimensionId}/__iri__`];\n      const label = o[dimensionId];\n\n      return iri ? iri === f.properties.iri : label === f.properties.label;\n    });\n\n    f.properties = {\n      ...f.properties,\n      observation,\n    };\n  });\n\n  return featureCollection;\n};\n\n// Used to render DeckGL layers in synchronization with base map layers.\nexport function DeckGLOverlay(\n  props: MapboxOverlayProps & {\n    interleaved?: boolean;\n  }\n) {\n  // @ts-ignore\n  const overlay = useControl<MapboxOverlay>(() => new MapboxOverlay(props));\n  overlay.setProps(props);\n\n  return null;\n}\n\nexport const shouldRenderMap = ({\n  areaDimensionId,\n  symbolDimensionId,\n  geometries,\n  coordinates,\n}: {\n  areaDimensionId: string | undefined;\n  symbolDimensionId: string | undefined;\n  geometries: any[] | undefined;\n  coordinates: GeoCoordinates | undefined;\n}) => {\n  const areaLayerPresent = !!(areaDimensionId !== \"\" && geometries);\n  const symbolLayerPresent = !!(\n    symbolDimensionId !== \"\" &&\n    (coordinates || geometries)\n  );\n  const rawMap =\n    !areaLayerPresent && !symbolLayerPresent && !!(geometries || coordinates);\n\n  return areaLayerPresent || symbolLayerPresent || rawMap;\n};\n","import { useTheme } from \"@mui/material\";\nimport maplibregl from \"maplibre-gl\";\nimport { useEffect } from \"react\";\nimport { useMap } from \"react-map-gl\";\n\n/**\n * Could not use the CustomAttribute from maplibre gl, it was not updating properly\n */\nexport const CustomAttribution = ({ attribution }: { attribution: string }) => {\n  const mapRef = useMap();\n  const theme = useTheme();\n\n  useEffect(() => {\n    const map = mapRef.current as maplibregl.Map | undefined;\n\n    if (!map) {\n      return;\n    }\n\n    const control = new maplibregl.AttributionControl({\n      // className was not working (?), so style is used. To revisit later if needed.\n      customAttribution: attribution\n        ? `<span style=\"color: ${theme.palette.error.main}\">${attribution}</span>`\n        : undefined,\n    });\n\n    // As of now, we cannot \"update\" the control, we need to add it and remove it\n    map.addControl(control, \"bottom-right\");\n\n    return () => {\n      try {\n        map.removeControl(control);\n      } catch {\n        // Ignore the error, it is probably because the map was destroyed\n        // before the control was removed\n      }\n    };\n  }, [attribution, mapRef, theme]);\n\n  return null;\n};\n","import { ScatterplotLayer } from \"@deck.gl/layers\";\n\nexport class DashedScatterplotLayer extends ScatterplotLayer {\n  getShaders() {\n    const shaders = super.getShaders();\n\n    shaders.inject = {\n      \"fs:DECKGL_FILTER_COLOR\": `\n        float PI = 3.14159265359;\n        float angle = atan(geometry.uv.y, geometry.uv.x); \n        float dashPattern = mod(angle * 20.0, PI * 2.0);\n        bool isDashed = dashPattern < PI;\n\n        if (!isDashed) {\n          discard;\n        }\n      `,\n    };\n\n    return shaders;\n  }\n}\n","import mapValues from \"lodash/mapValues\";\nimport { AnySourceData, MapboxStyle } from \"react-map-gl/dist/esm/types\";\n\ntype AnyLayer = MapboxStyle[\"layers\"][number];\n\n// @TODO Find a way to make those guards generic\ntype HasUrl<T> = T extends { url?: string | undefined } ? T : never;\nfunction hasUrl(obj: AnySourceData): obj is HasUrl<AnySourceData> {\n  return Object.prototype.hasOwnProperty.call(obj, \"url\");\n}\n\ntype HasLayout<T> = T extends { layout?: infer T } ? T : never;\nexport function hasLayout(obj: AnyLayer): obj is HasLayout<AnySourceData> {\n  return Object.prototype.hasOwnProperty.call(obj, \"layout\");\n}\n\nconst replaceStringTokens = (\n  s: string | undefined,\n  tokens: Record<string, string>\n) => {\n  if (!s) {\n    return s;\n  }\n  let cur = s;\n  for (const [src, dest] of Object.entries(tokens)) {\n    cur = cur.replace(src, dest!);\n  }\n  return cur;\n};\n\nexport const replaceStyleTokens = (\n  style: MapboxStyle,\n  tokens: Record<string, string>\n) => {\n  return {\n    ...style,\n    sources: mapValues(style.sources, (v) => {\n      return {\n        ...v,\n        // @ts-ignore\n        url: hasUrl(v) ? replaceStringTokens(v.url, tokens) : undefined,\n      };\n    }),\n    glyphs: replaceStringTokens(style.glyphs, tokens),\n    sprite: replaceStringTokens(style.sprite, tokens),\n  };\n};\n\nexport const mapLayers = (\n  style: MapboxStyle,\n  layerIterator: (layer: AnyLayer) => AnyLayer | undefined\n) => {\n  return {\n    ...style,\n    layers: style.layers.map((x) => (x ? layerIterator(x) : undefined)),\n  };\n};\n","import merge from \"lodash/merge\";\nimport { useMemo } from \"react\";\nimport { MapboxStyle } from \"react-map-gl\";\n\nimport { BASE_VECTOR_TILE_URL, MAPTILER_STYLE_KEY } from \"@/domain/env\";\n\nimport { Locale } from \"../../locales/locales\";\n\nimport greyStyleBase from \"./grey.json\";\nimport { hasLayout, mapLayers, replaceStyleTokens } from \"./style-helpers\";\n\nconst tokens = {\n  \"{key}\": MAPTILER_STYLE_KEY,\n  \"<BASE_VECTOR_TILE>\": BASE_VECTOR_TILE_URL,\n};\n\nconst greyStyle = replaceStyleTokens(greyStyleBase as MapboxStyle, tokens);\n\nconst emptyStyle = {\n  version: 8,\n  name: \"Empty\",\n  metadata: {\n    \"mapbox:autocomposite\": true,\n  },\n  sources: {},\n  glyphs: \"mapbox://fonts/mapbox/{fontstack}/{range}.pbf\",\n  layers: [\n    {\n      id: \"background\",\n      type: \"background\",\n      paint: {\n        \"background-color\": \"rgba(0,0,0,0)\",\n      },\n    },\n  ],\n} satisfies MapboxStyle;\n\ntype AnyLayer = MapboxStyle[\"layers\"][number];\n\nconst getBaseLayerStyle = ({\n  locale,\n  showLabels,\n}: {\n  locale: Locale;\n  showLabels: boolean;\n}): MapboxStyle => {\n  const languageTag = `name:${locale === \"en\" ? \"latin\" : locale}`;\n  const textOpacity = showLabels ? 1 : 0;\n  const textLayersVisibility = showLabels ? \"visible\" : \"none\";\n\n  const greyStyleTextAdjusted = mapLayers(greyStyle, (layer) => {\n    if (!hasLayout(layer)) {\n      return;\n    }\n\n    // @ts-ignore\n    if (layer.layout[\"text-field\"]) {\n      return merge(layer, {\n        paint: {\n          \"text-opacity\": textOpacity,\n        },\n        layout: {\n          \"text-field\": `{${languageTag}}`,\n          visibility: textLayersVisibility,\n        },\n      }) satisfies AnyLayer;\n    } else {\n      return layer satisfies AnyLayer;\n    }\n  });\n\n  return greyStyleTextAdjusted as MapboxStyle;\n};\n\nexport const useMapStyle = ({\n  locale,\n  showBaseLayer,\n  showLabels,\n}: {\n  locale: Locale;\n  showBaseLayer: boolean;\n  showLabels: boolean;\n}): MapboxStyle => {\n  const style = useMemo(() => {\n    if (showBaseLayer) {\n      return getBaseLayerStyle({ locale, showLabels });\n    } else {\n      return emptyStyle;\n    }\n  }, [locale, showBaseLayer, showLabels]);\n\n  return style;\n};\n","import { Box, Typography } from \"@mui/material\";\nimport { hcl } from \"d3-color\";\nimport {\n  createContext,\n  Dispatch,\n  ReactNode,\n  useContext,\n  useMemo,\n  useState,\n} from \"react\";\n\nimport { MapState } from \"@/charts/map/map-state\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { rgbArrayToHex } from \"@/charts/shared/colors\";\nimport { TooltipBox } from \"@/charts/shared/interaction/tooltip-box\";\nimport { useChartFormatters } from \"@/charts/shared/use-chart-formatters\";\nimport { useInteraction } from \"@/charts/shared/use-interaction\";\nimport { truthy } from \"@/domain/types\";\nimport { formatNumberWithUnit, useFormatNumber } from \"@/formatters\";\n\nexport type HoverObjectType = \"area\" | \"symbol\";\n\nconst MapTooltipStateContext = createContext<\n  [HoverObjectType, Dispatch<HoverObjectType>] | undefined\n>(undefined);\n\nexport const useMapTooltip = () => {\n  const ctx = useContext(MapTooltipStateContext);\n\n  if (ctx === undefined) {\n    throw Error(\n      \"You need to wrap your component in <MapTooltipProvider /> to useMapTooltip()\"\n    );\n  }\n\n  return ctx;\n};\n\nexport const MapTooltipProvider = ({ children }: { children: ReactNode }) => {\n  const [state, dispatch] = useState<HoverObjectType>(\"area\");\n\n  return (\n    <MapTooltipStateContext.Provider value={[state, dispatch]}>\n      {children}\n    </MapTooltipStateContext.Provider>\n  );\n};\n\nconst isTooltipValueValid = (\n  v: string | number | null\n): v is number | string => {\n  return v !== null && (typeof v === \"number\" ? !isNaN(v) : true);\n};\n\nexport const MapTooltip = () => {\n  const [hoverObjectType] = useMapTooltip();\n  const [interaction] = useInteraction();\n  const { identicalLayerComponentIds, areaLayer, symbolLayer } =\n    useChartState() as MapState;\n  const formatNumber = useFormatNumber();\n\n  const { getFormattedError: formatSymbolError } = symbolLayer ?? {};\n  const formatters = useChartFormatters({\n    dimensions: [\n      areaLayer?.colors.type === \"continuous\"\n        ? null\n        : areaLayer?.colors.component,\n    ].filter(truthy),\n    measures: [\n      areaLayer?.colors.type === \"continuous\"\n        ? areaLayer?.colors.component\n        : null,\n      symbolLayer?.measureDimension,\n    ].filter(truthy),\n  });\n\n  const areaTooltipState = useMemo(() => {\n    if (areaLayer && interaction.observation) {\n      const { colors } = areaLayer;\n      const value = colors.getValue(interaction.observation);\n\n      if (isTooltipValueValid(value)) {\n        const show = identicalLayerComponentIds || hoverObjectType === \"area\";\n        const color = rgbArrayToHex(colors.getColor(interaction.observation));\n        const textColor = getTooltipTextColor(color);\n        const valueFormatter = (d: number | null) => {\n          return formatNumberWithUnit(\n            d,\n            formatters[colors.component.id] ?? formatNumber,\n            colors.component.unit\n          );\n        };\n\n        return {\n          show,\n          value: typeof value === \"number\" ? valueFormatter(value) : value,\n          error:\n            colors.type === \"continuous\"\n              ? colors.getFormattedError?.(interaction.observation)\n              : null,\n          componentId: colors.component.id,\n          label: colors.component.label,\n          color,\n          textColor,\n        };\n      }\n    }\n  }, [\n    interaction.observation,\n    areaLayer,\n    identicalLayerComponentIds,\n    hoverObjectType,\n    formatters,\n    formatNumber,\n  ]);\n\n  const symbolTooltipState = useMemo(() => {\n    const { observation } = interaction;\n\n    if (symbolLayer && observation) {\n      const { colors } = symbolLayer;\n      const value = symbolLayer.getValue(observation);\n\n      if (isTooltipValueValid(value)) {\n        const show = identicalLayerComponentIds || hoverObjectType === \"symbol\";\n        const color = rgbArrayToHex(colors.getColor(observation));\n        const textColor = getTooltipTextColor(color);\n        const valueFormatter = (d: number | null) => {\n          return formatNumberWithUnit(\n            d,\n            symbolLayer.measureDimension?.id\n              ? (formatters[symbolLayer.measureDimension.id] ?? formatNumber)\n              : formatNumber,\n            symbolLayer.measureDimension?.unit\n          );\n        };\n\n        let preparedColors;\n\n        if (colors.type === \"fixed\") {\n          preparedColors = {\n            type: \"fixed\" as const,\n            color,\n            textColor,\n            sameAsValue: false,\n            error: null,\n          };\n        } else if (colors.type === \"categorical\") {\n          preparedColors = {\n            type: \"categorical\" as const,\n            component: colors.component,\n            value: colors.getValue(observation),\n            error: null,\n            color,\n            textColor,\n            sameAsValue: false,\n          };\n        } else {\n          const rawValue = observation[colors.component.id] as number;\n          const formattedError = colors.getFormattedError?.(observation);\n          preparedColors = {\n            type: \"continuous\",\n            component: colors.component,\n            value: formatNumberWithUnit(\n              rawValue,\n              formatNumber,\n              colors.component.unit\n            ),\n            error: formattedError,\n            color,\n            textColor,\n            sameAsValue:\n              colors.component.id === symbolLayer.measureDimension?.id,\n          };\n        }\n\n        return {\n          value: valueFormatter(value),\n          error: formatSymbolError?.(observation),\n          measureDimension: symbolLayer.measureDimension,\n          show,\n          color,\n          textColor,\n          colors: preparedColors,\n        };\n      }\n    }\n  }, [\n    interaction,\n    symbolLayer,\n    identicalLayerComponentIds,\n    hoverObjectType,\n    formatSymbolError,\n    formatters,\n    formatNumber,\n  ]);\n\n  const showAreaColorTooltip = areaTooltipState?.show;\n  const showSymbolMeasureTooltip =\n    symbolTooltipState?.show &&\n    (showAreaColorTooltip\n      ? areaTooltipState!.componentId !==\n        symbolTooltipState.measureDimension?.id\n      : true);\n  const showSymbolColorTooltip =\n    symbolTooltipState &&\n    symbolTooltipState.colors.type !== \"fixed\" &&\n    (showSymbolMeasureTooltip\n      ? symbolTooltipState.measureDimension?.id !==\n        symbolTooltipState.colors.component?.id\n      : showAreaColorTooltip &&\n        areaTooltipState!.componentId !==\n          symbolTooltipState.colors.component?.id);\n\n  return (\n    <>\n      {interaction.type === \"tooltip\" &&\n        interaction.mouse &&\n        interaction.observation && (\n          <TooltipBox\n            x={interaction.mouse.x}\n            y={interaction.mouse.y - 20}\n            placement={{ x: \"center\", y: \"top\" }}\n            margins={{ bottom: 0, left: 0, right: 0, top: 0 }}\n          >\n            <Box sx={{ minWidth: 200 }}>\n              <Typography\n                component=\"div\"\n                variant=\"caption\"\n                sx={{ fontWeight: \"bold\" }}\n              >\n                {hoverObjectType === \"area\"\n                  ? areaLayer?.getLabel(interaction.observation)\n                  : symbolLayer?.getLabel(interaction.observation)}\n              </Typography>\n              <Box\n                display=\"grid\"\n                sx={{\n                  mt: 1,\n                  width: \"100%\",\n                  gridTemplateColumns: \"1fr auto\",\n                  gap: 1,\n                  alignItems: \"center\",\n                }}\n              >\n                {\n                  <>\n                    {areaTooltipState && showAreaColorTooltip && (\n                      <TooltipRow\n                        title={areaTooltipState.label}\n                        background={areaTooltipState.color}\n                        color={areaTooltipState.textColor}\n                        value={areaTooltipState.value}\n                        error={areaTooltipState.error}\n                      />\n                    )}\n\n                    {symbolTooltipState && showSymbolMeasureTooltip && (\n                      <TooltipRow\n                        title={symbolTooltipState.measureDimension?.label || \"\"}\n                        {...(symbolTooltipState.colors.type === \"fixed\"\n                          ? {\n                              background: symbolTooltipState.color,\n                              border: undefined,\n                              color: symbolTooltipState.textColor,\n                            }\n                          : {\n                              background: \"#fff\",\n                              border: \"1px solid #ccc\",\n                              color: \"#000\",\n                            })}\n                        value={symbolTooltipState.value}\n                        error={symbolTooltipState.error}\n                      />\n                    )}\n\n                    {symbolTooltipState && showSymbolColorTooltip && (\n                      <TooltipRow\n                        title={symbolTooltipState.colors.component?.label || \"\"}\n                        background={symbolTooltipState.color}\n                        color={symbolTooltipState.textColor}\n                        value={symbolTooltipState.colors.value ?? \"\"}\n                        error={symbolTooltipState.colors.error}\n                      />\n                    )}\n                  </>\n                }\n              </Box>\n            </Box>\n          </TooltipBox>\n        )}\n    </>\n  );\n};\n\nconst TooltipRow = ({\n  title,\n  background,\n  color,\n  value,\n  error,\n  border = \"none\",\n}: {\n  title: string;\n  background: string;\n  color: string;\n  value: string;\n  error?: string | null;\n  border?: string;\n}) => {\n  return (\n    <>\n      <Typography component=\"div\" variant=\"caption\">\n        {title}\n      </Typography>\n      <Box\n        style={{\n          display: \"inline-block\",\n          border,\n          borderRadius: 9999,\n          background,\n          color,\n          textAlign: \"center\",\n        }}\n        sx={{ px: 2 }}\n      >\n        <Typography component=\"div\" variant=\"caption\">\n          {value}\n          {error}\n        </Typography>\n      </Box>\n    </>\n  );\n};\n\nconst getTooltipTextColor = (color: string) => {\n  return hcl(color).l < 55 ? \"#fff\" : \"#000\";\n};\n","import {\n  GeoJsonLayer,\n  ScatterplotLayer,\n  ScatterplotLayerProps,\n} from \"@deck.gl/layers\";\nimport { supported } from \"@mapbox/mapbox-gl-supported\";\nimport { Button, Theme } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { hexToRgba } from \"@uiw/react-color\";\nimport { geoArea } from \"d3-geo\";\nimport debounce from \"lodash/debounce\";\nimport orderBy from \"lodash/orderBy\";\nimport uniq from \"lodash/uniq\";\nimport maplibreglRaw from \"maplibre-gl\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport Map, { LngLatLike, MapboxEvent } from \"react-map-gl\";\n\nimport {\n  DEFAULT_COLOR,\n  FLY_TO_DURATION,\n  RESET_DURATION,\n} from \"@/charts/map/constants\";\nimport { CustomAttribution } from \"@/charts/map/custom-attribution\";\nimport { DashedScatterplotLayer } from \"@/charts/map/dashed-scatterplot-layer\";\nimport { useMapStyle } from \"@/charts/map/get-base-layer-style\";\nimport {\n  BASE_VIEW_STATE,\n  DeckGLOverlay,\n  useViewState,\n} from \"@/charts/map/helpers\";\nimport { MapState } from \"@/charts/map/map-state\";\nimport { HoverObjectType, useMapTooltip } from \"@/charts/map/map-tooltip\";\nimport { getMap, setMap } from \"@/charts/map/ref\";\nimport {\n  DEFAULT_WMS_URL,\n  getWMSTile,\n  RemoteWMSLayer,\n} from \"@/charts/map/wms-utils\";\nimport {\n  getLayerKey,\n  useWMTSorWMSLayers,\n} from \"@/charts/map/wms-wmts-endpoint-utils\";\nimport {\n  DEFAULT_WMTS_URL,\n  getWMTSTile,\n  RemoteWMTSLayer,\n} from \"@/charts/map/wmts-utils\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { useInteraction } from \"@/charts/shared/use-interaction\";\nimport { useLimits } from \"@/config-utils\";\nimport {\n  BaseLayer,\n  BBox,\n  getWMSCustomLayers,\n  getWMTSCustomLayers,\n  WMSCustomLayer,\n  WMTSCustomLayer,\n} from \"@/configurator\";\nimport { GeoFeature, GeoPoint } from \"@/domain/data\";\nimport { Icon, IconName } from \"@/icons\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nimport \"maplibre-gl/dist/maplibre-gl.css\";\n\n// supported was removed as of maplibre-gl v3.0.0, so we need to add it back\nconst maplibregl = { ...maplibreglRaw, supported };\n\nconst useStyles = makeStyles<Theme>((theme) => ({\n  controlButtons: {\n    zIndex: 13,\n    position: \"absolute\",\n    bottom: 32,\n    right: 16,\n    display: \"flex\",\n    flexDirection: \"column\",\n  },\n  controlButton: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    minWidth: 0,\n    minHeight: 0,\n    width: 32,\n    height: 32,\n    border: \"1px solid\",\n    borderColor: theme.palette.divider,\n    borderBottom: 0,\n    borderRadius: 0,\n    color: theme.palette.grey[700],\n    backgroundColor: theme.palette.grey[100],\n    padding: 0,\n    \"&:hover\": {\n      backgroundColor: theme.palette.grey[200],\n    },\n    \"&:first-of-type\": {\n      borderTopRightRadius: 3,\n      borderTopLeftRadius: 3,\n    },\n    \"&:last-of-type\": {\n      borderBottom: \"1px solid\",\n      borderBottomColor: theme.palette.divider,\n      borderBottomRightRadius: 3,\n      borderBottomLeftRadius: 3,\n    },\n  },\n}));\n\n// Debounced function fixes the problem of maximizing window or opening a console,\n// when map was not resized initially.\nconst resizeAndFit = debounce((map: mapboxgl.Map, bbox: BBox) => {\n  map.resize();\n  map.fitBounds(bbox, { duration: 0 });\n}, 0);\n\nexport const MapComponent = ({\n  limits,\n  customLayers,\n  value,\n}: {\n  limits: ReturnType<typeof useLimits>;\n  customLayers: BaseLayer[\"customLayers\"];\n  value?: string | number;\n}) => {\n  const classes = useStyles();\n  const locale = useLocale();\n\n  const { wmsEndpoints, wmtsEndpoints } = useMemo(() => {\n    const wmsCustomLayers = getWMSCustomLayers(customLayers);\n    const wmtsCustomLayers = getWMTSCustomLayers(customLayers);\n\n    return {\n      wmsEndpoints: uniq(\n        wmsCustomLayers.map((x) => x.endpoint ?? DEFAULT_WMS_URL)\n      ),\n      wmtsEndpoints: uniq(\n        wmtsCustomLayers.map((x) => x.endpoint ?? DEFAULT_WMTS_URL)\n      ),\n    };\n  }, [customLayers]);\n\n  const { data: groupedLayers } = useWMTSorWMSLayers([\n    ...wmsEndpoints,\n    ...wmtsEndpoints,\n  ]);\n  const { byKey: layersByKey } = groupedLayers ?? {\n    wms: [],\n    wmts: [],\n  };\n\n  const attribution = useMemo(() => {\n    const attributions = customLayers.map(\n      (layer) => layersByKey?.[getLayerKey(layer)]?.attribution\n    );\n    return Array.from(new Set(attributions)).join(\", \");\n  }, [customLayers, layersByKey]);\n\n  const { behindAreaCustomLayers, afterAreaCustomLayers } = useMemo(() => {\n    const getDeckGLLayerBefore = (\n      customLayer: WMTSCustomLayer | WMSCustomLayer,\n      beforeId?: string | undefined\n    ) => {\n      const layer = layersByKey?.[getLayerKey(customLayer)];\n      switch (customLayer.type) {\n        case \"wms\":\n          return getWMSTile({\n            wmsLayer: layer as RemoteWMSLayer | undefined,\n            customLayer,\n            beforeId,\n          });\n        case \"wmts\":\n          return getWMTSTile({\n            wmtsLayer: layer as RemoteWMTSLayer | undefined,\n            customLayer,\n            beforeId,\n            value,\n          });\n        default:\n          const _exhaustiveCheck: never = customLayer;\n          return _exhaustiveCheck;\n      }\n    };\n    return {\n      behindAreaCustomLayers: customLayers\n        .filter((customLayer) => customLayer.isBehindAreaLayer)\n        .map((l) => getDeckGLLayerBefore(l, \"areaLayer\")),\n      afterAreaCustomLayers: customLayers\n        .filter((customLayer) => !customLayer.isBehindAreaLayer)\n        .map((l) => getDeckGLLayerBefore(l)),\n    };\n  }, [customLayers, layersByKey, value]);\n\n  const [interaction, dispatchInteraction] = useInteraction();\n  const [, setMapTooltipType] = useMapTooltip();\n\n  const {\n    showBaseLayer,\n    locked,\n    features,\n    identicalLayerComponentIds,\n    areaLayer,\n    symbolLayer,\n    bounds: { width, height },\n    lockedBBox,\n    featuresBBox,\n  } = useChartState() as MapState;\n\n  const { defaultViewState, viewState, onViewStateChange } = useViewState({\n    width,\n    height,\n    lockedBBox,\n    featuresBBox,\n  });\n\n  const lockedRef = useRef(locked);\n  useEffect(() => {\n    lockedRef.current = locked;\n  }, [locked]);\n\n  // Resets the map to its default state (showing all visible features).\n  const reset = useEvent(() => {\n    // Reset the map only when it's in an unlocked mode.\n    if (!lockedRef.current) {\n      const { longitude, latitude, zoom } = defaultViewState;\n      const newViewState = {\n        center: [longitude, latitude] as LngLatLike,\n        zoom,\n        duration: RESET_DURATION,\n        essential: true,\n      };\n      getMap()?.flyTo(newViewState);\n    }\n  });\n\n  // Reset the view when default view changes (new features appeared on the map).\n  useEffect(() => {\n    reset();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultViewState]);\n\n  const zoomIn = useEvent(() => {\n    const newViewState = {\n      center: [viewState.longitude, viewState.latitude] as LngLatLike,\n      zoom: Math.min(viewState.zoom + 1, BASE_VIEW_STATE.maxZoom),\n      duration: FLY_TO_DURATION,\n      essential: true,\n    };\n    getMap()?.flyTo(newViewState);\n  });\n\n  const zoomOut = useEvent(() => {\n    const newViewState = {\n      center: [viewState.longitude, viewState.latitude] as LngLatLike,\n      zoom: Math.max(viewState.zoom - 1, BASE_VIEW_STATE.minZoom),\n      duration: FLY_TO_DURATION,\n      essential: true,\n    };\n    getMap()?.flyTo(newViewState);\n  });\n\n  const mapStyle = useMapStyle({\n    locale,\n    showBaseLayer,\n    showLabels: !areaLayer,\n  });\n\n  const onHover = useEvent(\n    ({\n      type,\n      x,\n      y,\n      object,\n    }: {\n      type: HoverObjectType;\n      x: number;\n      y: number;\n      object?: GeoFeature | GeoPoint;\n    }) => {\n      if (object) {\n        const { observation } = object.properties;\n\n        setMapTooltipType(type);\n        dispatchInteraction({\n          type: \"INTERACTION_UPDATE\",\n          value: {\n            type: \"tooltip\",\n            visible: true,\n            observation,\n            mouse: { x, y },\n          },\n        });\n      } else {\n        dispatchInteraction({\n          type: \"INTERACTION_HIDE\",\n        });\n      }\n    }\n  );\n\n  const sortedShapes = useMemo(() => {\n    // Sort for smaller shapes to be over larger ones, to be able to use tooltip\n    const sortedFeatures = orderBy(\n      features.areaLayer?.shapes?.features,\n      geoArea,\n      \"desc\"\n    ) satisfies GeoFeature[];\n\n    return {\n      ...features.areaLayer?.shapes,\n      features: sortedFeatures,\n    };\n  }, [features.areaLayer?.shapes]);\n\n  const geoJsonLayer = useMemo(() => {\n    if (!areaLayer?.colors) {\n      return;\n    }\n\n    const getFillColor = (d: GeoFeature) => {\n      const { observation } = d.properties;\n\n      if (observation) {\n        const value = areaLayer.colors.getValue(observation);\n\n        if (value !== null) {\n          return areaLayer.colors.getColor(observation);\n        }\n      }\n\n      return DEFAULT_COLOR;\n    };\n\n    return new GeoJsonLayer({\n      id: \"areaLayer\",\n      beforeId: showBaseLayer ? \"water_polygon\" : undefined,\n      // @ts-ignore this is correct\n      data: sortedShapes,\n      pickable: true,\n      parameters: {\n        /**\n         * Fixes hover on overlapping layers\n         * @see https://deck.gl/docs/developer-guide/tips-and-tricks#z-fighting-and-depth-testing\n         */\n        depthTest: false,\n      },\n      extruded: false,\n      filled: true,\n      stroked: true,\n      lineWidthMinPixels: 0.8,\n      getLineColor: [255, 255, 255],\n      // @ts-ignore\n      getFillColor,\n      onHover: ({\n        x,\n        y,\n        object,\n      }: {\n        x: number;\n        y: number;\n        object?: GeoFeature;\n      }) => onHover({ type: \"area\", x, y, object }),\n      updateTriggers: {\n        getFillColor,\n      },\n    });\n  }, [areaLayer?.colors, sortedShapes, onHover, showBaseLayer]);\n\n  const hoverLayer = useMemo(() => {\n    if (!interaction.visible || !sortedShapes || !areaLayer) {\n      return;\n    }\n\n    const shape = sortedShapes.features.find(\n      (d) => d.properties.observation === interaction.observation\n    );\n\n    if (shape) {\n      const getFillColor = (d: GeoFeature) => {\n        const { observation } = d.properties;\n\n        if (observation) {\n          const value = areaLayer.colors.getValue(observation);\n\n          if (value !== null) {\n            return areaLayer.colors.getColor(observation);\n          }\n        }\n\n        return DEFAULT_COLOR;\n      };\n\n      return new GeoJsonLayer({\n        id: \"hoverLayer\",\n        beforeId: afterAreaCustomLayers.length\n          ? afterAreaCustomLayers[0]?.props.id\n          : undefined,\n        // @ts-ignore\n        data: shape,\n        filled: true,\n        stroked: true,\n        lineWidthMinPixels: 2,\n        // @ts-ignore\n        getFillColor,\n      });\n    }\n  }, [\n    afterAreaCustomLayers,\n    areaLayer,\n    interaction.observation,\n    interaction.visible,\n    sortedShapes,\n  ]);\n\n  const scatterplotLayers = useMemo(() => {\n    if (!symbolLayer) {\n      return [];\n    }\n\n    const getFillColor = ({ properties: { observation } }: GeoPoint) => {\n      if (observation) {\n        return symbolLayer.colors.getColor(observation);\n      }\n\n      return DEFAULT_COLOR;\n    };\n\n    const getPosition = ({ coordinates }: GeoPoint) => {\n      return coordinates;\n    };\n\n    const getRadius = ({ properties: { observation } }: GeoPoint) => {\n      const value = observation ? symbolLayer.getValue(observation) : null;\n      // @ts-ignore - value can be undefined, D3 types are wrong here\n      const radius = symbolLayer.radiusScale(value) ?? 0;\n\n      return radius;\n    };\n    const [radiusMinPixels, radiusMaxPixels] = symbolLayer.radiusScale.range();\n\n    const data = features.symbolLayer?.points;\n    const sortedData = data ? orderBy(data, getRadius, \"desc\") : [];\n\n    return [\n      new ScatterplotLayer({\n        id: \"symbolLayer\",\n        pickable: identicalLayerComponentIds ? !areaLayer : true,\n        autoHighlight: true,\n        filled: true,\n        stroked: true,\n        lineWidthMinPixels: 0.8,\n        data: sortedData,\n        getPosition,\n        getRadius,\n        radiusUnits: \"pixels\",\n        radiusMinPixels,\n        radiusMaxPixels,\n        // @ts-ignore\n        getFillColor,\n        onHover: ({\n          x,\n          y,\n          object,\n        }: {\n          x: number;\n          y: number;\n          object?: GeoFeature;\n        }) => onHover({ type: \"symbol\", x, y, object }),\n        updateTriggers: {\n          getFillColor,\n          getPosition,\n          getRadius,\n          onHover,\n        },\n      }),\n      ...limits.limits.map((limit, i) => {\n        const { configLimit, measureLimit } = limit;\n        const rgba = hexToRgba(configLimit.color);\n        const baseLayerProps: Partial<ScatterplotLayerProps<GeoPoint>> = {\n          filled: false,\n          stroked: true,\n          getLineColor: [rgba.r, rgba.g, rgba.b, 255],\n          lineWidthMinPixels: 0.8,\n          data: sortedData,\n          getPosition,\n          radiusUnits: \"pixels\",\n        };\n        const mkGetLimitRadius =\n          (value: number) =>\n          ({ properties: { observation } }: GeoPoint) => {\n            return observation ? symbolLayer.radiusScale(value) : 0;\n          };\n\n        switch (measureLimit.type) {\n          case \"single\":\n            return [\n              new DashedScatterplotLayer({\n                id: `symbolLayerLimit-${i}`,\n                getRadius: mkGetLimitRadius(measureLimit.value),\n                ...baseLayerProps,\n              }),\n            ];\n          case \"value-range\":\n            return [\n              new DashedScatterplotLayer({\n                id: `symbolLayerLimit-${i}-from`,\n                getRadius: mkGetLimitRadius(measureLimit.min),\n                ...baseLayerProps,\n              }),\n              new DashedScatterplotLayer({\n                id: `symbolLayerLimit-${i}-to`,\n                getRadius: mkGetLimitRadius(measureLimit.max),\n                ...baseLayerProps,\n              }),\n            ];\n          case \"time-range\":\n            return [\n              new DashedScatterplotLayer({\n                id: `symbolLayerLimit-${i}`,\n                getRadius: mkGetLimitRadius(measureLimit.value),\n                ...baseLayerProps,\n              }),\n            ];\n          default:\n            const _exhaustiveCheck: never = measureLimit;\n            return _exhaustiveCheck;\n        }\n      }),\n    ];\n  }, [\n    limits,\n    areaLayer,\n    features.symbolLayer,\n    identicalLayerComponentIds,\n    onHover,\n    symbolLayer,\n  ]);\n\n  const dataLoaded =\n    features.areaLayer ??\n    features.symbolLayer ??\n    // Raw map without data layers.\n    (areaLayer === undefined && symbolLayer === undefined);\n\n  const redrawMap = useEvent(() => {\n    const map = getMap();\n\n    if (!map) {\n      return;\n    }\n\n    const bbox = lockedBBox ?? (map.getBounds().toArray() as BBox);\n    resizeAndFit(map, bbox);\n  });\n\n  const handleResize = useEvent((e: MapboxEvent) => {\n    if (e.originalEvent) {\n      redrawMap();\n    }\n  });\n\n  const [loaded, setLoaded] = useState(false);\n\n  return (\n    <>\n      {locked ? null : (\n        <div className={classes.controlButtons} {...DISABLE_SCREENSHOT_ATTR}>\n          <ControlButton iconName=\"refresh\" onClick={reset} />\n          <ControlButton iconName=\"plus\" onClick={zoomIn} />\n          <ControlButton iconName=\"minus\" onClick={zoomOut} />\n        </div>\n      )}\n\n      {dataLoaded && width > 1 && height > 1 ? (\n        <Map\n          initialViewState={defaultViewState}\n          mapLib={maplibregl}\n          mapStyle={mapStyle}\n          // Important so we can take a screenshot of the map\n          preserveDrawingBuffer\n          style={{\n            position: \"absolute\",\n            left: 0,\n            top: 0,\n            width: \"100%\",\n            height: \"100%\",\n          }}\n          dragPan={!locked}\n          scrollZoom={!locked}\n          doubleClickZoom={!locked}\n          dragRotate={false}\n          touchZoomRotate={!locked}\n          onData={(e) => {\n            if (e.dataType === \"source\" && !e.isSourceLoaded) {\n              setLoaded(false);\n            }\n          }}\n          onIdle={() => {\n            setLoaded(true);\n          }}\n          onRemove={() => {\n            setLoaded(false);\n            setMap(null);\n          }}\n          onLoad={(e) => {\n            setMap(e.target as mapboxgl.Map);\n            /**\n             * Redraw the map on load, when style data has been downloaded\n             * to solve an offset problem between the viz layer and the base layer\n             * happening in Edge under precise conditions (Windows 10, Edge 105,\n             * resolution 1440x900).\n             */\n            redrawMap();\n          }}\n          onMove={onViewStateChange}\n          onResize={handleResize}\n          attributionControl={false}\n          {...viewState}\n        >\n          <div data-map-loaded={loaded} />\n          <DeckGLOverlay\n            interleaved\n            layers={[\n              ...behindAreaCustomLayers,\n              geoJsonLayer,\n              hoverLayer,\n              ...afterAreaCustomLayers,\n              ...scatterplotLayers,\n            ]}\n          />\n          <CustomAttribution attribution={attribution} />\n        </Map>\n      ) : null}\n    </>\n  );\n};\n\nconst ControlButton = ({\n  iconName,\n  onClick,\n}: {\n  iconName: IconName;\n  onClick: () => void;\n}) => {\n  const classes = useStyles();\n\n  return (\n    <Button\n      className={classes.controlButton}\n      variant=\"contained\"\n      onClick={onClick}\n    >\n      <Icon name={iconName} size={24} />\n    </Button>\n  );\n};\n","import { Box, Typography, useTheme } from \"@mui/material\";\nimport uniq from \"lodash/uniq\";\nimport NextImage from \"next/image\";\n\nimport { DEFAULT_WMS_URL, RemoteWMSLayer } from \"@/charts/map/wms-utils\";\nimport {\n  getLayerKey,\n  useWMTSorWMSLayers,\n} from \"@/charts/map/wms-wmts-endpoint-utils\";\nimport {\n  DEFAULT_WMTS_URL,\n  getWMTSLayerValue,\n  RemoteWMTSLayer,\n} from \"@/charts/map/wmts-utils\";\nimport { Error, InlineLoading } from \"@/components/hint\";\nimport { InfoIconTooltip } from \"@/components/info-icon-tooltip\";\nimport { BaseLayer, MapConfig } from \"@/config-types\";\nimport { truthy } from \"@/domain/types\";\nimport { useLocale } from \"@/locales/use-locale\";\nimport { useFetchData } from \"@/utils/use-fetch-data\";\n\n/** Constrain size, keeping aspect ratio */\nconst constrainSize = ({\n  width,\n  height,\n  maxWidth,\n  maxHeight,\n}: {\n  width: number;\n  height: number;\n  maxWidth: number;\n  maxHeight: number;\n}) => {\n  const aspectRatio = width / height;\n  if (width > maxWidth) {\n    width = maxWidth;\n    height = Math.round(maxWidth / aspectRatio);\n  }\n  if (height > maxHeight) {\n    height = maxHeight;\n    width = Math.round(maxHeight * aspectRatio);\n  }\n  return { width, height };\n};\n\nexport const MapCustomLayersLegend = ({\n  chartConfig,\n  value,\n}: {\n  chartConfig: MapConfig;\n  value?: string | number;\n}) => {\n  const customLayers = chartConfig.baseLayer.customLayers;\n  const { data: legendsData, error } = useLegendsData({ customLayers });\n  const theme = useTheme();\n  return error ? (\n    <Error>{error.message}</Error>\n  ) : !legendsData ? (\n    <InlineLoading />\n  ) : (\n    <>\n      {legendsData.map(\n        ({ remoteLayer: layer, configLayer, dataUrl, width, height }) => {\n          if (!configLayer) {\n            return null;\n          }\n\n          const layerValue =\n            configLayer.type === \"wmts\" && layer\n              ? getWMTSLayerValue({\n                  availableDimensionValues:\n                    layer.availableDimensionValues ?? [],\n                  defaultDimensionValue: layer.defaultDimensionValue ?? \"\",\n                  customLayer: configLayer,\n                  value,\n                })\n              : undefined;\n\n          const { width: swidth, height: sheight } = constrainSize({\n            width,\n            height,\n            maxWidth: 400,\n            maxHeight: 400,\n          });\n\n          return (\n            <Box\n              key={dataUrl}\n              sx={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                gap: 1,\n              }}\n            >\n              <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\n                <Typography component=\"p\" variant=\"caption\">\n                  {layer.title} {layerValue ? `(${layerValue})` : \"\"}\n                </Typography>\n                {layer.description ? (\n                  <InfoIconTooltip\n                    title={\n                      <Box\n                        sx={{\n                          \"& > *\": {\n                            // We do not let the tooltip HTML override the font size\n                            fontSize: `${theme.typography.caption.fontSize} !important`,\n                          },\n                        }}\n                        dangerouslySetInnerHTML={{ __html: layer.description }}\n                      />\n                    }\n                    sx={{ width: \"fit-content\" }}\n                  />\n                ) : null}\n              </Box>\n              <NextImage\n                src={dataUrl}\n                alt={layer.title}\n                width={swidth}\n                height={sheight}\n              />\n            </Box>\n          );\n        }\n      )}\n    </>\n  );\n};\n\nconst cachedLegendImages: Record<\n  string,\n  Promise<{ dataUrl: string; width: number; height: number } | undefined>\n> = {};\n\nconst fetchLegendImage = async (\n  remoteLayer: RemoteWMSLayer | RemoteWMTSLayer\n) => {\n  if (!remoteLayer?.legendUrl) {\n    return undefined;\n  }\n\n  const blob = await fetch(remoteLayer.legendUrl).then((res) => res.blob());\n  const bmp = await createImageBitmap(blob);\n  const { width, height } = bmp;\n  bmp.close();\n\n  return {\n    dataUrl: URL.createObjectURL(blob),\n    width,\n    height,\n  };\n};\n\nconst fetchLegendImageFromCache = async (\n  remoteLayer: RemoteWMSLayer | RemoteWMTSLayer\n) => {\n  if (!remoteLayer?.legendUrl) {\n    return undefined;\n  }\n  const cached = cachedLegendImages[remoteLayer.legendUrl];\n  if (cached) {\n    return cached;\n  }\n  const legendImage = fetchLegendImage(remoteLayer);\n  cachedLegendImages[remoteLayer.legendUrl] = legendImage;\n  return legendImage;\n};\n\nconst useLegendsData = ({\n  customLayers: configLayers,\n}: {\n  customLayers: BaseLayer[\"customLayers\"];\n}) => {\n  const locale = useLocale();\n  const wmsLayerConfigs = configLayers.filter((layer) => layer.type === \"wms\");\n  const wmtsLayerConfigs = configLayers.filter(\n    (layer) => layer.type === \"wmts\"\n  );\n\n  const wmtsEndpoints = uniq(\n    wmtsLayerConfigs.map((x) => x.endpoint ?? DEFAULT_WMTS_URL)\n  );\n  const wmsEndpoints = uniq(\n    wmsLayerConfigs.map((x) => x.endpoint ?? DEFAULT_WMS_URL)\n  );\n  const { data: groupedLayers, error: customLayersError } = useWMTSorWMSLayers([\n    ...wmtsEndpoints,\n    ...wmsEndpoints,\n  ]);\n  const {\n    wms: wmsLayers,\n    wmts: wmtsLayers,\n    byKey: layersByKey,\n  } = groupedLayers ?? {\n    wms: [],\n    wmts: [],\n    byKey: {},\n  };\n  const { data: legendsData, error: legendsError } = useFetchData({\n    queryKey: [\n      \"custom-layers-legends\",\n      configLayers.map((d) => d.id),\n      wmsLayers?.map((d) => d.id),\n      wmtsLayers?.map((d) => d.id),\n      locale,\n      1,\n    ],\n    queryFn: async () => {\n      return (\n        await Promise.all(\n          configLayers.map(async (configLayer) => {\n            let remoteLayer: RemoteWMSLayer | RemoteWMTSLayer | undefined =\n              layersByKey[getLayerKey(configLayer)];\n            const legendImage = await fetchLegendImageFromCache(remoteLayer);\n            if (!legendImage) {\n              return undefined;\n            }\n            const { width, height, dataUrl } = legendImage;\n            return {\n              remoteLayer,\n              configLayer,\n              dataUrl,\n              width,\n              height,\n            };\n          })\n        )\n      ).filter(truthy);\n    },\n    options: {\n      pause: !wmsLayers || !wmtsLayers,\n    },\n  });\n\n  return {\n    data: legendsData,\n    error: customLayersError ?? legendsError,\n  };\n};\n","import { Box, Theme, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { range } from \"d3-array\";\nimport { axisBottom } from \"d3-axis\";\nimport {\n  NumberValue,\n  ScaleLinear,\n  scaleLinear,\n  ScaleQuantile,\n  ScaleQuantize,\n  ScaleThreshold,\n} from \"d3-scale\";\nimport { select, Selection } from \"d3-selection\";\nimport { useEffect, useMemo, useRef } from \"react\";\n\nimport { MapState } from \"@/charts/map/map-state\";\nimport { useChartState } from \"@/charts/shared/chart-state\";\nimport { rgbArrayToHex } from \"@/charts/shared/colors\";\nimport { MapLegendColor } from \"@/charts/shared/legend-color\";\nimport { useChartTheme } from \"@/charts/shared/use-chart-theme\";\nimport { useInteraction } from \"@/charts/shared/use-interaction\";\nimport { useSize } from \"@/charts/shared/use-size\";\nimport { Flex } from \"@/components/flex\";\nimport { useLimits } from \"@/config-utils\";\nimport { MapConfig, PaletteType } from \"@/configurator\";\nimport { ColorRamp } from \"@/configurator/components/chart-controls/color-ramp\";\nimport { Observation } from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport {\n  useDimensionFormatters,\n  useFormatInteger,\n  useFormatNumber,\n} from \"@/formatters\";\nimport { getColorInterpolator } from \"@/palettes\";\nimport { getTextWidth } from \"@/utils/get-text-width\";\n\nconst MAX_WIDTH = 204;\nconst HEIGHT = 40;\nconst COLOR_RAMP_HEIGHT = 10;\nconst MARGIN = { top: 6, right: 4, bottom: 6, left: 4 };\nconst AXIS_TICK_ROTATE_ANGLE = 45;\nconst AXIS_LABEL_FONT_SIZE = 10;\n\nconst useLegendWidth = () => Math.min(useSize().width, MAX_WIDTH);\n\nconst makeAxis = (\n  g: Selection<SVGGElement, unknown, null, undefined>,\n  {\n    axisLabelFontSize,\n    fontFamily,\n    formatNumber,\n    labelColor,\n    scale,\n    thresholds,\n  }: {\n    axisLabelFontSize: number;\n    fontFamily: string;\n    formatNumber: (x: NumberValue | undefined | null) => string;\n    labelColor: string;\n    scale: ScaleLinear<number, number, number>;\n    thresholds: number[];\n  }\n) => {\n  g.call(\n    axisBottom(scale)\n      .tickValues(thresholds)\n      .tickSizeInner(-COLOR_RAMP_HEIGHT)\n      .tickFormat(formatNumber)\n  );\n  g.select(\"path.domain\").remove();\n  g.selectAll(\".tick line\").attr(\"stroke\", labelColor);\n  g.selectAll(\".tick text\")\n    .attr(\"font-size\", axisLabelFontSize)\n    .attr(\"font-family\", fontFamily)\n    .attr(\"fill\", labelColor)\n    .attr(\"transform\", `rotate(${AXIS_TICK_ROTATE_ANGLE})`)\n    .attr(\"text-anchor\", \"start\");\n};\n\nexport const MapLegend = ({\n  chartConfig,\n  observations,\n  limits,\n}: {\n  chartConfig: MapConfig;\n  observations: Observation[];\n  limits: ReturnType<typeof useLimits>[\"limits\"];\n}) => {\n  const { areaLayer, symbolLayer } = useChartState() as MapState;\n  const showAreaLegend =\n    areaLayer &&\n    areaLayer.data.length > 1 &&\n    areaLayer.colors.type === \"continuous\" &&\n    (areaLayer.colors.interpolationType === \"linear\" ||\n      areaLayer.colors.scale.range().length > 1);\n  const measureDimensions = [\n    areaLayer?.colors.component,\n    symbolLayer?.measureDimension,\n    symbolLayer?.colors.type === \"continuous\"\n      ? symbolLayer.colors.component\n      : undefined,\n  ].filter(truthy);\n  const formatters = useDimensionFormatters(measureDimensions);\n  const areaColorUnit = areaLayer?.colors.component.unit;\n  const symbolUnit = symbolLayer?.measureDimension?.unit;\n  const symbolColorUnit =\n    symbolLayer?.colors.type === \"continuous\"\n      ? symbolLayer?.colors.component.unit\n      : undefined;\n\n  return (\n    <Box sx={{ display: \"flex\", flexDirection: \"column\", gap: 3 }}>\n      <Flex sx={{ flexWrap: \"wrap\", gap: 4 }}>\n        {areaLayer && showAreaLegend && (\n          <Box>\n            <Typography\n              component=\"div\"\n              variant=\"caption\"\n              sx={{ marginLeft: `${MARGIN.left}px` }}\n            >\n              {areaLayer.colors.component.label}\n              {areaColorUnit ? ` (${areaColorUnit})` : \"\"}\n            </Typography>\n            {areaLayer.colors.type === \"continuous\" ? (\n              areaLayer.colors.interpolationType === \"linear\" ? (\n                <ContinuousColorLegend\n                  paletteId={areaLayer.colors.paletteId}\n                  domain={areaLayer.colors.domain}\n                  getValue={areaLayer.colors.getValue}\n                  valueFormatter={formatters[areaLayer.colors.component.id]}\n                />\n              ) : areaLayer.colors.interpolationType === \"quantize\" ? (\n                <QuantizeColorLegend\n                  colorScale={areaLayer.colors.scale as ScaleQuantize<string>}\n                  domain={areaLayer.colors.domain}\n                  getValue={areaLayer.colors.getValue}\n                />\n              ) : areaLayer.colors.interpolationType === \"quantile\" ? (\n                <QuantileColorLegend\n                  colorScale={areaLayer.colors.scale as ScaleQuantile<string>}\n                  domain={areaLayer.colors.domain}\n                  getValue={areaLayer.colors.getValue}\n                />\n              ) : areaLayer.colors.interpolationType === \"jenks\" ? (\n                <JenksColorLegend\n                  colorScale={\n                    areaLayer.colors.scale as ScaleThreshold<number, string>\n                  }\n                  domain={areaLayer.colors.domain}\n                  getValue={areaLayer.colors.getValue}\n                />\n              ) : null\n            ) : null}\n          </Box>\n        )}\n\n        {symbolLayer && (\n          <Flex sx={{ gap: 4 }}>\n            {symbolLayer.colors.type === \"continuous\" && (\n              <Box>\n                <Typography component=\"div\" variant=\"caption\">\n                  {symbolLayer.colors.component.label}\n                  {symbolColorUnit ? ` (${symbolColorUnit})` : \"\"}\n                </Typography>\n                {symbolLayer.colors.interpolationType === \"linear\" ? (\n                  <ContinuousColorLegend\n                    paletteId={symbolLayer.colors.paletteId}\n                    domain={symbolLayer.colors.domain}\n                    getValue={(d: Observation) => {\n                      // @ts-ignore\n                      return d[symbolLayer.colors.component.iri] as number;\n                    }}\n                    valueFormatter={formatters[symbolLayer.colors.component.id]}\n                  />\n                ) : symbolLayer.colors.interpolationType === \"quantize\" ? (\n                  <QuantizeColorLegend\n                    colorScale={\n                      symbolLayer.colors.scale as ScaleQuantize<string>\n                    }\n                    domain={symbolLayer.colors.domain}\n                    getValue={symbolLayer.colors.getValue}\n                  />\n                ) : symbolLayer.colors.interpolationType === \"quantile\" ? (\n                  <QuantileColorLegend\n                    colorScale={\n                      symbolLayer.colors.scale as ScaleQuantile<string>\n                    }\n                    domain={symbolLayer.colors.domain}\n                    getValue={symbolLayer.colors.getValue}\n                  />\n                ) : symbolLayer.colors.interpolationType === \"jenks\" ? (\n                  <JenksColorLegend\n                    colorScale={\n                      symbolLayer.colors.scale as ScaleThreshold<number, string>\n                    }\n                    domain={symbolLayer.colors.domain}\n                    getValue={symbolLayer.colors.getValue}\n                  />\n                ) : null}\n              </Box>\n            )}\n\n            {symbolLayer.measureDimension && (\n              <Box>\n                <Typography component=\"div\" variant=\"caption\">\n                  {symbolLayer.measureLabel}\n                  {symbolUnit ? ` (${symbolUnit})` : \"\"}\n                </Typography>\n                <CircleLegend\n                  valueFormatter={formatters[symbolLayer.measureDimension.id]}\n                />\n              </Box>\n            )}\n          </Flex>\n        )}\n\n        {limits.map((limit) => {\n          const { configLimit, measureLimit, limitUnit } = limit;\n\n          switch (measureLimit.type) {\n            case \"single\":\n              return (\n                <Box>\n                  <Typography component=\"div\" variant=\"caption\">\n                    {measureLimit.name}\n                    {limitUnit ? ` (${limitUnit})` : \"\"}\n                  </Typography>\n                  <LimitLegend\n                    maxValue={measureLimit.value}\n                    color={configLimit.color}\n                  />\n                </Box>\n              );\n            case \"value-range\":\n              return (\n                <Box>\n                  <Typography component=\"div\" variant=\"caption\">\n                    {measureLimit.name}\n                  </Typography>\n                  <LimitLegend\n                    minValue={measureLimit.min}\n                    maxValue={measureLimit.max}\n                    color={configLimit.color}\n                  />\n                </Box>\n              );\n            case \"time-range\":\n              return (\n                <Box>\n                  <Typography component=\"div\" variant=\"caption\">\n                    {measureLimit.name}\n                    {limitUnit ? ` (${limitUnit})` : \"\"}\n                  </Typography>\n                  <LimitLegend\n                    maxValue={measureLimit.value}\n                    color={configLimit.color}\n                  />\n                </Box>\n              );\n            default:\n              const _exhaustiveCheck: never = measureLimit;\n              return _exhaustiveCheck;\n          }\n        })}\n      </Flex>\n\n      {areaLayer?.colors.type === \"categorical\" && (\n        <MapLegendColor\n          chartConfig={chartConfig}\n          component={areaLayer.colors.component}\n          getColor={areaLayer.colors.getColor}\n          useAbbreviations={areaLayer.colors.useAbbreviations}\n          observations={observations}\n        />\n      )}\n\n      {symbolLayer?.colors.type === \"categorical\" &&\n        symbolLayer.colors.component.id !== areaLayer?.colors.component.id && (\n          <MapLegendColor\n            chartConfig={chartConfig}\n            component={symbolLayer.colors.component}\n            getColor={symbolLayer.colors.getColor}\n            useAbbreviations={symbolLayer.colors.useAbbreviations}\n            observations={observations}\n          />\n        )}\n    </Box>\n  );\n};\n\nconst Circle = ({\n  value,\n  label,\n  fill,\n  stroke,\n  radius,\n  maxRadius,\n  fontSize,\n  showLine = true,\n  dashed,\n  center,\n}: {\n  value: string;\n  label: string;\n  fill?: string;\n  stroke: string;\n  radius: number;\n  maxRadius: number;\n  fontSize: number;\n  showLine?: boolean;\n  dashed?: boolean;\n  center?: boolean;\n}) => {\n  const cy = center ? -maxRadius + radius : 0;\n\n  return (\n    <g transform={`translate(0, ${maxRadius - radius})`}>\n      <circle\n        cx={0}\n        cy={cy}\n        r={radius}\n        fill={fill}\n        stroke={stroke}\n        strokeDasharray={dashed ? \"4 4\" : 0}\n        fillOpacity={0.1}\n      />\n      {showLine && (\n        <>\n          <line\n            x1={0}\n            y1={cy - radius}\n            x2={maxRadius + 4}\n            y2={cy - radius}\n            stroke=\"black\"\n          />\n          <text\n            x={maxRadius + 6}\n            y={cy - radius}\n            dy={5}\n            textAnchor=\"start\"\n            fontSize={fontSize}\n            paintOrder=\"stroke\"\n            stroke=\"white\"\n            strokeWidth={2}\n          >\n            {value} {label}\n          </text>\n        </>\n      )}\n    </g>\n  );\n};\n\nconst CircleLegend = ({\n  valueFormatter,\n}: {\n  valueFormatter: (d: Observation[string]) => string;\n}) => {\n  const width = useLegendWidth();\n\n  const [interaction] = useInteraction();\n  const { labelColor } = useChartTheme();\n  const { symbolLayer } = useChartState() as MapState;\n  const {\n    data,\n    dataDomain,\n    getLabel,\n    getValue,\n    colors: { getColor },\n    radiusScale,\n  } = symbolLayer as NonNullable<MapState[\"symbolLayer\"]>;\n\n  const maybeValue =\n    interaction.observation && getValue(interaction.observation);\n  const value = typeof maybeValue === \"number\" ? maybeValue : undefined;\n\n  // @ts-ignore - value can be undefined, D3 types are wrong here\n  const radius = radiusScale(value);\n  const maxRadius = radiusScale.range()[1];\n\n  const color = interaction.observation\n    ? rgbArrayToHex(getColor(interaction.observation))\n    : undefined;\n\n  const domainObservations = useMemo(\n    () => dataDomain.map((d) => data.find((x) => getValue(x) === d)),\n    [data, dataDomain, getValue]\n  ) as [Observation | undefined, Observation | undefined];\n\n  return (\n    <svg width={width} height={60}>\n      <g\n        transform={`translate(${MARGIN.left + maxRadius}, ${\n          MARGIN.top + maxRadius\n        })`}\n      >\n        {dataDomain.map((d, i) => {\n          const observation = domainObservations[i];\n\n          if (observation) {\n            const label = getLabel(observation);\n            const radius = radiusScale(d);\n\n            return (\n              <Circle\n                key={i}\n                value={valueFormatter(d)}\n                label={label}\n                fill=\"none\"\n                stroke={labelColor}\n                radius={radius}\n                maxRadius={maxRadius}\n                fontSize={AXIS_LABEL_FONT_SIZE}\n                showLine={!interaction.visible}\n              />\n            );\n          }\n        })}\n        {/* Hovered data point indicator */}\n        {interaction.observation &&\n          interaction.visible &&\n          value !== undefined &&\n          radius !== undefined &&\n          color !== undefined && (\n            <Circle\n              value={valueFormatter(value)}\n              label={getLabel(interaction.observation)}\n              fill={color}\n              stroke={labelColor}\n              radius={radius}\n              maxRadius={maxRadius}\n              fontSize={AXIS_LABEL_FONT_SIZE}\n            />\n          )}\n      </g>\n    </svg>\n  );\n};\n\nconst LimitLegend = ({\n  minValue,\n  maxValue,\n  color,\n}: {\n  minValue?: number;\n  maxValue: number;\n  color: string;\n}) => {\n  const formatNumber = useFormatNumber({ decimals: \"auto\" });\n  const width = useLegendWidth();\n\n  const { symbolLayer } = useChartState() as MapState;\n  const { radiusScale } = symbolLayer as NonNullable<MapState[\"symbolLayer\"]>;\n\n  const minRadius = radiusScale(minValue ?? 0);\n  const maxRadius = radiusScale(maxValue);\n\n  return (\n    <svg width={width} height={maxRadius * 2 + MARGIN.top + MARGIN.bottom}>\n      <g\n        transform={`translate(${maxRadius + MARGIN.left}, ${maxRadius + MARGIN.top})`}\n      >\n        <Circle\n          value={formatNumber(maxValue)}\n          label=\"\"\n          fill=\"none\"\n          stroke={color}\n          radius={maxRadius}\n          maxRadius={maxRadius}\n          fontSize={AXIS_LABEL_FONT_SIZE}\n          showLine\n          dashed\n        />\n        {minValue !== undefined ? (\n          <Circle\n            value={formatNumber(minValue)}\n            label=\"\"\n            fill=\"none\"\n            stroke={color}\n            radius={minRadius}\n            maxRadius={maxRadius}\n            fontSize={AXIS_LABEL_FONT_SIZE}\n            showLine\n            dashed\n            center\n          />\n        ) : null}\n      </g>\n    </svg>\n  );\n};\n\nconst getRotatedAxisLabelHeight = (\n  d: number,\n  options: { formatNumber: (d: number) => string; fontSize: number }\n) => {\n  const { formatNumber, fontSize } = options;\n  const w = getTextWidth(formatNumber(d), { fontSize });\n  const h = 12;\n  const a = AXIS_TICK_ROTATE_ANGLE * (Math.PI / 180);\n\n  return Math.abs(w * Math.sin(a)) + Math.abs(h * Math.cos(a));\n};\n\nconst getMaxRotatedAxisLabelHeight = (\n  values: number[],\n  options: {\n    formatNumber: (d: number) => string;\n    fontSize: number;\n  }\n) => {\n  const { formatNumber, fontSize } = options;\n\n  return Math.max(\n    ...values.map((d) => {\n      return getRotatedAxisLabelHeight(d, {\n        formatNumber,\n        fontSize,\n      });\n    })\n  );\n};\n\nconst useLegendWithRotatedAxisLabelsHeight = (\n  values: number[],\n  options: {\n    formatNumber: (d: number) => string;\n    fontSize: number;\n  }\n) => {\n  const { formatNumber, fontSize } = options;\n  const maxLabelHeight = useMemo(() => {\n    return getMaxRotatedAxisLabelHeight(values, {\n      formatNumber,\n      fontSize,\n    });\n  }, [values, formatNumber, fontSize]);\n\n  return Math.max(HEIGHT, HEIGHT * 0.4 + maxLabelHeight);\n};\n\nconst JenksColorLegend = ({\n  colorScale,\n  domain,\n  getValue,\n}: {\n  colorScale: ScaleThreshold<number, string>;\n  domain: [number, number];\n  getValue: (d: Observation) => number | null;\n}) => {\n  const width = useLegendWidth();\n  const legendAxisRef = useRef<SVGGElement>(null);\n  const { axisLabelFontSize, labelColor, fontFamily } = useChartTheme();\n  const formatNumber = useFormatInteger();\n  const thresholds = colorScale.domain();\n  const [min, max] = domain;\n\n  // From color index to threshold value\n  const thresholdsScale = scaleLinear()\n    .domain(range(colorScale.range().length + 1))\n    .range([min || 0, ...thresholds, max || 100]);\n\n  // From threshold value to pixel value\n  const scale = scaleLinear()\n    .domain([min || 0, max || 10_000])\n    .range([MARGIN.left, width - MARGIN.right]);\n\n  const tickValues = thresholds.splice(0, thresholds.length - 1);\n\n  useEffect(\n    () =>\n      makeAxis(select(legendAxisRef.current) as any, {\n        axisLabelFontSize,\n        fontFamily,\n        formatNumber,\n        labelColor,\n        scale,\n        thresholds: tickValues,\n      }),\n    [axisLabelFontSize, fontFamily, formatNumber, labelColor, scale, tickValues]\n  );\n\n  const height = useLegendWithRotatedAxisLabelsHeight(thresholdsScale.range(), {\n    formatNumber,\n    fontSize: axisLabelFontSize,\n  });\n\n  return (\n    <svg width={width} height={height}>\n      <g>\n        <DataPointIndicator scale={scale} getValue={getValue} />\n      </g>\n      <g transform={`translate(0, ${MARGIN.top})`}>\n        {(colorScale as ScaleThreshold<number, string>).range().map((c, i) => {\n          return (\n            <rect\n              key={i}\n              x={scale(thresholdsScale(i))}\n              y={0}\n              width={scale(thresholdsScale(i + 1)) - scale(thresholdsScale(i))}\n              height={COLOR_RAMP_HEIGHT}\n              fill={c}\n            />\n          );\n        })}\n      </g>\n      <g\n        ref={legendAxisRef}\n        key=\"legend-axis\"\n        transform={`translate(0, ${COLOR_RAMP_HEIGHT + MARGIN.top})`}\n      />\n    </svg>\n  );\n};\n\nconst QuantileColorLegend = ({\n  colorScale,\n  domain,\n  getValue,\n}: {\n  colorScale: ScaleQuantile<string>;\n  domain: [number, number];\n  getValue: (d: Observation) => number | null;\n}) => {\n  const width = useLegendWidth();\n  const legendAxisRef = useRef<SVGGElement>(null);\n\n  const { axisLabelFontSize, labelColor, fontFamily } = useChartTheme();\n  const formatNumber = useFormatInteger();\n  const thresholds = colorScale.quantiles();\n\n  const [min, max] = domain;\n\n  // From color index to threshold value\n  const thresholdsScale = scaleLinear()\n    .domain(range(colorScale.range().length + 1))\n    .range([min, ...thresholds, max]);\n\n  // From threshold value to pixel value\n  const scale = scaleLinear()\n    .domain([min || 0, max || 10000])\n    .range([MARGIN.left, width - MARGIN.right]);\n\n  useEffect(\n    () =>\n      makeAxis(select(legendAxisRef.current) as any, {\n        axisLabelFontSize,\n        fontFamily,\n        formatNumber,\n        labelColor,\n        scale,\n        thresholds,\n      }),\n    [axisLabelFontSize, fontFamily, formatNumber, labelColor, scale, thresholds]\n  );\n\n  const height = useLegendWithRotatedAxisLabelsHeight(thresholdsScale.range(), {\n    formatNumber,\n    fontSize: axisLabelFontSize,\n  });\n\n  return (\n    <svg width={width} height={height}>\n      <g>\n        <DataPointIndicator scale={scale} getValue={getValue} />\n      </g>\n      <g transform={`translate(0, ${MARGIN.top})`}>\n        {(colorScale as ScaleQuantile<string>).range().map((c, i) => {\n          return (\n            <rect\n              key={i}\n              x={scale(thresholdsScale(i))}\n              y={0}\n              width={scale(thresholdsScale(i + 1)) - scale(thresholdsScale(i))}\n              height={COLOR_RAMP_HEIGHT}\n              fill={c}\n            />\n          );\n        })}\n      </g>\n      <g\n        ref={legendAxisRef}\n        key=\"legend-axis\"\n        transform={`translate(0, ${COLOR_RAMP_HEIGHT + MARGIN.top})`}\n      />\n    </svg>\n  );\n};\n\nconst QuantizeColorLegend = ({\n  colorScale,\n  domain,\n  getValue,\n}: {\n  colorScale: ScaleQuantize<string>;\n  domain: [number, number];\n  getValue: (d: Observation) => number | null;\n}) => {\n  const width = useLegendWidth();\n  const legendAxisRef = useRef<SVGGElement>(null);\n\n  const { axisLabelFontSize, labelColor, fontFamily } = useChartTheme();\n  const formatNumber = useFormatInteger();\n\n  const classesScale = scaleLinear()\n    .domain([0, colorScale.range().length])\n    .range([MARGIN.left, width - MARGIN.right]);\n\n  const scale = scaleLinear()\n    .domain(domain)\n    .range([MARGIN.left, width - MARGIN.right]);\n  const thresholds = colorScale.thresholds();\n\n  useEffect(\n    () =>\n      makeAxis(select(legendAxisRef.current) as any, {\n        axisLabelFontSize,\n        fontFamily,\n        formatNumber,\n        labelColor,\n        scale,\n        thresholds,\n      }),\n    [axisLabelFontSize, fontFamily, formatNumber, labelColor, scale, thresholds]\n  );\n\n  const height = useLegendWithRotatedAxisLabelsHeight(thresholds, {\n    formatNumber,\n    fontSize: axisLabelFontSize,\n  });\n\n  return (\n    <svg width={width} height={height}>\n      <g>\n        <DataPointIndicator scale={scale} getValue={getValue} />\n      </g>\n      <g transform={`translate(0, ${MARGIN.top})`}>\n        {(colorScale as ScaleQuantize<string>).range().map((c, i) => (\n          <rect\n            key={i}\n            x={classesScale(i)}\n            width={\n              (width - MARGIN.left - MARGIN.right) / colorScale.range().length\n            }\n            height={COLOR_RAMP_HEIGHT}\n            fill={c}\n          />\n        ))}\n      </g>\n      <g\n        ref={legendAxisRef}\n        key=\"legend-axis\"\n        transform={`translate(0, ${COLOR_RAMP_HEIGHT + MARGIN.top})`}\n      />\n    </svg>\n  );\n};\n\nconst ContinuousColorLegend = ({\n  paletteId,\n  domain,\n  getValue,\n  valueFormatter,\n}: {\n  paletteId: PaletteType[\"paletteId\"];\n  domain: [number, number];\n  getValue: (d: Observation) => number | null;\n  valueFormatter: (v: Observation[string]) => string;\n}) => {\n  const width = useLegendWidth();\n  const { labelColor, fontFamily } = useChartTheme();\n  const scale = scaleLinear()\n    .domain(domain)\n    .range([MARGIN.left, width - MARGIN.right]);\n  const [min, max] = domain;\n\n  return (\n    <svg width={width} height={HEIGHT}>\n      <g>\n        <DataPointIndicator scale={scale} getValue={getValue} />\n      </g>\n      <foreignObject\n        x={MARGIN.left}\n        y={-1} // needed to align with other legends, not sure why\n        width={width - MARGIN.left - MARGIN.right}\n        height={COLOR_RAMP_HEIGHT}\n        style={{ display: \"flex\" }}\n      >\n        <ColorRamp\n          width={width - MARGIN.left - MARGIN.right}\n          height={COLOR_RAMP_HEIGHT}\n          colorInterpolator={getColorInterpolator(paletteId)}\n          nSteps={width - MARGIN.left - MARGIN.right}\n          rx={0}\n        />\n      </foreignObject>\n      <g\n        transform={`translate(${MARGIN.left}, ${\n          MARGIN.top + COLOR_RAMP_HEIGHT + 14\n        })`}\n        fontFamily={fontFamily}\n        fontSize={AXIS_LABEL_FONT_SIZE}\n        fill={labelColor}\n      >\n        <text textAnchor=\"start\" fontSize={AXIS_LABEL_FONT_SIZE}>\n          {valueFormatter(min)}\n        </text>\n        <text x={width - MARGIN.right - MARGIN.left} textAnchor=\"end\">\n          {valueFormatter(max)}\n        </text>\n      </g>\n    </svg>\n  );\n};\n\nconst useDataPointIndicatorStyles = makeStyles((theme: Theme) => ({\n  root: {\n    transition: `transform ${theme.transitions.duration.shorter}ms ease`,\n  },\n}));\n\nconst DataPointIndicator = ({\n  scale,\n  getValue,\n}: {\n  scale: ScaleLinear<number, number>;\n  getValue: (d: Observation) => number | null;\n}) => {\n  const [{ visible, observation }] = useInteraction();\n  const { labelColor } = useChartTheme();\n  const classes = useDataPointIndicatorStyles();\n\n  return (\n    <>\n      {observation && visible && !isNaN(getValue(observation) ?? NaN) && (\n        <polygon\n          fill={labelColor}\n          points=\"-4,0 4,0 0,4\"\n          className={classes.root}\n          style={{\n            transform: `translate(${scale(getValue(observation) ?? 0)}px, 0)`,\n          }}\n        />\n      )}\n    </>\n  );\n};\n","import { geoCentroid } from \"d3-geo\";\nimport keyBy from \"lodash/keyBy\";\nimport { useMemo } from \"react\";\n\nimport { ChartMapProps } from \"@/charts/map/chart-map\";\nimport { prepareFeatureCollection } from \"@/charts/map/helpers\";\nimport {\n  useDimensionWithAbbreviations,\n  usePlottableData,\n} from \"@/charts/shared/chart-helpers\";\nimport {\n  AreaLayerVariables,\n  BaseVariables,\n  ChartStateData,\n  SymbolLayerVariables,\n  useBaseVariables,\n  useChartData,\n} from \"@/charts/shared/chart-state\";\nimport { useChartConfigFilters } from \"@/config-utils\";\nimport { MapConfig } from \"@/configurator\";\nimport {\n  GeoData,\n  GeoPoint,\n  isGeoCoordinatesDimension,\n  isGeoDimension,\n  isGeoShapesDimension,\n} from \"@/domain/data\";\n\nimport { ChartProps } from \"../shared/chart-props\";\n\nexport type MapStateVariables = BaseVariables &\n  AreaLayerVariables &\n  SymbolLayerVariables;\n\nexport const useMapStateVariables = (\n  chartProps: ChartProps<MapConfig>\n): MapStateVariables => {\n  const { chartConfig, observations, dimensions } = chartProps;\n  const { fields } = chartConfig;\n  const { areaLayer, symbolLayer } = fields;\n\n  const baseVariables = useBaseVariables(chartConfig);\n\n  // TODO: add abbreviations\n  const areaLayerDimension = dimensions.find(\n    (d) => d.id === areaLayer?.componentId\n  );\n\n  if (areaLayerDimension && !isGeoShapesDimension(areaLayerDimension)) {\n    throw Error(\n      `Dimension <${areaLayerDimension.id}> is not geo shapes dimension!`\n    );\n  }\n\n  const symbolLayerDimension = dimensions.find(\n    (d) => d.id === symbolLayer?.componentId\n  );\n\n  // Symbol layer dimension can be either GeoShapes or GeoCoordinates dimension.\n  if (symbolLayerDimension && !isGeoDimension(symbolLayerDimension)) {\n    throw Error(`Dimension <${symbolLayerDimension.id}> is not geo dimension!`);\n  }\n\n  const { getValue: getSymbol, getLabel: getSymbolLabel } =\n    useDimensionWithAbbreviations(symbolLayerDimension, {\n      observations,\n      field: symbolLayer,\n    });\n\n  return {\n    ...baseVariables,\n    areaLayerDimension,\n    symbolLayerDimension,\n    getSymbol,\n    getSymbolLabel,\n  };\n};\n\nexport type MapStateData = ChartStateData & { features: GeoData };\n\nexport const useMapStateData = (\n  // FIXME: should we also have aspect ratio here? Consolidate this\n  chartProps: ChartMapProps,\n  variables: MapStateVariables\n): MapStateData => {\n  const { chartConfig, observations, shapes, coordinates } = chartProps;\n  const {\n    areaLayerDimension,\n    symbolLayerDimension,\n    getSymbol,\n    getSymbolLabel,\n  } = variables;\n  const filters = useChartConfigFilters(chartConfig);\n  const plottableData = usePlottableData(observations, {});\n  const data = useChartData(plottableData, {\n    chartConfig,\n    timeRangeDimensionId: undefined,\n  });\n\n  const areaLayer = useMemo(() => {\n    const id = areaLayerDimension?.id;\n\n    if (!(id && shapes)) {\n      return;\n    }\n\n    const { topology } = shapes;\n    const featureCollection = prepareFeatureCollection({\n      dimensionId: id,\n      topology,\n      filters: filters[id],\n      observations: data.chartData,\n    });\n\n    return {\n      shapes: featureCollection,\n    };\n  }, [areaLayerDimension?.id, shapes, filters, data.chartData]);\n\n  const symbolLayer = useMemo(() => {\n    if (isGeoCoordinatesDimension(symbolLayerDimension) && coordinates) {\n      const points: GeoPoint[] = [];\n      const coordsByLabel = keyBy(coordinates, (d) => d.label);\n\n      data.chartData.forEach((d) => {\n        const value = getSymbol(d);\n        const label = getSymbolLabel(value);\n        const coords = coordsByLabel[value] ?? coordsByLabel[label];\n\n        if (coords) {\n          const { iri, label, latitude, longitude } = coords;\n          // FIXME: create other object and do not store observation here.\n          // This would make it possible to not re-create the layer on data change\n          // and then, animate the colors.\n          points.push({\n            coordinates: [longitude, latitude],\n            properties: {\n              iri,\n              label,\n              observation: d,\n            },\n          });\n        }\n      });\n\n      return {\n        points,\n      };\n    } else if (isGeoShapesDimension(symbolLayerDimension) && shapes) {\n      const { topology } = shapes;\n      const id = symbolLayerDimension.id;\n      const { features } = prepareFeatureCollection({\n        dimensionId: id,\n        topology,\n        filters: filters[id],\n        observations: data.chartData,\n      });\n\n      const points = features.map((d) => ({\n        ...d,\n        coordinates: geoCentroid(d),\n      }));\n\n      return {\n        points,\n      };\n    }\n  }, [\n    symbolLayerDimension,\n    getSymbol,\n    getSymbolLabel,\n    data.chartData,\n    shapes,\n    coordinates,\n    filters,\n  ]);\n\n  return {\n    ...data,\n    features: {\n      areaLayer,\n      symbolLayer,\n    },\n  };\n};\n","import { extent } from \"d3-array\";\nimport {\n  ScaleLinear,\n  ScalePower,\n  ScaleQuantile,\n  scaleQuantile,\n  ScaleQuantize,\n  scaleQuantize,\n  ScaleSequential,\n  scaleSequential,\n  scaleSqrt,\n  ScaleThreshold,\n  scaleThreshold,\n} from \"d3-scale\";\nimport {\n  Feature,\n  FeatureCollection,\n  GeoJsonProperties,\n  Geometry,\n} from \"geojson\";\nimport keyBy from \"lodash/keyBy\";\nimport mapValues from \"lodash/mapValues\";\nimport { PropsWithChildren, useCallback, useMemo } from \"react\";\nimport { ckmeans } from \"simple-statistics\";\n\nimport { ChartMapProps } from \"@/charts/map/chart-map\";\nimport { getBBox } from \"@/charts/map/helpers\";\nimport {\n  MapStateData,\n  MapStateVariables,\n  useMapStateData,\n  useMapStateVariables,\n} from \"@/charts/map/map-state-props\";\nimport { MapTooltipProvider } from \"@/charts/map/map-tooltip\";\nimport {\n  useOptionalNumericVariable,\n  useStringVariable,\n} from \"@/charts/shared/chart-helpers\";\nimport {\n  ChartContext,\n  CommonChartState,\n  useNumericalYErrorVariables,\n} from \"@/charts/shared/chart-state\";\nimport { colorToRgbArray } from \"@/charts/shared/colors\";\nimport { InteractionProvider } from \"@/charts/shared/use-interaction\";\nimport { useSize } from \"@/charts/shared/use-size\";\nimport {\n  BBox,\n  ColorScaleInterpolationType,\n  MapSymbolLayer,\n  NumericalColorField,\n} from \"@/config-types\";\nimport {\n  Component,\n  Dimension,\n  GeoData,\n  isGeoShapesDimension,\n  Measure,\n  Observation,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { getColorInterpolator } from \"@/palettes\";\nimport { getFittingColorInterpolator } from \"@/utils/color-palette-utils\";\n\nexport type MapState = CommonChartState &\n  MapStateVariables & {\n    chartType: \"map\";\n    features: GeoData;\n    locked: boolean;\n    lockedBBox: BBox | undefined;\n    featuresBBox: BBox | undefined;\n    showBaseLayer: boolean;\n    identicalLayerComponentIds: boolean;\n    areaLayer:\n      | {\n          data: Observation[];\n          dataDomain: [number, number];\n          getLabel: (d: Observation) => string;\n          colors: AreaLayerColors;\n        }\n      | undefined;\n    symbolLayer:\n      | {\n          data: Observation[];\n          dataDomain: [number, number];\n          measureDimension?: Measure;\n          measureLabel: string;\n          getLabel: (d: Observation) => string;\n          getValue: (d: Observation) => number | null;\n          getFormattedError: null | ((d: Observation) => string | undefined);\n          radiusScale: ScalePower<number, number>;\n          colors: SymbolLayerColors;\n        }\n      | undefined;\n  };\n\nconst useMapState = (\n  chartProps: ChartMapProps,\n  variables: MapStateVariables,\n  data: MapStateData\n): MapState => {\n  const { width } = useSize();\n  const { chartConfig, measures, dimensions } = chartProps;\n  const { chartData, scalesData, allData, features } = data;\n  const { fields, baseLayer } = chartConfig;\n  const { areaLayer, symbolLayer } = fields;\n\n  const areaLayerState = useLayerState({\n    componentId: fields.areaLayer?.componentId,\n    measureId: fields.areaLayer?.color.componentId,\n    data: scalesData,\n    features,\n    dimensions,\n    measures,\n  });\n\n  const areaColors = useColors({\n    color: areaLayer?.color,\n    data: areaLayerState.data,\n    dimensions,\n    measures,\n  });\n\n  const preparedAreaLayerState: MapState[\"areaLayer\"] = useMemo(() => {\n    if (areaLayer?.componentId === undefined) {\n      return;\n    }\n\n    return {\n      data: areaLayerState.data,\n      dataDomain: areaLayerState.dataDomain,\n      getLabel: areaLayerState.getLabel,\n      colors: areaColors as unknown as AreaLayerColors,\n    };\n  }, [areaColors, areaLayer, areaLayerState]);\n\n  const symbolLayerState = useLayerState({\n    componentId: symbolLayer?.componentId,\n    measureId: symbolLayer?.measureId,\n    data: scalesData,\n    features,\n    dimensions,\n    measures,\n  });\n\n  const symbolColors = useColors({\n    color: symbolLayer?.color,\n    data: symbolLayerState.data,\n    dimensions,\n    measures,\n  });\n\n  const radiusScale = useMemo(() => {\n    // Measure dimension is undefined. Can be useful when the user wants to\n    // encode only the color of symbols, and the size is irrelevant.\n    if (symbolLayerState.dataDomain[1] === undefined) {\n      return scaleSqrt().range([0, 12]).unknown(12);\n    }\n\n    const baseScale = scaleSqrt()\n      .domain([0, symbolLayerState.dataDomain[1]])\n      .range([0, 24]);\n\n    const wrappedScale = (x: number | null) => {\n      if (x === null || x === undefined) return 0;\n      if (x === 0) return 0;\n      const scaled = baseScale(x);\n      return Math.max(2, scaled);\n    };\n\n    Object.assign(wrappedScale, baseScale);\n\n    return wrappedScale;\n  }, [symbolLayerState.dataDomain]) as ScalePower<number, number>;\n\n  const preparedSymbolLayerState: MapState[\"symbolLayer\"] = useMemo(() => {\n    if (symbolLayer?.componentId === undefined) {\n      return;\n    }\n\n    return {\n      ...symbolLayerState,\n      colors: symbolColors as SymbolLayerColors,\n      radiusScale,\n    };\n  }, [symbolLayer?.componentId, symbolLayerState, radiusScale, symbolColors]);\n\n  const identicalLayerComponentIds =\n    areaLayer?.componentId !== undefined &&\n    symbolLayer?.componentId !== undefined &&\n    areaLayer.componentId === symbolLayer.componentId;\n\n  const height = width * 0.5;\n  const bounds = {\n    width,\n    height,\n    aspectRatio: height / width,\n    margins: {\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n    },\n    chartWidth: width,\n    chartHeight: width * 0.5,\n  };\n\n  const featuresBBox = useMemo(() => {\n    return getBBox(\n      areaLayer?.componentId !== undefined\n        ? filterFeatureCollection(\n            features.areaLayer?.shapes,\n            (f) => !!f?.properties?.observation\n          )\n        : undefined,\n      symbolLayer?.componentId !== undefined\n        ? features.symbolLayer?.points.filter(\n            (p) => !!p?.properties?.observation\n          )\n        : undefined\n    );\n  }, [\n    areaLayer?.componentId,\n    features.areaLayer?.shapes,\n    symbolLayer?.componentId,\n    features.symbolLayer?.points,\n  ]);\n\n  return {\n    chartType: \"map\",\n    chartData,\n    allData,\n    bounds,\n    features,\n    showBaseLayer: baseLayer.show,\n    locked: baseLayer.locked || false,\n    lockedBBox: baseLayer.bbox,\n    featuresBBox,\n    identicalLayerComponentIds,\n    areaLayer: preparedAreaLayerState,\n    symbolLayer: preparedSymbolLayerState,\n    ...variables,\n  };\n};\n\ntype AreaLayerColors =\n  | {\n      type: \"categorical\";\n      paletteId: string;\n      component: Dimension;\n      domain: string[];\n      getValue: (d: Observation) => string;\n      getColor: (d: Observation) => number[];\n      useAbbreviations: boolean;\n    }\n  | {\n      type: \"continuous\";\n      paletteId: string;\n      component: Measure;\n      domain: [number, number];\n      // Needed for the legend.\n      scale:\n        | ScaleSequential<string>\n        | ScaleQuantize<string>\n        | ScaleQuantile<string>\n        | ScaleLinear<string, string>\n        | ScaleThreshold<number, string>;\n      interpolationType: ColorScaleInterpolationType;\n      getValue: (d: Observation) => number | null;\n      getColor: (d: Observation) => number[];\n      getFormattedError: null | ((d: Observation) => string);\n    };\n\ntype SymbolLayerColors =\n  | { type: \"fixed\"; getColor: (d: Observation) => number[] }\n  | AreaLayerColors;\n\nconst getNumericalColorScale = ({\n  color,\n  getValue,\n  data,\n  dataDomain,\n}: {\n  color: NumericalColorField;\n  getValue: (d: Observation) => number | null;\n  data: Observation[];\n  dataDomain: [number, number];\n}) => {\n  const interpolator = getFittingColorInterpolator(\n    { color },\n    getColorInterpolator\n  );\n\n  switch (color.scaleType) {\n    case \"continuous\":\n      switch (color.interpolationType) {\n        case \"linear\":\n          return scaleSequential(interpolator).domain(dataDomain);\n      }\n    case \"discrete\":\n      const range = Array.from({ length: color.nbClass }, (_, i) =>\n        interpolator(i / (color.nbClass - 1))\n      );\n\n      switch (color.interpolationType) {\n        case \"jenks\":\n          const ckMeansThresholds = ckmeans(\n            data.map((d) => getValue(d) ?? null).filter(truthy),\n            Math.min(color.nbClass, data.length)\n          ).map((v) => v.pop() || 0);\n\n          return scaleThreshold<number, string>()\n            .domain(ckMeansThresholds)\n            .range(range);\n        case \"quantile\":\n          return scaleQuantile<string>()\n            .domain(data.map((d) => getValue(d)))\n            .range(range);\n        case \"quantize\":\n          return scaleQuantize<string>().domain(dataDomain).range(range);\n      }\n    default:\n      const _exhaustiveCheck: never = color;\n      return _exhaustiveCheck;\n  }\n};\n\nconst useFixedColors = (colorSpec: MapSymbolLayer[\"color\"] | undefined) => {\n  return useMemo(() => {\n    if (colorSpec?.type !== \"fixed\") {\n      return;\n    }\n\n    const color = colorToRgbArray(colorSpec.value, colorSpec.opacity * 2.55);\n\n    return {\n      type: \"fixed\" as const,\n      getColor: () => color,\n    };\n  }, [colorSpec]);\n};\n\nconst useCategoricalColors = (\n  colorSpec: MapSymbolLayer[\"color\"] | undefined,\n  {\n    dimensions,\n    measures,\n  }: {\n    dimensions: Dimension[];\n    measures: Measure[];\n  }\n) => {\n  return useMemo(() => {\n    if (colorSpec?.type !== \"categorical\") {\n      return;\n    }\n\n    const component = [...dimensions, ...measures].find(\n      (d) => d.id === colorSpec.componentId\n    ) as Component;\n    const valuesByLabel = keyBy(component.values, (d) => d.label);\n    const valuesByAbbreviationOrLabel = keyBy(\n      component.values,\n      colorSpec.useAbbreviations\n        ? (d) => d.alternateName ?? d.label\n        : (d) => d.label\n    );\n    const domain = component.values.map((d) => `${d.value}`) ?? [];\n    const rgbColorMapping = mapValues(colorSpec.colorMapping, (c) =>\n      colorToRgbArray(c, colorSpec.opacity * 2.55)\n    );\n    const getDimensionValue = (d: Observation) => {\n      const abbreviationOrLabel = d[colorSpec.componentId] as string;\n\n      return (\n        valuesByAbbreviationOrLabel[abbreviationOrLabel] ??\n        valuesByLabel[abbreviationOrLabel]\n      );\n    };\n\n    return {\n      type: \"categorical\" as const,\n      paletteId: colorSpec.paletteId,\n      component,\n      domain,\n      getValue: colorSpec.useAbbreviations\n        ? (d: Observation) => {\n            const v = getDimensionValue(d);\n            return v.alternateName || v.label;\n          }\n        : (d: Observation) => {\n            return getDimensionValue(d).label;\n          },\n      getColor: (d: Observation) => {\n        const value = getDimensionValue(d);\n        return rgbColorMapping[value.value];\n      },\n      useAbbreviations: colorSpec.useAbbreviations ?? false,\n    };\n  }, [colorSpec, dimensions, measures]);\n};\n\nconst useNumericalColors = (\n  colorSpec: MapSymbolLayer[\"color\"] | undefined,\n  {\n    data,\n    dimensions,\n    measures,\n  }: {\n    data: Observation[];\n    dimensions: Dimension[];\n    measures: Measure[];\n  }\n) => {\n  const componentId =\n    colorSpec?.type === \"numerical\" ? colorSpec.componentId : \"\";\n  const getValue = useCallback(\n    (d: Observation) =>\n      d[componentId] !== null ? Number(d[componentId]) : null,\n    [componentId]\n  );\n  const { getFormattedYUncertainty } = useNumericalYErrorVariables(\n    { componentId },\n    { getValue, dimensions, measures }\n  );\n\n  return useMemo(() => {\n    if (colorSpec?.type !== \"numerical\") {\n      return;\n    }\n\n    const component = measures.find((d) => d.id === componentId) as Measure;\n    const domain = extent(data.map(getValue).filter(truthy)) as [\n      number,\n      number,\n    ];\n    const colorScale = getNumericalColorScale({\n      color: colorSpec,\n      getValue,\n      data,\n      dataDomain: domain,\n    });\n\n    return {\n      type: \"continuous\" as const,\n      paletteId: colorSpec.paletteId,\n      component,\n      scale: colorScale,\n      interpolationType: colorSpec.interpolationType,\n      getValue,\n      getColor: (d: Observation) => {\n        const value = getValue(d);\n\n        if (value !== null) {\n          const c = colorScale(value);\n\n          if (c) {\n            return colorToRgbArray(c, colorSpec.opacity * 2.55);\n          }\n        }\n\n        return [0, 0, 0, 255 * 0.1];\n      },\n      getFormattedError: getFormattedYUncertainty,\n      domain,\n    };\n  }, [\n    colorSpec,\n    componentId,\n    data,\n    getFormattedYUncertainty,\n    getValue,\n    measures,\n  ]);\n};\n\nconst useColors = ({\n  color,\n  data,\n  dimensions,\n  measures,\n}: {\n  color?: MapSymbolLayer[\"color\"];\n  data: Observation[];\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  const fixedColors = useFixedColors(color);\n  const categoricalColors = useCategoricalColors(color, {\n    dimensions,\n    measures,\n  });\n  const numericalColors = useNumericalColors(color, {\n    data,\n    dimensions,\n    measures,\n  });\n\n  if (!color) {\n    return undefined;\n  }\n\n  switch (color.type) {\n    case \"fixed\":\n      return fixedColors;\n    case \"categorical\":\n      return categoricalColors;\n    case \"numerical\":\n      return numericalColors;\n    default:\n      const _exhaustiveCheck: never = color;\n      return _exhaustiveCheck;\n  }\n};\n\nconst usePreparedData = ({\n  geoDimensionId,\n  getLabel,\n  data,\n  dimensions,\n  features,\n}: {\n  geoDimensionId: string;\n  getLabel: (d: Observation) => string;\n  data: Observation[];\n  dimensions: Dimension[];\n  features: GeoData;\n}) => {\n  return useMemo(() => {\n    if (geoDimensionId === \"\") {\n      return [];\n    }\n\n    const dimension = dimensions.find((d) => d.id === geoDimensionId);\n\n    if (\n      isGeoShapesDimension(dimension) &&\n      features.areaLayer?.shapes?.features\n    ) {\n      const hierarchyLabels = features.areaLayer.shapes.features.map(\n        (d) => d.properties.label\n      );\n\n      return data.filter((d) => hierarchyLabels.includes(getLabel(d)));\n    }\n\n    return data;\n  }, [\n    geoDimensionId,\n    getLabel,\n    data,\n    dimensions,\n    features.areaLayer?.shapes.features,\n  ]);\n};\n\nconst useLayerState = ({\n  componentId = \"\",\n  measureId = \"\",\n  data,\n  features,\n  dimensions,\n  measures,\n}: {\n  componentId: string | undefined;\n  measureId: string | undefined;\n  data: Observation[];\n  features: GeoData;\n  dimensions: Dimension[];\n  measures: Measure[];\n}) => {\n  const getLabel = useStringVariable(componentId);\n  const getValue = useOptionalNumericVariable(measureId);\n  const measureDimension = measures.find((d) => d.id === measureId);\n\n  const { showYUncertainty, getFormattedYUncertainty } =\n    useNumericalYErrorVariables(\n      { componentId: measureId },\n      { getValue, dimensions, measures }\n    );\n\n  const preparedData = usePreparedData({\n    geoDimensionId: componentId,\n    getLabel,\n    data,\n    dimensions,\n    features,\n  });\n  const dataDomain = useMemo(() => {\n    return (extent(preparedData, (d) => getValue(d)) || [0, 100]) as [\n      number,\n      number,\n    ];\n  }, [getValue, preparedData]);\n\n  return {\n    data: preparedData,\n    dataDomain,\n    measureDimension,\n    measureLabel: measureDimension?.label || \"\",\n    getLabel,\n    getValue,\n    getFormattedError: showYUncertainty ? getFormattedYUncertainty : null,\n  };\n};\n\nconst filterFeatureCollection = <TFeatureCollection extends FeatureCollection>(\n  fc: TFeatureCollection | undefined,\n  predicate: (feature: Feature<Geometry, GeoJsonProperties>) => boolean\n) => {\n  if (!fc) {\n    return fc;\n  }\n  return {\n    ...fc,\n    features: fc.features.filter(predicate),\n  };\n};\n\nconst MapChartProvider = (props: PropsWithChildren<ChartMapProps>) => {\n  const { children, ...chartProps } = props;\n  const variables = useMapStateVariables(chartProps);\n  const data = useMapStateData(chartProps, variables);\n  const state = useMapState(chartProps, variables, data);\n\n  return (\n    <ChartContext.Provider value={state}>{children}</ChartContext.Provider>\n  );\n};\n\nexport const MapChart = (props: PropsWithChildren<ChartMapProps>) => {\n  const { children, ...rest } = props;\n\n  return (\n    <InteractionProvider>\n      <MapChartProvider {...rest}>\n        <MapTooltipProvider>{children}</MapTooltipProvider>\n      </MapChartProvider>\n    </InteractionProvider>\n  );\n};\n","import { Box } from \"@mui/material\";\nimport { memo, useCallback, useMemo } from \"react\";\n\nimport { ChartDataWrapper } from \"@/charts/chart-data-wrapper\";\nimport { shouldRenderMap } from \"@/charts/map/helpers\";\nimport { MapComponent } from \"@/charts/map/map\";\nimport { MapCustomLayersLegend } from \"@/charts/map/map-custom-layers-legend\";\nimport { MapLegend } from \"@/charts/map/map-legend\";\nimport { MapChart } from \"@/charts/map/map-state\";\nimport { MapTooltip } from \"@/charts/map/map-tooltip\";\nimport {\n  ChartContainer,\n  ChartControlsContainer,\n} from \"@/charts/shared/containers\";\nimport { NoGeometriesHint } from \"@/components/hint\";\nimport { Cube, MapConfig } from \"@/config-types\";\nimport {\n  useChartConfigFilters,\n  useDefinitiveTemporalFilterValue,\n  useLimits,\n} from \"@/config-utils\";\nimport { TimeSlider } from \"@/configurator/interactive-filters/time-slider\";\nimport {\n  dimensionValuesToGeoCoordinates,\n  GeoCoordinates,\n  GeoShapes,\n} from \"@/domain/data\";\nimport { useDataCubesComponentsQuery } from \"@/graphql/hooks\";\nimport { getResolvedJoinById, isJoinById } from \"@/graphql/join\";\nimport { useDataCubeDimensionGeoShapesQuery } from \"@/graphql/query-hooks\";\nimport { useLocale } from \"@/locales/use-locale\";\n\nimport { ChartProps, VisualizationProps } from \"../shared/chart-props\";\n\nexport const ChartMapVisualization = (props: VisualizationProps<MapConfig>) => {\n  const { dataSource, chartConfig, componentIds } = props;\n  const { fields } = chartConfig;\n  const locale = useLocale();\n  const [componentsQuery] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilters: chartConfig.cubes.map((cube) => ({\n        iri: cube.iri,\n        componentIds,\n        joinBy: cube.joinBy,\n        loadValues: true,\n      })),\n    },\n    keepPreviousData: true,\n  });\n\n  const getLayerIds = useCallback(\n    (layer: keyof typeof fields) => {\n      const layerComponent = fields[layer];\n\n      if (layerComponent) {\n        const cubeIri =\n          componentsQuery.data?.dataCubesComponents.dimensions.find(\n            (d) => d.id === layerComponent.componentId\n          )?.cubeIri;\n        const cube = chartConfig.cubes.find((c) => c.iri === cubeIri) as Cube;\n\n        if (isJoinById(layerComponent.componentId)) {\n          return {\n            dimensionId:\n              getResolvedJoinById(cube, layerComponent.componentId) ??\n              layerComponent.componentId,\n            cubeIri: cube.iri,\n          };\n        } else {\n          return {\n            dimensionId: layerComponent.componentId,\n            cubeIri,\n          };\n        }\n      }\n\n      return {\n        dimensionId: \"\",\n        cubeIri: chartConfig.cubes[0].iri,\n      };\n    },\n    [chartConfig.cubes, componentsQuery.data, fields]\n  );\n  const { dimensionId: areaDimensionId, cubeIri: areaCubeIri } = useMemo(\n    () => getLayerIds(\"areaLayer\"),\n    [getLayerIds]\n  );\n  const { dimensionId: symbolDimensionId, cubeIri: symbolCubeIri } = useMemo(\n    () => getLayerIds(\"symbolLayer\"),\n    [getLayerIds]\n  );\n  const [\n    {\n      data: geoCoordinatesDimension,\n      error: geoCoordinatesDimensionError,\n      fetching: fetchingGeoCoordinatesDimension,\n    },\n  ] = useDataCubesComponentsQuery({\n    chartConfig,\n    variables: {\n      cubeFilters: [\n        {\n          iri: symbolCubeIri!,\n          componentIds: [symbolDimensionId],\n          loadValues: true,\n        },\n      ],\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n    },\n    pause: !symbolDimensionId || !symbolCubeIri,\n  });\n\n  const geoCoordinatesDimensionValues =\n    geoCoordinatesDimension?.dataCubesComponents.dimensions[0].values;\n  const coordinates = useMemo(() => {\n    return geoCoordinatesDimensionValues\n      ? dimensionValuesToGeoCoordinates(geoCoordinatesDimensionValues)\n      : undefined;\n  }, [geoCoordinatesDimensionValues]);\n  const geoShapesId = areaDimensionId || symbolDimensionId;\n  const [\n    {\n      data: fetchedGeoShapes,\n      error: geoShapesError,\n      fetching: fetchingGeoShapes,\n    },\n  ] = useDataCubeDimensionGeoShapesQuery({\n    variables: {\n      sourceType: dataSource.type,\n      sourceUrl: dataSource.url,\n      locale,\n      cubeFilter: {\n        iri: areaCubeIri!,\n        dimensionId: geoShapesId,\n      },\n    },\n    pause: !geoShapesId || !areaCubeIri,\n  });\n\n  const shapes = fetchedGeoShapes?.dataCubeDimensionGeoShapes;\n  const geometries: any[] | undefined = (\n    shapes?.topology?.objects?.shapes as any\n  )?.geometries;\n\n  const ready = shouldRenderMap({\n    areaDimensionId,\n    symbolDimensionId,\n    geometries,\n    coordinates,\n  });\n  const error = geoCoordinatesDimensionError || geoShapesError;\n  const fetching = fetchingGeoCoordinatesDimension || fetchingGeoShapes;\n\n  const displayNoDataError =\n    ready &&\n    (areaDimensionId === \"\" ||\n      (areaDimensionId !== \"\" && geometries?.length === 0)) &&\n    (symbolDimensionId === \"\" ||\n      (symbolDimensionId !== \"\" &&\n        geometries?.length === 0 &&\n        coordinates?.length === 0)) &&\n    areaDimensionId !== symbolDimensionId;\n\n  return displayNoDataError ? (\n    <NoGeometriesHint />\n  ) : (\n    <ChartDataWrapper\n      {...props}\n      error={error}\n      fetching={fetching}\n      Component={ChartMap}\n      ComponentProps={{ shapes, coordinates }}\n    />\n  );\n};\n\nexport type ChartMapProps = ChartProps<MapConfig> & {\n  shapes: GeoShapes | undefined;\n  coordinates: GeoCoordinates | undefined;\n};\n\nconst ChartMap = memo((props: ChartMapProps) => {\n  const { chartConfig, dimensions, measures, observations } = props;\n  const { fields } = chartConfig;\n  const filters = useChartConfigFilters(chartConfig);\n  const temporalFilterValue = useDefinitiveTemporalFilterValue({ dimensions });\n  const limits = useLimits({\n    chartConfig,\n    dimensions,\n    measures,\n  });\n\n  return (\n    <MapChart {...props}>\n      <ChartContainer>\n        <MapComponent\n          limits={limits}\n          customLayers={chartConfig.baseLayer.customLayers}\n          value={temporalFilterValue ? +temporalFilterValue : undefined}\n        />\n        <MapTooltip />\n      </ChartContainer>\n      <ChartControlsContainer sx={{ mt: 6 }}>\n        {fields.animation && (\n          <TimeSlider\n            filters={filters}\n            dimensions={dimensions}\n            {...fields.animation}\n          />\n        )}\n        <Box\n          sx={{\n            display: \"flex\",\n            flexDirection: \"row\",\n            gap: 4,\n            flexWrap: \"wrap\",\n          }}\n        >\n          <MapLegend\n            chartConfig={chartConfig}\n            observations={observations}\n            limits={limits.limits}\n          />\n          <MapCustomLayersLegend\n            chartConfig={chartConfig}\n            value={temporalFilterValue ? +temporalFilterValue : undefined}\n          />\n        </Box>\n      </ChartControlsContainer>\n    </MapChart>\n  );\n});\n","import { useMemo } from \"react\";\n\nimport { useDimensionFormatters } from \"@/formatters\";\n\nimport { BaseChartProps } from \"./chart-props\";\n\nexport const useChartFormatters = (\n  chartProps: Pick<BaseChartProps, \"dimensions\" | \"measures\">\n) => {\n  const { dimensions, measures } = chartProps;\n  const components = useMemo(\n    () => [...dimensions, ...measures],\n    [dimensions, measures]\n  );\n\n  return useDimensionFormatters(components);\n};\n","import { Box, Button, sliderClasses, Typography } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport clsx from \"clsx\";\nimport orderBy from \"lodash/orderBy\";\nimport {\n  ChangeEvent,\n  createContext,\n  useContext,\n  useEffect,\n  useMemo,\n} from \"react\";\nimport { useSyncExternalStore } from \"use-sync-external-store/shim\";\n\nimport { ChartState, useChartState } from \"@/charts/shared/chart-state\";\nimport { TableChartState } from \"@/charts/table/table-state\";\nimport { Slider as GenericSlider } from \"@/components/form\";\nimport { AnimationField, Filters, SortingField } from \"@/config-types\";\nimport { parseDate } from \"@/configurator/components/ui-helpers\";\nimport { hasChartConfigs } from \"@/configurator/configurator-state\";\nimport {\n  Dimension,\n  isTemporalDimension,\n  isTemporalEntityDimension,\n  isTemporalOrdinalDimension,\n} from \"@/domain/data\";\nimport { truthy } from \"@/domain/types\";\nimport { useTimeFormatUnit } from \"@/formatters\";\nimport { Icon } from \"@/icons\";\nimport { useConfiguratorState } from \"@/src\";\nimport { useChartInteractiveFilters } from \"@/stores/interactive-filters\";\nimport { Timeline, TimelineProps } from \"@/utils/observables\";\nimport {\n  getSortingOrders,\n  makeDimensionValueSorters,\n} from \"@/utils/sorting-values\";\nimport { useEvent } from \"@/utils/use-event\";\nimport { DISABLE_SCREENSHOT_ATTR } from \"@/utils/use-screenshot\";\n\nconst TimelineContext = createContext<Timeline | undefined>(undefined);\n\nconst useTimeline = () => {\n  const timeline = useContext(TimelineContext);\n\n  if (!timeline) {\n    throw Error(\n      \"useTimeline must be called inside a TimelineContext.Provider!\"\n    );\n  }\n\n  useSyncExternalStore(timeline.subscribe, timeline.getUpdateKey);\n\n  return timeline;\n};\n\ntype TimeSliderProps = {\n  filters: Filters;\n  dimensions: Dimension[];\n} & AnimationField;\n\nexport const TimeSlider = (props: TimeSliderProps) => {\n  const {\n    componentId,\n    showPlayButton,\n    type: animationType,\n    duration: animationDuration,\n    filters,\n    dimensions,\n  } = props;\n\n  const [state] = useConfiguratorState(hasChartConfigs);\n  const dimension = useMemo(() => {\n    return dimensions.find((d) => d.id === componentId);\n  }, [componentId, dimensions]);\n  const temporal = isTemporalDimension(dimension);\n  const temporalEntity = isTemporalEntityDimension(dimension);\n  const temporalOrdinal = isTemporalOrdinalDimension(dimension);\n\n  if (!(temporal || temporalEntity || temporalOrdinal)) {\n    throw Error(\"You can only use TimeSlider with temporal dimensions!\");\n  }\n\n  const timeFormatUnit = useTimeFormatUnit();\n  const timeUnit = \"timeUnit\" in dimension ? dimension.timeUnit : undefined;\n\n  // No TimeSlider for tables.\n  const chartState = useChartState() as NonNullable<\n    Exclude<ChartState, TableChartState>\n  >;\n  const dimensionFilter = filters[dimension.id];\n  const timelineProps: TimelineProps = useMemo(() => {\n    const commonProps = {\n      animationType,\n      msDuration: animationDuration * 1000,\n    };\n    const uniqueValues = Array.from(\n      new Set(\n        chartState.allData\n          .map((d) => d[dimension.id])\n          .filter(truthy) as string[]\n      )\n    );\n\n    if (temporal) {\n      const msValues = uniqueValues.map((d) => parseDate(d).getTime());\n      const formatValue = (d: number) => timeFormatUnit(new Date(d), timeUnit!);\n\n      return {\n        type: \"interval\",\n        msValues,\n        formatValue,\n        ...commonProps,\n      };\n    } else {\n      const sorting: NonNullable<SortingField[\"sorting\"]> = {\n        sortingType: \"byAuto\",\n        sortingOrder: \"asc\",\n      };\n      const sorters = makeDimensionValueSorters(dimension, {\n        dimensionFilter,\n        sorting,\n      });\n      const sortingOrders = getSortingOrders(sorters, sorting);\n      const sortedData = orderBy(uniqueValues, sorters, sortingOrders);\n\n      return {\n        type: \"ordinal\",\n        sortedData,\n        ...commonProps,\n      };\n    }\n  }, [\n    animationType,\n    animationDuration,\n    chartState.allData,\n    temporal,\n    dimension,\n    timeFormatUnit,\n    timeUnit,\n    dimensionFilter,\n  ]);\n\n  const timeline = useMemo(() => {\n    return new Timeline(timelineProps);\n  }, [timelineProps]);\n\n  if (state.dashboardFilters?.timeRange.active) {\n    return null;\n  }\n\n  return (\n    <TimelineContext.Provider value={timeline}>\n      <Root showPlayButton={showPlayButton} />\n    </TimelineContext.Provider>\n  );\n};\n\nconst Root = ({ showPlayButton }: { showPlayButton: boolean }) => {\n  const timeline = useTimeline();\n  const [min, max] = timeline.formattedExtent;\n\n  return (\n    <Box\n      {...DISABLE_SCREENSHOT_ATTR}\n      sx={{\n        display: \"flex\",\n        alignItems: \"center\",\n        gap: 5,\n        mb: 5,\n        mr: 2.5,\n      }}\n    >\n      {showPlayButton && <PlayButton />}\n      <div style={{ position: \"relative\", width: \"100%\" }}>\n        <Slider />\n        <Typography\n          variant=\"caption\"\n          sx={{ position: \"absolute\", left: 0, mt: 2 }}\n        >\n          {min}\n        </Typography>\n        <Typography\n          variant=\"caption\"\n          sx={{ position: \"absolute\", right: 0, mt: 2 }}\n        >\n          {max}\n        </Typography>\n      </div>\n    </Box>\n  );\n};\n\nconst PlayButton = () => {\n  const timeline = useTimeline();\n\n  const onClick = useEvent(() => {\n    timeline.playing ? timeline.stop() : timeline.start();\n  });\n\n  return (\n    <Button\n      onClick={onClick}\n      variant=\"outlined\"\n      style={{\n        minHeight: 32,\n        minWidth: 32,\n        padding: 0,\n        borderRadius: \"50%\",\n      }}\n    >\n      <Icon name={timeline.playing ? \"pause\" : \"play\"} size={16} />\n    </Button>\n  );\n};\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    width: \"100%\",\n\n    [`& .${sliderClasses.root}`]: {\n      height: \"6px\",\n\n      [`& .${sliderClasses.thumb}`]: {\n        width: \"16px\",\n        height: \"16px\",\n      },\n    },\n  },\n\n  playing: {\n    [`& .${sliderClasses.thumb}`]: {\n      transition: \"none\",\n    },\n\n    [`& .${sliderClasses.track}`]: {\n      transition: \"none\",\n    },\n  },\n}));\n\nconst Slider = () => {\n  const timeline = useTimeline();\n  const timeSlider = useChartInteractiveFilters((d) => d.timeSlider);\n  const setTimeSlider = useChartInteractiveFilters((d) => d.setTimeSlider);\n  const classes = useStyles();\n\n  const marks = useMemo(() => {\n    return timeline.domain.map((d) => ({ value: d })) ?? [];\n  }, [timeline.domain]);\n\n  const onChange = useEvent((e: ChangeEvent<HTMLInputElement>) => {\n    timeline.setProgress(+e.target.value);\n  });\n\n  const onClick = useEvent(() => {\n    timeline.stop();\n  });\n\n  useEffect(() => {\n    if (timeline.type !== timeSlider.type) {\n      setTimeSlider({\n        type: timeline.type,\n        value: undefined,\n      });\n    }\n\n    if (\n      timeline.type === \"interval\" &&\n      timeSlider.type === \"interval\" &&\n      timeSlider.value?.getTime() !== timeline.value\n    ) {\n      setTimeSlider({\n        type: \"interval\",\n        value: new Date(timeline.value),\n      });\n    }\n\n    if (\n      timeline.type === \"ordinal\" &&\n      timeSlider.type === \"ordinal\" &&\n      timeSlider?.value !== timeline.value\n    ) {\n      setTimeSlider({\n        type: \"ordinal\",\n        value: timeline.value as string,\n      });\n    }\n  }, [\n    timeline.value,\n    timeline.type,\n    timeSlider.type,\n    timeSlider.value,\n    setTimeSlider,\n  ]);\n\n  return (\n    <GenericSlider\n      name=\"time-slider\"\n      renderTextInput={false}\n      min={0}\n      max={1}\n      step={null}\n      marks={marks}\n      value={timeline.progress}\n      onChange={onChange}\n      onClick={onClick}\n      valueLabelDisplay=\"on\"\n      valueLabelFormat={timeline.formattedValue}\n      className={clsx(classes.root, timeline.playing && classes.playing)}\n    />\n  );\n};\n"],"names":["BASE_VIEW_STATE","minZoom","maxZoom","latitude","longitude","zoom","width","height","getViewStateFromBounds","_ref","bbox","padding","fitted","viewport","WebMercatorViewport","_objectSpread","fitBounds","useViewState","props","lockedBBox","featuresBBox","lockedViewState","useMemo","defaultViewState","viewState","setViewState","useState","onViewStateChange","useEvent","_ref2","oldViewState","useEffect","getBBox","shapes","symbols","shapesBbox","symbolsBbox","_shapesBbox","geoBounds","flat","some","isNaN","visiblePoints","filter","d","undefined","properties","observation","length","minLng","maxLng","extent","coordinates","minLat","maxLat","Math","min","max","prepareFeatureCollection","_ref3","dimensionId","topology","filters","observations","activeFiltersIris","type","value","Object","keys","values","featureCollection","feature","objects","features","includes","iri","forEach","f","find","o","label","DeckGLOverlay","overlay","useControl","MapboxOverlay","setProps","shouldRenderMap","_ref4","areaDimensionId","symbolDimensionId","geometries","areaLayerPresent","symbolLayerPresent","CustomAttribution","attribution","mapRef","useMap","theme","useTheme","map","current","control","maplibregl","customAttribution","palette","error","main","addControl","removeControl","DashedScatterplotLayer","ScatterplotLayer","getShaders","shaders","inject","replaceStringTokens","s","tokens","cur","src","dest","entries","replace","mapLayers","style","layerIterator","layers","x","MAPTILER_STYLE_KEY","BASE_VECTOR_TILE_URL","greyStyle","greyStyleBase","sources","mapValues","v","url","hasUrl","prototype","hasOwnProperty","call","glyphs","sprite","emptyStyle","version","name","metadata","id","paint","getBaseLayerStyle","locale","showLabels","languageTag","textOpacity","textLayersVisibility","layer","layout","merge","visibility","useMapStyle","showBaseLayer","MapTooltipStateContext","createContext","useMapTooltip","ctx","useContext","Error","MapTooltipProvider","children","state","dispatch","_jsx","Provider","isTooltipValueValid","MapTooltip","hoverObjectType","interaction","useInteraction","identicalLayerComponentIds","areaLayer","symbolLayer","useChartState","formatNumber","useFormatNumber","getFormattedError","formatSymbolError","formatters","useChartFormatters","dimensions","colors","component","truthy","measures","measureDimension","areaTooltipState","getValue","show","color","rgbArrayToHex","getColor","textColor","getTooltipTextColor","formatNumberWithUnit","unit","componentId","symbolTooltipState","preparedColors","sameAsValue","rawValue","formattedError","showAreaColorTooltip","showSymbolMeasureTooltip","showSymbolColorTooltip","_Fragment","mouse","TooltipBox","y","placement","margins","bottom","left","right","top","_jsxs","Box","sx","minWidth","Typography","variant","fontWeight","getLabel","display","mt","gridTemplateColumns","gap","alignItems","TooltipRow","title","background","border","borderRadius","textAlign","px","hcl","l","maplibreglRaw","supported","useStyles","makeStyles","controlButtons","zIndex","position","flexDirection","controlButton","justifyContent","minHeight","borderColor","divider","borderBottom","grey","backgroundColor","borderTopRightRadius","borderTopLeftRadius","borderBottomColor","borderBottomRightRadius","borderBottomLeftRadius","resizeAndFit","debounce","resize","duration","MapComponent","limits","customLayers","classes","useLocale","wmsEndpoints","wmtsEndpoints","wmsCustomLayers","getWMSCustomLayers","wmtsCustomLayers","getWMTSCustomLayers","uniq","endpoint","DEFAULT_WMS_URL","DEFAULT_WMTS_URL","data","groupedLayers","useWMTSorWMSLayers","byKey","layersByKey","wms","wmts","Array","from","Set","getLayerKey","join","behindAreaCustomLayers","afterAreaCustomLayers","getDeckGLLayerBefore","customLayer","beforeId","getWMSTile","wmsLayer","getWMTSTile","wmtsLayer","isBehindAreaLayer","dispatchInteraction","setMapTooltipType","locked","bounds","lockedRef","useRef","reset","newViewState","center","RESET_DURATION","essential","getMap","flyTo","zoomIn","FLY_TO_DURATION","zoomOut","mapStyle","onHover","object","visible","sortedShapes","sortedFeatures","orderBy","geoArea","geoJsonLayer","getFillColor","DEFAULT_COLOR","GeoJsonLayer","pickable","parameters","depthTest","extruded","filled","stroked","lineWidthMinPixels","getLineColor","updateTriggers","hoverLayer","shape","scatterplotLayers","getPosition","_ref5","getRadius","_ref6","radiusScale","radiusMinPixels","radiusMaxPixels","range","points","sortedData","autoHighlight","radiusUnits","_ref7","limit","i","configLimit","measureLimit","rgba","hexToRgba","baseLayerProps","r","g","b","mkGetLimitRadius","_ref8","dataLoaded","redrawMap","getBounds","toArray","handleResize","e","originalEvent","loaded","setLoaded","className","DISABLE_SCREENSHOT_ATTR","ControlButton","iconName","onClick","Map","initialViewState","mapLib","preserveDrawingBuffer","dragPan","scrollZoom","doubleClickZoom","dragRotate","touchZoomRotate","onData","dataType","isSourceLoaded","onIdle","onRemove","setMap","onLoad","target","onMove","onResize","attributionControl","interleaved","_ref9","Button","Icon","size","constrainSize","maxWidth","maxHeight","aspectRatio","round","MapCustomLayersLegend","chartConfig","legendsData","useLegendsData","baseLayer","message","remoteLayer","configLayer","dataUrl","layerValue","getWMTSLayerValue","availableDimensionValues","defaultDimensionValue","swidth","sheight","description","InfoIconTooltip","fontSize","typography","caption","dangerouslySetInnerHTML","__html","NextImage","alt","InlineLoading","cachedLegendImages","fetchLegendImage","legendUrl","blob","fetch","then","res","bmp","createImageBitmap","close","URL","createObjectURL","fetchLegendImageFromCache","cached","legendImage","configLayers","wmsLayerConfigs","wmtsLayerConfigs","customLayersError","wmsLayers","wmtsLayers","legendsError","useFetchData","queryKey","queryFn","Promise","all","options","pause","MARGIN","useLegendWidth","useSize","makeAxis","axisLabelFontSize","fontFamily","labelColor","scale","thresholds","axisBottom","tickValues","tickSizeInner","tickFormat","select","remove","selectAll","attr","MapLegend","showAreaLegend","interpolationType","measureDimensions","useDimensionFormatters","areaColorUnit","symbolUnit","symbolColorUnit","Flex","flexWrap","marginLeft","ContinuousColorLegend","paletteId","domain","valueFormatter","QuantizeColorLegend","colorScale","QuantileColorLegend","JenksColorLegend","measureLabel","CircleLegend","limitUnit","LimitLegend","maxValue","minValue","MapLegendColor","useAbbreviations","Circle","fill","stroke","radius","maxRadius","showLine","dashed","cy","transform","cx","strokeDasharray","fillOpacity","x1","y1","x2","y2","dy","textAnchor","paintOrder","strokeWidth","useChartTheme","dataDomain","maybeValue","domainObservations","decimals","minRadius","getRotatedAxisLabelHeight","w","getTextWidth","a","AXIS_TICK_ROTATE_ANGLE","PI","abs","sin","h","cos","getMaxRotatedAxisLabelHeight","useLegendWithRotatedAxisLabelsHeight","HEIGHT","legendAxisRef","useFormatInteger","thresholdsScale","scaleLinear","splice","DataPointIndicator","c","ref","COLOR_RAMP_HEIGHT","quantiles","classesScale","ColorRamp","colorInterpolator","getColorInterpolator","nSteps","rx","useDataPointIndicatorStyles","root","transition","transitions","shorter","_ref10","NaN","useMapStateVariables","chartProps","fields","baseVariables","useBaseVariables","areaLayerDimension","isGeoShapesDimension","symbolLayerDimension","isGeoDimension","getSymbol","getSymbolLabel","useDimensionWithAbbreviations","field","useMapStateData","variables","useChartConfigFilters","plottableData","usePlottableData","useChartData","timeRangeDimensionId","chartData","isGeoCoordinatesDimension","coordsByLabel","keyBy","coords","push","geoCentroid","useMapState","scalesData","allData","areaLayerState","useLayerState","measureId","areaColors","useColors","preparedAreaLayerState","symbolLayerState","symbolColors","scaleSqrt","unknown","baseScale","wrappedScale","assign","preparedSymbolLayerState","filterFeatureCollection","p","chartType","chartWidth","chartHeight","getNumericalColorScale","interpolator","getFittingColorInterpolator","scaleType","scaleSequential","nbClass","_","ckMeansThresholds","ckmeans","pop","scaleThreshold","scaleQuantile","scaleQuantize","useFixedColors","colorSpec","colorToRgbArray","opacity","useCategoricalColors","valuesByLabel","valuesByAbbreviationOrLabel","alternateName","rgbColorMapping","colorMapping","getDimensionValue","abbreviationOrLabel","useNumericalColors","useCallback","Number","getFormattedYUncertainty","useNumericalYErrorVariables","fixedColors","categoricalColors","numericalColors","usePreparedData","geoDimensionId","dimension","hierarchyLabels","useStringVariable","useOptionalNumericVariable","showYUncertainty","preparedData","fc","predicate","MapChartProvider","_objectWithoutProperties","_excluded","ChartContext","MapChart","rest","_excluded2","InteractionProvider","ChartMapVisualization","dataSource","componentIds","componentsQuery","useDataCubesComponentsQuery","sourceType","sourceUrl","cubeFilters","cubes","cube","joinBy","loadValues","keepPreviousData","getLayerIds","layerComponent","cubeIri","dataCubesComponents","isJoinById","getResolvedJoinById","areaCubeIri","symbolCubeIri","geoCoordinatesDimension","geoCoordinatesDimensionError","fetching","fetchingGeoCoordinatesDimension","geoCoordinatesDimensionValues","dimensionValuesToGeoCoordinates","geoShapesId","fetchedGeoShapes","geoShapesError","fetchingGeoShapes","useDataCubeDimensionGeoShapesQuery","cubeFilter","dataCubeDimensionGeoShapes","displayNoDataError","NoGeometriesHint","ChartDataWrapper","Component","ChartMap","ComponentProps","memo","temporalFilterValue","useDefinitiveTemporalFilterValue","useLimits","ChartContainer","ChartControlsContainer","animation","TimeSlider","components","TimelineContext","useTimeline","timeline","useSyncExternalStore","subscribe","getUpdateKey","showPlayButton","animationType","animationDuration","useConfiguratorState","hasChartConfigs","temporal","isTemporalDimension","temporalEntity","isTemporalEntityDimension","temporalOrdinal","isTemporalOrdinalDimension","timeFormatUnit","useTimeFormatUnit","timeUnit","chartState","dimensionFilter","timelineProps","commonProps","msDuration","uniqueValues","msValues","parseDate","getTime","formatValue","Date","sorting","sortingType","sortingOrder","sorters","makeDimensionValueSorters","sortingOrders","getSortingOrders","Timeline","dashboardFilters","timeRange","active","Root","formattedExtent","mb","mr","PlayButton","Slider","playing","stop","start","sliderClasses","thumb","track","timeSlider","useChartInteractiveFilters","setTimeSlider","marks","onChange","setProgress","GenericSlider","renderTextInput","step","progress","valueLabelDisplay","valueLabelFormat","formattedValue","clsx"],"sourceRoot":""}