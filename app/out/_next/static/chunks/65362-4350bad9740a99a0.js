(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65362],{77379:function(e,t,r){"use strict";r.d(t,{k:function(){return P}});var n=r(17043),i=r(58144),o=r(18170),s=r(56571),a=r(58009),l=r(79778),c=r(27979),d=r(60090),u=r(40499),p=r(27378),m=r(87026),f=r(97091),h=r(60227),g=r(97358),b=r(24246);let y=e=>{let{component:t,tooltipProps:r,linkToMetadataPanel:n}=e;return n?(0,b.jsx)(g.K,{component:t,children:(0,b.jsx)(v,{component:t})}):t.description?(0,b.jsx)(h.E,{title:t.description,tooltipProps:r,children:(0,b.jsx)("div",{children:(0,b.jsx)(v,{component:t})})}):(0,b.jsx)(v,{component:t})},v=e=>{let{component:t}=e,r=(0,f.zY)(t);return(0,b.jsx)(m.Z,{variant:"h6",component:"span",color:"monochrome.500",textTransform:"uppercase",children:r})};var j=r(17899),x=r(64103),C=r(94257),O=r(41494),w=r(81160),I=r(83691);function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let P=e=>{let{title:t,dimensions:r,measures:m,observations:f,linkToMetadataPanel:h}=e,{0:g,1:v}=(0,p.useState)(),{0:P,1:k}=(0,p.useState)(),_=(0,p.useMemo)(()=>(0,C.M)([...r,...m]),[r,m]),T=(0,O.sz)(_),D=(0,p.useMemo)(()=>{if(!g||!f)return f;let e="asc"===P?d.Z:u.Z,t=(0,I.J)(g.values,e=>e.label),r=(0,x.cW)(g)||g.isNumerical?e=>+e:e=>t.get(e)?.position??e;return[...f].sort((t,n)=>e(r(t[g.id]),r(n[g.id])))},[f,g,P]),Z=(0,p.useRef)(null),E=(0,p.useMemo)(()=>({PopperProps:{container:Z.current}}),[]),M=(0,p.useCallback)(e=>{g?.id===e.id?k("asc"===P?"desc":"asc"):(v(e),k("asc"))},[g,P]);return(0,b.jsx)("div",{ref:Z,style:{width:"100%"},children:(0,b.jsxs)(i.Z,{children:[(0,b.jsx)("caption",{style:{display:"none"},children:t}),(0,b.jsx)(o.Z,{sx:{position:"sticky",top:0},children:(0,b.jsx)(s.Z,{children:_.map(e=>(0,b.jsx)(a.Z,{component:"th",role:"columnheader",onClick:()=>M(e),sx:{textAlign:(0,x.cW)(e)?"right":"left",whiteSpace:"nowrap"},children:(0,b.jsx)(l.Z,{active:!g||g.id===e.id,direction:g?P:"desc",IconComponent:w.Z,sx:{"&:hover > svg":function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},g?{}:{transform:"translateY(-15%)"})},children:(0,b.jsx)(y,{component:e,tooltipProps:E,linkToMetadataPanel:h})})},e.id))})}),(0,b.jsx)(c.Z,{children:D?D.map((e,t)=>(0,b.jsx)(s.Z,{children:_.map(t=>{let r=(0,x.cW)(t),n=T[t.id],i=e[t.id];return(0,b.jsx)(a.Z,{component:"td",sx:{textAlign:r?"right":"left"},children:n(r&&i?+i:i)},t.id)})},t)):(0,b.jsx)(j.gb,{})})]})})}},68717:function(e,t,r){"use strict";r.d(t,{_:function(){return M}});var n=r(17043),i=r(96338),o=r(87026),s=r(90089),a=r(62033),l=r(60116),c=r(64986),d=r(40624),u=r(95099),p=r.n(u),m=r(79894),f=r.n(m),h=r(86677),g=r(29795),b=r(27378),y=r(41494),v=r(24246);let j=e=>{let{date:t}=e,r=(0,y.e8)(),n=(0,b.useMemo)(()=>r(t),[r,t]);return(0,v.jsx)(v.Fragment,{children:n})};var x=r(53082),C=r(60227),O=r(10096),w=r(79171),I=r(45298),S=r(77142);let P=["dataCube","highlightedTitle","highlightedDescription","showTags","disableTitleLink","showDimensions","onClickTitle"];function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let T=e=>{let{dataCube:{iri:t,publicationStatus:r,title:n,description:c,themes:u,datePublished:m,creator:b,dimensions:y},highlightedTitle:k,highlightedDescription:T,showTags:Z=!0,disableTitleLink:E,showDimensions:M,onClickTitle:A}=e,L=(0,s.Z)(e,P),F=r===I.sl.Draft,N=(0,h.useRouter)(),R=D(),G=(0,S.z)(e=>{if(A?.(e,t),e.defaultPrevented)return;let r={previous:JSON.stringify((0,g._o)(N.query)),dataset:t};N.push({pathname:"/browse",query:r},void 0,{shallow:!0,scroll:!1})});return(0,v.jsxs)(O.df,_(_(_({elevation:1},O.s5),L),{},{className:(0,d.Z)(R.root,L.className),children:[(0,v.jsxs)(a.Z,{spacing:2,children:[(0,v.jsxs)(x.k,{justifyContent:"space-between",width:"100%",minHeight:24,children:[(0,v.jsx)(o.Z,{variant:"body2",color:"monochrome.500",children:m&&(0,v.jsx)(j,{date:m})}),F?(0,v.jsx)(w.V,{type:"draft",children:(0,v.jsx)(i.cC,{id:"dataset.tag.draft"})}):null]}),(0,v.jsx)(o.Z,{className:E?void 0:R.titleClickable,fontWeight:700,onClick:E?void 0:G,children:k?(0,v.jsx)(l.Z,{className:R.textWrapper,component:"span",fontWeight:k===n?700:400,dangerouslySetInnerHTML:{__html:k}}):n}),(0,v.jsx)(o.Z,{className:R.description,variant:"body2",title:c??"",children:T?(0,v.jsx)(l.Z,{className:R.textWrapper,component:"span",dangerouslySetInnerHTML:{__html:T}}):c})]}),(0,v.jsxs)(x.k,{sx:{flexWrap:"wrap",gap:2},children:[u&&Z?p()(u,e=>e.label).map(e=>e.iri&&e.label&&(0,v.jsx)(f(),{href:`/browse/theme/${encodeURIComponent(e.iri)}`,passHref:!0,legacyBehavior:!0,scroll:!1,children:(0,v.jsx)(w.V,{type:"theme",children:e.label})},e.iri)):null,b?.label?(0,v.jsx)(f(),{href:`/browse/organization/${encodeURIComponent(b.iri)}`,passHref:!0,legacyBehavior:!0,scroll:!1,children:(0,v.jsx)(w.V,{type:"organization",children:b.label})},b.iri):null,M&&y?.length!==void 0&&y.length>0&&(0,v.jsx)(v.Fragment,{children:p()(y,e=>e.label).map(e=>(0,v.jsx)(C.E,{title:e.termsets.length>0?(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(o.Z,{variant:"caption",children:[(0,v.jsx)(i.cC,{id:"dataset-result.dimension-joined-by"}),(0,v.jsx)(a.Z,{flexDirection:"row",gap:1,mt:1,children:e.termsets.map(e=>(0,v.jsx)(w.V,{type:"termset",style:{flexShrink:0},children:e.label},e.iri))})]})}):null,children:(0,v.jsx)(w.V,{style:{cursor:"default"},type:"dimension",children:e.label})},e.id))})]})]}))},D=(0,c.Z)(e=>({root:{position:"relative",display:"flex",flexDirection:"column",gap:e.spacing(4),padding:`${e.spacing(8)} 0`,borderTop:`1px solid ${e.palette.monochrome[400]}`,borderRadius:0,textAlign:"left",boxShadow:"none"},textWrapper:{"& > b":{fontWeight:700}},titleClickable:{display:"inline-block",cursor:"pointer",transition:"color 0.2s ease","&:hover":{color:e.palette.primary.main}},description:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:2,WebkitBoxOrient:"vertical"}}));var Z=r(17899);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let M=e=>{let{fetching:t,error:r,cubes:s,datasetResultProps:a}=e;return t?(0,v.jsx)(Z.gb,{}):r?(0,v.jsx)(Z.OD,{message:r.message}):0===s.length?(0,v.jsx)(o.Z,{variant:"h2",sx:{mt:8,color:"grey.600",textAlign:"center"},children:(0,v.jsx)(i.cC,{id:"No results"})}):(0,v.jsx)("div",{children:s.map(e=>{let{cube:t,highlightedTitle:r,highlightedDescription:i}=e;return(0,v.jsx)(T,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({dataCube:t,highlightedTitle:r,highlightedDescription:i},a?.({cube:t})),t.iri)})})}},28002:function(e,t,r){"use strict";r.d(t,{C:function(){return s}});var n=r(96338),i=r(87026),o=r(24246);let s=()=>(0,o.jsx)(i.Z,{variant:"h6",component:"span",color:"monochrome.500",children:(0,o.jsx)(n.cC,{id:"datatable.showing.first.rows"})})},35957:function(e,t,r){"use strict";r.d(t,{l:function(){return s}});var n=r(19914),i=r(99990),o=r(24246);let s=e=>{let{checked:t,onChange:r}=e;return(0,o.jsx)(i.XZ,{label:n.ag._({id:"dataset.includeDrafts"}),name:"dataset-include-drafts",value:"dataset-include-drafts",checked:t,onChange:()=>r(!t)})}},30583:function(e,t,r){"use strict";r.d(t,{G:function(){return s}});var n=r(96338),i=r(87026),o=r(24246);let s=e=>{let{cubes:t}=e;return(0,o.jsx)(i.Z,{variant:"h5",component:"p","aria-live":"polite","data-testid":"search-results-count",children:t.length>0&&(0,o.jsx)(n.cC,{id:"dataset.results",values:{0:t.length}})})}},75202:function(e,t,r){"use strict";r.d(t,{n:function(){return u}});var n=r(96338),i=r(19914),o=r(87026),s=r(27378),a=r(53082),l=r(99990),c=r(45298),d=r(24246);let u=e=>{let{value:t,onChange:r,disableScore:u}=e,p=(0,s.useMemo)(()=>{let e=[{value:c.SearchCubeResultOrder.Score,label:i.ag._({id:"dataset.order.relevance"})},{value:c.SearchCubeResultOrder.TitleAsc,label:i.ag._({id:"dataset.order.title"})},{value:c.SearchCubeResultOrder.CreatedDesc,label:i.ag._({id:"dataset.order.newest"})}];return u?e.filter(e=>e.value!==c.SearchCubeResultOrder.Score):e},[u]);return(0,d.jsxs)(a.k,{alignItems:"center",children:[(0,d.jsx)("label",{htmlFor:"datasetSort",children:(0,d.jsx)(o.Z,{variant:"body3",children:(0,d.jsx)(n.cC,{id:"dataset.sortby"})})}),(0,d.jsx)(l.Ph,{id:"datasetSort","data-testId":"datasetSort",variant:"standard",size:"sm",onChange:e=>{r(e.target.value)},value:t,options:p,sort:!1,sx:{width:"fit-content"}})]})}},30503:function(e,t,r){"use strict";r.d(t,{c:function(){return e0}});var n=r(17043),i=r(96338),o=r(94873),s=r(60116),a=r(12548),l=r(7818),c=r(87026),d=r(64986),u=r(73681),p=r(95099),m=r.n(p),f=r(31091),h=r.n(f),g=r(88038),b=r.n(g),y=r(79894),v=r.n(y),j=r(86677),x=r(27378),C=r(53156),O=r(29795),w=r(38676),I=r.n(w),S=r(67258),P=r(49148),k=r(13109),_=r(21426),T=r(77142);function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let E=e=>{let{datasetIri:t,dataSource:r}=e,n=(0,P.bU)(),i=(0,j.useRouter)(),o=(0,x.useRef)(!1),s=(0,T.z)(async()=>{let{url:e}=r;if(!o.current&&t&&!Array.isArray(t)){o.current=!0;let r=(0,S.U)({endpointUrl:e,cubeIri:t}),n=new(I())({endpointUrl:r}),s=await (0,k.F)(n,t);if(!s)return i.replace({pathname:"/",query:(0,_.F)("CANNOT_FIND_CUBE",Z(Z({},i.query),{},{iri:t,endpointUrl:r}))});if(t!==s)return i.replace({pathname:"/browse",query:Z(Z({},i.query),i.query.iri?{iri:s}:{dataset:s})})}});(0,x.useEffect)(()=>{if("sparql"!==r.type){console.error(`Cannot redirect to unversioned IRI if dataSource.type !== "sparql", here it's ${r.type}`);return}i.isReady&&s()},[i,n,r,t,s])};var M=r(2773),A=r(37470),L=r(45298),F=r(24246);let N=e=>{let{dataSource:t,datasetIri:r}=e,n=(0,P.bU)(),[i]=(0,L.QZ)({variables:{cubeFilter:{iri:r},locale:n,sourceType:t.type,sourceUrl:t.url}});return i.data?(0,F.jsx)(A.R,{cube:i.data.dataCubeMetadata,showTitle:!1,dataSource:t}):null};var R=r(77837),G=r(77379),V=r(28002),$=r(47612),U=r(94939),z=r(53082),B=r(17899),H=r(94460);let W=e=>{let{dataSetIri:t,dataSource:r,dataCubeMetadataQuery:n,odsIframe:o}=e,a=(0,$.C4)({useMarginTop:!1}),l=(0,P.bU)(),d={sourceType:r.type,sourceUrl:r.url,locale:l,cubeFilter:{iri:t}},[{data:u,fetching:p,error:m}]=n,[{data:f,fetching:h,error:g}]=(0,L.v6)({variables:d}),y=Y({descriptionPresent:!!u?.dataCubeMetadata.description,odsIframe:o});if((0,x.useEffect)(()=>{window.scrollTo({top:0})},[]),p||h)return(0,F.jsx)(z.k,{className:y.loadingWrapper,children:(0,F.jsx)(B.gb,{})});if(!(u?.dataCubeMetadata&&f?.dataCubePreview))return(0,F.jsx)(z.k,{className:y.loadingWrapper,children:(0,F.jsx)(B.OD,{message:m?.message??g?.message})});{let{dataCubeMetadata:e}=u,{dataCubePreview:t}=f;return(0,F.jsxs)(z.k,{className:y.root,children:[e.publicationStatus===H.sl.Draft&&(0,F.jsx)(s.Z,{sx:{mb:4},children:(0,F.jsx)(B.BI,{children:(0,F.jsx)(i.cC,{id:"dataset.publicationStatus.draft.warning",components:{0:(0,F.jsx)("br",{}),1:(0,F.jsx)("strong",{})}})})}),(0,F.jsxs)(z.k,{className:y.header,sx:{justifyContent:o?"end":"space-between"},children:[(0,F.jsx)(b(),{children:(0,F.jsxs)("title",{children:[e.title," - visualize.admin.ch"]},"title")}),!o&&(0,F.jsx)(c.Z,{variant:"h1",fontWeight:700,children:e.title})]}),(0,F.jsxs)(R.Z,{className:y.paper,children:[e.description&&!o&&(0,F.jsx)(c.Z,{className:y.description,variant:"body2",children:e.description}),(0,F.jsx)("div",{className:y.tableOuterWrapper,children:(0,F.jsx)(z.k,{className:y.tableInnerWrapper,children:(0,F.jsx)(G.k,{title:e.title,dimensions:t.dimensions,measures:t.measures,observations:t.observations,linkToMetadataPanel:!1})})}),(0,F.jsxs)(z.k,{className:y.footnotesWrapper,children:[(0,F.jsx)(z.k,{className:a.actions,children:o?null:(0,F.jsx)(U.H,{dataSource:r,title:e.title,filters:d.cubeFilter})}),(0,F.jsx)(V.C,{})]})]})]})}},Y=(0,d.Z)(e=>({root:{flexGrow:1,flexDirection:"column",justifyContent:"space-between"},header:{marginBottom:t=>{let{odsIframe:r}=t;return r?0:e.spacing(4)}},paper:{borderRadius:e.spacing(4),boxShadow:"none"},description:{marginBottom:e.spacing(6)},tableOuterWrapper:{width:"100%",boxShadow:e.shadows[4]},tableInnerWrapper:{flexGrow:1,width:"100%",position:"relative",overflowX:"auto",marginTop:t=>{let{descriptionPresent:r}=t;return r?e.spacing(6):0}},footnotesWrapper:{marginTop:e.spacing(4),justifyContent:"space-between"},loadingWrapper:{flexDirection:"column",justifyContent:"space-between",flexGrow:1,padding:e.spacing(5)}}));var K=r(68717),q=r(26398),X=r(35957),J=r(30583),Q=r(75202),ee=r(57064);let et=e=>{let{browseState:{inputRef:t,search:r,onSubmitSearch:n,includeDrafts:i,setIncludeDrafts:o,order:s=L.SearchCubeResultOrder.CreatedDesc,onSetOrder:a},cubes:l}=e,c=(0,T.z)(async()=>{o(!i);let e=t.current;e&&e.value.length>0&&(await (0,ee._)(200),n(e.value))});return(0,F.jsxs)(z.k,{sx:{justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,F.jsx)(J.G,{cubes:l}),(0,F.jsxs)(z.k,{sx:{alignItems:"center",gap:5},children:[(0,F.jsx)(X.l,{checked:i,onChange:c}),(0,F.jsx)(q.Z,{flexItem:!0,orientation:"vertical"}),(0,F.jsx)(Q.n,{value:s,onChange:a,disableScore:!(""!==r&&void 0!==r)})]})]})};var er=r(19914),en=r(99990);function ei(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ei(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ei(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let es=e=>{let{browseState:{inputRef:t,search:r,onSubmitSearch:n,onReset:i},searchFieldProps:o}=e,{0:s,1:a}=(0,x.useState)(!1),l=er.ag._({id:"dataset.search.label"}),c=er.ag._({id:"dataset.search.placeholder"});return(0,F.jsx)(z.k,{sx:{alignItems:"center",gap:2,pt:4},children:(0,F.jsx)(en.Um,eo(eo({inputRef:t,id:"datasetSearch",label:l,defaultValue:r??"",InputProps:{inputProps:{"data-testid":"datasetSearch"},onKeyPress:e=>{"Enter"===e.key&&t.current&&n(t.current.value)},onReset:i,onFocus:()=>a(!0)},placeholder:c},o),{},{sx:eo(eo({},o?.sx),{},{width:"100%",maxWidth:820})}),r)})};var ea=r(62033),el=r(83864),ec=r.n(el),ed=r(30537),eu=r(43605),ep=r.n(eu),em=r(98505),ef=r(91631),eh=r(71975),eg=r.n(eh),eb=r(80129),ey=r(1935);let ev=e=>{let{children:t,backgroundColor:r}=e;return(0,F.jsx)(z.k,{"data-testid":"navChip",justifyContent:"center",alignItems:"center",minWidth:32,height:24,borderRadius:9999,typography:"caption",bgcolor:r,children:t})};var ej=r(90089);let ex=["disabled","children"];function eC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eC(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eC(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ew=e=>{let{disabled:t,children:r}=e,n=(0,ej.Z)(e,ex);return t?(0,F.jsx)(F.Fragment,{children:r}):(0,F.jsx)(v(),eO(eO({},n),{},{children:r}))};var eI=r(10096),eS=r(69763);function eP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ek(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eP(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let e_=e=>{let{children:t,filters:r,next:n,count:i,active:o,level:s=1,disableLink:a,countBg:l}=e,{includeDrafts:c,search:d,setFilters:u}=(0,M.$)(),p=eT({level:s}),m=o&&1===s,{0:f,1:h}=(0,x.useMemo)(()=>{let e=(0,eb.stringify)(eg()({includeDrafts:c,search:d,topic:2!==s||a?void 0:n.iri},Boolean)),t=[...r].filter(e=>(!!a||"DataCubeAbout"!==e.__typename)&&(1!==s||e.__typename!==n.__typename));return(1===s||a)&&t.push(n),[t,`/browse/${t.map(ey.wt).join("/")}?${e}`]},[c,d,s,n,r,a]),{0:g,1:b}=(0,x.useMemo)(()=>{let e=(0,eb.stringify)(eg()({includeDrafts:c,search:d},Boolean)),t=r.filter(e=>"DataCubeAbout"!==e.__typename&&e.iri!==n.iri);return[t,`/browse/${t.map(ey.wt).join("/")}?${e}`]},[c,d,r,n.iri]);return(0,F.jsx)(eI.uH,ek(ek({},eI.xq),{},{"data-testid":"navItem",children:(0,F.jsx)(ew,{href:h,passHref:!0,legacyBehavior:!0,disabled:!!a,scroll:!1,shallow:!0,children:(0,F.jsxs)(em.Z,{className:p.root,variant:"body3",onClick:a&&!o?e=>{e.preventDefault(),u(f)}:void 0,sx:{p:2,backgroundColor:m?"cobalt.50":"transparent",color:o?1===s?"text.primary":"cobalt.50":"text.primary",cursor:o?"default":"pointer"},children:[t,m?(0,F.jsx)(ew,{href:b,passHref:!0,legacyBehavior:!0,disabled:!!a,scroll:!1,shallow:!0,children:(0,F.jsx)(ef.Z,{className:p.removeFilterButton,onClick:a?e=>{e.preventDefault(),u(g)}:void 0,children:(0,F.jsx)(eS.Z,{width:24,height:24})})}):void 0!==i?(0,F.jsx)(ev,{backgroundColor:l,children:i}):null]})})}))},eT=(0,d.Z)(e=>({root:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:e.spacing(3),width:"100%",padding:e.spacing(2),borderRadius:2,transition:"background-color 0.1s ease","&:hover":{backgroundColor:e.palette.cobalt[50]}},removeFilterButton:t=>{let{level:r}=t;return{display:"flex",alignItems:"center",width:"auto",height:"auto",minWidth:16,minHeight:16,marginRight:2,padding:0,borderRadius:2,backgroundColor:1===r?"cobalt.50":"transparent",color:1===r?e.palette.text.primary:"cobalt.50",transition:"background-color 0.1s ease","&:hover":{backgroundColor:e.palette.cobalt[100]}}}})),eD=e=>{let{label:t,backgroundColor:r}=e;return(0,F.jsx)(s.Z,{sx:{mb:2,px:2,py:3,borderRadius:"6px",backgroundColor:r},children:(0,F.jsx)(c.Z,{variant:"h4",component:"div",sx:{fontWeight:700},children:t})})};var eZ=r(79234),eE=r(48947);let eM=e=>{let{label:t,items:r,backgroundColor:n,currentFilter:o,filters:s,counts:l,extra:c,disableLinks:d}=e,{isOpen:u,open:p,close:f}=(0,eZ.q)(!!o),h=(0,x.useMemo)(()=>m()(ep()(r,e=>l[e.iri],"desc").slice(0,7),e=>e.label),[l,r]);return(0,F.jsxs)("div",{children:[(0,F.jsx)(eD,{label:t,backgroundColor:n}),(0,F.jsxs)(ed.t.Group,{axis:"y",as:"div",onReorder:()=>{},values:u?r:h,children:[(u?r:h).map(e=>(0,F.jsx)(ed.t.Item,{as:"div",value:e,children:(0,F.jsx)(e_,{active:o?.iri===e.iri,filters:s,next:e,count:l[e.iri],disableLink:d,countBg:n,children:e.label})},e.iri)),h.length!==r.length?(0,F.jsx)(a.Z,{variant:"text",color:"primary",size:"sm",onClick:u?f:p,endIcon:(0,F.jsx)(eE.JO,{name:u?"arrowUp":"arrowDown",size:20}),sx:{width:"100%",mt:2},children:u?(0,F.jsx)(i.cC,{id:"show.less"}):(0,F.jsx)(i.cC,{id:"show.all"})}):null]}),c]})};function eA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let eL=e=>{let{subthemes:t,filters:r,counts:i,disableLinks:o,countBg:s}=e;return(0,F.jsx)(F.Fragment,{children:t.map(e=>{let t=i[e.iri];return t?(0,F.jsx)(e_,{next:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eA(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eA(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({__typename:"DataCubeAbout"},e),filters:r,active:r[r.length-1]?.iri===e.iri,level:2,count:t,disableLink:o,countBg:s,children:e.label},e.iri):null})})};var eF=r(67018),eN=r(17510);let eR={DataCubeTheme:1,DataCubeOrganization:2,DataCubeTermset:3,DataCubeAbout:4},eG=e=>{let{cubes:t,themes:r,orgs:n,termsets:o,disableNavLinks:s}=e,{filters:a}=(0,M.$)(),l=(0,x.useMemo)(()=>{let e={};for(let{cube:r}of t)for(let{iri:t}of[...r.themes,...r.subthemes,...r.termsets,r.creator].filter(eN.y))t&&(e[t]=(e[t]??0)+1);return e},[t]),{themeFilter:c,organizationFilter:d,termsetFilter:p}=(0,x.useMemo)(()=>{let e=ec()(a,e=>e.__typename);return{themeFilter:e.DataCubeTheme,organizationFilter:e.DataCubeOrganization,termsetFilter:e.DataCubeTermset}},[a]),f=r.filter(e=>!!e.label&&!!l[e.iri]&&(!c||c.iri===e.iri)),g=n.filter(e=>!!e.label&&(!!l[e.iri]||d?.iri===e.iri)&&(!d||d.iri===e.iri)),b=o.filter(e=>!!e.label&&(!!l[e.iri]||p?.iri===e.iri)&&(!p||p.iri===e.iri)),y=f.length>0?(0,F.jsx)(eM,{items:f,backgroundColor:"green.100",currentFilter:c,counts:l,filters:a,label:(0,F.jsx)(i.cC,{id:"browse-panel.themes"}),disableLinks:s},"themes"):null,v=(0,x.useMemo)(()=>m()(h()(t.flatMap(e=>e.cube.subthemes),e=>e.iri),e=>e.label),[t]),j="blue.100",C=g.length>0?(0,F.jsx)(eM,{items:g,backgroundColor:j,currentFilter:d,counts:l,filters:a,label:(0,F.jsx)(i.cC,{id:"browse-panel.organizations"}),extra:d&&a.map(e=>e.iri).includes(d.iri)?(0,F.jsx)(eL,{subthemes:v,filters:a,counts:l,disableLinks:s,countBg:j}):null,disableLinks:s},"orgs"):null,O=o.length>0?(0,F.jsx)(eM,{items:b,backgroundColor:"monochrome.200",currentFilter:p,counts:l,filters:a,label:(0,F.jsxs)(ea.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",gap:2,width:"100%",children:[(0,F.jsx)(i.cC,{id:"browse-panel.termsets"}),(0,F.jsx)(eF.o,{title:(0,F.jsx)(i.cC,{id:"browse-panel.termsets.explanation"})})]}),extra:null,disableLinks:s},"termsets"):null,w=m()([{element:y,__typename:"DataCubeTheme"},{element:C,__typename:"DataCubeOrganization"},{element:O,__typename:"DataCubeTermset"}],e=>{let t=a.findIndex(t=>t.__typename===e.__typename);return -1===t?eR[e.__typename]+Object.keys(eR).length:t});return(0,F.jsx)("div",{role:"search",children:(0,F.jsx)(u.M,{children:(0,F.jsx)(z.k,{sx:{flexDirection:"column",rowGap:8,width:"100%"},children:w.map(e=>e.element)})})},a.length)};var eV=r(82395);function e$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eU(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e$(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ez=e=>{let{dataset:t,variant:r}=e,[n]=(0,eV.y)(e=>{let{height:t}=e;t&&document.documentElement.style.setProperty(eI.wG,`-${t}px`)}),s=eB(),a=(0,M.$)();return(0,F.jsx)(u.M,{children:t||"page"!==r?null:(0,F.jsx)(eI.uH,eU(eU({ref:n},eI.GR),{},{children:(0,F.jsx)("section",{className:s.outerWrapper,role:"banner",children:(0,F.jsx)(o.vs,{className:s.innerWrapper,children:(0,F.jsxs)("div",{className:s.content,children:[(0,F.jsx)(c.Z,{className:s.title,variant:"h1",children:"Swiss Open Government Data"}),(0,F.jsx)(c.Z,{className:s.description,variant:"body2",children:(0,F.jsx)(i.cC,{id:"browse.datasets.description"})}),(0,F.jsx)(es,{browseState:a})]})})})}),"banner")})},eB=(0,d.Z)(e=>({outerWrapper:{backgroundColor:e.palette.monochrome[100]},innerWrapper:{paddingTop:e.spacing(25),paddingBottom:e.spacing(25)},content:{display:"flex",flexDirection:"column",justifyContent:"center",maxWidth:940},title:{marginBottom:e.spacing(4),fontWeight:700},description:{marginBottom:e.spacing(10)}}));var eH=r(93477),eW=r(6135),eY=r(4623),eK=r(87182),eq=r(27102);let eX=e=>{try{return JSON.parse(e)}catch(e){return null}};function eJ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eQ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eJ(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eJ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let e0=e=>(0,F.jsx)(M.l,{syncWithUrl:"page"===e.variant,children:(0,F.jsx)(e1,eQ({},e))}),e1=e=>{let{datasetPreviewProps:t,datasetResultsProps:r,dataset:n,onClickBackLink:d,onCreateChartFromDataset:p,variant:f="page"}=e,g=(0,eq.bU)(),[{state:y,dataSource:w}]=(0,eq.lY)(),I=(0,M.$)(),{search:S,order:P,includeDrafts:k,filters:_,dataset:T}=I,D=n??T,Z=(0,j.useRouter)(),A=(0,O._x)(Z.query),R=e2({datasetPresent:!!D,odsIframe:A}),[G]=(0,C.Z)(S,500,{leading:!0}),V=(0,x.useCallback)(e=>{let{height:t}=e;window.parent.postMessage({type:eH.m2,height:t},"*")},[]),[$]=(0,eV.y)(V),U=(0,x.useMemo)(()=>{let e=eX(Z.query.previous);return e?(0,O.H0)(e):"/browse"},[Z.query]),B=(0,x.useMemo)(()=>_?_.filter(e=>e.__typename!==L.r4.DataCubeAbout).map(e=>({type:L.r4[e.__typename],label:e.label,value:e.iri})):[],[_]),[{data:H,fetching:Y,error:q}]=(0,L.kY)({variables:{sourceType:w.type,sourceUrl:w.url,locale:g,query:G,order:P,includeDrafts:k,filters:B},pause:!!D});E({dataSource:w,datasetIri:D});let{allCubes:X,cubes:J}=(0,x.useMemo)(()=>{if(!H||0===H.searchCubes.length)return{allCubes:[],cubes:[]};let e=_.filter(e=>"DataCubeAbout"===e.__typename);if(0===e.length)return{allCubes:H.searchCubes,cubes:H.searchCubes};let t=e.map(e=>e.iri);return{allCubes:H.searchCubes,cubes:H.searchCubes.filter(e=>e.cube.subthemes.some(e=>t.includes(e.iri)))}},[H,_]),Q=(0,x.useMemo)(()=>m()(h()(J.flatMap(e=>e.cube.themes).map(e=>eQ(eQ({},e),{},{__typename:"DataCubeTheme"})),e=>e.iri),e=>e.label),[J]),ee=(0,x.useMemo)(()=>m()(h()(J.map(e=>e.cube.creator).filter(e=>e?.iri).filter(eN.y).map(e=>eQ(eQ({},e),{},{__typename:"DataCubeOrganization"})),e=>e.iri),e=>e.label),[J]),er=(0,x.useMemo)(()=>m()(h()(J.flatMap(e=>e.cube.termsets.map(e=>eQ(eQ({},e),{},{__typename:"DataCubeTermset"}))),e=>e.iri),e=>e.label),[J]),en=(0,x.useMemo)(()=>B.map(e=>((()=>{switch(e.type){case L.r4.DataCubeTheme:return Q;case L.r4.DataCubeOrganization:return ee;case L.r4.DataCubeTermset:return er;case L.r4.DataCubeAbout:case L.r4.TemporalDimension:return[];default:return e.type}})().find(t=>{let{iri:r}=t;return r===e.value})??e).label).join(", "),[ee,B,er,Q]),ei=(0,L.QZ)({variables:{sourceType:w.type,sourceUrl:w.url,locale:g,cubeFilter:{iri:D??""}},pause:!D}),[{data:eo}]=ei;return"SELECTING_DATASET"!==y?null:(0,F.jsxs)("div",{ref:A?$:null,children:[(0,F.jsx)(ez,{dataset:D,variant:f}),(0,F.jsx)(s.Z,{sx:{borderBottom:A||"drawer"===f?"none":e=>`1px solid ${e.palette.cobalt[100]}`},children:(0,F.jsx)(o.vs,{sx:A?{maxWidth:"unset !important",px:"8px !important"}:{},children:(0,F.jsx)(u.M,{mode:"wait",children:D?(0,F.jsx)(eI.uH,{initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:A?0:2*eI.th},style:{width:"100%"},children:(0,F.jsxs)(z.k,{sx:e=>({justifyContent:A?"flex-end":"space-between",alignItems:"center",pt:A?12:"drawer"==f?10:6,pb:6,[e.breakpoints.down("md")]:{flexWrap:"wrap"}}),children:[A?null:(0,F.jsx)(v(),{href:U,passHref:!0,legacyBehavior:!0,children:(0,F.jsx)(a.Z,{variant:"outlined",size:"sm",startIcon:(0,F.jsx)(eE.JO,{name:"arrowLeft",size:20}),onClick:d,children:(0,F.jsx)(i.cC,{id:"dataset-preview.back-to-results"})})}),p?(0,F.jsx)(a.Z,{component:"a",size:"sm",target:A?"_blank":void 0,endIcon:(0,F.jsx)(eE.JO,{name:A?"legacyLinkExternal":"arrowRight",size:20}),onClick:e=>p?.(e,D),children:A?(0,F.jsx)(i.cC,{id:"browse.dataset.create-visualization-visualize"}):(0,F.jsx)(i.cC,{id:"browse.dataset.create-visualization"})}):(0,F.jsx)(v(),{href:`/create/new?cube=${eo?.dataCubeMetadata.iri}&dataSource=${(0,eK.nw)(w)}`,passHref:!0,legacyBehavior:!A,target:A?"_blank":void 0,children:(0,F.jsx)(a.Z,{size:"sm",endIcon:(0,F.jsx)(eE.JO,{name:A?"legacyLinkExternal":"arrowRight",size:20}),sx:A?{backgroundColor:"#009688","&:hover":{backgroundColor:(0,l._j)("#009688",.2)}}:null,children:A?(0,F.jsx)(i.cC,{id:"browse.dataset.create-visualization-visualize"}):(0,F.jsx)(i.cC,{id:"browse.dataset.create-visualization"})})})]})},"navigation"):null})})}),(0,F.jsx)(o.vs,{sx:A?{maxWidth:"unset !important",px:"8px !important"}:{},children:(0,F.jsxs)(eY.LN,{type:A?"M":"LM",className:R.panelLayout,children:[A?null:(0,F.jsx)(eY.V6,{type:"L",className:R.panelLeft,children:(0,F.jsx)(u.M,{mode:"wait",children:D?(0,F.jsx)(eI.uH,eQ(eQ({},eI.Vf),{},{children:(0,F.jsx)(eI.uH,eQ(eQ({},eI.s5),{},{children:(0,F.jsx)(N,{datasetIri:D,dataSource:w})}))}),"metadata"):(0,F.jsx)(eI.uH,eQ(eQ({},eI.Vf),{},{children:(0,F.jsx)(eG,{cubes:X,themes:Q,orgs:ee,termsets:er,disableNavLinks:"drawer"===f})}),"search-filters")})}),(0,F.jsx)(eY.V6,{type:"M",className:R.panelMiddle,children:(0,F.jsx)(u.M,{mode:"wait",children:D?(0,F.jsx)(eI.uH,eQ(eQ({},eI.Vf),{},{transition:eQ(eQ({},eI.Vf.transition),{},{duration:A?0:eI.Vf.transition.duration}),children:(0,F.jsx)(W,eQ({dataSetIri:D,dataSource:w,dataCubeMetadataQuery:ei,odsIframe:A},t))}),"preview"):(0,F.jsxs)(eI.uH,eQ(eQ({},eI.Vf),{},{children:[(0,F.jsxs)(u.M,{children:["drawer"===f?(0,F.jsxs)("div",{style:{marginTop:"0.125rem",marginBottom:"2rem"},children:[(0,F.jsx)(c.Z,{variant:"h2",children:(0,F.jsx)(i.cC,{id:"chart.datasets.add-dataset-drawer.title"})}),(0,F.jsx)(es,{browseState:I,searchFieldProps:{sx:{"&&":{maxWidth:"unset"}}}})]},"select-dataset"):null,B.length>0&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(b(),{children:(0,F.jsxs)("title",{children:[en," - visualize.admin.ch"]},"title")}),(0,F.jsx)(eI.uH,{initial:{transform:"translateY(-16px)",height:0,marginBottom:0,opacity:0},animate:{transform:"translateY(0px)",height:"auto",marginBottom:16,opacity:1},exit:{transform:"translateY(-16px)",height:0,marginBottom:0,opacity:0},transition:{duration:eI.th},children:(0,F.jsx)(c.Z,{className:R.filters,variant:"h1",children:en},"filters")},"query-filters")]})]}),(0,F.jsx)(et,{browseState:I,cubes:J}),(0,F.jsx)(K._,eQ({fetching:Y,error:q,cubes:J,datasetResultProps:()=>({showDimensions:!0})},r))]}),"filters")})})]})}),"page"!=f||A?null:(0,F.jsx)(s.Z,{sx:{mt:8,borderTop:"2px solid rgba(0,0,0,0.05)"},children:(0,F.jsx)(eW.$,{sx:{width:"100%",mx:"auto",borderTopWidth:0}})})]})},e2=(0,d.Z)(e=>({panelLayout:{position:"static",height:"auto",margin:"auto",marginTop:t=>{let{odsIframe:r}=t;return r?0:e.spacing(12)},backgroundColor:e.palette.background.paper,transition:"margin-top 0.5s ease"},panelLeft:{marginBottom:e.spacing(12),boxShadow:"none",outline:"none",transition:"padding-top 0.5s ease",[e.breakpoints.up("md")]:{position:e=>{let{datasetPresent:t}=e;return t?"static":"sticky"},top:t=>{let{datasetPresent:r}=t;return r?0:e.spacing(8)},overflowY:"auto",minHeight:"100vh",maxHeight:e=>{let{datasetPresent:t}=e;return t?"none":"100vh"},marginBottom:"unset",paddingBottom:t=>{let{datasetPresent:r}=t;return r?0:e.spacing(16)}}},panelMiddle:{gridColumnStart:"middle",gridColumnEnd:"right",backgroundColor:e.palette.background.paper,transition:"padding-top 0.5s ease",[e.breakpoints.up("md")]:{marginLeft:t=>{let{odsIframe:r}=t;return r?0:e.spacing(8)}}},filters:{display:"block",color:e.palette.grey[800]}}))},41143:function(e,t,r){"use strict";r.d(t,{Eg:function(){return U},Fe:function(){return M},HR:function(){return T},JE:function(){return E},K0:function(){return G},XN:function(){return z},ej:function(){return L},su:function(){return $},xi:function(){return D}});var n=r(17043),i=r(19914),o=r(23175),s=r(51894),a=r(47626),l=r(67291),c=r(99729),d=r.n(c),u=r(96498),p=r.n(u),m=r(43551),f=r.n(m),h=r(55847),g=r(44463),b=r(97091),y=r(70022),v=r(50953),j=r(25390),x=r(45365),C=r(10359),O=r(64103),w=r(41282);function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let P=(e,t)=>{let{chartConfig:r,field:n}=t,i=`fields.${n}`,o=`${i}.color.interpolationType`,s=`${i}.color.nbClass`;"continuous"===e?(p()(r,o,"linear",Object),f()(r,s)):"discrete"===e&&(p()(r,o,"jenks",Object),p()(r,s,3,Object))},k=(e,t)=>{let{chartConfig:r,dimensions:n,measures:i,field:o}=t,s=`fields["${o}"]`,a=[...n,...i],l=g.LV,c=a.find(t=>t.id===e),u=d()(r,`${s}.color.componentId`);if(c){let t=d()(r,`${s}.color.palette`);if(O.Ae.includes(c.__typename)||(0,O.vn)(c)){let r=(0,w.mq)(c,t?.paletteId);l=(0,g.NB)({id:e,paletteId:r,dimensionValues:c.values})}else(0,O.cW)(c)&&(l=(0,g.r2)({id:e,colorPalette:t}));let n=r.cubes.find(e=>e.iri===c.cubeIri);n&&f()(n,`filters["${u}"]`)}p()(r,`${s}.color`,l,Object)},_=()=>[{sortingType:"byAuto",sortingOrder:["asc","desc"]},{sortingType:"byDimensionLabel",sortingOrder:["asc","desc"]},{sortingType:"byTotalSize",sortingOrder:["asc","desc"],getDisabledState:e=>(0,v.MO)(e)?{disabled:!0,warnMessage:i.ag._({id:"controls.sorting.byTotalSize.disabled-by-animation"})}:{disabled:!1}}],T=_(),D=_(),Z=_(),E=[{sortingType:"byAuto",sortingOrder:["asc","desc"]},{sortingType:"byMeasure",sortingOrder:["asc","desc"]},{sortingType:"byDimensionLabel",sortingOrder:["asc","desc"]}],M={field:"animation",optional:!0,idAttributes:[],componentTypes:O.kz,filters:!0,hide:!0,disableInteractiveFilters:!0,onChange:(e,t)=>{let{chartConfig:r,initializing:n}=t;n||!r.fields.animation?r.fields.animation={componentId:e,showPlayButton:!0,duration:30,type:"continuous",dynamicScales:!1}:r.fields.animation.componentId=e},getDisabledState:(e,t)=>{let r=t.filter(e=>(0,O.fF)(e)||(0,O.eP)(e)||(0,O.a6)(e));if(0===r.length)return{disabled:!0,warnMessage:i.ag._({id:"controls.section.animation.no-temporal-dimensions"})};let n=Object.fromEntries(Object.entries((0,v.OS)(e)).filter(e=>"animation"!==e[0]).map(e=>{let[t,r]=e;return[r.componentId,t]})),o=r.filter(e=>n[e.id]);return r.length===o.length?{disabled:!0,warnMessage:i.ag._({id:"controls.section.animation.no-available-temporal-dimensions"},{fields:o.map(e=>(0,x.N)(n[e.id])).join(", ")})}:(0,v.CY)(e)&&e.fields.segment?.sorting?.sortingType==="byTotalSize"?{disabled:!0,warnMessage:i.ag._({id:"controls.section.animation.disabled-by-sorting"})}:{disabled:!1}}},A=(e,t)=>{let{fields:r}=e,n=(0,o.ZP)(t.filter(e=>null!=e[r.y.componentId]),e=>e[r.x.componentId]),i=Array.from(new Set(t.map(e=>(0,b.Ke)(r.segment?.componentId)(e))));return(0,b.ks)(n,i)},L=e=>e?.scaleType!=="Ratio",F=(e,t)=>{let{chartConfig:r,dimensions:n,measures:i,selectedValues:o}=t,s=[...n,...i].find(t=>t.id===e),a=(0,w.mq)(s,r.fields.color&&"paletteId"in r.fields.color?r.fields.color.paletteId:void 0),l=(0,C.t6)({paletteId:a,dimensionValues:s?s.values:o});if(r.fields.segment?(r.fields.segment.componentId=e,r.fields.segment.showValuesMapping={}):(r.fields.segment={componentId:e,sorting:h.dJ,showValuesMapping:{}},r.fields.color={type:"segment",paletteId:a,colorMapping:l}),!o.length||!s)return;let c=(0,j.bV)(o.map(e=>e.value)),d=r.cubes.find(e=>e.iri===s.cubeIri);d&&(d.filters[e]=c)},N=(e,t)=>{let{chartConfig:r,dimensions:n,measures:i,field:o}=t;(0,h.kc)({chartConfig:r,field:o,componentId:e,dimensions:n,measures:i})},R=(e,t)=>{let[r,n]=(0,s.Z)(e.map(t));return(0,a.Z)().domain([Math.min(r,0),n]).nice().domain()},G=e=>V[e.chartType],V={area:{chartType:"area",encodings:[{field:"y",idAttributes:["componentId"],optional:!1,componentTypes:["NumericalMeasure"],filters:!1,onChange:(e,t)=>{let{chartConfig:r,measures:n}=t;L(n.find(t=>t.id===e))&&delete r.fields.segment},options:{colorPalette:{type:"single",paletteId:"schemaCategory10",color:l.Z[0]},showValues:{getDisabledState:e=>({disabled:!!e.fields.segment})},adjustScaleDomain:{getDefaultDomain:e=>{let{chartConfig:t,observations:r}=e,{segment:n}=t.fields,i=e=>{let r=e[t.fields.y.componentId]??null;return(0,b.H_)(r)??0};return n?(0,y._4)(r,{normalize:"percent"===t.interactiveFiltersConfig.calculation.type,getX:e=>{let r=e[t.fields.x.componentId];return(0,b.nS)(r)},getY:i}).domain():R(r,i)}},convertUnit:{}}},{field:"x",idAttributes:["componentId"],optional:!1,componentTypes:["TemporalDimension","TemporalEntityDimension"],filters:!0},{field:"segment",optional:!0,idAttributes:["componentId"],componentTypes:O.hw,filters:!0,sorting:T,onChange:(e,t)=>{F(e,t),delete t.chartConfig.fields.y.customDomain},onDelete:e=>{let{chartConfig:t}=e;delete t.fields.y.customDomain},getDisabledState:(e,t,r)=>{let n=e.fields.y.componentId;if(L(t.find(e=>e.id===n)))return{disabled:!0,warnMessage:i.ag._({id:"controls.segment.stacked.disabled-by-scale-type"})};let o=A(e,r),s=e.fields.y.imputationType;return{disabled:!1,warnMessage:o&&(!s||"none"===s)?i.ag._({id:"controls.section.imputation.explanation"}):void 0}},options:{calculation:{},colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},imputation:{shouldShow:(e,t)=>A(e,t)},useAbbreviations:{}}}],interactiveFilters:["legend","timeRange"]},column:{chartType:"column",encodings:[{field:"y",optional:!1,idAttributes:["componentId"],componentTypes:["NumericalMeasure"],filters:!1,onChange:(e,t)=>{let{chartConfig:r,measures:n}=t;r.fields.segment?.type==="stacked"&&L(n.find(t=>t.id===e))&&(p()(r,"fields.segment.type","grouped",Object),r.interactiveFiltersConfig.calculation&&p()(r,"interactiveFiltersConfig.calculation",{active:!1,type:"identity"},Object))},options:{colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},showValues:{getDisabledState:e=>({disabled:!!e.fields.segment})},showStandardError:{},showConfidenceInterval:{},adjustScaleDomain:{getDefaultDomain:e=>{let{chartConfig:t,observations:r}=e,{segment:n}=t.fields,i=e=>{let r=e[t.fields.y.componentId]??null;return(0,b.H_)(r)??0};return n&&"stacked"===n.type?(0,y._4)(r,{normalize:"percent"===t.interactiveFiltersConfig.calculation.type,getX:e=>{let r=e[t.fields.x.componentId];return(0,b.nS)(r)},getY:i}).domain():R(r,i)}},convertUnit:{}}},{field:"x",optional:!1,idAttributes:["componentId"],componentTypes:["TemporalDimension","TemporalEntityDimension","TemporalOrdinalDimension","NominalDimension","OrdinalDimension","GeoCoordinatesDimension","GeoShapesDimension"],filters:!0,sorting:[{sortingType:"byAuto",sortingOrder:["asc","desc"]},{sortingType:"byMeasure",sortingOrder:["asc","desc"]},{sortingType:"byDimensionLabel",sortingOrder:["asc","desc"]}],onChange:(e,t)=>{let{chartConfig:r,dimensions:n}=t,i=n.find(t=>t.id===e);(0,O.fF)(i)||p()(r,"interactiveFiltersConfig.timeRange.active",!1,Object)},options:{useAbbreviations:{}}},{field:"segment",optional:!0,idAttributes:["componentId"],componentTypes:O.hw,filters:!0,sorting:D,onChange:(e,t)=>{let{chartConfig:r,dimensions:n,measures:i}=t;F(e,t),r.fields.y.showValues=!1,delete r.fields.y.customDomain;let o=[...n,...i],s=d()(r,"fields.segment"),a=o.find(e=>e.id===r.fields.y.componentId);p()(r,"fields.segment",S(S({},s),{},{type:L(a)?"grouped":"stacked"}),Object)},onDelete:e=>{let{chartConfig:t}=e;delete t.fields.y.customDomain},options:{calculation:{getDisabledState:e=>{let t=e.fields.segment?.type==="grouped";return{disabled:t,warnMessage:t?i.ag._({id:"controls.calculation.disabled-by-grouped"}):void 0}}},chartSubType:{getValues:(e,t)=>{let r=e.fields.y.componentId,n=L(t.find(e=>e.id===r));return[{value:"stacked",disabled:n,warnMessage:n?i.ag._({id:"controls.segment.stacked.disabled-by-scale-type"}):void 0},{value:"grouped",disabled:!1}]},onChange:(e,t)=>{let{chartConfig:r}=t;r.interactiveFiltersConfig&&"grouped"===e&&p()(r,"interactiveFiltersConfig.calculation",{active:!1,type:"identity"})}},colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},useAbbreviations:{}}},M],interactiveFilters:["legend","timeRange","animation"]},bar:{chartType:"bar",encodings:[{field:"x",optional:!1,idAttributes:["componentId"],componentTypes:["NumericalMeasure"],filters:!1,onChange:(e,t)=>{let{chartConfig:r,measures:n}=t;r.fields.segment?.type==="stacked"&&L(n.find(t=>t.id===e))&&(p()(r,"fields.segment.type","grouped",Object),r.interactiveFiltersConfig.calculation&&p()(r,"interactiveFiltersConfig.calculation",{active:!1,type:"identity"},Object))},options:{colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},showValues:{getDisabledState:e=>({disabled:!!e.fields.segment})},showStandardError:{},showConfidenceInterval:{},adjustScaleDomain:{getDefaultDomain:e=>{let{chartConfig:t,observations:r}=e,{segment:n}=t.fields,i=e=>{let r=e[t.fields.x.componentId]??null;return(0,b.H_)(r)??0};return n&&"stacked"===n.type?(0,y.A1)(r,{normalize:"percent"===t.interactiveFiltersConfig.calculation.type,getX:i,getY:e=>{let r=e[t.fields.y.componentId];return(0,b.nS)(r)}}).domain():R(r,i)}},convertUnit:{}}},{field:"y",optional:!1,idAttributes:["componentId"],componentTypes:["TemporalDimension","TemporalEntityDimension","TemporalOrdinalDimension","NominalDimension","OrdinalDimension","GeoCoordinatesDimension","GeoShapesDimension"],filters:!0,sorting:[{sortingType:"byAuto",sortingOrder:["asc","desc"]},{sortingType:"byMeasure",sortingOrder:["asc","desc"]},{sortingType:"byDimensionLabel",sortingOrder:["asc","desc"]}],onChange:(e,t)=>{let{chartConfig:r,dimensions:n}=t,i=n.find(t=>t.id===e);(0,O.fF)(i)||p()(r,"interactiveFiltersConfig.timeRange.active",!1,Object)},options:{useAbbreviations:{}}},{field:"segment",optional:!0,idAttributes:["componentId"],componentTypes:O.hw,filters:!0,sorting:Z,onChange:(e,t)=>{let{chartConfig:r,dimensions:n,measures:i}=t;F(e,t),r.fields.x.showValues=!1,delete r.fields.x.customDomain;let o=[...n,...i],s=d()(r,"fields.segment"),a=o.find(e=>e.id===r.fields.x.componentId);p()(r,"fields.segment",S(S({},s),{},{type:L(a)?"grouped":"stacked"}),Object)},onDelete:e=>{let{chartConfig:t}=e;delete t.fields.x.customDomain},options:{calculation:{getDisabledState:e=>{let t=e.fields.segment?.type==="grouped";return{disabled:t,warnMessage:t?i.ag._({id:"controls.calculation.disabled-by-grouped"}):void 0}}},chartSubType:{getValues:(e,t)=>{let r=e.fields.x.componentId,n=L(t.find(e=>e.id===r));return[{value:"stacked",disabled:n,warnMessage:n?i.ag._({id:"controls.segment.stacked.disabled-by-scale-type"}):void 0},{value:"grouped",disabled:!1}]},onChange:(e,t)=>{let{chartConfig:r}=t;r.interactiveFiltersConfig&&"grouped"===e&&p()(r,"interactiveFiltersConfig.calculation",{active:!1,type:"identity"})}},colorPalette:{},useAbbreviations:{}}},M],interactiveFilters:["legend","timeRange","animation"]},line:{chartType:"line",encodings:[{idAttributes:["componentId"],field:"y",optional:!1,componentTypes:["NumericalMeasure"],filters:!1,options:{colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},showValues:{getDisabledState:e=>({disabled:!!e.fields.segment})},showStandardError:{},showConfidenceInterval:{},adjustScaleDomain:{getDefaultDomain:e=>{let{chartConfig:t,observations:r}=e;return R(r,e=>{let r=e[t.fields.y.componentId]??null;return(0,b.H_)(r)??0})}},convertUnit:{},showDots:{},showDotsSize:{}}},{idAttributes:["componentId"],field:"x",optional:!1,componentTypes:["TemporalDimension","TemporalEntityDimension"],filters:!0},{idAttributes:["componentId"],field:"segment",optional:!0,componentTypes:O.hw,filters:!0,sorting:[{sortingType:"byAuto",sortingOrder:["asc","desc"]},{sortingType:"byDimensionLabel",sortingOrder:["asc","desc"]}],onChange:(e,t)=>{F(e,t),delete t.chartConfig.fields.y.customDomain},onDelete:e=>{let{chartConfig:t}=e;delete t.fields.y.customDomain},options:{colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},useAbbreviations:{}}}],interactiveFilters:["legend","timeRange"]},map:{chartType:"map",encodings:[{idAttributes:[],field:"baseLayer",optional:!0,componentTypes:[],filters:!1},{idAttributes:["componentId","color.componentId"],field:"areaLayer",optional:!0,componentTypes:["GeoShapesDimension"],exclusive:!1,filters:!0,onChange:N,options:{colorComponent:{componentTypes:["NumericalMeasure","OrdinalMeasure","TemporalOrdinalDimension"],optional:!1,enableUseAbbreviations:!0,onComponentIdChange:k,onScaleTypeChange:P},convertUnit:{}}},{idAttributes:["componentId","color.componentId"],field:"symbolLayer",optional:!0,componentTypes:["GeoCoordinatesDimension","GeoShapesDimension"],exclusive:!1,filters:!0,onChange:N,options:{colorComponent:{componentTypes:["NumericalMeasure","OrdinalMeasure","GeoCoordinatesDimension","GeoShapesDimension","NominalDimension","OrdinalDimension","TemporalOrdinalDimension"],optional:!0,enableUseAbbreviations:!0,onComponentIdChange:k,onScaleTypeChange:P},size:{componentTypes:["NumericalMeasure"],optional:!0},convertUnit:{}}},{idAttributes:[],field:"customLayers",optional:!0,componentTypes:[],filters:!1},M],interactiveFilters:["animation"]},pie:{chartType:"pie",encodings:[{idAttributes:["componentId"],field:"y",optional:!1,componentTypes:["NumericalMeasure"],filters:!1,options:{showValues:{},convertUnit:{}}},{idAttributes:["componentId"],field:"segment",optional:!1,componentTypes:O.hw,filters:!0,sorting:E,onChange:F,options:{colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},useAbbreviations:{}}},M],interactiveFilters:["legend","animation"]},scatterplot:{chartType:"scatterplot",encodings:[{idAttributes:["componentId"],field:"x",optional:!1,componentTypes:["NumericalMeasure"],filters:!1,options:{convertUnit:{}}},{idAttributes:["componentId"],field:"y",optional:!1,componentTypes:["NumericalMeasure"],filters:!1,options:{convertUnit:{}}},{idAttributes:["componentId"],field:"segment",optional:!1,componentTypes:O.hw,filters:!0,onChange:F,options:{colorPalette:{type:"single",paletteId:"category10",color:l.Z[0]},useAbbreviations:{}}},M],interactiveFilters:["legend","animation"]},table:{chartType:"table",encodings:[],interactiveFilters:[]},comboLineSingle:{chartType:"comboLineSingle",encodings:[{idAttributes:["componentIds"],field:"y",optional:!1,customComponent:!0,componentTypes:["NumericalMeasure"],filters:!1,options:{componentIds:{onChange:(e,t)=>{let{chartConfig:r}=t,{fields:n}=r,{color:i}=n,o=(0,w.XN)({paletteId:i.paletteId}),s=Object.fromEntries(e.map((e,t)=>[e,i.colorMapping[t]??o[t]]));r.fields.color.colorMapping=s}},convertUnit:{}}},{idAttributes:["componentId"],field:"x",optional:!1,componentTypes:["TemporalDimension","TemporalEntityDimension"],filters:!0}],interactiveFilters:[]},comboLineDual:{chartType:"comboLineDual",encodings:[{field:"y",idAttributes:["leftAxisComponentId","rightAxisComponentId"],optional:!1,customComponent:!0,componentTypes:["NumericalMeasure"],filters:!1,options:{leftAxisComponentId:{onChange:(e,t)=>{let{chartConfig:r}=t,{fields:n}=r,{y:i,color:o}=n;r.fields.color.colorMapping={[e]:o.colorMapping[i.leftAxisComponentId],[i.rightAxisComponentId]:o.colorMapping[i.rightAxisComponentId]}}},rightAxisComponentId:{onChange:(e,t)=>{let{chartConfig:r}=t,{fields:n}=r,{y:i,color:o}=n;r.fields.color.colorMapping={[i.leftAxisComponentId]:o.colorMapping[i.leftAxisComponentId],[e]:o.colorMapping[i.rightAxisComponentId]}}},convertUnit:{}}},{idAttributes:["componentId"],field:"x",optional:!1,componentTypes:["TemporalDimension","TemporalEntityDimension"],filters:!0}],interactiveFilters:[]},comboLineColumn:{chartType:"comboLineColumn",encodings:[{field:"y",optional:!1,customComponent:!0,idAttributes:["lineComponentId","columnComponentId"],componentTypes:["NumericalMeasure"],filters:!1,options:{lineComponentId:{onChange:(e,t)=>{let{chartConfig:r}=t,{fields:n}=r,{y:i,color:o}=n,s=o.colorMapping[i.lineComponentId],a=o.colorMapping[i.columnComponentId];r.fields.color.colorMapping="left"===i.lineAxisOrientation?{[e]:s,[i.columnComponentId]:a}:{[i.columnComponentId]:a,[e]:s}}},columnComponentId:{onChange:(e,t)=>{let{chartConfig:r}=t,{fields:n}=r,{y:i,color:o}=n,s=o.colorMapping[i.columnComponentId],a=o.colorMapping[i.lineComponentId];r.fields.color.colorMapping="left"===i.lineAxisOrientation?{[i.lineComponentId]:a,[e]:s}:{[e]:s,[i.lineComponentId]:a}}},lineAxisOrientation:{onChange:(e,t)=>{let{chartConfig:r}=t,{fields:n}=r,{y:i,color:o}=n,s="left"===i.lineAxisOrientation,a=s?i.columnComponentId:i.lineComponentId,l=s?i.lineComponentId:i.columnComponentId;r.fields.color.colorMapping={[a]:o.colorMapping[l],[l]:o.colorMapping[a]}}},convertUnit:{}}},{field:"x",idAttributes:["componentId"],optional:!1,componentTypes:["TemporalDimension","TemporalEntityDimension"],filters:!0}],interactiveFilters:[]}},$=(e,t)=>{let r=G(e).encodings.find(e=>e.field===t);return r?.onChange},U=(e,t)=>{let r=G(e).encodings.find(e=>e.field===t);return r?.onDelete},z=(e,t,r)=>{let n=G(e).encodings.find(e=>e.field===t);switch(`${t}.${r}`){case"segment.type":return d()(n,"options.chartSubType.onChange");case"areaLayer.color.componentId":case"symbolLayer.color.componentId":return d()(n,"options.colorComponent.onComponentIdChange");case"areaLayer.color.scaleType":case"symbolLayer.color.scaleType":return d()(n,"options.colorComponent.onScaleTypeChange");case"y.componentIds":return d()(n,"options.componentIds.onChange");case"y.lineAxisOrientation":return d()(n,"options.lineAxisOrientation.onChange");case"y.leftAxisComponentId":return d()(n,"options.leftAxisComponentId.onChange");case"y.rightAxisComponentId":return d()(n,"options.rightAxisComponentId.onChange");case"y.lineComponentId":return d()(n,"options.lineComponentId.onChange");case"y.columnComponentId":return d()(n,"options.columnComponentId.onChange")}}},55847:function(e,t,r){"use strict";r.d(t,{Jj:function(){return eg},Jo:function(){return eb},L$:function(){return eC},LZ:function(){return eh},Q7:function(){return W},W_:function(){return z},dJ:function(){return q},iv:function(){return ey},jT:function(){return en},kc:function(){return Q},ru:function(){return ef},zh:function(){return ei}});var n=r(90089),i=r(17043),o=r(19914),s=r(60090),a=r(23175),l=r(40499),c=r(28907),d=r(99729),u=r.n(d),p=r(25389),m=r.n(p),f=r(95099),h=r.n(f),g=r(41143),b=r(44463),y=r(50953),v=r(10359),j=r(77167),x=r(64103),C=r(17510),O=r(41282),w=r(90453),I=r(43107),S=r(17674),P=r(59823),k=r(4352),_=r(83513);let T=["interactiveFiltersConfig"],D=["symbolType"],Z=["symbolType"],E=["symbolType"],M=["symbolType"],A=["symbolType"],L=["symbolType"],F=["symbolType"],N=["symbolType"],R=["symbolType"],G=["symbolType"];function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let U=["column","bar","line","area","scatterplot","pie","table","map","comboLineSingle","comboLineDual","comboLineColumn"],z=["column","bar","line","area","scatterplot","pie","table","map"],B=["comboLineDual","comboLineColumn"],H=["comboLineSingle"],W=[...H,...B],Y=(e,t)=>{let r=t?.map(t=>e.find(e=>e.__typename===t&&e.isKeyDimension)).filter(C.y)[0]??e.find(e=>e.isKeyDimension)??e[0];if(!r)throw Error("No dimension found for initial config");return r},K=e=>{let{timeRangeComponentId:t=""}=e??{};return{legend:{active:!1,componentId:""},timeRange:{active:!1,componentId:t,presets:{type:"range",from:"",to:""}},dataFilters:{active:!1,componentIds:[],defaultValueOverrides:{},filterTypes:{},defaultOpen:!0},calculation:{active:!1,type:"identity"}}},q={sortingType:"byAuto",sortingOrder:"asc"},X=e=>{let t=[],r=!1;return(0,I.B)(e?.hierarchy,e=>{if((0,k.s)(e)){if(r)return I.B.IGNORE;r=!0}(!e.children||0===e.children.length)&&e.hasValue&&t.push(e)}),t},J=e=>{let t={};if(e?.hierarchy){let r=X(e);r.length>0&&(t[e.id]={type:"multi",values:Object.fromEntries(r.map(e=>[e.value,!0]))})}return t},Q=e=>{let{chartConfig:t,field:r,componentId:n,dimensions:i,measures:o}=e;"areaLayer"===r?t.fields.areaLayer=ee({component:i.filter(x.sS).find(e=>e.id===n),measure:o[0]}):"symbolLayer"===r&&(t.fields.symbolLayer=et({component:i.filter(x.C_).find(e=>e.id===n),measure:o.find(x.cW)}))},ee=e=>{let{component:t,measure:r}=e,n=(0,O.mq)(r);return{componentId:t.id,color:(0,x.cW)(r)?(0,b.r2)({id:r.id}):(0,b.NB)({id:r.id,paletteId:n,dimensionValues:r.values})}},et=e=>{let{component:t,measure:r}=e;return{componentId:t.id,measureId:r?.id??j.P,color:b.LV}},er={title:{en:"",de:"",fr:"",it:""},description:{en:"",de:"",fr:"",it:""},label:{en:"",de:"",fr:"",it:""}},en=e=>{let{key:t,iris:r,chartType:n,dimensions:i,measures:o,meta:c}=e,d=e=>({key:t??(0,P.M)(),version:S.e,meta:c??er,cubes:r.map(t=>{let{iri:r,joinBy:n}=t;return n?{iri:r,filters:e??{},joinBy:n}:{iri:r,filters:e??{}}}),interactiveFiltersConfig:K(),annotations:[],limits:{},conversionUnitsByComponentId:{},activeField:void 0}),u=o.filter(x.cW),p=i.filter(e=>(0,x.fF)(e)||(0,x.eP)(e));switch(n){case"area":let m=p[0].id;return $($({},d()),{},{chartType:n,interactiveFiltersConfig:K({timeRangeComponentId:m}),fields:{x:{componentId:m},y:{componentId:u[0].id,imputationType:"none"},color:{type:"single",paletteId:O.h$,color:w.r.palette.primary.main}}});case"column":let f=Y(h()(i,e=>(0,x.C_)(e)?1:-1),["TemporalDimension","TemporalEntityDimension","TemporalOrdinalDimension"]).id;return $($({},d()),{},{chartType:n,interactiveFiltersConfig:K({timeRangeComponentId:f}),fields:{x:{componentId:f,sorting:q},y:{componentId:u[0].id},color:{type:"single",paletteId:O.h$,color:w.r.palette.primary.main}}});case"bar":let g=Y(h()(i,e=>(0,x.C_)(e)?1:-1),["TemporalDimension","TemporalEntityDimension","TemporalOrdinalDimension"]).id;return $($({},d()),{},{chartType:n,interactiveFiltersConfig:K({timeRangeComponentId:g}),fields:{x:{componentId:u[0].id},y:{componentId:g,sorting:q},color:{type:"single",paletteId:O.h$,color:w.r.palette.primary.main}}});case"line":let b=p[0].id;return $($({},d()),{},{chartType:n,interactiveFiltersConfig:K({timeRangeComponentId:b}),fields:{x:{componentId:b},y:{componentId:u[0].id},color:{type:"single",paletteId:O.h$,color:w.r.palette.primary.main}}});case"map":let y=(0,x.VD)(i),j=y.filter(x.sS),C=j[0],I=j.length>0;return $($({},d(J(C))),{},{chartType:n,baseLayer:{show:!0,locked:!1,bbox:void 0,customLayers:[]},fields:$($({},I?{areaLayer:ee({component:C,measure:o[0]})}:{}),I?{}:{symbolLayer:et({component:y[0],measure:u[0]})})});case"pie":let k=(0,x.Ru)(i)[0]??(0,x.VD)(i)[0],T=(0,O.mq)(k);return $($({},d()),{},{chartType:n,fields:{y:{componentId:u[0].id},segment:{componentId:k.id,sorting:{sortingType:"byMeasure",sortingOrder:"asc"},showValuesMapping:{}},color:{type:"segment",paletteId:T,colorMapping:(0,v.t6)({paletteId:T,dimensionValues:k.values})}}});case"scatterplot":let D=(0,x.Ru)(i)[0]||(0,x.VD)(i)[0],Z=(0,O.mq)(D);return $($({},d()),{},{chartType:"scatterplot",fields:$({x:{componentId:u[0].id},y:{componentId:u.length>1?u[1].id:u[0].id}},D?{color:{type:"segment",paletteId:Z,colorMapping:(0,v.t6)({paletteId:Z,dimensionValues:D.values})},segment:{componentId:D.id,showValuesMapping:{}}}:{color:{type:"single",paletteId:O.h$,color:w.r.palette.primary.main}})});case"table":let E=[...i,...o].sort((e,t)=>(0,s.Z)(e.order??1/0,t.order??1/0));return $($({},d()),{},{chartType:n,settings:{showSearch:!0,showAllRows:!1},links:{enabled:!1,baseUrl:"",componentId:"",targetComponentId:""},sorting:[],fields:Object.fromEntries(E.map((e,t)=>[e.id,{componentId:e.id,componentType:e.__typename,index:t,isGroup:!1,isHidden:!1,columnStyle:{textStyle:"regular",type:"text",textColor:w.r.palette.monochrome[600],columnColor:"#fff"}}]))});case"comboLineSingle":{let e=(0,a.Q3)(u.filter(e=>e.unit),e=>e.length,e=>e.unit).sort((e,t)=>(0,l.Z)(e[1],t[1]))[0][0],t=u.filter(t=>t.unit===e).map(e=>e.id);return $($({},d()),{},{chartType:"comboLineSingle",interactiveFiltersConfig:K({timeRangeComponentId:p[0].id}),fields:{x:{componentId:p[0].id},y:{componentIds:t},color:{type:"measures",paletteId:O.h$,colorMapping:(0,v.t6)({paletteId:O.h$,dimensionValues:t.map(e=>({value:e,label:e}))})}}})}case"comboLineDual":{let[e,t]=Array.from(new Set(u.filter(e=>e.unit).map(e=>e.unit))),r=u.find(t=>t.unit===e).id,n=u.find(e=>e.unit===t).id;return $($({},d()),{},{chartType:"comboLineDual",interactiveFiltersConfig:K({timeRangeComponentId:p[0].id}),fields:{x:{componentId:p[0].id},y:{leftAxisComponentId:r,rightAxisComponentId:n},color:{type:"measures",paletteId:O.h$,colorMapping:(0,v.t6)({paletteId:O.h$,dimensionValues:[r,n].map(e=>({value:e,label:e}))})}}})}case"comboLineColumn":{let[e,t]=Array.from(new Set(u.filter(e=>e.unit).map(e=>e.unit))),r=u.find(t=>t.unit===e).id,n=u.find(e=>e.unit===t).id;return $($({},d()),{},{chartType:"comboLineColumn",interactiveFiltersConfig:K({timeRangeComponentId:p[0].id}),fields:{x:{componentId:p[0].id},y:{lineComponentId:r,lineAxisOrientation:"right",columnComponentId:n},color:{type:"measures",paletteId:O.h$,colorMapping:(0,v.t6)({paletteId:O.h$,dimensionValues:[r,n].map(e=>({value:e,label:e}))})}}})}default:throw(0,_.o)(n)}},ei=e=>{let{chartConfig:t,newChartType:r,dimensions:i,measures:o,isAddingNewCube:s}=e,a=t.chartType,l=en({key:t.key,chartType:r,iris:t.cubes.map(e=>{let{iri:t}=e;return{iri:t}}),dimensions:i,measures:o,meta:t.meta}),{interactiveFiltersConfig:c}=t;return eo({path:"",field:$($({},(0,n.Z)(t,T)),{},{interactiveFiltersConfig:c}),adjusters:ea[r],pathOverrides:el[r][a],oldChartConfig:t,newChartConfig:l,dimensions:i,measures:o,isAddingNewCube:s})},eo=e=>{let{path:t,field:r,adjusters:n,pathOverrides:i,oldChartConfig:o,newChartConfig:s,dimensions:a,measures:l,isAddingNewCube:c}=e,d=(e,t)=>{if("object"!=typeof t||Array.isArray(t))return!0;switch(e){case"fields":return"table"===o.chartType&&(0,y.I3)(s);case"filters":case"fields.color":case"fields.segment":case"fields.animation":case"interactiveFiltersConfig.calculation":case"interactiveFiltersConfig.dataFilters":case"interactiveFiltersConfig.legend":case"limits":case"conversionUnitsByComponentId":return!0;default:return!1}},p=e=>{let{path:t,field:r}=e;for(let[e,m]of Object.entries(r)){let r=""===t?e:`${t}.${e}`;if(void 0!==m){let e=i?.[r];if(d(r,m)||e){if(e)for(let t of e){let e=u()(n,t.path);e&&(s=e({oldValue:t.oldValue?t.oldValue(m):m,newChartConfig:s,oldChartConfig:o,dimensions:a,measures:l,isAddingNewCube:c}))}else{let e=u()(n,r);e&&(s=e({oldValue:m,newChartConfig:s,oldChartConfig:o,dimensions:a,measures:l,isAddingNewCube:c}))}}else p({path:r,field:m})}}return s};return p({path:t,field:r})},es={legend:e=>{let{oldValue:t,oldChartConfig:r,newChartConfig:n}=e;return void 0!==r.fields.segment?(0,c.ZP)(n,e=>{e.interactiveFiltersConfig.legend=t}):n},timeRange:{active:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.interactiveFiltersConfig.timeRange.active=t})},componentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.interactiveFiltersConfig.timeRange.componentId=t})},presets:{type:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.interactiveFiltersConfig.timeRange.presets.type=t})},from:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.interactiveFiltersConfig.timeRange.presets.from=t})},to:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.interactiveFiltersConfig.timeRange.presets.to=t})}}},dataFilters:e=>{let{oldValue:t,newChartConfig:r,oldChartConfig:n}=e;return(0,c.ZP)(r,e=>{let r=t.componentIds??[];if("table"===n.chartType){e.interactiveFiltersConfig.dataFilters={active:!1,componentIds:[],defaultValueOverrides:{},defaultOpen:!0,filterTypes:{}};return}if(r.length>0){let n=Object.values(e.fields).map(e=>e.componentId),i=r.filter(e=>!n.includes(e)),o=$({},t.defaultValueOverrides);r.filter(e=>!i.includes(e)).forEach(e=>{delete o[e]}),e.interactiveFiltersConfig.dataFilters.active=i.length>0,e.interactiveFiltersConfig.dataFilters.componentIds=i,e.interactiveFiltersConfig.dataFilters.defaultValueOverrides=o}else e.interactiveFiltersConfig.dataFilters=t})},calculation:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{(0,y.Ch)(r)?e.interactiveFiltersConfig.calculation=t:e.interactiveFiltersConfig.calculation={active:!1,type:"identity"}})}},ea={column:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,D)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>e.id===t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r}},y:{componentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.componentId=t})},showValues:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.showValues=t})},customDomain:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.customDomain=t})}},color:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{"segment"!==t.type&&(e.fields.color=ev({oldColorField:t}))})},segment:e=>{let t,r,{oldValue:n,oldChartConfig:i,newChartConfig:o,dimensions:s,measures:a}=e,l=a.find(e=>e.id===o.fields.y.componentId);if("table"===i.chartType){let e=ex({fields:n,dimensions:s,measures:a});e&&(t=$($({},e.segment),{},{sorting:q,type:(0,g.ej)(l)?"grouped":"stacked",showValuesMapping:{}}),r=e.color)}else if(o.fields.x.componentId!==n.componentId){let e=(0,y.GK)(i)?i.fields.color:void 0,o=s.find(e=>e.id===n.componentId);t=$($({},n),{},{showValuesMapping:n.showValuesMapping??{},sorting:ec({segment:n,acceptedValues:g.xi.map(e=>e.sortingType),defaultValue:"byTotalSize"}),type:(0,g.ej)(l)?"grouped":"stacked"}),r=ej({oldColorField:e,segmentDimension:o})}return(0,c.ZP)(o,e=>{t&&r?.type==="segment"&&(e.fields.segment=t,e.fields.color=r)})},animation:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{r.fields.x.componentId!==t?.componentId&&(e.fields.animation=t)})}},interactiveFiltersConfig:es},bar:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,Z)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,measures:n}=e;return n.find(e=>e.id===t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r},showValues:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.x.showValues=t})},customDomain:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.x.customDomain=t})}},y:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>e.id===t)?(0,c.ZP)(r,e=>{e.fields.y.componentId=t}):r}},color:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{"segment"!==t.type&&(e.fields.color=ev({oldColorField:t}))})},segment:e=>{let t,r,{oldValue:n,oldChartConfig:i,newChartConfig:o,dimensions:s,measures:a}=e,l=a.find(e=>e.id===o.fields.x.componentId);if("table"===i.chartType){let e=ex({fields:n,dimensions:s,measures:a});e&&(t=$($({},e.segment),{},{sorting:q,type:(0,g.ej)(l)?"grouped":"stacked"}),r=e.color)}else if(o.fields.y.componentId!==n.componentId){let e=(0,y.GK)(i)?i.fields.color:void 0,o=s.find(e=>e.id===n.componentId);t=$($({},n),{},{sorting:ec({segment:n,acceptedValues:g.xi.map(e=>e.sortingType),defaultValue:"byTotalSize"}),type:(0,g.ej)(l)?"grouped":"stacked"}),r=ej({oldColorField:e,segmentDimension:o})}return(0,c.ZP)(o,e=>{t&&r?.type==="segment"&&(e.fields.segment=t,e.fields.color=r)})},animation:e=>{let{oldValue:t,newChartConfig:r}=e;return"bar"!==r.chartType?(0,c.ZP)(r,e=>{r.fields.x.componentId!==t?.componentId&&(e.fields.animation=t)}):(0,c.ZP)(r,e=>{r.fields.y.componentId!==t?.componentId&&(e.fields.animation=t)})}},interactiveFiltersConfig:es},line:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t="circle"}=e;return $($({},(0,n.Z)(e,E)),{},{symbolType:t})}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>(0,x.fF)(e)&&e.id===t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r}},y:{componentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.componentId=t})},showValues:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.showValues=t})},customDomain:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.customDomain=t})}},color:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{"segment"!==t.type&&(e.fields.color=ev({oldColorField:t}))})},segment:e=>{let t,r,{oldValue:n,oldChartConfig:i,newChartConfig:o,dimensions:s,measures:a}=e;if("table"===i.chartType){let e=ex({fields:n,dimensions:s,measures:a});e&&(t=e.segment,r=e.color)}else{let e=(0,y.GK)(i)?i.fields.color:void 0,o=s.find(e=>e.id===n.componentId);(0,x.fF)(o)||(t={componentId:n.componentId,sorting:"sorting"in n&&n.sorting&&"sortingOrder"in n.sorting?n.sorting??b.LV:q,showValuesMapping:n.showValuesMapping},r=ej({oldColorField:e,segmentDimension:o}))}return(0,c.ZP)(o,e=>{t&&r?.type==="segment"&&(e.fields.segment=t,e.fields.color=r)})}},interactiveFiltersConfig:es},area:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t="circle"}=e;return $($({},(0,n.Z)(e,M)),{},{symbolType:t})}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>(0,x.fF)(e)&&e.id===t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r}},y:{componentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.componentId=t})},showValues:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.showValues=t})},customDomain:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.customDomain=t})}},color:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{"segment"!==t.type&&(e.fields.color=ev({oldColorField:t}))})},segment:e=>{let t,r,{oldValue:n,oldChartConfig:i,newChartConfig:o,dimensions:s,measures:a}=e,l=a.find(e=>e.id===o.fields.y.componentId);if((0,g.ej)(l))return(0,c.ZP)(o,e=>{delete e.fields.segment});if("table"===i.chartType){let e=ex({fields:n,dimensions:s,measures:a});e&&(t=$($({},e.segment),{},{sorting:q}),r=e.color)}else{let e=(0,y.GK)(i)?i.fields.color:void 0,o=s.find(e=>e.id===n.componentId);(0,x.fF)(o)||(t={componentId:n.componentId,sorting:ec({segment:n,acceptedValues:g.HR.map(e=>e.sortingType),defaultValue:"byTotalSize"}),showValuesMapping:n.showValuesMapping},r=ej({oldColorField:e,segmentDimension:o}))}return(0,c.ZP)(o,e=>{t&&r?.type==="segment"&&(e.fields.segment=t,e.fields.color=r)})}},interactiveFiltersConfig:es},scatterplot:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,A)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,measures:n}=e,i=n.filter(x.cW);return i.length>1&&i.map(e=>e.id).includes(t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r}},y:{componentId:e=>{let{oldValue:t,newChartConfig:r,measures:n}=e,i=n.filter(x.cW);if(i.length>1){if(i.map(e=>e.id).includes(t)&&r.fields.x.componentId!==t)return(0,c.ZP)(r,e=>{e.fields.y.componentId=t});{let e=i.find(e=>e.id!==r.fields.x.componentId);if(e)return(0,c.ZP)(r,t=>{t.fields.y.componentId=e.id})}}return r}},color:e=>{let{oldValue:t,oldChartConfig:r,newChartConfig:n,dimensions:i}=e;return(0,c.ZP)(n,e=>{if("single"===t.type){let t=(0,y.GK)(r)?r.fields.color:void 0,o=i.find(e=>e.id===n.fields.segment?.componentId);e.fields.color=ej({oldColorField:t,segmentDimension:o})}})},segment:e=>{let t,r,{oldValue:n,oldChartConfig:i,newChartConfig:o,dimensions:s,measures:a}=e,l=(0,y.GK)(i)?i.fields.color:void 0,d=s.find(e=>e.id===n.componentId);if("table"===i.chartType){let e=ex({fields:n,dimensions:s,measures:a});e&&(t=e.segment,r=e.color)}else t={componentId:n.componentId,showValuesMapping:n.showValuesMapping},r=ej({oldColorField:l,segmentDimension:d});return(0,c.ZP)(o,e=>{t&&r?.type==="segment"&&(e.fields.segment=t,e.fields.color=r)})},animation:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.animation=t})}},interactiveFiltersConfig:es},pie:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,L)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{y:{componentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.componentId=t})},showValues:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.y.showValues=t})}},color:e=>{let{oldValue:t,oldChartConfig:r,newChartConfig:n,dimensions:i}=e;return(0,c.ZP)(n,e=>{if("single"===t.type){let t=(0,y.GK)(r)?r.fields.color:void 0,o=i.find(e=>e.id===n.fields.segment.componentId);e.fields.color=ej({oldColorField:t,segmentDimension:o})}})},segment:e=>{let t,r,{oldValue:n,oldChartConfig:i,newChartConfig:o,dimensions:s,measures:a}=e;if("table"===i.chartType){let e=ex({fields:n,dimensions:s,measures:a});e&&(t=$($({},e.segment),{},{sorting:q}),r=e.color)}else{let e=(0,y.GK)(i)?i.fields.color:void 0,o=s.find(e=>e.id===n.componentId);t={componentId:n.componentId,sorting:ec({segment:n,acceptedValues:g.JE.map(e=>e.sortingType),defaultValue:"byMeasure"}),showValuesMapping:n.showValuesMapping},r=ej({oldColorField:e,segmentDimension:o})}return(0,c.ZP)(o,e=>{t&&r?.type==="segment"&&(e.fields.segment=t,e.fields.color=r)})},animation:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.animation=t})}},interactiveFiltersConfig:es},table:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t.map(e=>$($({},e),{},{filters:Object.fromEntries(Object.entries(e.filters).filter(e=>{let[t,r]=e;return"range"!==r.type}))}))})},fields:e=>{let{oldValue:t,newChartConfig:r}=e;for(let e of Object.keys(r.fields))if(e===t.componentId)return(0,c.ZP)(r,t=>{t.fields[e].isGroup=!0});return r}},map:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{for(let r of t){let t=e.cubes.find(e=>e.iri===r.iri);for(let[e,n]of Object.entries(r.filters))void 0===t.filters[e]&&(t.filters[e]=n);void 0!==r.joinBy&&(t.joinBy=r.joinBy)}})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,F)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{areaLayer:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>"GeoShapesDimension"===e.__typename&&e.id===t)?(0,c.ZP)(r,e=>{e.fields.areaLayer&&(e.fields.areaLayer.componentId=t)}):r},color:{componentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.areaLayer&&(e.fields.areaLayer.color.componentId=t),e.fields.symbolLayer&&(e.fields.symbolLayer.measureId=t)})}}},animation:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.fields.animation=t})}},interactiveFiltersConfig:es},comboLineSingle:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,N)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>(0,x.fF)(e)&&e.id===t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r}},y:{componentIds:e=>{let{oldValue:t,newChartConfig:r,oldChartConfig:n,measures:i}=e,o=i.filter(e=>(0,x.cW)(e)&&e.unit),{unit:s}=o.find(e=>e.id===t)??o[0],a=o.filter(e=>e.unit===s).map(e=>e.id),l=(0,y.GK)(n)?n.fields.color.paletteId??O.h$:O.h$;return(0,c.ZP)(r,e=>{e.fields.y={componentIds:a},e.fields.color={type:"measures",paletteId:l,colorMapping:(0,v.t6)({paletteId:l,dimensionValues:a.map(e=>({value:e,label:e}))})}})}}},interactiveFiltersConfig:es},comboLineDual:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,R)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>(0,x.fF)(e)&&e.id===t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r}},y:e=>{let t,{newChartConfig:r,oldChartConfig:n,measures:i,isAddingNewCube:o}=e,s=i.filter(x.cW),a=s.map(e=>e.id),l=s.find(e=>e.id===a[0]),d=e=>{let r=s.find(t=>t.id===e);if(!o)return r;{let e=s.find(e=>e.id===t);return s.find(t=>t.cubeIri!==e?.cubeIri&&t.unit!==e?.unit)??r}};switch(n.chartType){case"comboLineColumn":{let{lineComponentId:e,lineAxisOrientation:r,columnComponentId:i}=n.fields.y;t="left"===r?i:e,l=d("left"===r?e:i);break}case"comboLineSingle":l=d(n.fields.y.componentIds[0]);break;case"area":case"column":case"line":case"pie":case"scatterplot":l=d(n.fields.y.componentId);break;case"map":{let{areaLayer:e,symbolLayer:t}=n.fields,r=e?.color.componentId??t?.measureId;r&&(l=d(r));break}case"bar":l=d(n.fields.x.componentId);break;case"comboLineDual":case"table":break;default:return n}t=s.find(e=>t?e.id===t:e.unit!==l.unit).id,l=d(l.id);let u=(0,y.GK)(n)?n.fields.color.paletteId??O.h$:O.h$;return(0,c.ZP)(r,e=>{e.fields.y={leftAxisComponentId:l.id,rightAxisComponentId:t},e.fields.color={type:"measures",paletteId:u,colorMapping:(0,v.t6)({paletteId:u,dimensionValues:[l.id,t].map(e=>({value:e,label:e}))})}})}},interactiveFiltersConfig:es},comboLineColumn:{cubes:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.cubes=t})},annotations:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.annotations=t})},limits:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.limits=m()(t,e=>e.map(e=>{let{symbolType:t}=e;return(0,n.Z)(e,G)}))})},conversionUnitsByComponentId:e=>{let{oldValue:t,newChartConfig:r}=e;return(0,c.ZP)(r,e=>{e.conversionUnitsByComponentId=t})},fields:{x:{componentId:e=>{let{oldValue:t,newChartConfig:r,dimensions:n}=e;return n.find(e=>(0,x.fF)(e)&&e.id===t)?(0,c.ZP)(r,e=>{e.fields.x.componentId=t}):r}},y:e=>{let t,{newChartConfig:r,oldChartConfig:n,measures:i}=e,o=i.filter(x.cW),s=o.map(e=>e.id),a=o.find(e=>e.id===s[0]),l=e=>o.find(t=>t.id===e);switch(n.chartType){case"comboLineDual":a=l(n.fields.y.leftAxisComponentId),t=n.fields.y.rightAxisComponentId;break;case"comboLineSingle":a=l(n.fields.y.componentIds[0]);break;case"area":case"column":case"line":case"pie":case"scatterplot":a=l(n.fields.y.componentId);break;case"map":{let{areaLayer:e,symbolLayer:t}=n.fields,r=e?.color.componentId??t?.measureId;r&&(a=l(r));break}case"bar":a=l(n.fields.x.componentId);break;case"comboLineColumn":case"table":break;default:return n}let d=o.find(e=>t?e.id===t:e.unit!==a.unit).id,u=(0,y.GK)(n)?n.fields.color.paletteId??O.h$:O.h$;return(0,c.ZP)(r,e=>{e.fields.y={columnComponentId:a.id,lineComponentId:d,lineAxisOrientation:"right"},e.fields.color={type:"measures",paletteId:u,colorMapping:(0,v.t6)({paletteId:u,dimensionValues:[a.id,d].map(e=>({value:e,label:e}))})}})}},interactiveFiltersConfig:es}},el={column:{bar:{"fields.x.componentId":[{path:"fields.y.componentId"}],"fields.x.showValues":[{path:"fields.y.showValues"}],"fields.x.customDomain":[{path:"fields.y.customDomain"}],"fields.y.componentId":[{path:"fields.x.componentId"}]},map:{"fields.areaLayer.componentId":[{path:"fields.x.componentId"}],"fields.areaLayer.color.componentId":[{path:"fields.y.componentId"}]},table:{fields:[{path:"fields.segment"}]},comboLineSingle:{"fields.y.componentIds":[{path:"fields.y.componentId",oldValue:e=>e[0]}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.y.componentId"}]},comboLineColumn:{"fields.y":[{path:"fields.y.componentId",oldValue:e=>"left"===e.lineAxisOrientation?e.lineComponentId:e.columnComponentId}]}},bar:{column:{"fields.x.componentId":[{path:"fields.y.componentId"}],"fields.y.componentId":[{path:"fields.x.componentId"}],"fields.y.showValues":[{path:"fields.x.showValues"}],"fields.y.customDomain":[{path:"fields.x.customDomain"}]},line:{"fields.x.componentId":[{path:"fields.y.componentId"}],"fields.y.componentId":[{path:"fields.x.componentId"}],"fields.y.showValues":[{path:"fields.x.showValues"}],"fields.y.customDomain":[{path:"fields.x.customDomain"}]},area:{"fields.x.componentId":[{path:"fields.y.componentId"}],"fields.y.componentId":[{path:"fields.x.componentId"}],"fields.y.showValues":[{path:"fields.x.showValues"}],"fields.y.customDomain":[{path:"fields.x.customDomain"}]},pie:{"fields.y.componentId":[{path:"fields.x.componentId"}],"fields.y.showValues":[{path:"fields.x.showValues"}]},map:{"fields.areaLayer.componentId":[{path:"fields.y.componentId"}],"fields.areaLayer.color.componentId":[{path:"fields.x.componentId"}]},table:{fields:[{path:"fields.segment"}]},comboLineSingle:{"fields.y.componentIds":[{path:"fields.x.componentId",oldValue:e=>e[0]}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.x.componentId"}]},comboLineColumn:{"fields.y":[{path:"fields.x.componentId",oldValue:e=>"left"===e.lineAxisOrientation?e.lineComponentId:e.columnComponentId}]}},line:{bar:{"fields.x.componentId":[{path:"fields.y.componentId"}],"fields.x.showValues":[{path:"fields.y.showValues"}],"fields.x.customDomain":[{path:"fields.y.customDomain"}],"fields.y.componentId":[{path:"fields.x.componentId"}]},map:{"fields.areaLayer.color.componentId":[{path:"fields.y.componentId"}]},table:{fields:[{path:"fields.segment"}]},comboLineSingle:{"fields.y.componentIds":[{path:"fields.y.componentId",oldValue:e=>e[0]}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.y.componentId"}]},comboLineColumn:{"fields.y":[{path:"fields.y.componentId",oldValue:e=>"left"===e.lineAxisOrientation?e.lineComponentId:e.columnComponentId}]}},area:{bar:{"fields.x.componentId":[{path:"fields.y.componentId"}],"fields.x.showValues":[{path:"fields.y.showValues"}],"fields.x.customDomain":[{path:"fields.y.customDomain"}],"fields.y.componentId":[{path:"fields.x.componentId"}]},map:{"fields.areaLayer.color.componentId":[{path:"fields.y.componentId"}]},table:{fields:[{path:"fields.segment"}]},comboLineSingle:{"fields.y.componentIds":[{path:"fields.y.componentId",oldValue:e=>e[0]}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.y.componentId"}]},comboLineColumn:{"fields.y":[{path:"fields.y.componentId",oldValue:e=>"left"===e.lineAxisOrientation?e.lineComponentId:e.columnComponentId}]}},scatterplot:{map:{"fields.areaLayer.color.componentId":[{path:"fields.y.componentId"}]},table:{fields:[{path:"fields.segment"}]},comboLineSingle:{"fields.y.componentIds":[{path:"fields.y.componentId",oldValue:e=>e[0]}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.y.componentId"}]},comboLineColumn:{"fields.y":[{path:"fields.y.componentId",oldValue:e=>"left"===e.lineAxisOrientation?e.lineComponentId:e.columnComponentId}]}},pie:{bar:{"fields.x.componentId":[{path:"fields.y.componentId"}],"fields.x.showValues":[{path:"fields.y.showValues"}],"fields.y.componentId":[{path:"SKIP"}]},map:{"fields.areaLayer.componentId":[{path:"fields.segment.componentId"}],"fields.areaLayer.color.componentId":[{path:"fields.y.componentId"}]},table:{fields:[{path:"fields.segment"}]},comboLineSingle:{"fields.y.componentIds":[{path:"fields.y.componentId",oldValue:e=>e[0]}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.y.componentId"}]},comboLineColumn:{"fields.y":[{path:"fields.y.componentId",oldValue:e=>"left"===e.lineAxisOrientation?e.lineComponentId:e.columnComponentId}]}},table:{column:{"fields.segment":[{path:"fields"}]},line:{"fields.segment":[{path:"fields"}]},area:{"fields.segment":[{path:"fields"}]},scatterplot:{"fields.segment":[{path:"fields"}]},pie:{"fields.segment":[{path:"fields"}]}},map:{column:{"fields.x.componentId":[{path:"fields.areaLayer.componentId"}],"fields.y.componentId":[{path:"fields.areaLayer.color.componentId"}]},bar:{"fields.x.componentId":[{path:"fields.areaLayer.color.componentId"}],"fields.y.componentId":[{path:"fields.areaLayer.componentId"}]},line:{"fields.y.componentId":[{path:"fields.areaLayer.color.componentId"}]},area:{"fields.y.componentId":[{path:"fields.areaLayer.color.componentId"}]},scatterplot:{"fields.y.componentId":[{path:"fields.areaLayer.color.componentId"}]},pie:{"fields.x.componentId":[{path:"fields.areaLayer.componentId"}],"fields.y.componentId":[{path:"fields.areaLayer.color.componentId"}]},comboLineSingle:{"fields.y.componentIds":[{path:"fields.areaLayer.color.componentId",oldValue:e=>e[0]}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.areaLayer.color.componentId"}]},comboLineColumn:{"fields.y":[{path:"fields.areaLayer.color.componentId",oldValue:e=>"left"===e.lineAxisOrientation?e.lineComponentId:e.columnComponentId}]}},comboLineSingle:{column:{"fields.y.componentId":[{path:"fields.y.componentIds"}]},bar:{"fields.x.componentId":[{path:"fields.y.componentIds"}]},line:{"fields.y.componentId":[{path:"fields.y.componentIds"}]},area:{"fields.y.componentId":[{path:"fields.y.componentIds"}]},scatterplot:{"fields.y.componentId":[{path:"fields.y.componentIds"}]},pie:{"fields.y.componentId":[{path:"fields.y.componentIds"}]},map:{"fields.areaLayer.color.componentId":[{path:"fields.y.componentIds"}]},comboLineDual:{"fields.y.leftAxisComponentId":[{path:"fields.y.componentIds"}]},comboLineColumn:{"fields.y.lineComponentId":[{path:"fields.y.componentIds"}]}},comboLineDual:{column:{"fields.y":[{path:"fields.y"}]},bar:{"fields.x":[{path:"fields.y"}]},line:{"fields.y":[{path:"fields.y"}]},area:{"fields.y":[{path:"fields.y"}]},scatterplot:{"fields.y":[{path:"fields.y"}]},pie:{"fields.y":[{path:"fields.y"}]},map:{"fields.areaLayer":[{path:"fields.y"}]},comboLineSingle:{"fields.y":[{path:"fields.y"}]},comboLineColumn:{"fields.y":[{path:"fields.y"}]}},comboLineColumn:{column:{"fields.y":[{path:"fields.y"}]},bar:{"fields.x":[{path:"fields.y"}]},line:{"fields.y":[{path:"fields.y"}]},area:{"fields.y":[{path:"fields.y"}]},scatterplot:{"fields.y":[{path:"fields.y"}]},pie:{"fields.y":[{path:"fields.y"}]},map:{"fields.areaLayer":[{path:"fields.y"}]},comboLineSingle:{"fields.y":[{path:"fields.y"}]},comboLineDual:{"fields.y":[{path:"fields.y"}]}}},ec=e=>{let{segment:t,acceptedValues:r,defaultValue:n}=e,i=t.sorting,o=i?.sortingType;return i?o&&r.includes(o)?i:$($({},i),{},{sortingType:n}):q},ed=["column","bar","pie"],eu=["column","bar","map","pie"],ep=["scatterplot"],em=["area","column","bar","line"],ef=e=>{let{dimensions:t,measures:r,cubeCount:n}=e,i=r.filter(x.cW),s=r.filter(x.vn),l=(0,x.Ru)(t),c=(0,x.VD)(t),d=t.filter(e=>(0,x.fF)(e)||(0,x.eP)(e)),u=Object.fromEntries(U.map(e=>[e,{enabled:"table"===e,message:void 0}])),p=e=>{u[e]={enabled:!0,message:void 0}},m=e=>{for(let t of e)p(t)},f=(e,t)=>{u[e].enabled||u[e].message||(u[e]={enabled:!1,message:t})},h=(e,t)=>{for(let r of e)f(r,t)};if(i.length>0){if(l.length>0?m(ed):h(ed,o.ag._({id:"controls.chart.disabled.categorical"})),c.length>0?m(eu):h(eu,o.ag._({id:"controls.chart.disabled.geographical"})),i.length>1){if(m(ep),d.length>0){let e=i.filter(e=>e.unit);Array.from(new Set(e.map(e=>e.unit))).length>1?m(B):h(B,o.ag._({id:"controls.chart.disabled.different-unit"})),Array.from((0,a.jJ)(e,e=>e.length,e=>e.unit).values()).some(e=>e>1)?m(H):h(H,o.ag._({id:"controls.chart.disabled.same-unit"}))}else h(W,o.ag._({id:"controls.chart.disabled.temporal"}))}else h([...ep,...W],o.ag._({id:"controls.chart.disabled.multiple-measures"}));d.length>0?m(em):h(em,o.ag._({id:"controls.chart.disabled.temporal"}))}else h(U.filter(e=>"table"!==e),o.ag._({id:"controls.chart.disabled.numerical"}));s.length>0&&c.length>0?p("map"):f("map","At least one ordinal measure and one geographical dimension are required.");let g=function(e){let{cubeCount:t}=e,r=t>1?-100:0;return{column:0,bar:1,line:2,area:3,scatterplot:4,pie:5,map:6,table:7,comboLineSingle:8+r,comboLineDual:9+r,comboLineColumn:10+r}}({cubeCount:n});return{enabledChartTypes:U.filter(e=>u[e].enabled).sort((e,t)=>g[e]-g[t]),possibleChartTypesDict:u}},eh=e=>new Set(Object.values(e).flatMap(e=>e?.componentId?[e.componentId]:[])),eg=e=>new Set(Object.values(e).flatMap(e=>e&&e.isGroup?[e.componentId]:[])),eb=e=>new Set(Object.values(e).flatMap(e=>e&&e.isHidden?[e.componentId]:[])),ey=(e,t)=>e[t]?.componentId,ev=e=>{let{oldColorField:t}=e;return{type:"single",paletteId:t.paletteId,color:"single"===t.type?t.color:Object.values(t.colorMapping)[0]}},ej=e=>{let{oldColorField:t,segmentDimension:r}=e,n=t?.paletteId??O.h$;return{type:"segment",paletteId:n,colorMapping:(0,v.t6)({paletteId:n,dimensionValues:r?.values??[],colorMapping:t?.type==="segment"?t.colorMapping:void 0})}},ex=e=>{let{fields:t,dimensions:r,measures:n}=e,i=a.ZP(Object.values(t),e=>e.isGroup).get(!0)?.filter(e=>x.hw.includes(e.componentType)).sort((e,t)=>e.index-t.index),o=i?.[0];if(!o)return;let{componentId:s}=o,l=[...r,...n].find(e=>e.id===s),c=(0,O.mq)(l);return{segment:{componentId:s,showValuesMapping:{}},color:{type:"segment",paletteId:c,colorMapping:(0,v.t6)({paletteId:c,dimensionValues:l.values})}}},eC=e=>{switch(e){case"area":case"column":case"bar":case"comboLineColumn":case"pie":case"map":case"table":return"square";case"comboLineDual":case"comboLineSingle":case"line":return"line";case"scatterplot":return"circle";default:return e}}},44463:function(e,t,r){"use strict";r.d(t,{Dp:function(){return d},LV:function(){return a},NB:function(){return l},Q9:function(){return u},g8:function(){return p},pR:function(){return s},r2:function(){return c},xm:function(){return o}});var n=r(67291),i=r(10359);let o=80,s=100,a={type:"fixed",value:n.Z[0],opacity:o},l=e=>{let{id:t,paletteId:r,dimensionValues:n}=e;return{type:"categorical",componentId:t,paletteId:r,colorMapping:(0,i.t6)({paletteId:r,dimensionValues:n}),opacity:s}},c=e=>{let{id:t,colorPalette:r={type:"sequential",paletteId:"oranges",name:"oranges"}}=e;return{type:"numerical",componentId:t,paletteId:r.paletteId,scaleType:"continuous",interpolationType:"linear",opacity:100}},d=[222,222,222,125],u=500,p=1500},20925:function(e,t,r){"use strict";r.d(t,{F:function(){return i},R:function(){return o}});let n=null,i=()=>n,o=e=>{n=e}},37136:function(e,t,r){"use strict";r.d(t,{h:function(){return f},k3:function(){return h},oC:function(){return m}});var n=r(17043),i=r(24896),o=r(5368),s=r(83766),a=r.n(s),l=r(38746),c=r(20162);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let p=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=`${r??t.endpoint}/${e.Name??e.Title}`,i=((0,c.q)(e.CRS)??[]).map(e=>(0,c.C)(e)),o=a()([...t.crs,...i]),s=u(u({id:e.Name,path:`${n}`,title:e.Title,description:e.Abstract??"",legendUrl:e.Style?.LegendURL.OnlineResource["xlink:href"],type:"wms"},t),{},{crs:o});if(e.Layer){let r=c.q(e.Layer)?.map(e=>p(e,t,n));s.children=r}return s.children?.length===1&&s.children[0].id===s.id?s.children[0]:s},m="https://wms.geo.admin.ch/?REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.3.0",f=(e,t)=>{let r=new o.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",parseAttributeValue:!0}).parse(e),n=r.WMS_Capabilities.Capability.Request.GetMap.DCPType.HTTP.Get.OnlineResource["xlink:href"],i=r.WMS_Capabilities.Capability.Layer.Attribution?.Title??r.WMS_Capabilities.Service.Title;return(Array.isArray(r.WMS_Capabilities.Capability.Layer.Layer)?r.WMS_Capabilities.Capability.Layer.Layer:[r.WMS_Capabilities.Capability.Layer.Layer]).map(e=>p(e,{endpoint:t,dataUrl:n,attribution:i,crs:[]}))},h=e=>{let{wmsLayer:t,customLayer:r,beforeId:n}=e;if(r&&t){if(!(0,l.Cg)(t)){console.warn(`WMS layer ${t.id} is not supported in this map projection`);return}return new i.g({id:`wms-layer-${r.id}`,beforeId:n,data:`${t.dataUrl.replace(/\?$/,"")}`,loadOptions:{fetch:e=>{let t=new URL(e);return t.searchParams.set("TRANSPARENT","TRUE"),fetch(t.toString())}},serviceType:"wms",layers:[t.id]})}}},38746:function(e,t,r){"use strict";r.d(t,{Cg:function(){return j},I3:function(){return v},Xe:function(){return h},iu:function(){return b},p8:function(){return C},zm:function(){return O}});var n=r(38354),i=r.n(n),o=r(95099),s=r.n(o),a=r(27378),l=r(37136),c=r(1713),d=r(49148),u=r(57060),p=r(35904);function m(e){return/(wms|map=|\.map)/i.test(e)}function f(e){return/wmts/i.test(e)}let h=e=>f(e)?"wmts":(m(e),"wms"),g=async(e,t)=>{var r,n;let{url:i,type:o}=f(e)?{type:"wmts",url:((r=new URL(e)).searchParams.set("SERVICE","WMTS"),r.searchParams.set("REQUEST","GetCapabilities"),t&&r.searchParams.set("lang",t),r)}:(m(e),{type:"wms",url:((n=new URL(e)).searchParams.set("SERVICE","WMS"),n.searchParams.set("REQUEST","GetCapabilities"),n.searchParams.set("VERSION","1.3.0"),n.searchParams.set("FORMAT","text/xml"),t&&n.searchParams.set("lang",t),n)});try{let t=await fetch(i),r=await t.text();return"wmts"===o?(0,c.gQ)(r,e):(0,l.h)(r,e)}catch{return console.error(`Error fetching WMTS layers from endpoint ${e}`,e),[]}},b=e=>{let{type:t,id:r}=e;return`${t}-${r}`},y=e=>{let{wmsLayers:t,wmtsLayers:r}=e,n={};return(0,u.tn)(t??[],e=>{n[b(e)]=e}),(0,u.tn)(r??[],e=>{n[b(e)]=e}),n},v=e=>e&&e.includes("EPSG:3857"),j=e=>e.crs&&e.crs.length>0&&e.crs.some(e=>v(e)),x={wmts:[],wms:[],byKey:{}},C=function(e){let{pause:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pause:!1},r=(0,d.bU)(),n=(0,a.useCallback)(async()=>{let t=(await Promise.all(e.map(e=>g(e,r)))).flat(),{wmts:n=[],wms:o=[]}=i()(t,e=>e.type),s=y({wmsLayers:o,wmtsLayers:n});return{wmts:n,wms:o,byKey:s}},[e,r]);return(0,p.$5)({queryKey:["custom-layers",...s()(e),r],queryFn:n,options:{pause:t||!e.length,defaultData:x}})},O=e=>`${e.endpoint}/${e.id}`},20162:function(e,t,r){"use strict";r.d(t,{C:function(){return i},q:function(){return n}});let n=e=>void 0===e?void 0:Array.isArray(e)?e:[e],i=e=>{let t=e.match(/urn:ogc:def:crs:(?<namespace>.*):(?<version>[^:]*)?:(?<id>\d+)/)??e.match(/(?<namespace>.*):(?<id>\d+)/);if(t?.groups){let{namespace:e,id:r}=t.groups;return`${e}:${r}`}return e}},1713:function(e,t,r){"use strict";r.d(t,{WE:function(){return b},em:function(){return j},gQ:function(){return g},oG:function(){return y}});var n=r(17043),i=r(46589),o=r(4485),s=r(5368),a=r(83766),l=r.n(a),c=r(38746),d=r(20162);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let p=e=>e?(Array.isArray(e)?e:[e]).map(e=>{let[t,r]=e.TileMatrix[0].TopLeftCorner.split(" ").map(Number),n=Array.isArray(e.TileMatrix)?e.TileMatrix:[e.TileMatrix];return{id:e["ows:Identifier"],supportedCRS:((0,d.q)(e["ows:SupportedCRS"])??[]).map(e=>(0,d.C)(e)),tileMatrixes:n.map(e=>({id:e["ows:Identifier"],scaleDenominator:e.ScaleDenominator,topLeftCorner:[t,r],tileWidth:e.TileWidth,tileHeight:e.TileHeight,matrixWidth:e.MatrixWidth,matrixHeight:e.MatrixHeight}))}}):null,m=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,o=((0,d.q)(e.TileMatrixSetLink)??[]).map(e=>r[e.TileMatrixSet]);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({id:e["ows:Identifier"],path:e["ows:Identifier"],url:e.ResourceURL.template||i||t.endpoint,title:e["ows:Title"],description:e["ows:Abstract"],legendUrl:e.Style.LegendURL?.["xlink:href"],dimensionIdentifier:e.Dimension?.["ows:Identifier"],availableDimensionValues:e.Dimension?Array.isArray(e.Dimension.Value)?e.Dimension.Value:[e.Dimension.Value]:void 0,defaultDimensionValue:e.Dimension?.Default,type:"wmts",tileMatrixSets:o,crs:l()(o.map(e=>(e?.supportedCRS??[]).map(e=>(0,d.C)(e))).flat())},t)},f=(e,t)=>Array.isArray(e)?e.map(t):[t(e)],h=e=>`${e.endsWith("?")?e:`${e}?`}Service=WMTS&Request=GetTile&Transparent=true&Version=1.0.0&Format=image/png&tileMatrixSet={TileMatrixSet}&tileMatrix={TileMatrixNamespaced}&tileRow={TileRow}&tileCol={TileCol}&layer={Layer}`,g=(e,t)=>{let r=new s.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",parseAttributeValue:!0}).parse(e),n={endpoint:t,attribution:r.Capabilities["ows:ServiceProvider"]?.["ows:ProviderName"]},i=r.Capabilities["ows:OperationsMetadata"]?.["ows:Operation"]?.find(e=>"GetTile"===e.name),o=i?.["ows:DCP"]?.["ows:HTTP"]?.["ows:Get"]?.["xlink:href"],a=o?h(o):void 0,l=p(r.Capabilities.Contents.TileMatrixSet),c=l?Object.fromEntries(l.map(e=>[e.id,e])):{};return f(r.Capabilities.Contents.Layer,e=>m(e,n,c,a))},b="https://wmts.geo.admin.ch/EPSG/3857/1.0.0/WMTSCapabilities.xml",y=e=>{let{wmtsLayer:t,customLayer:r,beforeId:n,value:s}=e,a=r?.url??r?.endpoint;if(r&&"undefined"===r.url){console.warn("No url on layer, defaulted to endpoint");return}if(!r){console.warn("No custom layer found");return}if(!t){console.warn("No wmts layer");return}if(!a){console.warn("No url found");return}if(!(0,c.Cg)(t)){console.warn(`The WMTS layer ${t.id} does not have a supported CRS, skipping layer.`);return}let l=t.tileMatrixSets?.find(e=>e.supportedCRS.some(e=>c.I3(e))),d=v(a,{tileMatrixSetId:l?.id,identifier:t.dimensionIdentifier,layerId:t.id,value:j({availableDimensionValues:t.availableDimensionValues??[],defaultDimensionValue:t.defaultDimensionValue,customLayer:r,value:s})});return new i.Z({id:`tile-layer-${a}-${t.id}`,beforeId:n,data:d,tileSize:256,renderSubLayers:e=>{let{boundingBox:t}=e.tile;return new o.Z(e,{data:void 0,image:e.data,bounds:[t[0][0],t[0][1],t[1][0],t[1][1]]})}})},v=(e,t)=>{let{identifier:r,value:n,tileMatrixSetId:i,layerId:o}=t;return(r?e.replace(`{${r}}`,`${n}`):e).replace("{TileMatrixSet}",i??"{TileMatrixSet}").replace("{TileMatrixNamespaced}",i?`${i}:{z}`:"{z}").replace("{Layer}",o??"{Layer}").replace("{TileMatrix}","{z}").replace("{TileCol}","{x}").replace("{TileRow}","{y}")},j=e=>{let{availableDimensionValues:t,defaultDimensionValue:r,customLayer:n,value:i}=e;return!n||n&&"syncTemporalFilters"in n&&!n.syncTemporalFilters?r:i&&t.includes(i)?i:r}},50988:function(e,t,r){"use strict";r.d(t,{W:function(){return i}});var n=r(99714);function i(e,t){return(r,i)=>{if(0===e.length)return[r,i];let o=r.getTime(),s=i.getTime(),a=(0,(0,n.Z)((e,r)=>t(e).getTime()-r.getTime()).left)(e,r,1),l=e[a-1],c=e[a]??l,d=o-t(l).getTime()>t(c).getTime()-o?c:l,u=(0,(0,n.Z)((e,r)=>t(e).getTime()-r.getTime()).right)(e,i,1),p=e[u-1],m=e[u]??p,f=s-t(p).getTime()>t(m).getTime()-s?m:p;return[t(d),t(f)]}}},84161:function(e,t,r){"use strict";r.d(t,{j:function(){return i}});var n=r(50726);let i=(e,t)=>{let r={};for(let i of e)for(let e of t){let t=i.componentIdResolution[e];if((0,n.BG)(e)){if(!t)continue;r[e]=r[e]??[],r[e].push({cubeIri:i.cubeIri,resolvedDimensionId:t,interactiveFilters:i.interactiveFilters,componentIdResolution:i.componentIdResolution})}else t===e&&(r[e]=r[e]??[],r[e].push({cubeIri:i.cubeIri,resolvedDimensionId:e,interactiveFilters:i.interactiveFilters,componentIdResolution:i.componentIdResolution}))}return Object.entries(r).map(e=>{let[t,r]=e;return{dimensionId:t,entries:r}})}},64414:function(e,t,r){"use strict";r.d(t,{Bq:function(){return W},be:function(){return K},eR:function(){return Y},ge:function(){return z},rO:function(){return H},yk:function(){return B}});var n=r(17043),i=r(96338),o=r(19914),s=r(87026),a=r(12548),l=r(90104),c=r.n(l),d=r(56141),u=r.n(d),p=r(25389),m=r.n(p),f=r(71975),h=r.n(f),g=r(27378),b=r(25380),y=r(84161),v=r(97091),j=r(48863),x=r(35444),C=r(53082),O=r(99990),w=r(97358),I=r(33342),S=r(53624),P=r(50953),k=r(71238),_=r(44945),T=r(52109),D=r(10359),Z=r(77167),E=r(41494),M=r(50726),A=r(45298),L=r(48947),F=r(8788),N=r(92178),R=r(4352),G=r(77142),V=r(24246);function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let z=e=>{let{dataSource:t,chartConfig:r,dashboardFilters:n}=e,i=r.interactiveFiltersConfig.dataFilters,o=i.active,s=i.defaultOpen,a=i.componentIds,l=(0,g.useMemo)(()=>{let e=e=>!n?.dataFilters.componentIds.includes(e);return(0,P.Su)(r)?(0,D.H8)(r.fields).map(e=>e.componentId).filter(t=>a.includes(t)&&e(t)):a.filter(e)},[r,a,n]),{0:c,1:d}=(0,g.useState)(!!s);(0,g.useEffect)(()=>{d(!!s)},[o,s]);let{loading:u}=(0,j.$)(),p=(0,v.n9)({chartConfig:r,dashboardFilters:n,componentIds:l}),m=(0,g.useMemo)(()=>r.cubes.map(e=>{let t=p.find(t=>t.iri===e.iri);(0,N.h)(t,"Cube query filters not found.");let{unmappedFilters:n,mappedFilters:i}=(0,k.AF)(r,{cubeIri:e.iri,joinByIds:l.filter(M.BG)}),o=Object.keys(n),s=t.filters??{},a=Object.entries(s).filter(e=>{let[t]=e;return o.includes(t)}),c=[...Object.keys(s),...Object.keys(r.fields),...Object.values(r.fields).map(e=>e.componentId)].filter(Boolean),d=l.map(t=>{let r=(0,M.BG)(t)?(0,M.Tl)(e,t)??t:t;return{originalId:t,resolvedId:r}}).filter(e=>{let{resolvedId:t,originalId:r}=e;return t!==r||c.includes(t)}),u=Object.fromEntries(d.map(e=>{let{originalId:t,resolvedId:r}=e;return[t,r]})),m=d.map(e=>{let{originalId:t,resolvedId:r}=e,n=a.find(e=>{let[t]=e;return t===r});return n?[t,n[1]]:[t,void 0]});return{cubeIri:e.iri,interactiveFilters:Object.fromEntries(m),unmappedFilters:Object.fromEntries(a),mappedFilters:i,componentIdResolution:u}}),[r,l,p]),f=(0,g.useMemo)(()=>(0,y.j)(m,l),[m,l]),{error:h}=q({dataSource:t,chartConfig:r,preparedFilters:m,dashboardFilters:n});return{open:c,setOpen:d,defaultOpen:s,dataSource:t,chartConfig:r,loading:u,error:h,preparedFilters:m,groupedPreparedFilters:f,componentIds:l}},B=e=>{let{open:t,setOpen:r,defaultOpen:n,loading:o,error:l,componentIds:c}=e;return l?(0,V.jsx)(s.Z,{variant:"body2",color:"error",children:(0,V.jsx)(i.cC,{id:"controls.section.data.filters.possible-filters-error"})}):n?null:(0,V.jsx)(C.k,{sx:{flexDirection:"column",width:"100%"},children:(0,V.jsx)(C.k,{sx:{alignItems:"flex-start",gap:3,minHeight:20},children:c&&c.length>0&&(0,V.jsxs)(a.Z,{variant:"text",color:"primary",size:"sm",endIcon:(0,V.jsx)(L.JO,{name:"plus",size:16,style:{transform:t?"rotate(45deg)":"rotate(0deg)",transition:"transform 0.2s ease-in-out"}}),sx:{display:"flex",alignItems:"center",minWidth:"fit-content",minHeight:0,ml:-2,px:2,py:1},onClick:()=>r(e=>!e),children:[o&&(0,V.jsx)("span",{style:{marginTop:"0.1rem",marginRight:"0.5rem"},children:(0,V.jsx)(_.TF,{})}),(0,V.jsx)(s.Z,{variant:"body2",children:t?(0,V.jsx)(i.cC,{id:"interactive.data.filters.hide"}):(0,V.jsx)(i.cC,{id:"interactive.data.filters.show"})})]})})})},H=e=>{let{filters:t,interactiveFilters:r}=e,n=h()(t,(e,t)=>!(t in r)),i=0;return m()(U(U({},n),r),e=>void 0===e?{type:"single",value:Z.P,position:i++}:U(U({},e),{},{position:i++}))},W=e=>{let{configFilter:t,dimension:r,value:n,values:i=[],isMulti:s=!1,onChange:a,onMultiChange:l,options:c,disabled:d}=e,{label:u,isKeyDimension:p}=r,m=o.ag._({id:"controls.dimensionvalue.select"}),f=o.ag._({id:"controls.clear-selection"}),h=c??r.values,b=(0,g.useMemo)(()=>{let e={value:Z.P,label:f,isNoneValue:!0};if(s&&l){if(!t)return[e,...h];if("multi"===t.type)return[e,...h.filter(e=>t.values[e.value])]}return p?h:[{value:Z.P,label:m,isNoneValue:!0},...h]},[f,s,l,p,h,m,t]),y=(0,V.jsx)(_.Qy,{label:(0,V.jsx)(w.K,{component:r,children:u})});if(s&&l){let e=i.filter(e=>e!==Z.P);return(0,V.jsx)(I.N,{id:"dataFilterBaseDimension",label:y,options:b,value:e,onChange:l,size:"sm",disabled:d,placeholder:m})}return(0,V.jsx)(O.Ph,{id:"dataFilterBaseDimension",size:"sm",label:y,options:b,value:n,onChange:a,disabled:d})},Y=e=>{let{configFilter:t,dimension:r,value:n,values:i=[],isMulti:s=!1,onChange:a,onMultiChange:l,hierarchy:c,disabled:d}=e,{label:u,isKeyDimension:p,values:m}=r,f=o.ag._({id:"controls.dimensionvalue.select"}),h=(0,g.useMemo)(()=>{let e={value:Z.P,label:f,isNoneValue:!0,hasValue:!0},r=c?(0,R.n)(c,m.map(e=>e.value)):m;return t?"multi"===t.type?[e,...X(r,t)]:(p&&"single"===t.type||r.unshift(e),r):[e,...r]},[f,c,m,t,p]),b=(0,G.z)(e=>{s&&l&&Array.isArray(e.target.value)?l(e.target.value):s||"string"!=typeof e.target.value||a({target:{value:e.target.value}})}),y=s?i.filter(e=>e!==Z.P):[],v=s?y:n;return(0,V.jsx)(S._,{value:v,options:h,onChange:b,isMulti:s,label:(0,V.jsx)(_.Qy,{label:(0,V.jsx)(w.K,{component:r,children:u})}),disabled:d})},K=e=>{let{configFilter:t,dimension:r,value:n,onChange:i,disabled:o}=e,{label:s,timeUnit:a,timeFormat:l}=r,c=(0,E.ls)(),d=c.format(l),u=c.parse(l),{minDate:p,maxDate:m,options:f,optionValues:h}=(0,g.useMemo)(()=>(0,D.E0)({dimension:r,parseDate:u}),[r,u]);return(0,T.H)(a)?(0,V.jsx)(T.b,{name:`interactive-date-picker-${r.id}`,label:(0,V.jsx)(_.Qy,{label:(0,V.jsx)(w.K,{component:r,children:s})}),value:u(n),onChange:i,isDateDisabled:e=>!h.includes(d(e)),timeUnit:a,dateFormat:d,minDate:p,maxDate:m,disabled:o,parseDate:u,showClearButton:t?.type!=="single"}):(0,V.jsx)(W,{configFilter:t,dimension:r,options:f,value:n,onChange:i,disabled:o})},q=e=>{let{dataSource:t,chartConfig:r,dashboardFilters:n,preparedFilters:i}=e,[,o]=(0,k.lY)(),s=(0,j.$)(),{0:a,1:l}=(0,g.useState)(),d=(0,g.useRef)({}),p=(0,b.m8)(),m=(0,F.Uq)(),f=(0,F.bI)(e=>e.setDataFilters),h=(0,g.useMemo)(()=>i?.reduce((e,t)=>(e[t.cubeIri]=t,e),{}),[i]),y=(0,k.Mm)(n);return(0,g.useEffect)(()=>{(async()=>{h&&!y&&r.cubes.forEach(async e=>{let{mappedFilters:r,unmappedFilters:n,interactiveFilters:i}=h[e.iri];if((0,x.l)(d.current[e.iri],n))return;d.current[e.iri]=n,s.set("possible-interactive-filters",!0);let o=(0,x.B)({cubeIri:e.iri,dataSource:t,unmappedFilters:n}),{data:a,error:g}=await p.query(A.UK,o).toPromise();if(g||!a){l(g),s.set("possible-interactive-filters",!1),console.error("Could not fetch possible filters",g);return}l(void 0),s.set("possible-interactive-filters",!1);let b=Object.assign(Object.fromEntries(a.possibleFilters.map(e=>{let t=i[e.id];return[e.id,{type:e.type,value:t?.type==="single"&&t.value===Z.P?Z.P:e.value}]})),r),y=U({},m().dataFilters),v=Object.fromEntries(Object.entries(b).filter(e=>{let[t,r]=e;return t in y&&"single"===r.type}));if(!u()(v,i)&&!c()(v)){for(let[e,t]of Object.entries(b))e in y&&"single"===t.type&&(y[e]=t);f(y)}})})()},[p,o,r.fields,r.cubes,t,f,s,h,m,y]),{error:a}},X=(e,t)=>{if(!t||"multi"!==t.type)return e;let r=e=>!!t.values[e.value]||!!e.children&&e.children.length>0&&e.children.some(r),n=e=>{if(r(e)){let r=e.children?e.children.map(n).filter(e=>null!==e):void 0;return U(U({},e),{},{children:r,selectable:t?!!t.values[e.value]:!!e.hasValue})}return null};return e.map(n).filter(e=>null!==e)}},97091:function(e,t,r){"use strict";r.d(t,{ks:function(){return J},Xd:function(){return T},Bu:function(){return D},Zl:function(){return _},zY:function(){return X},Ke:function(){return V},d7:function(){return q},gS:function(){return U},Fi:function(){return Y},H_:function(){return A},nS:function(){return F},o$:function(){return $},eB:function(){return E},vc:function(){return W},wu:function(){return H},DK:function(){return L},Tq:function(){return Z},n9:function(){return I},Ym:function(){return N},MZ:function(){return G},Tg:function(){return R}});var n=r(17043),i=r(50228),o=r(40015),s=r.n(o),a=r(83766),l=r.n(a),c=r(27378);let d=e=>{let{useAbbreviations:t,dimensionId:r,dimensionValues:n}=e,{valueLookup:i,labelLookup:o,abbreviationOrLabelLookup:s}=(0,c.useMemo)(()=>{let e=n??[],r=new Map,i=new Map;for(let t of e)r.set(t.value,t),i.set(t.label,t);let o=new Map(Array.from(i,e=>{let[r,n]=e;return[t?n.alternateName??r:r,n]}));return{valueLookup:r,labelLookup:i,abbreviationOrLabelLookup:o}},[n,t]);return{abbreviationOrLabelLookup:s,getAbbreviationOrLabelByValue:(0,c.useCallback)(e=>{if(!r)return"";let n=e[`${r}/__iri__`],s=e[r];if(void 0===n&&void 0===s)return"";let a=(n?i.get(n):null)??(s?o.get(s):null),l=a?.label??"";return t?a?.alternateName??l:l},[r,i,o,t])}};var u=r(62050);let p=(e,t,r)=>{let n=(0,c.useCallback)(e=>e[`${r}/__iri__`],[r]),i=(0,c.useMemo)(()=>{let r=new Map;return e.forEach(e=>{let i=n(e),o=t(e);r.set(i??o,o)}),r},[e,n,t]);return{getValue:(0,c.useCallback)(e=>n(e)??t(e),[n,t]),getLabel:(0,c.useCallback)(e=>i.get(e)??e,[i])}};var m=r(50953),f=r(25390),h=r(71238),g=r(10359),b=r(77167),y=r(64103),v=r(17510),j=r(50726),x=r(8788);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let w=e=>{let{chartConfig:t,cubeFilters:r,animationField:n,interactiveFiltersConfig:i,dashboardFilters:o,interactiveDataFilters:a}=e,l=O({},r),c=o?.dataFilters.componentIds??[];for(let[e,t]of Object.entries(o?.dataFilters.filters??{}))e in r&&c.includes(e)&&n?.componentId!==e&&(l[e]=t);let d=i.dataFilters.componentIds.flatMap(e=>(0,j.BG)(e)?(0,j.Z3)(e,t):[e]);for(let[e,t]of Object.entries(a)){let o=i.dataFilters.active&&d.includes(e),s="single"===t.type&&t.value!==b.P||"multi"===t.type&&Object.keys(t.values).length>0;(o||d.includes(e)&&s||c.includes(e))&&n?.componentId!==e&&("single"===t.type&&t.value===b.P?e in r&&"multi"===r[e].type||delete l[e]:"multi"===t.type&&0===Object.keys(t.values).length?e in r&&"multi"===r[e].type||delete l[e]:l[e]=t)}return s()(l,e=>"single"===e.type&&e.value===b.P)},I=e=>{let{chartConfig:t,dashboardFilters:r,componentIds:n}=e,i=(0,x.bI)(e=>e.dataFilters),o=(0,c.useMemo)(()=>Object.fromEntries(Object.entries(i).flatMap(e=>{let[r,n]=e;return((0,j.BG)(r)?(0,j.Z3)(r,t):[r]).map(e=>[e,n])})),[i,t]),s=(0,m.Ab)(t)?t.fields.animation:void 0;return(0,c.useMemo)(()=>t.cubes.map(e=>{let i=Object.fromEntries(Object.entries((0,f.jW)(t.cubes,{cubeIri:e.iri})).map(t=>{let[r,n]=t;return[(0,j.BG)(r)?(0,j.Tl)(e,r)??r:r,n]})),a=[...Object.keys(i),...Object.keys(t.fields),...Object.values(t.fields).map(e=>e.componentId)].filter(v.y).map(t=>(0,j.BG)(t)?(0,j.Tl)(e,t)??t:t),l=Object.fromEntries(Object.entries(o).filter(e=>{let[t]=e;return a.includes(t)})),c=w({chartConfig:t,cubeFilters:i,animationField:s,interactiveFiltersConfig:t.interactiveFiltersConfig,dashboardFilters:r,interactiveDataFilters:l});return{iri:e.iri,componentIds:n,filters:c,joinBy:e.joinBy}}),[t,o,s,r,n])},S=e=>{let{cubes:t}=e;return Object.keys((0,f.jW)(t)).filter(e=>!(0,j.BG)(e))},P=e=>{let{fields:t}=e,{areaLayer:r,symbolLayer:n}=t,i=[];return r&&i.push(r.color.componentId),n&&(n.measureId!==b.P&&i.push(n.measureId),["categorical","numerical"].includes(n.color.type)&&i.push(n.color.componentId)),i},k=e=>{switch(e.chartType){case"comboLineSingle":return e.fields.y.componentIds;case"comboLineDual":return[e.fields.y.leftAxisComponentId,e.fields.y.rightAxisComponentId];case"comboLineColumn":return[e.fields.y.columnComponentId,e.fields.y.lineComponentId];default:return e}},_=e=>l()(e.map(e=>T({chartConfig:e})).flat()),T=e=>{let{chartConfig:t,includeFilters:r=!0}=e,{fields:n,interactiveFiltersConfig:i}=t,o=Object.values(n).map(e=>e.componentId),s="map"===t.chartType?P(t):(0,h.tJ)(t)?k(t):[],a=r?S(t):[],c=i?Object.keys(i):[],d=[];return i&&c.forEach(e=>{let t=i[e];switch(e){case"legend":case"timeRange":t.active&&d.push(t.componentId);break;case"dataFilters":t.active&&d.push(...t.componentIds);break;case"calculation":break;default:return e}}),l()([...o,...s,...a,...d].filter(Boolean)).flatMap(e=>(0,j.BG)(e)?(0,j.Z3)(e,t):[e]).filter(e=>!(0,j.BG)(e)).sort()},D=(e,t)=>{let{components:r}=t;return T({chartConfig:e,includeFilters:!1}).map(e=>r.find(t=>t.id===e)).filter(v.y)},Z=(e,t)=>{let{getX:r,getY:n}=t,i=(0,c.useCallback)(e=>{for(let t of[r,n].filter(v.y))if(null==t(e))return!1;return!0},[r,n]);return(0,c.useMemo)(()=>e.filter(i),[e,i])},E=(e,t)=>{let{observations:r,field:n}=t,{getAbbreviationOrLabelByValue:i,abbreviationOrLabelLookup:o}=d({useAbbreviations:n?.useAbbreviations,dimensionId:e?.id,dimensionValues:e?.values}),{getValue:s,getLabel:a}=p(r,i,e?.id);return{getAbbreviationOrLabelByValue:i,abbreviationOrLabelLookup:o,getValue:s,getLabel:a}},M=e=>t=>(0,c.useCallback)(r=>e(r[t]),[t]),A=e=>null!==e?+e:null,L=M(A),F=e=>null!==e?`${e}`:"",N=M(F),R=M(e=>(0,g.sG)(`${e}`)),G=e=>{let t=(0,c.useMemo)(()=>new Map(e.map(e=>[e.label,e])),[e]);return(0,c.useCallback)(e=>r=>{let n=r[e],i=t.get(`${n}`),o=i?(0,y.Mp)(i):void 0;return(0,g.sG)(`${o}`)},[t])},V=e=>t=>e?`${t[e]}`:"segment",$=(e,t)=>{let r=e.length;if(r>0)for(let n,i=0,o,s,a,l,c=e[t[0]].length;i<c;++i)for(a=l=0,n=0;n<r;++n)(s=(o=e[t[n]][i])[1]-o[0])>=0?(o[0]=a,o[1]=a+=s):(o[1]=l,o[0]=l+=s)},U=e=>{let{dataGrouped:t,key:r,getAxisValue:n,allSegments:i,getSegment:o,imputationType:s="none"}=e;switch(s){case"linear":if(i){let e=[...t.entries()],s=Array.from({length:t.size},()=>({}));for(let t of i){let r=(0,u.WR)({dataSortedByX:e.map(e=>{let[r,i]=e,s=i.find(e=>o(e)===t);return{date:new Date(r),value:s?n(s):null}})});for(let e=0;e<r.length;e++)s[e][t]=r[e].value}return z({dataGrouped:t,key:r,getAxisValue:n,getSegment:o,getOptionalObservationProps:e=>i.map(t=>({[t]:s[e][t]}))})}case"zeros":if(i)return z({dataGrouped:t,key:r,getAxisValue:n,getSegment:o,getOptionalObservationProps:()=>i.map(e=>({[e]:(0,u.zg)()}))});default:return z({dataGrouped:t,key:r,getAxisValue:n,getSegment:o})}},z=e=>{let{dataGrouped:t,key:r,getAxisValue:n,getSegment:o,getOptionalObservationProps:s=()=>[]}=e,a=[],l=[...t.entries()];for(let e=0;e<t.size;e++){let[t,c]=l[e],d=Object.assign({[r]:t,[`${r}/__iri__`]:c[0][`${r}/__iri__`],total:(0,i.Z)(c,n)},...s(e),...c.sort((e,t)=>(n(e)??0)-(n(t)??0)).map(e=>({[o(e)]:n(e)})));a.push(d)}return a},B=e=>`${e}/__identity__`,H=e=>(0,c.useCallback)(t=>t[B(e)]??null,[e]),W=e=>(0,c.useCallback)(t=>t[B(e)]??null,[e]),Y=(e,t)=>{let{key:r,getAxisValue:n,getTotalGroupValue:i}=t;return e.map(e=>{let t=i(e),o=n(e);return O(O({},e),{},{[r]:100*(o?o/t:o??0),[B(r)]:o})})},K=/\W+/g,q=e=>e.replace(K,"_"),X=e=>e.unit?`${e.label} (${e.unit})`:e.label,J=(e,t)=>{for(let r of e.values())if(r.length!==t.length)return!0;return!1}},48863:function(e,t,r){"use strict";r.d(t,{$:function(){return u},p:function(){return p}});var n=r(17043),i=r(27378),o=r(70644),s=r(7378),a=r(24246);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}class c extends s.y{constructor(){super(),(0,n.Z)(this,"loading",!1),(0,n.Z)(this,"map",{}),(0,n.Z)(this,"getUpdateKey",()=>JSON.stringify(this.map))}set(e,t){this.map[e]=t,this.resolveState()}resolveState(){let e=this.loading;this.loading=Object.values(this.map).some(e=>e),this.loading||(this.map={}),e!==this.loading&&this.notify()}}let d=(0,i.createContext)(void 0),u=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("useLoadingState must be called inside a LoadingStateContext.Provider!");return(0,o.useSyncExternalStore)(e.subscribe,e.getUpdateKey),e},p=e=>{let t=(0,i.useMemo)(()=>new c,[]);return(0,a.jsx)(d.Provider,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({value:t},e))}},43137:function(e,t,r){"use strict";r.d(t,{Ck:function(){return w},HR:function(){return M},KJ:function(){return P},MT:function(){return I},SU:function(){return A},Xg:function(){return Z},Xt:function(){return E},Zr:function(){return T},_M:function(){return C},_s:function(){return _},gH:function(){return O},m$:function(){return L},q1:function(){return F},rV:function(){return S},rl:function(){return D},sH:function(){return k}});var n=r(93603),i=r(49951),o=r(99729),s=r.n(o),a=r(55738),l=r.n(a),c=r(83766),d=r.n(c),u=r(31091),p=r.n(u),m=r(27378),f=r(97091),h=r(71238),g=r(10359),b=r(64103),y=r(41494),v=r(45298),j=r(94460),x=r(8788);let C=(0,m.createContext)(void 0),O=()=>{let e=(0,m.useContext)(C);if(void 0===e)throw Error("You need to wrap your component in <ChartContext.Provider /> to useChartState()");return e},w=e=>({interactiveFiltersConfig:e.interactiveFiltersConfig}),I=(e,t)=>{let{dimensionsById:r,observations:n}=t,i=r[e.componentId];if(!i)throw Error(`No dimension <${e.componentId}> in cube! (useBandXVariables)`);let o=(0,b.fF)(i)||(0,b.eP)(i)?i.timeUnit:void 0,s=(0,y.z6)(),a=(0,m.useCallback)(e=>o?s(e,o):"string"==typeof e?e:e.toISOString(),[s,o]),{getAbbreviationOrLabelByValue:l,getValue:c,getLabel:d}=(0,f.eB)(i,{observations:n,field:e}),u=(0,f.Tg)(e.componentId),p=(0,f.MZ)(r[e.componentId].values)(e.componentId);return{yAxisLabel:(0,f.zY)(i),yDimension:i,getY:c,getYLabel:d,getYAbbreviationOrLabel:l,yTimeUnit:o,getYAsDate:(0,b.eP)(i)?p:u,formatYDate:a}},S=(e,t)=>{let{dimensionsById:r,observations:n}=t,i=r[e.componentId];if(!i)throw Error(`No dimension <${e.componentId}> in cube! (useBandXVariables)`);let{getAbbreviationOrLabelByValue:o,getValue:s,getLabel:a}=(0,f.eB)(i,{observations:n,field:e}),l=(0,f.Tg)(e.componentId),c=(0,f.MZ)(r[e.componentId].values)(e.componentId),d=(0,f.zY)(i),u=(0,b.fF)(i)||(0,b.eP)(i)?i.timeUnit:void 0,p=(0,y.z6)(),h=(0,m.useCallback)(e=>u?p(e,u):"string"==typeof e?e:e.toISOString(),[p,u]);return{xAxisLabel:d,xDimension:i,getX:s,getXLabel:a,getXAbbreviationOrLabel:o,xTimeUnit:u,getXAsDate:(0,b.eP)(i)?c:l,formatXDate:h}},P=(e,t)=>{let{dimensionsById:r}=t,n=r[e.componentId];if(!n)throw Error(`No dimension <${e.componentId}> in cube! (useTemporalXVariables)`);if(!(0,b.fF)(n)&&!(0,b.eP)(n))throw Error(`Dimension <${e.componentId}> is not temporal!`);let i=(0,f.Tg)(e.componentId),o=r[e.componentId].values,s=r[e.componentId].relatedLimitValues,a=p()([...o,...s],e=>e.value),l=(0,f.MZ)(a)(e.componentId),c=(0,f.Ym)(e.componentId);return{xAxisLabel:(0,f.zY)(n),xDimension:n,getX:(0,b.fF)(n)?i:l,getXAsString:c}},k=(e,t)=>{let{componentId:r=""}=e,{dimensionsById:n}=t,i=n[r];if(i&&!(0,b.fF)(i)&&!(0,b.eP)(i))throw Error(`Dimension <${r}> is not temporal!`);let o=(0,f.Tg)(r),s=n[r]?.values??[],a=n[r]?.relatedLimitValues??[],l=p()([...s,...a],e=>e.value),c=(0,f.MZ)(l)(r);return{xDimension:i,getX:(0,b.fF)(i)?o:c}},_=e=>e===j.N3.Interval,T=(e,t,r)=>{let{measuresById:i}=r,o=i[t.componentId];if(!o)throw Error(`No dimension <${t.componentId}> in cube! (useNumericalXVariables)`);if(!(0,b.cW)(o))throw Error(`Measure <${t.componentId}> is not numerical!`);let s=(0,f.DK)(t.componentId),a=(0,f.zY)(o),l=(0,m.useCallback)((t,r)=>{switch(e){case"bar":return Math.min(0,(0,n.Z)(t,r)??0);case"scatterplot":return _(o.scaleType)?(0,n.Z)(t,r)??0:Math.min(0,(0,n.Z)(t,r)??0);default:return e}},[e,o.scaleType]);return{xMeasure:o,getX:s,xAxisLabel:a,getMinX:l}},D=(e,t,r)=>{let{measuresById:i}=r,o=i[t.componentId];if(!o)throw Error(`No dimension <${t.componentId}> in cube! (useNumericalYVariables)`);if(!(0,b.cW)(o))throw Error(`Measure <${t.componentId}> is not numerical!`);let s=(0,f.DK)(t.componentId),a=(0,f.zY)(o),l=(0,m.useCallback)((t,r)=>{switch(e){case"area":case"column":case"pie":return Math.min(0,(0,n.Z)(t,r)??0);case"line":case"scatterplot":return _(o.scaleType)?(0,n.Z)(t,r)??0:Math.min(0,(0,n.Z)(t,r)??0);default:return e}},[e,o.scaleType]);return{yMeasure:o,getY:s,yAxisLabel:a,getMinY:l}},Z=(e,t)=>{let{getValue:r,dimensions:n,measures:i}=t,o=s()(e,["showStandardError"],!0),a=(0,g.TA)(e.componentId,{dimensions:n,measures:i,type:v.zD.StandardError}),l=(0,g.M_)(a),c=s()(e,["showConfidenceInterval"],!0),d=(0,g.TA)(e.componentId,{dimensions:n,measures:i,type:v.zD.ConfidenceUpperBound}),u=(0,g.M_)(d),p=(0,g.TA)(e.componentId,{dimensions:n,measures:i,type:v.zD.ConfidenceLowerBound}),f=(0,g.M_)(p),h=(0,m.useCallback)(e=>o&&l?.(e)!==null||c&&u?.(e)!==null&&f?.(e)!==null,[o,l,c,u,f]),b=(0,g.L6)(o&&a?a:d,o&&a?a:p,r),y=(0,m.useCallback)(e=>{if(o&&l&&null!==l(e)){let t=l(e),r=a?.unit??"";return` \xb1 ${t}${r}`}if(c&&u&&f&&null!==u(e)&&null!==f(e)){let t=f(e),r=u(e),n=d?.unit??"";return`, [-${t}${n}, +${r}${n}]`}},[o,l,c,u,f,a?.unit,d?.unit]);return{showYUncertainty:o&&!!a||c&&!!d&&!!p,getYErrorPresent:h,getYErrorRange:b,getFormattedYUncertainty:y}},E=(e,t)=>{let{getValue:r,dimensions:n,measures:i}=t,o=s()(e,["showStandardError"],!0),a=(0,g.TA)(e.componentId,{dimensions:n,measures:i,type:v.zD.StandardError}),l=(0,g.M_)(a),c=s()(e,["showConfidenceInterval"],!0),d=(0,g.TA)(e.componentId,{dimensions:n,measures:i,type:v.zD.ConfidenceUpperBound}),u=(0,g.M_)(d),p=(0,g.TA)(e.componentId,{dimensions:n,measures:i,type:v.zD.ConfidenceLowerBound}),f=(0,g.M_)(p),h=(0,m.useCallback)(e=>o&&l?.(e)!==null||c&&u?.(e)!==null&&f?.(e)!==null,[o,l,c,u,f]),b=(0,g.L6)(o&&a?a:d,o&&a?a:p,r),y=(0,m.useCallback)(e=>{if(o&&l&&null!==l(e)){let t=l(e),r=a?.unit??"";return` \xb1 ${t}${r}`}if(c&&u&&f&&null!==u(e)&&null!==f(e)){let t=f(e),r=u(e),n=d?.unit??"";return`, [-${t}${n}, +${r}${n}]`}},[o,l,c,u,f,a?.unit,d?.unit]);return{showXUncertainty:o&&!!a||c&&!!d&&!!p,getXErrorPresent:h,getXErrorRange:b,getFormattedXUncertainty:y}},M=(e,t)=>{let{dimensionsById:r,observations:n}=t,i=r[e?.componentId??""],{getAbbreviationOrLabelByValue:o,abbreviationOrLabelLookup:s,getValue:a,getLabel:l}=(0,f.eB)(i,{observations:n,field:e});return{segmentDimension:i,segmentsByAbbreviationOrLabel:s,getSegment:a,getSegmentAbbreviationOrLabel:o,getSegmentLabel:l,showValuesBySegmentMapping:e?.showValuesMapping??{}}},A=(e,t)=>{let{dimensionsById:r}=t,n=e.timeRange.componentId,i=r[n],o=(0,f.Tg)(n),s=i?.values??[],a=i?.relatedLimitValues??[],l=p()([...s,...a],e=>e.value),c=(0,f.MZ)(l)(n);return{getTimeRangeDate:(0,b.fF)(i)?o:c}},L=e=>{let t=e.limits.flatMap(e=>{switch(e.measureLimit.type){case"single":return e.measureLimit.value;case"value-range":return[e.measureLimit.min,e.measureLimit.max];case"time-range":return[e.measureLimit.value];default:return e.measureLimit}});return{minLimitValue:(0,n.Z)(t),maxLimitValue:(0,i.Z)(t)}},F=(e,t)=>{let{sortData:r,chartConfig:n,timeRangeDimensionId:i,axisDimensionId:o,limits:s,getAxisValueAsDate:a,getSegmentAbbreviationOrLabel:c,getTimeRangeDate:u}=t,{interactiveFiltersConfig:p}=n,b=(0,m.useMemo)(()=>{let t=e;if(o&&s){let r=s.flatMap(e=>e.related).filter(e=>e.dimensionId===o).map(e=>({[o]:e.label})),n=d()(e.map(e=>e[o]));t=[...e,...r.filter(e=>!n.includes(e[o]))]}return r?r(t):e},[o,s,e,r]),y=(0,x.bI)(e=>e.categories),v=(0,x.bI)(e=>e.timeRange),j=(0,x.bI)(e=>e.timeSlider),C=p.timeRange,O=C.presets.from?(0,g.sG)(C.presets.from).getTime():void 0,w=C.presets.to?(0,g.sG)(C.presets.to).getTime():void 0,I=(0,m.useMemo)(()=>{let e=u&&O&&w?e=>{let t=u(e).getTime();return t>=O&&t<=w}:null;return e?[e]:[]},[O,w,u]),S=v.from?.getTime(),P=v.to?.getTime(),[{dashboardFilters:k}]=(0,h.lY)(h.Sc),{potentialTimeRangeFilterIds:_}=(0,x.Rx)(),T=(0,m.useMemo)(()=>{let e=a&&S&&P&&(C?.active||k?.timeRange.active&&i&&_.includes(i))?e=>{let t=a(e).getTime();return t>=S&&t<=P}:null;return e?[e]:[]},[a,S,P,C?.active,k?.timeRange.active,i,_]),D=(0,h.MO)(n),Z=D?.dynamicScales??!0,E=D?.componentId??"",M=(0,f.Tg)(E),A=(0,f.Ym)(E),L=(0,m.useMemo)(()=>{let e=D?.componentId&&j.value?e=>"interval"===j.type?M(e).getTime()===j.value.getTime():A(e)===j.value:null;return e?[e]:[]},[D?.componentId,j.type,j.value,M,A]),F=(0,m.useMemo)(()=>{let e=Object.keys(y),t=p.legend.active&&c?t=>!e.includes(c(t)):null;return t?[t]:[]},[y,c,p.legend.active]),N=(0,m.useMemo)(()=>b.filter(l()([...F,...T,...L])),[b,F,T,L]),R=(0,m.useMemo)(()=>Z?N:b.filter(l()([...F,...T])),[Z,N,b,F,T]),G=(0,m.useMemo)(()=>b.filter(l()(T)),[b,T]),V=(0,m.useMemo)(()=>b.filter(l()(I)),[b,I]),$=(0,m.useMemo)(()=>Z?N:b.filter(l()(F)),[Z,N,b,F]);return{allData:b,chartData:N,scalesData:R,segmentData:G,timeRangeData:V,paddingData:$}}},83001:function(e,t,r){"use strict";r.d(t,{vw:function(){return S},BO:function(){return I},dt:function(){return k},ST:function(){return P},yK:function(){return w}});var n=r(90089),i=r(17043),o=r(60116),s=r(64986),a=r(59245),l=r(27378),c=r(43137),d=r(19914),u=r(99990),p=r(8788),m=r(24246);let f=()=>{let e=(0,p.bI)(e=>e.calculation),t=(0,p.bI)(e=>e.setCalculationType),r=(0,l.useCallback)(()=>{t("percent"===e.type?"identity":"percent")},[e.type,t]);return(0,m.jsx)(u.rs,{label:d.ag._({id:"controls.calculation.show-in-percentage"}),checked:"percent"===e.type,onChange:r})};var h=r(93477),g=r(41053),b=r(25390),y=r(71238),v=r(80733),j=r(71171);let x=["sx"];function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let w=(0,s.Z)(()=>({chartContainer:{overflow:"hidden",position:"relative",display:"flex",flexDirection:"column",width:"100%",flexGrow:1}})),I=e=>{let{children:t}=e,[r]=(0,y.lY)(y.Sc),n=(0,b.f6)(r),i=(0,y.tH)(r),o=(0,h.fG)(),{bounds:s}=(0,c.gH)(),a=w();return(0,m.jsx)("div",{ref:o,"aria-hidden":"true",className:a.chartContainer,style:{height:i?"initial":s.height,overflow:"auto"},children:t},n.chartType)},S="chart-svg",P=e=>{let{children:t}=e,r=(0,l.useRef)(null),n=(0,v.K)(e=>e.enable),i=(0,v.K)(e=>e.duration),{bounds:o,interactiveFiltersConfig:s}=(0,c.gH)(),{width:d,margins:u,chartHeight:p}=o;return(0,l.useEffect)(()=>{if(r.current){r.current.getAttribute("height")||r.current.setAttribute("height",`${p+u.bottom+u.top}`);let e=(0,a.Z)(r.current);(n?e.transition().duration(i):e).attr("height",`${p+u.bottom+u.top}`)}},[p,u.bottom,u.top,n,i]),(0,m.jsxs)("svg",{ref:r,id:S,width:d,style:{position:"absolute",left:0,top:0},children:[s.calculation.active&&(0,m.jsx)("foreignObject",O(O({},j.nT),{},{width:d-u.right,y:0,height:26,style:{display:"flex"},children:(0,m.jsx)(f,{})})),t]})},k=e=>{let{sx:t}=e,r=(0,n.Z)(e,x),{embedParams:i}=(0,g.lR)();return(0,m.jsx)(o.Z,O({sx:O({display:"flex",flexDirection:"column",gap:4,mt:2,mb:i.optimizeSpace?3:4},t)},r))}},62050:function(e,t,r){"use strict";r.d(t,{WR:function(){return a},v5:function(){return l},zg:function(){return o}});var n=r(93461),i=r(50953);let o=()=>0,s=e=>{let{previousValue:t,nextValue:r,previousTime:i,currentTime:o,nextTime:s}=e;return(0,n.Z)(t,r)((o-i)/(s-i))},a=e=>{let{dataSortedByX:t}=e,r=[],n=[];for(let e=0;e<t.length;e++)null!==t[e].value?r.push(e):n.push(e);for(let e of n){let n=r.findIndex(t=>t>e);if(n){let i=n-1;if(i>=0){let o=t[r[i]],a=t[r[n]];t[e]={date:t[e].date,value:s({previousValue:o.value,nextValue:a.value,previousTime:o.date.getTime(),nextTime:a.date.getTime(),currentTime:t[e].date.getTime()})};continue}}t[e]={date:t[e].date,value:0}}return t},l=e=>!!(0,i.uq)(e)&&["zeros","linear"].includes(e.fields.y.imputationType||"")},80750:function(e,t,r){"use strict";r.d(t,{Ek:function(){return T},YL:function(){return A},eV:function(){return Z}});var n=r(19914),i=r(87026),o=r(64986),s=r(40624),a=r(43605),l=r.n(a),c=r(27378),d=r(43137),u=r(51514),p=r(60090);let m=e=>{let{title:t,values:r,sort:n}=e,i=new Map;i.set(t?[{label:t}]:[],r);let o=Array.from(i.entries());if(n){let e=Object.fromEntries(r.map((e,t)=>[e,t]));o.forEach(t=>{let[r,n]=t;n.sort((t,r)=>(0,p.Z)(e[t],e[r]))})}return o};var f=r(53082),h=r(99990),g=r(60227),b=r(97358),y=r(25390),v=r(71238),j=r(64103),x=r(41494),C=r(85732),O=r(8788),w=r(38248),I=r(7673),S=r(77142),P=r(24246);let k=(0,o.Z)(e=>({legendContainer:{position:"relative",justifyContent:"flex-start",alignItems:"flex-start",flexWrap:"wrap",minHeight:"20px",gap:"1rem 1.5rem",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gridAutoFlow:"row dense"},legendContainerNoGroups:{gridTemplateColumns:"1fr","& $legendGroup":{flexDirection:"row"}},legendGroup:{display:"flex",flexWrap:"wrap",columnGap:e.spacing(3),rowGap:e.spacing(2),flexDirection:"column"},groupHeader:{marginBottom:e.spacing(1),flexWrap:"wrap"}})),_=e=>{let{chartConfig:t,title:r,values:n}=e,i=(0,v.F9)();if("INITIAL"===i.state||"SELECTING_DATASET"===i.state)throw Error(`Cannot call useLegendGroups from state ${i.state}`);let o=(0,v.I3)(t)?t.fields.segment:null;return(0,c.useMemo)(()=>m({title:r,values:n,sort:!!(o&&"sorting"in o)}),[r,n,o])},T=(0,c.memo)(function(e){let{chartConfig:t,symbol:r,getLegendItemDimension:n,interactive:o,showTitle:s,dimensionsById:a,limits:l}=e,{colors:c,getColorLabel:u}=(0,d.gH)(),p="segment"===t.fields.color.type?c.domain():[],m=_({chartConfig:t,values:p}),f=(0,v.I3)(t)&&t.fields.segment&&a?a[t.fields.segment.componentId]:null;return(0,P.jsxs)("div",{children:[s&&f&&(0,P.jsx)(b.K,{component:f,children:(0,P.jsx)(i.Z,{"data-testid":"legendTitle",component:"div",variant:"caption",children:f.label})}),(0,P.jsx)(E,{groups:m,limits:l?.limits.map(e=>{let{configLimit:t,measureLimit:r,limitUnit:n}=e,i=[];switch(r.type){case"single":case"time-range":i=[r.value];break;case"value-range":i=[r.min,r.max];break;default:return r}return{label:r.name,values:i,color:t.color,symbol:t.symbolType?t.symbolType:"dashed"===t.lineType?"dashed-line":"line",unit:n}}),getColor:c,getLabel:u,getItemDimension:n,symbol:r,interactive:o,numberOfOptions:p.length})]})}),D=e=>e.slice(0,3),Z=(0,c.memo)(function(e){let{component:t,getColor:r,useAbbreviations:n,chartConfig:i,observations:o}=e,s=(0,y.In)(i)[t.id],a=(0,c.useMemo)(()=>{let e=(0,I.tf)(t,{sorting:{sortingType:"byAuto",sortingOrder:"asc"},dimensionFilter:s});return l()(t.values,e.map(e=>t=>e(t.label)))},[t,s]),d=(0,c.useCallback)(e=>{if(!n)return t.values.find(t=>t.value===e)?.label;{let r=t.values.find(t=>t.value===e);return r?.alternateName||r?.label}},[t,n]),p=(0,c.useMemo)(()=>{let e=new Set(o.map(e=>e[t.id])),r=a.map(e=>`${e.value}`);return(0,j.i5)(t)||(0,j.vn)(t)?r:r.filter(t=>e.has(d(t)))},[o,a,t,d]),m=_({chartConfig:i,title:t.label,values:p});return(0,P.jsx)(E,{groups:m,getColor:e=>{let n=d(e),i=r({[t.id]:n});return(0,u.ZT)(D(i))},getLabel:d,symbol:"circle",numberOfOptions:a.length})}),E=e=>{let{groups:t,limits:r,getColor:n,getLabel:o,getItemDimension:a,symbol:l,interactive:d,numberOfOptions:u}=e,p=k(),m=(0,O.bI)(e=>e.categories),h=(0,O.bI)(e=>e.addCategory),g=(0,O.bI)(e=>e.removeCategory),b=(0,c.useMemo)(()=>new Set(Object.keys(m)),[m]),y=b.size===u-1,v=(0,S.z)(e=>{let t=y&&!e.target.checked,r=e.target.value;b.has(r)?g(r):t||h(r)}),j=(0,x.D2)({decimals:"auto"});return(0,P.jsx)(f.k,{className:(0,s.Z)(p.legendContainer,1===t.length&&p.legendContainerNoGroups),children:t?t.map((e,s)=>{let[c,u]=e,m=c.map(e=>e.label).join(" > "),f=s===t.length-1,h=c.map(e=>e.label);return(0,P.jsxs)("div",{className:p.legendGroup,"data-testid":"colorLegend",children:[h.length>0?(0,P.jsx)(i.Z,{variant:"h5",display:"flex",alignItems:"center",className:p.groupHeader,children:(0,w.b)(c.map(e=>e.label),e=>(0,P.jsx)(C.Z,{},e))}):null,u.map((e,t)=>{let r=`${e}-${t}`,i=o(e),s=!b.has(i);return(0,P.jsx)(A,{label:i,color:n(e),dimension:a?.(i),symbol:l,interactive:d,onToggle:v,checked:d&&s,disabled:y&&s},r)}),f&&r?r.map((e,t)=>{let{label:r,values:n,color:i,symbol:o,unit:s}=e;return(0,P.jsx)(A,{label:`${r}: ${n.map(j).join("-")}${s?` ${s}`:""}`,color:i,symbol:o},t)}):null]},m)}):null})},M=e=>{let t,{symbol:r,size:n,fill:i}=e;switch(r){case"circle":t=(0,P.jsx)("circle",{cx:.5,cy:.5,r:.5,fill:i});break;case"square":t=(0,P.jsx)("rect",{width:1,height:1,fill:i});break;case"cross":t=(0,P.jsxs)("g",{fill:i,transform:"translate(0 0.05) rotate(45 0.5 0.5)",children:[(0,P.jsx)("rect",{x:.45,y:0,width:.1,height:1}),(0,P.jsx)("rect",{x:0,y:.45,width:1,height:.1})]});break;case"line":t=(0,P.jsx)("line",{x1:0,x2:1,y1:.5,y2:.5,stroke:i,strokeWidth:2.5,vectorEffect:"non-scaling-stroke"});break;case"dashed-line":t=(0,P.jsx)("line",{x1:0,x2:1,y1:.5,y2:.5,stroke:i,strokeWidth:2.5,vectorEffect:"non-scaling-stroke",strokeDashoffset:"3",strokeDasharray:"2 2"});break;case"triangle":t=(0,P.jsx)("polygon",{points:"0.5,0.1339746 0.0669873,0.8660254 0.9330127,0.8660254",transform:"translate(0 0.05)",fill:i});break;default:return r}return(0,P.jsx)("svg",{width:n,height:n,viewBox:"0 0 1 1",style:{minWidth:n,minHeight:n},children:t})},A=e=>{let{label:t,color:r,dimension:o,symbol:s,interactive:a,onToggle:l,checked:c,disabled:d,smaller:u}=e,p=(0,P.jsx)(i.Z,{variant:u?"caption":"body3",style:{wordBreak:"break-word"},children:t});return a&&l?(0,P.jsx)(g.E,{title:d?n.ag._({id:"controls.filters.interactive.color.min-1-filter"}):void 0,children:(0,P.jsx)("div",{children:(0,P.jsx)(h.XZ,{name:t,label:t,value:t,checked:c??!0,onChange:l,color:r,size:u?"sm":"md"})})}):(0,P.jsxs)(f.k,{"data-testid":"legendItem",sx:{alignItems:"center",gap:u?1:2},children:[(0,P.jsx)(M,{symbol:s,size:u?8:12,fill:r}),o?(0,P.jsx)(b.K,{component:o,children:p}):p]})}},35444:function(e,t,r){"use strict";r.d(t,{B:function(){return c},l:function(){return d}});var n=r(90104),i=r.n(n),o=r(56141),s=r.n(o);let a=(e,t)=>s()(Object.keys(e),Object.keys(t))&&s()(e,t),l=e=>Object.keys(e).join(", "),c=e=>{let{cubeIri:t,dataSource:r,unmappedFilters:n}=e,i=l(n);return{sourceType:r.type,sourceUrl:r.url,cubeFilter:{iri:t,filters:n},filterKey:i}},d=(e,t)=>e&&a(e,t)||i()(t)},70022:function(e,t,r){"use strict";r.d(t,{A1:function(){return c},R0:function(){return u},S8:function(){return d},_4:function(){return l}});var n=r(23175),i=r(50228),o=r(47626),s=r(41494);let a=[0,100],l=(e,t)=>{let{normalize:r,getX:s,getY:l,getTime:c,minLimitValue:d,maxLimitValue:u,customDomain:p}=t,m=(0,o.Z)();if(r)m.domain(a);else{if(p)return m.domain(p);let t=(0,n.ZP)(e,e=>s(e)+c?.(e)),r=0,o=0;for(let[,e]of t){let t=e.map(l).filter(e=>null!==e),n=(0,i.Z)(t.filter(e=>e<0)),s=(0,i.Z)(t.filter(e=>e>=0));(void 0===r||n<r)&&(r=n),(void 0===o||s>o)&&(o=s)}m.domain([void 0!==d?Math.min(d,r):r,void 0!==u?Math.max(u,o):o]).nice()}return m},c=(e,t)=>{let{normalize:r,getX:s,getY:l,getTime:c,customDomain:d}=t,u=(0,o.Z)();if(r)u.domain(a);else{if(d)return u.domain(d);let t=(0,n.ZP)(e,e=>l(e)+c?.(e)),r=0,o=0;for(let[,e]of t){let t=e.map(s).filter(e=>null!==e),n=(0,i.Z)(t.filter(e=>e<0)),a=(0,i.Z)(t.filter(e=>e>=0));(void 0===r||n<r)&&(r=n),(void 0===o||a>o)&&(o=a)}u.domain([r,o]).nice()}return u},d=e=>{let{normalize:t,measureId:r,measureUnit:n,formatters:i,formatNumber:o}=e;return(e,a)=>{if(null===e&&null===a)return"-";let l=i[r]??o;if(t){let t=Math.round(e),r=(0,s._1)(a,l,n);return`${t}% (${r})`}return(0,s._1)(e,l,n)}},u=e=>{let{observation:t,series:r,key:n,getAxisValue:i,measureScale:o,fallbackMeasureValue:s,segment:a}=e,l=i(t),c=r.find(e=>e.key===a),d=c?.find(e=>e.data[n]===l);if(!d)return s;let[u,p]=d;return o(1===r.length?p:(u+p)*.5)}},14868:function(e,t,r){"use strict";r.d(t,{A:function(){return j}});var n=r(17043),i=r(19914),o=r(40499),s=r(60090),a=r(31091),l=r.n(a),c=r(27378),d=r(15658),u=r(64103),p=r(41494),m=r(80207),f=r(17703),h=r(49148),g=r(68),b=r(8788);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let j=()=>{let e=(0,h.bU)(),t=(0,p.ls)(),[r]=(0,d.lY)(d.Sc),{potentialTimeRangeFilterIds:n}=(0,b.Rx)(),[{data:i}]=(0,m.aZ)({variables:{state:r,locale:e}});return(0,c.useMemo)(()=>x({formatLocale:t,dimensions:i?.dataCubesComponents.dimensions??[],potentialTimeRangeFilterIds:n}),[i?.dataCubesComponents.dimensions,t,n])},x=e=>{let{formatLocale:t,dimensions:r,potentialTimeRangeFilterIds:n}=e,a=r.filter(e=>(0,u.aw)(e)&&n.includes(e.id)),c=a.sort((e,t)=>o.Z(g.pq.get(e.timeUnit)??0,g.pq.get(t.timeUnit)??0))[0]?.timeUnit,d=g.db.get(c),p=a.flatMap(e=>{let r=t.format(d),n=t.parse(e.timeFormat),i=(0,u.eP)(e);return e.values.map(e=>{let t=r(n(`${i?(0,u.Mp)(e):e.value}`));return v(v({},e),{},{value:t,label:t})})});return{__typename:"TemporalDimension",cubeIri:"all",id:(0,f.OK)({unversionedCubeIri:"all",unversionedComponentIri:"combined-date-filter"}),label:i.ag._({id:"controls.section.shared-filters.date"}),isKeyDimension:!0,isNumerical:!1,values:l()(p,"value").sort((e,t)=>(0,s.Z)(e.value,t.value)),relatedLimitValues:[],timeUnit:c,timeFormat:d}}},93477:function(e,t,r){"use strict";r.d(t,{Qj:function(){return c},fG:function(){return p},m2:function(){return l},tH:function(){return u}});var n=r(27378),i=r(80733),o=r(82395),s=r(10635),a=r(24246);let l="VISUALIZE-CHART-RESIZE",c=e=>{let{children:t}=e,[r,l,c]=(0,o.y)(),u=(0,s.k)(l,500),p=(0,s.k)(c,500),m=u!==l||p!==c||l===o.Q&&c===o.Q,f=(0,i.K)(e=>e.brushing),h=(0,i.K)(e=>e.setEnable);(0,n.useEffect)(()=>{f||h(!m)},[f,m,h]);let g=(0,n.useMemo)(()=>({width:l,height:c,ref:r}),[l,c,r]);return(0,a.jsx)(d.Provider,{value:g,children:t})},d=(0,n.createContext)(void 0),u=()=>{let e=(0,n.useContext)(d);if(void 0===e)throw Error("You need to wrap your component in <ChartObserverContextProvider /> to useSize()");return{width:e.width,height:e.height}},p=()=>{let e=(0,n.useContext)(d);if(void 0===e)throw Error("You need to wrap your component in <ChartObserverContextProvider /> to useObserverRef()");return e.ref}},78222:function(e,t,r){"use strict";r.d(t,{G:function(){return s}});var n=r(64986),i=r(24246);let o=(0,n.Z)(e=>({root:{display:"flex",alignItems:"center",gap:e.spacing(2),height:"fit-content",marginTop:"-0.33rem"}})),s=e=>{let{children:t}=e,r=o();return(0,i.jsx)("div",{className:r.root,children:t})}},90577:function(e,t,r){"use strict";r.d(t,{H:function(){return u},Y:function(){return p}});var n=r(90089),i=r(17043),o=r(12548),s=r(48947),a=r(24246);let l=["sx"];function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let u=e=>(0,a.jsx)(o.Z,d({size:"sm",startIcon:(0,a.jsx)(s.JO,{name:"plus",size:20})},e)),p=e=>{let{sx:t}=e,r=(0,n.Z)(e,l);return(0,a.jsx)(u,d({size:"sm",variant:"outlined",sx:d({width:"fit-content",mt:4},t)},r))}},32027:function(e,t,r){"use strict";r.d(t,{Ik:function(){return m},N7:function(){return p},RM:function(){return u},_X:function(){return d}});var n=r(17043),i=r(1869),o=r(42180),s=r(46297);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let c={content:'" "',position:"absolute",display:"block",width:"10px",height:"10px",margin:"auto",background:"white",transform:"rotate(45deg)"},d=(0,i.ZP)(o.Z)({[`& .${s.Z.root}`]:{overflow:"visible","&:before":l(l({},c),{},{top:-5,left:"0%",right:0})}}),u=(0,i.ZP)(o.Z)({[`& .${s.Z.root}`]:{overflow:"visible","&:before":l(l({},c),{},{bottom:-5,left:"0%",right:0})}}),p=(0,i.ZP)(o.Z)({[`& .${s.Z.root}`]:{overflow:"visible","&:before":l(l({},c),{},{top:-5,left:"0%",right:0})}}),m=(0,i.ZP)(o.Z)({[`& .${s.Z.root}`]:{overflow:"visible","&:before":l(l({},c),{},{bottom:-5,left:0,right:"0%"})}})},16370:function(e,t,r){"use strict";r.d(t,{_:function(){return m}});var n=r(17043),i=r(60116),o=r(77379),s=r(97091),a=r(17899),l=r(80207),c=r(49148),d=r(24246);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let m=e=>{let{dataSource:t,chartConfig:r,dashboardFilters:n,sx:u}=e,m=(0,c.bU)(),f=(0,s.Xd)({chartConfig:r}),h={sourceType:t.type,sourceUrl:t.url,locale:m},[{data:g}]=(0,l.bi)({variables:p(p({},h),{},{cubeFilters:r.cubes.map(e=>({iri:e.iri}))})}),[{data:b,fetching:y}]=(0,l.k$)({chartConfig:r,variables:p(p({},h),{},{cubeFilters:r.cubes.map(e=>({iri:e.iri,componentIds:f,joinBy:e.joinBy}))})}),v=(0,s.n9)({chartConfig:r,dashboardFilters:n,componentIds:f}),[{data:j}]=(0,l.XO)({chartConfig:r,variables:p(p({},h),{},{cubeFilters:v}),pause:y});return g?.dataCubesMetadata&&b?.dataCubesComponents&&j?.dataCubesObservations?(0,d.jsx)(i.Z,{sx:p({maxHeight:600,overflow:"auto"},u),children:(0,d.jsx)(o.k,{title:g.dataCubesMetadata.map(e=>e.title).join(", "),dimensions:b.dataCubesComponents.dimensions,measures:b.dataCubesComponents.measures,observations:j.dataCubesObservations.data,linkToMetadataPanel:!0})}):(0,d.jsx)(a.gb,{})}},97971:function(e,t,r){"use strict";r.d(t,{x:function(){return s}});var n=r(35800),i=r(17899),o=r(24246);let s=e=>{let{children:t,resetKeys:r}=e;return(0,o.jsx)(n.ErrorBoundary,{FallbackComponent:i.uo,resetKeys:r,children:t})}},47612:function(e,t,r){"use strict";r.d(t,{h$:function(){return T},Tc:function(){return D},cS:function(){return N},C4:function(){return _}});var n=r(17043),i=r(96338),o=r(19914),s=r(60116),a=r(87026),l=r(98505),c=r(64986),d=r(31091),u=r.n(d),p=r(27378),m=r(97091),f=r(80750),h=r(97358),g=r(71238),b=r(64103),y=r(95428),v=r(41494),j=r(80207),x=r(49148),C=r(8788),O=r(24246);let w=e=>{let{cubeIri:t,dataSource:r,chartConfig:n,dashboardFilters:o,components:s}=e,l=(0,x.bU)(),c=(0,v.z6)(),d=(0,C.bI)(e=>e.timeSlider),u=(0,g.MO)(n),f=(0,m.n9)({chartConfig:n,dashboardFilters:o,componentIds:(0,m.Xd)({chartConfig:n})}),w=(0,p.useMemo)(()=>f.filter(e=>e.iri===t),[f,t]),[{data:I,fetching:S}]=(0,j.k$)({chartConfig:n,variables:{sourceType:r.type,sourceUrl:r.url,locale:l,cubeFilters:n.cubes.map(e=>{let t=w.find(t=>t.iri===e.iri);return{iri:t?.iri??e.iri,componentIds:t?.componentIds,filters:t?.filters,joinBy:t?.joinBy,loadValues:!0}})}}),P=(0,p.useMemo)(()=>I?.dataCubesComponents&&0!==s.length?f.flatMap(e=>{let r=Object.entries(e.filters??{}).flatMap(r=>{let[n,i]=r;if(i?.type!=="single")return[];let o=I.dataCubesComponents.dimensions.find(r=>r.id===n&&r.cubeIri===e.iri&&r.cubeIri===t);if(!o)return[];let s=(0,y.U)(i.value)?o.values[o.values.length-1].value:i.value,a=(0,b.fF)(o)?{value:s,label:c(`${s}`,o.timeUnit)}:o.values.find(e=>e.value===s);return[{dimension:o,value:a}]});if(u){let e=s.find(e=>e.id===u.componentId);d.value&&("interval"===d.type&&(0,b.fF)(e)&&r.push({dimension:e,value:{value:`${d.value}`,label:c(d.value,e.timeUnit)}}),"ordinal"===d.type&&d.value&&(0,b.a6)(e)&&r.push({dimension:e,value:{value:d.value,label:d.value}}))}return r}):[],[I?.dataCubesComponents,s,f,u,c,t,d.value,d.type]);return S?(0,O.jsxs)(a.Z,{component:"div",variant:"caption",children:[(0,O.jsx)(i.cC,{id:"controls.section.data.filters"}),":"," ",(0,O.jsx)(i.cC,{id:"hint.loading.data"})]}):P.length?(0,O.jsxs)(a.Z,{component:"div",variant:"caption","data-testid":"chart-filters-list",children:[(0,O.jsxs)(a.Z,{component:"span",variant:"inherit",sx:{mr:1},children:[(0,O.jsx)(i.cC,{id:"controls.section.data.filters"}),":"]}),P.map((e,t)=>{let{dimension:r,value:n}=e;return(0,O.jsxs)(p.Fragment,{children:[(0,O.jsxs)("span",{children:[(0,O.jsx)(h.K,{component:r,children:(0,O.jsx)("span",{children:r.label})}),": "]}),(0,O.jsx)("span",{children:n&&n.label}),t<P.length-1&&", "]},r.id)})]}):null};var I=r(53082),S=r(71171);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let _=(0,c.Z)(e=>({actions:{marginTop:t=>{let{useMarginTop:r}=t;return r?e.spacing(2):0},"--column-gap":"16px",columnGap:"var(--column-gap)",rowGap:1,display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap",overflow:"hidden",fontSize:e.typography.caption.fontSize,"& > button":{minWidth:"auto"}}})),T="chart-footnotes",D=e=>{let{dataSource:t,chartConfig:r,dashboardFilters:n,components:l,showVisualizeLink:c=!1,hideFilters:d,hideMetadata:f,configKey:g,metadataPanelProps:b}=e,y=(0,x.bU)(),C=(0,p.useMemo)(()=>(0,m.Bu)(r,{components:l}),[r,l]),[{data:S}]=(0,j.bi)({variables:{sourceType:t.type,sourceUrl:t.url,locale:y,cubeFilters:u()(C.map(e=>({iri:e.cubeIri})),"iri")},pause:!C.length}),P=(0,v.ls)(),_=!Z(r);return(0,O.jsxs)(s.Z,{className:T,sx:{display:"flex",flexDirection:"column",mt:1,"& > :not(:last-child)":{mb:3}},children:[S?.dataCubesMetadata.map(e=>_&&f&&d?null:O.jsxs("div",{children:[O.jsx(E,{chartConfig:r,components:l,cubeIri:e.iri}),d?null:O.jsx(w,{dataSource:t,chartConfig:r,dashboardFilters:n,components:l,cubeIri:e.iri}),f?null:O.jsxs(O.Fragment,{children:[O.jsxs(a.Z,{variant:"caption",children:[O.jsx(h.K,{children:O.jsx(i.cC,{id:"dataset.footnotes.dataset"})}),": ",e.title]}),e.dateModified?O.jsxs(a.Z,{variant:"caption",children:[", ",O.jsx(i.cC,{id:"dataset.footnotes.updated"}),":"," ",P.format("%d.%m.%Y %H:%M")(new Date(e.dateModified))]}):null]})]},e.iri)),(0,O.jsxs)(I.k,{justifyContent:"space-between",alignItems:"center",children:[b?(0,O.jsx)(h.U,k(k({dataSource:t,chartConfig:r,dashboardFilters:n},b),{},{smallerToggle:!0})):null,c&&g?(0,O.jsx)(N,{configKey:g,createdWith:o.ag._({id:"metadata.link.created.with"})}):null]})]})},Z=e=>(0,g.tJ)(e),E=e=>{let{chartConfig:t,components:r,cubeIri:n}=e;if(!Z(t))return null;switch(t.chartType){case"comboLineColumn":return(0,O.jsx)(A,{chartConfig:t,components:r,cubeIri:n});case"comboLineDual":return(0,O.jsx)(L,{chartConfig:t,components:r,cubeIri:n});case"comboLineSingle":return(0,O.jsx)(F,{chartConfig:t,components:r,cubeIri:n});default:return null}},M=e=>{let{children:t}=e;return(0,O.jsx)(I.k,{sx:{flexWrap:"wrap",rowGap:1,columnGap:3,mb:1},children:t})},A=e=>{let{chartConfig:t,components:r,cubeIri:n}=e,{y:{columnComponentId:i,lineComponentId:o,lineAxisOrientation:s}}=t.fields,a=r.find(e=>e.id===i&&e.cubeIri===n),l=r.find(e=>e.id===o&&e.cubeIri===n),c="left"===s?l:a,d="left"===s?a:l;return c||d?(0,O.jsxs)(M,{children:[c&&(0,O.jsx)(f.YL,{label:c.label,color:t.fields.color.colorMapping[c.id],symbol:"left"===s?"line":"square",dimension:c,smaller:!0}),d&&(0,O.jsx)(f.YL,{label:d.label,color:t.fields.color.colorMapping[d.id],symbol:"left"===s?"square":"line",dimension:d,smaller:!0})]}):null},L=e=>{let{chartConfig:t,components:r,cubeIri:n}=e,{y:{leftAxisComponentId:i,rightAxisComponentId:o}}=t.fields,s=r.find(e=>e.id===i&&e.cubeIri===n),a=r.find(e=>e.id===o&&e.cubeIri===n);return s||a?(0,O.jsxs)(M,{children:[s&&(0,O.jsx)(f.YL,{label:s.label,color:t.fields.color.colorMapping[s.id],symbol:"line",dimension:s,smaller:!0}),a&&(0,O.jsx)(f.YL,{label:a.label,color:t.fields.color.colorMapping[a.id],symbol:"line",dimension:a,smaller:!0})]}):null},F=e=>{let{chartConfig:t,components:r,cubeIri:n}=e,{y:{componentIds:i}}=t.fields;return i.length?(0,O.jsx)(M,{children:i.map(e=>{let i=r.find(t=>t.id===e&&t.cubeIri===n);return i?(0,O.jsx)(f.YL,{label:i.label,color:t.fields.color.colorMapping[i.id],symbol:"line",dimension:i,smaller:!0},i.id):null})}):null},N=e=>{let{createdWith:t,configKey:r}=e,n=(0,x.bU)();return(0,O.jsxs)(a.Z,k(k({variant:"caption",color:"grey.600"},S.nT),{},{children:[t,(0,O.jsxs)(l.Z,{href:`https://visualize.admin.ch/${n}/v/${r}`,target:"_blank",rel:"noopener noreferrer",sx:{"&:hover":{textDecoration:"none"}},children:[" ","visualize.admin.ch"]})]}))}},47855:function(e,t,r){"use strict";r.d(t,{D:function(){return g},b:function(){return f}});var n=r(17043),i=r(40624),o=r(65772),s=r(45980),a=r(68227),l=r(71238),c=r(27102),d=r(92178),u=r(24246);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let f={root:"chart-panel-grid-layout",dragHandle:"chart-panel-grid-layout-drag-handle"},h=e=>(0,s.pipe)(l.yU.decode(e),(0,o.fold)(e=>{console.error("Error while decoding react-grid-layout",e)},e=>e)),g=e=>{let{blocks:t,renderBlock:r,className:n}=e,[o,s]=(0,c.lY)(l.Sc),p=o.layout;(0,d.h)("dashboard"===p.type&&"canvas"===p.layout,"ChartPanelLayoutGrid should be rendered only for dashboard layout with canvas");let g=e=>{(0,d.h)("dashboard"===p.type&&"canvas"===p.layout,"ChartPanelLayoutGrid should be rendered only for dashboard layout with canvas");let t=h(e);t&&s({type:"LAYOUT_CHANGED",value:m(m({},p),{},{layouts:t})})};return(0,u.jsx)(a.b0,{className:(0,i.Z)(f.root,n),layouts:p.layouts,resize:"LAYOUTING"===o.state,draggableHandle:`.${f.dragHandle}`,onLayoutChange:(e,t)=>g(t),breakpoints:a.$X,children:t.map(r)},o.state)}},52137:function(e,t,r){"use strict";r.d(t,{WK:function(){return T},hC:function(){return k},KN:function(){return P}});var n=r(17043),i=r(90089),o=r(60116),s=r(64986),a=r(40624),l=r(27378),c=r(47855),d=r(24663),u=r(50937),p=r.n(u),m=r(90717),f=r(24246);let h=e=>{let{row:t}=e,r=(0,m.F)(),n=(0,d.Z)(r.breakpoints.down("md"));switch(t.type){case"wide":return t.renderBlock(t.block);case"narrow":if(n)return(0,f.jsx)(f.Fragment,{children:t.blocks.map(t.renderBlock)});return(0,f.jsx)(o.Z,{className:p().root,children:t.blocks.map(t.renderBlock)})}},g=e=>{let{blocks:t,renderBlock:r}=e,n=[];for(let e=0;e<t.length;e+=1)if(e%3==0&&n.push({type:"wide",block:t[e],renderBlock:r}),e%3==1){let i=t[e],o=t[e+1];n.push({type:"narrow",blocks:o?[i,o]:[i],renderBlock:r})}return n};var b=r(97614),y=r(65619),v=r(78839),j=r(71238),x=r(27102);let C=["children","editing","layout"],O=["children","renderBlock","className","layoutType"];function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let S=(0,s.Z)(e=>({panelLayout:{containerType:"inline-size",display:"flex",flexDirection:"column",gap:e.spacing(4)},chartWrapper:{display:e=>{let{freeCanvas:t}=e;return t?"flex":"contents"},flexDirection:"column",overflow:"hidden",[`.${c.b.root} &`]:{transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.shortest})},[`.${c.b.root} &:has(.${c.b.dragHandle}:hover)`]:{boxShadow:e.shadows[6]}},chartWrapperInner:{display:e=>{let{freeCanvas:t,isEditing:r}=e;return r||!t?"contents":"flex"},flexDirection:"column",width:"auto",height:"100%"}})),P=e=>`chart-wrapper-${e}`,k=(0,l.forwardRef)((e,t)=>{let{children:r,editing:n,layout:s}=e,l=(0,i.Z)(e,C),c=S({freeCanvas:s?.type==="dashboard"&&"canvas"===s.layout,isEditing:n});return(0,f.jsxs)(o.Z,I(I({ref:t},l),{},{id:P(e.chartKey),className:(0,a.Z)(c.chartWrapper,e.className),children:[(n||s?.type==="tab")&&(0,f.jsx)(b.S,{}),(0,f.jsx)(o.Z,{className:c.chartWrapperInner,sx:{minHeight:[150,300,500]},children:r})]}))}),_={vertical:e=>{let{blocks:t,renderBlock:r}=e;return(0,f.jsx)(f.Fragment,{children:t.map(r)})},tall:e=>{let{blocks:t,renderBlock:r}=e,n=(0,l.useMemo)(()=>g({blocks:t,renderBlock:r}),[t,r]);return(0,f.jsx)(f.Fragment,{children:n.map((e,t)=>(0,f.jsx)(h,{row:e},t))})},canvas:c.D},T=e=>{let{children:t,renderBlock:r,className:n,layoutType:o}=e,s=(0,i.Z)(e,O),[l]=(0,x.lY)(j.Sc),c=S({}),d=_[o],{layout:u}=l,{blocks:p}=u;return(0,v.E1)(),(0,f.jsxs)("div",I(I({className:(0,a.Z)(c.panelLayout,n)},s),{},{children:["dashboard"===l.layout.type?(0,f.jsx)(y.u,{},l.chartConfigs.map(e=>e.key).join(",")):null,(0,f.jsx)(d,{blocks:p,renderBlock:r})]}))}},97614:function(e,t,r){"use strict";r.d(t,{S:function(){return U},Z:function(){return K}});var n=r(17043),i=r(96338),o=r(19914),s=r(91282),a=r(62033),l=r(26398),c=r(87026),d=r(12548),u=r(55927),p=r(64986),m=r(40624),f=r(27378),h=r(3473),g=r(90577),b=r(32027),y=r(32597),v=r(70185),j=r(53082),x=r(7663),C=r(41094),O=r(1869),w=r(65858),I=r(48921);let S=(0,O.ZP)(C.Z)(e=>{let{theme:t}=e;return{border:"none !important",[`& .${w.Z.indicator}`]:{display:"none"},[`& .${w.Z.scrollButtons}`]:{display:"flex",justifyContent:"center",alignItems:"center"},"&:before":{content:'" "',display:"block",position:"absolute",bottom:0,left:0,right:0,margin:"auto",borderBottom:`1px solid ${t.palette.divider}`}}}),P=(0,O.ZP)(I.Z)(e=>{let{theme:t}=e;return{marginRight:t.spacing(2),background:t.palette.background.paper,border:`1px solid ${t.palette.divider}`,position:"relative",top:0,zIndex:1,"&.Mui-selected":{borderBottomColor:t.palette.background.paper},minWidth:"fit-content",padding:t.spacing(0,2)}});var k=r(25390),_=r(71238),T=r(42601),D=r(71023),Z=r(10359),E=r(48947);r(93912);var M=r(49148),A=r(77142),L=r(24246);function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let R={popoverOpen:!1,popoverType:"add",activeChartKey:""},G=(0,f.createContext)(void 0),V=()=>{let e=(0,f.useContext)(G);if(void 0===e)throw Error("You need to wrap your component in <TabsStateProvider /> to useTabsState()");return e},$=e=>{let{children:t}=e,{0:r,1:n}=(0,f.useState)(R);return(0,L.jsx)(G.Provider,{value:[r,n],children:t})},U=()=>{let[e]=(0,_.lY)(_.Sc),t=(0,_.N3)(e)||(0,_.VF)(e)||(0,_.cX)(e),r=(0,M.bU)();if(!t&&1===e.chartConfigs.length)return null;let n=(0,k.f6)(e),i=e.chartConfigs.map(e=>{let{key:t,chartType:i,meta:o}=e;return{key:t,chartType:i,active:t===n.key,label:""!==o.label[r]?o.label[r]:void 0}});return(0,L.jsx)($,{children:t?(0,L.jsx)(z,{state:e,chartConfig:n,data:i}):(0,L.jsx)(B,{data:i})})},z=e=>{let{state:t,chartConfig:r,data:n}=e,[,s]=(0,_.lY)(),u=(0,_.N3)(t),[p,m]=V(),{0:h,1:g}=(0,f.useState)(null),v=(0,A.z)(()=>{g(null),m({popoverOpen:!1,popoverType:p.popoverType,activeChartKey:p.activeChartKey})});(0,f.useEffect)(()=>{v()},[t.activeChartKey]);let{open:j}=(0,T.f)(),C=e=>{s({type:"SWITCH_ACTIVE_CHART",value:e})};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Y,{data:n,addable:u,editable:u,draggable:t.chartConfigs.length>1,onChartAdd:e=>{g(e.currentTarget),m({popoverOpen:!0,popoverType:"add",activeChartKey:p.activeChartKey})},onChartEdit:(e,t)=>{g(e.currentTarget),m({popoverOpen:!0,popoverType:"edit",activeChartKey:t})},onChartSwitch:C}),"add"===p.popoverType?(0,L.jsx)(b._X,{id:"chart-selection-popover",open:p.popoverOpen,anchorEl:h,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},onClose:v,PaperProps:{sx:{width:"calc(320px + 2rem)",mt:3,py:"1rem","& > .MuiList-root":{py:0}}},children:(0,L.jsxs)(a.Z,{divider:(0,L.jsx)(l.Z,{sx:{mx:"1.5rem"}}),gap:"0.5rem",direction:"column",children:[(0,L.jsxs)(a.Z,{direction:"column",gap:"0.5rem",m:"1rem",children:[(0,L.jsx)(c.Z,{variant:"body3",textAlign:"center",gutterBottom:!0,children:(0,L.jsx)(i.cC,{id:"chart-selection-tabs.add-chart-same-dataset.caption"})}),(0,L.jsx)(D.M,{state:t,type:"add",showHelp:!1,showComparisonCharts:!1,chartKey:p.activeChartKey??r.key,sx:{pb:3}})]}),(0,L.jsxs)(a.Z,{direction:"column",gap:"0.5rem",mx:"1.5rem",my:"1rem",children:[(0,L.jsx)(c.Z,{variant:"body3",textAlign:"center",gutterBottom:!0,children:(0,L.jsx)(i.cC,{id:"chart-selection-tabs.add-chart-different-dataset.caption"})}),(0,L.jsx)(d.Z,{fullWidth:!0,onClick:()=>{m(N(N({},p),{},{popoverOpen:!1})),j()},sx:{justifyContent:"center"},children:(0,L.jsx)(i.cC,{id:"chart-selection-tabs.add-chart-different-dataset.button"})})]})]})}):null,"edit"===p.popoverType?(0,L.jsxs)(b._X,{id:"chart-selection-popover",open:p.popoverOpen,anchorEl:h,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},onClose:v,children:[u&&(0,L.jsx)(x.M,{as:"menuitem",type:"button",leadingIconName:"text",label:(0,L.jsx)(i.cC,{id:"chart-controls.edit-tab-label"}),onClick:()=>{C(p.activeChartKey),s({type:"CHART_ACTIVE_FIELD_CHANGE",value:"label"}),v()}}),(0,L.jsx)(y.VQ,{chartConfig:(0,k.f6)(t,p.activeChartKey),onSuccess:v}),t.chartConfigs.length>1&&(0,L.jsx)(x.M,{as:"menuitem",type:"button",leadingIconName:"trash",label:(0,L.jsx)(i.cC,{id:"chart-controls.delete"}),color:"red",requireConfirmation:!0,confirmationTitle:o.ag._({id:"chat-preview.delete.title"}),confirmationText:o.ag._({id:"chat-preview.delete.confirmation"}),onClick:()=>{s({type:"CHART_CONFIG_REMOVE",value:{chartKey:p.activeChartKey}}),v()}})]}):null]})},B=e=>{let{data:t}=e,[,r]=(0,_.lY)(_.s9);return(0,L.jsx)(Y,{data:t,addable:!1,editable:!1,draggable:!1,onChartSwitch:e=>{r({type:"SWITCH_ACTIVE_CHART",value:e})}})},H=e=>{let{children:t,value:r}=e;return(0,L.jsx)(L.Fragment,{children:t})},W=(0,p.Z)(e=>({root:{display:"flex",alignItems:"center"},tab:{zIndex:1,maxWidth:"auto"},tabList:{top:1,border:"1px solid",borderColor:e.palette.divider,borderTop:0,borderBottom:0,position:"relative","--bg":e.palette.background.paper,"--cut-off-width":"1rem",[`& .${u.Z.root}`]:{maxWidth:"max-content"}},scrollButton:{display:"flex",justifyContent:"center",alignItems:"center",width:"2.5rem",minWidth:"2.5rem",padding:0,minHeight:0,color:e.palette.text.primary,"&:hover":{backgroundColor:"transparent"},"& > svg":{pointerEvents:"none"}}})),Y=e=>{let{data:t,addable:r,editable:n,draggable:o,onChartEdit:a,onChartAdd:l,onChartSwitch:c}=e,u=W(),[p,b]=(0,_.lY)(_.Sc),y=t.findIndex(e=>e.active);return(0,L.jsxs)("div",{className:u.root,children:[(0,L.jsx)(s.ZP,{value:`${y}`,children:(0,L.jsx)(h.Z5,{onDragEnd:e=>{e.destination&&e.source.index!==e.destination.index&&b({type:"CHART_CONFIG_REORDER",value:{oldIndex:e.source.index,newIndex:e.destination.index}})},children:(0,L.jsx)(h.bK,{droppableId:"droppable",direction:"horizontal",children:e=>(0,L.jsxs)(S,{ref:e.innerRef,variant:"scrollable",className:u.tabList,ScrollButtonComponent:e=>{let{direction:t,disabled:r,onClick:n}=e;return(0,L.jsx)(d.Z,{className:u.scrollButton,onClick:n,style:{cursor:r?"auto":"pointer"},variant:"text",children:(0,L.jsx)(E.JO,{name:"left"===t?"chevronLeft":"chevronRight"})})},children:[t.map((e,t)=>(0,L.jsx)(H,{value:`${t}`,children:(0,L.jsx)(h._l,{draggableId:e.key,index:t,children:(r,i)=>{let{style:s}=r.draggableProps,l=s?.transform?`${s.transform.split(",")[0]}, 0px)`:void 0;return(0,f.createElement)(P,N(N(N({ref:r.innerRef},r.draggableProps),r.dragHandleProps),{},{style:N(N({},s),{},{transform:l,opacity:1}),component:"div",key:e.key,value:`${t}`,"data-testid":"chart-selection-tab",className:(0,m.Z)(u.tab,t===y?"Mui-selected":""),sx:{px:0,minWidth:e.label?180:0},label:(0,L.jsx)(q,{iconName:(0,Z.tc)(e.chartType),chartKey:e.key,editable:n,draggable:o,active:e.active,label:e.label,dragging:i.isDragging,onChevronDownClick:t=>{a?.(t,e.key)},onSwitchClick:()=>{c?.(e.key)}})}))}})},e.key)),(0,L.jsx)(H,{children:(0,L.jsx)("div",{style:{opacity:0},children:e.placeholder})})]})})})}),r&&(0,L.jsx)(g.H,{onClick:l,children:(0,L.jsx)(i.cC,{id:"chart-selection-tabs.add-chart"})})]})},K=(0,p.Z)(e=>{let{palette:t,spacing:r}=e;return{root:{"--bg":t.background.paper,backgroundColor:"var(--bg)",alignItems:"center",padding:r(4),borderTopLeftRadius:r(1),borderTopRightRadius:r(1),cursor:"default",textTransform:"none",width:"100%",justifyContent:"stretch"},label:{flexShrink:1,flexGrow:1,marginLeft:"-0.5rem",color:"inherit",flexWrap:"nowrap",whiteSpace:"nowrap",minWidth:0,maxWidth:400,overflow:"hidden",minHeight:"100%",position:"relative",display:"flex",cursor:"pointer",alignItems:"center",marginRight:"0.15rem","&:after":{content:'" "',position:"absolute",right:0,top:0,bottom:0,height:"auto",width:"10px",backgroundImage:"linear-gradient(to right, rgba(255, 255, 255, 0), var(--bg))"}},chartIconWrapper:{minWidth:"fit-content",display:"flex",alignItems:"center",gap:r(2)},editIconWrapper:{padding:0,minWidth:"fit-content",transition:"0.125s ease color","&:hover":{background:"transparent"}},dragIconWrapper:{width:24,height:24,color:t.grey[500],cursor:"grab"}}}),q=e=>{let{iconName:t,chartKey:r,editable:n,draggable:i,active:s,label:a,dragging:l,onChevronDownClick:u,onSwitchClick:p}=e,m=K({active:s,dragging:l}),[f,h]=(0,_.lY)(),g=n&&!a,b=o.ag._({id:"chart-selection-tabs.no-label"});return(0,L.jsxs)(j.k,{sx:{alignItems:"center",gap:2,p:2,pl:4},children:[(0,L.jsxs)(d.Z,{variant:"text",onClick:()=>{p?.(),n&&h({type:"CHART_ACTIVE_FIELD_CHANGE",value:void 0})},sx:{alignItems:"center",gap:2},children:[(0,L.jsx)(E.JO,{name:t}),(0,L.jsx)(c.Z,{variant:"caption",sx:{color:e=>a||!n?"inherit":`${e.palette.text.secondary} !important`},children:a||g?a||`[ ${b} ]`:null})]}),n&&(0,L.jsx)(d.Z,{variant:"text",onClick:e=>u?.(e,r),className:m.editIconWrapper,children:(0,L.jsx)(E.JO,{name:"chevronDown"})}),i&&(0,L.jsx)(v.D,{dragging:l})]})}},32597:function(e,t,r){"use strict";r.d(t,{vA:function(){return er},xx:function(){return ei},iA:function(){return eo},Ir:function(){return em},I1:function(){return ep},VQ:function(){return el},TZ:function(){return en}});var n=r(17043),i=r(96338),o=r(19914),s=r(60116),a=r(54417),l=r(97901),c=r(43922),d=r(88424),u=r(64986),p=r(59245),m=r(69689),f=r.n(m),h=r(31091),g=r.n(h),b=r(27378),y=r(37634),v=r(64414),j=r(48863),x=r(53082),C=r(17899),O=r(25390),w=r(77167),I=r(64103),S=r(80207),P=r(49148),k=r(8788),_=r(43605),T=r.n(_),D=r(95428),Z=r(7673);let E=(e,t)=>{if(e===D.g&&t?.values.length){let e=(0,Z.tf)(t),r=T()(t.values,e.map(e=>t=>e(t.label)));return r[r.length-1]?.value}return e},M=(e,t)=>(0,b.useMemo)(()=>E(e,t),[e,t]);var A=r(77142),L=r(24246);let F=e=>{let{dimensionId:t,dataSource:r,chartConfig:n,dataFilters:i,filters:o,disabled:s}=e,a=(0,P.bU)(),l=(0,j.$)(),c=(0,k.bI)(e=>e.updateDataFilter),d=(0,k.bI)(e=>e.setMultiDataFilter),u=(0,b.useMemo)(()=>o.map(e=>{let t=(0,O.jW)(n.cubes,{cubeIri:e.cubeIri}),r=Object.fromEntries(Object.entries(e.interactiveFilters).map(t=>{let[r,n]=t;return[e.componentIdResolution[r]??r,n]})),i=Object.fromEntries(Object.entries((0,v.rO)({filters:t,interactiveFilters:r})).map(t=>{let[r,n]=t;return[e.componentIdResolution[r]??r,n]}));return{cubeIri:e.cubeIri,resolvedDimensionId:e.resolvedDimensionId,resolvedQueryFilters:i}}),[o,n.cubes]),p=(0,b.useMemo)(()=>u.map(e=>Object.entries(e.resolvedQueryFilters).map(e=>{let[t,r]=e;return`${t}: ${JSON.stringify(r)}`}).join(",")).join(" | "),[u]),[{data:m,fetching:f}]=(0,S.k$)({chartConfig:n,variables:{sourceType:r.type,sourceUrl:r.url,locale:a,cubeFilters:u.map(e=>({iri:e.cubeIri,componentIds:[e.resolvedDimensionId],filters:e.resolvedQueryFilters,loadValues:!0})),filterKeys:p},keepPreviousData:!0}),h=m?.dataCubesComponents.dimensions[0],g=h?.hierarchy,y=(0,A.z)(e=>{let r=e.target.value;Array.isArray(r)?d(t,r):c(t,r)}),_=(0,A.z)(e=>{d(t,e)}),T=(0,b.useMemo)(()=>{if(h)return(0,O.jW)(n.cubes,{cubeIri:h.cubeIri,joined:!0})[t]},[h,n.cubes,t]),D=T&&"single"===T.type?T.value:void 0,Z=h&&i[t]?.type==="single"?i[t].value:null,E=h?i[t]?.type==="multi"?Object.keys(i[t]?.values??{}):i[t]?.type==="single"?[i[t].value]:[]:[],F="multi"===(n.interactiveFiltersConfig.dataFilters.filterTypes[t]??(T?.type==="multi"?"multi":"single")),N=M(Z,h),R=M(D,h),G=N??R??w.P,V=F?E:[G].filter(e=>e!==w.P).map(e=>String(e));return(0,b.useEffect)(()=>{let e=h?.values.map(e=>e.value)??[];if(F){l.set(`interactive-filter-${t}`,f);return}N&&e.includes(N)||N===w.P||!T?(c(t,N||w.P),l.set(`interactive-filter-${t}`,f)):(f||0===e.length)&&l.set(`interactive-filter-${t}`,f)},[l,Z,h?.values,t,f,y,D,c,T,N,F]),h?(0,L.jsx)(x.k,{sx:{mr:3,width:"100%",flex:"1 1 100%",":last-of-type":{mr:0}," > div":{width:"100%"}},children:(0,I.fF)(h)?(0,L.jsx)(v.be,{configFilter:T,value:G,dimension:h,onChange:y,disabled:s}):g?(0,L.jsx)(v.eR,{configFilter:T,dimension:h,onChange:y,onMultiChange:_,hierarchy:g,value:G,values:V,isMulti:F,disabled:s}):(0,L.jsx)(v.Bq,{configFilter:T,dimension:h,onChange:y,value:G,values:V,isMulti:F,onMultiChange:_,disabled:s})}):(0,L.jsx)(C.gb,{})},N=e=>{let{open:t,dataSource:r,chartConfig:n,loading:i,groupedPreparedFilters:o,componentIds:a}=e,l=(0,k.bI)(e=>e.dataFilters);return a&&a.length>0?(0,L.jsx)(s.Z,{"data-testid":"published-chart-interactive-filters",sx:{display:t?"grid":"none",columnGap:3,rowGap:2,gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))"},children:o.map(e=>{let{dimensionId:t,entries:o}=e;return(0,L.jsx)(F,{filters:o,dimensionId:t,dataSource:r,chartConfig:n,dataFilters:l,disabled:i},t)})}):null};var R=r(97091),G=r(32027),V=r(47612),$=r(47855),U=r(78081),z=r(10369),B=r(7663),H=r(97358),W=r(71238),Y=r(10359),K=r(17510),q=r(48947),X=r(80065),J=r(59823),Q=r(71171);function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let er=7,en=(0,u.Z)(e=>({root:{flexGrow:1,minWidth:0,padding:e.spacing(8),backgroundColor:e.palette.background.paper,border:t=>{let{removeBorder:r}=t;return r?"none":`1px solid ${e.palette.divider}`},[`.${$.b.root} &`]:{display:"flex",flexDirection:"column"},"& > *":{minWidth:0,maxWidth:"100%"}},editing:{display:"flex",flexDirection:"column"},pastEditing:{display:"grid",gridTemplateRows:"subgrid",gridRow:`span ${er}`}})),ei=e=>{let{dataSource:t,chartConfig:r,dashboardFilters:n,metadataPanelProps:i}=e,o=r.interactiveFiltersConfig.dataFilters,a=n?.dataFilters,l=o.active&&o.componentIds.some(e=>!a?.componentIds.includes(e)),c=(0,v.ge)({dataSource:t,chartConfig:r,dashboardFilters:n});return l||i?(0,L.jsxs)(s.Z,et(et({},Q.nT),{},{sx:{display:"grid",gridTemplateAreas:`
    "filtersToggle metadataToggle"
    "filtersList filtersList"`,mt:4},children:[(0,L.jsx)(s.Z,{sx:{gridArea:"filtersToggle"},children:l&&(0,L.jsx)(v.yk,et({},c))}),i?(0,L.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gridArea:"metadataToggle"},children:(0,L.jsx)(H.U,et({dataSource:t,chartConfig:r,dashboardFilters:n},i))}):null,(0,L.jsx)(s.Z,{sx:{gridArea:"filtersList"},children:l&&(0,L.jsx)(N,et({},c))})]})):(0,L.jsx)("span",{style:{height:1}})},eo=e=>{let{configKey:t,chartKey:r,chartWrapperNode:n,components:s,disableDatabaseRelatedActions:c}=e,d=(0,P.bU)(),[u,p]=(0,W.lY)(W.Sc),{0:m,1:f}=(0,b.useState)(null),h=(0,a.Z)(()=>f(null)),g=(0,O.f6)(u,r),{setIsTableRaw:y}=(0,U.IS)();(0,b.useEffect)(()=>{y(!1)},[g.chartType,y]);let v=(0,W.s9)(u)&&"dashboard"===u.layout.type&&"table"===g.chartType,j=(0,b.useMemo)(()=>{let e=Y.Db.Day(new Date),t=g.meta.title[d]||g.chartType;return`${e}_${t}`},[g.meta.title,g.chartType,d]),x=(0,b.useCallback)(()=>{let e=[];return"table"!==g.chartType&&(e.push((0,L.jsx)(ec,{chartType:g.chartType,onSuccess:h})),e.push((0,L.jsx)(ed,{configKey:t,chartKey:r,components:s,screenshotName:j,screenshotNode:n}))),"dashboard"!==u.layout.type&&t&&!c&&(e.push((0,L.jsx)(es,{configKey:t})),e.push((0,L.jsx)(ea,{configKey:t}))),e},[g.chartType,u.layout.type,t,c,h,r,s,j,n]),C=(0,b.useCallback)(()=>{let e=[];return(0,W.N3)(u)||e.push((0,L.jsx)(B.M,{type:"button",as:"menuitem",onClick:()=>{p({type:"CONFIGURE_CHART",value:{chartKey:r}}),h()},leadingIconName:"pen",label:(0,L.jsx)(i.cC,{id:"chart-controls.edit"})})),e.push((0,L.jsx)(el,{chartConfig:g,onSuccess:h})),"table"!==g.chartType&&(e.push((0,L.jsx)(ec,{chartType:g.chartType,onSuccess:h})),e.push((0,L.jsx)(ed,{configKey:t,chartKey:r,components:s,screenshotName:j,screenshotNode:n}))),u.chartConfigs.length>1&&e.push((0,L.jsx)(B.M,{type:"button",as:"menuitem",color:"red",requireConfirmation:!0,confirmationTitle:o.ag._({id:"chart-controls.delete.title"}),confirmationText:o.ag._({id:"chart-controls.delete.confirmation"}),onClick:()=>{p({type:"CHART_CONFIG_REMOVE",value:{chartKey:r}}),h()},leadingIconName:"trash",label:(0,L.jsx)(i.cC,{id:"chart-controls.delete"})})),e},[u,g,h,p,r,t,s,j,n]),w=(0,W.s9)(u),I=(0,b.useMemo)(()=>w?x():C(),[x,C,w]);return v||0===I.length?null:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(l.Z,et(et({},Q.nT),{},{"data-testid":"chart-more-button",onClick:e=>f(e.currentTarget),sx:{height:"fit-content"},children:(0,L.jsx)(q.JO,{name:"dots"})})),(0,L.jsx)(G.N7,{open:!!m,anchorEl:m,onClose:h,anchorOrigin:{horizontal:"right",vertical:"bottom"},transformOrigin:{horizontal:"right",vertical:"top"},children:I})]})},es=e=>{let{configKey:t}=e,r=(0,P.bU)(),{0:n,1:o}=(0,b.useState)("");return(0,b.useEffect)(()=>{o(`${window.location.origin}/${r}/create/new?copy=${t}`)},[t,r]),(0,L.jsx)(B.M,{type:"link",as:"menuitem",href:n,target:"_blank",rel:"noopener noreferrer",leadingIconName:"pen",label:(0,L.jsx)(i.cC,{id:"chart-controls.copy-and-edit"})})},ea=e=>{let{configKey:t}=e,r=(0,P.bU)(),{0:n,1:o}=(0,b.useState)("");return(0,b.useEffect)(()=>{o(`${window.location.origin}/${r}/v/${t}`)},[t,r]),(0,L.jsx)(B.M,{type:"link",as:"menuitem",href:n,target:"_blank",rel:"noopener noreferrer",leadingIconName:"share",label:(0,L.jsx)(i.cC,{id:"button.share"})})},el=e=>{let{chartConfig:t,onSuccess:r}=e,n=(0,P.bU)(),[o,s]=(0,W.lY)(W.Sc);return(0,L.jsx)(B.M,{type:"button",as:"menuitem",onClick:()=>{s({type:"CHART_CONFIG_ADD",value:{chartConfig:et(et({},t),{},{key:(0,J.M)()}),locale:n}}),r()},leadingIconName:"duplicate",label:(0,L.jsx)(i.cC,{id:"chart-controls.duplicate"})})},ec=e=>{let{chartType:t,onSuccess:r}=e,{isTable:n,setIsTable:o}=(0,U.IS)();return(0,L.jsx)(B.M,{type:"button",as:"menuitem",onClick:()=>{o(!n),r()},leadingIconName:n?(0,q.hK)(t):"tableChart",label:n?(0,L.jsx)(i.cC,{id:"chart-controls.chart-view"}):(0,L.jsx)(i.cC,{id:"chart-controls.table-view"})})},ed=e=>{let{configKey:t,chartKey:r,components:n,screenshotName:i,screenshotNode:s}=e,a=eu(t),l=ef({configKey:t,chartKey:r,components:n}),{loading:c,screenshot:d}=(0,Q.Kv)({type:"png",screenshotName:i,screenshotNode:s,modifyNode:a,pngMetadata:l});return(0,L.jsx)(B.M,{type:"button",as:"menuitem",onClick:d,disabled:c,leadingIconName:"download",label:o.ag._({id:"chart-controls.export-png"})})},eu=e=>{let t=(0,c.Z)(),r=(0,z.$)();return(0,b.useCallback)(async(n,i)=>{let s=n.querySelector(`.${U.CW}`);if(s){let e=i.querySelector(`.${r.chartWithFilters}`);if(e){let t=e.clientHeight;s.style.height=`${t}px`}}let a=n.querySelector(`.${V.h$}`);if(a&&e){let r=document.createElement("div");a.appendChild(r),(0,y.createRoot)(r).render((0,L.jsx)(d.Z,{theme:t,children:(0,L.jsx)(V.cS,{configKey:e,createdWith:o.ag._({id:"metadata.link.created.with"})})})),await (0,X.r)()}n.querySelector(".maplibregl-ctrl")?.remove();let l=t.palette.grey[700];(0,p.Z)(n).selectAll(`:is(p, button, a, span, div, li, h1, h2, h3, h4, h5, h6):not([${ep}='true'])`).style("color",l).style("text-decoration","none"),(0,p.Z)(n).selectAll(`text:not([${ep}='true'])`).style("fill",l)},[r.chartWithFilters,t,e])},ep="data-disable-screenshot-color",em={[ep]:!0},ef=e=>{let{chartKey:t,configKey:r,components:n}=e,i=(0,P.bU)(),[o]=(0,W.lY)(W.Sc),s=(0,O.f6)(o,t),a=(0,b.useMemo)(()=>(0,R.Bu)(s,{components:n}),[s,n]),[{data:l}]=(0,S.bi)({variables:{sourceType:o.dataSource.type,sourceUrl:o.dataSource.url,locale:i,cubeFilters:g()(a.map(e=>({iri:e.cubeIri})),"iri")},pause:!a.length});return(0,b.useMemo)(()=>{let e=l?.dataCubesMetadata.map(e=>e.contactPoints?e.contactPoints.map(e=>`${e.name} (${e.email})`).join(", "):e.creator?.label??e.publisher).join(", "),t=r?`${window.location.origin}/${i}/v/${r}`:null,n=l?.dataCubesMetadata.map(e=>`${e.title} ${e.version?`(${e.version})`:""}`).join(", "),o=[e?{key:"Publisher",value:e}:null,t?{key:"Publish URL",value:t}:null,n?{key:"Dataset",value:n}:null].filter(K.y).map(e=>{let{key:t,value:r}=e;return`${t}: ${r}`}).join(" | ");return o?[{key:"Comment",value:f()(o)}]:[]},[r,l?.dataCubesMetadata,i])}},78081:function(e,t,r){"use strict";r.d(t,{CW:function(){return d},IS:function(){return l},Ig:function(){return c},S4:function(){return u}});var n=r(60116),i=r(27378),o=r(71238),s=r(24246);let a=(0,i.createContext)({isTable:!1,setIsTable:()=>{},setIsTableRaw:()=>{},containerRef:{current:null},containerHeight:"auto",computeContainerHeight:()=>void 0}),l=()=>{let e=(0,i.useContext)(a);if(void 0===e)throw Error("You need to wrap your component in <ChartTablePreviewProvider /> to useChartTablePreview()");return e},c=e=>{let{children:t}=e,[r]=(0,o.lY)(o.Sc),{0:n,1:l}=(0,i.useState)(!1),c=(0,i.useRef)("auto"),d=(0,i.useRef)(null),u=()=>{if(!d.current)return;let{height:e}=d.current.getBoundingClientRect();c.current=e},p=(0,i.useCallback)(e=>(u(),l(e)),[l]);(0,i.useEffect)(()=>{c.current="auto"},[r.activeChartKey]);let m=(0,i.useMemo)(()=>({isTable:n,setIsTable:p,setIsTableRaw:l,containerRef:d,containerHeight:c.current,computeContainerHeight:u}),[n,p,l,d,c]);return(0,s.jsx)(a.Provider,{value:m,children:t})},d="table-preview-wrapper",u=e=>{let{children:t}=e,{containerRef:r,containerHeight:i}=l();return(0,s.jsx)(n.Z,{ref:r,className:d,sx:{minWidth:0,height:i,marginTop:4,marginBottom:2,flexGrow:1},children:t})}},10369:function(e,t,r){"use strict";r.d(t,{I:function(){return R},$:function(){return N}});var n=r(17043),i=r(64986),o=r(65218),s=r.n(o),a=r(27378),l=r(97091),c=r(93477),d=r(56141),u=r.n(d),p=r(50953),m=r(25390),f=r(10359),h=r(77167);let g=[],b=(e,t)=>{let r=(0,a.useRef)(),n=r.current;n||(r.current=e);let i=(0,a.useMemo)(()=>n!==e?t(r.current,e):g,[t,r.current,e]);return r.current=e,i},y=(e,t)=>e?.type==="single"&&t?.type==="single"?e.value===t.value:e?.type==="range"&&t?.type==="range"?e.from===t.from&&e.to===t.to:e?.type==="multi"&&t?.type==="multi"&&u()(e.values,t.values),v=(e,t)=>{let r=new Set([...Object.keys(e),...Object.keys(t)]),n=[];for(let i of r)y(e[i],t[i])||n.push([i,e[i],t[i]]);return n},j=e=>b(e,v);var x=r(8788);let C=(e,t)=>{let{annotations:r,interactiveFiltersConfig:n}=e,i=(0,m.In)(e,{joined:!0}),o=(0,x.bI)(e=>e.resetCategories),s=(0,x.bI)(e=>e.setDataFilters),l=(0,x.Uq)(),c=(0,x.bI)(e=>e.updateDataFilter),d=(0,x.bI)(e=>e.setTimeRange),g=(0,x.bI)(e=>e.setCalculationType),b=(0,a.useRef)({}),y=(0,a.useRef)(!0),v=n.timeRange.presets.from&&(0,f.sG)(n.timeRange.presets.from),C=n.timeRange.presets.to&&(0,f.sG)(n.timeRange.presets.to),O=v?.toString(),w=C?.toString();(0,a.useEffect)(()=>{v&&C&&d(v,C)},[d,O,w]);let I=n.dataFilters.componentIds,S=t?.dataFilters.componentIds,P=(0,a.useMemo)(()=>{if(I)return I.concat(S??[])},[I,S]);(0,a.useEffect)(()=>{if(!P)return;let e=l().dataFilters,r=P.reduce((r,o)=>{let s=t?.dataFilters.filters[o];if(s?.type==="single")return r[o]=s,r;let a=i[o];if(!a||"multi"===a.type){let t=a?.values??{},i=e=>void 0!==e&&(!a||!!t[`${e}`]),s=e[o],l=n.dataFilters.defaultValueOverrides[o],c=b.current[o],d=y.current||!u()(l,c);if(d&&l&&Array.isArray(l)){let e=l.filter(e=>i(e));return"multi"===n.dataFilters.filterTypes[o]?r[o]={type:"multi",values:Object.fromEntries(e.map(e=>[e,!0]))}:e.length>1?r[o]={type:"multi",values:Object.fromEntries(e.map(e=>[e,!0]))}:1===e.length?r[o]={type:"single",value:e[0]}:r[o]={type:"single",value:h.P},r}if(d&&l&&"string"==typeof l&&i(l))return r[o]={type:"single",value:l},r;if(d&&c&&void 0===l)return r[o]={type:"single",value:h.P},r;if(s?.type==="single"&&i(s.value))return r[o]=s,r;if(s?.type==="multi"){let e=Object.keys(s.values).filter(i);return"multi"===n.dataFilters.filterTypes[o]?r[o]={type:"multi",values:Object.fromEntries(e.map(e=>[e,!0]))}:e.length>1?r[o]={type:"multi",values:Object.fromEntries(e.map(e=>[e,!0]))}:1===e.length?r[o]={type:"single",value:e[0]}:r[o]={type:"single",value:h.P},r}if(Array.isArray(l)){let e=l.filter(i);"multi"===n.dataFilters.filterTypes[o]?r[o]={type:"multi",values:Object.fromEntries(e.map(e=>[e,!0]))}:e.length>1?r[o]={type:"multi",values:Object.fromEntries(e.map(e=>[e,!0]))}:1===e.length?r[o]={type:"single",value:e[0]}:r[o]={type:"single",value:h.P}}else"string"==typeof l&&i(l)?r[o]={type:"single",value:l}:r[o]={type:"single",value:h.P};return r}let l=e[o];return l?.type==="single"&&l.value!==h.P?r[o]=l:a?.type==="single"?r[o]=a:r[o]={type:"single",value:h.P},r},{});u()(r,e)||s(r);let o={};for(let e of P)o[e]=n.dataFilters.defaultValueOverrides[e];b.current=o,y.current=!1},[t?.dataFilters.filters,i,l,n.dataFilters.defaultValueOverrides,n.dataFilters.filterTypes,P,s]);let k=j(i);(0,a.useEffect)(()=>{if(1!==k.length)return;let[e,t,r]=k[0];(t?.type==="single"||r?.type==="single")&&c(e,r?.type==="single"?r.value:h.P)},[k,c]);let _=(0,a.useMemo)(()=>(0,p.I3)(e)?e.fields.segment:null,[e]);(0,a.useEffect)(()=>o(),[o,_]);let T=n.calculation.active,D=n.calculation.type;(0,a.useEffect)(()=>{D&&g(D)},[T,D,g]);let Z=(0,a.useRef)(!1),E=(0,x.bI)(e=>e.annotations),M=(0,x.bI)(e=>e.updateAnnotation);(0,a.useEffect)(()=>{Z.current||(r.forEach(e=>{E[e.key]!==e.defaultOpen&&M(e.key,e.defaultOpen)}),Z.current=!0)},[r,E,M])};var O=r(24246);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let S=s()(()=>Promise.all([r.e(38696),r.e(31171),r.e(25737),r.e(50051),r.e(83454),r.e(87570),r.e(17139)]).then(r.bind(r,17139)).then(e=>e.ChartAreasVisualization,()=>null),{loadableGenerated:{webpack:()=>[17139]}}),P=s()(()=>Promise.all([r.e(98803),r.e(25737),r.e(50051),r.e(83454),r.e(87570),r.e(14502)]).then(r.bind(r,14502)).then(e=>e.ChartColumnsVisualization,()=>null),{loadableGenerated:{webpack:()=>[14502]}}),k=s()(()=>Promise.all([r.e(98803),r.e(25737),r.e(50051),r.e(83454),r.e(87570),r.e(62034)]).then(r.bind(r,62034)).then(e=>e.ChartBarsVisualization,()=>null),{loadableGenerated:{webpack:()=>[62034]}}),_=s()(()=>Promise.all([r.e(25737),r.e(50051),r.e(63486),r.e(33873)]).then(r.bind(r,35397)).then(e=>e.ChartComboLineSingleVisualization,()=>null),{loadableGenerated:{webpack:()=>[35397]}}),T=s()(()=>Promise.all([r.e(25737),r.e(50051),r.e(63486),r.e(29379)]).then(r.bind(r,99306)).then(e=>e.ChartComboLineDualVisualization,()=>null),{loadableGenerated:{webpack:()=>[99306]}}),D=s()(()=>Promise.all([r.e(98803),r.e(25737),r.e(50051),r.e(63486),r.e(45502)]).then(r.bind(r,45502)).then(e=>e.ChartComboLineColumnVisualization,()=>null),{loadableGenerated:{webpack:()=>[45502]}}),Z=s()(()=>Promise.all([r.e(38696),r.e(25737),r.e(50051),r.e(83454),r.e(87570),r.e(61127)]).then(r.bind(r,70778)).then(e=>e.ChartLinesVisualization,()=>null),{loadableGenerated:{webpack:()=>[70778]}}),E=s()(()=>Promise.all([r.e(6456),r.e(59875),r.e(87257),r.e(25737),r.e(30131)]).then(r.bind(r,30131)).then(e=>e.ChartMapVisualization,()=>null),{loadableGenerated:{webpack:()=>[30131]}}),M=s()(()=>Promise.all([r.e(58005),r.e(25737),r.e(83454),r.e(74174)]).then(r.bind(r,74174)).then(e=>e.ChartPieVisualization,()=>null),{loadableGenerated:{webpack:()=>[74174]}}),A=s()(()=>Promise.all([r.e(38696),r.e(25737),r.e(83454),r.e(47062)]).then(r.bind(r,47062)).then(e=>e.ChartScatterplotVisualization,()=>null),{loadableGenerated:{webpack:()=>[47062]}}),L=s()(()=>Promise.all([r.e(60378),r.e(85993),r.e(50051),r.e(80625)]).then(r.bind(r,27808)).then(e=>e.ChartTableVisualization,()=>null),{loadableGenerated:{webpack:()=>[27808]}}),F=e=>{let{dataSource:t,componentIds:r,chartConfig:n,dashboardFilters:i,embedParams:o}=e,s={dataSource:t,observationQueryFilters:(0,l.n9)({chartConfig:n,dashboardFilters:i,componentIds:r}),componentIds:r,embedParams:o};switch(n.chartType){case"column":return(0,O.jsx)(P,I(I({},s),{},{chartConfig:n}));case"bar":return(0,O.jsx)(k,I(I({},s),{},{chartConfig:n}));case"line":return(0,O.jsx)(Z,I(I({},s),{},{chartConfig:n}));case"area":return(0,O.jsx)(S,I(I({},s),{},{chartConfig:n}));case"scatterplot":return(0,O.jsx)(A,I(I({},s),{},{chartConfig:n}));case"pie":return(0,O.jsx)(M,I(I({},s),{},{chartConfig:n}));case"table":return(0,O.jsx)(L,I(I({},s),{},{chartConfig:n}));case"map":return(0,O.jsx)(E,I(I({},s),{},{chartConfig:n}));case"comboLineSingle":return(0,O.jsx)(_,I(I({},s),{},{chartConfig:n}));case"comboLineDual":return(0,O.jsx)(T,I(I({},s),{},{chartConfig:n}));case"comboLineColumn":return(0,O.jsx)(D,I(I({},s),{},{chartConfig:n}));default:return n}},N=(0,i.Z)(()=>({chartWithFilters:{width:"100%",height:"100%"}})),R=(0,a.forwardRef)((e,t)=>{C(e.chartConfig,e.dashboardFilters);let r=N();return(0,O.jsx)("div",{className:r.chartWithFilters,ref:t,children:(0,O.jsx)(c.Qj,{children:(0,O.jsx)(F,I({},e))})})});R.displayName="ChartWithFilters"},65619:function(e,t,r){"use strict";r.d(t,{u:function(){return Z}});var n=r(17043),i=r(90089),o=r(60116),s=r(56125),a=r(54417),l=r(40602),c=r(64986),d=r(83766),u=r.n(d),p=r(27378),m=r(64414),f=r(84161),h=r(14868),g=r(71238),b=r(10359),y=r(64103),v=r(17510),j=r(80207),x=r(50726),C=r(49148),O=r(8788),w=r(80733),I=r(92178),S=r(77142),P=r(15351),k=r(24246);let _=["sx"];function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let Z=e=>{let{sx:t}=e,r=(0,i.Z)(e,_),n=(0,p.useRef)(null),[s]=(0,g.lY)(g.Sc),a=(0,g.VF)(s),{dashboardFilters:l}=s,{timeRange:c,dataFilters:d}=l??{timeRange:void 0,dataFilters:void 0},u=!!c?.active,m=!!d?.componentIds.length;return(0,p.useEffect)(()=>{a&&(u||m)&&n.current?.scrollIntoView({block:"nearest",behavior:"smooth"})},[a,m,u]),u||m?(0,k.jsxs)(o.Z,D(D({ref:n},r),{},{sx:D(D({},t),{},{mb:4}),children:[u?(0,k.jsx)(F,{filter:c,mounted:c.active}):null,m?(0,k.jsx)(G,{componentIds:d.componentIds}):null]})):null},E=(0,c.Z)(e=>({slider:{maxWidth:`calc(100% - ${e.spacing(6)})`,margin:e.spacing(6,4,2),[`& .${s.Z.track}`]:{height:1},[`& .${s.Z.rail}.${s.Z.rail}`]:{backgroundColor:e.palette.grey[600]},[`& .${s.Z.valueLabel}`]:{padding:e.spacing(1,2)}}})),M=e=>{let t=new Date(1e3*e[0]),r=new Date(1e3*e[1]);if(t&&r)return{type:"range",from:t,to:r}},A=(e,t)=>{if(!t)return;let r=b.Om[t];return[L(r(e.from)),L(r(e.to))]},L=e=>e?+e/1e3:0,F=e=>{let{filter:t,mounted:r}=e,n=E(),i=(0,O.Rx)(),o=(0,w.K)(e=>e.setEnable),s=t.presets;(0,I.h)(s,"Filter presets should be defined when time range filter is rendered");let c=t.timeUnit,{0:d,1:u}=(0,p.useState)(()=>c?A(s,c):void 0),m=(0,a.Z)(e=>{if(!c)return"";let t=new Date(1e3*e);return b.Db[c](t)}),f=(0,a.Z)(e=>{if((0,I.h)(Array.isArray(e),"Value should be an array of two numbers"),!c)return;let t=M(e);if(t)for(let[r,n,s]of(o(!1),Object.values(i.stores)))s.setState({timeRange:t}),u([e[0],e[1]])});(0,p.useEffect)(function(){if(d||!c)return;let e=b.Om[c];f([L(e(s.from)),L(e(s.to))])},[d,c,s,f]),(0,p.useEffect)(()=>{if(s.from&&s.to&&c){let e=b.Om[c];u([L(e(s.from)),L(e(s.to))])}},[s.from,s.to,c]);let g=(0,P.K)(500,r),y=(0,h.A)(),v=(0,p.useMemo)(()=>{let{values:e}=y,t=e[0]?.value,r=e[e.length-1]?.value;if(t&&r)return[L((0,b.sG)(t)),L((0,b.sG)(r))]},[y]);return d&&t.active&&v?(0,k.jsx)(l.ZP,{className:n.slider,onChange:(e,t)=>f(t),onChangeCommitted:()=>o(!0),valueLabelFormat:m,step:null,min:v[0],max:v[1],valueLabelDisplay:g?"on":"off",value:d,marks:y.values.map(e=>{let{value:t}=e;return{value:L((0,b.sG)(t))}})}):null},N=(0,c.Z)(e=>({wrapper:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:e.spacing(2)},filter:{display:"flex",flex:"1 1 100%",width:"100%",marginRight:e.spacing(3),"&:last-of-type":{marginRight:0},"& > div":{width:"100%"}}})),R=(e,t,r)=>{let n=Object.fromEntries(Object.entries(t).map(e=>{let[t,[n,i,o]]=e;return[t,o.getState().dataFilters[r]]}));return()=>{for(let[i,[o,s,a]]of Object.entries(t))if(e.map(e=>e.key).includes(i)){let e=a.getState().dataFilters,t=n[i];t?e[r]=t:delete e[r],a.setState({dataFilters:e})}}},G=e=>{let{componentIds:t}=e,[r]=(0,g.lY)(g.Sc),{chartConfigs:n,dataSource:i}=r,o=N(),s=(0,p.useMemo)(()=>{let e=[];return n.forEach(r=>{r.cubes.forEach(n=>{let{unmappedFilters:i,mappedFilters:o}=(0,g.AF)(r,{cubeIri:n.iri,joinByIds:t.filter(x.BG)}),s=[...Object.keys(n.filters),...Object.keys(r.fields),...Object.values(r.fields).map(e=>e.componentId)].filter(v.y),a=Object.fromEntries(t.map(e=>{let t=(0,x.BG)(e)?(0,x.Tl)(n,e)??e:e;return{originalId:e,resolvedId:t}}).filter(e=>{let{resolvedId:t,originalId:r}=e;return t!==r||s.includes(t)}).map(e=>{let{originalId:t,resolvedId:r}=e;return[t,r]}));e.push({cubeIri:n.iri,interactiveFilters:{},unmappedFilters:i,mappedFilters:o,componentIdResolution:a})})}),(0,f.j)(e,t)},[n,t]);return(0,k.jsx)("div",{className:o.wrapper,children:s.map(e=>{let{dimensionId:t,entries:r}=e;return(0,k.jsx)(V,{dimensionId:t,entries:r,dataSource:i,chartConfigs:n},t)})})},V=e=>{let{dimensionId:t,entries:r,dataSource:n,chartConfigs:i}=e,o=(0,C.bU)(),s=N(),[{dashboardFilters:a}]=(0,g.lY)(g.Sc),l=(0,O.Rx)(),c=u()(r.map(e=>e.cubeIri)),d=i.filter(e=>e.cubes.some(e=>c.includes(e.iri))),f=(0,p.useMemo)(()=>r.map(e=>({iri:e.cubeIri,componentIds:[e.resolvedDimensionId],loadValues:!0})),[r]),[{data:h}]=(0,j.k$)({chartConfig:d[0],variables:{sourceType:n.type,sourceUrl:n.url,locale:o,cubeFilters:f},keepPreviousData:!0,pause:0===f.length}),b=h?.dataCubesComponents.dimensions[0],{0:v,1:x}=(0,p.useState)(),w=(0,S.z)(e=>{let r=e.target.value;for(let[e,[n,i,o]]of(x(r),Object.entries(l.stores)))d.map(e=>e.key).includes(e)&&(0,O.yl)(o,t,r)});(0,p.useEffect)(()=>{let e=a?.dataFilters.filters[t].value;e&&w({target:{value:e}})},[t,w,a?.dataFilters.filters]),(0,p.useEffect)(()=>{let e=R(d,l.stores,t),r=a?.dataFilters.filters[t]?.value;return r?w({target:{value:r}}):b?.values.length&&w({target:{value:b.values[0].value}}),()=>{e()}},[b?.values]);let I=!b?.values.length,P=b?.hierarchy;return b&&v?(0,k.jsx)("div",{className:s.filter,children:(0,y.fF)(b)?(0,k.jsx)(m.be,{value:v,dimension:b,onChange:w,disabled:I}):P?(0,k.jsx)(m.eR,{value:v,dimension:b,onChange:w,hierarchy:P,disabled:I}):(0,k.jsx)(m.Bq,{value:v,dimension:b,onChange:w,disabled:I})}):null}},94939:function(e,t,r){"use strict";r.d(t,{H:function(){return L}});var n=r(17043),i=r(96338),o=r(1787),s=r(54417),a=r(12548),l=r(65637),c=r(87026),d=r(56637),u=r(60090),p=r(73368),m=r(2926),f=r(83864),h=r.n(f),g=r(27378),b=r(25380),y=r(32027),v=r(94257),j=r(41494),x=r(80207),C=r(48947),O=r(49148),w=r(7673),I=r(66963),S=r(24246);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let _=(0,g.createContext)(void 0),T=()=>{let e=(0,g.useContext)(_);if(void 0===e)throw Error("You need to wrap your component in <DataDownloadStateProvider /> to useDataDownloadState()");return e},D=e=>{let{children:t}=e,{0:r,1:n}=(0,g.useState)({isDownloading:!1});return(0,S.jsx)(_.Provider,{value:[r,n],children:t})},Z=["csv","xlsx"],E=e=>`${e.label}${e.unit?` (${e.unit})`:""}`,M=e=>{let{components:t,observations:r,dimensionParsers:n}=e,i=(0,v.M)(t),o=h()(i,e=>e.id),s={sortingType:"byAuto",sortingOrder:"asc"},a=i.map(e=>[e.id,(0,w.tf)(e,{sorting:s})]),l=[...r];return l.sort((e,t)=>{for(let[r,n]of a)for(let i of n){let n=(0,u.Z)(i(e[r]),i(t[r]));if(0!==n)return n}return 0}),{data:l.map(e=>{let t=Object.keys(e).reduce((t,r)=>k(k({},t),{},{[r]:(0,j.U1)(e[r])}),{});return Object.keys(t).reduce((e,r)=>{let i;let s=o[r],a=n[r];if(!s)return e;let l=t[r];return i=l?.toString()===""?"-":a(l),k(k({},e),{},{[E(s)]:i})},{})}),columnKeys:Object.values(o).map(E)}},A=e=>{let{children:t}=e;return(0,S.jsx)(o.Z,{sx:{whiteSpace:"normal","&:hover":{backgroundColor:"transparent",cursor:"default"}},children:t})},L=(0,g.memo)(e=>{let{dataSource:t,filters:r,title:n}=e;return(0,S.jsx)(D,{children:(0,S.jsx)(F,{dataSource:t,fileName:n,filters:r})})}),F=e=>{let{dataSource:t,fileName:r,filters:n}=e,[o]=T(),{0:d,1:u}=(0,g.useState)(null),p=(0,s.Z)(()=>u(null));return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(a.Z,{variant:"text",color:"primary",size:"sm",startIcon:o.isDownloading?(0,S.jsx)(l.Z,{size:20}):(0,S.jsx)(C.JO,{name:"download",size:20}),onClick:e=>u(e.currentTarget),sx:{width:"fit-content",minHeight:0,p:0,ml:"2.5px",fontSize:"inherit"},children:(0,S.jsx)(i.cC,{id:"button.download.data"})}),(0,S.jsxs)(y.Ik,{open:!!d,anchorEl:d,onClose:p,anchorOrigin:{horizontal:"center",vertical:"top"},transformOrigin:{horizontal:"center",vertical:"bottom"},MenuListProps:{sx:{width:200}},sx:{transform:"translateY(-12px)"},children:[n.filters&&(0,S.jsx)(R,{dataSource:t,subheader:(0,S.jsx)(i.cC,{id:"button.download.data.visible"}),fileName:`${r}-filtered`,filters:n}),(0,S.jsx)(R,{dataSource:t,subheader:(0,S.jsx)(i.cC,{id:"button.download.data.all"}),fileName:`${r}-full`,filters:N(n)}),o.error&&(0,S.jsx)(A,{children:(0,S.jsx)(c.Z,{variant:"caption",color:"error.main",children:o.error})})]})]})},N=e=>({iri:e.iri}),R=e=>{let{dataSource:t,subheader:r,fileName:n,filters:i}=e;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(d.Z,{children:r}),Z.map(e=>(0,S.jsx)(G,{dataSource:t,fileName:n,fileFormat:e,filters:i},e))]})},G=e=>{let{dataSource:t,fileName:r,fileFormat:n,filters:i}=e,s=(0,O.bU)(),a=(0,I.Q)(),l=(0,b.m8)(),[c,d]=T(),u=(0,g.useCallback)(async(e,t)=>{if(!(e?.dataCubesComponents&&t?.dataCubesObservations))return;let{dimensions:i,measures:o}=e.dataCubesComponents,a=[...i,...o],l=V(a,{locale:s}),{columnKeys:c,data:d}=M({components:a,observations:t.dataCubesObservations.data,dimensionParsers:l}),u=new p.Workbook,f=u.addWorksheet("data");switch(f.columns=c.map(e=>({header:e,key:e})),f.addRows(d),n){case"csv":let h=await u.csv.writeBuffer();(0,m.saveAs)(new Blob(["\uFEFF"+h],{type:"text/csv;charset=utf-8"}),`${r}.csv`);break;case"xlsx":let g=await u.xlsx.writeBuffer();(0,m.saveAs)(new Blob([g],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),`${r}.xlsx`)}},[n,r,s]);return(0,S.jsx)(o.Z,{disabled:c.isDownloading,onClick:async()=>{if(i){d({isDownloading:!0});try{let[e,r]=await Promise.all([(0,x.xw)(l,{sourceType:t.type,sourceUrl:t.url,locale:s,cubeFilters:[i]}),(0,x.A3)(l,{sourceType:t.type,sourceUrl:t.url,locale:s,cubeFilters:[i]})]);e.data&&r.data?await u(e.data,r.data):(e.error||r.error)&&d(k(k({},c),{},{error:a._(a._({id:"hint.dataloadingerror.message"}))}))}catch(e){console.error(a._(a._({id:"hint.dataloadingerror.message"})),e)}finally{d(k(k({},c),{},{isDownloading:!1}))}}},children:n.toUpperCase()})},V=(e,t)=>{let{locale:r}=t;return Object.fromEntries(e.map(e=>{switch(e.__typename){case"GeoCoordinatesDimension":case"GeoShapesDimension":case"NominalDimension":case"OrdinalDimension":case"TemporalEntityDimension":case"TemporalOrdinalDimension":return[e.id,e=>e];case"NumericalMeasure":case"StandardErrorDimension":case"ConfidenceUpperBoundDimension":case"ConfidenceLowerBoundDimension":return[e.id,e=>+e];case"OrdinalMeasure":return e.isNumerical?[e.id,e=>+e]:[e.id,e=>e];case"TemporalDimension":{if("Year"===e.timeUnit)return[e.id,e=>+e];let t=(0,j.Py)(r),n=(0,j.Ah)(t);return[e.id,(0,j.GY)(e,t,n)]}default:return e}}))}},37470:function(e,t,r){"use strict";r.d(t,{R:function(){return w}});var n=r(90089),i=r(17043),o=r(96338),s=r(87026),a=r(62033),l=r(60116),c=r(98505),d=r(95099),u=r.n(d),p=r(79894),m=r.n(p),f=r(94939),h=r(79171),g=r(41494),b=r(48947),y=r(49148);let v=(e,t)=>{let r=t?.identifier,n=t?.creator?.iri,i=t?.workExamples?.includes("https://ld.admin.ch/application/opendataswiss");if(!r||!n||!i)return;let o=n.replace("https://register.ld.admin.ch/opendataswiss/org/","");return`https://opendata.swiss/${e}/perma/${encodeURIComponent(`${r.replace(`@${o}`,"")}@${o}`)}`};var j=r(24246);let x=["href","label","external"];function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let w=e=>{let{cube:t,showTitle:r,sparqlEditorUrl:n,dataSource:i,queryFilters:c}=e,d=(0,y.bU)(),u=(0,g.e8)(),p=t?v(d,t):null;return(0,j.jsxs)("div",{children:[r?(0,j.jsx)(s.Z,{variant:"h5",fontWeight:700,sx:{mb:4},children:t.title}):null,(0,j.jsxs)(a.Z,{spacing:6,children:[t.publisher&&(0,j.jsxs)("div",{children:[(0,j.jsx)(I,{children:(0,j.jsx)(o.cC,{id:"dataset.metadata.source"})}),(0,j.jsx)(S,{children:(0,j.jsx)(l.Z,{component:"span",sx:{"> a":{color:"grey.900"}},dangerouslySetInnerHTML:{__html:t.publisher}})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(I,{children:(0,j.jsx)(o.cC,{id:"dataset.metadata.date.created"})}),(0,j.jsx)(S,{children:t.datePublished?u(t.datePublished)??"":""})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(I,{children:(0,j.jsx)(o.cC,{id:"dataset.metadata.version"})}),(0,j.jsx)(S,{children:t.version??""})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(I,{children:(0,j.jsx)(o.cC,{id:"dataset.metadata.email"})}),(0,j.jsx)(S,{children:t.contactPoints?.map(e=>e.email&&e.name?j.jsx(P,{href:`mailto:${e.email}`,label:e.name??e.email},e.email):"")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(I,{children:(0,j.jsx)(o.cC,{id:"dataset.metadata.furtherinformation"})}),(0,j.jsxs)(S,{sx:{mt:"1px"},children:[t.landingPage?(0,j.jsx)(P,{href:t.landingPage,external:!0,label:(0,j.jsx)(o.cC,{id:"dataset.metadata.learnmore"})}):"",n?(0,j.jsx)(k,{url:n}):null,c?(0,j.jsx)(f.H,{dataSource:i,title:t.title,filters:c}):null,p?(0,j.jsx)(P,{external:!0,label:"OpenData.swiss",href:p}):null]})]}),(0,j.jsxs)(a.Z,{spacing:2.5,children:[(0,j.jsx)(I,{children:(0,j.jsx)(o.cC,{id:"dataset-preview.keywords"})}),(0,j.jsx)(_,{cube:t})]})]})]})},I=e=>{let{children:t}=e;return(0,j.jsx)(s.Z,{variant:"h6",component:"p",fontWeight:700,children:t})},S=e=>{let{children:t,sx:r}=e;return(0,j.jsx)(s.Z,{variant:"body3",sx:O({display:"flex",flexDirection:"column",gap:"1px",mt:"1px"},r),children:t})},P=e=>{let{href:t,label:r,external:i}=e,o=(0,n.Z)(e,x);return(0,j.jsxs)(c.Z,O(O({underline:"hover",href:t,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:1}},o),{},{children:[i?(0,j.jsx)(b.JO,{name:"link",size:20}):null,r]}))},k=e=>{let{url:t}=e;return(0,j.jsxs)(c.Z,{underline:"hover",href:t,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:1},children:[(0,j.jsx)(b.JO,{name:"legacyLinkExternal",size:16}),(0,j.jsx)(o.cC,{id:"chart-controls.sparql-query"})]})},_=e=>{let{cube:t}=e;return(0,j.jsxs)(a.Z,{spacing:1,direction:"column",children:[t.creator?.iri&&(0,j.jsx)(T,{type:"organization",iri:t.creator.iri,label:t.creator.label}),t.themes&&u()(t.themes,e=>e.label).map(e=>e.iri&&e.label&&(0,j.jsx)(T,{type:"theme",iri:e.iri,label:e.label},e.iri))]})},T=e=>{let{type:t,iri:r,label:n}=e;return(0,j.jsx)(m(),{href:`/browse/${t}/${encodeURIComponent(r)}`,passHref:!0,legacyBehavior:!0,children:(0,j.jsx)(h.V,{component:c.Z,underline:"none",title:n??void 0,sx:{display:"inline-block",maxWidth:"100%",borderRadius:"16px",color:"text.primary"},children:n})},r)}},70185:function(e,t,r){"use strict";r.d(t,{D:function(){return b},x:function(){return y}});var n=r(17043),i=r(90089),o=r(60116),s=r(64986),a=r(40624),l=r(27378),c=r(47855),d=r(97614),u=r(48947),p=r(71171),m=r(24246);let f=["dragging"];function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let b=(0,l.forwardRef)((e,t)=>{let{dragging:r}=e,n=(0,i.Z)(e,f),s=(0,d.Z)({active:!1,dragging:r});return(0,m.jsx)(o.Z,g(g(g({},p.nT),{},{ref:t},n),{},{className:(0,a.Z)(s.dragIconWrapper,e.className,c.b.dragHandle),children:(0,m.jsx)(u.JO,{name:"dragndrop"})}))}),y=(0,s.Z)(e=>({root:{opacity:e=>{let{isDragging:t,isDragOver:r}=e;return t?.2:r?.8:1},outline:t=>{let{isDragging:r,isDragOver:n}=t;return`2px solid ${n&&!r?e.palette.primary.main:"transparent"}`},pointerEvents:e=>{let{isDragActive:t}=e;return t?"none":"auto"}}}))},41053:function(e,t,r){"use strict";r.d(t,{Rx:function(){return u},lR:function(){return f}});var n=r(17043),i=r(86677),o=r(27378);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let l=["disableBorder"],c=e=>"disableBorder"===e?"removeBorder":e,d=["removeBorder","optimizeSpace","removeMoreOptionsButton","removeLabelsInteractivity","removeFootnotes","removeFilters"],u=e=>[...l,...d].includes(e),p=e=>[...l,...d].reduce((t,r)=>("true"===e[r]&&(t[c(r)]=!0),t),{removeBorder:!1,optimizeSpace:!1,removeMoreOptionsButton:!1,removeLabelsInteractivity:!1,removeFootnotes:!1,removeFilters:!1}),m=e=>Object.fromEntries(Object.entries(e).filter(e=>{let[t,r]=e;return r}).map(e=>{let[t]=e;return[t,"true"]})),f=()=>{let e=(0,i.useRouter)(),t=(0,o.useMemo)(()=>p(e.query),[e.query]),r=(0,o.useCallback)((r,n)=>{let i=a(a({},t),{},{[r]:n}),o=Object.fromEntries(Object.entries(e.query).filter(e=>{let[t]=e;return!u(t)}));e.replace({pathname:e.pathname,query:a(a({},o),m(i))},void 0,{shallow:!0})},[t,e]);return{embedParams:t,setEmbedQueryParam:r}}},67018:function(e,t,r){"use strict";r.d(t,{o:function(){return u}});var n=r(17043),i=r(90089),o=r(50714),s=r(48947),a=r(24246);let l=["title","size","componentsProps","placement"];function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let u=e=>{let{title:t,size:r=24,componentsProps:n,placement:c="top"}=e,u=(0,i.Z)(e,l);return(0,a.jsx)(o.Z,d(d({arrow:!0,placement:c,title:t,disableInteractive:!0},u),{},{children:(0,a.jsx)("div",{style:{lineHeight:0},children:(0,a.jsx)(s.JO,{name:"infoCircle",size:r})})}))}},27686:function(e,t,r){"use strict";r.d(t,{Ln:function(){return F},T9:function(){return A},UG:function(){return M}});var n=r(17043),i=r(90089),o=r(40624),s=r(61870),a=r(76939),l=r(84223),c=r(42573),d=r(25436),u=r.n(d),p=r(94853),m=r(24246);let f=["children","className"],h=["children","className"],g=["children","className"],b=["children","className"],y=["children","className"],v=["children","className"],j=["children","className"],x=["children","className","style"],C=["children"],O=["children","className"],w=["children","className"],I=["children","className"],S=["children","className"],P=["children","className"],k=["children","className"],_=["children","className"],T=["children","className","style"];function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let E={h1:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,f);return(0,m.jsx)("h1",Z(Z({className:(0,o.Z)(r,u().common)},n),{},{children:t}))},h2:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,h);return(0,m.jsx)("h2",Z(Z({className:(0,o.Z)(r,u().common)},n),{},{children:t}))},h3:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,g);return(0,m.jsx)("h3",Z(Z({className:(0,o.Z)(r,u().common)},n),{},{children:t}))},h4:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,b);return(0,m.jsx)("h4",Z(Z({className:(0,o.Z)(r,u().common)},n),{},{children:t}))},h5:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,y);return(0,m.jsx)("h5",Z(Z({className:(0,o.Z)(r,u().common)},n),{},{children:t}))},h6:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,v);return(0,m.jsx)("h6",Z(Z({className:(0,o.Z)(r,u().common)},n),{},{children:t}))},p:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,j);return(0,m.jsx)("p",Z(Z({className:(0,o.Z)(r,u().common)},n),{},{children:t}))},a:e=>{let{children:t,className:r,style:n}=e,s=(0,i.Z)(e,x);return(0,m.jsx)("a",Z(Z({target:"_blank",className:(0,o.Z)(r,u().common),style:Z(Z({},n),{},{color:p.D.primary.main})},s),{},{children:t}))}},M=e=>(0,m.jsx)(s.U,Z({components:E,remarkPlugins:[c.Z],rehypePlugins:[a.Z,l.Z]},e)),A=e=>{let{children:t}=e,r=(0,i.Z)(e,C),n=t?.replace(/\r?\n|\r/g," ");return(0,m.jsx)(s.U,Z(Z({components:{p:e=>{let{children:t}=e;return(0,m.jsx)(m.Fragment,{children:t})},strong:e=>{let{children:t}=e;return(0,m.jsx)("strong",{children:t})},em:e=>{let{children:t}=e;return(0,m.jsx)("em",{children:t})},a:e=>{let{children:t,href:r}=e;return(0,m.jsx)("a",{href:r,children:t})},h1:()=>null,h2:()=>null,h3:()=>null,h4:()=>null,h5:()=>null,h6:()=>null,ul:()=>null,li:()=>null,blockquote:()=>null,code:e=>{let{children:t}=e;return(0,m.jsx)("code",{children:t})},br:()=>(0,m.jsx)(m.Fragment,{children:" "})},skipHtml:!0},r),{},{children:n}))},L={h1:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,O);return(0,m.jsx)("h1",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts)},n),{},{children:t}))},h2:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,w);return(0,m.jsx)("h2",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts)},n),{},{children:t}))},h3:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,I);return(0,m.jsx)("h3",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts)},n),{},{children:t}))},h4:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,S);return(0,m.jsx)("h4",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts)},n),{},{children:t}))},h5:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,P);return(0,m.jsx)("h5",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts)},n),{},{children:t}))},h6:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,k);return(0,m.jsx)("h6",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts)},n),{},{children:t}))},p:e=>{let{children:t,className:r}=e,n=(0,i.Z)(e,_);return(0,m.jsx)("p",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts)},n),{},{children:t}))},a:e=>{let{children:t,className:r,style:n}=e,s=(0,i.Z)(e,T);return(0,m.jsx)("a",Z(Z({className:(0,o.Z)(r,u().common,u().inheritFonts),target:"_blank",style:Z(Z({},n),{},{color:p.D.primary.main})},s),{},{children:t}))}},F=e=>(0,m.jsx)(s.U,Z({components:L,remarkPlugins:[c.Z],rehypePlugins:[a.Z,l.Z]},e))},5680:function(e,t,r){"use strict";r.d(t,{D7:function(){return l},_z:function(){return c},ag:function(){return a},ax:function(){return u}});var n=r(27378),i=r(28622),o=r(58555),s=r(59166);let a=()=>(0,i.Z)((e,t)=>({open:!1,activeSection:"general",selectedComponent:void 0,actions:{setOpen:t=>{e({open:t})},toggle:()=>{e({open:!t().open})},setActiveSection:t=>{e({activeSection:t})},setSelectedComponent:t=>{e({selectedComponent:t})},clearSelectedComponent:()=>{e({selectedComponent:void 0})},openComponent:t=>{e({open:!0,activeSection:"data",selectedComponent:t})},reset:()=>{e({activeSection:"general",selectedComponent:void 0})}}})),l=e=>{let t=(0,n.useContext)(u);return(0,o.oR)(t,e,s.Z)},c=()=>{let e=(0,n.useContext)(u);return(0,o.oR)(e,e=>e.actions)},d=a(),u=(0,n.createContext)(d)},97358:function(e,t,r){"use strict";r.d(t,{U:function(){return eI},K:function(){return ew}});var n=r(17043),i=r(96338),o=r(19914),s=r(91282),a=r(41094),l=r(88659),c=r(12548),d=r(79235),u=r(48921),p=r(87026),m=r(97901),f=r(62033),h=r(26398),g=r(60116),b=r(3185),y=r(98700),v=r(61998),j=r(1787),x=r(64986),C=r(98458),O=r.n(C),w=r(99521),I=r.n(w),S=r(40624),P=r(73681),k=r(38354),_=r.n(k),T=r(83864),D=r.n(T),Z=r(48159),E=r.n(Z),M=r(43605),A=r.n(M),L=r(95099),F=r.n(L),N=r(86677),R=r(27378),G=r(97091),V=r(37470),$=r(41053),U=r(53082),z=r(17899),B=r(67018),H=r(90089),W=r(345),Y=r(19732),K=r(40176),q=r(24246);let X=["children"];function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ee=e=>{let{children:t}=e,r=(0,H.Z)(e,X);return(0,q.jsx)(W.Z,Q(Q({},r),{},{label:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(K.Z,{}),r.label]}),sx:{background:e=>e.palette.warning.light,padding:"2px 6px",minHeight:"auto",height:20,borderRadius:2,gap:"4px",[`& .${Y.Z.label}`]:{padding:0,lineHeight:1,display:"flex",alignItems:"center"}}}))};var et=r(5680),er=r(10096),en=r(25390),ei=r(71238),eo=r(56436),es=r(10359),ea=r(64103),el=r(41494),ec=r(80207),ed=r(48947),eu=r(41455),ep=r(69763),em=r(49148),ef=r(80733),eh=r(92178),eg=r(44863),eb=r(7673),ey=r(77142);function ev(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ej(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ev(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ev(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ex=(0,x.Z)(e=>({root:{position:"static","& > .MuiPaper-root":{top:e=>{let{top:t}=e;return t},bottom:0,width:"100%",maxWidth:eo.pG+1,height:"auto",paddingLeft:e.spacing(4),paddingRight:e.spacing(4),borderRight:`1px solid ${e.palette.divider}`,boxShadow:"none"}}})),eC=(0,x.Z)(e=>({toggleButton:{minHeight:0,padding:0},header:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:e.spacing(6),marginBottom:e.spacing(4)},tabList:{height:40,minHeight:40,marginBottom:e.spacing(4),"& .MuiTab-root":{height:40,minHeight:40,"&:not(.Mui-selected)":{color:e.palette.grey[600]}}},tabPanel:{padding:0,paddingBottom:e.spacing(3)},tabPanelContent:{display:"flex",flexDirection:"column",gap:e.spacing(4)},dimensionButton:{textAlign:"left",lineHeight:1,minHeight:"auto",padding:0,fontWeight:"bold","& > svg":{marginLeft:0}},dimensionValues:{flexDirection:"column",gap:e.spacing(2),marginTop:e.spacing(3)},search:{marginBottom:"0.25rem","& .MuiAutocomplete-inputRoot":{padding:`0px ${e.spacing(3)}`,"& > .MuiAutocomplete-input":{padding:e.spacing(2)}}},searchInputResultList:{padding:0,border:`1px solid ${e.palette.divider}`,borderRadius:3},searchInputResult:{justifyContent:"space-between",borderBottom:`1px solid ${e.palette.divider}`,"&:last-of-type":{borderBottom:"none"}},openComponentInteractive:{minHeight:0,verticalAlign:"baseline",padding:0,margin:0,fontSize:"inherit",color:e.palette.primary.main,textAlign:"left",transition:"opacity 0.2s ease-in-out"},openComponentNonInteractive:{position:"relative",display:"inline-flex",width:"fit-content",fontSize:"inherit",textAlign:"left",lineHeight:1.25,color:e.palette.grey[800]}})),eO={transition:{duration:.2},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},ew=e=>{let{children:t,component:r}=e,{embedParams:n}=(0,$.lR)(),i=eC(),{openComponent:o,setOpen:s,setActiveSection:a}=(0,et._z)(),l=(0,ey.z)(e=>{e.stopPropagation(),r?o(r):(a("general"),s(!0))});return n.removeLabelsInteractivity?(0,q.jsx)("div",{className:i.openComponentNonInteractive,children:t}):(0,q.jsx)(c.Z,{className:i.openComponentInteractive,variant:"text",size:"sm",color:"primary",onClick:l,children:t})},eI=e=>{let{chartConfig:t,dashboardFilters:r,dataSource:n,components:o,container:l,top:c=0,allowMultipleOpen:m,renderToggle:f=!0,smallerToggle:h}=e,g=(0,N.useRouter)(),b=ex({top:c}),y=eC(),{open:v,activeSection:j}=(0,et.D7)(e=>({open:e.open,activeSection:e.activeSection})),x=(0,ef.K)(e=>e.setEnable),{setOpen:C,toggle:O,setActiveSection:w,reset:I}=(0,et._z)(),S=(0,eg.x)("metadata-panel-opened",()=>{v&&C(!1)}),k=(0,ey.z)(()=>{O(),m||S.emit("metadata-panel-opened",{datasetIri:""})});(0,R.useEffect)(()=>{let e=()=>{C(!1),I()};return g.events.on("hashChangeStart",e),()=>{g.events.off("hashChangeStart",e)}},[C,I,g.events]);let _=(0,R.useMemo)(()=>{if(l)return{onEnter:()=>x(!1),onEntered:()=>x(!0),onExit:()=>x(!1),onExited:()=>x(!0)}},[x,l]);return(0,q.jsxs)(q.Fragment,{children:[f&&(0,q.jsx)(eS,{smaller:h,onClick:k}),(0,q.jsxs)(d.ZP,{"data-testid":"panel-metadata",className:b.root,open:v,anchor:"left",hideBackdrop:!0,disableEnforceFocus:!0,ModalProps:{container:l},PaperProps:{style:{position:"absolute"}},SlideProps:_,children:[(0,q.jsx)(eP,{onClose:k}),(0,q.jsxs)(s.ZP,{value:j,children:[(0,q.jsxs)(a.Z,{className:y.tabList,onChange:(e,t)=>{w(t)},children:[(0,q.jsx)(u.Z,{value:"general",label:(0,q.jsx)(p.Z,{children:(0,q.jsx)(i.cC,{id:"controls.metadata-panel.section.general"})})}),(0,q.jsx)(u.Z,{value:"data",label:(0,q.jsx)(p.Z,{children:(0,q.jsx)(i.cC,{id:"controls.metadata-panel.section.data"})})})]}),(0,q.jsx)(P.M,{children:"general"===j?(0,q.jsx)(er.uH,ej(ej({},eO),{},{children:(0,q.jsx)(ek,{dataSource:n,chartConfig:t,dashboardFilters:r})}),"cubes-panel"):"data"===j?(0,q.jsx)(er.uH,ej(ej({},eO),{},{children:(0,q.jsx)(e_,{dataSource:n,components:o})}),"data-panel"):null})]})]})]})},eS=e=>{let{smaller:t,onClick:r}=e,n=eC();return(0,q.jsx)(c.Z,{"data-testid":"panel-metadata-toggle",className:n.toggleButton,variant:"text",color:"primary",size:t?"xs":"sm",onClick:r,children:(0,q.jsx)(i.cC,{id:"controls.metadata-panel.metadata"})})},eP=e=>{let{onClose:t}=e,r=eC();return(0,q.jsxs)("div",{className:r.header,children:[(0,q.jsx)(p.Z,{variant:"h6",component:"p",sx:{fontWeight:"bold"},children:(0,q.jsx)(i.cC,{id:"controls.metadata-panel.metadata"})}),(0,q.jsx)(m.Z,{size:"small",onClick:t,children:(0,q.jsx)(ep.Z,{})})]})},ek=e=>{let{dataSource:t,chartConfig:r,dashboardFilters:n}=e,i=eC(),o=(0,em.bU)(),s=r.cubes.map(e=>({iri:e.iri})),[{data:a,fetching:c,error:d}]=(0,ec.bi)({variables:{sourceType:t.type,sourceUrl:t.url,locale:o,cubeFilters:s}}),u=a?.dataCubesMetadata,p=(0,G.n9)({chartConfig:r,dashboardFilters:n,componentIds:(0,G.Xd)({chartConfig:r})}),[{data:m,error:g}]=(0,ec.XO)({chartConfig:r,variables:{sourceType:t.type,sourceUrl:t.url,locale:o,cubeFilters:p}}),b=m?.dataCubesObservations,y=d||g;return(0,q.jsxs)(l.Z,{className:i.tabPanel,value:"general",children:[c?(0,q.jsx)(z.gb,{}):null,y?(0,q.jsx)(z.jj,{children:`${y instanceof z.jj?y.message:y}`}):null,(0,q.jsx)(f.Z,{divider:(0,q.jsx)(h.Z,{}),gap:"1.5rem",children:u?.map(e=>{let r=b?.sparqlEditorUrls?.find(t=>t.cubeIri===e.iri)?.url,n=p.find(t=>t.iri===e.iri);return eh.h(n,"Cube query filters not found"),q.jsx(V.R,{cube:e,showTitle:!0,sparqlEditorUrl:r,dataSource:t,queryFilters:n},e.iri)})})]})},e_=e=>{let{dataSource:t,components:r}=e,n=(0,em.bU)(),s=eC(),a=(0,et.D7)(e=>e.selectedComponent),{setSelectedComponent:c,clearSelectedComponent:d}=(0,et._z)(),{0:u,1:m}=(0,R.useState)(""),{options:x,groupedComponents:C}=(0,R.useMemo)(()=>({options:r.flatMap(e=>(0,ea.P9)(e)?(e.originalIds??[]).map(t=>({label:(0,es.X0)(e,{cubeIri:t.cubeIri}),value:ej(ej({},E()(e,"originalIds")),{},{cubeIri:t.cubeIri,id:t.dimensionId}),isJoinByDimension:!0})):[{label:e.label,value:e,isJoinByDimension:!1}]),groupedComponents:_()(r.flatMap(e=>"originalIds"in e&&e.originalIds?e.originalIds.map(t=>ej(ej({},e),{},{cubeIri:t.cubeIri,id:t.dimensionId}))??[]:[e]),e=>e.cubeIri)}),[r]),[w]=(0,ec.bi)({variables:{locale:n,sourceType:t.type,sourceUrl:t.url,cubeFilters:Object.keys(C).map(e=>({iri:e}))},keepPreviousData:!0}),k=w.data?.dataCubesMetadata,T=(0,R.useMemo)(()=>D()(k,e=>e.iri),[k]),Z=(0,R.useMemo)(()=>F()(x,e=>T[e.value.cubeIri]?.title),[x,T]);return(0,q.jsx)(l.Z,{className:s.tabPanel,value:"data",children:(0,q.jsx)(P.M,{mode:"wait",children:a?(0,q.jsxs)(er.uH,ej(ej({},eO),{},{children:[(0,q.jsx)(ei.xE,{onClick:d,children:(0,q.jsx)(i.cC,{id:"button.back"})}),(0,q.jsx)(g.Z,{sx:{mt:4},children:(0,q.jsx)(eT,{component:a,expanded:!0,dataSource:t})})]}),"dimension-selected"):(0,q.jsxs)(er.uH,ej(ej({className:s.tabPanelContent},eO),{},{children:[(0,q.jsx)(b.Z,{className:s.search,disablePortal:!0,onChange:(e,t)=>t&&c(t.value),inputValue:u,onInputChange:(e,t)=>m(t.toLowerCase()),options:Z,groupBy:e=>T[e.value.cubeIri]?.title??"",ListboxProps:{className:s.searchInputResultList},renderInput:e=>(0,q.jsx)(y.Z,ej(ej({},e),{},{className:s.search,placeholder:o.ag._({id:"select.controls.metadata.search"}),InputProps:ej(ej({},e.InputProps),{},{endAdornment:(0,q.jsx)(v.Z,{position:"start",children:(0,q.jsx)(ed.JO,{name:"search"})}),sx:{pr:"0 !important",typography:"h6"}})})),renderOption:(e,t,r)=>{let{inputValue:n}=r,o=O()(t.label,n,{insideWords:!0}),a=I()(t.label,o);return(0,q.jsxs)(j.Z,ej(ej({},e),{},{className:(0,S.Z)(e.className,s.searchInputResult),children:[a.map((e,t)=>{let{text:r,highlight:n}=e;return(0,q.jsx)(p.Z,{variant:"body3",component:"span",flexGrow:1,style:{fontWeight:n?700:400,textOverflow:"ellipsis",overflow:"hidden"},children:r},t)}),t.isJoinByDimension?(0,q.jsx)(ee,{label:(0,q.jsx)(i.cC,{id:"dimension.joined"})}):""]}))},clearIcon:null}),(0,q.jsx)(f.Z,{spacing:4,divider:(0,q.jsx)(h.Z,{}),children:Object.entries(C).map(e=>{let[r,n]=e,i=T[r];return i?(0,q.jsxs)("div",{children:[k&&k.length>1?(0,q.jsx)(p.Z,{variant:"h5",component:"p",sx:{mb:6},children:i.title}):null,(0,q.jsx)(f.Z,{gap:6,children:n.map(e=>(0,q.jsx)(eT,{component:e,cubeIri:r,expanded:!1,dataSource:t},e.id))})]},r):null})})]}),"dimension-not-selected")})})},eT=e=>{let{component:t,dataSource:r,expanded:n,cubeIri:o}=e,[s]=(0,ei.lY)(),a=(0,en.f6)(s),l=eC(),{setSelectedComponent:d}=(0,et._z)(),u=(0,R.useMemo)(()=>(0,es.X0)(t,{cubeIri:o}),[o,t]),m=(0,R.useMemo)(()=>{let e=(0,es.f5)(t,o);return!n&&e&&e.length>180?`${e.slice(0,180)}`:e},[o,t,n]),f=(0,em.bU)(),h=(0,R.useMemo)(()=>(0,ea.P9)(t)?t.originalIds.map(e=>e.cubeIri):[t.cubeIri],[t]),[b]=(0,ec.bi)({variables:{locale:f,sourceType:r.type,sourceUrl:r.url,cubeFilters:h.map(e=>({iri:e}))}}),y=(0,R.useMemo)(()=>D()(b.data?.dataCubesMetadata,e=>e.iri),[b.data?.dataCubesMetadata]),[{data:v,fetching:j}]=(0,ec.k$)({chartConfig:a,variables:{cubeFilters:[{iri:t.cubeIri,loadValues:!0,componentIds:[t.id]}],locale:f,sourceType:r.type,sourceUrl:r.url},pause:!n}),x=(0,R.useMemo)(()=>[...v?.dataCubesComponents.dimensions??[],...v?.dataCubesComponents.measures??[]].find(e=>t.id===e.id),[v?.dataCubesComponents.dimensions,v?.dataCubesComponents.measures,t.id]),C=(0,R.useCallback)(()=>{n||d(t)},[n,t,d]);return(0,q.jsxs)("div",{children:[(0,q.jsx)(U.k,{sx:{justifyContent:"space-between"},children:(0,q.jsxs)("div",{children:[(0,q.jsxs)(g.Z,{display:"flex",alignItems:"center",gap:2,children:[(0,q.jsx)(c.Z,{className:l.dimensionButton,variant:"text",size:"sm",onClick:C,sx:{cursor:n?"default":"pointer","&:hover":{color:n?"text.primary":"primary.main"}},children:u}),(0,ea.P9)(t)?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(ee,{label:(0,q.jsx)(i.cC,{id:"dimension.joined"})}),(0,q.jsx)(B.o,{title:(0,q.jsx)(i.cC,{id:"dimension.joined-info-icon"}),placement:"top-end"})]}):null]}),m&&(0,q.jsx)(p.Z,{variant:"body3",component:"p",sx:{mt:1},children:m})]})}),(0,q.jsx)(P.M,{children:n&&x&&x.values.length>0&&(0,q.jsxs)(er.uH,ej(ej({className:l.dimensionValues},eO),{},{children:[(0,ea.P9)(t)?(0,q.jsxs)("div",{children:[(0,q.jsx)(p.Z,{variant:"h5",gutterBottom:!0,children:"Joined with"}),t.originalIds.map(e=>e.cubeIri===x.cubeIri?null:(0,q.jsx)("div",{children:(0,q.jsxs)(p.Z,{variant:"body2",children:[e.label," (",y[e.cubeIri]?.title,")"]})},e.cubeIri))]}):null,(0,q.jsx)(p.Z,{variant:"body3",sx:{my:2,fontWeight:700},children:(0,q.jsx)(i.cC,{id:"controls.metadata-panel.available-values"})}),j?(0,q.jsx)(g.Z,{sx:{mt:6},children:(0,q.jsx)(z.gb,{delayMs:0})}):(0,q.jsx)(eD,{component:x})]}),"dimension-values")}),!n&&(0,q.jsx)(c.Z,{component:"a",variant:"text",size:"sm",color:"primary",onClick:C,endIcon:(0,q.jsx)(eu.Z,{}),sx:{p:0},children:(0,q.jsx)(i.cC,{id:"controls.metadata-panel.show-more"})})]})},eD=e=>{let{component:t}=e,r=(0,R.useMemo)(()=>{let e=(0,eb.tf)(t);return A()(t.values,e.map(e=>t=>e(t.label)))},[t]);if((0,ea.zS)(t)||(0,ea.ab)(t)||(0,ea.FL)(t))return(0,q.jsx)(eE,{values:r});switch(t.__typename){case"NominalDimension":case"OrdinalDimension":case"TemporalEntityDimension":case"TemporalOrdinalDimension":case"OrdinalMeasure":case"GeoCoordinatesDimension":case"GeoShapesDimension":return(0,q.jsx)(eZ,{values:r});case"NumericalMeasure":return r.length>0?(0,q.jsx)(eE,{values:r}):null;case"TemporalDimension":return(0,q.jsx)(eM,{dim:t,values:r});default:return t}},eZ=e=>{let{values:t}=e;return(0,q.jsx)(q.Fragment,{children:t.map(e=>e.label?(0,q.jsxs)(R.Fragment,{children:[(0,q.jsxs)(p.Z,ej(ej({variant:"body3",component:"p"},eO),{},{children:[e.label," ",e.alternateName?(0,q.jsxs)("span",{style:{fontStyle:"italic"},children:["(",e.alternateName,")"]}):""]})),e.description?(0,q.jsx)(p.Z,{variant:"body3",component:"p",children:e.description}):null]},e.value):null)})},eE=e=>{let{values:t}=e,[r,n]=[t[0].value,t[t.length-1].value];return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(p.Z,{variant:"body3",component:"p",children:["Min: ",r]}),(0,q.jsxs)(p.Z,{variant:"body3",component:"p",children:["Max: ",n]})]})},eM=e=>{let{dim:t,values:r}=e,n=(0,el.sz)([t])[t.id],[i,o]=[r[0].value,r[r.length-1].value];return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(p.Z,{variant:"body3",component:"p",children:["Min: ",n(i)]}),(0,q.jsxs)(p.Z,{variant:"body3",component:"p",children:["Max: ",n(o)]})]})}},33342:function(e,t,r){"use strict";r.d(t,{N:function(){return U}});var n=r(17043),i=r(38706),o=r(60116),s=r(65637),a=r(3185),l=r(87026),c=r(89754),d=r.n(c),u=r(27378),p=r(99990),m=r(19914),f=r(98700),h=r(24246);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let y=e=>{let{params:t,value:r,placeholder:n,variant:i,size:o,onClick:s}=e,a=m.ag._({id:"controls.none"});return(0,h.jsx)(f.Z,b(b({},t),{},{placeholder:0===r.length?n??a:void 0,variant:i,onClick:s,inputProps:b(b({},t.inputProps),{},{onClick:void 0,readOnly:!0,size:o,sx:{width:0,minWidth:"0px !important",p:0,"&::placeholder":{opacity:1}}}),sx:{p:0}}))};var v=r(56637),j=r(1787),x=r(53082),C=r(48947);function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let I=e=>{let{props:t,option:{isGroupHeader:r,isNoneValue:n,value:i,label:o,disabled:s,disabledMessage:a},state:c,size:d,width:f}=e;return i||r?r?o&&(0,h.jsx)(v.Z,{children:(0,h.jsx)(l.Z,{variant:"caption",component:"p",style:{maxWidth:f},children:o})},o):(0,u.createElement)(j.Z,w(w({},t),{},{key:i,disabled:s,value:i??void 0,sx:{display:"flex",justifyContent:"space-between !important",alignItems:"center",gap:1,borderBottom:e=>n?`1px solid ${e.palette.divider}`:"none",typography:p.M1[d]}}),(0,h.jsx)(l.Z,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,typography:p.M1[d]},children:n?m.ag._({id:"controls.clear-selection"}):o}),(0,h.jsxs)(x.k,{sx:{justifyContent:"flex-end",alignItems:"center",gap:1,minWidth:24,minHeight:20},children:[a?(0,h.jsx)(p.FX,{message:a}):null,c.selected?(0,h.jsx)(C.JO,{name:"checkmark",size:20}):null]})):null};var S=r(345);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let _=e=>{let{options:t,getTagProps:r,size:n}=e;return(0,h.jsx)(x.k,{sx:{flexWrap:"nowrap",overflowX:"auto",maxWidth:"100%",pl:4,pr:14,py:1},children:t.map((e,t)=>(0,u.createElement)(S.Z,k(k({},r({index:t})),{},{key:e.value,label:(0,h.jsxs)(o.Z,{sx:{display:"inline-flex",alignItems:"center",gap:.5,maxWidth:"100%",overflow:"hidden"},children:[(0,h.jsx)(l.Z,{variant:p.M1[n],sx:{lineHeight:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minWidth:0},children:e.label}),e.disabledMessage?(0,h.jsx)(p.FX,{message:e.disabledMessage}):null]}),deleteIcon:(0,h.jsx)(C.JO,{name:"close",size:16}),size:"small",onClick:e=>{e.preventDefault(),e.stopPropagation()},sx:{maxWidth:"100% !important",height:"fit-content",mr:.5,px:1,py:.75,backgroundColor:"#F0F4F7","&:hover":{backgroundColor:"cobalt.100"},"& .MuiChip-deleteIcon":{color:"text.primary",transition:"color 0.2s ease"}}})))})};var T=r(90089),D=r(47639),Z=r(61799);let E=["children","open","anchorX","anchorY"];function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let L=e=>{let{children:t,open:r,anchorX:n,anchorY:i}=e,o=(0,T.Z)(e,E),{0:s,1:a}=(0,u.useState)(!1),l=(0,u.useRef)();return(0,u.useEffect)(()=>{r&&(a(!1),l.current=t)},[t,r]),(0,h.jsx)(D.Z,A(A({open:r,keepMounted:!0,modifiers:[...F,{name:"computeTransformOrigin",enabled:!0,phase:"write",fn:e=>{let{state:t}=e,r=t.elements.popper;if(!r)return;let{left:o,top:s,width:a,height:l}=r.getBoundingClientRect();r.style.setProperty("--transform-origin",`${Math.max(0,Math.min(n-o,a))}px ${Math.max(0,Math.min(i-s,l))}px`)}}]},o),{},{transition:!0,children:e=>{let{TransitionProps:r}=e;return(0,h.jsx)(Z.Z,A(A({},r),{},{onExit:()=>a(!0),style:{transformOrigin:"var(--transform-origin)"},children:(0,h.jsx)("div",{children:s?l.current:t})}))}}))},F=[{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!0,options:{boundary:"viewport",altBoundary:!0,padding:8,tether:!0,mainAxis:!0,altAxis:!0}}];var N=r(17510),R=r(49148),G=r(77142);function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let U=e=>{let{id:t,label:r,options:n,optionGroups:c,value:m,onChange:f,disabled:g,loading:b,hint:v,placeholder:j,size:x="md",variant:C="outlined",sort:O=!0,sideControls:w,sx:S}=e,{0:P,1:k}=(0,u.useState)(!1),T=(0,u.useRef)(null),{0:D,1:Z}=(0,u.useState)(0),E=(0,R.bU)(),{0:M,1:A}=(0,u.useState)(0),{0:F,1:V}=(0,u.useState)(0),U=(0,G.z)(()=>{let e=T.current;if(!e)return;let t=e.getBoundingClientRect();Z(t.width),A(t.left+t.width/2),V(t.bottom)}),z=(0,u.useMemo)(()=>c&&c.length>0?d()(c.map(e=>{let[t,r]=e;return(0,p.jw)(r,{sort:O,locale:E}).map(e=>$($({},e),{},{group:t?.label}))})):(0,p.jw)(n,{sort:O,locale:E}),[c,O,E,n]),B=(0,u.useMemo)(()=>{let e=new Map(z.map(e=>[e.value,e]));return m.map(t=>e.get(t)).filter(N.y)},[m,z]),H=(0,u.useCallback)(e=>(0,h.jsx)(L,$($({},e),{},{anchorX:M,anchorY:F})),[M,F]);return(0,h.jsx)(i.d,{onClickAway:()=>k(!1),children:(0,h.jsxs)(o.Z,{ref:T,sx:$({width:"100%"},S),children:[r&&(0,h.jsxs)(p.__,{htmlFor:t,sx:{display:"flex",alignItems:"center",mb:1},children:[r,b&&(0,h.jsx)(s.Z,{size:12,sx:{display:"inline-block",marginLeft:2}})]}),(0,h.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,h.jsx)(a.Z,{id:t,open:P,onOpen:U,options:z,value:B,onChange:(e,t)=>{t.some(e=>e.isNoneValue)?f([]):f(t.map(e=>e.value))},disabled:g,multiple:!0,disableCloseOnSelect:!0,disableClearable:!0,groupBy:c&&c.length>0?e=>e.group??"":void 0,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.value===t.value,getOptionDisabled:e=>!!e.disabled,PopperComponent:H,renderOption:(e,t,r)=>(0,h.jsx)(I,{props:e,option:t,state:r,size:x,width:D}),renderTags:(e,t)=>(0,h.jsx)(_,{options:e,getTagProps:t,size:x}),renderInput:e=>(0,h.jsx)(y,{params:e,value:m,placeholder:j,variant:C,size:x,onClick:()=>k(!P)}),sx:{"& .MuiInputBase-root > .MuiInputBase-input":{pl:0===m.length?5:1,typography:p.M1[x]}}}),w]}),v?(0,h.jsx)(o.Z,{sx:{mt:.5},children:(0,h.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:v})}):null]})})}},68227:function(e,t,r){"use strict";r.d(t,{$X:function(){return Z},C:function(){return R},Lg:function(){return T},Qu:function(){return A},Z6:function(){return F},b0:function(){return L},dN:function(){return E},e_:function(){return D},sz:function(){return _},xo:function(){return N}});var n=r(17043),i=r(90089),o=r(64986),s=r(40624),a=r(56141),l=r.n(a),c=r(55807),d=r.n(c),u=r(25389),p=r.n(u),m=r(4215),f=r.n(m),h=r(27378),g=r(30788),b=r(98964),y=r(83001),v=r(52137),j=r(71238),x=r(90453),C=r(92178),O=r(15351),w=r(24246);let I=["children","className","layouts","resize"];function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let k=(0,g.WidthProvider)(g.Responsive),_={chart:["s","w","e","n","sw","nw","se","ne"],text:["w","e"]},T=1,D={xl:4,lg:3,md:2,sm:1},Z={xl:x.r.breakpoints.values.md,lg:x.r.breakpoints.values.sm,md:480,sm:0},E=100,M=(0,o.Z)(e=>({root:{position:"relative","& .react-grid-layout":{position:"relative",transition:"height 200ms ease",minHeight:"initial",background:"#eee",marginTop:"10px"},"& .react-grid-item":{transition:"all 200ms ease",transitionProperty:"none",boxSizing:"border-box"},"& .react-grid-item img":{pointerEvents:"none",userSelect:"none"},"& .react-grid-item.cssTransforms":{transitionProperty:"none"},"& .react-grid-item.resizing":{transition:"none",zIndex:1,willChange:"width, height",opacity:.9},"& .react-grid-item.react-draggable-dragging":{transition:"none",zIndex:3,willChange:"transform"},"& .react-grid-item.dropping":{visibility:"hidden"},"& .react-grid-item.react-grid-placeholder":{background:e.palette.primary.main,opacity:.2,transitionDuration:"100ms",zIndex:2,"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none",userSelect:"none"},"& .react-grid-item.react-grid-placeholder.placeholder-resizing":{transition:"none"},"& .react-grid-item .react-resizable-handle":{position:"absolute",width:"20px",height:"20px"},"& .react-grid-item .react-resizable-handle::after":{content:'""',position:"absolute",right:"3px",bottom:"3px",width:"5px",height:"5px",borderRight:"2px solid rgba(0, 0, 0, 0.4)",borderBottom:"2px solid rgba(0, 0, 0, 0.4)"},"& .react-resizable-hide .react-resizable-handle":{display:"none"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-sw":{bottom:"0",left:"0",cursor:"sw-resize",transform:"rotate(90deg)"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-se":{bottom:"0",right:"0",cursor:"se-resize"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-nw":{top:"0",left:"0",cursor:"nw-resize",transform:"rotate(180deg)"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-ne":{top:"0",right:"0",cursor:"ne-resize",transform:"rotate(270deg)"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-w, & .react-grid-item .react-resizable-handle.react-resizable-handle-e":{top:"50%",marginTop:"-10px",cursor:"ew-resize"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-w":{left:"0",transform:"rotate(135deg)"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-e":{right:"0",transform:"rotate(315deg)"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-n, & .react-grid-item .react-resizable-handle.react-resizable-handle-s":{left:"50%",marginLeft:"-10px",cursor:"ns-resize"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-n":{top:"0",transform:"rotate(225deg)"},"& .react-grid-item .react-resizable-handle.react-resizable-handle-s":{bottom:"0",transform:"rotate(45deg)"},"& .react-grid-item:not(.react-grid-placeholder)":{border:e.palette.divider,boxShadow:e.shadows[1]},"& .react-grid-item.static":{background:"#cce"},"& .react-grid-item .text":{fontSize:"24px",textAlign:"center",position:"absolute",top:"0",bottom:"0",left:"0",right:"0",margin:"auto",height:"24px"},"& .react-grid-item .minMax":{fontSize:"12px"},"& .react-grid-item .add":{cursor:"pointer"},"& .react-grid-dragHandleExample":{cursor:"move"}}})),A=150,L=e=>{let{children:t,className:r,layouts:n,resize:o}=e,a=(0,i.Z)(e,I),c=M(),[d,u]=(0,j.lY)(j.Sc),m=d.layout;(0,C.h)("dashboard"===m.type&&"canvas"===m.layout,"ChartGridLayout can only be used in a canvas layout!");let f=(0,j.VF)(d),{0:g,1:b}=(0,h.useState)(!1),x=(0,O.K)(500,g),S=(0,y.yK)(),{0:Z,1:L}=(0,h.useState)(()=>n?p()(n,e=>e.map(e=>{let t=m.blocks.find(t=>t.key===e.i);return P(P({},e),{},{maxW:4,w:Math.min(4,e.w),resizeHandles:o&&t?_[t.type]:[],minH:e.minH??T,h:Math.max(T,e.h)})})):{});return(0,h.useEffect)(()=>{b(!0)},[]),(0,h.useEffect)(()=>{if(!x||!f)return;let e=Object.fromEntries(Object.entries(Z).map(e=>{let[t,r]=e;return[t,r.map(e=>{let t=m.blocks.find(t=>t.key===e.i);if(t?.initialized)return e;let r=T,n=e.i,i=document.querySelector(`#${(0,v.KN)(n)}`);if(i){let e=i.querySelector(`.${S.chartContainer}`);e&&(r=Math.max(T,Math.ceil((i.scrollHeight-e.clientHeight+A)/E)))}return P(P({},e),{},{maxW:4,w:Math.min(4,e.w),resizeHandles:o&&t?_[t.type]:[],minH:r,h:r})})]}));l()(e,Z)||(L(e),u({type:"LAYOUT_CHANGED",value:P(P({},m),{},{layouts:e,blocks:m.blocks.map(e=>P(P({},e),{},{initialized:!0}))})}))},[f,S.chartContainer,u,Z,x,o,m,d.chartConfigs]),(0,w.jsx)(k,P(P({},a),{},{layouts:n,className:(0,s.Z)(c.root,r),cols:D,rowHeight:E,useCSSTransforms:!1,compactType:"vertical",preventCollision:!1,isResizable:o,children:t}))},F=()=>1,N=()=>7,R=function(e){let{count:t,maxWidth:r=4,maxHeight:n=10,layout:i,resizeHandles:o}=e;return d()(f()(0,t),(e,s)=>(0,b.EQ)(i).with("horizontal",()=>{let e=Math.ceil(n/t);return{x:0,y:s*e,w:r,h:e,minH:T,i:s.toString(),resizeHandles:o}}).with("vertical",()=>{let e=Math.ceil(r/t);return{x:s*e,y:0,w:e,h:n,minH:T,i:s.toString(),resizeHandles:o}}).with("tall",()=>{let e=Math.ceil(n/(t-1));return{x:0===s?0:r/2,y:0===s?0:e*(s-1),w:r/2,h:0===s?n:e,minH:T,i:s.toString(),resizeHandles:o}}).with("tiles",()=>({x:s%4*4/4,y:7*Math.floor(s/2),w:F(),h:N(),minH:T,i:s.toString(),resizeHandles:[]})).with("wide",()=>{let e=Math.ceil(r/(t-1));return{x:0===s?r:e*(s-1),y:0===s?0:n/2,w:0===s?r:e,h:n/2,minH:T,i:s.toString(),resizeHandles:o}}).exhaustive())}},53624:function(e,t,r){"use strict";r.d(t,{Q:function(){return N},_:function(){return R}});var n=r(17043),i=r(90089),o=r(96338),s=r(78643),a=r(26301),l=r(1645),c=r(87026),d=r(58703),u=r(54417),p=r(58290),m=r(60116),f=r(40749),h=r(345),g=r(19365),b=r(3834),y=r(97901),v=r(64986),j=r(40624),x=r(27378),C=r(53082),O=r(99990),w=r(77167),I=r(48947),S=r(85732),P=r(57060),k=r(77142),_=r(24246);let T=["classes","className","displayIcon","expansionIcon","size","icon","label","nodeId","onClick","children","onMouseDown"];function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let E=(0,v.Z)({content:{},root:{"&:hover > div > $iconContainer":{opacity:1},"--depth":1,"& &":{"--depth":2},"& & &":{"--depth":3},"& & & &":{"--depth":4},"& & & & &":{"--depth":5},"& $content":{paddingLeft:"calc(var(--depth) * 10px)"}},iconContainer:{opacity:.5},group:{marginLeft:0}}),M=(0,v.Z)(e=>({action:{marginLeft:e.spacing(2),color:e.palette.text.primary,lineHeight:0,transform:"translateX(0)",opacity:.5,transition:"transform 0.3s ease, opacity 0.3s ease","&:hover":{opacity:1,color:e.palette.primary.main}},root:{"&:hover":{"& $action":{transform:"translateX(0)"}}},checkIcon:{marginLeft:e.spacing(2),marginRight:e.spacing(1)}})),A=(0,x.forwardRef)(function(e,t){let{classes:r,className:n,displayIcon:a,expansionIcon:l,size:d="sm",icon:u,label:p,nodeId:m,onClick:f,children:h,onMouseDown:g}=e,b=(0,i.Z)(e,T),y=b["data-children"],v=!1!==b["data-selectable"],x=!0===b["data-multi"],C=b["data-item-click"],w=!0===b["data-is-selected"],{disabled:S,expanded:P,selected:D,focused:E,handleExpansion:A,handleSelection:L,preventSelection:F}=(0,s.Z)(m),N=(0,k.z)(e=>{F(e),g&&g(e)}),R=M({selectable:v}),G=(0,k.z)(e=>{e.defaultPrevented||A(e)}),V=(0,k.z)(e=>{e.preventDefault(),!1!==v&&(F(e),x&&C?C(m):(L(e),f&&f(e)))});return(0,_.jsxs)("div",Z(Z({className:(0,j.Z)(n,r.root,R.root,{[r.expanded]:P,[r.selected]:D,[r.focused]:E,[r.disabled]:S}),onMouseDown:N,onClick:v&&!y?V:G,ref:t},b),{},{children:[(0,_.jsx)("div",{className:(0,j.Z)(r.iconContainer),children:u||l||a}),(0,_.jsxs)("div",{className:r.label,children:[(0,_.jsx)(c.Z,{variant:O.M1[d],component:"span",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"inline-block",maxWidth:"100%"},children:p}),v&&y?(0,_.jsx)("div",{className:R.action,onClick:V,children:(0,_.jsx)(c.Z,{variant:O.M1[d],component:"span",children:(0,_.jsx)(o.cC,{id:"controls.tree.select-value"})})}):null]}),x&&v&&w?(0,_.jsx)("div",{className:R.checkIcon,children:(0,_.jsx)(I.JO,{name:"checkmark",size:20})}):D&&!x?(0,_.jsx)("div",{className:R.checkIcon,children:(0,_.jsx)(I.JO,{name:"checkmark",size:20})}):null]}))}),L=e=>(0,_.jsx)(a.Z,Z(Z({},e),{},{ContentComponent:A})),F=(e,t)=>{let r=RegExp(`^${t}|\\s${t}`,"i");return""===t?e:(0,P.dp)(e,e=>!!e.label.match(r))},N=e=>{let{value:t,options:r,inputValue:n,onChangeInputValue:i}=e,[o,s]=(0,d.Z)({name:"SelectTree",state:"inputValue",controlled:n,default:""}),a=(0,k.z)(e=>{s(e),i?.(e)}),l=(0,x.useRef)(r),{0:c,1:u}=(0,x.useState)([]),p=l.current!==r?r:c;l.current=r,(0,x.useEffect)(()=>{u(r)},[r]);let m=(0,x.useRef)({}),f=(0,x.useMemo)(()=>{if((!t||Array.isArray(t)&&0===t.length)&&r.length>0)return r[0].value?[r[0].value]:[];let e=Array.isArray(t)?t:t?[t]:[],n=[...e],i=m.current;for(let t of e){let e=t;for(;e&&i[e];)n.push(i[e]),e=i[e]}return Array.from(new Set(n))},[t,r]),{0:h,1:g}=(0,x.useState)(f),b=(0,k.z)(e=>{let t=e.currentTarget.value;a(t);let n=F(r,t);u(n),g(e=>Array.from(new Set([...e,...(0,P.fK)(n).map(e=>e.value)])))}),y=(0,k.z)((e,t)=>{g(t)}),v=(0,k.z)(()=>{a(""),u(F(r,"")),g(f)});return{inputValue:o,setInputValue:a,filteredOptions:p,setFilteredOptions:u,expanded:h,setExpanded:g,handleInputChange:b,parentsRef:m,handleNodeToggle:y,handleClickResetInput:v,defaultExpanded:f}},R=e=>{let{size:t="sm",label:r,options:n,value:i,onChange:s,disabled:a,sideControls:d,onOpen:v,onClose:j,open:P,id:T,isMulti:D=!1}=e,{0:M,1:A}=(0,x.useState)(!1),{0:R,1:G}=(0,x.useState)(),{inputValue:V,setInputValue:$,filteredOptions:U,setFilteredOptions:z,parentsRef:B,expanded:H,setExpanded:W,handleInputChange:Y,handleNodeToggle:K,handleClickResetInput:q,defaultExpanded:X}=N({value:i,options:n}),J=(0,x.useRef)(null),Q=(0,x.useRef)(),ee=(0,x.useMemo)(()=>{B.current={};let e={},t=r=>{let{value:n,label:i,children:o}=r;if(e[n]=i,o&&o.length>0)for(let e of o)t(e),B.current[e.value]=n};for(let e of n)t(e);return e},[n,B]),et=(0,u.Z)(()=>{A(!0),G(Q.current?.clientLeft),v?.()}),er=(0,u.Z)(()=>{A(!1),$(""),z(F(n,"")),W(X),j?.()}),en=(0,u.Z)((e,t)=>{s({target:{value:t}}),D||er()}),ei=(0,u.Z)(e=>{if(D){if(e===w.P){s({target:{value:[]}});return}s({target:{value:i.includes(e)?i.filter(t=>t!==e):[...i,e]}})}else s({target:{value:e}}),er()}),eo=E(),es=(0,x.useMemo)(()=>({onEntered:()=>{J.current?.updatePosition()},onExited:()=>{J.current?.updatePosition()}}),[]),ea=(0,x.useCallback)(e=>(0,_.jsx)(_.Fragment,{children:e.map(e=>{let{value:r,label:n,children:o,selectable:s}=e;return(0,_.jsx)(L,{nodeId:r,defaultExpanded:X,label:n,size:t,expandIcon:o&&o.length>0?(0,_.jsx)(S.Z,{}):null,classes:eo,TransitionComponent:p.Z,TransitionProps:es,ContentProps:{"data-selectable":s,"data-children":o&&o.length>0,"data-multi":D,"data-item-click":D?ei:void 0,"data-is-selected":D?i.includes(r):void 0},children:o?ea(o):null},r)})}),[X,t,eo,es,D,ei,i]),el=(0,x.useMemo)(()=>({sx:{minWidth:R??0,boxShadow:3}}),[R]),ec=(0,x.useMemo)(()=>({onEnter:(e,t)=>{t&&(e.style.transition=`${e.style.transition}, top 158ms cubic-bezier(0.4, 0, 0.2, 1)`)}}),[]),ed=(0,x.useRef)(),eu=(0,k.z)(e=>{("Enter"===e.key||" "==e.key)&&(et(),e.preventDefault())});return(0,x.useEffect)(()=>{let e=Q.current;e&&G(e.clientWidth)},[P]),(0,_.jsxs)("div",{children:[r&&(0,_.jsx)(O.__,{htmlFor:T,sx:{display:"flex",alignItems:"center",mb:1},children:r}),(0,_.jsxs)(m.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,_.jsx)(f.Z,{"aria-expanded":P,ref:Q,id:T,name:T,size:t,disabled:a,readOnly:!0,displayEmpty:!0,value:D?i.length>0?i.join(","):"":i?ee[i]:void 0,onClick:a?void 0:et,onKeyDown:eu,renderValue:()=>D&&Array.isArray(i)&&i.length>0?(0,_.jsx)(C.k,{sx:{flexWrap:"nowrap",gap:.5,overflowX:"auto",maxWidth:"calc(100% - 32px)",py:2},children:i.map(e=>(0,_.jsx)(h.Z,{label:(0,_.jsx)(m.Z,{sx:{display:"inline-flex",alignItems:"center",gap:.5,py:1,maxWidth:"100%",overflow:"hidden"},children:(0,_.jsx)(c.Z,{variant:O.M1[t],sx:{lineHeight:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minWidth:0},children:ee[e]})}),size:"small",deleteIcon:(0,_.jsx)(I.JO,{name:"close",size:16}),onDelete:t=>{t.stopPropagation(),s({target:{value:i.filter(t=>t!==e)}})},onClick:e=>{e.preventDefault(),e.stopPropagation()},sx:{maxWidth:"100% !important",height:"fit-content",mr:.5,px:1,py:.25,backgroundColor:"#F0F4F7","&:hover":{backgroundColor:"cobalt.100"},"& .MuiChip-deleteIcon":{color:"text.primary",transition:"color 0.2s ease"}}},e))}):D&&Array.isArray(i)&&0===i.length?(0,_.jsx)(o.cC,{id:"controls.dimensionvalue.select"}):(0,_.jsx)(c.Z,{variant:O.M1[t],sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:i?ee[i]:void 0}),sx:Z({"& svg":{transform:P?"rotate(180deg)":"rotate(0deg)"}},D&&{"& .MuiSelect-select.MuiInputBase-input.MuiOutlinedInput-input":{display:"flex",alignItems:"center",height:40,minHeight:0,padding:"0px 16px !important"},"&:hover":{"& .MuiSelect-select":{backgroundColor:"transparent"}}})}),d]}),(0,_.jsxs)(g.ZP,{anchorEl:Q.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},open:void 0!==P?P:!!M,onClose:er,action:J,slotProps:{paper:el},TransitionProps:ec,children:[(0,_.jsx)(b.Z,{size:"sm",value:V,autoFocus:!0,startAdornment:(0,_.jsx)(I.JO,{name:"search",size:18}),endAdornment:(0,_.jsx)(y.Z,{size:"small",onClick:q,children:(0,_.jsx)(I.JO,{name:"close",size:16})}),onChange:Y,sx:{px:2,py:1,"& .MuiInput-input":{px:1}}}),0===U.length?(0,_.jsx)(c.Z,{variant:O.M1[t],component:"p",sx:{py:2,textAlign:"center"},children:(0,_.jsx)(o.cC,{id:"No results"})}):(0,_.jsx)(l.Z,{ref:ed,multiSelect:D,selected:i,expanded:H,onNodeToggle:K,onNodeSelect:D?()=>{}:en,children:ea(U)})]})]})}},79171:function(e,t,r){"use strict";r.d(t,{V:function(){return g}});var n=r(17043),i=r(90089),o=r(1869),s=r(87026),a=r(64986),l=r(40624),c=r(27378),d=r(24246);let u=["children","type"];function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let f=(0,o.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"inline-flex",alignItems:"center",width:"fit-content",minHeight:24,padding:`${t.spacing(1)} ${t.spacing(2)}`,borderRadius:"16px",transition:"box-shadow 0.2s ease"}}),h=(0,a.Z)(e=>({themeType:{backgroundColor:e.palette.green[100]},organizationType:{backgroundColor:e.palette.blue[100]},termsetType:{backgroundColor:e.palette.cobalt[50]},unknownType:{backgroundColor:e.palette.cobalt[50]},dimensionType:{backgroundColor:e.palette.yellow[100]},draftType:{},clickable:{cursor:"pointer","&:hover":{boxShadow:e.shadows[2]}}})),g=(0,c.forwardRef)((e,t)=>{let{children:r,type:n="unknown"}=e,o=(0,i.Z)(e,u),s=h();return(0,d.jsx)(f,m(m({ref:t,variant:"caption"},o),{},{className:(0,l.Z)(o.className,s[`${n}Type`],o.onClick?s.clickable:null),children:r}))})},78839:function(e,t,r){"use strict";r.d(t,{Co:function(){return G},al:function(){return N},aW:function(){return R},E1:function(){return $}});var n=r(17043),i=r(90089),o=r(19914),s=r(59052),a=r(64986),l=r(40624),c=r(49882),d=r(56141),u=r.n(d),p=r(27378),m=r(78222),f=r(32597),h=r(54417),g=r(97901),b=r(32027),y=r(7663),v=r(15658),j=r(10341),x=r(59823),C=r(71171),O=r(24246);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let S=e=>{let{blockKey:t}=e,[r,n]=(0,v.lY)(v.VF),{layout:i}=r,{0:s,1:a}=(0,p.useState)(null),l=(0,h.Z)(()=>a(null)),c=(0,h.Z)(()=>{let e=(0,x.M)(),r=i.blocks.find(e=>e.key===t);r&&(n({type:"LAYOUT_CHANGED",value:I(I({},i),{},{blocks:[...i.blocks,I(I({},r),{},{key:e})]})}),n({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:e}))}),d=(0,h.Z)(()=>{n({type:"LAYOUT_CHANGED",value:I(I({},i),{},{blocks:i.blocks.filter(e=>e.key!==t)})}),i.activeField===t&&n({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:void 0})});return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(g.Z,I(I({color:"secondary",onClick:e=>{e.stopPropagation(),a(e.currentTarget)},sx:{height:"fit-content"}},C.nT),{},{"data-testid":"block-more-button",children:(0,O.jsx)(j.Z,{})})),(0,O.jsx)(b.N7,{open:!!s,anchorEl:s,onClose:e=>{e.stopPropagation(),l()},anchorOrigin:{horizontal:"right",vertical:"bottom"},transformOrigin:{horizontal:"right",vertical:"top"},children:(0,O.jsxs)("div",{children:[(0,O.jsx)(y.M,{type:"button",as:"menuitem",onClick:e=>{e.stopPropagation(),c(),l()},leadingIconName:"duplicate",label:o.ag._({id:"block-controls.duplicate"})}),(0,O.jsx)(y.M,{type:"button",as:"menuitem",color:"red",requireConfirmation:!0,confirmationTitle:o.ag._({id:"block-controls.delete.title"}),confirmationText:o.ag._({id:"block-controls.delete.confirmation"}),onClick:e=>{e.stopPropagation(),d(),l()},leadingIconName:"trash",label:o.ag._({id:"block-controls.delete"})})]})})]})};var P=r(70185),k=r(27686),_=r(68227),T=r(49148),D=r(77142);let Z=["children","block","className","dragHandleProps"];function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let A=(0,a.Z)(()=>({root:{gridRow:`span ${f.vA+1}`,display:"flex",padding:"0.75rem",cursor:e=>{let{layouting:t}=e;return t?"pointer":"default"},"&:hover":{textDecoration:e=>{let{layouting:t}=e;return t?"underline":"none"}}}})),L="text-block-wrapper",F="text-block-content",N=(0,p.forwardRef)((e,t)=>{let{children:r,block:n,className:s,dragHandleProps:a}=e,c=(0,i.Z)(e,Z),d=(0,T.bU)(),[u,p]=(0,v.lY)(v.Sc),m=(0,v.VF)(u),f=A({layouting:m}),h=(0,D.z)(e=>{m&&p({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:e.key})}),g=n.text[d];return(0,O.jsxs)("div",M(M({},c),{},{ref:t,id:n.key,className:(0,l.Z)(f.root,s,L),onClick:e=>{e.isPropagationStopped()||h(n)},children:[(0,O.jsx)("div",{className:F,style:{flexGrow:1,height:"fit-content"},children:(0,O.jsx)(k.UG,{children:g||o.ag._({id:"annotation.add.text"})})}),m?(0,O.jsx)(V,{block:n,dragHandleProps:a}):null,r]}))}),R=e=>(0,O.jsx)(N,{block:e},e.key),G=e=>{let{block:t}=e,{setActivatorNodeRef:r,setNodeRef:n,attributes:i,listeners:o,isDragging:a}=(0,s.O1)({id:t.key}),{setNodeRef:l,isOver:c,active:d}=(0,s.Zj)({id:t.key}),u=(0,p.useCallback)(e=>{n(e),l(e)},[n,l]),m=(0,P.x)({isDragging:a,isDragActive:!!d,isDragOver:c});return(0,O.jsx)(N,M(M({},i),{},{ref:u,block:t,className:a||d||c?m.root:void 0,dragHandleProps:M({ref:r,dragging:a},o)}))},V=e=>{let{block:t,dragHandleProps:r}=e;return(0,O.jsxs)(m.G,{children:[(0,O.jsx)(S,{blockKey:t.key}),(0,O.jsx)(P.D,M({onClick:e=>{e.stopPropagation()}},r))]})},$=()=>{let[e,t]=(0,v.lY)(v.Sc),r=e.layout,n="dashboard"===r.type&&"canvas"===r.layout;(0,p.useLayoutEffect)(()=>{n&&(0,c.Z)(`.${L}`).each(function(){let e=this.querySelector(`.${F}`);if(!e)return;let n=this.id,i=Math.ceil(e.clientHeight/_.dN)||1,o=Object.fromEntries(Object.entries(r.layouts).map(e=>{let[t,r]=e;return[t,r.map(e=>e.i===n?M(M({},e),{},{h:i,minH:i}):e)]}));u()(o,r.layouts)||t({type:"LAYOUT_CHANGED",value:M(M({},r),{},{layouts:o})})})},[t,r,n])}},50953:function(e,t,r){"use strict";r.d(t,{Ab:function(){return tp},CY:function(){return tu},Ch:function(){return tl},EA:function(){return eK},FJ:function(){return tF},GK:function(){return td},I3:function(){return tc},MO:function(){return tm},Mm:function(){return tS},NR:function(){return eW},Nu:function(){return tf},OS:function(){return e8},Su:function(){return ts},UN:function(){return tr},WP:function(){return $},fD:function(){return ta},jM:function(){return ec},nV:function(){return N},qB:function(){return tE},tJ:function(){return e9},uq:function(){return te},yU:function(){return ty},z0:function(){return tD}});var n=r(65772),i=r(45980),o=r(81249);let s=o.G0([o.i0("NominalDimension"),o.i0("OrdinalDimension"),o.i0("TemporalDimension"),o.i0("TemporalEntityDimension"),o.i0("TemporalOrdinalDimension"),o.i0("GeoCoordinatesDimension"),o.i0("GeoShapesDimension"),o.i0("StandardErrorDimension"),o.i0("ConfidenceUpperBoundDimension"),o.i0("ConfidenceLowerBoundDimension")]),a=o.G0([o.i0("NumericalMeasure"),o.i0("OrdinalMeasure")]),l=o.G0([s,a]),c=o.jV([o.dt({type:o.i0("single"),value:o.G0([o.Z_,o.pk])},"FilterValueSingle"),o.r$({position:o.pk})]),d=o.jV([o.dt({type:o.i0("multi"),values:o.IM(o.Z_,o.i0(!0))},"FilterValueMulti"),o.r$({position:o.pk})]),u=o.jV([o.dt({type:o.i0("range"),from:o.Z_,to:o.Z_},"FilterValueRange"),o.r$({position:o.pk})]),p=o.G0([c,d,u],"FilterValue"),m=o.IM(o.Z_,p,"Filters"),f=o.IM(o.Z_,c,"SingleFilters"),h=o.dt({de:o.Z_,fr:o.Z_,it:o.Z_,en:o.Z_}),g=o.dt({de:o.Z_,fr:o.Z_,it:o.Z_,en:o.Z_}),b=o.dt({de:o.Z_,fr:o.Z_,it:o.Z_,en:o.Z_}),y=o.dt({title:h,description:g,label:b}),v=o.dt({active:o.O7,componentId:o.Z_}),j=o.dt({active:o.O7,componentId:o.Z_,presets:o.dt({type:o.i0("range"),from:o.Z_,to:o.Z_})}),x=o.IM(o.Z_,o.IX(o.Z_)),C=o.G0([o.i0("single"),o.i0("multi")]),O=o.jV([o.dt({active:o.O7,componentIds:o.IX(o.Z_),defaultValueOverrides:x,filterTypes:o.IM(o.Z_,C)}),o.r$({defaultOpen:o.O7})]),w=o.G0([o.i0("identity"),o.i0("percent")]),I=o.dt({active:o.O7,type:w}),S=o.dt({legend:v,timeRange:j,dataFilters:O,calculation:I}),P=o.IM(o.Z_,o.Z_),k=o.dt({type:o.i0("single"),paletteId:o.Z_,color:o.Z_}),_=o.dt({type:o.i0("segment"),paletteId:o.Z_,colorMapping:P}),T=o.dt({type:o.i0("measures"),paletteId:o.Z_,colorMapping:P});o.G0([k,_,T]);let D=o.jV([o.dt({componentId:o.Z_}),o.r$({useAbbreviations:o.O7})]);o.IM(o.Z_,o.G0([D,o.S1]));let Z=o.G0([o.i0("continuous"),o.i0("stepped")]),E=o.jV([D,o.dt({showPlayButton:o.O7,type:Z,duration:o.pk,dynamicScales:o.O7})]),M=o.G0([o.i0("asc"),o.i0("desc")]),A=o.G0([o.i0("byDimensionLabel"),o.i0("byMeasure"),o.i0("byTotalSize"),o.i0("byAuto")]),L=o.r$({sorting:o.dt({sortingType:A,sortingOrder:M})}),F=o.dt({showValuesMapping:o.IM(o.Z_,o.O7)}),N=e=>(tr(e)||tt(e))&&e.fields.segment?.type==="stacked",R=o.jV([o.dt({iri:o.Z_,filters:m}),o.r$({joinBy:o.IX(o.Z_)})]),G=o.dt({componentId:o.Z_,value:o.Z_}),V=o.dt({key:o.Z_,type:o.i0("highlight"),targets:o.IX(G),text:o.dt({de:o.Z_,fr:o.Z_,it:o.Z_,en:o.Z_}),highlightType:o.G0([o.i0("none"),o.i0("filled")]),color:o.G0([o.Z_,o.S1]),defaultOpen:o.O7}),$=e=>{switch(e.chartType){case"area":case"bar":case"column":case"line":case"pie":case"scatterplot":return!0;case"comboLineColumn":case"comboLineDual":case"comboLineSingle":case"map":case"table":return!1;default:return e}},U=o.jV([o.dt({related:o.IX(o.dt({dimensionId:o.Z_,value:o.Z_})),color:o.Z_,lineType:o.G0([o.i0("dashed"),o.i0("solid")])}),o.r$({symbolType:o.G0([o.i0("cross"),o.i0("circle"),o.i0("triangle")])})]),z=o.dt({multiplier:o.pk,labels:o.dt({de:o.Z_,fr:o.Z_,it:o.Z_,en:o.Z_})}),B=o.dt({key:o.Z_,version:o.Z_,meta:y,cubes:o.IX(R),interactiveFiltersConfig:S,annotations:o.IX(V),limits:o.IM(o.Z_,o.IX(U)),conversionUnitsByComponentId:o.IM(o.Z_,z),activeField:o.G0([o.Z_,o.S1])}),H=o.r$({showTitle:o.O7}),W=o.r$({showValues:o.O7}),Y=o.r$({showStandardError:o.O7,showConfidenceInterval:o.O7}),K=o.r$({customDomain:o.bc([o.pk,o.pk])}),q=o.G0([o.i0("stacked"),o.i0("grouped")]),X=o.jV([D,L,o.dt({type:q}),H,F]),J=o.jV([o.dt({x:o.jV([D,L]),y:o.jV([D,W,Y,K]),color:o.G0([_,k])}),o.r$({segment:X,animation:E})]),Q=o.jV([B,o.dt({chartType:o.i0("column"),fields:J},"ColumnConfig")]),ee=o.jV([D,L,o.dt({type:q}),H,F]),et=o.jV([o.dt({x:o.jV([D,W,K]),y:o.jV([D,L]),color:o.G0([_,k])}),o.r$({segment:ee,animation:E})]),er=o.jV([B,o.dt({chartType:o.i0("bar"),fields:et},"BarConfig")]),en=o.jV([D,L,H,F]),ei=o.G0([o.i0("Small"),o.i0("Medium"),o.i0("Large")]),eo=o.jV([o.dt({x:D,y:o.jV([D,W,Y,K,o.r$({showDots:o.O7,showDotsSize:ei})]),color:o.G0([_,k])}),o.r$({segment:en})]),es=o.jV([B,o.dt({chartType:o.i0("line"),fields:eo},"LineConfig")]),ea=o.jV([D,L,H,F]),el=o.G0([o.i0("none"),o.i0("zeros"),o.i0("linear")]),ec=["none","zeros","linear"],ed=o.jV([o.dt({x:D,y:o.jV([D,W,K,o.r$({imputationType:el})]),color:o.G0([_,k])}),o.r$({segment:ea})]),eu=o.jV([B,o.dt({chartType:o.i0("area"),fields:ed},"AreaConfig")]),ep=o.jV([D,H,F]),em=o.jV([o.dt({x:D,y:D,color:o.G0([_,k])}),o.r$({segment:ep,animation:E})]),ef=o.jV([B,o.dt({chartType:o.i0("scatterplot"),fields:em},"ScatterPlotConfig")]),eh=o.jV([D,L,H,F]),eg=o.jV([o.dt({y:o.jV([D,W]),segment:eh,color:_}),o.r$({animation:E})]),eb=o.jV([B,o.dt({chartType:o.i0("pie"),fields:eg},"PieConfig")]),ey=o.G0([o.i0("BrBG"),o.i0("PiYG"),o.i0("PRGn"),o.i0("PuOr"),o.i0("RdBu"),o.i0("RdYlBu"),o.i0("RdYlGn")]),ev=o.G0([o.i0("blues"),o.i0("greens"),o.i0("greys"),o.i0("oranges"),o.i0("purples"),o.i0("reds")]),ej=o.i0("dimension"),ex=o.G0([ej,o.i0("accent"),o.i0("category10"),o.i0("dark2"),o.i0("paired"),o.i0("pastel1"),o.i0("pastel2"),o.i0("set1"),o.i0("set2"),o.i0("set3"),o.i0("tableau10")]),eC=o.dt({type:o.i0("diverging"),paletteId:ey,name:ey}),eO=o.dt({type:o.i0("sequential"),paletteId:ev,name:ev}),ew=o.dt({type:o.i0("categorical"),paletteId:ex,name:ex}),eI=o.dt({type:o.G0([o.i0("diverging"),o.i0("sequential"),o.i0("categorical")]),paletteId:o.Z_,name:o.Z_,colors:o.IX(o.Z_)});o.G0([eC,eO,ew,eI]),o.G0([o.i0("continuous"),o.i0("discrete")]),o.G0([o.i0("linear"),o.i0("quantize"),o.i0("quantile"),o.i0("jenks")]);let eS=o.G0([o.i0("regular"),o.i0("bold")]),eP=o.dt({type:o.i0("text"),textStyle:eS,textColor:o.Z_,columnColor:o.Z_}),ek=o.dt({type:o.i0("category"),textStyle:eS,paletteId:o.Z_,colorMapping:P}),e_=o.dt({type:o.i0("heatmap"),textStyle:eS,paletteId:ey}),eT=o.dt({type:o.i0("bar"),textStyle:eS,barColorPositive:o.Z_,barColorNegative:o.Z_,barColorBackground:o.Z_,barShowBackground:o.O7}),eD=o.G0([eP,ek,e_,eT]),eZ=o.dt({componentId:o.Z_,componentType:l,index:o.pk,isGroup:o.O7,isHidden:o.O7,columnStyle:eD}),eE=o.dt({showSearch:o.O7,showAllRows:o.O7}),eM=o.dt({enabled:o.O7,baseUrl:o.Z_,componentId:o.Z_,targetComponentId:o.Z_}),eA=o.IM(o.Z_,eZ),eL=o.dt({componentId:o.Z_,componentType:l,sortingOrder:M}),eF=o.jV([B,o.dt({chartType:o.i0("table"),fields:eA,settings:eE,links:eM,sorting:o.IX(eL)},"TableConfig")]),eN=o.bc([o.bc([o.pk,o.pk]),o.bc([o.pk,o.pk])]),eR=o.dt({opacity:o.pk});o.G0([o.i0("fixed"),o.i0("categorical"),o.i0("numerical")]);let eG=o.jV([o.dt({type:o.i0("fixed"),value:o.Z_}),eR]),eV=o.jV([o.dt({type:o.i0("categorical"),componentId:o.Z_,paletteId:o.Z_,colorMapping:P}),o.r$({useAbbreviations:o.O7}),eR]),e$=o.jV([o.dt({type:o.i0("numerical"),componentId:o.Z_,paletteId:o.Z_}),o.r$({paletteType:o.G0([o.i0("sequential"),o.i0("diverging")]),colors:o.IX(o.Z_)}),o.G0([o.dt({scaleType:o.i0("continuous"),interpolationType:o.i0("linear")}),o.dt({scaleType:o.i0("discrete"),interpolationType:o.G0([o.i0("quantize"),o.i0("quantile"),o.i0("jenks")]),nbClass:o.pk})]),eR]),eU=o.dt({componentId:o.Z_,color:o.G0([eV,e$])}),ez=o.dt({componentId:o.Z_,measureId:o.Z_,color:o.G0([eG,eV,e$])}),eB=o.dt({id:o.Z_,isBehindAreaLayer:o.O7,syncTemporalFilters:o.O7,endpoint:o.G0([o.Z_,o.S1])}),eH=o.jV([o.dt({type:o.i0("wms"),endpoint:o.Z_}),eB]),eW=e=>e.filter(e=>"wms"===e.type),eY=o.jV([o.dt({type:o.i0("wmts"),url:o.Z_}),eB]),eK=e=>e.filter(e=>"wmts"===e.type),eq=o.dt({show:o.O7,locked:o.O7,bbox:o.G0([eN,o.S1]),customLayers:o.IX(o.G0([eH,eY]))}),eX=o.r$({areaLayer:eU,symbolLayer:ez,animation:E}),eJ=o.jV([B,o.dt({chartType:o.i0("map"),fields:eX,baseLayer:eq},"MapConfig")]),eQ=o.dt({x:D,y:o.dt({componentIds:o.IX(o.Z_)}),color:T}),e0=o.jV([B,o.dt({chartType:o.i0("comboLineSingle"),fields:eQ},"ComboLineSingleConfig")]),e1=o.dt({x:D,y:o.dt({leftAxisComponentId:o.Z_,rightAxisComponentId:o.Z_}),color:T}),e2=o.jV([B,o.dt({chartType:o.i0("comboLineDual"),fields:e1},"ComboLineDualConfig")]),e4=o.dt({x:D,y:o.dt({lineComponentId:o.Z_,lineAxisOrientation:o.G0([o.i0("left"),o.i0("right")]),columnComponentId:o.Z_}),color:T}),e3=o.jV([B,o.dt({chartType:o.i0("comboLineColumn"),fields:e4},"ComboLineColumnConfig")]),e7=o.G0([eu,Q,er,es,eJ,eb,ef,eF]),e6=o.G0([e0,e2,e3]),e5=o.G0([e7,e6]),e9=e=>tn(e)||ti(e)||to(e),e8=e=>Object.entries(e.fields).reduce((e,t)=>{let[r,n]=t;return n&&"string"==typeof n.componentId&&(e[r]=n),e},{}),te=e=>"area"===e.chartType,tt=e=>"column"===e.chartType,tr=e=>"bar"===e.chartType,tn=e=>"comboLineSingle"===e.chartType,ti=e=>"comboLineDual"===e.chartType,to=e=>"comboLineColumn"===e.chartType,ts=e=>"table"===e.chartType,ta=e=>"map"===e.chartType,tl=e=>"area"===e.chartType||"column"===e.chartType&&void 0!==e.fields.segment&&"stacked"===e.fields.segment.type||"bar"===e.chartType&&void 0!==e.fields.segment&&"stacked"===e.fields.segment.type,tc=e=>["area","column","bar","line","pie","scatterplot"].includes(e.chartType),td=e=>!ts(e)&&!ta(e),tu=e=>["area","column","bar","line","pie"].includes(e.chartType),tp=e=>["column","bar","map","pie","scatterplot"].includes(e.chartType),tm=e=>{if(tp(e))return e.fields.animation},tf=e=>ta(e),th=o.dt({type:o.G0([o.i0("sql"),o.i0("sparql")]),url:o.Z_}),tg=o.mM({s:null,w:null,e:null,n:null,sw:null,nw:null,se:null,ne:null}),tb=o.dt({w:o.pk,h:o.pk,minH:o.G0([o.pk,o.S1]),x:o.pk,y:o.pk,i:o.Z_,resizeHandles:o.G0([o.IX(tg),o.S1])}),ty=o.IM(o.Z_,o.IX(tb)),tv=o.dt({type:o.i0("chart"),key:o.Z_}),tj=o.dt({type:o.i0("text"),key:o.Z_,text:o.dt({de:o.Z_,fr:o.Z_,it:o.Z_,en:o.Z_})}),tx=o.jV([o.G0([tv,tj]),o.dt({initialized:o.O7})]),tC=o.jV([o.dt({activeField:o.G0([o.S1,o.Z_]),meta:y,blocks:o.IX(tx)}),o.G0([o.dt({type:o.i0("tab")}),o.dt({type:o.i0("dashboard"),layout:o.G0([o.i0("vertical"),o.i0("tall")])}),o.dt({type:o.i0("dashboard"),layout:o.i0("canvas"),layouts:ty}),o.dt({type:o.i0("singleURLs"),publishableChartKeys:o.IX(o.Z_)})])]),tO=o.dt({active:o.O7,timeUnit:o.Z_,presets:o.dt({from:o.Z_,to:o.Z_})}),tw=o.dt({componentIds:o.IX(o.Z_),filters:f}),tI=o.dt({timeRange:tO,dataFilters:tw}),tS=e=>!!e?.dataFilters.componentIds.length,tP=o.jV([o.dt({version:o.Z_,dataSource:th,layout:tC,chartConfigs:o.IX(e5),activeChartKey:o.Z_,dashboardFilters:o.G0([tI,o.S1])},"Config"),o.r$({key:o.Z_})]),tk=o.dt({state:o.i0("INITIAL"),version:o.Z_,dataSource:th}),t_=o.dt({state:o.i0("SELECTING_DATASET"),version:o.Z_,dataSource:th,chartConfigs:o.S1,layout:o.S1,activeChartKey:o.S1}),tT=o.jV([o.dt({state:o.i0("CONFIGURING_CHART")}),tP]),tD="LAYOUTING",tZ=o.jV([o.dt({state:o.i0(tD)}),tP]),tE=e=>e.chartConfigs.length>1,tM=o.jV([o.dt({state:o.i0("PUBLISHING")}),tP]),tA=o.jV([o.dt({state:o.i0("PUBLISHED")}),tP]),tL=o.G0([tk,t_,tT,tZ,tM,tA]),tF=e=>(0,i.pipe)(tL.decode(e),(0,n.fold)(e=>{console.error("Error while decoding configurator state",e)},e=>e))},25390:function(e,t,r){"use strict";r.d(t,{B6:function(){return O},CM:function(){return w},G_:function(){return b},In:function(){return x},LC:function(){return C},LU:function(){return I},Wd:function(){return g},bV:function(){return y},f6:function(){return v},jW:function(){return j},sH:function(){return P},xk:function(){return k}});var n=r(17043),i=r(28646),o=r(27378),s=r(50953),a=r(15658),l=r(64103),c=r(17510),d=r(41494),u=r(50726),p=r(8788);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let h=e=>"single"===e.type,g=e=>Object.values(e).every(h),b=e=>Object.fromEntries(Object.entries(e).filter(e=>{let[,t]=e;return"single"===t.type})),y=e=>({type:"multi",values:Object.fromEntries(e.map(e=>[e,!0]))}),v=(e,t)=>{if("INITIAL"===e.state||"SELECTING_DATASET"===e.state)throw Error("No chart config available!");let{chartConfigs:r,activeChartKey:n}=e,i=t??n;return r.find(e=>e.key===i)??r[0]},j=function(e){let{cubeIri:t,joined:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.filter(e=>!t||e.iri===t),i=r?Object.fromEntries(n.flatMap(e=>(e.joinBy??[]).map((e,t)=>[e,(0,u.mM)(t)]))):{};return Object.fromEntries(n.flatMap(e=>Object.entries(e.filters).map(e=>{let[t,r]=e;return[i[t]??t,r]})))},x=(e,t)=>(0,o.useMemo)(()=>j(e.cubes,{cubeIri:t?.cubeIri,joined:t?.joined}),[e.cubes,t?.cubeIri,t?.joined]),C=e=>{let{dimensions:t}=e,[r]=(0,a.lY)(),n=v(r),u=O(),m=t.filter(l.aw),f=Object.entries(u).map(e=>{let[t,r]=e;return m.some(e=>e.id===t)&&"single"===r.type?r:void 0}).filter(c.y),h=m.find(e=>e.id===s.MO(n)?.componentId),g=(0,d.z6)(),b=h?.timeUnit,{value:y}=(0,p.bI)(e=>e.timeSlider),j=b&&y?g(new Date(y),b):void 0;return(0,o.useMemo)(()=>{if(!h||!j)return;let e=(0,i.ZR)(h.values.map(e=>e.value),j);return h.values[e]?.value},[h,j])||(f.length>1&&console.warn("More than one temporal filter found. Using the first one."),1===f.length?f[0].value:void 0)},O=()=>{let[e]=(0,a.lY)(),t=x(v(e)),r=(0,p.bI)(e=>e.dataFilters),n=(0,p.Rx)();return(0,o.useMemo)(()=>{let e={};for(let[r,n]of Object.entries(t))e[r]=n;for(let[t,n]of Object.entries(r))e[t]=n;for(let[t]of Object.values(n.stores))for(let[r,n]of Object.entries(t().dataFilters))e[r]=n;return e},[t,r,n])},w=e=>{let{chartConfig:t,measureId:r,limit:n,axisDimension:i,filters:o}=e,s=i?n.related.find(e=>e.dimensionId===i.id)?.value:void 0,a=i?[...i.values,...i.relatedLimitValues].find(e=>e.value===s)?.label:void 0;for(let e of i?n.related.filter(e=>e.dimensionId!==i.id):n.related){let t=o[e.dimensionId];if((t&&h(t)?t.value:void 0)!==e.value)return{limit:void 0,relatedAxisDimensionValueLabel:a,wouldBeValid:!1}}return{limit:(t.limits[r]??[]).find(e=>e.related.length===n.related.length&&e.related.every(e=>n.related.some(t=>t.dimensionId===e.dimensionId&&t.value===e.value))),relatedAxisDimensionValueLabel:a,wouldBeValid:!0}},I=e=>{let{chartConfig:t,dimensions:r}=e;switch(t.chartType){case"area":case"column":case"line":return r.find(e=>e.id===t.fields.x.componentId);case"bar":return r.find(e=>e.id===t.fields.y.componentId);case"map":case"comboLineColumn":case"comboLineDual":case"comboLineSingle":case"pie":case"scatterplot":case"table":return;default:return t}},S=e=>{let{chartConfig:t,measures:r}=e;switch(t.chartType){case"area":case"column":case"line":return r.find(e=>e.id===t.fields.y.componentId);case"bar":return r.find(e=>e.id===t.fields.x.componentId);case"map":return r.find(e=>e.id===t.fields.symbolLayer?.measureId);case"comboLineColumn":case"comboLineDual":case"comboLineSingle":case"pie":case"scatterplot":case"table":return;default:return t}},P=e=>{let{chartConfig:t,dimensions:r,measures:n}=e,i=O(),s=S({chartConfig:t,measures:n}),a=I({chartConfig:t,dimensions:r});return(0,o.useMemo)(()=>s?{axisDimension:a,limitMeasure:s,limits:s.limits.map(e=>{let{limit:r,relatedAxisDimensionValueLabel:n}=w({chartConfig:t,measureId:s.id,limit:e,axisDimension:a,filters:i});return r?{configLimit:f(f({},r),{},{symbolType:"single"===e.type&&k(t)?r.symbolType??"circle":void 0}),measureLimit:e,relatedAxisDimensionValueLabel:n,limitUnit:s.unit}:null}).filter(c.y)}:{axisDimension:a,limitMeasure:s,limits:[]},[s,a,t,i])},k=e=>"area"===e.chartType||"line"===e.chartType},42601:function(e,t,r){"use strict";r.d(t,{r:function(){return C},f:function(){return j}});var n=r(54417),i=r(27378),o=r(25380),s=r(58555),a=r(30503),l=r(17043),c=r(97901),d=r(69763),u=r(24246);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,l.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let f=e=>(0,u.jsx)(c.Z,m(m({},e),{},{sx:{zIndex:1,position:"absolute",top:"1rem",right:"1rem"},children:(0,u.jsx)(d.Z,{})}));var h=r(56436),g=r(15658),b=r(49148),y=r(57906),v=r(92178);let j=(0,s.ZP)(e=>({isOpen:!1,toggle:()=>{e(e=>({isOpen:!e.isOpen}))},close:()=>{e({isOpen:!1})},open:()=>{e({isOpen:!0})}})),x=()=>{let[,e]=(0,g.lY)(),t=(0,b.bU)(),r=(0,o.m8)(),{dataSource:i}=(0,y.qo)();return(0,n.Z)(async n=>{let o=await (0,g.YO)(r,n,i,t);o&&((0,v.h)(o?.state==="CONFIGURING_CHART","After init, chart state should be in CONFIGURING_CHART state"),e({type:"CHART_CONFIG_ADD_NEW_DATASET",value:{chartConfig:o.chartConfigs[0],locale:t}}))})},C=()=>{let{isOpen:e,close:t}=j(),{0:r,1:o}=(0,i.useState)(""),s=x(),l=(0,n.Z)(()=>{t()}),c=(0,n.Z)(()=>{o("")});return(0,u.jsxs)(h.gl,{open:e,onClose:l,onExited:c,children:[(0,u.jsx)(f,{onClick:()=>l()}),(0,u.jsx)(g.c7,{chartId:"new",allowDefaultRedirect:!1,children:(0,u.jsx)(a.c,{variant:"drawer",dataset:r,onClickBackLink:e=>{e.preventDefault(),o("")},onCreateChartFromDataset:async(e,r)=>{e.preventDefault(),await s(r),t()},datasetResultsProps:{datasetResultProps:()=>({showDimensions:!0,onClickTitle:(e,t)=>{e.preventDefault(),o(t)}})},datasetPreviewProps:{dataSetIri:r}})})]})}},62075:function(e,t,r){"use strict";r.d(t,{Dm:function(){return w},Dx:function(){return C},Jf:function(){return I},dk:function(){return O}});var n=r(17043),i=r(90089),o=r(96338),s=r(87026),a=r(64986),l=r(40624),c=r(27686),d=r(25390),u=r(5646),p=r(44945),m=r(45365),f=r(15658),h=r(49148),g=r(24246);let b=["text","smaller","onClick","className","sx"],y=["text","smaller","onClick","className","sx"];function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let x=(0,a.Z)(e=>({text:{wordBreak:"break-word",color:t=>{let{empty:r}=t;return r?e.palette.text.secondary:e.palette.text.primary},cursor:e=>{let{interactive:t}=e;return t?"pointer":"text"},"&:hover":{textDecoration:e=>{let{interactive:t}=e;return t?"underline":"none"}},"& > :last-child":{marginBottom:0}}})),C=e=>{let{text:t,smaller:r,onClick:n,className:a,sx:d}=e,u=(0,i.Z)(e,b),p=x({interactive:!!n,empty:!t});return(0,g.jsx)(s.Z,j(j({},u),{},{variant:r?"h2":"h1",component:"span",className:(0,l.Z)(p.text,a),onClick:n,sx:{mb:r?1:4,fontWeight:r?400:700},children:t?(0,g.jsx)(c.Ln,{children:t}):(0,g.jsx)(o.cC,{id:"annotator.add.title"})}))},O=e=>{let{text:t,smaller:r,onClick:n,className:a,sx:d}=e,u=(0,i.Z)(e,y),p=x({interactive:!!n,empty:!t});return(0,g.jsx)(s.Z,j(j({},u),{},{variant:"body2",component:"span",className:(0,l.Z)(p.text,a),onClick:n,children:t?(0,g.jsx)(c.Ln,{children:t}):(0,g.jsx)(o.cC,{id:"annotator.add.description"})}))},w=()=>{let e=(0,h.bU)(),[t]=(0,f.lY)(f.N3),{title:r,description:n}=(0,d.f6)(t).meta,i=!(r[e]&&n[e]);return(0,g.jsxs)(u.rE,{role:"tablist","aria-labelledby":"controls-title-description",collapse:!0,defaultExpanded:!1,children:[(0,g.jsx)(u.NZ,{id:"controls-title-description",warnMessage:i?(0,g.jsx)(o.cC,{id:"controls.section.title.warning"}):void 0,children:(0,g.jsx)(o.cC,{id:"controls.section.description"})}),(0,g.jsxs)(u.kc,{gap:"none",px:"none",children:[(0,g.jsx)(p.c4,{value:"title",icon:"text",emptyValueWarning:(0,g.jsx)(o.cC,{id:"controls.annotator.add-title-warning"}),mainLabel:(0,m.N)("title")}),(0,g.jsx)(p.c4,{value:"description",icon:"description",emptyValueWarning:(0,g.jsx)(o.cC,{id:"controls.annotator.add-description-warning"}),mainLabel:(0,m.N)("description")}),(0,g.jsx)(p.c4,{value:"label",icon:"layoutTab",emptyValueWarning:(0,g.jsx)(o.cC,{id:"controls.annotator.add-tab-label-warning"}),mainLabel:(0,m.N)("label")})]})]})},I=()=>{let e=(0,h.bU)(),[t]=(0,f.lY)(f.VF),{title:r,description:n}=t.layout.meta,i=!(r[e]&&n[e]);return(0,g.jsxs)(u.rE,{role:"tablist","aria-labelledby":"controls-title-description",collapse:!0,defaultExpanded:!0,hideTopBorder:!0,children:[(0,g.jsx)(u.NZ,{id:"controls-title-description",warnMessage:i?(0,g.jsx)(o.cC,{id:"controls.section.title.warning"}):void 0,children:(0,g.jsx)(o.cC,{id:"controls.section.description"})}),(0,g.jsxs)(u.kc,{gap:"none",px:"none",children:[(0,g.jsx)(p.Fd,{value:"title",icon:"text",emptyValueWarning:(0,g.jsx)(o.cC,{id:"controls.annotator.add-title-warning"}),mainLabel:(0,m.N)("title")}),(0,g.jsx)(p.Fd,{value:"description",icon:"description",emptyValueWarning:(0,g.jsx)(o.cC,{id:"controls.annotator.add-description-warning"}),mainLabel:(0,m.N)("description")})]})]})}},4974:function(e,t,r){"use strict";r.d(t,{J:function(){return a},c:function(){return s}});var n=r(59823);let i="annotation",o=e=>{let t=(0,n.M)();return`${i}:${e}:${t}`},s=e=>!!e?.startsWith(i),a=()=>({key:o("highlight"),type:"highlight",targets:[],text:{de:"",fr:"",it:"",en:""},highlightType:"none",color:void 0,defaultOpen:!0})},63093:function(e,t,r){"use strict";r.d(t,{V:function(){return _},r:function(){return Z}});var n=r(96338),i=r(40749),o=r(1787),s=r(12548),a=r(87026),l=r(26398),c=r(60116),d=r(64986),u=r(99729),p=r.n(u),m=r(27378),f=r(51514),h=r(53082),g=r(99990),b=r(25390),y=r(71238),v=r(36802),j=r(56436),x=r(10359),C=r(64103),O=r(48947),w=r(59266),I=r(41282),S=r(77142),P=r(59159),k=r(24246);let _=e=>{let{field:t,disabled:r,colorConfigPath:c,component:d}=e,[u,O]=(0,y.lY)(y.N3),_=(0,b.f6)(u),D=(0,w.a)(),{data:M,invalidate:A}=(0,P.H)(),L=(0,f.uA)(d)&&d?(0,I.px)(d.values.map(e=>e.color).filter(Boolean)):null,F=(0,C.cW)(d)?I.o_:L?[L,...I.TN]:I.TN,N=(0,y.GK)(_)?p()(_,"fields.color.paletteId"):p()(_,`fields["${_.activeField}"].${c?`${c}.`:""}paletteId`),R=F.find(e=>e.value===N),G=(0,S.z)(e=>{V(e)}),V=(e,r)=>{if(!d)return;let n=F.find(t=>t.value===e),i=M?.find(t=>t.paletteId===e)||r;if(i){let e=(0,x.t6)({paletteId:i.paletteId,dimensionValues:d.values,customPalette:i});(0,y.GK)(_)?O({type:"COLOR_FIELD_SET",value:"single"===_.fields.color.type?{type:_.fields.color.type,paletteId:i.paletteId,color:i.colors[0]}:{type:_.fields.color.type,paletteId:i.paletteId,colorMapping:e}}):O({type:"CHART_PALETTE_CHANGED",value:{field:t,colorConfigPath:c,paletteId:i.paletteId,colorMapping:e}});return}n&&((0,y.GK)(_)?O({type:"COLOR_FIELD_SET",value:"single"===_.fields.color.type?{type:_.fields.color.type,paletteId:n.value,color:n.colors[0]}:{type:_.fields.color.type,paletteId:n.value,colorMapping:(0,x.t6)({paletteId:n.value,dimensionValues:d.values})}}):O({type:"CHART_PALETTE_CHANGED",value:{field:t,colorConfigPath:c,paletteId:n.value,colorMapping:(0,x.t6)({paletteId:n.value,dimensionValues:d.values})}}))},{0:$,1:U}=(0,m.useState)(),z=(0,S.z)(e=>{U(e.currentTarget)}),B=(0,S.z)(e=>{A(),U(void 0),V(e?.paletteId,e),$?.focus()}),H=e=>{let t=F.some(t=>t.value===e),r=M?.some(t=>t.paletteId===e);return t||r},W=(()=>{let e=R?R.value:N;return H(e)?e:""})();return(0,k.jsxs)(h.k,{sx:{pointerEvents:r?"none":"auto",flexDirection:"column",gap:1},children:[(0,k.jsxs)("div",{children:[(0,k.jsx)(g.__,{htmlFor:"color-palette-toggle",children:(0,k.jsx)(n.cC,{id:"controls.color.palette"})}),(0,k.jsxs)(i.Z,{size:"sm",MenuProps:g.y5,renderValue:e=>e&&H(e)?(0,k.jsx)(h.k,{gap:.5,flexWrap:"wrap",children:R?R.colors.map((e,t)=>(0,k.jsx)(Z,{color:e,disabled:r},t)):M?.find(e=>e.paletteId===N)?.colors.map((e,t)=>k.jsx(Z,{color:e,disabled:r},t))}):(0,k.jsx)(n.cC,{id:"controls.color.palette.select"}),value:W,displayEmpty:!0,children:[D&&(0,k.jsx)(o.Z,{onClick:z,children:(0,k.jsx)(s.Z,{variant:"text",size:"sm",color:"primary",sx:{"&:hover":{color:"primary.main"}},children:(0,k.jsx)(n.cC,{id:"login.profile.my-color-palettes.add"})})}),M&&M.length>0&&(0,k.jsxs)(h.k,{sx:{flexDirection:"column",gap:2,pt:3},children:[(0,k.jsx)(a.Z,{variant:"caption",sx:{px:4,color:"text.secondary",fontWeight:700},children:(0,k.jsx)(n.cC,{id:"controls.custom-color-palettes"})}),(0,k.jsx)(l.Z,{sx:{width:"100%",height:2}})]}),M&&M?.length>0&&M.filter(e=>"categorical"===e.type).map(e=>(0,k.jsx)(T,{value:e.paletteId,label:e.name,colors:e.colors,selected:e.paletteId===W,onClick:()=>G(e.paletteId)},e.paletteId)),(0,k.jsxs)(h.k,{sx:{flexDirection:"column",gap:2,pt:3},children:[(0,k.jsx)(a.Z,{variant:"caption",sx:{px:4,color:"text.secondary",fontWeight:700},children:(0,k.jsx)(n.cC,{id:"controls.visualize-color-palette"})}),(0,k.jsx)(l.Z,{sx:{width:"100%",height:2}})]}),F.map(e=>(0,k.jsx)(T,{value:e.value,label:e.label,colors:e.colors,selected:e.value===W,onClick:()=>G(e.value)},e.value))]})]}),d&&(0,k.jsx)(E,{field:t,component:d,state:u,colorConfigPath:c,customColorPalettes:M}),(0,k.jsx)(j.oe,{open:!!$,hideBackdrop:!0,children:(0,k.jsx)(v.f,{onClose:e=>B(e),type:"categorical",customColorPalettes:M})})]})},T=e=>{let{value:t,label:r,colors:n,selected:i,onClick:s}=e;return(0,k.jsx)(o.Z,{value:t,onClick:s,sx:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:1},children:(0,k.jsxs)(h.k,{sx:{flexDirection:"column",gap:1,width:"100%"},children:[(0,k.jsx)(a.Z,{component:"div",variant:"caption",color:"text.primary",children:r}),(0,k.jsxs)(h.k,{sx:{justifyContent:"space-between",alignItems:"center",gap:1,width:"100%"},children:[(0,k.jsx)(h.k,{sx:{gap:.5,flexWrap:"wrap"},children:n.map(e=>(0,k.jsx)(Z,{color:e},e))}),(0,k.jsx)("div",{style:{minWidth:24,minHeight:20},children:i?(0,k.jsx)(O.JO,{name:"checkmark",size:20}):null})]})]})})},D=(0,d.Z)({root:{display:"inline-block",margin:0,padding:0,width:20,height:20,"&:first-of-type":{borderTopLeftRadius:"default",borderBottomLeftRadius:"default"},"&:last-of-type":{borderTopRightRadius:"default",borderBottomRightRadius:"default"}}}),Z=e=>{let{disabled:t,color:r}=e,n=D();return(0,k.jsx)(c.Z,{className:n.root,"data-testid":"select-color-square",sx:{backgroundColor:t?"grey.300":r}})},E=e=>{let{field:t,colorConfigPath:r,component:i,state:o,customColorPalettes:a}=e,[,l]=(0,y.lY)(),c=(0,b.f6)(o),d=(0,y.GK)(c)?p()(c,"fields.color.paletteId"):p()(c,`fields["${t}"].${r?`${r}.`:""}paletteId`,I.h$),u=(0,m.useMemo)(()=>a?.find(e=>e.paletteId===d),[a,d]),f=(0,y.GK)(c)?p()(c,"fields.color.colorMapping"):p()(c,`fields["${t}"].${r?`${r}.`:""}colorMapping`),g=(0,S.z)(()=>{l({type:"CHART_PALETTE_RESET",value:{field:(0,y.GK)(c)?"color":t,colorConfigPath:r,colorMapping:(0,x.t6)({paletteId:d,dimensionValues:i.values,customPalette:u})}})}),v=(0,S.z)(()=>{l({type:"CHART_CONFIG_UPDATE_COLOR_MAPPING",value:{field:(0,y.GK)(c)?"color":t,colorConfigPath:r,dimensionId:i.id,values:i.values,random:!0,customPalette:u}})});if(!f)return null;{let e=(0,I.XN)({paletteId:d,fallbackPalette:u?.colors}),t=Object.values(f),r=t.length,i=e.slice(0,r).every((e,r)=>e===t[r])||"dimension"===d;return(0,k.jsxs)(h.k,{sx:{alignItems:"center",columnGap:2,flexWrap:"wrap",color:"primary.main"},children:[(0,k.jsx)(s.Z,{variant:"text",color:"primary",size:"xs",disabled:i,onClick:g,children:(0,k.jsx)(n.cC,{id:"controls.color.palette.reset"})}),"",(0,k.jsx)(s.Z,{variant:"text",color:"primary",size:"xs",onClick:v,children:(0,k.jsx)(n.cC,{id:"controls.filters.select.refresh-colors"})})]})}}},45214:function(e,t,r){"use strict";r.d(t,{E:function(){return k},a:function(){return _}});var n=r(17043),i=r(96338),o=r(60116),s=r(40749),a=r(87026),l=r(56637),c=r(12548),d=r(1787),u=r(99729),p=r.n(u),m=r(27378),f=r(99990),h=r(25390),g=r(71238),b=r(36802),y=r(56436),v=r(49148),j=r(59266),x=r(41282),C=r(54312),O=r(77142),w=r(59159),I=r(24246);function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let k=e=>{let{colorInterpolator:t,nSteps:r=512,width:n=220,height:i=28,disabled:o,rx:s=2}=e,a=(0,m.useRef)(null);return(0,m.useEffect)(()=>{let e=a.current,o=e&&e.getContext("2d");if(o){o.clearRect(0,0,n,i);let[e,s]=r>n?[1,n]:[n/r,r];for(let r=0;r<s;++r)o.fillStyle=t(r/(s-1)),o.fillRect(e*r,0,e,i)}},[t,r,n,i,o,s]),(0,I.jsx)("canvas",{ref:a,width:n,height:i,style:{borderRadius:`${s}px`,imageRendering:"pixelated",opacity:o?.5:1}})},_=e=>{let{field:t,path:r,disabled:n,nSteps:l}=e,c=(0,v.bU)(),[d,u]=(0,g.lY)(g.N3),j=(0,h.f6)(d),{data:S,invalidate:_}=(0,w.H)(),D=(0,m.useMemo)(()=>[...x.WA,...x.eh],[]),Z=p()(j,`fields["${t}"].${r}.paletteId`),E=D.find(e=>e.value===Z),M=S?.find(e=>e.paletteId===Z),A=(0,O.z)(e=>{let t=e.target.value,r=S?.find(e=>e.paletteId===t);L(t,r)}),L=(e,n)=>{e&&u({type:"CHART_FIELD_UPDATED",value:{locale:c,field:t,path:r,value:P(P({},p()(j,`fields["${t}"].${r}`)),{},{paletteId:e,paletteType:n?.type,colors:n?.colors??[]})}})},{0:F,1:N}=(0,m.useState)(),{0:R,1:G}=(0,m.useState)(),V=(0,O.z)(e=>{G(e.currentTarget)}),$=(0,O.z)(e=>{_(),G(void 0),e&&L(e.paletteId,e),R?.focus()}),U=(0,C.Jl)({currentPalette:E,customPalette:M,defaultPalette:D[0]},x.d5);return(0,I.jsxs)(o.Z,{pb:2,sx:{pointerEvents:n?"none":"auto"},children:[(0,I.jsx)(f.__,{htmlFor:"color-palette",children:(0,I.jsx)(i.cC,{id:"controls.color.palette"})}),(0,I.jsx)(s.Z,{size:"sm",value:Z,disabled:n,displayEmpty:!0,onChange:A,renderValue:e=>e?(0,I.jsx)(k,{colorInterpolator:U,nSteps:l,disabled:n}):(0,I.jsx)(a.Z,{color:"secondary.active",variant:"body2",children:(0,I.jsx)(i.cC,{id:"controls.color.palette.select"})}),sx:{mt:1,lineHeight:0},children:[...T({type:"sequential",onTypeSelect:N,nSteps:l,customColorPalettes:S,colorPalettes:x.WA,handleAddColorPalette:V,customInterpolator:x.xT}),...T({type:"diverging",onTypeSelect:N,nSteps:l,customColorPalettes:S,colorPalettes:x.eh,handleAddColorPalette:V,customInterpolator:x.kD})]}),F&&(0,I.jsx)(y.oe,{open:!!R,hideBackdrop:!0,children:(0,I.jsx)(b.f,{onClose:e=>$(e),type:F,customColorPalettes:S})})]})},T=e=>{let t=(0,j.a)(),{type:r,nSteps:n,customColorPalettes:o,colorPalettes:s,onTypeSelect:u,customInterpolator:p,handleAddColorPalette:m}=e;return["diverging"===r?(0,I.jsx)(l.Z,{children:(0,I.jsx)(i.cC,{id:"controls.color.palette.diverging"})}):(0,I.jsx)(l.Z,{children:(0,I.jsx)(i.cC,{id:"controls.color.palette.sequential"})}),t&&(0,I.jsx)(c.Z,{onClick:e=>{u(r),m(e)},variant:"text",sx:{width:"100%",paddingY:3,paddingX:4},children:(0,I.jsx)(i.cC,{id:"login.profile.my-color-palettes.add"})}),t&&(0,I.jsx)(l.Z,{children:(0,I.jsx)(a.Z,{variant:"subtitle2",fontWeight:700,fontSize:10,align:"left",children:(0,I.jsx)(i.cC,{id:"controls.custom-color-palettes"})})}),t&&o?.filter(e=>e.type===r).map(e=>I.jsxs(d.Z,{sx:{flexDirection:"column",alignItems:"flex-start"},value:e.paletteId,children:[I.jsx(a.Z,{variant:"caption",children:e.name}),I.jsx(k,{colorInterpolator:p({endColorHex:e.colors[0],startColorHex:e.colors[1],options:{midColorHex:e.colors[2]??void 0}}).interpolator,nSteps:n})]},`${r}-${e.paletteId}`)),t&&(0,I.jsx)(l.Z,{children:(0,I.jsx)(a.Z,{variant:"subtitle2",fontWeight:700,fontSize:10,align:"left",children:(0,I.jsx)(i.cC,{id:"controls.visualize-color-palette"})})}),s.map((e,t)=>{let{value:i,interpolator:o}=e;return(0,I.jsx)(d.Z,{sx:{flexDirection:"column",alignItems:"flex-start"},value:i,children:(0,I.jsx)(k,{colorInterpolator:o,nSteps:n})},`${r}-${t}`)})]}},12570:function(e,t,r){"use strict";r.d(t,{Ko:function(){return w},OA:function(){return y},W5:function(){return I},eB:function(){return O}});var n=r(96338),i=r(87026),o=r(60116),s=r(12548),a=r(64986),l=r(53082),c=r(60227),d=r(71238),u=r(45365),p=r(10359),m=r(48947),f=r(83332),h=r(6802),g=r(77142),b=r(24246);let y=e=>{let{chartConfig:t,fieldComponents:r,value:n,onClick:i,checked:o,labelId:s,disabled:a,warnMessage:c}=e,u=(0,g.z)(()=>i(n)),m=r?.[0],f=(0,d.uk)(t,n)||!!m,{upperLabel:h,mainLabel:y}=v(t,n,s,r?.map(e=>p.X0(e)));return(0,b.jsx)(P,{disabled:a,checked:o,value:n,onClick:u,children:(0,b.jsx)(k,{iconName:(0,p.tc)(n),upperLabel:h,mainLabel:y,isActive:f,checked:o,optional:!(0,d.uk)(t,n)&&!m,rightIcon:(0,b.jsxs)(l.k,{gap:2,children:[c&&(0,b.jsx)(x,{title:c})," ",(0,b.jsx)(C,{isActive:f})]})})})},v=(e,t,r,i)=>"y"===t&&(0,d.tJ)(e)?{upperLabel:(0,u.N)("y"),mainLabel:i?.join(", ")}:{upperLabel:r?(0,u.N)(r):null,mainLabel:i?.[0]??(0,b.jsx)(n.cC,{id:"controls.color.add"})},j=(0,a.Z)(e=>({edit:{color:t=>{let{isActive:r}=t;return r?e.palette.monochrome[800]:e.palette.monochrome[300]},width:18,height:18},warn:{color:e.palette.orange.main,width:18,height:18,pointerEvents:"auto"}})),x=e=>{let{title:t}=e,r=j({isActive:!1});return(0,b.jsx)(c.E,{title:t,children:(0,b.jsx)(i.Z,{children:(0,b.jsx)(h.Z,{className:r.warn})})})},C=e=>{let{isActive:t}=e,r=j({isActive:t});return(0,b.jsx)(f.Z,{className:r.edit})},O=e=>{let{value:t,label:r,icon:n,checked:i,active:o,onClick:s}=e;return(0,b.jsx)("div",{style:{width:"100%",margin:"2px 0",borderRadius:1.5},children:(0,b.jsx)(P,{checked:i,value:t,onClick:s,children:(0,b.jsx)(k,{iconName:(0,p.tc)(n),mainLabel:r,checked:i,isActive:o,showIsActive:!0})})})},w=e=>{let{value:t,checked:r,onClick:n,icon:i,upperLabel:o,mainLabel:s,lowerLabel:a,rightIcon:l,disabled:c}=e;return(0,b.jsx)("div",{style:{width:"100%",margin:"2px 0",borderRadius:1.5},children:(0,b.jsx)(P,{checked:r,value:t,disabled:c,onClick:()=>n(t),children:(0,b.jsx)(k,{iconName:i,mainLabel:s,upperLabel:o,lowerLabel:a,checked:r,disabled:c,rightIcon:l})})})},I=e=>{let{component:t,value:r,checked:n,onClick:i,isDragging:s,upperLabel:a,disabled:l,iconName:c}=e;return(0,b.jsx)(o.Z,{sx:{boxShadow:s?"tooltip":void 0,width:"100%",borderRadius:1.5,my:"2px"},children:(0,b.jsx)(P,{checked:n,value:r,onClick:()=>i(r),children:(0,b.jsx)(k,{iconName:c??(0,p.tc)(r),upperLabel:a,mainLabel:t.label,checked:n,optional:l})})})},S=(0,a.Z)(e=>({controlTabButton:{width:"100%",minWidth:160,padding:`${e.spacing(2)} ${e.spacing(4)}`,borderColor:e.palette.primary.main,borderRadius:1.5,fontWeight:"normal",fontSize:"0.875rem",transition:"background-color 0.2s ease",backgroundColor:"white",cursor:"pointer",boxShadow:"none","&:hover":{backgroundColor:e.palette.cobalt[50],boxShadow:"none"},"&.Mui-disabled":{cursor:"initial",backgroundColor:"transparent"}},controlTabButtonInnerIcon:{justifyContent:"center",alignItems:"center",width:32,minWidth:32,height:32,borderRadius:2,transition:"color 0.2s ease"}})),P=e=>{let{disabled:t,checked:r,value:n,onClick:i,children:o}=e,a=S();return(0,b.jsx)(s.Z,{id:`tab-${n}`,className:a.controlTabButton,role:"tab",disabled:t,"aria-selected":r,onClick:()=>i(n),sx:{backgroundColor:r?e=>`${e.palette.cobalt[50]} !important`:"transparent"},children:o})},k=e=>{let{iconName:t,upperLabel:r,mainLabel:s,lowerLabel:a,checked:c,disabled:d,rightIcon:u,optional:p=!1,isActive:f=!1,showIsActive:h=!1}=e,g=S();return(0,b.jsxs)(l.k,{sx:{justifyContent:"space-between",alignItems:"center",flexGrow:1},children:[(0,b.jsxs)(l.k,{sx:{justifyContent:"flex-start",alignItems:"center"},children:[(0,b.jsx)(l.k,{className:g.controlTabButtonInnerIcon,sx:{backgroundColor:c?"monochrome.800":"white","& svg":{color:c?"white":p||d?"monochrome.300":"monochrome.800"}},children:(0,b.jsx)(m.JO,{size:24,name:t})}),(0,b.jsxs)(l.k,{sx:{flexDirection:"column",alignItems:"flex-start",mx:1,flexGrow:1},children:[r&&(0,b.jsx)(i.Z,{variant:"caption",sx:{color:p&&!c||d?"monochrome.300":"monochrome.500"},children:r}),(0,b.jsx)(i.Z,{variant:"h6",component:"p",textAlign:"left",fontWeight:700,sx:{display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:"2",color:p&&!c||d?"monochrome.300":"monochrome.800"},children:s}),a&&(0,b.jsx)(i.Z,{variant:"caption",sx:{color:"grey.600"},children:a})]})]}),h&&!1===f?(0,b.jsx)(o.Z,{sx:{mr:3},children:(0,b.jsx)(n.cC,{id:"controls.option.isNotActive"})}):h&&f?(0,b.jsx)(o.Z,{sx:{mr:3,color:"primary"},children:(0,b.jsx)(n.cC,{id:"controls.option.isActive"})}):null,u]})}},36802:function(e,t,r){"use strict";r.d(t,{f:function(){return P}});var n=r(17043),i=r(96338),o=r(19914),s=r(9448),a=r(60116),l=r(87026),c=r(97901),d=r(12548),u=r(64986),p=r(27378),m=r(53082),f=r(99990),h=r(69763),g=r(6222),b=r(41282),y=r(90453),v=r(37079),j=r(54312),x=r(35904),C=r(56436),O=r(24246);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let S=(0,u.Z)({autocompleteMenuContent:{"--mx":"1rem","--colorBoxSize":"1.25rem","--columnGap":"0.75rem",width:C.pG},autocompleteHeader:{margin:"1rem var(--mx)"},autocompleteApplyButtonContainer:{padding:"1rem var(--mx)",background:"rgba(255,255,255,0.75)"},textInput:{margin:`${y.r.spacing(4)} 0px`,padding:"30px",width:"100%",height:40,minHeight:40},autocompleteApplyButton:{justifyContent:"center"}}),P=(0,p.forwardRef)((e,t)=>{let{onClose:r,type:n,customColorPalettes:u}=e,y=S(),{0:C,1:w}=(0,p.useState)(()=>(0,b.c8)(n,[])),{0:P,1:k}=(0,p.useState)(""),{0:_,1:T}=(0,p.useState)(!1),D=(0,x.Tu)(v.pk),Z=(0,s.zX)((e,t)=>{w(r=>r.map(r=>r.id===t?I(I({},r),{},{color:e}):r))}),E=(0,s.zX)(e=>{w(t=>t.filter(t=>t.id!==e))}),M=(0,s.zX)(()=>{w(e=>[...e,{color:"#000000",id:(0,j.EY)()}])}),A=(0,s.zX)(async()=>{u?.find(e=>e.name===P)?T(!0):(T(!1),r(await D.mutate({name:P,colors:C.map(e=>e.color),type:n})))}),L={sequential:o.ag._({id:"controls.custom-color-palettes.caption-sequential"}),diverging:o.ag._({id:"controls.custom-color-palettes.caption-diverging"}),categorical:o.ag._({id:"controls.custom-color-palettes.caption-categorical"})};return(0,O.jsxs)("div",{className:y.autocompleteMenuContent,ref:t,"data-testid":"colors-filters-drawer",children:[(0,O.jsxs)(a.Z,{className:y.autocompleteHeader,children:[(0,O.jsxs)(m.k,{alignItems:"center",justifyContent:"space-between",children:[(0,O.jsx)(l.Z,{variant:"h4",sx:{py:4},children:(0,O.jsx)(i.cC,{id:"controls.custom-color-palettes"})}),(0,O.jsx)(c.Z,{sx:{mt:"-0.5rem"},size:"small",onClick:()=>r(),children:(0,O.jsx)(h.Z,{fontSize:"inherit"})})]}),(0,O.jsx)(l.Z,{variant:"body2",color:"textSecondary",children:L[n]})]}),(0,O.jsxs)(m.k,{sx:{mt:4,gap:4,paddingX:"1rem"},flexDirection:"column",children:[(0,O.jsxs)(m.k,{flexDirection:"column",children:[(0,O.jsx)(f.II,{error:_,label:o.ag._({id:"controls.custom-color-palettes.title"}),name:"custom-color-palette-title",value:P,onChange:e=>k(e.target.value)}),_&&(0,O.jsx)(l.Z,{color:"error.main",variant:"caption",children:(0,O.jsx)(i.cC,{id:"controls.custom-color-palettes.title-unavailable"})})]}),(0,O.jsx)(g.v,{title:P,type:n,colorValues:C,onRemove:E,onUpdate:Z,onAdd:M})]}),(0,O.jsx)(a.Z,{className:y.autocompleteApplyButtonContainer,children:(0,O.jsx)(d.Z,{disabled:0===C.length||""===P,className:y.autocompleteApplyButton,onClick:A,children:(0,O.jsx)(i.cC,{id:"controls.custom-color-palettes.set-values-apply"})})})]})})},5646:function(e,t,r){"use strict";r.d(t,{Gm:function(){return w},NZ:function(){return T},_Q:function(){return D},iH:function(){return _},kc:function(){return k},rE:function(){return S}});var n=r(17043),i=r(90089),o=r(60116),s=r(58290),a=r(54417),l=r(87026),c=r(67896),d=r(64986),u=r(40624),p=r(27378),m=r(60227),f=r(79234),h=r(15658),g=r(48947),b=r(27102),y=r(24246);let v=["role","children","sx","collapse","defaultExpanded","hideTopBorder"],j=["component","role","children","px","gap","sx"];function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let O=(0,d.Z)(e=>({controlSection:{borderTopColor:e.palette.divider,borderTopWidth:e=>{let{hideTopBorder:t}=e;return t?0:"1px"},borderTopStyle:"solid",overflowX:"hidden",overflowY:"auto",flexShrink:0}})),w=(0,d.Z)(e=>({text:{flexGrow:1,display:"flex",alignItems:"center",color:e.palette.text.primary,fontWeight:700,"& > svg:first-of-type":{marginRight:e.spacing(1)}},textDisabled:{color:e.palette.monochrome[300]},root:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%",padding:e.spacing(4),border:"none",backgroundColor:t=>{let{warn:r}=t;return r?e.palette.orange[50]:"transparent"},color:t=>{let{disabled:r,warn:n}=t;return r?e.palette.monochrome[300]:n?e.palette.orange.main:e.palette.monochrome[800]},WebkitUserSelect:"none",transition:"background-color 0.2s ease","&:hover":{cursor:e=>{let{interactive:t}=e;return t?"pointer":"initial"},backgroundColor:t=>{let{interactive:r}=t;return r?e.palette.cobalt[50]:"transparent"}}},icon:{lineHeight:0,justifySelf:"flex-end"}})),I=(0,p.createContext)({open:()=>{},isOpen:!1,close:()=>{},setOpen:e=>{},collapse:!0}),S=(0,p.forwardRef)(function(e,t){let{role:r,children:n,sx:s,collapse:a=!1,defaultExpanded:l=!0,hideTopBorder:c=!1}=e,d=(0,i.Z)(e,v),m=O({hideTopBorder:c}),h=(0,f.q)(l),g=(0,p.useMemo)(()=>C(C({},h),{},{collapse:a}),[a,h]);return(0,y.jsx)(I.Provider,{value:g,children:(0,y.jsx)(o.Z,C(C({ref:t,role:r,"data-testid":"controlSection",sx:s},d),{},{className:(0,u.Z)(m.controlSection,d.className),children:n}))})}),P=(0,d.Z)(e=>({controlSectionContent:{display:"flex",flexDirection:"column",gap:t=>{let{gap:r}=t;switch(r){case"xl":return e.spacing(4);case"lg":return e.spacing(3);case"md":return e.spacing(2);case"none":case void 0:return 0;default:return r}},minWidth:0,padding:t=>{let{px:r}=t,n=(()=>{switch(r){case"none":case void 0:return"0px";case"md":return e.spacing(4);default:return r}})();return`${e.spacing(2)} ${n} ${e.spacing(4)}`}}})),k=e=>{let{component:t="div",role:r,children:n,px:a="md",gap:l="md",sx:c}=e,d=(0,i.Z)(e,j),u=P({gap:l,px:a}),p=_();return(0,y.jsx)(s.Z,{in:p.isOpen,children:(0,y.jsx)(o.Z,C(C({component:t,role:r},d),{},{className:u.controlSectionContent,sx:c,children:n}))})},_=()=>(0,p.useContext)(I),T=e=>{let{children:t,closable:r,onClose:n,id:i,disabled:s,iconName:c,warnMessage:d,sx:p}=e,m=!!(r||n),[f,v]=(0,b.lY)(),j=(0,a.Z)(()=>{if(O)return x(e=>!e);if(m){if(n){n();return}return(0,h.N3)(f)?v({type:"CHART_ACTIVE_FIELD_CHANGE",value:void 0}):(0,h.VF)(f)?v({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:void 0}):void 0}}),{setOpen:x,isOpen:C,collapse:O}=_(),I=w({disabled:s,sectionOpen:C,interactive:!!O||!!m,warn:!!d});return(0,y.jsxs)(o.Z,{"aria-label":m?"Back to main":void 0,component:m||O?"button":"div",className:I.root,onClick:j,children:[(0,y.jsxs)(l.Z,{variant:"h6",id:i,className:(0,u.Z)(I.text,s&&I.textDisabled),sx:p,children:[m?(0,y.jsx)(g.JO,{name:"chevronLeft"}):c?(0,y.jsx)(g.JO,{name:c}):null,t]}),d&&(0,y.jsx)(Z,{title:d}),(0,y.jsx)("span",{className:I.icon,children:O?(0,y.jsx)(g.JO,{name:C?"minus":"plus"}):null})]})},D=e=>{let{sx:t,showTitle:r=!0}=e;return(0,y.jsx)(S,{sx:C({mt:2},t),children:(0,y.jsxs)(k,{gap:"none",children:[r?(0,y.jsx)(l.Z,{variant:"h1",children:(0,y.jsx)(c.Z,{sx:{bgcolor:"cobalt.50"}})}):null,(0,y.jsx)(c.Z,{variant:"rectangular",sx:{width:"100%",height:120,mt:r?0:2,bgcolor:"cobalt.50"}})]})})},Z=e=>{let{title:t}=e;return(0,y.jsx)(m.E,{title:t,children:(0,y.jsx)(l.Z,{sx:{mr:2,lineHeight:"0 !important"},children:(0,y.jsx)(g.JO,{name:"warningCircle"})})})}},71023:function(e,t,r){"use strict";r.d(t,{M:function(){return S}});var n=r(17043),i=r(90089),o=r(96338),s=r(19914),a=r(60116),l=r(87026),c=r(26398),d=r(27378),u=r(55847),p=r(53082),m=r(17899),f=r(67018),h=r(60227),g=r(25390),b=r(5646),y=r(92967),v=r(90706),j=r(80207),x=r(49148),C=r(24246);let O=["state","type","showHelp","showComparisonCharts","chartKey"];function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let S=e=>{let{state:t,type:r="edit",showHelp:n,showComparisonCharts:f=!0,chartKey:h}=e,y=(0,i.Z)(e,O),w=(0,x.bU)(),S=(0,g.f6)(t),[{data:k}]=(0,j.k$)({chartConfig:S,variables:{sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,locale:w,cubeFilters:S.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy,loadValues:!0}))}}),_=k?.dataCubesComponents?.dimensions??[],T=k?.dataCubesComponents?.measures??[],{value:D,addOrEditChartType:Z}=(0,v.q3)(h,r,_,T),E=(0,d.useCallback)(e=>{let t=e.currentTarget.value;("edit"!==r||t!==D)&&Z(t)},[D,Z,r]);if(!k?.dataCubesComponents)return(0,C.jsx)(b._Q,{});let{enabledChartTypes:M,possibleChartTypesDict:A}=(0,u.ru)({dimensions:_,measures:T,cubeCount:S.cubes.length});return(0,C.jsxs)(a.Z,I(I({},y),{},{children:[(0,C.jsx)("legend",{style:{display:"none"},children:(0,C.jsx)(o.cC,{id:"controls.select.chart.type"})}),!1===n?null:(0,C.jsx)(a.Z,{sx:{m:4,textAlign:"center"},children:(0,C.jsx)(l.Z,{variant:"body2",children:"add"===r?(0,C.jsx)(o.cC,{id:"controls.add.chart"}):(0,C.jsx)(o.cC,{id:"controls.switch.chart.type"})})}),(0,C.jsx)("div",{children:0===M.length?(0,C.jsx)(m.BI,{smaller:!0,children:(0,C.jsx)(o.cC,{id:"hint.no.visualization.with.dataset"})}):(0,C.jsxs)(p.k,{sx:{flexDirection:"column",gap:4},children:[(0,C.jsx)(P,{type:r,title:s.ag._({id:"controls.chart.category.regular"}),currentChartType:D,chartTypes:u.W_,possibleChartTypesDict:A,onClick:E,testId:"chart-type-selector-regular"}),f?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(c.Z,{sx:{borderColor:"cobalt.100"}}),(0,C.jsx)(P,{type:r,title:s.ag._({id:"controls.chart.category.combo"}),titleHint:s.ag._({id:"controls.chart.category.combo.hint"}),currentChartType:D,chartTypes:u.Q7,possibleChartTypesDict:A,onClick:E,testId:"chart-type-selector-combo"})]}):null]})})]}))},P=e=>{let{type:t,title:r,titleHint:n,currentChartType:i,chartTypes:o,possibleChartTypesDict:s,onClick:c,testId:d}=e;return(0,C.jsxs)(p.k,{sx:{flexDirection:"column",gap:2},children:[(0,C.jsxs)(l.Z,{variant:"caption",sx:{display:"inline-flex",alignItems:"center",gap:1,mx:"auto"},children:[r,n&&(0,C.jsx)(f.o,{title:n,size:16})]}),(0,C.jsx)(a.Z,{"data-testid":d,sx:{display:"grid",gridTemplateColumns:["1fr 1fr","1fr 1fr","1fr 1fr 1fr"],justifyItems:"center",gap:4},children:o.map(e=>{let{enabled:r,message:n}=s[e];return(0,C.jsx)(h.E,{title:!r&&n?n:void 0,tooltipProps:{placement:"right"},children:(0,C.jsx)("div",{children:(0,C.jsx)(y.h,{label:e,value:e,checked:"edit"===t&&i===e,disabled:!r,onClick:c})})},e)})})]})}},56436:function(e,t,r){"use strict";r.d(t,{gl:function(){return d},oe:function(){return c},pG:function(){return l}});var n=r(79235),i=r(1869),o=r(7752),s=r(4623),a=r(24246);let l=340,c=(0,i.ZP)(n.ZP)(e=>{let{theme:t}=e;return{"&":{position:"static"},"& > .MuiPaper-root":{overflowX:"hidden",top:`calc(${o.r} + ${s.yB})`,bottom:0,width:l,height:"auto",borderTop:`1px solid ${t.palette.divider}`,boxShadow:"none"}}}),d=e=>{let{children:t,open:r,onClose:i,onExited:o}=e;return(0,a.jsx)(n.ZP,{anchor:"right",open:r,variant:"temporary",onClose:i,SlideProps:{onExited:o},PaperProps:{sx:{width:1400,maxWidth:"100%",p:8}},children:t})}},52109:function(e,t,r){"use strict";r.d(t,{H:function(){return O},b:function(){return C}});var n=r(17043),i=r(90089),o=r(19914),s=r(13814),a=r(28200),l=r(60116),c=r(98700),d=r(97901),u=r(5836),p=r(27378),m=r(53082),f=r(99990),h=r(77167),g=r(94460),b=r(48947),y=r(24246);let v=["name","label","value","onChange","disabled","isDateDisabled","sideControls","timeUnit","dateFormat","parseDate","showClearButton"];function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let C=e=>{let{name:t,label:r,value:n,onChange:j,disabled:C,isDateDisabled:O,sideControls:P,timeUnit:k=g.j1.Day,dateFormat:_=(0,u.i$)("%Y-%m-%d"),parseDate:T,showClearButton:D}=e,Z=(0,i.Z)(e,v),E=(0,p.useCallback)(e=>{!e||O(e)||j({target:{value:_(e)}})},[O,j,_]),M=(0,p.useCallback)(()=>{j({target:{value:h.P}})},[j]),A=w(k,O);return(0,y.jsxs)(m.k,{sx:{flexDirection:"column",gap:1},children:[r&&t&&(0,y.jsx)(f.__,{htmlFor:t,children:r}),(0,y.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,y.jsx)(s.Z,x(x(x({},Z),A),{},{components:{OpenPickerIcon:e=>(0,y.jsx)(b.JO,x({name:"calendar"},e))},PaperProps:{elevation:4},inputFormat:I(k),views:S(k),value:n,onAccept:E,onChange:(e,t)=>{t&&E(e)},renderDay:(e,t,r)=>(0,y.jsx)(a.ZP,x(x({},r),{},{selected:n?.getTime()===e.getTime()})),renderInput:e=>(0,y.jsx)(c.Z,x(x({hiddenLabel:!0,size:"small"},e),{},{inputProps:x(x({},e.inputProps),{},{value:n?_(n):o.ag._({id:"controls.dimensionvalue.select"})}),onChange:e=>{E(T(e.target.value))},sx:x(x({},e.sx),{},{width:"100%","& input":{height:40,typography:"h6"},"& .MuiIconButton-root":{p:1},"& .MuiOutlinedInput-input":{py:0,pl:4},"& svg":{color:"text.primary"}}),InputProps:x(x({},e.InputProps),{},{endAdornment:(0,y.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center"},children:[D&&n&&(0,y.jsx)(d.Z,{size:"small",onClick:M,sx:{p:1,mr:-.5},children:(0,y.jsx)(b.JO,{name:"close"})}),e.InputProps?.endAdornment]})})})),disabled:C})),P]})]})},O=e=>[g.j1.Day,g.j1.Week,g.j1.Month,g.j1.Year].includes(e),w=(e,t)=>{switch(e){case g.j1.Day:case g.j1.Week:case g.j1.Month:return{shouldDisableDate:t};case g.j1.Year:return{shouldDisableYear:t};default:return e}},I=e=>{switch(e){case g.j1.Day:case g.j1.Week:return"dd.MM.yyyy";case g.j1.Month:return"MM.yyyy";case g.j1.Year:return"yyyy";default:return e}},S=e=>{switch(e){case g.j1.Day:case g.j1.Week:return["year","month","day"];case g.j1.Month:return["year","month"];case g.j1.Year:return["year"];default:return e}}},44945:function(e,t,r){"use strict";r.d(t,{Ew:function(){return ec},F8:function(){return eu},Fd:function(){return en},G3:function(){return ee},HN:function(){return Q},Lm:function(){return eo},O_:function(){return J},Qy:function(){return em},TF:function(){return ep},Wj:function(){return ea},Z_:function(){return ej},c4:function(){return er},je:function(){return eb},kN:function(){return eg},lb:function(){return X},oe:function(){return ex},p4:function(){return ei},qf:function(){return el},tW:function(){return et},xh:function(){return ev},y_:function(){return ey},zH:function(){return ed}});var n=r(90089),i=r(17043),o=r(96338),s=r(19914),a=r(60116),l=r(87026),c=r(65637),d=r(64986),u=r(99729),p=r.n(u),m=r(43605),f=r.n(m),h=r(14648),g=r.n(h),b=r(65218),y=r.n(b),v=r(27378),j=r(80750),x=r(53082),C=r(99990),O=r(53624),w=r(79234),I=r(50953),S=r(25390),P=r(12570),k=r(52109),_=r(45365),T=r(90706),D=r(15658),Z=r(77167),E=r(64103),M=r(95428),A=r(41494),L=r(49148),F=r(41282),N=r(92178),R=r(4352),G=r(7673),V=r(77142),$=r(59159),U=r(24246);let z=["value","emptyValueWarning"],B=["value","emptyValueWarning"],H=["label","size","field","path","defaultValue","disabled"];function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let K=y()(()=>r.e(14172).then(r.bind(r,14172)).then(e=>e.ColorPickerMenu),{ssr:!1,loadableGenerated:{webpack:()=>[14172]}}),q=(0,d.Z)(e=>({root:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",width:"100%",gap:e.spacing(1),textAlign:"left",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden"},loadingIndicator:{display:"inline-block",marginTop:e.spacing(1),marginLeft:e.spacing(2)}})),X=e=>{let{chartConfig:t,fieldComponents:r,value:n,labelId:i,disabled:o,warnMessage:s}=e,a=(0,T.jX)({value:n});return(0,U.jsx)(P.OA,{chartConfig:t,fieldComponents:r,value:`${a.value}`,labelId:i,checked:a.checked,onClick:a.onClick,disabled:o,warnMessage:s})},J=e=>{let{value:t,label:r,icon:n,active:i}=e,{checked:o,onClick:s}=(0,T.jX)({value:t});return(0,U.jsx)(P.eB,{value:t,label:r,icon:n,checked:o,active:i,onClick:s})},Q=e=>{let{dimension:t,label:r,id:n,disabled:i,optional:o,sideControls:a,hierarchy:l,onOpen:c,loading:d}=e,u=(0,T.V$)(ee(t)),p=s.ag._({id:"controls.dimensionvalue.select"}),m=(0,v.useMemo)(()=>{let e=(0,G.tf)(t);return f()(t.values,e.map(e=>t=>e(t.label)))},[t]),h=(0,v.useMemo)(()=>o?[{value:Z.P,label:p,isNoneValue:!0},...m]:m,[o,m,p]),g=(0,v.useMemo)(()=>{if(l)return(0,R.n)(l,t.values.map(e=>e.value))},[l,t.values]),{open:b,close:y,isOpen:j}=(0,w.q)(),I=(0,V.z)(()=>{b(),c?.()}),S=(0,V.z)(()=>{y()});if(l&&g)return(0,U.jsx)(O._,{label:(0,U.jsx)(em,{label:r}),id:n,options:g,onClose:S,onOpen:I,open:j,disabled:i,sideControls:a,value:u.value,onChange:e=>{u.onChange({target:{value:e.target.value}})}});let P=(0,E.a6)(t),k=(0,M.U)(u.value),_=m[m.length-1]?.value;return(0,U.jsx)(C.Ph,Y(Y({id:n,size:"sm",label:P?(0,U.jsxs)("div",{style:{width:"100%"},children:[(0,U.jsx)(x.k,{justifyContent:"flex-end",sx:{mb:.5,mr:7},children:(0,U.jsx)(C.rs,{label:s.ag._({id:"controls.filter.use-most-recent"}),size:"sm",checked:k,onChange:()=>u.onChange({target:{value:k?`${_}`:M.g}})})}),(0,U.jsx)(x.k,{justifyContent:"space-between",alignItems:"center",gap:1,width:"100%",children:r})]}):(0,U.jsx)(em,{label:r}),disabled:i||k,options:h,sort:!1,sideControls:a,open:j,onClose:S,onOpen:I,loading:d},u),{},{value:k?_:u.value}))},ee=e=>(0,E.P9)(e)?e.originalIds.map(e=>g()(e,["cubeIri","dimensionId"])):[{dimensionId:e.id,cubeIri:e.cubeIri}],et=e=>{let{label:t,dimension:r,timeUnit:n,disabled:i,isOptional:l,sideControls:c}=e,{values:d,timeFormat:u}=r,p=(0,A.ls)(),m=p.format(u),f=p.parse(u),h=(0,T.V$)(ee(r)),g=(0,M.U)(h.value),b=l?(0,U.jsxs)("span",{children:[t," ",(0,U.jsxs)("span",{style:{marginLeft:"0.25rem"},children:["(",(0,U.jsx)(o.cC,{id:"controls.select.optional"}),")"]})]}):t,{minDate:y,maxDate:j,optionValues:x}=(0,v.useMemo)(()=>{if(d.length){let e=d.map(e=>({label:`${e.value}`,value:`${e.value}`}));return{minDate:f(`${d[0].value}`),maxDate:f(`${d[d.length-1].value}`),optionValues:e.map(e=>e.value)}}{let e=new Date;return{minDate:e,maxDate:e,optionValues:[]}}},[d,f]),O=(0,v.useCallback)(e=>!x.includes(m(e)),[x,m]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(k.b,{name:`date-picker-${r.id}`,label:(0,U.jsx)(em,{label:b}),value:g?j:f(h.value),onChange:h.onChange,isDateDisabled:O,timeUnit:n,dateFormat:m,minDate:y,maxDate:j,disabled:i||g,sideControls:c,parseDate:f}),(0,U.jsx)(a.Z,{sx:{mt:3},children:(0,U.jsx)(C.rs,{label:s.ag._({id:"controls.filter.use-most-recent"}),size:"sm",checked:g,onChange:()=>h.onChange({target:{value:g?m(j):M.g}})})})]})},er=e=>{let{value:t,emptyValueWarning:r}=e,i=(0,n.Z)(e,z),o=(0,T.jX)({value:t}),[s]=(0,D.lY)(D.N3),a=(0,S.f6)(s),c=(0,L.bU)();return(0,U.jsx)(P.Ko,Y(Y({},i),{},{lowerLabel:a.meta[t]?.[c]?null:(0,U.jsx)(l.Z,{variant:"caption",color:"orange.main",children:r}),value:`${o.value}`,checked:o.checked,onClick:o.onClick}))},en=e=>{let{value:t,emptyValueWarning:r}=e,i=(0,n.Z)(e,B),o=(0,T.kP)({value:t}),[s]=(0,D.lY)(D.VF),a=(0,L.bU)();return(0,U.jsx)(P.Ko,Y(Y({},i),{},{lowerLabel:s.layout.meta[t][a]?null:(0,U.jsx)(l.Z,{variant:"caption",color:"orange.main",children:r}),value:`${o.value}`,checked:o.checked,onClick:o.onClick}))},ei=e=>{let{type:t,inputType:r,label:n,metaKey:i,locale:o,value:s,disableToolbar:a}=e,l=(0,T.kI)({type:t,metaKey:i,locale:o,value:s});switch(r){case"text":return(0,U.jsx)(C.II,Y({label:n},l));case"markdown":return(0,U.jsx)(C.o2,Y(Y({label:n},l),{},{disableToolbar:a}));default:return r}},eo=e=>{let{locale:t}=e,[r,n]=(0,D.lY)(D.VF),{layout:i}=r,{blocks:o}=i,s=(0,v.useMemo)(()=>{let e=o.find(e=>e.key===i.activeField);return(0,N.h)(e?.type==="text","We can only edit text blocks from TextBlockInputField"),e},[o,i.activeField]),a=(0,v.useCallback)(e=>{let r=e.currentTarget.value;n({type:"LAYOUT_CHANGED",value:Y(Y({},i),{},{blocks:o.map(e=>e.key===s.key?Y(Y({},e),{},{text:Y(Y({},s.text),{},{[t]:r})}):e)})})},[n,i,o,s.key,s.text,t]),l=(0,_.N)(t);return(0,U.jsx)(C.o2,{name:l,label:l,value:s.text[t],onChange:a})},es=(e,t)=>{let[r,n]=(0,D.lY)(D.N3),i=(0,S.f6)(r),o=(0,S.In)(i),{dimensionId:s,colorConfigPath:a}=(0,T.qy)(),{activeField:l}=i,c=(0,I.GK)(i),d=c?"color":l,u=(0,v.useCallback)(t=>{d&&n({type:"CHART_COLOR_CHANGED",value:{field:d,colorConfigPath:c?"":"color",color:t,value:e}})},[n,d,e,c]),m=a?`color.${a}`:"",f=p()(i,`fields["${d}"].${m}${c?"colorMapping":""}["${e}"]`),h=(0,v.useMemo)(()=>{let e=p()(i,`fields["${d}"].paletteId`);return(0,F.XN)({paletteId:e,fallbackPalette:t?.find(t=>t.paletteId===e)?.colors})},[i,d,t]),g=s?(0,T.C7)(o,s,e):null;return(0,v.useMemo)(()=>({color:f,palette:h,onChange:u,checked:g}),[f,h,u,g])},ea=e=>{let{value:t,label:r,symbol:n,enableShowValue:i}=e,{data:o}=(0,$.H)(),{color:s,checked:a,palette:l,onChange:c}=es(t,o);return s&&a?(0,U.jsxs)(x.k,{sx:{justifyContent:"space-between",alignItems:"center",gap:2,width:"100%"},children:[(0,U.jsx)(j.YL,{symbol:n,label:r,color:s}),(0,U.jsxs)(x.k,{sx:{alignItems:"center",gap:1},children:[i?(0,U.jsx)(el,{value:t}):null,(0,U.jsx)(K,{colors:l,selectedHexColor:s,onChange:c})]})]}):null},el=e=>{let{value:t}=e;return(0,U.jsx)(ev,{label:s.ag._({id:"controls.filter.show-values"}),size:"sm",field:"segment",path:`showValuesMapping["${t}"]`})},ec=e=>{let{filters:t,label:r,value:n,disabled:i}=e,o=(0,T.y5)({filters:t,value:n});return(0,U.jsx)(C.Y8,Y({label:r,disabled:i},o))},ed=e=>{let{label:t,color:r,symbol:n,colors:i,onChange:o,disabled:s}=e;return(0,U.jsxs)(x.k,{justifyContent:"space-between",alignItems:"center",gap:2,width:"100%",children:[(0,U.jsx)(j.YL,{label:t,color:r,symbol:n}),(0,U.jsx)(K,{colors:i,selectedHexColor:r,onChange:o,disabled:s})]})},eu=e=>{let{symbol:t="square",field:r,path:n,label:i,disabled:o}=e,s=(0,L.bU)(),[a,l]=(0,D.lY)(D.N3),c=(0,S.f6)(a),d=(0,v.useCallback)(e=>l({type:"CHART_FIELD_UPDATED",value:{locale:s,field:r,path:n,value:e}}),[s,l,r,n]),{data:u}=(0,$.H)(),m=p()(c,`fields["${r}"].paletteId`),f=p()(c,`fields["${r}"].${n}`),h=(0,F.XN)({paletteId:m,fallbackPalette:u?.find(e=>e.paletteId===m)?.colors});return(0,U.jsx)(ed,{label:i,color:f,symbol:t,colors:h,onChange:d,disabled:o})},ep=()=>{let e=q();return(0,U.jsx)(c.Z,{size:16,className:e.loadingIndicator})},em=e=>{let{label:t,isFetching:r}=e,n=q();return(0,U.jsxs)(l.Z,{className:n.root,variant:"caption",children:[t,r?(0,U.jsx)(ep,{}):null]})},ef=(e,t)=>t?[{value:Z.P,label:s.ag._({id:"controls.none"}),isNoneValue:!0},...e]:e,eh=(e,t)=>t?[[void 0,[{value:Z.P,label:s.ag._({id:"controls.none"}),isNoneValue:!0}]],...e]:e,eg=e=>{let{label:t="",field:r,options:n,optionGroups:i,optional:o,disabled:s,components:a}=e,l=(0,T.Hl)({field:r,components:a}),c=(0,v.useMemo)(()=>ef(n,!!o),[n,o]),d=(0,v.useMemo)(()=>i?eh(i,!!o):void 0,[i,o]);return(0,U.jsx)(C.Ph,Y({id:r,label:(0,U.jsx)(em,{label:t}),size:"sm",disabled:s,options:c,optionGroups:d},l),`select-${r}-dimension`)},eb=e=>{let{label:t,field:r,path:n,value:i,defaultChecked:o,disabled:s=!1,warnMessage:a}=e,l=(0,T.d5)({path:n,field:r,value:i});return(0,U.jsx)(C.Y8,Y(Y({disabled:s,label:t},l),{},{checked:l.checked??o,warnMessage:a}))},ey=e=>{let{label:t,field:r,path:n,disabled:i=!1,min:o=0,max:s=1,step:a=.1,defaultValue:l}=e,c=(0,T.RB)({path:n,field:r,min:o,max:s,defaultValue:l});return(0,U.jsx)(C.iR,Y({disabled:i,label:t,min:o,max:s,step:a},c))},ev=e=>{let{label:t,size:r,field:n,path:i,defaultValue:o=!1,disabled:s=!1}=e,a=(0,T.WX)({field:n,path:i,defaultValue:o});return(0,U.jsx)(C.XZ,Y(Y({disabled:s,label:t,size:r},a),{},{checked:a.checked??o}))},ej=e=>{let{id:t,label:r,field:n,path:i,disabled:o=!1,options:s,optionGroups:a,getValue:l,getKey:c,optional:d}=e,u=(0,T.nW)({field:n,path:i,getValue:l,getKey:c}),p=(0,v.useMemo)(()=>ef(s,!!d),[d,s]),m=(0,v.useMemo)(()=>a?eh(a,!!d):void 0,[d,a]);return(0,U.jsx)(C.Ph,Y({id:t,disabled:o,size:"sm",label:(0,U.jsx)(em,{isFetching:!1,label:r}),options:p,optionGroups:m},u))},ex=e=>{let{label:t,size:r,field:i,path:o,defaultValue:s=!1,disabled:a=!1}=e,l=(0,n.Z)(e,H),c=(0,T.WX)({field:i,path:o,defaultValue:s});return(0,U.jsx)(C.rs,Y(Y(Y({disabled:a,label:t,size:r},c),l),{},{checked:c.checked??s}))}},47073:function(e,t,r){"use strict";r.d(t,{tX:function(){return ez},he:function(){return eY},IL:function(){return eB},NM:function(){return ew}});var n=r(17043),i=r(96338),o=r(19914),s=r(60116),a=r(12548),l=r(87026),c=r(50714),d=r(97901),u=r(26398),p=r(38706),m=r(85492),f=r(381),h=r(64189),g=r(3834),b=r(61998),y=r(1869),v=r(64986),j=r(60090),x=r(23175),C=r(50228),O=r(49951),w=r(99729),I=r.n(w),S=r(38354),P=r.n(S),k=r(83864),_=r.n(k),T=r(31091),D=r.n(T),Z=r(27378),E=r(55847),M=r(50988),A=r(47612),L=r(53082),F=r(99990),N=r(17899),R=r(60227),G=r(33342),V=r(50953),$=r(25390),U=r(71238),z=r(56436),B=r(44945),H=r(52109),W=r(15658),Y=r(27102),K=r(77142);let q=()=>{let[e,t]=(0,Y.lY)(W.N3),r=(0,$.f6)(e),n=(0,K.z)(e=>{(0,V.I3)(r)&&t({type:"CHART_SHOW_LEGEND_TITLE_CHANGED",value:e.currentTarget.checked})}),i=I()(r,"fields.segment.showTitle");return{name:"showTitle",checked:!!i&&i,onChange:n}};var X=r(77167),J=r(93161),Q=r(9787),ee=r(59245),et=r(28810),er=r(41494),en=r(90717),ei=r(82395),eo=r(24246);let es=e=>{let{timeExtent:t,timeRange:r,timeInterval:n,timeUnit:i,onChange:o,disabled:a=!1,hideEndHandle:c=!1}=e,[d,u]=(0,ei.y)(),p=(0,Z.useRef)(null),{palette:m}=(0,en.F)(),f=(0,er.z6)(),h=u-20,g=(0,Q.Z)().domain(t).range([0,h]),b=(0,Z.useCallback)(e=>n.round(e),[n]),y=(0,J.Yu)().extent([[0,0],[h,1]]).on("end",function(e){let t=e.selection;if(t){let[e,r]=t.map(e=>b(g.invert(e)));o([e,r])}else{let t=(0,ee.Z)(p.current),[r]=(0,et.Z)(e,this),n=r<0?0:r>h?h:r;t.call(y.move,[n,n])}});(0,Z.useEffect)(()=>{let e=(0,ee.Z)(p.current),t=a?m.grey[300]:m.primary.main,r=a?"none":"auto";e.select(".overlay").attr("pointer-events",r).attr("fill",m.grey[300]).attr("fill-opacity",.9),e.select(".selection").attr("pointer-events",r).attr("fill",t).attr("fill-opacity",1).attr("stroke","none"),e.selectAll(".handle").attr("pointer-events",r).attr("fill",t).style("y","-7px").style("width","16px").style("height","16px").attr("rx","16px"),c&&e.select(".handle--e").remove(),e.call(y)},[y,a,c,m.grey,m.primary.main]);let[v,j]=r.map(g);return(0,Z.useEffect)(()=>{(0,ee.Z)(p.current).call(y.move,[v,j])},[v,j]),(0,eo.jsxs)(s.Z,{sx:{mt:4},children:[(0,eo.jsx)("div",{ref:d,id:"editor-brush",children:u>0&&(0,eo.jsx)("svg",{width:u,height:17,children:(0,eo.jsx)("g",{ref:p,transform:"translate(4, 8)"})})}),(0,eo.jsxs)(L.k,{justifyContent:"space-between",mt:1,sx:{px:"2px"},children:[(0,eo.jsx)(l.Z,{component:"div",variant:"caption",children:f(t[0],i)}),(0,eo.jsx)(l.Z,{component:"div",variant:"caption",children:f(t[1],i)})]})]})};var ea=r(23733),el=r(95428),ec=r(48947),ed=r(39097),eu=r(69763),ep=r(14228),em=r(30999),ef=r(49148),eh=r(57060),eg=r(38248),eb=r(7673),ey=r(11051);function ev(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ej(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ev(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ev(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ex=(0,v.Z)(e=>({wrapper:{"--colorBoxSize":"12px","--columnGap":"0.75rem",width:z.pG},header:{margin:e.spacing(4)},autocompleteApplyButtonContainer:{position:"sticky",zIndex:1e3,left:0,right:0,bottom:e.spacing(3),marginTop:e.spacing(6),padding:`0 ${e.spacing(4)}`},autocompleteApplyButton:{justifyContent:"center"},textInput:{margin:`${e.spacing(4)} 0px`,padding:"0px 12px",width:"100%",height:40,minHeight:40},optionColor:{width:"var(--colorBoxSize)",height:"var(--colorBoxSize)",flexShrink:0,outline:`1px solid ${e.palette.divider}`,transition:"background-color 0.125s ease-out",alignSelf:"flex-start",marginTop:e.spacing(1.5),marginRight:"0.5rem"},optionLabel:{flexGrow:1,marginTop:-2,[e.breakpoints.up("xl")]:{marginTop:-3.5}},optionCheck:{width:16,height:16,flexShrink:0,alignSelf:"flex-start",marginTop:"0.125rem"},selectedValueRow:{display:"flex",alignItems:"center",gap:e.spacing(2),"&:not(:last-of-type)":{paddingBottom:e.spacing(4)}}})),eC=e=>e?e.split(" > "):[],eO=e=>(0,eh.iV)(e?.parents),ew=(e,t)=>(0,j.Z)(e.position??0,t.position??0)||`${e.identifier}`.localeCompare(`${t.identifier}`,void 0,{numeric:!0})||e.label.localeCompare(t.label),eI=e=>e.sort(ew),eS=e=>(0,V.GK)(e)?I()(e.fields,["color"]):I()(e.fields,[e.activeField??"symbolLayer","color"]),eP=e=>{let{selectAll:t,selectNone:r,allKeysLength:n,activeKeysLength:o}=e,l=(0,A.C4)({useMarginTop:!1});return(0,eo.jsxs)(s.Z,{className:l.actions,children:[(0,eo.jsx)(a.Z,{variant:"text",size:"sm",disabled:o===n,onClick:t,children:(0,eo.jsx)(i.cC,{id:"controls.filter.select.all"})}),(0,eo.jsx)(a.Z,{variant:"text",size:"sm",disabled:0===o,onClick:r,children:(0,eo.jsx)(i.cC,{id:"controls.filter.select.none"})})]})},ek=e=>{let{colorConfig:t,colorComponent:r,filterDimensionId:n}=e;return!!(t?.type!=="single"&&t?.colorMapping&&void 0!==r&&n===r.id)},e_=e=>{let{field:t,colorComponent:r,tree:n}=e,m=(0,ef.bU)(),[f,h]=(0,U.lY)(U.N3),g=(0,$.f6)(f),b="segment"===g.activeField,{cubeIri:y,dimensionId:v,activeKeys:O,allValues:w,colorConfigPath:I}=(0,U.qy)(),S=(0,$.In)(g)[v],k=ex(),{sortedTree:T,flatOptions:D,optionsByValue:M}=(0,Z.useMemo)(()=>{let e=(0,eh.q4)(n),t=(0,eh.Mc)(e),r=_()(t,e=>e.value);return{sortedTree:e,flatOptions:t,optionsByValue:r}},[n]),{values:A,valueGroups:N}=(0,Z.useMemo)(()=>{let e=(S?.type==="multi"&&Object.keys(S.values)||Object.keys(M)).map(e=>M[e]).filter(eG),t=(0,x.Xx)(e,eO).sort((e,t)=>0===e[0].length?1:(0,j.Z)(eC(e[0]).length,eC(t[0]).length)||(0,j.Z)(e[0],t[0])).map(e=>{let[t,r]=e;return[t,eI(r)]});return{values:e,valueGroups:t,valuesByParent:P()(e,eO)}},[M,S]),{0:R,1:V}=(0,Z.useState)(),H=(0,K.z)(e=>{V(e.currentTarget)}),W=(0,Z.useRef)([]),Y=(0,K.z)(()=>{V(void 0),h({type:"CHART_CONFIG_FILTER_SET_MULTI",value:{cubeIri:y,dimensionId:v,values:W.current.map(e=>e?.value).filter(Boolean)}}),R?.focus()}),J=(0,K.z)(()=>{h({type:"CHART_CONFIG_UPDATE_COLOR_MAPPING",value:{field:t,colorConfigPath:I,dimensionId:v,values:r?.values??[],random:!1}})}),Q=(0,Z.useMemo)(()=>eS(g),[g]),ee=(0,Z.useMemo)(()=>ek({colorConfig:Q,colorComponent:r,filterDimensionId:v}),[Q,v,r]);eD({colorComponentValues:r?.values,colorMapping:Q?.type!=="single"?Q?.colorMapping:void 0});let et=(0,U.I3)(g)?g.fields.segment:void 0,er=et&&b&&(0,U.nV)(g),en=Object.values(et?.showValuesMapping??{}),ei=(0,ea._y)(v,"multi"),es=(0,ea.CY)(),el=b?es:ei,ec=q(),eu=(0,E.L$)(g.chartType),em=(0,ea.Po)(v),eb=(0,Z.useMemo)(()=>[{value:X.P,label:o.ag._({id:"controls.none"}),isNoneValue:!0},...A.map(e=>{let{value:t,label:r}=e;return{value:t,label:r}})],[A]);return(0,eo.jsxs)(s.Z,{sx:{position:"relative"},children:[(0,eo.jsxs)(s.Z,{mb:4,children:[(0,eo.jsxs)(L.k,{sx:{flexDirection:"column",gap:3,mb:3},children:[(0,eo.jsx)(eT,ej({},el)),b?(0,eo.jsx)(F.rs,ej({label:o.ag._({id:"controls.filters.show-legend.toggle"})},ec)):el.checked?(0,eo.jsx)(G.N,ej({id:`default-value-${v}`,size:"sm",label:o.ag._({id:"controls.filters.default-value.label"}),placeholder:o.ag._({id:"controls.dimensionvalue.select"}),options:eb},em)):null]}),(0,eo.jsx)(a.Z,{variant:"outlined",size:"sm",onClick:H,sx:{width:"fit-content"},children:(0,eo.jsx)(i.cC,{id:"controls.set-filters"})}),(0,eo.jsxs)(L.k,{sx:{justifyContent:"space-between",mt:4},children:[(0,eo.jsxs)(l.Z,{variant:"h6",component:"p",sx:{fontWeight:700},children:[(0,eo.jsx)(i.cC,{id:"controls.filters.select.selected-filters"}),ee&&Q?.paletteId==="dimension"&&(0,eo.jsx)(c.Z,{title:(0,eo.jsx)(i.cC,{id:"controls.filters.select.reset-colors"}),children:(0,eo.jsx)(d.Z,{size:"small",onClick:J,sx:{ml:1,my:-2},children:(0,eo.jsx)(ep.Z,{fontSize:"inherit"})})})]}),(0,eo.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:(0,eo.jsx)(i.cC,{id:"controls.filter.nb-elements",values:{0:O.size,1:w.length}})})]}),(0,eo.jsx)(u.Z,{sx:{mt:4}})]}),er?(0,eo.jsxs)(L.k,{gap:2,alignItems:"center",sx:{color:"primary.main"},children:[(0,eo.jsx)(a.Z,{variant:"text",color:"primary",size:"xs",disabled:(0,C.Z)(en,e=>+e)===A.length,onClick:()=>{h({type:"CHART_FIELD_UPDATED",value:{locale:m,path:"fields.segment.showValuesMapping",field:null,value:Object.fromEntries(A.map(e=>[e.value,!0]))}})},children:(0,eo.jsx)(i.cC,{id:"controls.filter.show-values.all"})}),"",(0,eo.jsx)(a.Z,{variant:"text",color:"primary",size:"xs",disabled:en.every(e=>!e),onClick:()=>{h({type:"CHART_FIELD_UPDATED",value:{locale:m,path:"fields.segment.showValuesMapping",field:null,value:{}}})},children:(0,eo.jsx)(i.cC,{id:"controls.filter.show-values.none"})})]}):null,N.map(e=>{let[t,r]=e;return(0,eo.jsxs)(s.Z,{sx:{mb:4},children:[(0,eo.jsx)(l.Z,{variant:"h6",sx:{mb:4,fontWeight:700},children:(0,eg.b)(eC(t),e=>(0,eo.jsx)(eE,{},e))}),r.map(e=>{let{value:t,label:r}=e;return(0,eo.jsx)(L.k,{className:k.selectedValueRow,"data-testid":"chart-filters-value",children:ee?(0,eo.jsx)(B.Wj,{value:t,label:r,symbol:eu,enableShowValue:er}):(0,eo.jsxs)(eo.Fragment,{children:[(0,eo.jsx)(l.Z,{variant:"body3",style:{flexGrow:1},children:r}),er?(0,eo.jsx)(B.qf,{value:t}):null,(0,eo.jsx)(ed.Z,{})]})},t)})]},t)}),(0,eo.jsx)(z.oe,{open:!!R,hideBackdrop:!0,children:(0,eo.jsx)(p.d,{onClickAway:Y,children:(0,eo.jsx)(e$,{pendingValuesRef:W,options:T,flatOptions:D,onClose:Y,values:A,hasColorMapping:ee})})})]})},eT=e=>{let{name:t,checked:r,onChange:n}=e;return(0,eo.jsx)(F.rs,{name:t,label:(0,eo.jsx)(R.E,{tooltipProps:{enterDelay:600},title:(0,eo.jsx)(i.cC,{id:"controls.filters.interactive.tooltip"}),children:(0,eo.jsx)("div",{children:(0,eo.jsx)(i.cC,{id:"controls.filters.interactive.toggle"})})}),checked:r,onChange:n})},eD=e=>{let{colorComponentValues:t,colorMapping:r}=e,[n,i]=(0,U.lY)(U.N3),o=(0,$.f6)(n),{dimensionId:s,colorConfigPath:a}=(0,U.qy)(),{activeField:l}=o,c=(0,Z.useMemo)(()=>!!r&&!!t&&t.some(e=>!r[e.value]),[t,r]),d=(0,V.GK)(o)?"color":l;(0,Z.useEffect)(()=>{c&&r&&t&&d&&i({type:"CHART_CONFIG_UPDATE_COLOR_MAPPING",value:{dimensionId:s,colorConfigPath:a,colorMapping:r,field:d,values:t,random:!1}})},[d,o,c,i,s,a,r,t])},eZ=(0,v.Z)({root:{display:"inline",top:5,position:"relative"}}),eE=()=>{let e=eZ();return(0,eo.jsx)(ec.JO,{className:e.root,name:"chevronRight",size:20})},eM=(0,y.ZP)(m.Z)({boxShadow:"none",minHeight:0,"&:before":{display:"none"},"&.Mui-expanded":{minHeight:0}}),eA=(0,y.ZP)(f.Z)(e=>{let{theme:t}=e;return{minHeight:0,transition:"background-color 0.1s ease",paddingLeft:t.spacing(1),paddingRight:t.spacing(4),"&.Mui-expanded":{minHeight:0},"& > .MuiAccordionSummary-content":{display:"flex",alignItems:"center",marginTop:0,marginBottom:0,padding:`${t.spacing(2)} 0`,color:t.palette.monochrome[600]},"&:hover":{backgroundColor:t.palette.cobalt[50],"& > .MuiAccordionSummary-content":{color:t.palette.monochrome[800]}}}}),eL=(0,y.ZP)(h.Z)(()=>({padding:0})),eF=e=>{let{flat:t,depth:r,value:n,label:i,state:o,selectable:s,expandable:a,renderExpandButton:c,renderColorCheckbox:u,onSelect:p,children:m}=e,f=ex(),{getValueColor:h}=(0,U.qy)(),{0:g,1:b}=(0,Z.useState)(()=>0===r);return(0,eo.jsxs)(eM,{expanded:g,disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[(0,eo.jsxs)(eA,{expandIcon:null,onClick:e=>{e.stopPropagation(),s&&p()},sx:{pl:t?4:`${(r+1)*8}px`},children:[c&&(0,eo.jsx)(d.Z,{onClick:e=>{e.stopPropagation(),b(!g)},sx:{alignSelf:"flex-start",visibility:a?"visible":"hidden",ml:2,mr:1,p:1,"&:hover":{backgroundColor:"cobalt.100"}},children:(0,eo.jsx)(ec.JO,{name:"chevronRight",size:16,style:{transition:"transform 0.2s ease",transform:g?"rotate(90deg)":"rotate(0deg)"}})}),u&&(0,eo.jsx)("div",{className:f.optionColor,style:{visibility:s?"visible":"hidden",backgroundColor:"SELECTED"===o?h(n):"transparent"}}),(0,eo.jsx)(l.Z,{variant:"body3",className:f.optionLabel,children:i}),(0,eo.jsx)(ec.JO,{name:"SELECTED"===o?"checkmark":"CHILDREN_SELECTED"===o?"indeterminate":"show",className:f.optionCheck,style:{visibility:"NOT_SELECTED"===o?"hidden":"visible"}})]}),m&&(0,eo.jsx)(eL,{children:m})]})},eN=e=>Array.isArray(e)&&e.length>0,eR=e=>{let{children:t,selectedValues:r}=e;if(!eN(t))return!1;{let e=t.map(e=>e.value);return!!r.some(t=>e.includes(t.value))||t.map(e=>eR({children:e.children,selectedValues:r})).some(e=>!0===e)}},eG=e=>void 0===e.hasValue||!!e.hasValue,eV=e=>{let{flat:t,depthsMetadata:r,options:n,selectedValues:i,showColors:o,onSelect:s}=e;return(0,eo.jsx)(eo.Fragment,{children:n.map(e=>{let{depth:n,value:a,label:l,children:c}=e,d=r[n],u=eN(c),p=i.map(e=>e.value).includes(a)?"SELECTED":eR({children:c,selectedValues:i})?"CHILDREN_SELECTED":"NOT_SELECTED";return(0,eo.jsx)(eF,{flat:t,depth:n,value:a,label:l,state:p,selectable:eG(e),expandable:u,renderExpandButton:d.expandable||n>0,renderColorCheckbox:o&&(d.selectable||-1===e.depth),onSelect:()=>{"SELECTED"===p?s(i.filter(e=>e.value!==a)):s([...i,e])},children:u?(0,eo.jsx)(eV,{flat:t,depthsMetadata:r,options:c,selectedValues:i,showColors:o,onSelect:s}):null},a)})})},e$=(0,Z.forwardRef)((e,t)=>{let{onClose:r,options:n,flatOptions:c,values:u,pendingValuesRef:p,hasColorMapping:m}=e,f=ex(),{0:h,1:y}=(0,Z.useState)(""),{0:v,1:j}=(0,Z.useState)(()=>u.filter(eG));p.current=v;let{depthsMetadata:x,uniqueSelectableFlatOptions:C}=(0,Z.useMemo)(()=>{let e=D()(c.filter(eG),e=>e.value),t=c.reduce((e,t)=>(e[t.depth]||(e[t.depth]={selectable:!1,expandable:!1}),!1===e[t.depth].selectable&&t.hasValue&&(e[t.depth].selectable=!0),!1===e[t.depth].expandable&&t.children&&t.children.length>0&&(e[t.depth].expandable=!0),e),{}),r=(0,O.Z)(c,e=>e.depth);return r&&r>0&&(t[r].expandable=!0),{depthsMetadata:t,uniqueSelectableFlatOptions:e}},[c]),w=(0,Z.useMemo)(()=>(0,eh.dp)(n,e=>e.label.toLowerCase().includes(h.toLowerCase())),[h,n]);return(0,eo.jsxs)("div",{ref:t,className:f.wrapper,"data-testid":"edition-filters-drawer",children:[(0,eo.jsxs)(s.Z,{className:f.header,children:[(0,eo.jsxs)(L.k,{alignItems:"center",justifyContent:"space-between",children:[(0,eo.jsxs)(L.k,{alignItems:"center",gap:1,mb:3,children:[(0,eo.jsx)(ec.JO,{name:"filter"}),(0,eo.jsx)(l.Z,{variant:"h6",component:"p",sx:{fontWeight:700},children:(0,eo.jsx)(i.cC,{id:"controls.set-filters"})})]}),(0,eo.jsx)(d.Z,{sx:{mt:"-0.5rem"},size:"small",onClick:r,children:(0,eo.jsx)(eu.Z,{fontSize:"inherit"})})]}),(0,eo.jsx)(l.Z,{variant:"body3",color:"text.secondary",children:(0,eo.jsx)(i.cC,{id:"controls.set-filters-caption"})}),(0,eo.jsx)(g.Z,{className:f.textInput,size:"sm",value:h,onChange:e=>y(e.target.value),placeholder:o.ag._({id:"select.controls.filters.search"}),startAdornment:(0,eo.jsx)(b.Z,{position:"start",children:(0,eo.jsx)(ec.JO,{name:"search",size:16})})}),(0,eo.jsx)(eP,{selectAll:()=>j(C),selectNone:()=>j([]),allKeysLength:C.length,activeKeysLength:v.length})]}),(0,eo.jsx)(eV,{flat:1===Object.keys(x).length,depthsMetadata:x,options:w,selectedValues:v,showColors:m,onSelect:e=>{j(e)}}),(0,eo.jsx)("div",{className:f.autocompleteApplyButtonContainer,children:(0,eo.jsx)(a.Z,{size:"sm",className:f.autocompleteApplyButton,fullWidth:!0,onClick:r,children:(0,eo.jsx)(i.cC,{id:"controls.set-values-apply"})})})]})}),eU=e=>{let{field:t,colorConfigPath:r,propertyPath:n}=e;return`fields["${t}"].${void 0!==r?`${r}.`:""}${n}`},ez=e=>{let{dimension:t,colorConfigPath:r,colorComponent:n,field:i}=e,[o]=(0,U.lY)(U.N3),s=(0,$.f6)(o),a=(0,K.z)(e=>{let t=eU({field:(0,V.GK)(s)?"color":i,colorConfigPath:(0,V.GK)(s)&&"single"===s.fields.color.type?void 0:"colorMapping",propertyPath:`["${e}"]`});return I()(s,t)});return(0,eo.jsx)(U.K,{dimension:t,colorConfigPath:r,getValueColor:a,children:(0,eo.jsx)(e_,{field:i,colorComponent:n,tree:t.hierarchy&&t.hierarchy.length>0?t.hierarchy:t.values})})},eB=e=>{let{dimension:t,disableInteractiveFilters:r=!1}=e,n=(0,er.ls)(),a=(0,er.z6)(),[l,d]=(0,U.lY)(),u=(0,Z.useCallback)(e=>{let[r,n]=e;d({type:"CHART_CONFIG_FILTER_SET_RANGE",value:{dimension:t,from:r,to:n}})},[d,t]),p=(0,U.B8)(l,t),m=p?.type==="range"?p:null,f=!!m&&(0,el.U)(m.to),h=(0,K.z)(e=>{m&&u([e.target.value,m.to])}),g=(0,K.z)(e=>{if(m){let t=e.target.value;u([m.from,t])}}),{sortedOptions:b,sortedValues:y}=(0,Z.useMemo)(()=>(0,ey.M)({dimension:t,formatLocale:n,timeFormatUnit:a}),[t,n,a]),v=(0,Z.useCallback)((e,t)=>(0,M.W)(b,e=>e.date)(e,t),[b]);if(!(0,U.N3)(l))return(0,eo.jsx)(N.gb,{});{let{timeUnit:e,timeFormat:a}=t,l=(0,em.C)(e),d=n.parse(a),p=n.format(a),j=b[0].date,x=b[b.length-1].date;if(!j||!x)return null;let C=m?[d(m.from),f?x:d(m.to)]:[j,x],O=b.filter(e=>{let{date:t}=e;return t<=C[1]}),w=b.filter(e=>{let{date:t}=e;return t>=C[0]}),I=o.ag._({id:"controls.filters.select.from"}),S=o.ag._({id:"controls.filters.select.to"});return(0,eo.jsxs)("div",{children:[!r&&(0,eo.jsx)(s.Z,{sx:{mb:3},children:(0,eo.jsx)(eW,{})}),(0,eo.jsx)(L.k,{sx:{gap:1},children:m?(0,H.H)(e)?(0,eo.jsx)(eH,{left:(0,eo.jsx)(H.b,{name:"time-range-start",label:I,value:C[0],onChange:h,isDateDisabled:e=>e>C[1]||!y.includes(p(e)),timeUnit:e,dateFormat:p,minDate:j,maxDate:x,parseDate:d}),right:(0,eo.jsx)(H.b,{name:"time-range-end",label:S,value:C[1],disabled:f,onChange:g,isDateDisabled:e=>e<C[0]||!y.includes(p(e)),timeUnit:e,dateFormat:p,minDate:j,maxDate:x,parseDate:d})}):(0,eo.jsx)(eH,{left:(0,eo.jsx)(F.Ph,{id:"time-range-start",size:"sm",label:I,options:O,sort:!1,value:m.from,onChange:h}),right:(0,eo.jsx)(F.Ph,{id:"time-range-end",size:"sm",label:S,options:w,sort:!1,value:m.to,onChange:g})}):null}),(0,eo.jsx)(es,{timeExtent:[j,x],timeRange:C,timeInterval:l,timeUnit:e,hideEndHandle:f,onChange:e=>{let[t,r]=e,[n,i]=v(t,r);u([p(n),f?el.g:p(i)])}}),m&&(0,eo.jsxs)(L.k,{sx:{alignItems:"center",gap:1,mt:3},children:[(0,eo.jsx)(F.rs,{label:o.ag._({id:"controls.filter.use-most-recent"}),size:"sm",checked:f,onChange:()=>{u([m.from,f?p(x):el.g])}}),(0,eo.jsx)(c.Z,{arrow:!0,PopperProps:{sx:{maxWidth:160}},title:(0,eo.jsx)(i.cC,{id:"controls.filter.use-most-recent-explanation"}),children:(0,eo.jsx)(s.Z,{sx:{color:"primary.main",lineHeight:0},children:(0,eo.jsx)(ec.JO,{name:"infoCircle",size:16})})})]})]})}},eH=e=>{let{left:t,right:r}=e,n=z.pG/2-24-8;return(0,eo.jsxs)("div",{style:{display:"grid",gridTemplateColumns:`${n}px 8px ${n}px`,columnGap:12,alignItems:"center"},children:[t,(0,eo.jsx)(l.Z,{mt:"1em",children:""}),r]})},eW=()=>{let{checked:e,toggle:t}=(0,ea.b3)();return(0,eo.jsx)(F.rs,{label:o.ag._({id:"controls.filters.interactive.toggle"}),size:"sm",checked:e,onChange:t})},eY=e=>{let{dimension:t}=e,r=(0,ef.bU)(),n=(0,Z.useMemo)(()=>[...t.values].sort((0,eb.KS)(r)),[t?.values,r]);return t?(0,eo.jsx)(eo.Fragment,{children:n.map(e=>(0,eo.jsx)(B.Ew,{filters:(0,B.G3)(t),label:e.label,value:`${e.value}`},e.value))}):(0,eo.jsx)(N.gb,{})}},92967:function(e,t,r){"use strict";r.d(t,{h:function(){return p}});var n=r(91631),i=r(87026),o=r(64986),s=r(40624),a=r(45365),l=r(10359),c=r(48947),d=r(24246);let u=(0,o.Z)(e=>({root:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:91,height:64,borderRadius:2,transition:e.transitions.create(["background-color","color"],{duration:e.transitions.duration.shorter}),cursor:"pointer","&:hover":{backgroundColor:e.palette.monochrome[100]},"& svg":{color:e.palette.monochrome[800]}},checked:{backgroundColor:e.palette.monochrome[800],color:"white","&:hover":{backgroundColor:e.palette.monochrome[800]},"& svg":{color:"white"}},disabled:{cursor:"initial",color:e.palette.monochrome[500],"& svg":{color:e.palette.monochrome[500]}}})),p=e=>{let{label:t,value:r,checked:o,disabled:p,onClick:m,iconSize:f=24}=e,h=u();return(0,d.jsxs)(n.Z,{tabIndex:0,value:r,onClick:m,disabled:p,className:(0,s.Z)(h.root,p?h.disabled:null,o?h.checked:null),children:[(0,d.jsx)(c.JO,{name:(0,l.tc)(t),size:f}),(0,d.jsx)(i.Z,{variant:"caption",sx:{mt:2},children:(0,a.N)(t)})]})}},4623:function(e,t,r){"use strict";r.d(t,{Hq:function(){return y},LN:function(){return w},V6:function(){return I},pd:function(){return C},re:function(){return O},yB:function(){return x}});var n=r(17043),i=r(90089),o=r(60116),s=r(64986),a=r(40624),l=r(7752),c=r(56436),d=r(82395),u=r(24246);let p=["children","type"],m=["children","type"],f=["children","type"],h=["children","type"];function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let y=88,v=(0,s.Z)(e=>({panelLayout:{position:"fixed",top:l.r,width:"100%",height:`calc(100vh - ${l.r})`,display:"grid",gridTemplateRows:"auto minmax(0, 1fr)",marginLeft:"auto",marginRight:"auto"},MPanelLayout:{gridTemplateColumns:"minmax(22rem, 1fr)",gridTemplateAreas:`
    "header"
    "middle"`,backgroundColor:e.palette.monochrome[100]},LMPanelLayout:{gridTemplateColumns:`${c.pG}px minmax(22rem, 1fr)`,gridTemplateAreas:`
    "header header"
    "left middle"`,backgroundColor:e.palette.monochrome[100],[e.breakpoints.down("md")]:{gridTemplateColumns:"minmax(22rem, 1fr)",gridTemplateAreas:`
      "header"
      "left"
      "middle"`}},MRPanelLayout:{gridTemplateColumns:`minmax(22rem, 1fr) ${c.pG}px`,gridTemplateAreas:`
    "header header"
    "middle right"`,backgroundColor:e.palette.monochrome[100],[e.breakpoints.down("md")]:{gridTemplateColumns:"minmax(22rem, 1fr)",gridTemplateAreas:`
      "header"
      "middle"
      "right"`}},LMRPanelLayout:{gridTemplateColumns:`${c.pG}px minmax(22rem, 1fr) ${c.pG}px`,gridTemplateAreas:`
    "header header header"
    "left middle right"`,backgroundColor:e.palette.monochrome[100],[e.breakpoints.down("md")]:{gridTemplateColumns:"minmax(22rem, 1fr)",gridTemplateAreas:`
      "header"
      "left"
      "middle"
      "right"`}},panelHeaderLayout:{gridArea:"header",height:y,borderBottom:`1px solid ${e.palette.cobalt[100]}`,backgroundColor:e.palette.background.paper},LMRPanelHeaderLayout:{width:"100%",display:"grid",gridTemplateColumns:`${c.pG}px minmax(22rem, 1fr) minmax(${c.pG}px, auto)`,gridTemplateAreas:`
    "left middle right"
    `,alignItems:"center",marginLeft:"auto",marginRight:"auto",paddingLeft:e.spacing(12),paddingRight:e.spacing(12),backgroundColor:e.palette.background.paper},LPanelHeaderWrapper:{gridArea:"left",backgroundColor:e.palette.background.paper},MPanelHeaderWrapper:{gridArea:"middle",backgroundColor:e.palette.background.paper},RPanelHeaderWrapper:{gridArea:"right",display:"flex",alignItems:"center",backgroundColor:e.palette.background.paper},LPanelBodyWrapper:{overflowX:"hidden",overflowY:"auto",gridArea:"left",outline:`1px solid ${e.palette.cobalt[100]}`,backgroundColor:e.palette.background.paper,boxShadow:"none"},MPanelBodyWrapper:{gridArea:"middle"},RPanelBodyWrapper:{overflowX:"hidden",overflowY:"auto",boxShadow:e.shadows[5],borderLeftColor:e.palette.divider,borderLeftWidth:"1px",borderLeftStyle:"solid",gridArea:"right"}})),j="--panel-header",x=`var(${j})`,C=e=>{let{children:t,type:r}=e,n=(0,i.Z)(e,p),s=v(),[l]=(0,d.y)(e=>{let{height:t}=e;t&&document.documentElement.style.setProperty(j,`${t}px`)});return(0,u.jsx)(o.Z,b(b({},n),{},{ref:l,component:"section","data-testid":"panel-header",className:(0,a.Z)(s.panelHeaderLayout,s[`${r}PanelHeaderLayout`],n.className),children:t}))},O=e=>{let{children:t,type:r}=e,n=(0,i.Z)(e,m),s=v();return(0,u.jsx)(o.Z,b(b({},n),{},{component:"section","data-testid":`panel-header-${r}`,className:(0,a.Z)(s[`${r}PanelHeaderWrapper`],n.className),children:t}))},w=e=>{let{children:t,type:r}=e,n=(0,i.Z)(e,f),s=v();return(0,u.jsx)(o.Z,b(b({},n),{},{className:(0,a.Z)(s.panelLayout,s[`${r}PanelLayout`],n.className),children:t}))},I=e=>{let{children:t,type:r}=e,n=(0,i.Z)(e,h),s=v();return(0,u.jsx)(o.Z,b(b({},n),{},{component:"section","data-testid":`panel-body-${r}`,className:(0,a.Z)(s[`${r}PanelBodyWrapper`],n.className),children:t}))}},90706:function(e,t,r){"use strict";r.d(t,{C7:function(){return Z},Hl:function(){return j},K:function(){return A},RB:function(){return C},V$:function(){return T},WX:function(){return w},d5:function(){return O},jX:function(){return S},kI:function(){return L},kP:function(){return P},nW:function(){return x},q3:function(){return _},qy:function(){return M},uk:function(){return I},y5:function(){return D}});var n=r(99729),i=r.n(n),o=r(27378),s=r(55847),a=r(50953),l=r(25390),c=r(10359),d=r(15658),u=r(77167),p=r(64103),m=r(49148),f=r(41282),h=r(43107),g=r(4352),b=r(77142),y=r(24246);let v=(e,t)=>{let{limit:r,ignoreNode:n}=t,i=e?[]:void 0;return e&&i&&(0,h.B)(e,e=>{if(n?.(e))return h.B.IGNORE;(!e.children||0===e.children.length)&&e.hasValue&&(void 0===r||i.length<r)&&i?.push(e)}),i},j=e=>{let t,{field:r,components:n}=e,[o,h]=(0,d.lY)(),y=(0,m.bU)(),j=(0,l.f6)(o),x=(0,b.z)(async e=>{if(e.target.value!==u.P){let t=e.target.value,o=n.find(e=>e.id===t),s=((0,p.kb)(o)?[]:o.hierarchy)??[],l=!1;if(h({type:"CHART_FIELD_CHANGED",value:{locale:y,field:r,componentId:t,selectedValues:v(s,{ignoreNode:e=>!!(0,g.s)(e)&&(!!l||(l=!0,!1))})}}),!i()(j,`fields["${r}"].paletteId`))return;if((0,a.GK)(j)){let e=f.TN.find(e=>e.value===j.fields.color.paletteId)??f.TN[0];h({type:"COLOR_FIELD_SET",value:"single"===j.fields.color.type?{type:j.fields.color.type,paletteId:e.value,color:e.colors[0]}:{type:j.fields.color.type,paletteId:e.value,colorMapping:(0,c.t6)({paletteId:e.value,dimensionValues:o.values})}})}else{let e=f.TN[0];h({type:"CHART_PALETTE_CHANGED",value:{field:r,colorConfigPath:(0,a.Su)(j)?"columnStyle":void 0,paletteId:e.value,colorMapping:(0,c.t6)({paletteId:e.value,dimensionValues:o.values})}})}return}h({type:"CHART_FIELD_DELETED",value:{locale:y,field:r}})});if((0,d.N3)(o)){let e=(0,l.f6)(o);t=(0,s.iv)(e.fields,r)??u.P}return{name:r,value:t,onChange:x}},x=e=>{let t;let{field:r,path:n,getValue:s,getKey:a}=e,c=(0,m.bU)(),[p,f]=(0,d.lY)(),h=(0,o.useCallback)(e=>{let t=e.target.value;f({type:"CHART_FIELD_UPDATED",value:{locale:c,field:r,path:n,value:s?s(t):t}})},[f,c,r,n,s]);return(0,d.N3)(p)&&(t=i()((0,l.f6)(p),`fields["${r}"].${n}`,u.P)),{name:n,value:a?a(t):t,onChange:h}},C=e=>{let{field:t,path:r,min:n,max:i,defaultValue:o}=e,s=(0,m.bU)(),[a,l]=(0,d.lY)(),c=(0,b.z)(e=>{let o=e.target.value;(/^\d+$/.test(o)||""===o)&&l({type:"CHART_FIELD_UPDATED",value:{locale:s,field:t,path:r,value:Math.max(n,Math.min(+o,i))}})}),u=(0,d.N3)(a)?+(0,d.Bc)(a,t,r):o;return{name:r,value:u,onChange:c}},O=e=>{let{field:t,path:r,value:n}=e,i=(0,m.bU)(),[s,a]=(0,d.lY)(d.N3),l=(0,o.useCallback)(()=>{a({type:"CHART_FIELD_UPDATED",value:{locale:i,field:t,path:r,value:n}})},[a,i,t,r,n]),c=(0,d.Bc)(s,t,r),u=c?c===n:void 0;return{name:r,value:n,checked:u,onChange:l}},w=e=>{let{path:t,field:r,defaultValue:n=""}=e,i=(0,m.bU)(),[s,a]=(0,d.lY)(),l=(0,o.useCallback)(e=>{a({type:"CHART_FIELD_UPDATED",value:{locale:i,path:t,field:r,value:e.currentTarget.checked}})},[i,a,t,r]),c=(0,d.N3)(s)?(0,d.Bc)(s,r,t,n):n;return{name:t,checked:!!c&&c,onChange:l}},I=(e,t)=>(0,a.tJ)(e)&&"y"===t,S=e=>{let{value:t}=e,[r,n]=(0,d.lY)(d.N3),i=(0,l.f6)(r),s=(0,o.useCallback)(()=>{n({type:"CHART_ACTIVE_FIELD_CHANGE",value:t})},[n,t]),a=i.activeField===t;return{value:t,checked:a,onClick:s}},P=e=>{let{value:t}=e,[r,n]=(0,d.lY)(d.VF),i=(0,o.useCallback)(()=>{n({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:t})},[n,t]),s=r.layout.activeField===t;return{value:t,checked:s,onClick:i}},k=e=>{let{chartType:t,chartConfig:r,state:n,dimensions:i,measures:o}=e,a=(0,d.N3)(n)?(0,l.f6)(n,n.activeChartKey).cubes:r.cubes;return(0,s.jT)({chartType:t,iris:a.map(e=>({iri:e.iri,joinBy:e.joinBy})),dimensions:i,measures:o})},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"edit",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=(0,m.bU)(),[s,a]=(0,d.lY)(),c=(0,l.f6)(s,e);return{addOrEditChartType:(0,b.z)(i=>{"edit"===t?a({type:"CHART_TYPE_CHANGED",value:{locale:o,chartKey:e,chartType:i}}):a({type:"CHART_CONFIG_ADD",value:{chartConfig:k({chartType:i,chartConfig:c,state:s,dimensions:r,measures:n}),locale:o}})}),value:i()(c,"chartType")}},T=e=>{let[t,r]=(0,d.lY)(),n=(0,o.useCallback)(t=>{let n=t.target.value;n===u.P?r({type:"FILTER_REMOVE_SINGLE",value:{filters:e}}):r({type:"FILTER_SET_SINGLE",value:{filters:e,value:""===n?u.P:n}})},[r,e]),s=u.P;if((0,d.N3)(t)){let r=(0,l.f6)(t);for(let t of e){let{cubeIri:e,dimensionId:n}=t,o=r.cubes.find(t=>t.iri===e);o&&(s=i()(o,["filters",n,"value"],u.P))}}else(0,d.VF)(t)&&(s=i()(t.dashboardFilters,["dataFilters","filters",e[0].dimensionId,"value"],u.P));return{value:s,onChange:n}},D=e=>{let{filters:t,value:r}=e,[n,s]=(0,d.lY)(),a=(0,o.useCallback)(e=>{s({type:"FILTER_SET_SINGLE",value:{filters:t,value:e.currentTarget.value}})},[s,t]),c=t[0].cubeIri,u=t[0].dimensionId,p=(0,l.f6)(n).cubes.find(e=>e.iri===c),m=(0,d.N3)(n)?i()(p,["filters",u,"value"],""):"";return{name:u,value:r||m,checked:m===r,onChange:a}},Z=(e,t,r)=>{let n=e[t];return n?.type==="multi"&&(n.values?.[r]??!1)||!n},E=(0,o.createContext)({activeKeys:new Set,allValues:[],cubeIri:"",dimensionId:"",colorConfigPath:void 0,getValueColor:e=>""}),M=()=>(0,o.useContext)(E),A=e=>{let{dimension:t,colorConfigPath:r,children:n,getValueColor:i}=e,[s]=(0,d.lY)(),a=(0,d.B8)(s,t),l=(0,o.useMemo)(()=>t.values.map(e=>`${e.value}`)??[],[t.values]),c=(0,o.useMemo)(()=>new Set(a?"single"===a.type?[String(a.value)]:"multi"===a.type?Object.keys(a.values):[]:l),[a,l]),u=(0,o.useMemo)(()=>({allValues:l,activeKeys:c,cubeIri:t.cubeIri,dimensionId:t.id,colorConfigPath:r,getValueColor:i}),[l,t.cubeIri,t.id,c,r,i]);return(0,y.jsx)(E.Provider,{value:u,children:n})},L=e=>{let{type:t,metaKey:r,locale:n,value:i}=e,[,s]=(0,d.lY)(),a=(0,o.useCallback)(e=>{let i;switch(t){case"chart":i="CHART_META_CHANGE";break;case"layout":i="LAYOUT_META_CHANGE";break;default:return t}s({type:i,value:{path:`${r}.${n}`,value:e.currentTarget.value}})},[t,s,r,n]);return{name:`${r}-${n}`,value:i,onChange:a}}},15658:function(e,t,r){"use strict";r.d(t,{c7:function(){return eF},m:function(){return e5},Bc:function(){return eJ},B8:function(){return eQ},AF:function(){return eX},Ql:function(){return eK},YW:function(){return eY},Sc:function(){return e6},TM:function(){return ek},YO:function(){return eI},N3:function(){return e1},VF:function(){return e2},tH:function(){return e4},s9:function(){return e7},cX:function(){return e3},xk:function(){return e0},c2:function(){return e9},P3:function(){return eC},lY:function(){return eN},F9:function(){return eR}});var n=r(17043),i=r(28907),o=r(99729),s=r.n(o),a=r(71975),l=r.n(a),c=r(47215),d=r.n(c),u=r(55847),p=r(41143),m=r(50953),f=r(25390),h=r(87182),g=r(17674);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let v=e=>{let{chartConfig:t,dataSource:r}=e;return{version:g.o,state:"CONFIGURING_CHART",dataSource:r,layout:{type:"tab",meta:{title:{de:"",en:"",fr:"",it:""},description:{de:"",en:"",fr:"",it:""},label:{de:"",en:"",fr:"",it:""}},blocks:[{type:"chart",key:t.key,initialized:!1}],activeField:void 0},chartConfigs:[t],activeChartKey:t.key,dashboardFilters:{timeRange:{active:!1,timeUnit:"",presets:{from:"",to:""}},dataFilters:{componentIds:[],filters:{}}}}},j={version:g.o,state:"INITIAL",dataSource:h.Ve},x=y(y({},j),{},{version:g.o,state:"SELECTING_DATASET",dataSource:h.Ve,chartConfigs:void 0,layout:void 0,activeChartKey:void 0});var C=r(90089),O=r(56141),w=r.n(O),I=r(96498),S=r.n(I),P=r(95099),k=r.n(P),_=r(43551),T=r.n(_),D=r(68227),Z=r(10359),E=r(77167),M=r(23733),A=r(64103),L=r(50726),F=r(41282),N=r(57060),R=r(90453),G=r(17510),V=r(18822),$=r(45298);let U=e=>{let{locale:t,dataSource:r,cubeFilters:n}=e,i=n.map(e=>V.L.readQuery($.zv,{locale:t,sourceType:r.type,sourceUrl:r.url,cubeFilter:{iri:e.iri,componentIds:void 0,joinBy:e.joinBy,loadValues:!0}})).filter(G.y),o=Object.fromEntries(n.map(e=>[e.iri,e.joinBy]).filter(G.y));return{dimensions:(0,L.rF)({dimensions:i.filter(e=>e.data).map(e=>e.data?.dataCubeComponents?.dimensions).flat(),joinBy:o}),measures:i.flatMap(e=>e.data?.dataCubeComponents.measures)}};var z=r(92178),B=r(83513);let H=["measureId"];function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(0,i.Fl)(!1);let K=(0,i.ZP)((e,t)=>{let{dimensions:r,possibleFilters:n}=t,i=(e,t)=>e.filter(e=>e.cubeIri===t||(0,L.hm)(e.cubeIri));if("table"===e.chartType){let t=(0,u.Jo)(e.fields),o=(0,u.Jj)(e.fields),s=e=>t.has(e.id),a=e=>o.has(e.id);e.cubes.forEach(e=>{i(r,e.iri).forEach(t=>{q({cubeIri:e.iri,filters:e.filters,dimension:t,isHidden:s(t),isGrouped:a(t),possibleFilter:n?.find(e=>e.id===t.id)})})})}else{let t=(0,u.LZ)(e.fields),o=e=>t.has(e.id);e.cubes.forEach(e=>{let t=i(r,e.iri);k()(t,e=>(0,A.C_)(e)?-1:1,e=>e.hierarchy?-1:1).forEach(t=>{X({cubeIri:e.iri,filters:e.filters,dimension:(0,A.P9)(t)?(0,L.A8)(t,e):t,isField:o(t),possibleFilter:n?.find(e=>e.id===t.id)})})})}}),q=e=>{let{filters:t,dimension:r,isHidden:n,isGrouped:i,possibleFilter:o,cubeIri:s}=e,a=(0,A.P9)(r)?r.originalIds.find(e=>e.cubeIri===s)?.dimensionId:r.id;(0,z.h)(void 0!==a,"Dimension should have an IRI");let l=t[a],c=n&&!i;if(l)switch(l.type){case"single":c||delete t[a];break;case"multi":c&&r.isKeyDimension&&(t[a]={type:"single",value:Object.keys(l.values)[0]??r.values[0].value});break;case"range":break;default:return l}else c&&r.isKeyDimension&&(t[a]={type:"single",value:o?.value??r.values[0].value})},X=e=>{let{filters:t,dimension:r,isField:n,possibleFilter:i,cubeIri:o}=e,s=(0,A.P9)(r)?r.originalIds.find(e=>e.cubeIri===o)?.dimensionId:r.id;(0,z.h)(void 0!==s,"Dimension should have an IRI");let a=t[s];if(a)switch(a.type){case"single":n&&delete t[s];break;case"multi":if(!n){let e=r.hierarchy?(0,N.wb)(r.hierarchy,e=>!!e.hasValue):void 0,n=e?e.value:Object.keys(a.values)[0]??r.values[0].value;t[s]={type:"single",value:n}}break;case"range":n||(t[s]={type:"single",value:a.from});break;default:return a}else if(!n&&r.isKeyDimension){let e=r.hierarchy?(0,N.wb)(r.hierarchy,e=>!!e.hasValue):void 0,n=e?e.value:i?.value??r.values[0]?.value;n&&(t[r.id]={type:"single",value:n})}},J=(e,t)=>{let{chartConfig:r}=t??{};switch(e.state){case"SELECTING_DATASET":if(r)return v({dataSource:e.dataSource,chartConfig:r});break;case"CONFIGURING_CHART":return Y(Y({},e),{},{state:(0,m.qB)(e)?"LAYOUTING":"PUBLISHING",activeChartKey:e.chartConfigs[0].key});case"LAYOUTING":return Y(Y({},e),{},{state:"PUBLISHING"});case"INITIAL":case"PUBLISHING":case"PUBLISHED":break;default:throw(0,B.o)(e)}return e},Q=(e,t)=>{let r=t??eK(e);if("INITIAL"===e.state||"SELECTING_DATASET"===e.state)return e;switch(r){case"SELECTING_DATASET":return Y(Y({},e),{},{layout:void 0,chartConfigs:void 0,activeChartKey:void 0,state:r});case"CONFIGURING_CHART":return Y(Y({},e),{},{state:r,layout:Y(Y({},e.layout),{},{activeField:void 0}),chartConfigs:e.chartConfigs.map(e=>Y(Y({},e),{},{activeField:void 0})),activeChartKey:e.chartConfigs[0].key});case"LAYOUTING":return Y(Y({},e),{},{state:r})}return e},ee=(e,t)=>{if(!e1(e))return e;let r=(0,f.f6)(e),{locale:n,field:i,componentId:o,selectedValues:a}=t.value,l=s()(r.fields,i),c=U({locale:n,dataSource:e.dataSource,cubeFilters:r.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy}))}),d=c?.dimensions??[],u=c?.measures??[],m=[...d,...u].find(e=>e.id===o),h=a??m?.values??[];l&&(r.fields[i]={componentId:o});let g=(0,p.su)(r,i);g?.(o,{chartConfig:r,dimensions:d,measures:u,initializing:!l,selectedValues:h,field:i,oldField:l});let b=r.interactiveFiltersConfig.dataFilters.componentIds.filter(e=>e!==o),y=b.length>0;r.interactiveFiltersConfig.dataFilters={active:y,componentIds:b,defaultValueOverrides:Object.fromEntries(Object.entries(r.interactiveFiltersConfig.dataFilters.defaultValueOverrides).filter(e=>{let[t]=e;return t!==o})),filterTypes:Object.fromEntries(Object.entries(r.interactiveFiltersConfig.dataFilters.filterTypes).filter(e=>{let[t]=e;return t!==o}))};let v=K(r,{dimensions:d}),j=e.chartConfigs.findIndex(e=>e.key===r.key);return e.chartConfigs[j]=v,e},et=(e,t)=>{if(!e1(e))return e;let{locale:r,field:n}=t.value,i=(0,f.f6)(e);delete i.fields[n];let o=U({locale:r,dataSource:e.dataSource,cubeFilters:i.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy}))});if("segment"===t.value.field&&(i.interactiveFiltersConfig&&(i.interactiveFiltersConfig.calculation.active=!1,i.interactiveFiltersConfig.calculation.type="identity"),(0,m.GK)(i))){let e={type:"single",paletteId:F.h$,color:R.r.palette.primary.main};i.fields.color=e}let s=K(i,{dimensions:o?.dimensions??[]}),a=e.chartConfigs.findIndex(e=>e.key===i.key);e.chartConfigs[a]=s;let l=(0,p.Eg)(i,n);return l?.({chartConfig:i}),e},er=(e,t)=>{if(e1(e)){let{locale:r,path:n,field:i,value:o}=t.value,a=(0,f.f6)(e),l=null===i?n:`fields["${i}"].${n}`,c=U({locale:r,dataSource:e.dataSource,cubeFilters:a.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy}))}),d=c?.dimensions??[],u=c?.measures??[];if(i){let e=(0,p.XN)(a,i,n);e?.(o,{chartConfig:a,dimensions:d,measures:u,field:i,oldField:s()(a.fields,i)})}o===E.P?T()(a,l):S()(a,l,o,Object)}return e},en=(e,t)=>{if(e1(e)){let r;let{field:n,colorConfigPath:i,colorMapping:o,values:a,random:l,customPalette:c}=t.value,d=(0,f.f6)(e),u=i?["fields",n,i]:["fields",n];if((0,m.Su)(d)){let e=s()(d,u);e&&(r=(0,Z.t6)({paletteId:e.paletteId,dimensionValues:a,colorMapping:o,random:l,customPalette:c}))}else{let{paletteId:e}=s()(d,u);r=(0,Z.t6)({paletteId:e,dimensionValues:a,colorMapping:o,random:l,customPalette:c})}r&&S()(d,u.concat("colorMapping"),r,Object)}return e},ei=(e,t)=>{if(e1(e)){let r=(0,f.f6)(e);S()(r,"interactiveFiltersConfig",t.value,Object)}return e},eo=(e,t)=>{let{dimension:r,from:n,to:i}=t.value,o=(0,f.f6)(e),s=(e,t)=>{let r=o.cubes.find(t=>t.iri===e);r&&(r.filters[t]={type:"range",from:n,to:i})};if(r.isJoinByDimension)for(let{cubeIri:e,dimensionId:t}of r.originalIds)s(e,t);else s(r.cubeIri,r.id);o.interactiveFiltersConfig&&(o.interactiveFiltersConfig.timeRange={componentId:r.id,active:o.interactiveFiltersConfig.timeRange.active,presets:{type:"range",from:n,to:i}})},es=(e,t)=>((e1(e)||e2(e))&&(e.chartConfigs.push(t),e.activeChartKey=t.key,e.layout.blocks.push({key:t.key,type:"chart",initialized:!1}),el(e)),e),ea=(e,t)=>{switch(t.type){case"INITIALIZED":return"INITIAL"===t.value.state?eY(x):t.value;case"DATASOURCE_CHANGED":return e.dataSource=t.value,e;case"CHART_TYPE_CHANGED":if(e1(e)){let{locale:r,chartKey:n,chartType:o,isAddingNewCube:s}=t.value,a=(0,f.f6)(e,n),l=U({locale:r,dataSource:e.dataSource,cubeFilters:a.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy}))}),c=l?.dimensions,d=l?.measures;if(c&&d){let t=K((0,u.zh)({chartConfig:(0,i.Vk)(a),newChartType:o,dimensions:c,measures:d,isAddingNewCube:s}),{dimensions:c}),r=e.chartConfigs.findIndex(e=>e.key===a.key);e.chartConfigs[r]=t}}return e;case"CHART_ACTIVE_FIELD_CHANGE":return e1(e)&&((0,f.f6)(e).activeField=t.value),e;case"CHART_FIELD_CHANGED":return ee(e,t);case"CHART_SHOW_LEGEND_TITLE_CHANGED":if(e1(e)){let r=(0,f.f6)(e);(0,m.I3)(r)&&r.fields.segment&&(r.fields.segment.showTitle=t.value);let n=e.chartConfigs.findIndex(e=>e.key===r.key);e.chartConfigs[n]=r}return e;case"CHART_FIELD_DELETED":return et(e,t);case"CHART_FIELD_UPDATED":return er(e,t);case"COLOR_FIELD_SET":if(e1(e)){let r=(0,f.f6)(e);S()(r,"fields.color.paletteId",t.value.paletteId,Object),S()(r,`fields.color.${"single"===t.value.type?"color":"colorMapping"}`,"single"===t.value.type?t.value.color:t.value.colorMapping,Object)}return e;case"CHART_PALETTE_CHANGED":if(e1(e)){let r=(0,f.f6)(e),n=`fields["${t.value.field}"].${t.value.colorConfigPath?`${t.value.colorConfigPath}.`:""}`;S()(r,`${n}palette`,t.value.paletteId,Object),S()(r,`${n}colorMapping`,t.value.colorMapping,Object)}return e;case"CHART_PALETTE_RESET":if(e1(e)){let r=(0,f.f6)(e);S()(r,`fields["${t.value.field}"].${t.value.colorConfigPath?`${t.value.colorConfigPath}.`:""}colorMapping`,t.value.colorMapping,Object)}return e;case"CHART_COLOR_CHANGED":if(e1(e)){let r=(0,f.f6)(e);S()(r,`fields["${t.value.field}"].${t.value.colorConfigPath?`${t.value.colorConfigPath}.`:""}colorMapping["${t.value.value}"]`,t.value.color,Object)}return e;case"CHART_META_CHANGE":if(e1(e)){let r=(0,f.f6)(e);S()(r,`meta.${t.value.path}`,t.value.value,Object)}return e;case"CUSTOM_LAYER_ADD":if(e1(e)){let r=(0,f.f6)(e);(0,m.fD)(r)&&r.baseLayer.customLayers.push(t.value.layer)}return e;case"CUSTOM_LAYER_UPDATE":if(e1(e)){let r=(0,f.f6)(e);if((0,m.fD)(r)){let{layer:e}=t.value,n=r.baseLayer.customLayers.findIndex(t=>t.type===e.type&&t.id===e.id);-1!==n&&(r.baseLayer.customLayers[n]=e)}}return e;case"CUSTOM_LAYER_REMOVE":if(e1(e)){let r=(0,f.f6)(e);if((0,m.fD)(r)){let{type:e,id:n}=t.value;r.baseLayer.customLayers=r.baseLayer.customLayers.filter(t=>!(t.type===e&&t.id===n))}}return e;case"CUSTOM_LAYER_SWAP":if(e1(e)){let r=(0,f.f6)(e);if((0,m.fD)(r)){let{oldIndex:e,newIndex:n}=t.value,i=[...r.baseLayer.customLayers],[o]=i.splice(e,1);i.splice(n,0,o),r.baseLayer.customLayers=i}}return e;case"INTERACTIVE_FILTER_CHANGED":return ei(e,t);case"CHART_CONFIG_REPLACED":if(e1(e)){let r=(0,f.f6)(e),n=e.chartConfigs.findIndex(e=>e.key===r.key);e.chartConfigs[n]=K(t.value.chartConfig,{dimensions:t.value.dataCubesComponents.dimensions})}return e;case"FILTER_SET_SINGLE":if(e1(e)){let{filters:r,value:n}=t.value,i=(0,f.f6)(e);for(let e of r){let{cubeIri:t,dimensionId:r}=e,o=i.cubes.find(e=>e.iri===t);o?o.filters[r]={type:"single",value:n}:console.warn(`Could not set filter, no cube in chart config was found with iri ${t}`)}}else if(e2(e)){let{filters:r,value:n}=t.value,{dimensionId:i}=r[0];e.dashboardFilters&&(e.dashboardFilters.dataFilters.filters[i]={type:"single",value:n})}return e;case"FILTER_REMOVE_SINGLE":if(e1(e)){let{filters:r}=t.value,n=(0,f.f6)(e);for(let e of r){let{cubeIri:t,dimensionId:r}=e,i=n.cubes.find(e=>e.iri===t);if(i){delete i.filters[r];let e=(0,M.TZ)(n.interactiveFiltersConfig,r,!1);n.interactiveFiltersConfig=e}}}else if(e2(e)){let{filters:r}=t.value,{dimensionId:n}=r[0];e.dashboardFilters&&delete e.dashboardFilters.dataFilters.filters[n]}return e;case"CHART_CONFIG_UPDATE_COLOR_MAPPING":return en(e,t);case"CHART_CONFIG_FILTER_SET_MULTI":if(e1(e)){let{cubeIri:r,dimensionId:n,values:i}=t.value,o=(0,f.f6)(e);for(let e of(0,L.hm)(r)?(0,L.Z3)(r,o):[r]){let t=o.cubes.find(t=>t.iri===e||t.joinBy?.includes(e));t&&(t.filters[n]=(0,f.bV)(i))}}return e;case"CHART_CONFIG_FILTER_RESET_RANGE":if(e1(e)){let{cubeIri:r,dimensionId:n}=t.value,i=(0,f.f6)(e).cubes.find(e=>e.iri===r);i&&delete i.filters[n]}return e;case"CHART_CONFIG_FILTER_SET_RANGE":return e1(e)&&eo(e,t),e;case"CHART_CONFIG_FILTERS_UPDATE":if(e1(e)){let{cubeIri:r,filters:n}=t.value,i=(0,f.f6)(e).cubes.find(e=>e.iri===r);i&&(i.filters=n)}return e;case"IMPUTATION_TYPE_CHANGED":if(e1(e)){let r=(0,f.f6)(e);(0,m.uq)(r)&&(r.fields.y.imputationType=t.value.type)}return e;case"STEP_NEXT":return J(e);case"STEP_PREVIOUS":return Q(e,t.to);case"PUBLISH_FAILED":if("PUBLISHING"===e.state)return Q(e);return e;case"PUBLISHED":return e;case"CHART_CONFIG_ADD":if(e1(e)||e2(e)){let r=(0,i.P2)(t.value.chartConfig)??(0,f.f6)(e),n=U({locale:t.value.locale,dataSource:e.dataSource,cubeFilters:r.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy}))});if(n){let o=(0,i.Vk)(r.cubes);es(e,K(Y(Y({},t.value.chartConfig),{},{cubes:o}),{dimensions:n.dimensions}))}}return e;case"CHART_CONFIG_ADD_NEW_DATASET":return e1(e)&&es(e,t.value.chartConfig),e;case"DATASET_ADD":if(e1(e))return e5(e,t.value),e;break;case"DATASET_REMOVE":if(e1(e))return e9(e,t.value),e;break;case"CHART_CONFIG_REMOVE":if(e1(e)||e2(e)){let r=e.chartConfigs.findIndex(e=>e.key===t.value.chartKey),n=e.chartConfigs[r].key;e.chartConfigs.splice(r,1),e.layout.blocks=e.layout.blocks.filter(e=>e.key!==n),n===e.activeChartKey&&(e.activeChartKey=e.chartConfigs[Math.max(r-1,0)].key)}else console.warn("Ignoring CHART_CONFIG_REMOVE as state is incompatible with action"),console.log((0,i.Vk)(e));return el(e),e;case"CHART_CONFIG_REORDER":if(e1(e)||"LAYOUTING"===e.state){let{oldIndex:r,newIndex:n}=t.value,[i]=e.chartConfigs.splice(r,1);e.chartConfigs.splice(n,0,i)}return e;case"CHART_ANNOTATION_ADD":return e1(e)&&(0,f.f6)(e).annotations.push(t.value),e;case"CHART_ANNOTATION_HIGHLIGHT_TYPE_CHANGE":if(e1(e)){let{key:r,highlightType:n}=t.value,i=(0,f.f6)(e).annotations.find(e=>e.key===r);i&&(i.highlightType=n)}return e;case"CHART_ANNOTATION_COLOR_CHANGE":if(e1(e)){let{key:r,color:n}=t.value,i=(0,f.f6)(e).annotations.find(e=>e.key===r);i&&(i.color=n)}return e;case"CHART_ANNOTATION_DEFAULT_OPEN_CHANGE":if(e1(e)){let{key:r,defaultOpen:n}=t.value,i=(0,f.f6)(e).annotations.find(e=>e.key===r);i&&(i.defaultOpen=n)}return e;case"CHART_ANNOTATION_TEXT_CHANGE":if(e1(e)){let{key:r,locale:n,value:i}=t.value,o=(0,f.f6)(e).annotations.find(e=>e.key===r);o&&(o.text[n]=i)}return e;case"CHART_ANNOTATION_TEXT_CLEAR":if(e1(e)){let{key:r}=t.value,n=(0,f.f6)(e).annotations.find(e=>e.key===r);n&&(n.text={en:"",de:"",fr:"",it:""})}return e;case"CHART_ANNOTATION_REMOVE":if(e1(e)){let r=(0,f.f6)(e);r.annotations=r.annotations.filter(e=>e.key!==t.value.key),r.activeField=void 0}return e;case"CHART_ANNOTATION_TARGETS_CHANGE":if(e1(e)){let{key:r,targets:n}=t.value,i=(0,f.f6)(e).annotations.find(e=>e.key===r);i&&(i.targets=n)}return e;case"LIMIT_SET":if(e1(e)){let r=t.value,{measureId:n}=r,i=(0,C.Z)(r,H),o=(0,f.f6)(e);if(o.limits[n]){let e=o.limits[n].findIndex(e=>e.related.length===i.related.length&&e.related.every(e=>i.related.some(t=>e.dimensionId===t.dimensionId&&e.value===t.value)));-1!==e?o.limits[n][e]=i:o.limits[n].push(i)}else o.limits[n]=[i]}return e;case"LIMIT_REMOVE":if(e1(e)){let{measureId:r,related:n}=t.value,i=(0,f.f6)(e),o=i.limits[r]??[],s=o.findIndex(e=>e.related.length===n.length&&e.related.every(e=>n.some(t=>e.dimensionId===t.dimensionId&&e.value===t.value)));if(-1===s)return e;1===o.length?delete i.limits[r]:i.limits[r]=o.filter((e,t)=>t!==s)}return e;case"LAYOUT_BLOCK_SWAP":if(e1(e)||"LAYOUTING"===e.state){let{oldIndex:r,newIndex:n}=t.value,i=e.layout.blocks[r],o=e.layout.blocks[n];e.layout.blocks[r]=o,e.layout.blocks[n]=i}return e;case"SWITCH_ACTIVE_CHART":return(e1(e)||"LAYOUTING"===e.state||"PUBLISHED"===e.state)&&(e.activeChartKey=t.value),e;case"LAYOUT_CHANGED":return"LAYOUTING"!==e.state&&"PUBLISHED"!==e.state||w()(e.layout,t.value)||(e.layout=t.value,el(e)),e;case"LAYOUT_ACTIVE_FIELD_CHANGE":return"LAYOUTING"===e.state&&(e.layout.activeField=t.value),e;case"LAYOUT_META_CHANGE":return"LAYOUTING"===e.state&&S()(e,`layout.meta.${t.value.path}`,t.value.value,Object),e;case"CONFIGURE_CHART":let r=Q(e,"CONFIGURING_CHART");return(0,z.h)(e1(r),"Should be configuring after edit"),r.activeChartKey=t.value.chartKey,r;case"DASHBOARD_TIME_RANGE_FILTER_UPDATE":return e2(e)&&S()(e,"dashboardFilters.timeRange",t.value,Object),e;case"DASHBOARD_TIME_RANGE_FILTER_REMOVE":return e2(e)&&S()(e,"dashboardFilters.timeRange",{active:!1,timeUnit:"",presets:{from:"",to:""}},Object),e;case"DASHBOARD_DATA_FILTER_ADD":if(e2(e)&&e.dashboardFilters){let{dimensionId:r}=t.value,n=Y(Y({},e.dashboardFilters),{},{dataFilters:Y(Y({},e.dashboardFilters.dataFilters),{},{componentIds:[...e.dashboardFilters.dataFilters.componentIds,r]})});e.dashboardFilters=n}return e;case"DASHBOARD_DATA_FILTERS_SET":return e2(e)&&e.dashboardFilters&&(e.dashboardFilters.dataFilters=t.value),e;case"DASHBOARD_DATA_FILTER_REMOVE":if(e2(e)&&e.dashboardFilters){let{dimensionId:r}=t.value,n=Y(Y({},e.dashboardFilters),{},{dataFilters:Y(Y({},e.dashboardFilters.dataFilters),{},{componentIds:e.dashboardFilters.dataFilters.componentIds.filter(e=>e!==r)})});e.dashboardFilters=n}return e;default:throw(0,B.o)(t)}},el=e=>{if(e6(e)&&"dashboard"===e.layout.type&&"canvas"===e.layout.layout){let{blocks:t,layouts:r}=e.layout;for(let[n,i]of Object.entries(r)){let r=[...i],o=r.map(e=>e.i),s=t.filter(e=>!o.includes(e.key)),a=o.filter(e=>!t.find(t=>t.key===e)),{x:l,y:c}=ec({layouts:r,cols:D.e_[n]}),d=0,u=0;for(let e of s){switch(e.type){case"chart":d=(0,D.Z6)(),u=(0,D.xo)();break;case"text":d=1,u=1;break;default:return e}r.push({i:e.key,x:l,y:c,w:d,h:u,minH:D.Lg,resizeHandles:D.sz[e.type]})}for(let e of a){let t=r.findIndex(t=>t.i===e);r.splice(t,1)}e.layout.layouts=Y(Y({},e.layout.layouts),{},{[n]:r})}}},ec=e=>{let{layouts:t,cols:r}=e,n=(e,t)=>`${e},${t}`,i=new Set;for(let e of t)for(let t=0;t<e.w;t++)for(let r=0;r<e.h;r++)i.add(n(e.x+t,e.y+r));let o=0,s=0;for(;;){let e=n(o,s);if(!i.has(e))return{x:o,y:s};++o>=r&&(o=0,s++)}};var ed=r(57906),eu=r(46142),ep=r(86677),em=r(27378),ef=r(25380),eh=r(94428),eg=r(35444),eb=r(80207),ey=r(37079),ev=r(22116),ej=r(76394);let ex=e=>`vizualize-configurator-state:${e}`,eC=(e,t)=>{window.localStorage.setItem(ex(e),JSON.stringify(t))};function eO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ew(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eO(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eO(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let eI=async(e,t,r,n)=>{let i=await (0,ev.ST)(t,{client:e,dataSource:r}),{data:o}=await e.query($.CW,{sourceType:r.type,sourceUrl:r.url,locale:n,cubeFilter:{iri:t}}).toPromise(),s=o?.dataCubePreview.dimensions??[],a=o?.dataCubePreview.measures??[],l=s.some(e=>!e.isKeyDimension)?[...s.filter(e=>e.isKeyDimension).map(e=>e.id),...a.map(e=>e.id)]:void 0,{data:c}=await (0,eb.xw)(e,{sourceType:r.type,sourceUrl:r.url,locale:n,cubeFilters:[{iri:i,componentIds:l,loadValues:!0}]});if(!c?.dataCubesComponents)throw Error(`Could not fetch components for ${i}!`);let{dimensions:d,measures:p}=c.dataCubesComponents,{enabledChartTypes:m}=(0,u.ru)({dimensions:d,measures:p,cubeCount:1}),f=(0,u.jT)({chartType:m[0],iris:[{iri:i}],dimensions:d,measures:p}),{unmappedFilters:h}=eX(K(f,{dimensions:d}),{cubeIri:i}),g=Object.keys(h).length>0,b=(0,eg.B)({cubeIri:i,dataSource:r,unmappedFilters:h}),{data:y}=await e.query($.UK,b,{pause:!g}).toPromise();if(!y?.possibleFilters&&g)throw Error(`Could not fetch possible filters for ${i}!`);let v=K(f,{dimensions:d,possibleFilters:y?.possibleFilters});return J(eY(x),{chartConfig:v})},eS=async(e,t)=>{let r;let n=window.localStorage.getItem(ex(t));if(n){try{let e=JSON.parse(n),t=await (0,ej.qm)(e);r=(0,m.FJ)(t)}catch(e){console.error("Error while parsing stored state",e)}if(r)return(0,ev.XI)(r,{client:e,dataSource:r.dataSource});console.warn("Attempted to restore invalid state. Removing from localStorage.",r),window.localStorage.removeItem(ex(t))}},eP=async(e,t)=>{let r=await (0,ey.XS)(t);if(r?.data){delete r.data.key;let t=await (0,ej.qm)(ew(ew({},r.data),{},{state:"CONFIGURING_CHART"}));return await (0,ev.XI)(t,{client:e,dataSource:t.dataSource})}},ek=async(e,t,r)=>{let n=await (0,ey.XS)(t);if(n?.data){let t=await (0,ej.qm)(ew(ew({},n.data),{},{state:r??"CONFIGURING_CHART"}));return await (0,ev.XI)(t,{client:e,dataSource:t.dataSource})}};var e_=r(49148),eT=r(59266),eD=r(59823),eZ=r(37457),eE=r(24246);function eM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eA(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eM(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eM(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let eL=(0,em.createContext)(void 0),eF=e=>(0,eE.jsx)(eB,eA({},e),e.chartId),eN=e=>{let t=(0,em.useContext)(eL);if(void 0===t)throw Error("You need an <ConfiguratorStateProvider> to useConfiguratorState");let[r,n]=t;if(e&&!e(r))throw Error("State does not respect type guard");return[r,n]},eR=e=>{let t=(0,em.useContext)(eL);if(void 0===t)throw Error("You need an <ConfiguratorStateProvider> to useConfiguratorState");let[r]=t;if(e&&!e(r))throw Error("State does not respect type guard");return r},eG=(e,t,r)=>eA(eA({},e),{},{chartConfigs:[...t.map(e=>eA(eA({},e),{},{cubes:e.cubes.map(e=>eA(eA({},e),{},{filters:Object.fromEntries(Object.entries(e.filters).map((e,t)=>{let[r,n]=e;return[r,eA(eA({},n),{},{position:t})]}))}))}))],activeChartKey:r??e.chartConfigs[0].key}),eV=async(e,t)=>{let r=window.opener;if(r){r.postMessage(`CHART_ID:${e}`,"*"),window.close();return}await t({pathname:`/v/${e}`,query:{publishSuccess:!0}})};async function e$(e,t,r,n,i){if("new"===e){if(t.copy&&"string"==typeof t.copy)return eP(r,t.copy);if(t.edit&&"string"==typeof t.edit)return ek(r,t.edit,"string"==typeof t.state?t.state:void 0);if(t.cube&&"string"==typeof t.cube)return eI(r,t.cube,n,i)}else if("published"!==e)return eS(r,e)}async function eU(e,t,r,n){if("singleURLs"===r.layout.type){let{publishableChartKeys:e,meta:t,blocks:i}=r.layout,o=e.slice().reverse();return ez(o,async(e,s)=>{let a=eG(eA(eA({},r),{},{layout:{type:"tab",meta:t,blocks:i,activeField:void 0}}),r.chartConfigs.filter(t=>t.key===e),e),l=await (0,ey._g)({data:a,published_state:eu.PUBLISHED_STATE.PUBLISHED});return n(l,s+1,o.length),l})}{let i;if(t&&e){let r=await (0,ey.XS)(t);r&&r.user_id===e.id&&(i=r)}let o=eG(r,r.chartConfigs),s=await (i&&e?(0,ey.rF)({data:o,key:i.key,published_state:eu.PUBLISHED_STATE.PUBLISHED}):(0,ey._g)({data:o,published_state:eu.PUBLISHED_STATE.PUBLISHED}));return n(s,0,1),s}}let ez=async(e,t)=>{let r=[];for(let n=0;n<e.length;n++){let i=e[n],o=await t(i,n);r.push(o)}return r},eB=e=>{let{chartId:t,initialState:r,allowDefaultRedirect:n=!0,children:i}=e,{dataSource:o}=(0,ed.qo)(),s=(0,em.useMemo)(()=>r||eA(eA({},j),{},{dataSource:o}),[r,o]),a=(0,e_.bU)(),l=(0,eh.C)(ea,s),[c,d]=l,{asPath:u,push:p,replace:m,query:f}=(0,ep.useRouter)(),h=(0,eT.a)(),g=(0,ef.m8)();return(0,em.useEffect)(()=>{let e=s;(async()=>{try{let r=await e$(t,f,g,o,a);!r&&n&&"published"!==t&&m("/create/new"),e=r??e}finally{d({type:"INITIALIZED",value:e})}})()},[]),(0,em.useEffect)(()=>{("INITIAL"===c.state||"SELECTING_DATASET"===c.state)&&d({type:"DATASOURCE_CHANGED",value:o})},[o,d,c.state]),(0,em.useEffect)(()=>{try{switch(c.state){case"CONFIGURING_CHART":case"LAYOUTING":let e="new"===t?f.edit&&"string"==typeof f.edit?f.edit:(0,eD.M)():t;"new"===t&&m(`/create/${e}`),eC(e,c);return;case"PUBLISHING":(async()=>{try{let e=(0,eZ.vf)(u);if(!e)return;return eU(h,e,c,async(e,t,r)=>{if("singleURLs"===c.layout.type&&t<r)return window.open(`/${a}/v/${e.key}`,"_blank");await eV(e.key,p)})}catch(e){console.error(e),d({type:"PUBLISH_FAILED"})}})();return}}catch(e){console.error(e)}},[c,d,t,p,u,a,f.from,m,h,f.edit]),(0,eE.jsx)(eL.Provider,{value:l,children:i})};function eH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eW(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eH(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eH(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let eY=e=>{let t=(0,ed.ZB)();return eW(eW({},e),{},{dataSource:t??h.Ve})},eK=e=>{switch(e.state){case"SELECTING_DATASET":return e.state;case"CONFIGURING_CHART":default:return"SELECTING_DATASET";case"LAYOUTING":return"CONFIGURING_CHART";case"PUBLISHING":if((0,m.qB)(e))return"LAYOUTING";return"CONFIGURING_CHART"}},eq=e=>{let t=[];return(0,m.Nu)(e)&&(e.fields.areaLayer?.color.type==="categorical"&&t.push(e.fields.areaLayer.color.componentId),e.fields.symbolLayer?.color.type==="categorical"&&t.push(e.fields.symbolLayer.color.componentId)),t},eX=(e,t)=>{let{joinByIds:r,cubeIri:n}=t,i=new Set([...Object.values(e.fields).map(e=>e.componentId),...eq(e),...r??[]]),o=(0,f.jW)(e.cubes,{cubeIri:n}),s=l()(o,(e,t)=>i.has(t)),a=l()(o,(e,t)=>!i.has(t));return(0,f.Wd)(a)||console.warn("Unmapped filters must be single filters!"),{mappedFilters:s,mappedFiltersIds:i,unmappedFilters:(0,f.G_)(a)}},eJ=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=(0,f.f6)(e);return s()(i,null===t?r:`fields["${t}"].${r}`,n)},eQ=(e,t)=>{if("INITIAL"===e.state||"SELECTING_DATASET"===e.state)return;let r=(0,f.f6)(e);return(0,f.jW)(r.cubes,{joined:!0})[t.id]},e0=(0,i.ZP)((e,t)=>{let{dimension:r,delta:n,possibleValues:i}=t,o=e.cubes.find(e=>e.iri===r.cubeIri);if(!o)return;let s=Object.getOwnPropertyNames(o.filters),a=Object.keys(o.filters).indexOf(r.id);if(0===a&&-1===n||a===s.length-1&&1===n||-1===a&&-1!==n)return;let l=-1===a?s.length-1:a+n,c=s[l];s[l]=r.id,-1===a?s.push(c):s[a]=c,o.filters=Object.fromEntries(s.map(e=>[e,o.filters[e]??{type:"single",value:i[0]}]))}),e1=e=>"CONFIGURING_CHART"===e.state,e2=e=>"LAYOUTING"===e.state,e4=e=>!e1(e)&&"dashboard"===e.layout.type&&"canvas"===e.layout.layout,e3=e=>"PUBLISHING"===e.state,e7=e=>"PUBLISHED"===e.state,e6=e=>"chartConfigs"in e,e5=function(e,t){let r=(0,f.f6)(e,e.activeChartKey),{iri:n,joinBy:i}=t;for(let e=0;e<r.cubes.length;e++){let t=i[r.cubes[e].iri];r.cubes[e].joinBy=t}r.cubes.push({iri:n,joinBy:i[n],filters:{}});let{encodings:o}=(0,p.K0)(r);for(let[e,t]of o.map(e=>[e,r.fields[e.field]]))if(t)for(let r of e.idAttributes){let e=s()(t,r),n=Object.keys(i),o=(()=>{for(let t of n){let r=i[t].indexOf(e);if(r>-1)return r}})();void 0!==o&&o>-1&&d()(t,r,(0,L.mM)(o))}},e9=function(e,t){let{locale:r,iri:n}=t,o=(0,f.f6)(e),s=o.cubes.filter(e=>e.iri!==n),a=U({locale:r,dataSource:e.dataSource,cubeFilters:s.map(e=>({iri:e.iri,joinBy:s.length>1?e.joinBy:void 0}))});if(!a)throw Error("Error while removing dataset: Could not find cached dataCubesComponents");let{dimensions:l,measures:c}=a,d=o.cubes.filter(e=>e.iri!==n).map(e=>{let{iri:t}=e;return{iri:t}}),{enabledChartTypes:p}=(0,u.ru)({dimensions:l,measures:c,cubeCount:d.length}),m=K((0,u.jT)({chartType:p.includes(o.chartType)?o.chartType:p[0],iris:d,dimensions:l,measures:c,meta:(0,i.Vk)(o.meta)}),{dimensions:l}),h=eW(eW({},v({dataSource:e.dataSource,chartConfig:m}).chartConfigs[0]),{},{key:o.key}),g=e.chartConfigs.findIndex(e=>e.key===o.key),b=K(h,{dimensions:l}),y=Object.fromEntries(o.cubes.map(e=>[e.iri,e.joinBy]));for(let e of b.cubes){let t=y[e.iri];t&&(e.joinBy=t)}return e.chartConfigs[g]=b,e}},71238:function(e,t,r){"use strict";r.d(t,{xE:function(){return oE},_R:function(){return oz},c7:function(){return eF.c7},K:function(){return oa.K},yU:function(){return eP.yU},Mm:function(){return eP.Mm},MO:function(){return eP.MO},B8:function(){return eF.B8},AF:function(){return eF.AF},NR:function(){return eP.NR},EA:function(){return eP.EA},Sc:function(){return eF.Sc},A2:function(){return oM},GK:function(){return eP.GK},tJ:function(){return eP.tJ},N3:function(){return eF.N3},VF:function(){return eF.VF},tH:function(){return eF.tH},s9:function(){return eF.s9},cX:function(){return eF.cX},I3:function(){return eP.I3},uk:function(){return oa.uk},nV:function(){return eP.nV},lY:function(){return eF.lY},qy:function(){return oa.qy},F9:function(){return eF.F9}});var n=r(17043),i=r(90089),o=r(96338),s=r(19914),a=r(54417),l=r(98505),c=r(50714),d=r(61799),u=r(60116),p=r(87026),m=r(12548),f=r(46142),h=r(38600),g=r(79894),b=r.n(g),y=r(86677),v=r(73868),j=r(96349),x=r(27378),C=r(25380),O=r(53156),w=r(30503),I=r(97091),S=r(59052),P=r(64986),k=r(40624),_=r(88038),T=r.n(_),D=r(48863),Z=r(78222),E=r(16370),M=r(97971),A=r(47612),L=r(52137),F=r(32597),N=r(78081),R=r(10369),G=r(65619),V=r(65637),$=r(65218),U=r.n($),z=r(29952),B=r(24246);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let W=U()(()=>Promise.all([r.e(48683),r.e(23731)]).then(r.bind(r,23731)).then(e=>e.DebugPanel),{ssr:!1,loadableGenerated:{webpack:()=>[23731]}}),Y=e=>(0,z.P5)("debug")?(0,B.jsx)(x.Suspense,{fallback:(0,B.jsx)(V.Z,{}),children:(0,B.jsx)(W,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e))}):null;var K=r(70185),q=r(53082),X=r(99990),J=r(7752),Q=r(17899),ee=r(5680),et=r(78839),er=r(25390),en=r(62075),ei=r(80207),eo=r(94460),es=r(49148),ea=r(8788),el=r(80733),ec=r(90717),ed=r(9448);function eu(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ep(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eu(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eu(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var em=r(71171);let ef=["children","chartKey","dataSource"],eh=["children","className","chartKey","dataSource"];function eg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eb(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eg(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ey=e=>{let{dataSource:t}=e,[r]=(0,eF.lY)(eF.Sc),n=(0,eF.N3)(r),{layout:i}=r,o=(0,x.useMemo)(()=>(0,ee.ag)(),[]);return(0,B.jsx)(ee.ax.Provider,{value:o,children:"dashboard"!==i.type||n?"singleURLs"!==i.type||n?(0,B.jsxs)(B.Fragment,{children:[(0,eF.N3)(r)?null:(0,B.jsx)(G.u,{sx:{mb:4}},r.chartConfigs.map(e=>e.key).join(",")),(0,B.jsx)(N.Ig,{children:(0,B.jsx)(L.hC,{editing:n,layout:i,chartKey:r.activeChartKey,children:(0,B.jsx)(eI,{dataSource:t})})},r.activeChartKey)]}):(0,B.jsx)(ew,{dataSource:t,layout:i}):(0,B.jsx)(ex,{dataSource:t,layoutType:i.layout})})},ev=(e=>{let{xOffset:t=0}=e;return e=>{let{transform:r,activeNodeRect:n,activatorEvent:i}=e;return i&&(0,ed.DC)(i)&&n?ep(ep({},r),{},{x:r.x+n.width+t,y:r.y}):r}})({xOffset:-400}),ej=(0,P.Z)(()=>({canvasChartPanelLayout:{paddingBottom:"10rem"}})),ex=e=>{let{dataSource:t,layoutType:r,editing:n}=e,[i,o]=(0,eF.lY)(eF.Sc),s=(0,ec.F)(),a=(0,el.K)(),{0:l,1:c}=(0,x.useState)(!1),{0:d,1:u}=(0,x.useState)(null),{0:p,1:m}=(0,x.useState)(null),f=ej(),h=(0,x.useCallback)(e=>"canvas"===r?(0,B.jsx)(eC,{chartKey:e.key,dataSource:t,layout:i.layout,editing:n},e.key):(0,B.jsx)(eO,{chartKey:e.key,dataSource:t,layout:i.layout,editing:n},e.key),[t,n,r,i.layout]),g=(0,x.useCallback)(e=>"canvas"===r?(0,et.aW)(e):(0,B.jsx)(et.Co,{block:e}),[r]),b=(0,x.useCallback)(e=>{switch(e.type){case"chart":return h(i.chartConfigs.find(t=>t.key===e.key));case"text":return g(e);default:return e}},[i.chartConfigs,h,g]);return"canvas"===r?(0,B.jsx)("div",{children:(0,B.jsx)(L.WK,{renderBlock:b,layoutType:r,className:f.canvasChartPanelLayout})},i.chartConfigs.map(e=>e.key).join(",")):(0,B.jsxs)(S.LB,{autoScroll:{layoutShiftCompensation:!1},collisionDetection:S.j2,onDragStart:e=>{a.setEnable(!1),c(!0),u(i.layout.blocks.find(t=>t.key===e.active.id))},onDragMove:e=>{e.over?.id!==p?.id&&e.over?.id!==d?.key&&m(e.over)},onDragEnd:e=>{a.setEnable(!0),c(!1),u(null),m(null);let{active:t,over:r}=e;t&&r&&o({type:"LAYOUT_BLOCK_SWAP",value:{oldIndex:i.layout.blocks.findIndex(e=>e.key===t.id),newIndex:i.layout.blocks.findIndex(e=>e.key===r.id)}})},children:[(0,B.jsx)(L.WK,{renderBlock:b,layoutType:r}),l?(0,B.jsx)(S.y9,{zIndex:1e3,modifiers:[ev],style:{opacity:p?.8:1,width:400,height:"fit-content",border:`2px solid ${p?s.palette.primary.main:"transparent"}`,cursor:"grabbing"},children:d?"chart"===d.type?(0,B.jsx)(L.hC,{chartKey:"dragged",children:(0,B.jsx)(eI,{dataSource:t,chartKey:d.key,actionElementSlot:(0,B.jsx)(K.D,{dragging:!0})})}):(0,B.jsx)(et.al,{block:d}):null}):null]})},eC=(0,x.forwardRef)((e,t)=>{let{children:r,chartKey:n,dataSource:o}=e,s=(0,i.Z)(e,ef);return(0,B.jsx)(N.Ig,{children:(0,B.jsx)(L.hC,eb(eb({},s),{},{ref:t,chartKey:n,children:(0,B.jsx)(eI,{dataSource:o,chartKey:n,actionElementSlot:(0,B.jsx)(K.D,{dragging:!0}),children:r})}))})}),eO=e=>{let{children:t,className:r,chartKey:n,dataSource:o}=e,s=(0,i.Z)(e,eh),{setActivatorNodeRef:a,setNodeRef:l,attributes:c,listeners:d,isDragging:u}=(0,S.O1)({id:n}),{setNodeRef:p,isOver:m,active:f}=(0,S.Zj)({id:n}),h=(0,x.useCallback)(e=>{l(e),p(e)},[l,p]),g=(0,K.x)({isDragging:u,isDragActive:!!f,isDragOver:m});return(0,B.jsx)(N.Ig,{children:(0,B.jsx)(L.hC,eb(eb(eb({},s),{},{ref:h},c),{},{chartKey:n,className:(0,k.Z)(r,g.root),style:{display:f?"flex":"contents",flexDirection:"column"},children:(0,B.jsx)(eI,{dataSource:o,chartKey:n,actionElementSlot:(0,B.jsx)(K.D,eb({ref:a,dragging:u},d))})}))})},ew=e=>{let{dataSource:t,layout:r}=e,[n,i]=(0,eF.lY)(eF.Sc),o=(0,x.useCallback)(e=>{if("chart"!==e.type)return(0,B.jsx)(B.Fragment,{});let{key:o}=e,s=r.publishableChartKeys.includes(o),{publishableChartKeys:a}=r;return(0,B.jsx)(N.Ig,{children:(0,B.jsx)(L.hC,{chartKey:o,children:(0,B.jsx)(eI,{dataSource:t,chartKey:o,actionElementSlot:(0,B.jsx)(X.XZ,{checked:s,disabled:1===a.length&&s,onChange:()=>{i({type:"LAYOUT_CHANGED",value:eb(eb({},r),{},{publishableChartKeys:s?a.filter(e=>e!==o):n.chartConfigs.map(e=>e.key).filter(e=>a.includes(e)||e===o)})})},label:""})})})})},[t,i,r,n.chartConfigs]);return(0,B.jsx)(L.WK,{layoutType:"vertical",renderBlock:o})},eI=e=>{let{children:t,dataSource:r,chartKey:n,actionElementSlot:i}=e,s=(0,x.useRef)(null),[a,l]=(0,eF.lY)(),c=(0,eF.N3)(a),d=(0,er.f6)(a,n),p=(0,es.bU)(),m=(0,F.TZ)({removeBorder:!1}),f={sourceType:r.type,sourceUrl:r.url,locale:p},[{data:h}]=(0,ei.bi)({variables:eb(eb({},f),{},{cubeFilters:d.cubes.map(e=>({iri:e.iri}))})}),g=void 0,[{data:b}]=(0,ei.k$)({chartConfig:d,variables:eb(eb({},f),{},{cubeFilters:d.cubes.map(e=>({iri:e.iri,componentIds:g,filters:e.filters,joinBy:e.joinBy}))})}),{isTable:y}=(0,N.IS)(),v=b?.dataCubesComponents.dimensions,j=b?.dataCubesComponents.measures,C=(0,x.useMemo)(()=>v&&j?[...v,...j]:[],[v,j]);return(0,B.jsxs)(u.Z,{ref:s,className:(0,k.Z)(m.root,c?m.editing:m.pastEditing),children:[t,(0,B.jsx)(M.x,{resetKeys:[a],children:(0,eF.Sc)(a)&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(T(),{children:(0,B.jsxs)("title",{children:[d.meta.title[p]?d.meta.title[p]:h?.dataCubesMetadata.map(e=>e.title).join(", ")," ","- visualize.admin.ch"]},"title")}),(0,B.jsx)(D.p,{children:(0,B.jsxs)(ea.Zg,{chartConfigKey:d.key,children:[(0,B.jsxs)(q.k,{sx:{height:"fit-content",justifyContent:c||d.meta.title[p]?"space-between":"flex-end",alignItems:"flex-start",gap:2},children:[c||d.meta.title[p]?(0,B.jsx)(en.Dx,{text:d.meta.title[p],smaller:!0,onClick:c?()=>l({type:"CHART_ACTIVE_FIELD_CHANGE",value:"title"}):void 0,[em.Dd]:!d.meta.title[p]}):(0,B.jsx)("span",{style:{height:1}}),(0,B.jsxs)(Z.G,{children:[(0,B.jsx)(F.iA,{chartKey:d.key,chartWrapperNode:s.current,components:C}),i]})]}),c||d.meta.description[p]?(0,B.jsx)(en.dk,{text:d.meta.description[p],smaller:"dashboard"===a.layout.type,onClick:c?()=>{l({type:"CHART_ACTIVE_FIELD_CHANGE",value:"description"})}:void 0,[em.Dd]:!d.meta.description[p]}):(0,B.jsx)("span",{style:{height:1}}),(0,B.jsx)(u.Z,{sx:{mt:4},children:h?.dataCubesMetadata.some(e=>e.publicationStatus===eo.sl.Draft)&&(0,B.jsx)(u.Z,{sx:{mb:4},children:(0,B.jsx)(Q.m0,{children:(0,B.jsx)(o.cC,{id:"dataset.publicationStatus.draft.warning",components:{0:(0,B.jsx)("br",{}),1:(0,B.jsx)("strong",{})}})})})}),(0,B.jsx)(F.xx,{dataSource:r,chartConfig:d,dashboardFilters:a.dashboardFilters,metadataPanelProps:{components:C,top:J.r}}),(0,B.jsx)(N.S4,{children:y?(0,B.jsx)(E._,{dataSource:r,chartConfig:d,dashboardFilters:a.dashboardFilters,sx:{width:"100%",maxHeight:"100%"}}):(0,B.jsx)(R.I,{dataSource:r,componentIds:g,chartConfig:d,dashboardFilters:a.dashboardFilters})}),(0,B.jsx)(A.Tc,{dataSource:r,chartConfig:d,dashboardFilters:a.dashboardFilters,components:C}),(0,B.jsx)("div",{className:"debug-panel",children:(0,B.jsx)(Y,{configurator:!0,interactiveFilters:!0})})]})})]})})]})},eS=()=>{let e=(0,x.useRef)(),{0:t,1:r}=(0,x.useState)(void 0);return(0,x.useEffect)(()=>()=>{e.current&&clearTimeout(e.current)},[]),[t,(0,x.useCallback)(function(t){r(t),t&&(e.current=setTimeout(()=>{r(void 0)},t.duration||5e3))},[]),(0,x.useCallback)(function(){r(void 0)},[])]};var eP=r(50953),ek=r(5646);let e_=e=>{let{onClick:t}=e,r=eT();return(0,B.jsx)(m.Z,{className:r.root,size:"sm",onClick:t,children:(0,B.jsx)(p.Z,{component:"span",children:"Ok"})})},eT=(0,P.Z)(e=>({root:{alignSelf:"flex-end",marginTop:e.spacing(2),paddingLeft:e.spacing(5),paddingRight:e.spacing(5)}}));var eD=r(44945),eZ=r(45365),eE=r(77142);let eM=()=>{let[e]=(0,eF.lY)(eF.N3),t=(0,er.f6)(e);return(0,B.jsx)(eL,{type:"chart",activeField:t.activeField,meta:t.meta})},eA=()=>{let[e]=(0,eF.lY)(eF.VF);return(0,B.jsx)(eL,{type:"layout",activeField:e.layout.activeField,meta:e.layout.meta})},eL=e=>{let{type:t,activeField:r,meta:n}=e,[i,o]=(0,eF.lY)(),s=(0,es.WB)(),a=(0,x.useRef)(null),l=(0,eE.z)(()=>{o({type:"chart"===t?"CHART_ACTIVE_FIELD_CHANGE":"LAYOUT_ACTIVE_FIELD_CHANGE",value:void 0})});return((0,x.useEffect)(()=>{a?.current&&a.current.focus()},[r]),r&&oM(r))?(0,B.jsx)(u.Z,{ref:a,role:"tabpanel",id:`annotator-panel-${r}`,"aria-labelledby":`annotator-tab-${r}`,tabIndex:-1,sx:{overflowX:"hidden",overflowY:"auto"},children:(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,children:(0,eZ.N)(r)}),(0,B.jsxs)(ek.kc,{children:[s.map(e=>(0,B.jsx)("div",{children:(0,B.jsx)(eD.p4,{type:t,inputType:"label"===r?"text":"markdown",metaKey:r,locale:e,label:(0,eZ.N)(e),value:n[r][e],disableToolbar:{blockType:!0,listToggles:"title"===r,link:"title"===r}})},`${e}-${r}`)),(0,B.jsx)(e_,{onClick:l})]})]})}):null};var eF=r(15658),eN=r(27102),eR=r(92178);let eG=()=>{let e=(0,es.WB)(),[t,r]=(0,eN.lY)(eF.VF),{layout:n}=t,{blocks:i}=n,s=(0,x.useMemo)(()=>{let e=i.find(e=>e.key===n.activeField);return e&&(0,eR.h)("text"===e.type,"Active block must be a text block"),e},[i,n.activeField]),a=(0,eE.z)(()=>{r({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:void 0})});return s?(0,B.jsx)("div",{role:"tabpanel",id:`control-panel-block-${s.key}`,"aria-labelledby":`tab-block-${s.key}`,tabIndex:-1,children:(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,children:(0,B.jsx)(o.cC,{id:"controls.section.block-options.block.text"})}),(0,B.jsxs)(ek.kc,{children:[e.map(e=>(0,B.jsx)(eD.Lm,{locale:e},e)),(0,B.jsx)(e_,{onClick:a})]})]})},s.key):null};var eV=r(56141),e$=r.n(eV),eU=r(48159),ez=r.n(eU),eB=r(27686),eH=r(79234),eW=r(4974),eY=r(12570),eK=r(56436),eq=r(48947),eX=r(94853);let eJ=()=>{let e=(0,es.bU)(),[t,r]=(0,eF.lY)(eF.N3),n=(0,er.f6)(t),i=n.activeField,a=n.annotations.find(e=>e.key===i),[{data:l}]=(0,ei.k$)({chartConfig:n,variables:{locale:e,sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,cubeFilters:n.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy,loadValues:!0}))}}),c=(0,x.useMemo)(()=>l?.dataCubesComponents.dimensions??[],[l]),d=(0,x.useMemo)(()=>e0({annotation:a,dimensions:c}),[a,c]),u=(0,eE.z)(e=>{a&&a.highlightType!==e&&(r({type:"CHART_ANNOTATION_HIGHLIGHT_TYPE_CHANGE",value:{key:a.key,highlightType:e}}),"filled"!==e||a.color||r({type:"CHART_ANNOTATION_COLOR_CHANGE",value:{key:a.key,color:eX.i}}))}),f=(0,eE.z)(e=>{a&&a.color!==e&&r({type:"CHART_ANNOTATION_COLOR_CHANGE",value:{key:a.key,color:e}})}),h=(0,eE.z)(()=>{a&&r({type:"CHART_ANNOTATION_REMOVE",value:{key:a.key}})}),g=(0,eE.z)(e=>{r({type:"CHART_ANNOTATION_TEXT_CLEAR",value:{key:e}})}),b=(0,eE.z)(()=>{if(!a)return;let e=(0,eW.J)();e$()(ez()(a,"key"),ez()(e,"key"))&&g(a.key),r({type:"CHART_ACTIVE_FIELD_CHANGE",value:void 0})}),y=(0,eE.z)(e=>{a&&a.defaultOpen!==e&&r({type:"CHART_ANNOTATION_DEFAULT_OPEN_CHANGE",value:{key:a.key,defaultOpen:e}})}),v=(0,eH.q)();if(!a)return null;let j=a.targets.length>0,C=Object.values(a.text).some(e=>e),O=a.text[e],w=(0,eP.I3)(n)&&"segment"in n.fields&&!!n.fields.segment;return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,onClose:b,children:(0,B.jsx)(o.cC,{id:"controls.annotations.highlight.section.element.title"})}),(0,B.jsx)(ek.kc,{children:(0,B.jsx)(p.Z,{variant:"h6",component:"p",children:d||s.ag._({id:"controls.annotations.highlight.section.element.cta"})})})]}),w?null:(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{children:(0,B.jsx)(o.cC,{id:"controls.annotations.highlight.section.style.title"})}),(0,B.jsxs)(ek.kc,{gap:"xl",children:[(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(X.Y8,{label:s.ag._({id:"controls.text-only"}),value:"none",checked:"none"===a.highlightType,disabled:!j,onChange:()=>u("none")}),(0,B.jsx)(X.Y8,{label:s.ag._({id:"controls.fill-and-text"}),value:"filled",checked:"filled"===a.highlightType,disabled:!j,onChange:()=>u("filled")})]}),"filled"===a.highlightType&&a.color&&(0,B.jsx)(eD.zH,{label:a.color,color:a.color,symbol:"square",onChange:f})]})]}),(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{children:(0,B.jsx)(o.cC,{id:"controls.annotations.highlight.section.annotation.title"})}),(0,B.jsxs)(ek.kc,{px:"none",children:[(0,B.jsx)(eY.Ko,{upperLabel:O?void 0:s.ag._({id:"controls.annotations.annotation"}),mainLabel:(0,B.jsx)(eB.UG,{children:O||s.ag._({id:"controls.annotations.annotation.add.text"})}),icon:"text",onClick:v.open,value:"text",disabled:!j}),(0,B.jsx)(m.Z,{variant:"text",color:"primary",size:"xs",disabled:!j||!C,onClick:()=>g(a.key),sx:{width:"fit-content",ml:4},children:(0,B.jsx)(o.cC,{id:"controls.annotations.annotation.clear-text"})})]})]}),(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{children:(0,B.jsx)(o.cC,{id:"controls.annotations.highlight.section.display.title"})}),(0,B.jsx)(ek.kc,{children:(0,B.jsx)(X.XZ,{label:s.ag._({id:"controls.annotations.highlight.section.display.default-open"}),checked:a.defaultOpen,disabled:!j||!C,onChange:()=>y(!a.defaultOpen)})})]}),(0,B.jsx)(eQ,{opened:v.isOpen,close:v.close}),(0,B.jsx)(ek.rE,{hideTopBorder:!0,style:{marginTop:"auto"},children:(0,B.jsx)(ek.kc,{children:(0,B.jsx)(m.Z,{variant:"outlined",size:"sm",color:"error",startIcon:(0,B.jsx)(eq.JO,{name:"trash",size:20}),onClick:h,children:(0,B.jsx)(o.cC,{id:"controls.annotations.delete"})})})})]})},eQ=e=>{let{opened:t,close:r}=e,n=(0,es.WB)(),[i,s]=(0,eF.lY)(eF.N3),a=(0,er.f6)(i),l=a.activeField,c=a.annotations.find(e=>e.key===l),d=(0,eE.z)((e,t)=>{c&&s({type:"CHART_ANNOTATION_TEXT_CHANGE",value:{key:c.key,locale:e,value:t}})});return c?(0,B.jsx)(eK.oe,{open:t,hideBackdrop:!0,children:(0,B.jsx)("div",{role:"tabpanel",id:`annotations-panel-${l}`,"aria-labelledby":`annotations-tab-${l}`,tabIndex:-1,style:{overflowX:"hidden",overflowY:"auto"},children:(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{onClose:r,children:(0,B.jsx)(o.cC,{id:"controls.annotations.highlight.section.annotation.title"})}),(0,B.jsx)(ek.kc,{children:n.map(e=>(0,B.jsx)("div",{children:(0,B.jsx)(X.o2,{name:`annotation-${e}`,label:(0,eZ.N)(e),value:c.text[e],characterLimit:500,disablePlugins:{headings:!0},disableToolbar:{blockType:!0,listToggles:!0,link:!0},onChange:t=>{d(e,t.currentTarget.value)}})},`${e}-${l}`))})]})})}):null},e0=e=>{let{annotation:t,dimensions:r}=e;if(t)return t.targets.map(e=>e?e1(e,{dimensions:r}):"").sort().join(", ")},e1=(e,t)=>{let{dimensions:r}=t;if(!e)return;let n=r.find(t=>t.id===e.componentId);if(!n)return;let i=n.values.find(t=>t.value===e.value);if(i)return`${n.label}: ${i.label}`};var e2=r(97901),e4=r(42180),e3=r(1787),e7=r(38354),e6=r.n(e7),e5=r(90104),e9=r.n(e5),e8=r(71975),te=r.n(e8),tt=r(95099),tr=r.n(tt),tn=r(83766),ti=r.n(tn),to=r(3473),ts=r(41143),ta=r(35444),tl=r(97358);let tc=()=>(0,B.jsx)("span",{title:s.ag._({id:"Drag filters to reorganize"}),style:{cursor:"move"},children:(0,B.jsx)(eq.JO,{name:"dragIndicator"})});var td=r(13602);function tu(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let tp=e=>{let{sx:t}=e,r=(0,ek.iH)(),[i]=(0,eF.lY)(eF.N3),o=(0,er.f6)(i),s=(0,er.In)(o);return(0,B.jsx)(td.Z,{invisible:r.isOpen,badgeContent:Object.values(s).filter(e=>"single"===e.type).length,color:"secondary",sx:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tu(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tu(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({display:"block"},t)})},tm=e=>{let{sx:t}=e,r=(0,ek.iH)(),[n]=(0,eF.lY)(eF.N3),i=(0,er.f6)(n).cubes.length;return(0,B.jsx)(td.Z,{invisible:r.isOpen,badgeContent:i,sx:t})};var tf=r(90577);let th=()=>{let[e,t]=(0,eF.lY)(eF.N3),{annotations:r}=(0,er.f6)(e),n=(0,eE.z)(e=>{let r;if("highlight"!==e)return e;t({type:"CHART_ANNOTATION_ADD",value:r=(0,eW.J)()}),t({type:"CHART_ACTIVE_FIELD_CHANGE",value:r.key})});return r.length<3?(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(tf.Y,{onClick:()=>n("highlight"),sx:{mx:4},children:(0,B.jsx)(o.cC,{id:"controls.annotations.add"})})}):null},tg=()=>{let[e]=(0,eF.lY)(eF.N3),t=(0,er.f6)(e);return(0,eP.WP)(t)?(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-annotations",collapse:!0,defaultExpanded:!1,children:[(0,B.jsx)(ek.NZ,{id:"controls-annotations",children:(0,B.jsx)(o.cC,{id:"controls.section.annotations"})}),(0,B.jsxs)(ek.kc,{gap:"none",px:"none",children:[t.annotations.map(e=>(0,B.jsx)(tb,{annotation:e},e.key)),(0,B.jsx)(th,{})]})]}):null},tb=e=>{let{annotation:t}=e,r=(0,es.bU)(),[n,i]=(0,eF.lY)(eF.N3),o=(0,er.f6)(n),a=t.text[r],l=o.activeField??"",c=(0,eE.z)(()=>{i({type:"CHART_ACTIVE_FIELD_CHANGE",value:t.key})});return(0,B.jsx)(eY.Ko,{upperLabel:a?void 0:s.ag._({id:"controls.annotations.label"}),mainLabel:(0,B.jsx)(eB.UG,{children:a||s.ag._({id:"controls.annotations.annotation.add.text"})}),icon:"text",rightIcon:(0,B.jsx)(p.Z,{component:"span",color:"text.primary",children:(0,B.jsx)(eq.JO,{name:"pen"})}),value:l,onClick:c})},ty=e=>{let{chartConfig:t}=e;return(0,B.jsx)(eD.xh,{label:s.ag._({id:"controls.section.data.filters.default-open"}),field:null,path:"interactiveFiltersConfig.dataFilters.defaultOpen",disabled:!t.interactiveFiltersConfig.dataFilters.active})};var tv=r(71023),tj=r(24568),tx=r(31091),tC=r.n(tx),tO=r(60227),tw=r(3615),tI=r(96373),tS=r(58290),tP=r(3834),tk=r(91631),t_=r(40749),tT=r(71335),tD=r(3390),tZ=r(26398),tE=r(83864),tM=r.n(tE),tA=r(68717),tL=r(35957),tF=r(30583),tN=r(75202),tR=r(79171),tG=r(24157);let tV=(e,t)=>{let{0:r,1:n}=(0,x.useState)(()=>{let r=localStorage.getItem(e);return r?JSON.parse(r):t});return(0,x.useEffect)(()=>{localStorage.setItem(e,JSON.stringify(r))},[e,r]),[r,(0,x.useCallback)(e=>{n(e)},[])]},t$=()=>{let[e,t]=tV("add-dataset-caution-alert",!0);return{isOpen:e,open:(0,x.useCallback)(()=>t(!0),[t]),close:(0,x.useCallback)(()=>t(!1),[t])}},tU=e=>{let{onConfirm:t}=e;return(0,B.jsxs)(Q.m0,{children:[(0,B.jsx)(o.cC,{id:"dataset.search.caution.body"}),(0,B.jsx)(u.Z,{sx:{mt:1},children:(0,B.jsx)(l.Z,{onClick:e=>{e.preventDefault(),t()},href:"#",children:(0,B.jsx)(o.cC,{id:"dataset.search.caution.acknowledge"})})})]})};var tz=r(98784),tB=r(64103),tH=r(17510),tW=r(50726);function tY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function tK(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tY(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tY(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let tq=(e,t)=>{let r=e.type;switch(r){case"temporal":return t?.find(t=>tB.kj(t,e.timeUnit));case"shared":return t?.find(t=>t.termsets.some(t=>e.termsets.map(e=>e.iri).includes(t.iri)));default:return r}},tX=(e,t)=>{let r=e.map(e=>{let r=tq(e,t?.dimensions);if(!r)return console.log("No dimension found for option",e),{};let n=(0,tz.groupBy)(e.originalIds,e=>e.cubeIri);return tK(tK({},(0,tz.mapValues)(n,e=>e.map(e=>e.dimensionId))),{},{[t.iri]:[r?.id].filter(tH.y)})}).reduce((e,t)=>(Object.entries(t).forEach(t=>{let[r,n]=t;e[r]||(e[r]=[]),n&&e[r].push(...n)}),e),{});return(0,tW.i3)(r)};var tJ=r(7050),tQ=r(62033),t0=r(58144),t1=r(18170),t2=r(56571),t4=r(58009),t3=r(27979),t7=r(47434),t6=r(99825),t5=r.n(t6),t9=r(28002),t8=r(55145),re=r(34703),rt=r(16471),rr=r(40625),rn=r(46297);let ri=(0,P.Z)(e=>({addButton:{transition:"opacity 0.25s ease"},dialog:{"--dialog-padding":"60px",[`& .${t8.Z.root}`]:{padding:"var(--dialog-padding)",paddingBottom:0},[`& .${re.Z.root}`]:{padding:"var(--dialog-padding)",paddingTop:"2rem"},[`& .${rt.Z.root}`]:{padding:"var(--dialog-padding)",paddingTop:0},[`& .${rr.Z.paper}`]:{minHeight:"calc(100vh - calc(30px * 2))"}},dialogCloseArea:{position:"absolute",top:"1rem",right:"1rem",display:"flex",gap:"0.5rem",alignItems:"center"},newAnnotation:{color:e.palette.success.main},listTag:{whiteSpace:"break-spaces"},listItemSecondary:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:1,paddingTop:e.spacing(1)},previewSelect:{width:302},previewSelectPaper:{[`& .${rn.Z.root}`]:{marginTop:"0.25rem"}}}));var ro=r(45298);function rs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ra(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rs(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rs(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rl=e=>{let t=ri();return(0,B.jsx)(p.Z,ra(ra({className:(0,k.Z)(t.newAnnotation,e.className),lineHeight:1,variant:"caption"},e),{},{children:(0,B.jsx)(o.cC,{id:"dataset.search.preview.new-dimension"})}))},rc=e=>{let{chartConfig:t,dataSource:r,existingCubes:n,currentComponents:i,inferredJoinBy:s,otherCube:a,onClickBack:l,onConfirm:d,addingDataset:f}=e,h=(0,es.bU)(),g={sourceType:r.type,sourceUrl:r.url,locale:h},[b]=(0,ro.Dl)({variables:ra(ra({},g),{},{cubeFilter:{iri:a.iri}}),pause:!a}),y=b.data?.dataCubeComponents,v=b.fetching,j=(0,tW.CX)(s),[C]=(0,ei.XO)({chartConfig:t,variables:{locale:h,sourceType:r.type,sourceUrl:r.url,cubeFilters:j},pause:!y||!i}),[O]=(0,ei.bi)({variables:{sourceType:r.type,sourceUrl:r.url,locale:h,cubeFilters:n.map(e=>({iri:e.iri}))}}),w=v||C.fetching||O.fetching,I=(0,x.useMemo)(()=>{let e=e=>!(0,tB.zS)(e),t=(i?.dimensions??[]).filter(t=>e(t)),r=(i?.measures??[]).filter(t=>e(t)),n=(y?.dimensions??[]).filter(t=>e(t)),o=(y?.measures??[]).filter(t=>e(t)),l=(0,tW.rF)({dimensions:[...t,...n],joinBy:s}),{join:c=[],other:d=[],current:u=[]}=e6()(l,e=>(0,tB.P9)(e)?"join":e.cubeIri===a.iri?"other":"current");return[...c,...d,...o,...u,...r]},[i?.dimensions,i?.measures,s,a.iri,y?.dimensions,y?.measures]),{0:S,1:P}=(0,x.useState)(void 0);(0,x.useEffect)(()=>{y?.dimensions&&y.measures&&void 0===S&&P(I.map(e=>e.id))},[I,y?.dimensions,y?.measures,S]);let k=(0,x.useMemo)(()=>S??[],[S]),_=(0,x.useMemo)(()=>Object.fromEntries(k.map(e=>[e,!0])),[k]),T=(0,x.useMemo)(()=>{let e=C.data?.dataCubesObservations.data??[],t=t5()(e,e=>I.reduce((t,r)=>t+(e[r.id]?1:0),0)),r=Math.max(0,Math.min(t?e.indexOf(t):0,e.length-8));return e.slice(r,r+8)},[I,C.data?.dataCubesObservations.data]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(tI.Z,{sx:{overflowX:"hidden"},children:[(0,B.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,B.jsx)(p.Z,{variant:"h2",children:(0,B.jsx)(o.cC,{id:"dataset.search.preview.title"})}),(0,B.jsx)(p.Z,{variant:"body1",children:(0,B.jsx)(o.cC,{id:"dataset.search.preview.description"})}),(0,B.jsxs)("div",{children:[(0,B.jsx)(p.Z,{variant:"h6",mb:1,children:(0,B.jsx)(o.cC,{id:"dataset.search.preview.datasets"})}),(0,B.jsxs)(tQ.Z,{direction:"column",spacing:1,children:[(0,B.jsx)(p.Z,{variant:"caption",children:O.data?.dataCubesMetadata.map(e=>e.title).join(", ")}),(0,B.jsxs)("div",{children:[(0,B.jsx)(rl,{}),(0,B.jsx)("br",{}),(0,B.jsx)(p.Z,{variant:"caption",mt:-1,component:"div",children:a.title})]})]})]}),w?(0,B.jsx)(Q.gb,{delayMs:0}):null,C.error?(0,B.jsx)(Q.jj,{children:(0,B.jsxs)(u.Z,{component:"details",sx:{width:"100%",cursor:"pointer"},children:[(0,B.jsx)("summary",{children:C.error.name}),C.error.message]})}):null]}),y?(0,B.jsx)(B.Fragment,{children:C.data?.dataCubesObservations?(0,B.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:2},children:[(0,B.jsx)(u.Z,{sx:{overflowX:"scroll",width:"100%",mt:6,mb:4,boxShadow:4},children:(0,B.jsxs)(t0.Z,{children:[(0,B.jsx)(t1.Z,{children:(0,B.jsx)(t2.Z,{children:I.map(e=>_[e.id]?(0,B.jsxs)(t4.Z,{sx:{minWidth:200,maxWidth:300},children:[e.cubeIri===a.iri&&(0,B.jsx)(rl,{}),(0,tB.P9)(e)?(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(c.Z,{arrow:!0,title:(0,B.jsx)(B.Fragment,{children:e.originalIds.map(e=>e.description).join(", ")}),placement:"right",children:(0,B.jsx)(tR.V,{type:"dimension",children:"Joined"})})}):null,(0,B.jsx)("br",{}),(0,B.jsx)(p.Z,{variant:"h5",children:e.label})]},e.id):null)})}),(0,B.jsx)(t3.Z,{children:T.map((e,t)=>(0,B.jsx)(t2.Z,{children:I.map(t=>_[t.id]?(0,B.jsx)(t4.Z,{children:e[t.id]},t.id):null)},t))})]})}),(0,B.jsx)(t9.C,{})]}):null}):null]}),(0,B.jsx)(t7.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1,px:4,pt:"0 !important",pb:"2rem !important"},children:(0,B.jsxs)(u.Z,{sx:{display:"flex",gap:2},children:[(0,B.jsx)(m.Z,{variant:"outlined",onClick:l,children:(0,B.jsx)(o.cC,{id:"button.back"})}),(0,B.jsx)(tJ.Z,{loading:f,variant:"contained",onClick:d,children:(0,B.jsx)(o.cC,{id:"button.confirm"})})]})})]})};var rd=r(55847);function ru(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function rp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ru(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ru(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rm=()=>{let{0:e,1:t}=(0,x.useState)({fetching:!1,otherIri:null}),[r,n]=(0,eF.lY)(eF.N3),{type:i,url:o}=r.dataSource,s=(0,es.bU)(),l=(0,C.m8)();return[e,{addDataset:(0,a.Z)(async e=>{let{otherCube:a,joinBy:c}=e,d=a.iri;t(e=>rp(rp({},e),{},{fetching:!0,otherIri:d}));try{let e={iri:d,joinBy:c},t=structuredClone(r);(0,eF.m)(t,e);let a=(0,er.f6)(t,r.activeChartKey),u=await (0,ei.xw)(l,{locale:s,sourceType:i,sourceUrl:o,cubeFilters:a.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy,componentIds:void 0,loadValues:!0}))});if(u.error||!u.data)throw Error("Could not fetch dimensions and measures");n({type:"DATASET_ADD",value:e});let{dimensions:p,measures:m}=u.data.dataCubesComponents,{enabledChartTypes:f}=(0,rd.ru)({dimensions:p,measures:m,cubeCount:a.cubes.length});n({type:"CHART_TYPE_CHANGED",value:{locale:s,chartKey:r.activeChartKey,chartType:f[0],isAddingNewCube:!0}})}finally{t(e=>rp(rp({},e),{},{fetching:!1,otherIri:null}))}})}]};var rf=r(17703),rh=r(69763),rg=r(42394),rb=r(44863);let ry=["state"];function rv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function rj(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rv(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rv(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rx=e=>(0,B.jsx)(e2.Z,rj(rj({},e),{},{sx:rj({position:"absolute",top:"1.5rem",right:"1.5rem"},e.sx),children:(0,B.jsx)(rh.Z,{width:24,height:24,fontSize:24})})),rC=(e,t)=>{let r=e.filter(tB.aw)??[],n=t??[],i=e6()(n,e=>e.termsets[0].iri),o=n.map(e=>e.iri),s=new Set;return[...r.filter(e=>!o.includes(e.id)).map(e=>({type:"temporal",id:e.id,originalIds:e.originalIds??[{cubeIri:e.cubeIri,dimensionId:e.id}],label:e.label,timeUnit:e.timeUnit})),...n.map(e=>{let t=(0,rf.O1)(e.iri),r=e.termsets[0].iri,n=s.has(r);if(!t||n)return;s.add(r);let o=i[r],a=o.map(e=>e.label).join(", "),l=o.map(e=>({cubeIri:e.cubeIri,dimensionId:e.iri}));return{type:"shared",id:e.iri,label:a,termsets:e.termsets,originalIds:l}}).filter(tH.y)]},rO=e=>{let{state:t,locale:r,pause:n}=e,i={sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,locale:r},o=t.chartConfigs.find(e=>e.key===t.activeChartKey);if(!o)throw Error("Could not find active chart config");let s=o.cubes,[a]=(0,ei.k$)({chartConfig:o,variables:rj(rj({},i),{},{cubeFilters:s.map(e=>({iri:e.iri,joinBy:e.joinBy}))}),pause:n}),[l]=(0,ei.Tk)({pause:n,variables:{locale:r,sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,cubeFilters:s.map(e=>({iri:e.iri}))}});return{components:a.data?.dataCubesComponents,dimensions:a.data?.dataCubesComponents.dimensions??[],termsets:l.data?.dataCubeComponentTermsets??[],fetching:a.fetching||l.fetching,ready:void 0!==a.data&&void 0!==l.data}},rw=e=>"temporal"===e.type,rI=e=>"shared"===e.type,rS=e=>{let{state:t}=e,r=(0,i.Z)(e,ry),n=(0,es.bU)(),l=ri(),{0:c,1:f}=(0,x.useState)(""),{0:h,1:g}=(0,x.useState)(ro.SearchCubeResultOrder.Score),{0:b,1:y}=(0,x.useState)(!1),v=t.chartConfigs.find(e=>e.key===t.activeChartKey);if(!v)throw Error("Could not find active chart config");let j=v.cubes,{dimensions:C,termsets:O,components:w,ready:I,fetching:S}=rO({state:t,locale:n,pause:!r.open}),{0:P,1:k}=(0,x.useState)(),[{fetching:_},{addDataset:T}]=rm(),{searchDimensionOptions:D,searchDimensionOptionsById:Z}=(0,x.useMemo)(()=>{let e=rC(C,O);return{searchDimensionOptions:e,searchDimensionOptionsById:tM()(e,e=>e.id)}},[C,O]),{0:E,1:M}=(0,x.useState)(void 0);(0,x.useEffect)(()=>{void 0===E&&O&&w&&M(D)},[w,D,E,O]);let A=E?.filter(rI),L=(E??[]).find(rw),F=!I||!E?.length,[N]=(0,ro.kY)({variables:{sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,locale:n,query:c,order:h,includeDrafts:b,fetchDimensionTermsets:!0,filters:[L?{type:ro.r4.TemporalDimension,value:L.timeUnit}:null,A&&A.length>0?{type:ro.r4.DataCubeTermset,value:ti()(A.flatMap(e=>e.termsets.map(e=>e.iri))).join(";")}:null].filter(tH.y)},pause:F}),R=(0,x.useMemo)(()=>{let e=j.map(e=>e.iri);return N.data?.searchCubes.filter(t=>!e.includes(t.cube.iri))??[]},[j,N.data?.searchCubes]),G=(0,x.useMemo)(()=>1===j.length?R:R.filter(e=>{let t=tX(E??[],e.cube)[e.cube.iri];return(t&&t.length===E?.length)??0}),[R,j,E]),$=(0,a.Z)((e,t)=>{r.onClose?.(e,t),f(""),M(void 0),k(void 0)}),U=e=>{k(e)},{isOpen:z,open:H,close:W}=t$(),Y=(0,rb.x)(),K=(0,x.useMemo)(()=>P?tX(E??[],P):void 0,[E,P]),X=(0,a.Z)(async()=>{if(!w||!P||!K)return null;await T({joinBy:K,otherCube:P}),$({},"escapeKeyDown"),setTimeout(()=>{Y.emit("dataset-added",{datasetIri:P.iri})},100)}),J=(0,x.useRef)(),Q=(0,a.Z)(e=>{"Enter"===e.key&&f(e.currentTarget.value)}),ee=(0,a.Z)(()=>{f("")});return(0,B.jsxs)(eK.gl,rj(rj({},r),{},{onClose:$,children:[(0,B.jsxs)(u.Z,{className:l.dialogCloseArea,children:[P?null:(0,B.jsx)(d.Z,{in:!z,children:(0,B.jsx)("div",{children:(0,B.jsx)(e2.Z,{onClick:()=>H(),children:(0,B.jsx)(rg.Z,{})})})}),(0,B.jsx)(rx,{onClick:e=>$(e,"escapeKeyDown"),sx:{position:"static"}})]}),P?null:(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(tw.Z,{sx:{typography:"h2"},children:s.ag._({id:"chart.datasets.add-dataset-dialog.title"})}),(0,B.jsxs)(tI.Z,{children:[(0,B.jsx)(tS.Z,{in:z,children:(0,B.jsx)(u.Z,{sx:{mb:4},children:(0,B.jsx)(tU,{onConfirm:W})})}),(0,B.jsx)(p.Z,{variant:"body1",mb:"2rem",children:(0,B.jsx)(o.cC,{id:"chart.datasets.add-dataset-dialog.description"})}),(0,B.jsxs)(u.Z,{display:"flex",alignItems:"center",gap:"0.5rem",mb:"1rem",children:[(0,B.jsx)(tP.Z,{id:"search",inputProps:{ref:J},defaultValue:c,placeholder:s.ag._({id:"dataset.search.placeholder"}),autoComplete:"off",onKeyDown:Q,endAdornment:""!==c?(0,B.jsxs)(tk.Z,{"data-testid":"clearSearch",onClick:ee,children:[(0,B.jsx)(tG.T,{children:(0,B.jsx)(o.cC,{id:"controls.search.clear"})}),(0,B.jsx)(eq.JO,{name:"close"})]}):(0,B.jsxs)(tk.Z,{"data-testid":"submitSearch",type:"submit",children:[(0,B.jsx)(tG.T,{children:(0,B.jsx)(o.cC,{id:"dataset.search.label"})}),(0,B.jsx)(eq.JO,{name:"search"})]}),sx:{width:"50%"}},c),(0,B.jsx)(t_.Z,{multiple:!0,value:(E??[]).map(e=>e.id),onChange:e=>{let{target:{value:t}}=e;M(("string"==typeof t?t.split(","):t)?.map(e=>Z[e]).filter(tH.y))},renderValue:e=>S?(0,B.jsx)(V.Z,{size:12}):0===e.length?(0,B.jsx)(p.Z,{variant:"body2",children:s.ag._({id:"dataset.search.search-options.no-options-selected"})}):e.map((t,r)=>{let n=Z[t];return r<2?(0,B.jsx)(tR.V,{type:"dimension",sx:{py:0,mr:2},children:n.label},n.id):2===r?(0,B.jsx)(tR.V,{type:"dimension",sx:{py:0,mr:2},children:(0,B.jsx)(o.cC,{id:"dataset.search.search-options.more-2-options-selected",values:{0:e.length-2}})},"more"):null}),sx:{width:"50%"},children:D.map(e=>(0,B.jsxs)(e3.Z,{value:e.id,sx:{gap:2,backgroundColor:"transparent !important","&:hover":{backgroundColor:e=>`${e.palette.cobalt[50]} !important`}},children:[(0,B.jsx)(tT.Z,{checked:E&&!!E.find(t=>t.id===e.id)}),(0,B.jsx)(tD.Z,{primary:(0,B.jsx)(tR.V,{type:"dimension",children:e.label})})]},e.label))}),(0,B.jsx)(m.Z,{style:{minWidth:"fit-content"},onClick:()=>{J.current&&f(J.current.value)},children:s.ag._({id:"dataset.search.label"})})]}),(0,B.jsxs)(q.k,{sx:{justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,B.jsx)(tF.G,{cubes:G}),(0,B.jsxs)(q.k,{sx:{alignItems:"center",gap:5},children:[(0,B.jsx)(tL.l,{checked:b,onChange:y}),(0,B.jsx)(tZ.Z,{flexItem:!0,orientation:"vertical"}),(0,B.jsx)(tN.n,{value:h,onChange:g})]})]}),E?.length===0?(0,B.jsx)(p.Z,{variant:"body1",children:(0,B.jsx)(o.cC,{id:"dataset.search.at-least-one-compatible-dimension-selected"})}):(0,B.jsx)(tA._,{cubes:G,fetching:N.fetching||S,error:N.error,datasetResultProps:e=>{let{cube:t}=e;return{disableTitleLink:!1,showDimensions:!0,showTags:!0,onClickTitle:e=>{e.preventDefault(),U(t)}}}})]})]}),P&&K?(0,B.jsx)(rc,{chartConfig:v,dataSource:t.dataSource,currentComponents:w,existingCubes:j,otherCube:P,inferredJoinBy:K,addingDataset:_,onConfirm:X,onClickBack:()=>k(void 0),searchDimensionsSelected:E??[]},P.iri):null]}))};var rP=r(54882);function rk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function r_(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rk(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rT=(0,P.Z)(e=>({row:{borderLeft:"0.25rem solid transparent",paddingLeft:"0.25rem",marginLeft:"-0.5rem",transition:"border-left-color 1s ease",display:"flex",justifyContent:"space-between"},added:{transition:"border-left-color 0.25s ease",borderLeftColor:e.palette.success.main},tooltipPopper:{[`& .${tj.Z.tooltip}`]:{maxWidth:"none",padding:"0.75rem",backgroundColor:e.palette.success.light,color:e.palette.success.main,lineHeight:1.5,whiteSpace:"nowrap"},[`& .${tj.Z.arrow}`]:{color:e.palette.success.light}}})),rD=e=>{let{canRemove:t,handleDatasetClick:r,cube:n,added:i,onRemoveAdded:a}=e,l=(0,es.bU)(),c=(0,C.m8)(),d=rT(),[f,h]=(0,eF.lY)(eF.N3),{0:g,1:b}=(0,x.useState)(!1);return(0,B.jsx)(tO.E,{title:(0,B.jsxs)(u.Z,{alignItems:"center",display:"flex",gap:"0.75rem",children:[(0,B.jsx)(u.Z,{color:"success.main",children:(0,B.jsx)(eq.JO,{name:"checkmarkCircle"})}),s.ag._({id:"dataset.search.preview.added-dataset"})]}),tooltipProps:{open:i,placement:"right",PopperProps:{onClick:()=>a?.(),className:d.tooltipPopper}},children:(0,B.jsxs)("div",{className:(0,k.Z)(d.row,{[d.added]:i}),children:[(0,B.jsxs)(q.k,{sx:{flexDirection:"column",alignItems:"flex-start",gap:1},children:[(0,B.jsx)(m.Z,{variant:"text",color:"primary",size:"sm",onClick:r,children:(0,B.jsx)(o.cC,{id:"dataset.footnotes.dataset"})}),(0,B.jsx)(p.Z,{variant:"body3",children:n.title})]}),(0,B.jsx)("div",{children:t?(0,B.jsx)(e2.Z,{disabled:g,onClick:async()=>{try{let e=(0,er.f6)(f).cubes.filter(e=>e.iri!==n.iri);await (0,ei.xw)(c,{locale:l,sourceUrl:f.dataSource.url,sourceType:f.dataSource.type,cubeFilters:e.map(t=>({iri:t.iri,joinBy:e.length>1?t.joinBy:void 0,loadValues:!0}))}),h({type:"DATASET_REMOVE",value:{locale:l,iri:n.iri}})}catch(e){console.error(e)}finally{b(!1)}},sx:{padding:2,transform:"translate(8px, -8px)"},children:(0,B.jsx)(rP.Z,{})}):null})]},n.iri)})},rZ=()=>{let[e]=(0,eF.lY)(eF.N3),t=(0,es.bU)(),r={sourceType:e.dataSource.type,sourceUrl:e.dataSource.url,locale:t},{setOpen:n,setActiveSection:i}=(0,ee._z)(),a=(0,x.useMemo)(()=>{let t=e.chartConfigs.find(t=>t.key===e.activeChartKey);return tC()(t?.cubes??[],e=>e.iri)},[e.activeChartKey,e.chartConfigs]),[l]=(0,ei.bi)({variables:r_(r_({},r),{},{cubeFilters:a.map(e=>({iri:e.iri}))})}),{isOpen:c,open:d,close:u}=(0,eH.q)(),{0:p,1:f}=(0,x.useState)(null);(0,rb.x)("dataset-added",e=>{setTimeout(()=>{f(e.datasetIri)},300),setTimeout(()=>{f(null)},5e3)});let h=()=>{n(!0),i("general")};return(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-data",collapse:!0,defaultExpanded:!0,hideTopBorder:!0,children:[(0,B.jsxs)(ek.NZ,{id:"controls-data",children:[(0,B.jsx)(o.cC,{id:"controls.section.datasets.title"})," ",(0,B.jsx)(tm,{sx:{ml:"auto",mr:2}})]}),(0,B.jsxs)(ek.kc,{"data-testid":"configurator-datasets",children:[(0,B.jsx)(q.k,{sx:{flexDirection:"column",gap:6},children:l.data?.dataCubesMetadata.map(e=>B.jsx(rD,{handleDatasetClick:h,canRemove:a.length>1,added:p===e.iri,cube:e},e.iri))}),(0,B.jsx)(q.k,{sx:{justifyContent:"end"},children:(0,B.jsx)(m.Z,{variant:"text",size:"sm",color:"primary",startIcon:(0,B.jsx)(eq.JO,{name:"plus",size:20}),onClick:d,children:s.ag._({id:"chart.datasets.add"})})}),(0,B.jsx)(rS,{state:e,open:c,onClose:u})]})]})};var rE=r(52109),rM=r(23733);function rA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let rL=e=>{let{state:t}=e,{dataSource:r}=t,i=(0,er.f6)(t),{fields:s}=i,a=(0,es.bU)(),[{data:l}]=(0,ei.k$)({chartConfig:i,variables:{sourceType:r.type,sourceUrl:r.url,locale:a,cubeFilters:i.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy,loadValues:!0}))}});if(!l?.dataCubesComponents)return(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-interactive-filters",collapse:!0,defaultExpanded:!1,children:[(0,B.jsx)(ek.NZ,{id:"controls-interactive-filters",children:(0,B.jsx)(o.cC,{id:"controls.section.interactive.filters"})}),(0,B.jsx)(ek._Q,{showTitle:!1,sx:{mt:0}})]});{let{dimensions:e,measures:t}=l.dataCubesComponents,r=[...e,...t].find(e=>e.id===(0,rd.iv)(s,"animation"));return(0,eP.Ab)(i)?(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-interactive-filters",collapse:!0,defaultExpanded:!1,children:[(0,B.jsx)(ek.NZ,{id:"controls-interactive-filters",children:(0,B.jsx)(o.cC,{id:"controls.section.interactive.filters"})}),(0,B.jsx)(ek.kc,{gap:"none",px:"none",children:(0,B.jsx)(eD.lb,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rA(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rA(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({chartConfig:i,fieldComponents:r?[r]:[],value:"animation",labelId:null},ts.Fe.getDisabledState?.(i,e,[])))})]}):null}};var rF=r(95428);function rN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function rR(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rN(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rN(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rG=e=>{let{rawDimension:t,filterDimensionIds:r,index:n,disabled:i,onRemove:o,sideControls:s,disableLabel:a}=e,l=(0,es.bU)(),[c]=(0,eF.lY)(),d=(0,er.f6)(c),[{data:u,fetching:m}]=(0,ei.k$)({chartConfig:d,variables:{sourceType:c.dataSource.type,sourceUrl:c.dataSource.url,locale:l,cubeFilters:d.cubes.map(e=>{let n=te()(e.filters,(e,t)=>r.includes(t));return{iri:e.iri,joinBy:e.joinBy,componentIds:[t.id],filters:Object.keys(n).length>0?n:void 0,loadValues:!0}})},keepPreviousData:!0}),f=u?.dataCubesComponents?.dimensions.find(e=>e.cubeIri===t.cubeIri)??t,h={dimension:f,label:a?null:(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(tl.K,{component:f,children:(0,B.jsx)(p.Z,{variant:"caption",children:`${n+1}. ${f.label}`})}),(0,B.jsxs)(q.k,{sx:{alignSelf:"flex-end",alignItems:"center",gap:1,marginRight:s&&f.isKeyDimension?7:0},children:[(0,B.jsx)(rB,{id:f.id}),f.isKeyDimension?null:(0,B.jsx)(e2.Z,{disabled:i,size:"small",onClick:o,sx:{p:0,transform:"translateY(-5%)"},children:(0,B.jsx)(eq.JO,{name:"trash",size:16})})]})]}),sideControls:s,id:`select-single-filter-${n}`,disabled:m||i,optional:!f.isKeyDimension,loading:m};return(0,tB.fF)(f)&&(0,rE.H)(f.timeUnit)?(0,B.jsx)(eD.tW,rR(rR({},h),{},{dimension:f,timeUnit:f.timeUnit})):(0,B.jsx)(eD.HN,rR(rR({},h),{},{hierarchy:f.hierarchy}))},rV=e=>{let{state:t}=e,[,r]=(0,eF.lY)(),n=(0,er.f6)(t),{0:i,1:o}=(0,x.useState)(!1),{0:s,1:a}=(0,x.useState)(),l=(0,x.useRef)({}),c=(0,C.m8)(),d=(0,x.useMemo)(()=>n.cubes.flatMap(e=>e.joinBy).filter(tH.y),[n.cubes]);return(0,x.useEffect)(()=>{(async()=>{n.cubes.forEach(async e=>{let{mappedFilters:i,unmappedFilters:s}=(0,eF.AF)(n,{cubeIri:e.iri,joinByIds:d});if((0,ta.l)(l.current[e.iri],s))return;l.current[e.iri]=s,o(!0);let u=(0,ta.B)({cubeIri:e.iri,dataSource:t.dataSource,unmappedFilters:s}),{data:p,error:m}=await c.query(ro.UK,u).toPromise();if(m||!p){a(m),o(!1),console.error("Could not fetch possible filters",m);return}a(void 0),o(!1);let f=Object.assign(Object.fromEntries(p.possibleFilters.map(e=>[e.id,{type:e.type,value:e.value}])),i),h=(0,er.jW)(n.cubes,{cubeIri:e.iri});for(let[e,t]of Object.entries(h))"single"===t.type&&(0,rF.U)(t.value)&&f[e]&&(f[e]={type:"single",value:`${t.value}`});e$()(f,h)||e9()(f)||r({type:"CHART_CONFIG_FILTERS_UPDATE",value:{cubeIri:e.iri,filters:f}})})})()},[c,r,n,n.cubes,t.dataSource,d]),{error:s,fetching:i}},r$=(e,t)=>{let{joinByIds:r}=t;return e.cubes.map(t=>{let{iri:n,joinBy:i}=t,{unmappedFilters:o}=(0,eF.AF)(e,{cubeIri:n,joinByIds:r});return{iri:n,filters:Object.keys(o).length>0?o:void 0,joinBy:i,loadValues:!0}})},rU=function(){let{onAddDimensionFilter:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,eF.lY)(eF.N3),n=(0,er.f6)(t),i=(0,es.bU)(),o=(0,er.jW)(n.cubes,{joined:!0}),s=(0,x.useMemo)(()=>n.cubes.flatMap(e=>e.joinBy).filter(tH.y),[n.cubes]),{mappedFiltersIds:a}=(0,x.useMemo)(()=>(0,eF.AF)(n,{joinByIds:s}),[n,s]),l=(0,x.useMemo)(()=>{let e=r$(n,{joinByIds:s}),t=e.reduce((e,t)=>`${e}${t.iri}${JSON.stringify(t.filters)}`,"");return{cubeFilters:e,reQueryKey:t||void 0}},[n,s]),[{data:c,fetching:d},u]=(0,ei.k$)({chartConfig:n,variables:rR({sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,locale:i},l),keepPreviousData:!0});(0,x.useEffect)(()=>{u({variables:rR({sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,locale:i},l)})},[l,u,t.dataSource.type,t.dataSource.url,i]);let p=c?.dataCubesComponents?.dimensions,m=c?.dataCubesComponents?.measures,f=(0,eE.z)((e,t)=>{if(!p||!m)return;let i=p.find(t=>t.id===e);i&&r({type:"CHART_CONFIG_REPLACED",value:{chartConfig:(0,eF.xk)(n,{dimension:i,delta:t,possibleValues:i?i.values.map(e=>e.value):[]}),dataCubesComponents:{dimensions:p,measures:m}}})}),h=(0,eE.z)(t=>{e?.();let n=t.values[0];r({type:"FILTER_SET_SINGLE",value:{filters:(0,eD.G3)(t),value:`${n.value}`}})}),g=(0,eE.z)(e=>{r({type:"FILTER_REMOVE_SINGLE",value:{filters:(0,eD.G3)(e)}})}),b=(0,eE.z)(e=>{let t=e.source?.index,r=e.destination?.index;"number"==typeof t&&"number"==typeof r&&e.source!==e.destination&&f(e.draggableId,r-t)}),{fetching:y}=rV({state:t}),{filterDimensions:v,filterDimensionsByCubeIri:j,addableDimensions:C,addableDimensionsByCubeIri:O,missingDimensions:w}=(0,x.useMemo)(()=>{let e=Object.fromEntries(Object.keys(o).map((e,t)=>[e,t])),t=tr()(p?.filter(t=>!a.has(t.id)&&void 0!==e[t.id])??[],[t=>e[t.id]??1/0]),r=e6()(t,e=>e.cubeIri);for(let e of ti()(p?.map(e=>e.cubeIri)))r[e]||(r[e]=[]);let n=p?.filter(t=>!a.has(t.id)&&void 0===e[t.id]&&!tB.zS(t))??[],i=e6()(n,e=>e.cubeIri),s=p?.filter(e=>e.isKeyDimension&&n?.includes(e));return{filterDimensions:t,filterDimensionsByCubeIri:r,addableDimensions:n,addableDimensionsByCubeIri:i,missingDimensions:s}},[p,o,a]);return(0,x.useEffect)(()=>{w&&w.length>0&&w.forEach(h)},[h,w]),{handleRemoveDimensionFilter:g,handleAddDimensionFilter:h,handleDragEnd:b,fetching:y||d,dimensions:p,measures:m,filterDimensions:v,filterDimensionsByCubeIri:j,addableDimensions:C,addableDimensionsByCubeIri:O}},rz=(0,P.Z)(e=>({loadingIndicator:{color:e.palette.grey[700],display:"inline-block",marginLeft:8},filterRow:{overflow:"hidden",width:"100%",marginBottom:e.spacing(5),"& > *":{overflow:"hidden"},"&:last-child":{marginBottom:0}},addDimensionContainer:{"& .menu-button":{background:"transparent",border:0,padding:0}}})),rB=e=>{let{id:t}=e,{checked:r,onChange:n}=(0,rM._y)(t);return(0,B.jsx)(X.rs,{size:"sm",label:s.ag._({id:"controls.filters.interactive.toggle"}),checked:r,onChange:n})},rH=e=>{let{state:t}=e,r=(0,es.bU)(),n=(0,er.f6)(t),[{data:i,fetching:s,error:a}]=(0,ei.bi)({variables:{sourceType:t.dataSource.type,sourceUrl:t.dataSource.url,locale:r,cubeFilters:n.cubes.map(e=>({iri:e.iri}))},pause:1===n.cubes.length}),l=i?.dataCubesMetadata,{fetching:c,handleRemoveDimensionFilter:d,handleDragEnd:m,dimensions:f,measures:h,filterDimensions:g,filterDimensionsByCubeIri:b,addableDimensions:y,addableDimensionsByCubeIri:v}=rU(),{fetching:j,error:C}=rV({state:t}),O=j||c||s,w=rz({fetching:O}),I=(0,x.useMemo)(()=>[...f??[],...h??[]],[f,h]);return 0===I.length?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(ek._Q,{}),(0,B.jsx)(ek._Q,{})]}):(0,B.jsxs)(ea.Zg,{chartConfigKey:n.key,children:[(0,B.jsx)(rZ,{}),(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-chart-type",collapse:!0,children:[(0,B.jsx)(ek.NZ,{id:"controls-chart-type",children:(0,B.jsx)(o.cC,{id:"controls.select.chart.type"})}),(0,B.jsx)(ek.kc,{children:(0,B.jsx)(tv.M,{showHelp:!1,chartKey:n.key,state:t})})]}),(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-chart-options",collapse:!0,children:[(0,B.jsx)(ek.NZ,{id:"controls-chart-options",children:(0,B.jsx)(o.cC,{id:"controls.section.chart.options"})}),(0,B.jsx)(ek.kc,{gap:"none",px:"none",role:"tablist",children:(0,B.jsx)(rY,{dataSource:t.dataSource,chartConfig:n,dashboardFilters:t.dashboardFilters,dimensions:f,measures:h})})]}),0===g.length&&y&&0===y.length?null:(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsxs)(ek.NZ,{id:"controls-data",children:[(0,B.jsx)(o.cC,{id:"controls.section.data.filters"})," ",O?(0,B.jsx)(V.Z,{size:12,className:w.loadingIndicator}):null,(0,B.jsx)(tp,{sx:{ml:"auto",mr:2}})]}),(0,B.jsxs)(ek.kc,{"aria-labelledby":"controls-data","data-testid":"configurator-filters",children:[a||C?(0,B.jsx)(p.Z,{variant:"body2",color:"error",children:(0,B.jsx)(o.cC,{id:"controls.section.data.filters.possible-filters-error"})}):null,0===g.length?(0,B.jsx)(p.Z,{variant:"body2",color:"text.secondary",sx:{mb:-4},children:(0,B.jsx)(o.cC,{id:"controls.section.data.filters.none"})}):(0,B.jsx)(u.Z,{sx:{my:2},children:(0,B.jsx)(ty,{chartConfig:n})}),Object.entries(b).sort((e,t)=>(0,tW.hm)(e[0])?-1:(0,tW.hm)(t[0])?1:e[0].localeCompare(t[0])).map(e=>{let[t,r]=e,n=l?.find(e=>e.iri===t)?.title,i=v[t];return r.length>0?(0,B.jsxs)(x.Fragment,{children:[(0,B.jsxs)(u.Z,{sx:{py:2},children:[n?(0,B.jsx)(p.Z,{variant:"caption",component:"p",sx:{mb:3,color:"text.secondary"},children:n}):null,(0,B.jsx)(to.Z5,{onDragEnd:m,children:(0,B.jsx)(to.bK,{droppableId:"filters",children:e=>(0,B.jsxs)(u.Z,rR(rR({},e.droppableProps),{},{ref:e.innerRef,children:[r.map((e,r)=>(0,B.jsx)(to._l,{isDragDisabled:O,draggableId:e.id,index:r,children:n=>(0,B.jsx)("div",rR(rR(rR({ref:n.innerRef,className:w.filterRow},n.dragHandleProps),n.draggableProps),{},{children:(0,B.jsx)(rG,{rawDimension:e,filterDimensionIds:g.filter(e=>e.cubeIri===t).slice(0,r).map(e=>e.id),index:r,disabled:O,onRemove:()=>d(e),sideControls:(0,B.jsx)(tc,{})},e.id)}))},e.id)),e.placeholder]}))})})]}),i&&i.length>0?(0,B.jsx)(rW,{dims:i}):null]},t):null})]})]}),(0,B.jsx)(en.Dm,{}),(0,B.jsx)(tg,{}),"table"!==n.chartType&&(0,B.jsx)(rL,{state:t}),(0,B.jsx)(tl.U,{dataSource:t.dataSource,chartConfig:n,dashboardFilters:t.dashboardFilters,components:I,top:J.r,renderToggle:!1})]})},rW=e=>{let{dims:t}=e,r=(0,x.useRef)(null),{isOpen:n,open:i,close:s}=(0,eH.q)(),{handleAddDimensionFilter:a}=rU({onAddDimensionFilter:()=>s()}),l=rz({fetching:!1});return(0,B.jsxs)(u.Z,{className:l.addDimensionContainer,children:[(0,B.jsx)(m.Z,{variant:"outlined",size:"sm",ref:r,onClick:i,startIcon:(0,B.jsx)(eq.JO,{name:"plus",size:20}),children:(0,B.jsx)(o.cC,{id:"controls.add-filter"})}),(0,B.jsx)(e4.Z,{anchorEl:r.current,open:n,onClose:s,children:t.map(e=>(0,B.jsx)(e3.Z,{onClick:()=>a(e),children:e.label},e.id))})]})},rY=e=>{let{dataSource:t,chartConfig:r,dashboardFilters:n,dimensions:i,measures:s}=e,a=[...i??[],...s??[]],l=(0,I.n9)({chartConfig:r,dashboardFilters:n}),c=(0,es.bU)(),[{data:d}]=(0,ei.XO)({chartConfig:r,variables:{locale:c,sourceType:t.type,sourceUrl:t.url,cubeFilters:l}}),u=d?.dataCubesObservations?.data??[];return(0,B.jsx)(B.Fragment,{children:(0,ts.K0)(r).encodings.filter(e=>!e.hide).map(e=>{let{field:t,getDisabledState:n,idAttributes:i}=e,s=i.flatMap(e=>r.fields[t]?.[e]).filter(tH.y).map(e=>a.find(t=>e===t.id)).filter(tH.y),l=(0,eP.fD)(r)&&"baseLayer"===t,c=(0,eP.fD)(r)&&"customLayers"===t;return l?(0,B.jsx)(eD.O_,{value:t,icon:"baseLayer",label:(0,B.jsx)(o.cC,{id:"chart.map.layers.base"}),active:r.baseLayer.show},t):c?(0,B.jsx)(eD.O_,{value:t,icon:"customLayers",label:(0,B.jsx)(o.cC,{id:"chart.map.layers.custom-layers"}),active:r.baseLayer.show&&r.baseLayer.customLayers.length>0},t):(0,B.jsx)(eD.lb,rR({chartConfig:r,fieldComponents:(0,eP.fD)(r)&&"symbolLayer"===t?r.fields.symbolLayer?s:void 0:s,value:t,labelId:`${r.chartType}.${t}`},n?.(r,a,u)),t)})})};var rK=r(99729),rq=r.n(rK),rX=r(67018),rJ=r(10359);let rQ=e=>{let{field:t,path:r,component:n}=e,i=!(0,rJ.h0)(n);return(0,B.jsx)(eD.xh,{"data-testid":"use-abbreviations",label:(0,eZ.N)("abbreviations"),field:t,path:r?`${r}.useAbbreviations`:"useAbbreviations",disabled:i})},r0=e=>{let{field:t}=e;return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"animation",children:(0,B.jsx)(o.cC,{id:"controls.section.animation.settings"})}),(0,B.jsxs)(ek.kc,{component:"fieldset",gap:"none",sx:{mt:2},children:[(0,B.jsx)(eD.oe,{label:s.ag._({id:"controls.section.animation.show-play-button"}),field:"animation",path:"showPlayButton"}),t.showPlayButton&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(u.Z,{mt:4,children:[(0,B.jsx)(p.Z,{variant:"caption",component:"p",sx:{mb:1},children:(0,B.jsx)(o.cC,{id:"controls.section.animation.duration"})}),(0,B.jsx)(X.Ee,{children:[10,30,60].map(e=>(0,B.jsx)(eD.je,{label:`${e}s`,field:"animation",path:"duration",value:e},e))})]}),(0,B.jsxs)(u.Z,{mt:4,children:[(0,B.jsxs)(q.k,{alignItems:"center",sx:{gap:1,mb:1},children:[(0,B.jsx)(p.Z,{variant:"caption",component:"p",children:(0,B.jsx)(o.cC,{id:"controls.section.animation.type"})}),(0,B.jsx)(c.Z,{arrow:!0,title:s.ag._({id:"controls.section.animation.type.explanation"}),children:(0,B.jsx)(p.Z,{sx:{color:"primary.main",lineHeight:"0 !important"},children:(0,B.jsx)(rg.Z,{width:16,height:16})})})]}),(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(eD.je,{label:s.ag._({id:"controls.section.animation.type.continuous"}),field:"animation",path:"type",value:"continuous"}),(0,B.jsx)(eD.je,{label:s.ag._({id:"controls.section.animation.type.stepped"}),field:"animation",path:"type",value:"stepped"})]})]}),(0,B.jsxs)(u.Z,{display:"flex",alignItems:"center",mt:5,gap:"0.5rem",children:[(0,B.jsx)(eD.oe,{label:s.ag._({id:"controls.section.animation.dynamic-scaling"}),field:"animation",path:"dynamicScales"}),(0,B.jsx)(c.Z,{arrow:!0,title:s.ag._({id:"controls.section.animation.dynamic-scaling.explanation"}),children:(0,B.jsx)(p.Z,{sx:{color:"primary.main",lineHeight:"0 !important"},children:(0,B.jsx)(rg.Z,{width:16,height:16})})})]})]})]})]})};var r1=r(20925);let r2=e=>{let{chartConfig:t}=e,r=(0,es.bU)(),[n,i]=(0,eF.lY)(eF.N3),a=t.baseLayer.locked;return(0,x.useEffect)(()=>{if(a){let e=(0,r1.F)();e&&i({type:"CHART_FIELD_UPDATED",value:{locale:r,field:null,path:"baseLayer.bbox",value:e.getBounds().toArray()}})}else i({type:"CHART_FIELD_UPDATED",value:{locale:r,field:null,path:"baseLayer.bbox",value:void 0}})},[i,r,a]),(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,children:(0,B.jsx)(o.cC,{id:"chart.map.layers.base"})}),(0,B.jsxs)(ek.kc,{gap:"lg",children:[(0,B.jsx)(eD.xh,{label:s.ag._({id:"chart.map.layers.base.show"}),field:null,path:"baseLayer.show"}),(0,B.jsx)(eD.oe,{label:s.ag._({id:"chart.map.layers.base.view.locked"}),field:null,path:"baseLayer.locked"})]})]})},r4=e=>{let{disabled:t,warnMessage:r}=e;return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"normalize",warnMessage:r,children:(0,B.jsx)(o.cC,{id:"controls.select.calculation.mode"})}),(0,B.jsxs)(ek.kc,{children:[(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(eD.je,{label:(0,eZ.N)("identity"),field:null,path:"interactiveFiltersConfig.calculation.type",value:"identity",disabled:t}),(0,B.jsx)(eD.je,{label:(0,eZ.N)("percent"),field:null,path:"interactiveFiltersConfig.calculation.type",value:"percent",disabled:t})]}),(0,B.jsx)(eD.oe,{label:(0,B.jsx)(tO.E,{tooltipProps:{enterDelay:600},title:(0,B.jsx)(o.cC,{id:"controls.filters.interactive.calculation"}),children:(0,B.jsx)("div",{children:(0,B.jsx)(o.cC,{id:"controls.filters.interactive.toggle"})})}),field:null,path:"interactiveFiltersConfig.calculation.active",disabled:t})]})]})};var r3=r(44463),r7=r(63093),r6=r(45214),r5=r(47073);let r9=e=>{let{chartConfig:t,encoding:r,component:n,componentTypes:i,dimensions:a,measures:l,getFieldOptionGroups:c,optional:d,enableUseAbbreviations:m}=e,f=r.field,h=n.values.length,g=(0,x.useMemo)(()=>(0,tB.wV)({dimensionTypes:i,dimensions:a,measures:l}),[i,a,l]),b=(0,x.useCallback)(e=>({value:e.id,label:e.label}),[]),y=(0,x.useMemo)(()=>1===t.cubes.length?g.map(b):[],[t.cubes.length,g,b]),v=(0,x.useMemo)(()=>t.cubes.length>1?c({fieldComponents:g,getOption:b}):void 0,[t.cubes.length,g,c,b]),j=(0,x.useMemo)(()=>Array.from({length:Math.min(7,Math.max(0,h-2))},(e,t)=>t+3).map(e=>({value:e,label:`${e}`})),[h]),C=rq()(t,["fields",r.field,"color","componentId"]),O=[...a,...l].find(e=>e.id===C),w=rq()(t,["fields",f,"color","type"]),I=rq()(t,["fields",f,"color","scaleType"]),S=rq()(t,["fields",f,"color","nbClass"]);return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"swatch",children:(0,B.jsx)(o.cC,{id:"controls.color"})}),(0,B.jsxs)(ek.kc,{children:[(0,B.jsx)(eD.Z_,{id:"color-component",label:s.ag._({id:"controls.select.measure"}),field:f,path:"color.componentId",options:y,optionGroups:v,optional:d}),m&&(0,B.jsx)(u.Z,{sx:{mt:1},children:(0,B.jsx)(rQ,{field:f,path:"color",component:O})}),"symbolLayer"===f&&(0,B.jsx)(u.Z,{sx:{mt:1},children:(0,B.jsx)(eD.y_,{field:f,path:"color.opacity",label:s.ag._({id:"controls.color.opacity"}),min:0,max:100,step:10,defaultValue:"fixed"===w?r3.xm:r3.pR})}),"fixed"===w?(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(eD.F8,{label:s.ag._({id:"controls.color.select"}),field:f,path:"color.value"})}):"categorical"===w?C&&n.id!==C&&O&&!(0,tB.kb)(O)?(0,B.jsx)(r5.tX,{dimension:O,field:f,colorConfigPath:"color",colorComponent:O}):(0,B.jsx)(r7.V,{field:"symbolLayer",colorConfigPath:"color",component:O}):"numerical"===w?(0,B.jsxs)("div",{children:[(0,B.jsx)(r6.a,{field:f,path:"color",nSteps:S}),(0,B.jsx)(p.Z,{variant:"caption",component:"p",sx:{mb:1},children:(0,B.jsx)(o.cC,{id:"controls.scale.type"})}),(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(eD.je,{label:s.ag._({id:"controls.color.scale.type.continuous"}),field:f,path:"color.scaleType",value:"continuous"}),h>=3&&(0,B.jsx)(eD.je,{label:s.ag._({id:"controls.color.scale.type.discrete"}),field:f,path:"color.scaleType",value:"discrete"})]})]}):null,"discrete"===I&&h>=3?(0,B.jsxs)(tQ.Z,{spacing:2,children:[(0,B.jsx)(eD.Z_,{id:"color-scale-interpolation",label:s.ag._({id:"controls.color.scale.interpolation"}),field:f,path:"color.interpolationType",options:[{label:s.ag._({id:"controls.color.scale.discretization.quantize"}),value:"quantize"},{label:s.ag._({id:"controls.color.scale.discretization.quantiles"}),value:"quantile"},{label:s.ag._({id:"controls.color.scale.discretization.jenks"}),value:"jenks"}]}),(0,B.jsx)(eD.Z_,{id:"number-of-colors",label:s.ag._({id:"controls.color.scale.number.of.classes"}),field:f,path:"color.nbClass",options:j,getValue:e=>+e})]}):null]})]})};var r8=r(23175),ne=r(77167);let nt=e=>{let{chartConfig:t,measures:r}=e;switch(t.chartType){case"comboLineSingle":return(0,B.jsx)(nn,{chartConfig:t,measures:r});case"comboLineDual":return(0,B.jsx)(ni,{chartConfig:t,measures:r});case"comboLineColumn":return(0,B.jsx)(no,{chartConfig:t,measures:r});default:return t}},nr=(e,t)=>{let r=s.ag._({id:"controls.chart.combo.y.no-unit"});return(0,r8.Xx)(e,e=>e.unit??r).map(e=>{let[r,n]=e;return[{label:r,value:r},n.map(e=>({value:e.id,label:e.label,disabled:t(e)}))]})},nn=e=>{let{chartConfig:t,measures:r}=e,n=(0,es.bU)(),[,i]=(0,eF.lY)(eF.N3),{fields:a}=t,{y:l}=a,c=(0,x.useMemo)(()=>r.filter(tB.cW),[r]),d=(0,x.useMemo)(()=>{let e=Array.from(new Set(l.componentIds.map(e=>{let t=c.find(t=>t.id===e);return t?.unit})));if(e.length>1)throw Error("ChartComboYField can only be used with single-unit charts!");return e[0]},[c,l.componentIds]),u=(0,x.useCallback)(function(e){let{allowNone:t,enableAll:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=nr(c,t=>!t.unit||!r&&(t.unit!==d||l.componentIds.includes(t.id)&&t.id!==e));return t&&n.unshift([{label:"",value:""},[{label:s.ag._({id:"controls.none"}),value:ne.P,isNoneValue:!0}]]),n},[c,l.componentIds,d]),{addNewMeasureOptions:m,showAddNewMeasureButton:f}=(0,x.useMemo)(()=>{let e=u(null,{allowNone:!0});return{addNewMeasureOptions:e,showAddNewMeasureButton:e.flatMap(e=>{let[t,r]=e;return r}).filter(e=>!e.disabled).length>1}},[u]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"numerical",children:"Measures"}),(0,B.jsxs)(ek.kc,{component:"fieldset",gap:"none",sx:{mt:2},children:[(0,B.jsx)(p.Z,{variant:"caption",sx:{mb:2},children:(0,B.jsx)(o.cC,{id:"controls.chart.combo.y.combine-same-unit"})}),(0,B.jsxs)(p.Z,{variant:"caption",sx:{mb:2},children:[(0,B.jsx)(o.cC,{id:"controls.chart.combo.y.common-unit"}),":"," ",(0,B.jsx)("b",{children:d??s.ag._({id:"controls.none"})})]}),l.componentIds.map((e,t)=>{let r=u(e,{allowNone:l.componentIds.length>1,enableAll:0===t&&1===l.componentIds.length});return(0,B.jsx)(X.Ph,{size:"sm",id:`measure-${e}`,hint:f||1!==l.componentIds.length?void 0:s.ag._({id:"controls.chart.combo.y.no-compatible-measures"}),options:[],optionGroups:r,sort:!1,value:e,onChange:r=>{let o;let s=r.target.value;s===ne.P?o=l.componentIds.filter(t=>t!==e):(o=[...l.componentIds]).splice(t,1,s),i({type:"CHART_FIELD_UPDATED",value:{locale:n,field:"y",path:"componentIds",value:o}})},sx:{mb:2}},e)}),f&&(0,B.jsx)(X.Ph,{id:"measure-add",label:s.ag._({id:"controls.sorting.addDimension"}),options:[],optionGroups:m,sort:!1,onChange:e=>{let t=e.target.value;t!==ne.P&&i({type:"CHART_FIELD_UPDATED",value:{locale:n,field:"y",path:"componentIds",value:[...l.componentIds,t]}})},value:ne.P})]})]}),(0,B.jsx)(ns,{values:l.componentIds.map(e=>({id:e,symbol:"line"})),measures:r})]})},ni=e=>{let{chartConfig:t,measures:r}=e,n=(0,es.bU)(),[,i]=(0,eF.lY)(eF.N3),{fields:a}=t,{y:l}=a,c=(0,x.useMemo)(()=>r.filter(tB.cW),[r]),{leftAxisMeasure:d,rightAxisMeasure:u}=(0,x.useMemo)(()=>({leftAxisMeasure:c.find(e=>e.id===l.leftAxisComponentId),rightAxisMeasure:c.find(e=>e.id===l.rightAxisComponentId)}),[c,l.leftAxisComponentId,l.rightAxisComponentId]);if(d.unit===u.unit)throw Error("ChartComboYField can only be used with dual-unit charts!");let m=(0,x.useCallback)(e=>nr(c,t=>"left"===e?t.unit===u.unit:t.unit===d.unit),[d.unit,c,u.unit]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"numerical",children:"Measures"}),(0,B.jsxs)(ek.kc,{component:"fieldset",gap:"none",sx:{mt:2},children:[(0,B.jsx)(p.Z,{variant:"caption",sx:{mb:4},children:(0,B.jsx)(o.cC,{id:"controls.chart.combo.y.combine-different-unit"})}),(0,B.jsx)(X.Ph,{size:"sm",id:`measure-${l.leftAxisComponentId}`,options:[],optionGroups:m("left"),sort:!1,label:s.ag._({id:"controls.chart.combo.y.left-axis-measure"}),value:l.leftAxisComponentId,onChange:e=>{i({type:"CHART_FIELD_UPDATED",value:{locale:n,field:"y",path:"leftAxisComponentId",value:e.target.value}})},sx:{mb:2}}),(0,B.jsx)(X.Ph,{id:`measure-${l.rightAxisComponentId}`,size:"sm",options:[],optionGroups:m("right"),sort:!1,label:s.ag._({id:"controls.chart.combo.y.right-axis-measure"}),value:l.rightAxisComponentId,onChange:e=>{i({type:"CHART_FIELD_UPDATED",value:{locale:n,field:"y",path:"rightAxisComponentId",value:e.target.value}})},sx:{mb:2}})]})]}),(0,B.jsx)(ns,{values:[{id:l.leftAxisComponentId,symbol:"line"},{id:l.rightAxisComponentId,symbol:"line"}],measures:r})]})},no=e=>{let{chartConfig:t,measures:r}=e,n=(0,es.bU)(),[,i]=(0,eF.lY)(eF.N3),{fields:a}=t,{y:l}=a,c=(0,x.useMemo)(()=>r.filter(tB.cW),[r]),{lineMeasure:d,columnMeasure:u}=(0,x.useMemo)(()=>({lineMeasure:c.find(e=>e.id===l.lineComponentId),columnMeasure:c.find(e=>e.id===l.columnComponentId)}),[c,l.columnComponentId,l.lineComponentId]);if(d.unit===u.unit)throw Error("ChartComboYField can only be used with dual-unit charts!");let m=(0,x.useCallback)(e=>nr(c,t=>"line"===e?t.unit===u.unit:t.unit===d.unit),[u.unit,d.unit,c]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"numerical",children:"Measures"}),(0,B.jsxs)(ek.kc,{component:"fieldset",gap:"none",sx:{mt:2},children:[(0,B.jsx)(p.Z,{variant:"caption",sx:{mb:4},children:(0,B.jsx)(o.cC,{id:"controls.chart.combo.y.combine-different-unit"})}),(0,B.jsx)(X.Ph,{id:`measure-${l.columnComponentId}`,size:"sm",options:[],optionGroups:m("column"),sort:!1,label:s.ag._({id:"controls.chart.combo.y.column-measure"}),value:l.columnComponentId,onChange:e=>{i({type:"CHART_FIELD_UPDATED",value:{locale:n,field:"y",path:"columnComponentId",value:e.target.value}})},sx:{mb:2}}),(0,B.jsx)(X.Ph,{id:`measure-${l.lineComponentId}`,size:"sm",options:[],optionGroups:m("line"),sort:!1,label:s.ag._({id:"controls.chart.combo.y.line-measure"}),value:l.lineComponentId,onChange:e=>{i({type:"CHART_FIELD_UPDATED",value:{locale:n,field:"y",path:"lineComponentId",value:e.target.value}})},sx:{mb:2}})]})]}),(0,B.jsx)(ns,{values:"left"===l.lineAxisOrientation?[{id:l.lineComponentId,symbol:"line"},{id:l.columnComponentId,symbol:"square"}]:[{id:l.columnComponentId,symbol:"square"},{id:l.lineComponentId,symbol:"line"}],measures:r})]})},ns=e=>{let{values:t,measures:r}=e;return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"swatch",children:(0,B.jsx)(o.cC,{id:"controls.section.layout-options"})}),(0,B.jsxs)(ek.kc,{component:"fieldset",gap:"none",sx:{mt:2},children:[(0,B.jsx)(r7.V,{field:"y",component:{__typename:"",values:t.map(e=>{let{id:t}=e;return{value:t,label:t}})}}),(0,B.jsx)(q.k,{flexDirection:"column",sx:{gap:2,mt:5},children:t.map(e=>{let{id:t,symbol:n}=e;return(0,B.jsx)("div",{children:(0,B.jsx)(eD.F8,{field:"color",path:`colorMapping["${t}"]`,label:r.find(e=>e.id===t).label,symbol:n})},t)})})]})]})};function na(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function nl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?na(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):na(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let nc=e=>{let{chartConfig:t,field:r,components:n}=e;switch(t.chartType){case"area":case"column":case"line":case"pie":case"scatterplot":{let e=n.find(e=>e.id===t.fields[r].componentId);if(!e)return null;let i=t.conversionUnitsByComponentId[e.id],o=e.originalUnit,s=!!i;return(0,B.jsx)(nd,{checked:s,conversionUnits:[{componentId:e.id,originalUnit:o}],children:s?(0,B.jsx)(nu,{componentId:e.id,originalUnit:o,conversionUnit:i}):null})}case"bar":{let e=n.find(e=>e.id===t.fields[r].componentId);if(!e)return null;let i=t.conversionUnitsByComponentId[e.id],o=e.originalUnit,s=!!i;return(0,B.jsx)(nd,{checked:s,conversionUnits:[{componentId:e.id,originalUnit:o}],children:s?(0,B.jsx)(nu,{componentId:e.id,originalUnit:o,conversionUnit:i}):null})}case"map":switch(r){case"areaLayer":{let e=t.fields.areaLayer,r=e?.color,i=r?.type==="numerical"?r:void 0,o=n.find(e=>e.id===i?.componentId);if(!o)return null;let s=t.conversionUnitsByComponentId[o.id],a=o.unit,l=!!s;return(0,B.jsx)(nd,{checked:l,conversionUnits:[{componentId:o.id,originalUnit:a}],children:l?(0,B.jsx)(nu,{componentId:o.id,originalUnit:a,conversionUnit:s}):null})}case"symbolLayer":{let e=t.fields.symbolLayer,r=n.find(t=>t.id===e?.measureId),i=e?.color,s=i?.type==="numerical"?i:void 0,a=n.find(e=>e.id===s?.componentId);if(!r&&!a)return null;let l=t.conversionUnitsByComponentId[r?.id??""],c=r?.unit,d=t.conversionUnitsByComponentId[a?.id??""],u=a?.unit,m=!!l||!!d;return(0,B.jsxs)(nd,{checked:m,conversionUnits:[{componentId:r?.id,originalUnit:c},{componentId:a?.id,originalUnit:u}],children:[m&&r?(0,B.jsxs)("div",{children:[(0,B.jsxs)(p.Z,{variant:"body3",fontWeight:"bold",children:[(0,B.jsx)(o.cC,{id:"controls.size"}),":"," ",r.label]}),(0,B.jsx)(nu,{componentId:r.id,originalUnit:c,conversionUnit:l})]}):null,m&&a?(0,B.jsxs)("div",{children:[(0,B.jsxs)(p.Z,{variant:"body3",fontWeight:"bold",children:[(0,B.jsx)(o.cC,{id:"controls.color"}),":"," ",a.label]}),(0,B.jsx)(nu,{componentId:a.id,originalUnit:u,conversionUnit:d})]}):null]})}case"animation":return null;default:return r}case"table":return null;case"comboLineSingle":{let e=n.find(e=>e.id===t.fields.y.componentIds[0]);if(!e)return null;let r=t.conversionUnitsByComponentId[e.id],i=e.unit,o=!!r;return(0,B.jsx)(nd,{checked:o,conversionUnits:[{componentId:e.id,originalUnit:i}],children:o?(0,B.jsx)(nu,{componentId:e.id,originalUnit:i,conversionUnit:r}):null})}case"comboLineColumn":{let e=n.find(e=>e.id===t.fields.y.lineComponentId);if(!e)return null;let r=n.find(e=>e.id===t.fields.y.columnComponentId);if(!r)return null;let i=t.conversionUnitsByComponentId[e.id],o=e.unit,s=t.conversionUnitsByComponentId[r.id],a=r.unit,l=!!i||!!s;return(0,B.jsxs)(nd,{checked:l,conversionUnits:[{componentId:e.id,originalUnit:o},{componentId:r.id,originalUnit:a}],children:[l&&r?(0,B.jsxs)("div",{children:[(0,B.jsx)(p.Z,{variant:"body3",fontWeight:"bold",children:r.label}),(0,B.jsx)(nu,{componentId:r.id,originalUnit:a,conversionUnit:s})]}):null,l&&e?(0,B.jsxs)("div",{children:[(0,B.jsx)(p.Z,{variant:"body3",fontWeight:"bold",children:e.label}),(0,B.jsx)(nu,{componentId:e.id,originalUnit:o,conversionUnit:i})]}):null]})}case"comboLineDual":{let e=n.find(e=>e.id===t.fields.y.leftAxisComponentId);if(!e)return null;let r=n.find(e=>e.id===t.fields.y.rightAxisComponentId);if(!r)return null;let i=t.conversionUnitsByComponentId[e.id],o=e.unit,s=t.conversionUnitsByComponentId[r.id],a=r.unit,l=!!i||!!s;return(0,B.jsxs)(nd,{checked:l,conversionUnits:[{componentId:e.id,originalUnit:o},{componentId:r.id,originalUnit:a}],children:[l&&e?(0,B.jsxs)("div",{children:[(0,B.jsx)(p.Z,{variant:"body3",fontWeight:"bold",children:e.label}),(0,B.jsx)(nu,{componentId:e.id,originalUnit:o,conversionUnit:i})]}):null,l&&r?(0,B.jsxs)("div",{children:[(0,B.jsx)(p.Z,{variant:"body3",fontWeight:"bold",children:r.label}),(0,B.jsx)(nu,{componentId:r.id,originalUnit:a,conversionUnit:s})]}):null]})}default:return t}},nd=e=>{let{children:t,checked:r,conversionUnits:n}=e,i=(0,es.bU)(),[a,l]=(0,eF.lY)(eF.N3),c=(0,eE.z)(()=>{r?n.forEach(e=>{let{componentId:t}=e;l({type:"CHART_FIELD_UPDATED",value:{locale:i,field:null,path:`conversionUnitsByComponentId["${t}"]`,value:ne.P}})}):n.forEach(e=>{let{componentId:t,originalUnit:r}=e;t&&l({type:"CHART_FIELD_UPDATED",value:{locale:i,field:null,path:`conversionUnitsByComponentId["${t}"]`,value:nm({originalUnit:r})}})})});return(0,B.jsxs)(ek.rE,{collapse:!0,defaultExpanded:r,children:[(0,B.jsx)(ek.NZ,{iconName:"balance",children:(0,B.jsx)(o.cC,{id:"controls.convert-unit"})}),(0,B.jsxs)(ek.kc,{gap:"lg",children:[(0,B.jsx)(X.XZ,{label:s.ag._({id:"controls.convert-unit.enable"}),checked:r,onChange:c}),t]})]})},nu=e=>{let{componentId:t,originalUnit:r,conversionUnit:n}=e,i=(0,es.bU)(),a=(0,es.WB)(),[l,c]=(0,eF.lY)(eF.N3),d=n??nm({originalUnit:r}),m=(0,eE.z)(e=>{c({type:"CHART_FIELD_UPDATED",value:{locale:i,field:null,path:`conversionUnitsByComponentId["${t}"]`,value:{multiplier:e,labels:d.labels}}})}),f=(0,eE.z)((e,r)=>{c({type:"CHART_FIELD_UPDATED",value:{locale:e,field:null,path:`conversionUnitsByComponentId["${t}"]`,value:{multiplier:d.multiplier,labels:nl(nl({},d.labels),{},{[e]:r})}}})});return(0,B.jsxs)(u.Z,{sx:{mt:2},children:[(0,B.jsxs)(q.k,{sx:{flexDirection:"column",gap:2},children:[(0,B.jsx)(p.Z,{variant:"body3",children:(0,B.jsx)(o.cC,{id:"controls.convert-unit.original",values:{0:r||s.ag._({id:"controls.none"})}})}),(0,B.jsx)(np,{value:d.multiplier,onCommit:m})]}),(0,B.jsxs)(q.k,{sx:{flexDirection:"column",gap:1},children:[(0,B.jsx)(p.Z,{variant:"body3",children:(0,B.jsx)(o.cC,{id:"controls.convert-unit.custom-labels"})}),a.map(e=>(0,B.jsx)(X.II,{label:(0,eZ.N)(e),name:`unit-label-${e}`,value:d.labels[e],onChange:t=>f(e,t.target.value)},e))]})]})},np=e=>{let{value:t,onCommit:r}=e,{0:n,1:i}=(0,x.useState)(`${t}`),{0:o,1:a}=(0,x.useState)(void 0);(0,x.useEffect)(()=>{i(`${t}`)},[t]);let l=()=>{let e=parseFloat(n);if(isNaN(e)){a(s.ag._({id:"controls.convert-unit.invalid-number-error"}));return}if(e<=0){a(s.ag._({id:"controls.convert-unit.positive-number-error"}));return}a(void 0),r(e)};return(0,B.jsx)(X.II,{type:"number",label:s.ag._({id:"controls.convert-unit.multiplier"}),name:"multiplier",value:n,onChange:e=>i(e.currentTarget.value),onBlur:l,onKeyDown:e=>{"Enter"===e.key&&l()},error:!!o,errorMessage:o})},nm=e=>{let{originalUnit:t}=e,r=t??"";return{multiplier:1,labels:{de:r,fr:r,it:r,en:r}}},nf=e=>{let{chartConfig:t}=e,[,r]=(0,eF.lY)(eF.N3),n=e=>{switch(e){case"none":return s.ag._({id:"controls.imputation.type.none"});case"zeros":return s.ag._({id:"controls.imputation.type.zeros"});case"linear":return s.ag._({id:"controls.imputation.type.linear"});default:return e}},i=(0,x.useCallback)(e=>{r({type:"IMPUTATION_TYPE_CHANGED",value:{type:e}})},[r]),a=rq()(t,["fields","y","imputationType"],"none");return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"infoCircle",warnMessage:"none"===a?s.ag._({id:"controls.section.imputation.explanation"}):void 0,children:(0,B.jsx)(o.cC,{id:"controls.section.imputation"})}),(0,B.jsx)(ek.kc,{component:"fieldset",gap:"none",children:(0,B.jsx)(X.Ph,{id:"imputation-type",label:(0,eZ.N)("imputation"),options:eP.jM.map(e=>({value:e,label:n(e)})),value:a,onChange:e=>{i(e.target.value)}})})]})},nh=e=>{let{encoding:t,component:r,chartConfig:n,components:i,hasColorPalette:s,hasSubType:a,measures:l}=e,c=n.activeField;if(!c)return null;let d=(0,eP.GK)(n),u=d?"single"===n.fields.color.type?[{id:(0,eP.UN)(n)?n.fields.x.componentId:n.fields.y.componentId,symbol:"line"}]:Object.keys(n.fields.color.colorMapping).map(e=>({id:e,symbol:"line"})):[];return t.options||s?(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"swatch",children:(0,B.jsx)(o.cC,{id:"controls.section.layout-options"})}),(0,B.jsxs)(ek.kc,{gap:"lg",children:[a&&(0,B.jsx)(ng,{encoding:t,chartConfig:n,components:i,disabled:!r}),(0,B.jsx)(r7.V,{field:c,component:{__typename:"",values:u.map(e=>{let{id:t}=e;return{value:t,label:t}})}}),d&&"single"===n.fields.color.type&&(0,B.jsx)(eD.F8,{field:"color",path:"color",label:l.find(e=>e.id===u[0].id).label})]})]}):null},ng=e=>{let{encoding:t,chartConfig:r,components:n,disabled:i}=e,s=(t.options?.chartSubType).getValues(r,n);return(0,B.jsxs)(q.k,{flexDirection:"column",sx:{gap:1},children:[(0,B.jsx)(p.Z,{variant:"caption",children:(0,B.jsx)(o.cC,{id:"controls.select.column.layout"})}),(0,B.jsx)(X.Ee,{children:s.map(e=>(0,B.jsx)(eD.je,{label:(0,eZ.N)(e.value),field:t.field,path:"type",value:e.value,disabled:i||e.disabled,warnMessage:e.warnMessage},e.value))})]})};var nb=r(80750),ny=r(41282),nv=r(59159);function nj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function nx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nj(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nj(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let nC=U()(()=>r.e(14172).then(r.bind(r,14172)).then(e=>e.ColorPickerMenu),{ssr:!1,loadableGenerated:{webpack:()=>[14172]}}),nO=e=>{let{chartConfig:t,dimensions:r,measure:n}=e,[i,a]=(0,eF.lY)(eF.N3),l=(0,er.In)(t),c=(0,eE.z)((e,t)=>{let r={measureId:n.id,related:t.related.map(e=>({dimensionId:e.dimensionId,value:e.value}))};e?a({type:"LIMIT_SET",value:nx(nx({},r),{},{color:"#ff0000",lineType:"solid"})}):a({type:"LIMIT_REMOVE",value:r})}),d=(0,er.LU)({chartConfig:t,dimensions:r}),m=(0,x.useMemo)(()=>n.limits.map(e=>{let{limit:r,wouldBeValid:i,relatedAxisDimensionValueLabel:o}=(0,er.CM)({chartConfig:t,measureId:n.id,axisDimension:d,limit:e,filters:l});if(!i)return;let{color:s="#ffffff",lineType:a="solid",symbolType:c="circle"}=r??{};return{relatedAxisDimensionValueLabel:o,limit:e,maybeLimit:r,color:s,lineType:a,symbolType:c}}).filter(tH.y),[d,t,l,n.id,n.limits]),{data:f}=(0,nv.H)(),h=rq()(t,"fields.color.paletteId"),g=(0,ny.XN)({paletteId:h,fallbackPalette:f?.find(e=>e.paletteId===h)?.colors}),b=(0,er.xk)(t);return m.length>0?(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"target",children:(0,B.jsx)(o.cC,{id:"controls.section.targets-and-limit-values"})}),(0,B.jsx)(ek.kc,{component:"fieldset",children:m.map((e,t)=>{let{relatedAxisDimensionValueLabel:r,maybeLimit:i,limit:l,color:d,lineType:m,symbolType:f}=e;return(0,B.jsxs)(u.Z,{sx:{mb:2},children:[(0,B.jsxs)(q.k,{flexDirection:"column",sx:{gap:4,mb:"value-range"===l.type||b?4:0},children:[(0,B.jsx)(u.Z,{sx:{display:"flex",alignItems:"center",gap:3},children:(0,B.jsx)(X.rs,{id:`limit-${t}`,label:s.ag._({id:"controls.section.targets-and-limit-values.show-target"}),checked:!!i,onChange:e=>{c(e.target.checked,l)}})}),(0,B.jsxs)(q.k,{justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,B.jsx)(nb.YL,{label:l.name,color:d,symbol:"square"}),(0,B.jsx)(nC,{colors:g,selectedHexColor:d,onChange:e=>{a({type:"LIMIT_SET",value:{measureId:n.id,related:l.related,color:e,lineType:m,symbolType:f}})},disabled:!i})]})]}),"single"===l.type&&b?(0,B.jsxs)("div",{children:[(0,B.jsx)(p.Z,{variant:"h6",component:"p",sx:{mb:2},children:(0,B.jsx)(o.cC,{id:"controls.section.targets-and-limit-values.symbol-type"})}),(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(X.Y8,{name:`limit-${t}-symbol-type-dot`,label:s.ag._({id:"controls.symbol.dot"}),value:"dot",checked:"circle"===f,onChange:()=>{a({type:"LIMIT_SET",value:{measureId:n.id,related:l.related,color:d,lineType:m,symbolType:"circle"}})},disabled:!i}),(0,B.jsx)(X.Y8,{name:`limit-${t}-symbol-type-cross`,label:s.ag._({id:"controls.symbol.cross"}),value:"cross",checked:"cross"===f,onChange:()=>{a({type:"LIMIT_SET",value:{measureId:n.id,related:l.related,color:d,lineType:m,symbolType:"cross"}})},disabled:!i}),(0,B.jsx)(X.Y8,{name:`limit-${t}-symbol-type-triangle`,label:s.ag._({id:"controls.symbol.triangle"}),value:"triangle",checked:"triangle"===f,onChange:()=>{a({type:"LIMIT_SET",value:{measureId:n.id,related:l.related,color:d,lineType:m,symbolType:"triangle"}})},disabled:!i})]})]}):null,"single"===l.type&&b&&void 0!==r?null:(0,B.jsxs)("div",{children:[(0,B.jsx)(p.Z,{variant:"body3",component:"p",sx:{my:2},children:(0,B.jsx)(o.cC,{id:"controls.section.targets-and-limit-values.line-type"})}),(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(X.Y8,{name:`limit-${t}-line-type-solid`,label:s.ag._({id:"controls.line.solid"}),value:"solid",checked:"solid"===m,onChange:()=>{a({type:"LIMIT_SET",value:{measureId:n.id,related:l.related,color:d,lineType:"solid",symbolType:f}})},disabled:!i}),(0,B.jsx)(X.Y8,{name:`limit-${t}-line-type-dashed`,label:s.ag._({id:"controls.line.dashed"}),value:"dashed",checked:"dashed"===m,onChange:()=>{a({type:"LIMIT_SET",value:{measureId:n.id,related:l.related,color:d,lineType:"dashed",symbolType:f}})},disabled:!i})]})]})]},t)})})]}):null},nw=e=>{let{chartConfig:t,component:r,encoding:n,field:i,dimensions:s,measures:a}=e,l=rq()(t,(0,eP.fD)(t)?`fields["${i}"].color.componentId`:"fields.segment.componentId"),c=[...s,...a].find(e=>e.id===l);return n.filters&&r?(0,B.jsxs)(ek.rE,{"data-testid":"chart-edition-multi-filters",collapse:!0,children:[(0,B.jsx)(ek.NZ,{disabled:!r,iconName:"filter",children:(0,B.jsx)(o.cC,{id:"controls.section.filter"})}),(0,B.jsxs)(ek.kc,{component:"fieldset",gap:"none",children:[(0,B.jsx)("legend",{style:{display:"none"},children:(0,B.jsx)(o.cC,{id:"controls.section.filter"})}),((0,tB.fF)(r)||(0,tB.eP)(r))&&"segment"!==i?(0,B.jsx)(r5.IL,{dimension:r,disableInteractiveFilters:n.disableInteractiveFilters}):r&&!(0,tB.kb)(r)&&(0,B.jsx)(r5.tX,{dimension:r,field:i,colorComponent:c})]})]}):null},nI=e=>{let{chartConfig:t,field:r,observations:n,getDefaultDomain:i}=e,o=(0,es.bU)(),[a,l]=(0,eF.lY)(eF.N3),c=rq()(t,`fields["${r}"].customDomain`),d=!!c,u="percent"===t.interactiveFiltersConfig.calculation.type,p=(0,x.useMemo)(()=>i({chartConfig:t,observations:n}),[t,i,n]),m=(0,eE.z)(()=>{l({type:"CHART_FIELD_UPDATED",value:{locale:o,field:r,path:"customDomain",value:d?ne.P:p}})}),f=(0,eE.z)(e=>{l({type:"CHART_FIELD_UPDATED",value:{locale:o,field:r,path:"customDomain",value:e}})});return(0,B.jsxs)(tQ.Z,{gap:2,style:u?{opacity:.5,pointerEvents:"none"}:{},children:[(0,B.jsx)(X.XZ,{label:s.ag._({id:"controls.adjust-scale-domain"}),checked:d,onChange:m}),d?(0,B.jsxs)(q.k,{justifyContent:"space-between",gap:2,children:[(0,B.jsx)(nS,{label:"min",value:c[0],validate:e=>({error:e<c[1]?null:s.ag._({id:"controls.adjust-scale-domain.min-error"})}),onCommit:e=>f([e,c[1]])}),(0,B.jsx)(nS,{label:"max",value:c[1],validate:e=>({error:e>c[0]?null:s.ag._({id:"controls.adjust-scale-domain.max-error"})}),onCommit:e=>f([c[0],e])})]}):null]})},nS=e=>{let{label:t,value:r,onCommit:n,validate:i}=e,{0:o,1:a}=(0,x.useState)(`${r}`),{0:l,1:c}=(0,x.useState)(void 0),d=()=>{let e=parseFloat(o);if(isNaN(e)){c(s.ag._({id:"controls.adjust-scale-domain.invalid-number-error"}));return}let{error:t}=i(e);if(t){c(t);return}c(void 0),n(e)};return(0,B.jsx)(X.II,{type:"number",label:t,name:t,value:o,onChange:e=>a(e.currentTarget.value),onBlur:d,onKeyDown:e=>{"Enter"===e.key&&d()},error:!!l,errorMessage:l})},nP=e=>{let{fields:t,field:r}=e,n=(0,es.bU)(),[i,a]=(0,eF.lY)(eF.N3),l="y"in t&&(!("showDots"in t.y)||"showDots"in t.y&&!t.y.showDots);return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"lineChart",children:(0,B.jsx)(o.cC,{id:"controls.section.data-points"})}),(0,B.jsx)(ek.kc,{children:(0,B.jsxs)(tQ.Z,{direction:"column",gap:4,children:[(0,B.jsx)(eD.oe,{path:"showDots",field:r,onChange:e=>{let{checked:i}=e.target;"y"in t&&!("showDots"in t.y)&&a({type:"CHART_FIELD_UPDATED",value:{locale:n,field:"y",path:"showDotsSize",value:"Large"}}),a({type:"CHART_FIELD_UPDATED",value:{locale:n,field:r,path:"showDots",value:i}})},label:s.ag._({id:"controls.section.show-dots"})}),(0,B.jsx)(p.Z,{variant:"caption",sx:{mt:2},children:(0,B.jsx)(o.cC,{id:"controls.section.dots-size"})}),(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(nk,{size:"Small",label:s.ag._({id:"controls.section.dots-size.small"}),disabled:l}),(0,B.jsx)(nk,{size:"Medium",label:s.ag._({id:"controls.section.dots-size.medium"}),disabled:l}),(0,B.jsx)(nk,{size:"Large",label:s.ag._({id:"controls.section.dots-size.large"}),disabled:l})]})]})})]})},nk=e=>{let{size:t,label:r,disabled:n}=e;return(0,B.jsx)(eD.je,{field:"y",path:"showDotsSize",value:t,label:r,disabled:n},t)},n_=e=>{let{chartConfig:t,field:r,componentTypes:n,dimensions:i,measures:o,getFieldOptionGroups:a,optional:l}=e,c=(0,x.useMemo)(()=>(0,tB.wV)({dimensionTypes:n,dimensions:i,measures:o}),[n,i,o]),d=(0,x.useCallback)(e=>({value:e.id,label:e.label}),[]),u=(0,x.useMemo)(()=>1===t.cubes.length?c.map(d):[],[t.cubes.length,c,d]),p=(0,x.useMemo)(()=>t.cubes.length>1?a({fieldComponents:c,getOption:d}):void 0,[t.cubes.length,c,a,d]);return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"size",children:s.ag._({id:"controls.size"})}),(0,B.jsx)(ek.kc,{children:(0,B.jsx)(eD.Z_,{id:"size-measure",label:s.ag._({id:"controls.select.measure"}),field:r,path:"measureId",options:u,optionGroups:p,optional:l})})]})};function nT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let nD=e=>{let{chartConfig:t,field:r,encodingSortingOptions:i,disabled:a=!1}=e,l=(0,es.bU)(),[,c]=(0,eF.lY)(eF.N3),d=e=>{switch(e){case"byDimensionLabel":return s.ag._({id:"controls.sorting.byDimensionLabel"});case"byMeasure":return s.ag._({id:"controls.sorting.byMeasure"});case"byTotalSize":return s.ag._({id:"controls.sorting.byTotalSize"});case"byAuto":return s.ag._({id:"controls.sorting.byAuto"});default:return e}},u=(0,x.useCallback)(e=>{let{sortingType:t,sortingOrder:n}=e;c({type:"CHART_FIELD_UPDATED",value:{locale:l,field:r,path:"sorting",value:{sortingType:t,sortingOrder:n}}})},[l,c,r]),p=rq()(t,["fields",r,"sorting","sortingType"],rd.dJ.sortingType),m=i.find(e=>e.sortingType===p)?.sortingOrder,f=rq()(t,["fields",r,"sorting","sortingOrder"],m?.[0]??"asc");return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{disabled:a,iconName:"sort",children:(0,B.jsx)(o.cC,{id:"controls.section.sorting"})}),(0,B.jsxs)(ek.kc,{children:[(0,B.jsx)(X.Ph,{id:"sort-by",size:"sm",label:(0,eZ.N)("sortBy"),options:i?.map(e=>{let r=e.getDisabledState?.(t);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nT(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nT(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({value:e.sortingType,label:d(e.sortingType)},r)}),value:p,disabled:a,onChange:e=>{u({sortingType:e.target.value,sortingOrder:f})}}),(0,B.jsx)(X.Ee,{children:m&&m.map(e=>{let r=rq()(t,["fields","segment","type"],""),n=`${t.chartType}.${r}`;return(0,B.jsx)(X.Y8,{label:(0,eZ.N)(`${n}.${p}.${e}`),value:e,checked:e===f,disabled:a,onChange:t=>{t.currentTarget.checked&&u({sortingType:p,sortingOrder:e})}},e)})})]})]})},nZ=e=>{let{cubesMetadata:t}=e;return e=>{let{fieldComponents:r,getOption:n}=e;return Object.entries(e6()(r,e=>e.cubeIri)).map(e=>{let[r,i]=e;return[{label:(0,tW.hm)(r)?s.ag._({id:"dimension.joined"}):t.find(e=>e.iri===r)?.title,value:r},i.map(n)]})}};var nE=r(38746),nM=r(26301),nA=r(1645),nL=r(19365),nF=r(58555),nN=r(89836),nR=r(3185),nG=r(98700),nV=r(621),n$=r(3707),nU=r(345);let nz=(0,P.Z)(e=>({alert:{marginBottom:e.spacing(2),boxShadow:"none",padding:e.spacing(1),flexShrink:1},table:{marginBottom:e.spacing(1),"& .MuiTableCell-root":{padding:e.spacing(.5,1),borderBottom:"none"}},attributeName:{fontWeight:500},chips:{display:"flex",flexWrap:"wrap",gap:e.spacing(.5)},chip:{fontSize:"0.7rem"},booleanIcon:{fontSize:"1rem"}})),nB=e=>{let{extraInfo:t}=e,r=nz(),n=[{key:"canListLayers",label:s.ag._({id:"provider-info.can-list-layers"})},{key:"canDisplayLayers",label:s.ag._({id:"provider-info.can-display-layers"})},{key:"canDisplayOnMapGeoAdmin",label:s.ag._({id:"provider-info.can-display-on-map-geo-admin"})}],i=Object.keys(t).some(e=>"note"!==e&&void 0!==t[e]);return(0,B.jsxs)(nV.Z,{severity:"info",className:r.alert,elevation:0,sx:{py:1,px:2,[`& .${n$.Z.message}`]:{flexDirection:"column",display:"flex",gap:1,width:"100%"}},slotProps:{},children:[(0,B.jsx)("div",{children:(0,B.jsx)(o.cC,{id:"provider-info.title"})}),i&&(0,B.jsx)(t0.Z,{size:"small",className:r.table,children:(0,B.jsxs)(t3.Z,{children:[n.map(e=>{let n=t[e.key];return void 0===n?null:(0,B.jsxs)(t2.Z,{children:[(0,B.jsx)(t4.Z,{className:r.attributeName,children:e.label}),(0,B.jsx)(t4.Z,{children:n?(0,B.jsx)(eq.JO,{name:"checkmark",color:"success",className:r.booleanIcon}):(0,B.jsx)(eq.JO,{name:"close",color:"error",className:r.booleanIcon})})]},e.key)}),t.workingLayers?.length?(0,B.jsxs)(t2.Z,{children:[(0,B.jsx)(t4.Z,{className:r.attributeName,children:s.ag._({id:"provider-info.working-layers"})}),(0,B.jsx)(t4.Z,{children:(0,B.jsx)(u.Z,{className:r.chips,children:t.workingLayers.map(e=>(0,B.jsx)(nU.Z,{label:e,size:"small",className:r.chip},e))})})]}):null]})}),t.note&&(0,B.jsx)("div",{children:t.note})]})};var nH=JSON.parse('{"https://geodienste.ch/db/av_situationsplan/deu":{"canListLayers":true,"canDisplayLayers":true,"canDisplayOnMapGeoAdmin":true,"workingLayers":["Berzirkgrenzen","Situationsplan","Landeskarte"],"note":""},"https://geodienste.ch/db/av_situationsplan/fra":{"canListLayers":true,"canDisplayLayers":true,"canDisplayOnMapGeoAdmin":true,"workingLayers":["Disponibilite"],"note":""},"https://geodienste.ch/db/av/ita":{"canListLayers":true,"canDisplayLayers":false,"canDisplayOnMapGeoAdmin":true,"workingLayers":[],"note":""},"https://geodienste.ch/db/elektrische_anlagen_ueber_36kv/deu":{"canListLayers":true,"canDisplayLayers":true,"canDisplayOnMapGeoAdmin":true,"workingLayers":["Leitung","Station (punkt)"],"note":"Station (fl\xe4sche) and Mast do not work and cannot be displayed on map.geo.admin.ch"},"https://geodienste.ch/db/fixpunkte/deu":{"canListLayers":true,"canDisplayLayers":true,"canDisplayOnMapGeoAdmin":true,"workingLayers":["Lage und h\xf6henfixpunkte LFP2 / HFP2"],"note":""},"https://geoserver.swissdatacube.org/geoserver/gwc/service/wmts?REQUEST=GetCapabilities":{"canListLayers":true,"canDisplayLayers":true,"canDisplayOnMapGeoAdmin":true,"workingLayers":[],"note":"Layers load and some work (Snow Cover 1995 - 2005, Bale_<year>, Switzerland Admin Level 1 & 2, & more...)"},"https://osmlab.github.io/wmts-osm/WMTSCapabilities.xml":{"canListLayers":true,"canDisplayLayers":false,"canDisplayOnMapGeoAdmin":true,"workingLayers":[],"note":"Display on map.geo.admin.ch seems buggy"},"https://geodienste.ch/db/waldreservate/deu":{"canListLayers":true,"canDisplayLayers":true,"canDisplayOnMapGeoAdmin":true,"workingLayers":["Waldreservate","Verf\xfcgbarkeit: Kantone"],"note":"Verf\xfcgbarkeit: Beschriftungen does not work"},"https://geodienste.ch/db/kantonale_ausnahmetransportrouten/deu":{"canListLayers":true,"canDisplayLayers":true,"canDisplayOnMapGeoAdmin":true,"workingLayers":["Routen"],"note":""},"https://p20.cosmos-project.ch/sd20alps_map/wmts?request=getcapabilities":{"canListLayers":false,"canDisplayLayers":false,"canDisplayOnMapGeoAdmin":true,"workingLayers":[],"note":"403 Forbidden due to Referer restriction (must be map.geo.admin.ch)"},"https://services.geo.sg.ch/wss/service/SG00002_WMS/guest?":{"canListLayers":false,"canDisplayLayers":false,"canDisplayOnMapGeoAdmin":true,"workingLayers":[],"note":"CORS Missing allow origin"},"https://www.basemap.at/wmts/1.0.0/WMTSCapabilities.xml":{"canListLayers":false,"canDisplayLayers":false,"canDisplayOnMapGeoAdmin":true,"workingLayers":[],"note":"CORS Missing allow origin. Projection system is EPSG:3857 so it should be possible to display it once we solve the CORS issue."},"https://www.ogd.stadt-zuerich.ch/mapproxy/wmts/1.0.0/WMTSCapabilities.xml":{"canListLayers":true,"canDisplayLayers":false,"canDisplayOnMapGeoAdmin":true,"workingLayers":[],"note":"Loading layers works but no displayable layers since projection is EPSG:2056"}}'),nW=JSON.parse('["https://bio.discomap.eea.europa.eu/arcgis/services/Ecosystem/Ecosystems/MapServer/WMSServer","https://copernicus.discomap.eea.europa.eu/arcgis/services/Corine/CLC2012_WM/MapServer/WMSServer","https://geo.so.ch/api/wms","https://geodienste.ch/db/av_situationsplan/deu","https://geodienste.ch/db/av_situationsplan/fra","https://geodienste.ch/db/av_situationsplan/ita","https://geodienste.ch/db/av/deu","https://geodienste.ch/db/av/fra","https://geodienste.ch/db/av/ita","https://geodienste.ch/db/avc/deu","https://geodienste.ch/db/avc/fra","https://geodienste.ch/db/avc/ita","https://geodienste.ch/db/elektrische_anlagen_ueber_36kv/deu","https://geodienste.ch/db/elektrische_anlagen_ueber_36kv/fra","https://geodienste.ch/db/elektrische_anlagen_ueber_36kv/ita","https://geodienste.ch/db/fixpunkte/deu","https://geodienste.ch/db/fixpunkte/fra","https://geodienste.ch/db/fixpunkte/ita","https://geodienste.ch/db/fruchtfolgeflaechen/deu","https://geodienste.ch/db/fruchtfolgeflaechen/fra","https://geodienste.ch/db/fruchtfolgeflaechen/ita","https://geodienste.ch/db/gefahrenkarten/deu","https://geodienste.ch/db/gefahrenkarten/eng","https://geodienste.ch/db/gefahrenkarten/fra","https://geodienste.ch/db/gefahrenkarten/ita","https://geodienste.ch/db/gewaesserraum/deu","https://geodienste.ch/db/gewaesserraum/fra","https://geodienste.ch/db/gewaesserraum/ita","https://geodienste.ch/db/grundwasservorkommen/deu","https://geodienste.ch/db/grundwasservorkommen/fra","https://geodienste.ch/db/grundwasservorkommen/ita","https://geodienste.ch/db/inventar_wasserentnahmen/deu","https://geodienste.ch/db/inventar_wasserentnahmen/fra","https://geodienste.ch/db/inventar_wasserentnahmen/ita","https://geodienste.ch/db/kantonale_ausnahmetransportrouten/deu","https://geodienste.ch/db/kantonale_ausnahmetransportrouten/eng","https://geodienste.ch/db/kantonale_ausnahmetransportrouten/fra","https://geodienste.ch/db/kantonale_ausnahmetransportrouten/ita","https://geodienste.ch/db/kataster_belasteter_standorte/deu","https://geodienste.ch/db/kataster_belasteter_standorte/fra","https://geodienste.ch/db/kataster_belasteter_standorte/ita","https://geodienste.ch/db/luftbild/deu","https://geodienste.ch/db/luftbild/fra","https://geodienste.ch/db/luftbild/ita","https://geodienste.ch/db/lwb_bewirtschaftungseinheit/deu","https://geodienste.ch/db/lwb_bewirtschaftungseinheit/fra","https://geodienste.ch/db/lwb_bewirtschaftungseinheit/ita","https://geodienste.ch/db/lwb_biodiversitaetsfoerderflaechen/deu","https://geodienste.ch/db/lwb_biodiversitaetsfoerderflaechen/fra","https://geodienste.ch/db/lwb_biodiversitaetsfoerderflaechen/ita","https://geodienste.ch/db/lwb_nutzungsflaechen/deu","https://geodienste.ch/db/lwb_nutzungsflaechen/fra","https://geodienste.ch/db/lwb_nutzungsflaechen/ita","https://geodienste.ch/db/lwb_perimeter_ln_sf/deu","https://geodienste.ch/db/lwb_perimeter_ln_sf/fra","https://geodienste.ch/db/lwb_perimeter_ln_sf/ita","https://geodienste.ch/db/lwb_perimeter_terrassenreben/deu","https://geodienste.ch/db/lwb_perimeter_terrassenreben/fra","https://geodienste.ch/db/lwb_perimeter_terrassenreben/ita","https://geodienste.ch/db/lwb_rebbaukataster/deu","https://geodienste.ch/db/lwb_rebbaukataster/fra","https://geodienste.ch/db/lwb_rebbaukataster/ita","https://geodienste.ch/db/naturereigniskataster/deu","https://geodienste.ch/db/naturereigniskataster/fra","https://geodienste.ch/db/naturereigniskataster/ita","https://geodienste.ch/db/npl_laermempfindlichkeitsstufen/deu","https://geodienste.ch/db/npl_laermempfindlichkeitsstufen/fra","https://geodienste.ch/db/npl_laermempfindlichkeitsstufen/ita","https://geodienste.ch/db/npl_nutzungsplanung/deu","https://geodienste.ch/db/npl_nutzungsplanung/fra","https://geodienste.ch/db/npl_nutzungsplanung/ita","https://geodienste.ch/db/npl_waldabstandslinien/deu","https://geodienste.ch/db/npl_waldabstandslinien/fra","https://geodienste.ch/db/npl_waldabstandslinien/ita","https://geodienste.ch/db/npl_waldgrenzen/deu","https://geodienste.ch/db/npl_waldgrenzen/fra","https://geodienste.ch/db/npl_waldgrenzen/ita","https://geodienste.ch/db/planerischer_gewaesserschutz/deu","https://geodienste.ch/db/planerischer_gewaesserschutz/fra","https://geodienste.ch/db/planerischer_gewaesserschutz/ita","https://geodienste.ch/db/planungszonen/deu","https://geodienste.ch/db/planungszonen/fra","https://geodienste.ch/db/planungszonen/ita","https://geodienste.ch/db/revitalisierung_fliessgewaesser/deu","https://geodienste.ch/db/revitalisierung_fliessgewaesser/fra","https://geodienste.ch/db/revitalisierung_fliessgewaesser/ita","https://geodienste.ch/db/revitalisierung_seen/deu","https://geodienste.ch/db/revitalisierung_seen/fra","https://geodienste.ch/db/revitalisierung_seen/ita","https://geodienste.ch/db/richtplanung_erneuerbare_energien/deu","https://geodienste.ch/db/richtplanung_erneuerbare_energien/fra","https://geodienste.ch/db/richtplanung_erneuerbare_energien/ita","https://geodienste.ch/db/rodungen_und_rodungsersatz/deu","https://geodienste.ch/db/rodungen_und_rodungsersatz/fra","https://geodienste.ch/db/rodungen_und_rodungsersatz/ita","https://geodienste.ch/db/sanierung_wasserkraft/deu","https://geodienste.ch/db/sanierung_wasserkraft/fra","https://geodienste.ch/db/sanierung_wasserkraft/ita","https://geodienste.ch/db/stromversorgungssicherheit_netzgebiete/deu","https://geodienste.ch/db/stromversorgungssicherheit_netzgebiete/fra","https://geodienste.ch/db/stromversorgungssicherheit_netzgebiete/ita","https://geodienste.ch/db/waldreservate/deu","https://geodienste.ch/db/waldreservate/fra","https://geodienste.ch/db/waldreservate/ita","https://geodienste.ch/db/wildruhezonen/deu","https://geodienste.ch/db/wildruhezonen/fra","https://geodienste.ch/db/wildruhezonen/ita","https://geoserver.swissdatacube.org/geoserver/gwc/service/wmts?REQUEST=GetCapabilities","https://geoservices.jura.ch/wms/","https://geoshop.sz.ch/WMSSZ","https://geowms.bl.ch/?SERVICE=WMS&version=1.1.1&REQUEST=GetCapabilities","https://map.geo.sz.ch/mapserv_proxy","https://map.geo.tg.ch/proxy/geofy_chsdi3/av_wms_mbsf?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/basisplanf?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/basisplansw?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/biomasse-oberflaeche?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/bodenuebersicht-regionen?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/emissionen-stickoxide?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/gefaehrdung_wasser?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/gefahrenhinweiskarte_allgemeine_gefahrengebiete?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/gewaesserschutzkarte-gewaesserschutzbereiche?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/grundwasserkarte-fassung?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/luftbelastung-stickstoff?access_key=YoW2syIQ4xe0ccJA","https://map.geo.tg.ch/proxy/geofy_chsdi3/neophyten-pflanzenart?access_key=YoW2syIQ4xe0ccJA","https://osmlab.github.io/wmts-osm/WMTSCapabilities.xml","https://ows.terrestris.de/osm-gray/service","https://ows.terrestris.de/osm/service","https://rips-gdi.lubw.baden-wuerttemberg.de/arcgis/services/wms/UIS_0100000004200001/MapServer/WMSServer","https://rips-gdi.lubw.baden-wuerttemberg.de/arcgis/services/wms/UIS_0100000013100001/MapServer/WMSServer","https://rips-gdi.lubw.baden-wuerttemberg.de/arcgis/services/wms/UIS_0100000013300001/MapServer/WMSServer","https://rips-gdi.lubw.baden-wuerttemberg.de/arcgis/services/wms/UIS_0100000013500001/MapServer/WMSServer","https://rips-gdi.lubw.baden-wuerttemberg.de/arcgis/services/wms/UIS_0100000013600001/MapServer/WMSServer","https://rips-gdi.lubw.baden-wuerttemberg.de/arcgis/services/wms/UIS_0100000016900001/MapServer/WMSServer","https://rips-gdi.lubw.baden-wuerttemberg.de/arcgis/services/wms/UIS_0100000017400001/MapServer/WMSServer","https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer/WMTS/1.0.0/WMTSCapabilities.xml","https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/WMTS/1.0.0/WMTSCapabilities.xml","https://services.arcgisonline.com/arcgis/rest/services/Reference/World_Transportation/MapServer/WMTS/1.0.0/WMTSCapabilities.xml","https://services.arcgisonline.com/arcgis/rest/services/World_Shaded_Relief/MapServer/WMTS/1.0.0/WMTSCapabilities.xml","https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer/WMTS/1.0.0/WMTSCapabilities.xml","https://services.arcgisonline.com/arcgis/rest/services/World_Terrain_Base/MapServer/WMTS/1.0.0/WMTSCapabilities.xml","https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/WMTS/1.0.0/WMTSCapabilities.xml","https://services.geo.sg.ch/wss/service/SG00002_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00010_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00011_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00012_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00013_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00014_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00015_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00016_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00017_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00018_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00020_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00021_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00022_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00023_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00024_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00025_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00026_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00027_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00028_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00031_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00032_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00033_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00035_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00036_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00037_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00039_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00041_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00042_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00044_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00046_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00047_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00051_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00052_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00053_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00055_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00057_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00058_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00061_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00062_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00064_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00065_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00066_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00068_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00069_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00072_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00073_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00075_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00076_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00077_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00078_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00080_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00081_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00082_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00083_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00085_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00087_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00088_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00089_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00093_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00095_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00096_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00097_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00100_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00101_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00102_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00103_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00104_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00105_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00124_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00129_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00135_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00155_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00158_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00160_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00164_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00170_WMS/guest?","https://services.geo.sg.ch/wss/service/SG00172_WMS/guest?","https://sgx.geodatenzentrum.de/wmts_topplus_open/1.0.0/WMTSCapabilities.xml","https://view.eumetsat.int/geoserver/wms?service=WMS","https://vogis.cnv.at/mapserver/mapserv?map=i_historischekarten_r_wms.map","https://vogis.cnv.at/mapserver/mapserv?map=i_luftbilder_r_wms.map","https://vogis.cnv.at/mapserver/mapserv?map=i_relief_r_wms.map","https://vogis.cnv.at/mapserver/mapserv?map=i_topographie_r_wms.map","https://wms.geo.admin.ch/","https://wms.geo.ag.ch/","https://wms.geo.bs.ch/","https://wms.geo.gl.ch/","https://wms.geo.gr.ch/admineinteilung","https://wms.geo.gr.ch/amtlichevermessung_stand","https://wms.geo.gr.ch/bauzonen_graubuenden","https://wms.geo.gr.ch/belastetestandorte","https://wms.geo.gr.ch/gewaesserschutz","https://wms.geo.gr.ch/grundwasser","https://wms.geo.gr.ch/historischekarten","https://wms.geo.gr.ch/naturgefahren_erfassungsbereiche","https://wms.geo.gr.ch/naturschutz","https://wms.geo.gr.ch/richtplan","https://wms.geo.gr.ch/rrip_bregaglia","https://wms.geo.gr.ch/rrip_davos","https://wms.geo.gr.ch/rrip_mesolcina","https://wms.geo.gr.ch/rrip_mittelbuenden","https://wms.geo.gr.ch/rrip_nordbuenden","https://wms.geo.gr.ch/rrip_oberengadin","https://wms.geo.gr.ch/rrip_praettigau","https://wms.geo.gr.ch/rrip_regioviamala","https://wms.geo.gr.ch/rrip_unterengadin","https://wms.geo.gr.ch/schutzwald","https://wms.geo.gr.ch/seilbahnen","https://wms.geo.gr.ch/waldentwicklungsplan","https://wms.geo.gr.ch/wildruhezonen","https://wms.geo.gr.ch/wildschutzgebiete","https://wms.geo.sh.ch/wms?SERVICE=WMS","https://wms.geo.ti.ch/service","https://wms.zh.ch/AFVTempo30ZHWMS","https://wms.zh.ch/ArchWMS","https://wms.zh.ch/AWELWWgwsZHWMS","https://wms.zh.ch/DenkmalschutzWMS","https://wms.zh.ch/FnsInvZHWMS","https://wms.zh.ch/FnsLRKZHWMS","https://wms.zh.ch/FNSLRPZHWMS","https://wms.zh.ch/FnsLWZHWMS","https://wms.zh.ch/FNSOEQVZHWMS","https://wms.zh.ch/FnsSchutzanordnungenZHWMS","https://wms.zh.ch/HaltestellenZHWMS","https://wms.zh.ch/OrtsbildschutzZHWMS","https://wms.zh.ch/TBA9ZHWMS","https://wms.zh.ch/TBAAnlagenZHWMS","https://wms.zh.ch/TbaBaustellenZHWMS","https://wms.zh.ch/TBAStr1ZHWMS","https://wms.zh.ch/TBAStr2ZHWMS","https://wms.zh.ch/TBAStr3ZHWMS","https://wms.zh.ch/TBAVMSZHWMS","https://wms.zh.ch/VeloinfrastrukturZHWMS","https://wms.zh.ch/VelonetzZHWMS","https://wms.zh.ch/WaldarealZHWMS","https://wms.zh.ch/WaldSWZHWMS","https://wms.zh.ch/WaldVKWMS","https://wms.zh.ch/WaldWNBZHWMS","https://wms.zh.ch/WildkarteZHWMS","https://wms.zh.ch/ZVVZHWMS","https://wmts.geo.admin.ch/EPSG/3857/1.0.0/WMTSCapabilities.xml","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_boundaries01_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_boundaries02_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_boundaries03_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_boundaries04_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_boundaries05_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_boundaries06_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_environment01_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_environment02_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_environment03_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_geoscientificinformation01_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_geoscientificinformation02_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_geoscientificinformation03_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_imagerybasemapsearthcover01_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_inlandwaters01_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_inlandwaters02_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_inlandwaters03_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_planningcadastre01_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_planningcadastre02_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_planningcadastre03_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_planningcadastre04_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_planningcadastre05_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_planningcadastre06_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_planningcadastre07_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_transportation01_de_ms_wms/MapServer/WMSServer","https://www.geoservice.apps.be.ch/geoservice3/services/a42geo/of_transportation02_de_ms_wms/MapServer/WMSServer","https://www.opensnowmap.org/OSnM_GetCapabilities.xml"]');function nY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function nK(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nY(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nY(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let nq=(0,P.Z)(e=>({listbox:{maxHeight:300,"& li":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",fontSize:e.typography.body2.fontSize,display:"block",minWidth:0}},paper:{minHeight:300,width:500},input:{"&&":{fontSize:e.typography.body2.fontSize}},chip:{marginRight:e.spacing(1),marginLeft:e.spacing(-2),fontSize:"0.75rem",color:e.palette.text.secondary,backgroundColor:e.palette.background.paper}})),nX=e=>e.split(".").slice(-2).join("."),nJ=e=>{let{value:t,onChange:r}=e,n=nq(),i=t?nH[t]:void 0,o=(0,z.P5)("wmts-show-extra-info"),a=(0,x.useMemo)(()=>{let e=nW.filter(e=>!nH[e]||!nH[e].hidden).map(e=>{let t=new URL(e),r=nX(t.host);return{url:t,host:t.host,label:t.href.replace(`${t.protocol}//`,""),group:r,value:e,type:(0,nE.Xe)(e)}});return tr()(e,e=>e.group)},[]),l=(0,x.useMemo)(()=>(0,nN.D)({stringify:e=>"string"==typeof e?e:`${e.url}`}),[]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(nR.Z,{options:a,value:t,freeSolo:!0,filterOptions:l,groupBy:e=>e.group,getOptionLabel:e=>"string"==typeof e?e:e.label,onChange:(e,t)=>r("string"==typeof t?t:t?.value??null),size:"small",ListboxProps:{className:n.listbox},slotProps:{paper:{elevation:6,className:n.paper}},renderInput:e=>(0,B.jsx)(nG.Z,nK(nK({},e),{},{placeholder:s.ag._({id:"wmts-providers-autocomplete.placeholder"}),variant:"outlined",margin:"normal",fullWidth:!0,size:"small",InputProps:nK(nK({},e.InputProps),{},{slotProps:{input:{className:n.input}}})}))}),i&&o&&(0,B.jsx)(nB,{extraInfo:i})]})};var nQ=r(53624),n0=r(85732),n1=r(57060);let n2=["children"];function n4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function n3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n4(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n4(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let n7=(0,P.Z)({content:{},root:{"&:hover > div > $iconContainer":{opacity:1},"--depth":1,"& &":{"--depth":2},"& & &":{"--depth":3},"& & & &":{"--depth":4},"& & & & &":{"--depth":5},"& $content":{paddingLeft:"calc(var(--depth) * 10px)"}},iconContainer:{opacity:.5,"&:empty":{display:"none"}},label:{"&&":{padding:"0.25rem"}},group:{marginLeft:0}}),n6=(0,P.Z)(e=>({treeRow:{display:"flex",gap:"0.5rem",fontSize:e.typography.body2.fontSize,width:"100%",alignItems:"center"},label:{flexGrow:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:"1.5rem"},warnIcon:{color:e.palette.warning.main}})),n5=e=>{let{layer:t}=e,{0:r,1:n}=(0,x.useState)();return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(e2.Z,{"data-value":t.path,size:"small",onClick:e=>n({value:t.path,element:e.currentTarget}),children:(0,B.jsx)(rg.Z,{})}),(0,B.jsx)(nL.ZP,{elevation:6,anchorEl:r?.element,open:!!r,onClose:()=>n(void 0),children:(0,B.jsxs)(u.Z,{sx:{p:2,position:"relative",width:300},children:[(0,B.jsx)(p.Z,{variant:"h5",gutterBottom:!0,children:(0,B.jsx)(o.cC,{id:"wmts.legend-title"})}),(0,B.jsx)(e2.Z,{sx:{position:"absolute",top:"0.25rem",right:"0.25rem"},size:"small",onClick:()=>n(void 0),children:(0,B.jsx)(rh.Z,{})}),r&&(0,B.jsx)("img",{src:t?.legendUrl,style:{maxWidth:"100%"},alt:""})]})})]})},n9=e=>{let{layer:t,className:r,classes:n,label:i,value:o,initialChecked:a,onCheck:l}=e,{0:d,1:u}=(0,x.useState)(a??!1),p=(0,x.useCallback)(()=>u(e=>{let r=!e;return l(t,r),r}),[t,l]);return(0,B.jsxs)("div",{className:r,children:[t.id?(0,B.jsx)(tT.Z,{inputProps:{"data-value":o},onClick:p,checked:d}):null,(0,B.jsx)("div",{className:n.label,onClick:p,children:i}),t&&t.legendUrl?(0,B.jsx)(n5,{layer:t}):null,(0,nE.Cg)(t)?null:(0,B.jsx)(c.Z,{title:s.ag._({id:"wmts.layer-not-supported-crs"}),children:(0,B.jsx)("span",{children:(0,B.jsx)(eq.JO,{name:"warningCircleFilled",className:n.warnIcon})})})]})},n8=(0,nF.ZP)(e=>({inputValue:"",setInputValue:t=>{e({inputValue:t})},provider:null,setProvider:t=>{e({provider:t})}})),ie=e=>{let{onLayerCheck:t,selected:r}=e,n=n7(),a=n6(),{provider:l,setProvider:c,inputValue:d,setInputValue:p}=n8(),m=(0,x.useMemo)(()=>l?[l]:[],[l]),{data:f,error:h,status:g}=(0,nE.p8)(m),{wms:b,wmts:y}=(0,x.useMemo)(()=>f??{wms:[],wmts:[]},[f]),v=(0,x.useMemo)(()=>tC()([...b,...y],e=>e.path),[b,y]),j=(0,x.useMemo)(()=>{let e={};return(0,n1.tn)(v,t=>{e[t.path]||(e[t.path]=t)}),e},[v]),C=(0,x.useMemo)(()=>new Set(r),[r]),O=(0,x.useMemo)(()=>(0,n1.Gy)(v,e=>{let{children:t}=e,r=(0,i.Z)(e,n2);return n3(n3({},r),{},{hasValue:!0,value:r.path,label:r.title,id:r.path,nodeId:r.path,itemId:r.path})}),[v]),{filteredOptions:w,expanded:I,handleInputChange:S,handleNodeToggle:P,handleClickResetInput:k,defaultExpanded:_}=(0,nQ.Q)({value:"",options:O,inputValue:d,onChangeInputValue:p}),T=(0,x.useMemo)(()=>(0,n1.Gy)(tr()(w,e=>e.label),e=>n3(n3({},e),{},{children:tr()(e.children,e=>e.label)})),[w]),D=(0,x.useCallback)(e=>(0,B.jsx)(B.Fragment,{children:e.map(e=>{let{value:r,label:i,children:o,selectable:s}=e;return(0,B.jsx)(nM.Z,{nodeId:r,size:"small",classes:n,defaultExpanded:_,label:(0,B.jsx)(n9,{className:a.treeRow,classes:a,layer:j[r],label:i,value:r,onCheck:t,initialChecked:C.has((0,nE.zm)(j[r]))}),expandIcon:o&&o.length>0?(0,B.jsx)(n0.Z,{}):null,TransitionComponent:tS.Z,ContentProps:{"data-selectable":s,"data-children":o&&o.length>0},children:o?D(o):null},r)})}),[n,_,a,j,t,C]);return(0,B.jsxs)(q.k,{style:{flexDirection:"column",width:"100%",maxWidth:"100%",overflow:"hidden"},children:[h?(0,B.jsx)(Q.BI,{children:(0,B.jsx)(o.cC,{id:"wmts.error-invalid-url"})}):null,(0,B.jsx)(nJ,{value:l,onChange:e=>c(e)}),l&&(0,B.jsx)(tP.Z,{size:"sm",value:d,autoFocus:!0,startAdornment:(0,B.jsx)(eq.JO,{name:"search",size:18}),placeholder:s.ag._({id:"wmts.search-placeholder"}),endAdornment:d.length>0?(0,B.jsx)(e2.Z,{size:"small",onClick:k,children:(0,B.jsx)(eq.JO,{name:"close",size:16})}):null,onChange:S,sx:{px:2,py:1,"& .MuiInput-input":{px:1}}}),"fetching"===g?(0,B.jsx)(u.Z,{textAlign:"center",p:2,children:(0,B.jsx)(Q.$j,{size:24})}):null,(0,B.jsx)(nA.Z,{expanded:I,onNodeToggle:P,style:{flexGrow:1,overflow:"auto"},children:D(T)})]})};function it(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ir(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?it(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ii=e=>{let{children:t,open:r,onClose:n,onExited:i}=e;return(0,B.jsx)(eK.oe,{anchor:"left",open:r,variant:"temporary",onClose:n,SlideProps:{onExited:i},hideBackdrop:!0,children:t})},io=()=>{let[e,t]=(0,eF.lY)(eF.N3),r=(0,er.f6)(e).baseLayer.customLayers,n=(0,x.useMemo)(()=>ti()(r.map(e=>e.endpoint)).filter(tH.y),[r]),{data:i,error:s,status:l}=(0,nE.p8)(n),{wms:c,wmts:d,byKey:f}=i,h=(0,a.Z)(e=>{let n=e.source.index,i=e.destination?.index;"number"==typeof i&&e.source!==e.destination&&t({type:"CUSTOM_LAYER_SWAP",value:{oldIndex:r.length-1-n,newIndex:r.length-1-i}})}),g=(0,x.useCallback)((e,r)=>{let n=e?.type;if(n){if(r)switch(n){case"wms":t({type:"CUSTOM_LAYER_ADD",value:{layer:{type:"wms",id:e.id,isBehindAreaLayer:!1,syncTemporalFilters:!1,endpoint:e.endpoint}}});break;case"wmts":t({type:"CUSTOM_LAYER_ADD",value:{layer:{type:"wmts",id:e.id,url:e.url,isBehindAreaLayer:!1,syncTemporalFilters:!1,endpoint:e.endpoint}}});break;default:return n}else{t({type:"CUSTOM_LAYER_REMOVE",value:{type:n,id:e.id}});return}}},[t]),{0:b,1:y}=(0,x.useState)(!1),v=(0,x.useMemo)(()=>e=>f[(0,nE.iu)(e)],[f]),j=(0,ek.Gm)({sectionOpen:!0,interactive:!0}),C=(0,x.useMemo)(()=>r.map(e=>(0,nE.zm)(e)),[r]),O=(0,x.useCallback)((e,t)=>g(e,t),[g]);return s?(0,B.jsx)(p.Z,{mx:2,color:"error",children:s.message}):c&&d?(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,children:(0,B.jsx)(o.cC,{id:"chart.map.layers.custom-layers"})}),(0,B.jsxs)(ii,{open:b,onClose:()=>y(!1),children:[(0,B.jsx)("div",{children:(0,B.jsx)("div",{className:j.root,onClick:()=>y(!1),children:(0,B.jsxs)(p.Z,{variant:"h6",className:j.text,children:[(0,B.jsx)(eq.JO,{name:"chevronLeft"}),(0,B.jsx)(o.cC,{id:"wmts.custom-layer.section-title"})]})})}),(0,B.jsx)(u.Z,{px:4,children:b?(0,B.jsx)(ie,{onLayerCheck:O,selected:C}):null})]}),(0,B.jsxs)(ek.kc,{gap:"lg",children:[0===r.length&&(0,B.jsx)(p.Z,{variant:"body3",color:"text.secondary",children:(0,B.jsx)(o.cC,{id:"chart.map.layers.no-layers"})}),"success"===l?(0,B.jsx)(to.Z5,{onDragEnd:h,children:(0,B.jsx)(to.bK,{droppableId:"layers",children:e=>(0,B.jsxs)("div",ir(ir({},e.droppableProps),{},{ref:e.innerRef,children:[[...r].reverse().map((e,t)=>(0,B.jsx)(is,{configLayer:e,parsedLayer:v(e),index:t},`${e.type}-${e.id}`)),e.placeholder]}))})}):null,"fetching"===l?(0,B.jsx)("div",{style:{width:"100%"},children:(0,B.jsx)(ek._Q,{})}):null,(0,B.jsx)("div",{children:(0,B.jsx)(m.Z,{variant:"contained",onClick:()=>y(!0),children:(0,B.jsx)(o.cC,{id:"chart.map.layers.add-layer"})})})]})]}):(0,B.jsx)(ek._Q,{})},is=e=>{let{configLayer:t,index:r,parsedLayer:n}=e,[i,o]=(0,eF.lY)(eF.N3),a=t.id,l=(0,x.useMemo)(()=>{switch(t.type){case"wms":return!1;case"wmts":return n?.availableDimensionValues&&n.availableDimensionValues.length>1;default:return t}},[t,n?.availableDimensionValues]),c=()=>{o({type:"CUSTOM_LAYER_REMOVE",value:{type:t.type,id:t.id}})};return(0,B.jsx)(to._l,{draggableId:a,index:r,children:e=>(0,B.jsxs)(u.Z,ir(ir(ir({ref:e.innerRef},e.dragHandleProps),e.draggableProps),{},{sx:{mb:3},children:[(0,B.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,B.jsx)(p.Z,{variant:"body3",sx:{flexGrow:1},children:n?.title??"Unknown layer"}),(0,B.jsx)(e2.Z,{onClick:c,children:(0,B.jsx)(eq.JO,{name:"trash"})}),(0,B.jsx)(tc,{})]}),(0,B.jsxs)(u.Z,{display:"flex",flexDirection:"column",width:"100%",gap:1,children:[(0,B.jsx)(X.rs,{label:s.ag._({id:"chart.map.layers.base.behind-area-layer"}),checked:t.isBehindAreaLayer,onChange:e=>{o({type:"CUSTOM_LAYER_UPDATE",value:{layer:ir(ir({},t),{},{isBehindAreaLayer:e.target.checked})}})}}),"wmts"===t.type?(0,B.jsx)(X.rs,{label:s.ag._({id:"chart.map.layers.base.enable-temporal-filtering"}),checked:t.syncTemporalFilters,disabled:!l,onChange:e=>{o({type:"CUSTOM_LAYER_UPDATE",value:{layer:ir(ir({},t),{},{syncTemporalFilters:e.target.checked})}})}}):null]})]}))},a)};var ia=r(60090),il=r(28907);let ic=(0,il.ZP)((e,t)=>{let{source:r,destination:n}=t,i=(0,rJ.H8)(e.fields),o=i.filter(e=>e.isGroup),s=i.filter(e=>!e.isGroup),a="columns"===r.droppableId?s:o;return("columns"===n.droppableId?s:o).splice(n.index,0,a.splice(r.index,1)[0]),o.forEach((e,t)=>{e.index=t,e.isGroup=!0}),s.forEach((e,t)=>{e.index=o.length+t,e.isGroup=!1}),e}),id=(0,il.ZP)((e,t)=>{let{field:r,value:n}=t;if(!e.fields[r])return e;e.fields[r].isGroup=n;let i=(0,rJ.H8)(e.fields),o=i.filter(t=>t.isGroup&&t!==e.fields[r]),s=i.filter(t=>!t.isGroup&&t!==e.fields[r]);return[...o,e.fields[r],...s].forEach((e,t)=>{e.index=t}),e}),iu=(0,il.ZP)((e,t)=>{let{field:r,value:n}=t;return e.fields[r]&&(e.fields[r].isHidden=n),e}),ip=(0,il.ZP)((e,t)=>(e.sorting.push(t),e)),im=(0,il.ZP)((e,t)=>{let{index:r,option:n}=t;return e.sorting[r]=n,e}),ih=(0,il.ZP)((e,t)=>{let{index:r}=t;return e.sorting.splice(r,1),e}),ig=(0,il.ZP)((e,t)=>{let{index:r,sortingOrder:n}=t;return e.sorting[r]&&(e.sorting[r].sortingOrder=n),e}),ib=(0,il.ZP)((e,t)=>{let{source:r,destination:n}=t;return e.sorting.splice(n.index,0,e.sorting.splice(r.index,1)[0]),e});function iy(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function iv(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?iy(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iy(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let ij=(0,P.Z)(e=>({sortingItemContainer:{padding:e.spacing(4),paddingRight:e.spacing(0),borderTop:`1px solid ${e.palette.divider}`},sortingItemBox:{"&:first-of-type $sortingItemContainer":{borderTopWidth:0}},selectWrapper:{lineHeight:"1rem",textAlign:"left",marginBottom:e.spacing(4)},removeButton:{padding:0,paddingRight:e.spacing(6),cursor:"pointer",marginLeft:"auto",minWidth:0,minHeight:0},iconWrapper:{color:e.palette.secondary.disabled,"&:hover":{color:e.palette.secondary.main}}})),ix=e=>{let{dimensions:t,measures:r,componentId:n,index:i,chartConfig:s,sortingOrder:a,sideControls:l}=e,[,c]=(0,eF.lY)(),d=ij(),f=[...t,...r].find(e=>{let{id:t}=e;return t===n}),h=(0,eE.z)(()=>{c({type:"CHART_CONFIG_REPLACED",value:{chartConfig:ih(s,{index:i}),dataCubesComponents:{dimensions:t,measures:r}}})}),g=(0,eE.z)(e=>{c({type:"CHART_CONFIG_REPLACED",value:{chartConfig:ig(s,{index:i,sortingOrder:e.currentTarget.value}),dataCubesComponents:{dimensions:t,measures:r}}})}),b=(0,tB.cW)(f)?"byMeasure":"byDimensionLabel";return f?(0,B.jsxs)(u.Z,{className:d.sortingItemContainer,children:[(0,B.jsx)(p.Z,{className:d.selectWrapper,children:(0,B.jsx)(iO,{index:i,dimensions:t,measures:r,chartConfig:s,sideControls:l})}),(0,B.jsxs)(X.Ee,{children:[(0,B.jsx)(X.Y8,{name:`${n}-sortingOrder`,value:"asc",checked:"asc"===a,onChange:g,label:(0,eZ.N)(`sorting.${b}.asc`)}),(0,B.jsx)(X.Y8,{name:`${n}-sortingOrder`,value:"desc",checked:"desc"===a,onChange:g,label:(0,eZ.N)(`sorting.${b}.desc`)}),(0,B.jsxs)(m.Z,{variant:"text",className:d.removeButton,onClick:h,children:[(0,B.jsx)(tG.T,{children:(0,B.jsx)(o.cC,{id:"controls.sorting.removeOption"})}),(0,B.jsx)(u.Z,{className:d.iconWrapper,"aria-hidden":"true",children:(0,B.jsx)(eq.JO,{name:"trash",size:20})})]})]})]}):null},iC=e=>{let{dimensions:t,measures:r,chartConfig:n}=e,[,i]=(0,eF.lY)(),o=(0,x.useCallback)(e=>{let{value:o}=e.target,s=[...t,...r].find(e=>{let{id:t}=e;return t===o});s&&i({type:"CHART_CONFIG_REPLACED",value:{chartConfig:ip(n,{componentId:s.id,componentType:s.__typename,sortingOrder:"asc"}),dataCubesComponents:{dimensions:t,measures:r}}})},[n,t,i,r]),a=(0,rJ.Km)(n.fields),l=[{value:"-",label:s.ag._({id:"controls.sorting.selectDimension"}),disabled:!0},...a.flatMap(e=>{if(n.sorting.some(t=>{let{componentId:r}=t;return r===e.componentId}))return[];let i=[...t,...r].find(t=>{let{id:r}=t;return r===e.componentId});return i?[{value:i.id,label:i.label}]:[]}).sort((e,t)=>(0,ia.Z)(e.label,t.label))];return(0,B.jsx)(X.Ph,{id:"add-tablesorting",size:"sm",value:"-",options:l,sort:!1,label:s.ag._({id:"controls.sorting.addDimension"}),onChange:o})},iO=e=>{let{dimensions:t,measures:r,chartConfig:n,index:i,sideControls:o}=e,[,a]=(0,eF.lY)(),l=(0,x.useCallback)(e=>{let{value:o}=e.target,s=[...t,...r].find(e=>{let{id:t}=e;return t===o});s&&a({type:"CHART_CONFIG_REPLACED",value:{chartConfig:im(n,{index:i,option:{componentId:s.id,componentType:s.__typename,sortingOrder:"asc"}}),dataCubesComponents:{dimensions:t,measures:r}}})},[n,t,a,i,r]),c=(0,rJ.Km)(n.fields),{componentId:d}=n.sorting[i],u=c.flatMap(e=>{let n=[...t,...r].find(t=>{let{id:r}=t;return r===e.componentId});return n?[{value:n.id,label:n.label}]:[]});return(0,B.jsx)(X.Ph,{id:`change-sorting-option-${i}`,size:"sm",value:d,options:u,label:s.ag._({id:"controls.sorting.sortBy"}),onChange:l,sideControls:o})},iw=e=>{let{state:t,dimensions:r,measures:n}=e,[,i]=(0,eF.lY)(),s=(0,er.f6)(t),{activeField:a}=s,l=ij(),c=(0,x.useCallback)(e=>{let{source:t,destination:o}=e;o&&"table"===s.chartType&&i({type:"CHART_CONFIG_REPLACED",value:{chartConfig:ib(s,{source:t,destination:o}),dataCubesComponents:{dimensions:r,measures:n}}})},[s,r,i,n]);if(!a||"table"!==s.chartType)return null;let{sorting:d}=s;return(0,B.jsx)(to.Z5,{onDragEnd:c,children:(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,children:(0,B.jsx)(o.cC,{id:"controls.section.tableSorting"})}),(0,B.jsx)(to.bK,{droppableId:"table-sorting",type:"table-sorting",children:e=>{let{innerRef:t,placeholder:i}=e;return(0,B.jsxs)("div",{children:[(0,B.jsx)(u.Z,{ref:t,children:d.map((e,t)=>(0,B.jsx)(to._l,{draggableId:e.componentId,index:t,children:(i,o)=>{let{innerRef:a,draggableProps:c,dragHandleProps:d}=i,{isDragging:p}=o;return(0,B.jsx)(u.Z,iv(iv({ref:a},c),{},{className:l.sortingItemBox,sx:{position:"relative",boxShadow:p?"tooltip":void 0},style:iv({},c.style),children:(0,B.jsx)(ix,iv(iv({},e),{},{index:t,dimensions:r,measures:n,chartConfig:s,sideControls:(0,B.jsx)(u.Z,iv(iv({sx:{color:p?"secondary.main":"secondary.light","&:hover":{color:"secondary.main"}}},d),{},{children:(0,B.jsx)(eq.JO,{name:"dragndrop"})}))}))}))}},e.componentId))}),i,(0,B.jsx)(u.Z,{sx:{py:4,px:4,borderTopColor:"divider",borderTopStyle:"solid",borderTopWidth:1},children:(0,B.jsx)(iC,{dimensions:r,measures:n,chartConfig:s})})]})}})]})})};function iI(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function iS(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?iI(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iI(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let iP=e=>{let{path:t,field:r,dimensions:n,measures:i}=e,[o,s]=(0,eF.lY)(eF.N3),a=(0,er.f6)(o),l=(0,x.useCallback)(e=>{(0,eP.Su)(a)&&s({type:"CHART_CONFIG_REPLACED",value:{chartConfig:("isGroup"===t?id:iu)(a,{field:r,value:e.currentTarget.checked}),dataCubesComponents:{dimensions:n,measures:i}}})},[a,t,r,s,n,i]),c=rq()(a,`fields["${r}"].${t}`,"");return{name:t,checked:!!c&&c,onChange:l}},ik=e=>{let{label:t,field:r,path:n,defaultChecked:i,disabled:o=!1,dimensions:s,measures:a}=e,l=iP({field:r,path:n,dimensions:s,measures:a});return(0,B.jsx)(X.XZ,iS(iS({disabled:o,label:t},l),{},{checked:l.checked??i}))},i_=e=>{let{state:t,dimensions:r,measures:n}=e,i=(0,er.f6)(t),{activeField:a}=i;if(!a||"table"!==i.chartType)return null;if("table-sorting"===a)return(0,B.jsx)(iw,{state:t,dimensions:r,measures:n});if(!i.fields[a]?.componentId)return null;let l=[...r,...n].find(e=>e.id===a);if(!l)return(0,B.jsxs)(Q.BI,{smaller:!0,children:["No component ",a]});let{isGroup:c,isHidden:d}=i.fields[a],u=(0,tB.cW)(l)?[{value:"text",label:s.ag._({id:"columnStyle.text"})},{value:"heatmap",label:s.ag._({id:"columnStyle.heatmap"})},{value:"bar",label:s.ag._({id:"columnStyle.bar"})}]:(0,tB.fF)(l)?[{value:"text",label:s.ag._({id:"columnStyle.text"})}]:[{value:"text",label:s.ag._({id:"columnStyle.text"})},{value:"category",label:s.ag._({id:"columnStyle.categories"})}];return(0,B.jsxs)("div",{role:"tabpanel",id:`control-panel-table-column-${a}`,"aria-labelledby":`tab-${a}`,tabIndex:-1,children:[(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,children:l.label}),(0,B.jsxs)(ek.kc,{children:["NumericalMeasure"!==l.__typename&&(0,B.jsx)(ik,{label:s.ag._({id:"controls.table.column.group"}),field:a,path:"isGroup",dimensions:r,measures:n}),(0,B.jsx)(ik,{label:s.ag._({id:"controls.table.column.hide"}),field:a,path:"isHidden",dimensions:r,measures:n})]})]}),(c||!d)&&(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{iconName:"formatting",children:(0,B.jsx)(o.cC,{id:"controls.section.columnstyle"})}),(0,B.jsxs)(ek.kc,{sx:{mt:2},children:[(0,B.jsx)(eD.Z_,{id:"columnStyle",label:s.ag._({id:"controls.select.columnStyle"}),options:u,getValue:e=>{switch(e){case"text":return{type:"text",textStyle:"regular",textColor:"#333",columnColor:"#fff"};case"category":let t=(0,ny.mq)(l);return{type:"category",textStyle:"regular",paletteId:t,colorMapping:(0,rJ.t6)({paletteId:t,dimensionValues:l.values})};case"heatmap":return{type:"heatmap",textStyle:"regular",paletteId:(0,ny.Gv)().value};case"bar":return{type:"bar",textStyle:"regular",barColorPositive:(0,ny.px)().colors[0],barColorNegative:(0,ny.px)().colors[1],barColorBackground:"#ccc",barShowBackground:!1};default:return}},getKey:e=>e.type,field:a,path:"columnStyle"}),(0,B.jsx)(iT,{chartConfig:i,activeField:a,component:l})]})]}),(0,tB.fF)(l)||(0,tB.eP)(l)?(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{disabled:!l,iconName:"filter",children:(0,B.jsx)(o.cC,{id:"controls.section.filter"})}),(0,B.jsxs)(ek.kc,{component:"fieldset",children:[(0,B.jsx)("legend",{style:{display:"none"},children:(0,B.jsx)(o.cC,{id:"controls.section.filter"})}),(0,B.jsx)(r5.IL,{dimension:l})]})]}):(0,tB.vM)(l)?(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{disabled:!l,iconName:"filter",children:(0,B.jsx)(o.cC,{id:"controls.section.filter"})}),(0,B.jsxs)(ek.kc,{component:"fieldset",children:[(0,B.jsx)("legend",{style:{display:"none"},children:(0,B.jsx)(o.cC,{id:"controls.section.filter"})}),l.isKeyDimension&&d&&!c?(0,B.jsx)(r5.he,{dimension:l}):(0,B.jsx)(r5.tX,{field:l.id,dimension:l,colorComponent:l,colorConfigPath:"columnStyle"})]})]}):null]},`control-panel-table-column-${a}`)},iT=e=>{let{chartConfig:t,activeField:r,component:n}=e,i=t.fields[r].columnStyle.type;return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(eD.Z_,{id:"columnStyle.textStyle",label:s.ag._({id:"controls.select.columnStyle.textStyle"}),options:[{value:"regular",label:s.ag._({id:"columnStyle.textStyle.regular"})},{value:"bold",label:s.ag._({id:"columnStyle.textStyle.bold"})}],field:r,path:"columnStyle.textStyle"}),"text"===i?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(eD.F8,{label:s.ag._({id:"controls.select.columnStyle.textColor"}),field:r,path:"columnStyle.textColor"}),(0,B.jsx)(eD.F8,{label:s.ag._({id:"controls.select.columnStyle.columnColor"}),field:r,path:"columnStyle.columnColor"})]}):"category"===i?(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(r7.V,{field:r,colorConfigPath:"columnStyle",component:n})}):"heatmap"===i?(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(r7.V,{field:r,colorConfigPath:"columnStyle",component:n})}):"bar"===i?(0,B.jsxs)(u.Z,{my:2,children:[(0,B.jsx)(eD.F8,{label:s.ag._({id:"controls.select.columnStyle.barColorPositive"}),field:r,path:"columnStyle.barColorPositive"}),(0,B.jsx)(eD.F8,{label:s.ag._({id:"controls.select.columnStyle.barColorNegative"}),field:r,path:"columnStyle.barColorNegative"}),(0,B.jsx)(eD.F8,{label:s.ag._({id:"controls.select.columnStyle.barColorBackground"}),field:r,path:"columnStyle.barColorBackground"}),(0,B.jsx)(eD.xh,{label:s.ag._({id:"controls.select.columnStyle.barShowBackground"}),field:r,path:"columnStyle.barShowBackground"})]}):null]})};function iD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let iZ=()=>{let[e]=(0,eF.lY)(eF.N3),t=(0,er.f6)(e),{dataSource:r}=e,{activeField:n}=t,i=(0,es.bU)(),[{data:o,fetching:s}]=(0,ei.bi)({variables:{locale:i,sourceType:r.type,sourceUrl:r.url,cubeFilters:t.cubes.map(e=>({iri:e.iri}))}}),a=o?.dataCubesMetadata,[{data:l,fetching:c}]=(0,ei.k$)({chartConfig:t,variables:{sourceType:r.type,sourceUrl:r.url,locale:i,cubeFilters:t.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy,loadValues:!0}))},keepPreviousData:!0}),d=l?.dataCubesComponents.dimensions,p=l?.dataCubesComponents.measures,m=(0,I.n9)({chartConfig:t,dashboardFilters:e.dashboardFilters}),[{data:f,fetching:h}]=(0,ei.XO)({chartConfig:t,variables:{sourceType:r.type,sourceUrl:r.url,locale:i,cubeFilters:m},pause:c,keepPreviousData:!0}),g=f?.dataCubesObservations?.data,b=s||c||h;return a&&d&&p&&g?(0,B.jsx)(u.Z,{sx:{overflowX:"hidden",overflowY:"auto",pointerEvents:b?"none":"auto",opacity:b?.7:1,transition:"opacity 0.2s"},children:n?(0,eP.Su)(t)?(0,B.jsx)(i_,{state:e,dimensions:d,measures:p}):(0,B.jsx)(iE,{chartConfig:t,dimensions:d,measures:p,observations:g,cubesMetadata:a}):null}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(ek._Q,{}),(0,B.jsx)(ek._Q,{})]})},iE=e=>{let{dimensions:t,measures:r,chartConfig:n,observations:i,cubesMetadata:o}=e,s=n.activeField;if(!s)return null;let a=(0,ts.K0)(n),l=(0,eP.Ab)(n)&&a.interactiveFilters.includes("animation"),c=a.encodings,d=(l?[...c,ts.Fe]:c).find(e=>e.field===s),u=(0,rd.iv)(n.fields,s),p=[...t,...r].find(e=>e.id===u);return(0,B.jsx)(iM,{encoding:d,chartConfig:n,field:s,component:p,dimensions:t,measures:r,observations:i,cubesMetadata:o})},iM=e=>{let{encoding:t,field:r,chartConfig:i,component:a,dimensions:l,measures:c,observations:d,cubesMetadata:p}=e,{fields:m}=i,f={animation:s.ag._({id:"controls.select.dimension"}),x:s.ag._({id:"controls.select.dimension"}),y:s.ag._({id:"controls.select.measure"}),color:s.ag._({id:"controls.select.color"}),segment:s.ag._({id:"controls.select.dimension"}),baseLayer:s.ag._({id:"controls.select.dimension"}),areaLayer:s.ag._({id:"controls.select.dimension"}),symbolLayer:s.ag._({id:"controls.select.dimension"}),customLayers:s.ag._({id:"controls.select.dimension"})},h=Object.keys(m).filter(e=>m[e].hasOwnProperty("componentId")&&r!==e).map(e=>m[e].componentId),g=(0,x.useMemo)(()=>(0,tB.wV)({dimensionTypes:t.componentTypes,dimensions:l,measures:c}),[l,t.componentTypes,c]),b=(0,x.useMemo)(()=>nZ({cubesMetadata:p}),[p]),y=(0,x.useCallback)(e=>({value:e.id,label:(0,rJ.X0)(e),disabled:(void 0===t.exclusive||!0===t.exclusive)&&h.includes(e.id)||(0,tB.zS)(e)}),[t.exclusive,h]),v=(0,x.useMemo)(()=>1===i.cubes.length?g.map(y):[],[i.cubes.length,g,y]),j=(0,x.useMemo)(()=>i.cubes.length>1?b({fieldComponents:g,getOption:y}):void 0,[i.cubes.length,g,b,y]),C=(0,x.useMemo)(()=>[...c,...l],[c,l]),O=(0,x.useMemo)(()=>{let e=m?.[t.field]?.componentId;return C.find(t=>t.id===e)},[C,m,t.field]),w=(0,x.useMemo)(()=>!!C.find(e=>e.related?.some(e=>"StandardError"===e.type&&e.id===a?.id)),[C,a]),I=(0,x.useMemo)(()=>{let e=C.find(e=>e.related?.some(e=>"ConfidenceUpperBound"===e.type&&e.id===a?.id)),t=C.find(e=>e.related?.some(e=>"ConfidenceLowerBound"===e.type&&e.id===a?.id));return!!e&&!!t},[C,a]),S=!!t.options?.colorPalette,P=!!t.options?.chartSubType,k=(0,eP.fD)(i)&&"symbolLayer"===i.activeField?c.find(e=>e.id===i.fields.symbolLayer?.measureId):(0,tB.kb)(a)?a:void 0,_=(0,z.P5)("custom-scale-domain"),T=(0,z.P5)("convert-units");return(0,B.jsxs)("div",{role:"tabpanel",id:`control-panel-${t.field}`,"aria-labelledby":`tab-${t.field}`,tabIndex:-1,children:[t.componentTypes.length>0&&(0,B.jsxs)(ek.rE,{hideTopBorder:!0,children:[(0,B.jsx)(ek.NZ,{closable:!0,children:(0,eZ.N)(`${i.chartType}.${t.field}`)}),(0,B.jsxs)(ek.kc,{gap:"lg",children:[!t.customComponent&&(0,B.jsx)(eD.kN,{field:t.field,label:f[t.field],optional:t.optional,options:v,optionGroups:j,components:C}),t.options?.showValues?(0,B.jsx)(eD.xh,{path:"showValues",field:t.field,label:s.ag._({id:"controls.section.show-total-values"}),disabled:t.options.showValues.getDisabledState?.(i).disabled}):null,t.options?.adjustScaleDomain&&O&&_?(0,B.jsx)(nI,{chartConfig:i,field:r,observations:d,getDefaultDomain:t.options.adjustScaleDomain.getDefaultDomain}):null,t.options?.showStandardError&&w&&(0,B.jsxs)(q.k,{alignItems:"center",sx:{gap:1},children:[(0,B.jsx)(eD.oe,{path:"showStandardError",field:t.field,defaultValue:!0,label:s.ag._({id:"controls.section.show-standard-error"})}),(0,B.jsx)(rX.o,{enterDelay:600,PopperProps:{sx:{maxWidth:160}},title:(0,B.jsx)(o.cC,{id:"controls.section.show-standard-error.explanation"})})]}),t.options?.showConfidenceInterval&&I&&(0,B.jsxs)(u.Z,{sx:{display:"flex",gap:1,alignItems:"center",mt:3},children:[(0,B.jsx)(eD.oe,{path:"showConfidenceInterval",field:t.field,defaultValue:!0,label:s.ag._({id:"controls.section.show-confidence-interval"})}),(0,B.jsx)(rX.o,{enterDelay:600,PopperProps:{sx:{maxWidth:160}},title:(0,B.jsx)(o.cC,{id:"controls.section.show-confidence-interval.explanation"})})]}),t.options?.useAbbreviations&&(0,B.jsx)(rQ,{field:r,component:O})]})]}),t.options?.showDots&&(0,B.jsx)(nP,{fields:i.fields,field:r}),(0,eP.tJ)(i)&&"y"===t.field&&(0,B.jsx)(nt,{chartConfig:i,measures:c}),O&&(P||S)&&(0,B.jsx)(nh,{encoding:t,component:a,chartConfig:i,components:C,hasColorPalette:S,hasSubType:P,measures:c}),t.options?.imputation?.shouldShow(i,d)&&(0,B.jsx)(nf,{chartConfig:i}),t.options?.calculation&&rq()(m,"segment")&&(0,B.jsx)(r4,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?iD(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iD(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},t.options.calculation.getDisabledState?.(i))),"baseLayer"===r&&(0,B.jsx)(r2,{chartConfig:i}),"customLayers"===r&&(0,B.jsx)(io,{}),t.sorting&&a&&tB.B3.includes(a.__typename)&&(0,B.jsx)(nD,{chartConfig:i,field:r,encodingSortingOptions:t.sorting}),t.options?.size&&a&&(0,B.jsx)(n_,{chartConfig:i,field:r,componentTypes:t.options.size.componentTypes,optional:t.options.size.optional,dimensions:l,measures:c,getFieldOptionGroups:b}),k?(0,B.jsx)(nO,{chartConfig:i,dimensions:l,measure:k}):null,t.options?.colorComponent&&a&&(0,B.jsx)(r9,{chartConfig:i,encoding:t,component:a,componentTypes:t.options.colorComponent.componentTypes,dimensions:l,measures:c,optional:t.options.colorComponent.optional,enableUseAbbreviations:t.options.colorComponent.enableUseAbbreviations,getFieldOptionGroups:b}),T&&t.options?.convertUnit&&(0,B.jsx)(nc,{chartConfig:i,field:r,components:C}),(0,B.jsx)(nw,{chartConfig:i,component:a,encoding:t,field:r,dimensions:l,measures:c}),O&&"animation"===r&&(0,eP.Ab)(i)&&i.fields.animation&&(0,B.jsx)(r0,{field:i.fields.animation})]},`control-panel-${t.field}`)};var iA=r(92967),iL=r(4623),iF=r(52936),iN=r(98052),iR=r.n(iN),iG=r(14868),iV=r(68227),i$=r(41494),iU=r(59823),iz=r(11051);function iB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function iH(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?iB(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iB(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let iW=()=>(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(en.Jf,{}),(0,B.jsx)(iY,{}),(0,B.jsx)(iK,{}),(0,B.jsx)(iJ,{})]}),iY=()=>{let[e]=(0,eF.lY)(eF.VF),{layout:t}=e;return"dashboard"===t.type?(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-layout-options",collapse:!0,children:[(0,B.jsx)(ek.NZ,{id:"controls-layout-options",children:(0,B.jsx)(o.cC,{id:"controls.section.layout-options"})}),(0,B.jsx)(ek.kc,{gap:"none",children:(0,B.jsxs)(u.Z,{sx:{display:"flex",gap:"0.75rem",m:2},children:[(0,B.jsx)(i4,{type:"tall",layout:t}),(0,B.jsx)(i4,{type:"vertical",layout:t}),(0,B.jsx)(i4,{type:"canvas",layout:t})]})})]}):null},iK=()=>{let[e,t]=(0,eF.lY)(eF.VF),{layout:r}=e,{potentialTimeRangeFilterIds:n,potentialDataFilterIds:i}=(0,ea.Rx)(),{timeRange:s,dataFilters:a}=e.dashboardFilters??{},l=(0,es.bU)(),[{data:c,fetching:d}]=(0,ei.aZ)({variables:{state:e,locale:l}}),m=(0,x.useMemo)(()=>c?.dataCubesComponents.dimensions??[],[c?.dataCubesComponents.dimensions]),f=(0,i$.ls)(),h=(0,i$.z6)(),g=(0,iG.A)(),b=(0,eE.z)((e,r)=>{if(r){let e=(0,iz.M)({dimension:g,formatLocale:f,timeFormatUnit:h}),r=e.sortedOptions[0]?.date,n=e.sortedOptions.at(-1)?.date,i=rJ.Db[g.timeUnit];r&&n&&t({type:"DASHBOARD_TIME_RANGE_FILTER_UPDATE",value:{active:!0,timeUnit:g.timeUnit,presets:{from:i(r),to:i(n)}}})}else t({type:"DASHBOARD_TIME_RANGE_FILTER_REMOVE"})}),y=(0,eE.z)((e,r)=>{if(e){t({type:"DASHBOARD_DATA_FILTERS_SET",value:{componentIds:a?.componentIds?[...a.componentIds,r].sort((e,t)=>(m.find(t=>t.id===e)?.order??m.findIndex(t=>t.id===e)??0)-(m.find(e=>e.id===t)?.order??m.findIndex(e=>e.id===t)??0)):[r],filters:a?.filters??{}}});let e=m.find(e=>e.id===r)?.values[0].value;t({type:"FILTER_SET_SINGLE",value:{filters:[{cubeIri:"",dimensionId:r}],value:e}})}else t({type:"DASHBOARD_DATA_FILTER_REMOVE",value:{dimensionId:r}}),t({type:"FILTER_REMOVE_SINGLE",value:{filters:[{cubeIri:"",dimensionId:r}]}})});switch(r.type){case"tab":case"dashboard":if((!s||0===n.length)&&(!a||0===i.length))return null;return(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-shared-filters",collapse:!0,children:[(0,B.jsx)(ek.NZ,{id:"controls-shared-filters",children:(0,B.jsx)(o.cC,{id:"controls.section.shared-filters"})}),(0,B.jsx)(ek.kc,{children:(0,B.jsxs)(tQ.Z,{gap:"0.5rem",children:[s&&g.values.length?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,B.jsx)(p.Z,{variant:"body3",children:g.label}),(0,B.jsx)(iF.Z,{"data-testid":"dashboard-time-range-filter-toggle",checked:s.active,onChange:b})]}),s.active?(0,B.jsx)(iq,{timeRangeFilter:s,timeRangeCombinedDimension:g}):null]}):null,a?(0,B.jsx)(B.Fragment,{children:i.map((e,t)=>{let r=m.find(t=>t.id===e);if(!r)return null;let n=a.componentIds.includes(r.id);return(0,B.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,B.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,B.jsx)(p.Z,{variant:"body3",children:r.label}),(0,B.jsx)(iF.Z,{checked:n,onChange:(e,t)=>{y(t,r.id)}})]}),n?(0,B.jsx)(u.Z,{sx:{mb:1},children:(0,B.jsx)(rG,{rawDimension:r,filterDimensionIds:[],index:t,disabled:d,disableLabel:!0})}):null]},r.id)})}):null]})})]});default:return null}},iq=e=>{let{timeRangeFilter:t,timeRangeCombinedDimension:r}=e;return t&&(0,tB.pR)(r)&&(0,rE.H)(r.timeUnit)?(0,B.jsx)(iX,{filter:t,dimension:r}):null},iX=e=>{let{filter:t,dimension:r}=e,{timeUnit:n,timeFormat:i}=r,o=(0,i$.z6)(),a=(0,i$.ls)(),l=a.format(i),c=a.parse(i),[d,p]=(0,eF.lY)(),m=(0,ea.Rx)(),{sortedOptions:f,sortedValues:h}=(0,x.useMemo)(()=>(0,iz.M)({dimension:r,formatLocale:a,timeFormatUnit:o}),[r,a,o]),g=f[0].date,b=f[f.length-1].date,y=[c(t.presets.from),c(t.presets.to)],v=(0,x.useCallback)(e=>{Object.entries(m.stores).forEach(t=>{let[r,[n]]=t,{interactiveFiltersConfig:i}=(0,er.f6)(d,r),o=n(),{from:s,to:a}=o.timeRange,l=o.setTimeRange;s&&a&&i.timeRange.componentId&&l(e,a)})},[m.stores,d]),j=(0,x.useCallback)(e=>{Object.entries(m.stores).forEach(t=>{let[r,[n]]=t,{interactiveFiltersConfig:i}=(0,er.f6)(d,r),o=n(),{from:s,to:a}=o.timeRange,l=o.setTimeRange;s&&a&&i.timeRange.componentId&&l(s,e)})},[m.stores,d]);return(0,B.jsx)("div",{children:(0,B.jsxs)(tQ.Z,{"data-testid":"dashboard-time-range-filters",direction:"row",gap:"0.5rem",alignItems:"center",divider:(0,B.jsx)(u.Z,{position:"relative",top:"0.5rem",children:"-"}),children:[(0,rE.H)(n)?(0,B.jsx)(rE.b,{name:"dashboard-time-range-filter-from",value:y[0],onChange:e=>{let r=c(e.target.value);r&&(p({type:"DASHBOARD_TIME_RANGE_FILTER_UPDATE",value:iH(iH({},t),{},{presets:iH(iH({},t.presets),{},{from:l(r)})})}),v(r))},isDateDisabled:e=>e>y[1]||!h.includes(l(e)),timeUnit:n,dateFormat:l,minDate:g,maxDate:b,label:s.ag._({id:"controls.filters.select.from"}),parseDate:c}):(0,B.jsx)(X.Ph,{id:"dashboard-time-range-filter-from",label:s.ag._({id:"controls.filters.select.from"}),options:f,value:t.presets.from,onChange:e=>{p({type:"DASHBOARD_TIME_RANGE_FILTER_UPDATE",value:iH(iH({},t),{},{presets:iH(iH({},t.presets),{},{from:e.target.value})})});let r=c(e.target.value);r&&v(r)}}),(0,rE.H)(n)?(0,B.jsx)(rE.b,{name:"dashboard-time-range-filter-to",value:y[1],onChange:e=>{let r=c(e.target.value);r&&(p({type:"DASHBOARD_TIME_RANGE_FILTER_UPDATE",value:iH(iH({},t),{},{presets:iH(iH({},t.presets),{},{to:l(r)})})}),j(r))},isDateDisabled:e=>e<y[0]||!h.includes(l(e)),timeUnit:n,dateFormat:l,minDate:g,maxDate:b,label:s.ag._({id:"controls.filters.select.to"}),parseDate:c}):(0,B.jsx)(X.Ph,{id:"dashboard-time-range-filter-to",label:s.ag._({id:"controls.filters.select.to"}),options:f,value:t.presets.to,onChange:e=>{p({type:"DASHBOARD_TIME_RANGE_FILTER_UPDATE",value:iH(iH({},t),{},{presets:iH(iH({},t.presets),{},{to:e.target.value})})});let r=c(e.target.value);r&&j(r)}})]})})},iJ=()=>{let e=(0,es.bU)(),[t,r]=(0,eF.lY)(eF.VF),{layout:n}=t,{blocks:i}=n,s=iQ(),a=(0,eE.z)(e=>{r({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:e})});return"dashboard"===n.type?(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-blocks",collapse:!0,children:[(0,B.jsx)(ek.NZ,{id:"controls-blocks",children:(0,B.jsx)(o.cC,{id:"controls.section.block-options"})}),(0,B.jsxs)(ek.kc,{gap:"none",children:[(0,B.jsx)("div",{children:i.filter(e=>"text"===e.type).map(r=>(0,B.jsx)(eY.Ko,{id:`tab-block-${r.key}`,mainLabel:(0,B.jsx)("div",{style:{pointerEvents:"none"},children:(0,B.jsx)(eB.UG,{children:r.text[e]})}),checked:t.layout.activeField===r.key,onClick:()=>a(r.key),value:t.layout.activeField??"",icon:"text",rightIcon:(0,B.jsx)(eq.JO,{className:s.tabRightIcon,name:"pen"})},r.key))}),(0,B.jsx)(i0,{})]})]}):null},iQ=(0,P.Z)(e=>({tabRightIcon:{color:e.palette.primary.main}})),i0=()=>{let[e,t]=(0,eF.lY)(eF.VF),{layout:r}=e,{0:n,1:i}=(0,x.useState)(null),s=(0,eE.z)(e=>{i(e.currentTarget)}),a=(0,eE.z)(()=>{i(null)}),l=(0,eE.z)(()=>{let e=(0,iU.M)();t({type:"LAYOUT_CHANGED",value:iH(iH({},r),{},{blocks:[...r.blocks,{type:"text",key:e,text:{de:"",fr:"",it:"",en:""},initialized:!1}]})}),t({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:e}),a()}),c=i1();return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(tf.Y,{onClick:s,children:(0,B.jsx)(o.cC,{id:"controls.section.block-options.block-add"})}),(0,B.jsx)(e4.Z,{anchorEl:n,open:!!n,onClose:a,children:(0,B.jsxs)(e3.Z,{className:c.menuItem,onClick:l,children:[(0,B.jsx)(eq.JO,{name:"text",className:c.menuItemIcon}),(0,B.jsx)(p.Z,{className:c.menuItemText,variant:"body2",children:(0,B.jsx)(o.cC,{id:"controls.section.block-options.block-add.text"})})]})})]})},i1=(0,P.Z)(e=>({menuItem:{minWidth:200,padding:e.spacing(3)},menuItemIcon:{marginRight:"0.75rem"},menuItemText:{color:e.palette.grey[700]}})),i2=(e,t,r)=>{if("canvas"!==t)return iH(iH({},ez()(e,"layouts")),{},{layout:t});{let n=(0,iV.C)({count:r.length,layout:"tiles"}).map((e,t)=>iH(iH({},e),{},{i:r[t].key}));return iH(iH({},e),{},{layout:t,layouts:{xl:n,lg:n,md:n,sm:n},blocks:r.map(e=>iH(iH({},e),{},{initialized:!1}))})}},i4=e=>{let{type:t,layout:r}=e,[n,i]=(0,eF.lY)(eF.VF),o=(0,x.useRef)(),s=r.layout===t;(0,x.useEffect)(()=>{s&&(o.current=r),o.current&&(o.current.blocks=r.blocks)},[r,s]);let a=(0,eE.z)(()=>{o.current?.layout===t?i({type:"LAYOUT_CHANGED",value:o.current}):i({type:"LAYOUT_CHANGED",value:i2(r,t,n.layout.blocks)})});return(0,B.jsx)(iA.h,{label:`layout${iR()(t)}`,checked:s,onClick:a})};var i3=r(43922),i7=r(64141),i6=r(65098),i5=r(90453);let i9=()=>{let{0:e,1:t}=(0,x.useState)(null);return{previewBreakpoint:e,setPreviewBreakpoint:t}},i8=e=>{let{children:t,breakpoint:r,singleColumn:n}=e,i=ot(),{breakpoints:o}=(0,i3.Z)(),s=(0,x.useMemo)(()=>{if(r)switch(r){case"xl":return o.values.lg-1;case"lg":return o.values.md-1;case"md":return o.values.sm-1;case"sm":return iV.$X.md;default:return r}return n?i5.r.breakpoints.values.lg-1:"100%"},[r,o,n]);return(0,B.jsx)("div",{className:i.container,children:(0,B.jsx)("div",{className:i.chartContainer,style:{width:s,paddingTop:r?"0.5rem":0},children:t})})},oe=e=>{let{value:t,onChange:r}=e,n=ot(),i=[{breakpoint:"xl",iconName:"desktop",title:s.ag._({id:"controls.layout.preview-xl"})},{breakpoint:"lg",iconName:"laptop",title:s.ag._({id:"controls.layout.preview-lg"})},{breakpoint:"md",iconName:"tablet",title:s.ag._({id:"controls.layout.preview-md"})},{breakpoint:"sm",iconName:"mobile",title:s.ag._({id:"controls.layout.preview-sm"})}];return(0,B.jsx)(i7.Z,{className:n.toggleButtonGroup,value:t,exclusive:!0,children:i.map(e=>{let{breakpoint:i,iconName:o,title:s}=e;return[(0,B.jsx)(c.Z,{title:s,arrow:!0,enterDelay:1e3,children:(0,B.jsx)(i6.Z,{className:(0,k.Z)(n.toggleButton,{[n.toggleButtonSelected]:t===i}),value:i,onClick:()=>r(i),children:(0,B.jsx)(eq.JO,{name:o,size:16})})},`${i}-tooltip`),"sm"!==i?(0,B.jsx)(tZ.Z,{className:n.divider,orientation:"vertical",flexItem:!0},`${i}-divider`):null]})})},ot=(0,P.Z)(e=>({container:{width:"100%",height:"calc(100% - 2rem)",overflowY:"auto",padding:e.spacing(6,0,6,6)},chartContainer:{margin:"0 auto",paddingBottom:"2rem",paddingRight:e.spacing(6)},toggleButtonGroup:{marginLeft:"auto",backgroundColor:e.palette.background.paper},toggleButton:{border:"none",backgroundColor:e.palette.background.paper,color:e.palette.text.primary,"&:hover":{backgroundColor:e.palette.background.paper,color:e.palette.primary.main}},toggleButtonSelected:{color:e.palette.primary.main},divider:{alignSelf:"center",borderLeft:`2px solid ${e.palette.divider} !important`,height:16,marginLeft:"-1px !important",backgroundColor:e.palette.divider}})),or=["className","variant"];function on(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function oi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?on(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):on(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let oo=(0,P.Z)(e=>({root:{display:"flex",justifyContent:"center",alignItems:"center",width:42,height:32,background:e.palette.background.paper,color:e.palette.primary.main,"&:hover":{background:e.palette.background.paper}}})),os=e=>{let{className:t,variant:r="text"}=e,n=(0,i.Z)(e,or),o=oo();return(0,B.jsx)(m.Z,oi(oi({className:(0,k.Z)(o.root,t)},n),{},{children:(0,B.jsx)(eq.JO,{name:"doublearrow"})}))};var oa=r(90706);function ol(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function oc(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ol(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ol(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let od=(0,P.Z)(e=>({filterRow:{display:"grid",gridTemplateColumns:"auto min-content",overflow:"hidden",width:"100%",gridColumnGap:e.spacing(2),gridTemplateRows:"min-content min-content",gridTemplateAreas:'"description drag-button" "select drag-button"',"& > *":{overflow:"hidden"}},dragButtons:{gridArea:"drag-button",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:0,flexShrink:0,marginRight:e.spacing(4)}})),ou=e=>{let{id:t,title:r,items:n,dimensions:i,measures:s,isDropDisabled:a,emptyComponent:l}=e,c=od(),d=[...i,...s];return(0,B.jsx)(to.bK,{droppableId:t,isDropDisabled:a,children:e=>{let{innerRef:i,placeholder:s}=e;return(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{children:r}),(0,B.jsx)(ek.kc,{role:"tablist","aria-labelledby":`controls-${t}`,px:"none",children:(0,B.jsxs)("div",{ref:i,style:{position:"relative",minHeight:60,padding:0},children:[0===n.length&&l?l:null,n.map((e,t)=>{let{componentId:r,index:n,isHidden:i}=e;return(0,B.jsx)(to._l,{draggableId:r,index:t,children:(e,t)=>{let{innerRef:s,draggableProps:a,dragHandleProps:l}=e,{isDragging:p}=t,m=d.find(e=>e.id===r);return(0,B.jsxs)(u.Z,oc(oc(oc({ref:s},a),l),{},{className:c.filterRow,children:[m?(0,B.jsx)(op,{component:m,value:r,upperLabel:(0,B.jsx)(o.cC,{id:"table.column.no",values:{0:n+1}}),isDragging:p,disabled:i},r):null,(0,B.jsx)(u.Z,{className:c.dragButtons,children:(0,B.jsx)(tc,{})})]}))}},r)}),s]})})]})}})},op=e=>{let{component:t,value:r,isDragging:n,upperLabel:i,disabled:o}=e,s=(0,oa.jX)({value:r}),a=(0,rJ.tc)(`tableColumn${t.__typename}${o?"Hidden":""}`);return(0,B.jsx)(eY.W5,{component:t,value:`${s.value}`,upperLabel:i,checked:s.checked,onClick:s.onClick,isDragging:n,disabled:o,iconName:a})};var om=r(7608);let of=e=>{let{chartConfig:t,dimensions:r}=e,n=(0,es.bU)(),[i,a]=(0,eF.lY)(eF.N3),l=(0,x.useMemo)(()=>r.map(e=>({value:e.id,label:e.label})),[r]),c=(0,eE.z)(e=>{let r=e.target.value;a({type:"CHART_FIELD_UPDATED",value:{locale:n,field:null,path:"links.componentId",value:r}}),""===t.links.targetComponentId&&a({type:"CHART_FIELD_UPDATED",value:{locale:n,field:null,path:"links.targetComponentId",value:r}})}),d=(0,eE.z)(e=>{a({type:"CHART_FIELD_UPDATED",value:{locale:n,field:null,path:"links.targetComponentId",value:e.target.value}})});return(0,B.jsxs)(ek.rE,{collapse:!0,defaultExpanded:!1,children:[(0,B.jsx)(ek.NZ,{id:"controls-links",children:(0,B.jsx)(o.cC,{id:"controls.section.links"})}),(0,B.jsxs)(ek.kc,{children:[(0,B.jsx)(eD.xh,{label:s.ag._({id:"controls.tableSettings.showLinks"}),field:null,path:"links.enabled"}),(0,B.jsx)(oh,{value:t.links.baseUrl,disabled:!t.links.enabled}),(0,B.jsx)(X.Ph,{id:"links.componentId",size:"sm",label:s.ag._({id:"controls.tableSettings.linkComponentId"}),options:l,value:t.links.componentId,name:"links.componentId",disabled:!t.links.enabled,onChange:c}),(0,B.jsx)(X.Ph,{id:"links.targetComponentId",size:"sm",label:s.ag._({id:"controls.tableSettings.targetComponentId"}),options:l,value:t.links.targetComponentId,name:"links.targetComponentId",disabled:!t.links.enabled,onChange:d})]})]})},oh=e=>{let{value:t,disabled:r}=e,n=(0,es.bU)(),[i,o]=(0,eF.lY)(eF.N3),{0:a,1:l}=(0,x.useState)(t),{0:c,1:d}=(0,x.useState)(!0);(0,x.useEffect)(()=>{l(t)},[t]);let u=(0,eE.z)(e=>{o({type:"CHART_FIELD_UPDATED",value:{locale:n,field:null,path:"links.baseUrl",value:e}})}),p=(0,eE.z)(()=>{if(""===a){d(!0),u("");return}let e=(0,om.N)(a);if("about:blank"===e){d(!1),u("");return}try{let t=new URL(e),r=og(t);u(r),d(!0),l(r)}catch{d(!1)}}),m=(0,eE.z)(e=>{"Enter"===e.key&&p()});return(0,B.jsx)(X.II,{type:"url",label:s.ag._({id:"controls.tableSettings.baseUrl"}),name:"links.baseUrl",placeholder:"https://example.com/",value:a,disabled:r,error:!c,errorMessage:s.ag._({id:"controls.tableSettings.baseUrlInvalid"}),onChange:e=>l(e.target.value),onBlur:p,onKeyDown:m})},og=e=>(e.pathname.endsWith("/")||(e.pathname=e.pathname+"/"),e.toString()),ob=e=>{let t=(0,es.bU)(),[,r]=(0,eF.lY)(eF.N3),n=(0,er.f6)(e),[{data:i}]=(0,ei.k$)({chartConfig:n,variables:{sourceType:e.dataSource.type,sourceUrl:e.dataSource.url,locale:t,cubeFilters:n.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy,loadValues:!0}))}}),{0:o,1:s}=(0,x.useState)(null),a=(0,x.useCallback)(e=>{let{source:t,destination:o}=e;s(null),o&&"table"===n.chartType&&i?.dataCubesComponents&&r({type:"CHART_CONFIG_REPLACED",value:{chartConfig:ic(n,{source:t,destination:o}),dataCubesComponents:i.dataCubesComponents}})},[n,i?.dataCubesComponents,r]),l=(0,x.useCallback)(e=>{let{draggableId:t}=e;s(t)},[]);return{dimensions:i?.dataCubesComponents.dimensions,measures:i?.dataCubesComponents.measures,currentDraggableId:o,handleDragStart:l,handleDragEnd:a,chartConfig:n}},oy=(0,P.Z)(e=>({emptyGroups:{textAlign:"center",border:"1px dashed",borderColor:e.palette.divider,margin:e.spacing(2),color:e.palette.text.secondary,borderRadius:8,padding:e.spacing(2)}})),ov=()=>{let e=oy();return(0,B.jsx)(p.Z,{variant:"body3",component:"div",className:e.emptyGroups,children:(0,B.jsx)(o.cC,{id:"controls.groups.empty-help"})})},oj=e=>{let{state:t}=e,{dimensions:r,measures:n,currentDraggableId:i,chartConfig:a,handleDragEnd:l,handleDragStart:c}=ob(t),d=(0,rJ.Km)(a.fields);if(!r||!n)return(0,B.jsx)(Q.gb,{});let u=[...d.filter(e=>e.isGroup)],p=[...d.filter(e=>!e.isGroup)],m=null!==i?a.fields[i]:null,f=m?.componentType==="NumericalMeasure";return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(rZ,{}),(0,B.jsxs)(ek.rE,{role:"tablist","aria-labelledby":"controls-chart-type",collapse:!0,children:[(0,B.jsx)(ek.NZ,{id:"controls-chart-type",children:(0,B.jsx)(o.cC,{id:"controls.select.chart.type"})}),(0,B.jsx)(ek.kc,{gap:"none",children:(0,B.jsx)(tv.M,{showHelp:!1,state:t,chartKey:a.key})})]}),(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{children:(0,B.jsx)(o.cC,{id:"controls.section.tableoptions"})}),(0,B.jsx)(ek.kc,{gap:"none",px:"none",role:"tablist","aria-labelledby":"controls-settings",children:(0,B.jsx)(eD.c4,{value:"table-sorting",icon:"sort",mainLabel:(0,B.jsx)(o.cC,{id:"controls.table.sorting"})},"sorting")})]}),(0,B.jsxs)(ek.rE,{collapse:!0,children:[(0,B.jsx)(ek.NZ,{id:"controls-data",children:(0,B.jsx)(o.cC,{id:"controls.section.data.filters"})}),(0,B.jsxs)(ek.kc,{sx:{my:2},children:[(0,B.jsx)(ty,{chartConfig:a}),(0,B.jsx)(eD.xh,{label:s.ag._({id:"controls.tableSettings.showSearch"}),field:null,path:"settings.showSearch"})]})]}),(0,B.jsxs)(to.Z5,{onDragEnd:e=>l({source:e.source,destination:e.destination}),onDragStart:c,children:[(0,B.jsx)(ou,{id:"groups",title:(0,B.jsx)(o.cC,{id:"controls.section.groups"}),dimensions:r,measures:n,items:u,isDropDisabled:f,emptyComponent:(0,B.jsx)(ov,{})}),(0,B.jsx)(ou,{id:"columns",title:(0,B.jsx)(o.cC,{id:"controls.section.columns"}),dimensions:r,measures:n,items:p})]}),(0,B.jsx)(of,{chartConfig:a,dimensions:r})]})};var ox=r(37268),oC=r(57906),oO=r(37079),ow=r(31853),oI=r(37457),oS=r(37882),oP=r.n(oS);let ok=(e,t)=>oP()(e,/(\[.*\]\(.*\))/,e=>{let r=e.indexOf("](");return t(e.slice(1,r),e.slice(r+2,e.length-1))});var o_=r(35904);let oT=["size","children","onClick"];function oD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function oZ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oD(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oD(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let oE=e=>{let{size:t="xs",children:r,onClick:n}=e,o=(0,i.Z)(e,oT);return(0,B.jsx)(m.Z,oZ(oZ({variant:"outlined",size:t,startIcon:(0,B.jsx)(eq.JO,{name:"arrowLeft",size:20}),onClick:n},o),{},{children:r}))},oM=e=>"title"===e||"description"===e||"label"===e,oA=e=>{let[t]=(0,eF.lY)(),{dataSource:r,setDataSource:n}=(0,oC.qo)();(0,x.useEffect)(()=>{t.state===e&&t.dataSource.url!==r.url&&n(t.dataSource)},[r.url,n,t.dataSource,t.state,e])},oL=e=>{let{children:t}=e,r=(0,es.bU)(),[n,i]=(0,eF.lY)(eF.Sc),o=(0,er.f6)(n),s=(0,I.Xd)({chartConfig:o}),[{data:a}]=(0,ei.k$)({chartConfig:o,variables:{sourceType:n.dataSource.type,sourceUrl:n.dataSource.url,locale:r,cubeFilters:o.cubes.map(e=>({iri:e.iri,componentIds:s,filters:e.filters,joinBy:e.joinBy,loadValues:!0}))}}),l=(0,eE.z)(()=>{a?.dataCubesComponents&&i({type:"STEP_NEXT",dataCubesComponents:a.dataCubesComponents})});return(0,B.jsx)(m.Z,{variant:"contained",size:"sm",endIcon:(0,B.jsx)(eq.JO,{name:"arrowRight",size:20}),onClick:l,children:t})},oF=e=>{let{chartId:t}=e,{data:r,invalidate:n}=(0,ox.h2)(t),i=(0,v.useSession)(),u=(0,C.m8)(),[p,h]=(0,eF.lY)(),[g,j,x]=eS(),[w]=(0,O.Z)(g,500),{asPath:I,replace:S}=(0,y.useRouter)(),P=(0,o_.Tu)(oO._g),k=(0,o_.Tu)(oO.rF),_=i.data?.user.id,T=(0,a.Z)(async()=>{try{if(r?.user_id&&_){let e=await k.mutate({data:p,published_state:f.PUBLISHED_STATE.DRAFT,key:r.key});if(e)I!==`/create/${e.key}`&&S(`/create/new?edit=${e.key}`);else throw Error("Could not update draft")}else if(p){let e=await P.mutate({data:p,user_id:_,published_state:f.PUBLISHED_STATE.DRAFT});if(e){let t=await (0,eF.TM)(u,e.key,p.state);if(!t)return;h({type:"INITIALIZED",value:t}),(0,eF.P3)(e.key,t),S(`/create/${e.key}`,void 0,{shallow:!0})}else throw Error("Could not save draft")}j({message:(0,B.jsx)(B.Fragment,{children:ok(s.ag._({id:"button.save-draft.saved"}),(e,t)=>(0,B.jsx)("div",{children:(0,B.jsx)(b(),{href:t,passHref:!0,legacyBehavior:!0,children:(0,B.jsx)(l.Z,{sx:{color:"primary.main"},children:e})})}))}),variant:"success"}),n()}catch(e){console.log(`Error while saving draft: ${e instanceof Error?e.message:e}`),j({message:s.ag._({id:"button.save-draft.error"}),variant:"error"})}setTimeout(()=>{k.reset(),P.reset()},2e3)}),D=!!(k.data||P.data),[Z]=(0,O.Z)(D,300);return _?(0,B.jsx)(c.Z,{arrow:!0,title:w?.message??"",open:!!g,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,onClose:()=>x(),children:(0,B.jsx)(m.Z,{variant:"outlined",size:"sm",endIcon:D||Z?(0,B.jsx)(d.Z,{in:D,children:(0,B.jsx)("span",{children:(0,B.jsx)(eq.JO,{name:"checkmark"})})}):null,onClick:T,children:(0,B.jsx)(o.cC,{id:"button.save-draft"})})}):null},oN=()=>{let e=(0,es.bU)(),[t]=(0,eF.lY)();return(0,B.jsx)(c.Z,{title:s.ag._({id:"button.copy-preview-link.explanation"}),disableInteractive:!0,children:(0,B.jsx)(m.Z,{size:"sm",variant:"outlined",onClick:()=>{let r=(0,ow.W)(t);h.nx(`${window.origin}/${e}/preview${r}`),(0,j.yv)({message:s.ag._({id:"button.copy-preview-link.success"}),variant:"success"})},children:(0,B.jsx)(o.cC,{id:"button.copy-preview-link"})})})},oR=()=>(0,B.jsx)(oL,{children:(0,B.jsx)(o.cC,{id:"button.layout"})}),oG=e=>{let{chartId:t}=e,r=(0,v.useSession)(),{data:n}=(0,ox.h2)(t),i=r.data?.user.id&&n?.user_id===r.data.user.id&&"PUBLISHED"===n.published_state;return(0,B.jsx)(oL,{children:i?(0,B.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,B.jsx)(c.Z,{title:s.ag._({id:"button.update.warning"}),children:(0,B.jsx)("div",{children:(0,B.jsx)(eq.JO,{name:"warningCircle"})})}),(0,B.jsx)(o.cC,{id:"button.update"})]}):(0,B.jsx)(o.cC,{id:"button.publish"})})},oV=()=>{let[e,t]=(0,eF.lY)(),r=(0,eF.N3)(e),n=(0,er.f6)(e),i=(0,y.useRouter)(),s=(0,eE.z)(()=>{t({type:"CHART_ACTIVE_FIELD_CHANGE",value:void 0})}),a=(0,eE.z)(()=>{r&&i.push({pathname:"/browse",query:{dataset:n.cubes[0].iri}},void 0,{shallow:!0})});if(oA("CONFIGURING_CHART"),!r)return null;let l=(0,oI.vf)(i.asPath);return(0,B.jsx)(ea.Zg,{chartConfigKey:n.key,children:(0,B.jsxs)(iL.LN,{type:"LM",children:[(0,B.jsxs)(iL.pd,{type:"LMR",children:[(0,B.jsx)(iL.re,{type:"L",children:(0,B.jsx)(oE,{size:"sm",onClick:a,children:(0,B.jsx)(o.cC,{id:"controls.nav.back-to-preview"})})}),(0,B.jsxs)(iL.re,{type:"R",sx:{display:"flex",flexShrink:0,alignItems:"start",justifyContent:"flex-end",gap:"0.5rem"},children:[(0,B.jsx)(oN,{}),(0,B.jsx)(oF,{chartId:l}),(0,eP.qB)(e)?(0,B.jsx)(oR,{}):(0,B.jsx)(oG,{chartId:l})]})]}),(0,B.jsx)(iL.V6,{type:"L",style:{flexGrow:1,display:"flex",height:"100%",flexDirection:"column"},children:"table"===n.chartType?(0,B.jsx)(oj,{state:e}):(0,B.jsx)(rH,{state:e},`${n.key}_${n.cubes.length}`)}),(0,B.jsx)(iL.V6,{type:"M",sx:{overflowX:"hidden",overflowY:"auto",p:6},children:(0,B.jsx)(ey,{dataSource:e.dataSource})}),(0,B.jsx)(eK.oe,{anchor:"left",open:!!n.activeField,hideBackdrop:!0,onClose:s,children:(0,B.jsx)("div",{"data-testid":"panel-drawer",style:{display:"flex",flexDirection:"column",flex:1,width:eK.pG},children:oM(n.activeField)?(0,B.jsx)(eM,{}):(0,eW.c)(n.activeField)?(0,B.jsx)(eJ,{}):(0,B.jsx)(iZ,{})})})]})})},o$=()=>{let e=(0,es.bU)(),[t,r]=(0,eF.lY)(eF.VF),n=(0,eE.z)(()=>{r({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:void 0})}),i=(0,eE.z)(()=>{"LAYOUTING"===t.state&&r({type:"STEP_PREVIOUS"})});oA("LAYOUTING");let{asPath:s}=(0,y.useRouter)(),a=(0,x.useRef)(t.layout);(0,x.useEffect)(()=>{a.current?.type===t.layout.type&&(a.current=t.layout)},[t.layout]);let{previewBreakpoint:l,setPreviewBreakpoint:c}=i9(),d=(0,x.useCallback)((e,n)=>{e!==t.layout.type&&(a.current?.type===e?r({type:"LAYOUT_CHANGED",value:oZ(oZ({},a.current),{},{meta:t.layout.meta,activeField:void 0})}):n(),c(null))},[r,c,t.layout.meta,t.layout.type]);if("LAYOUTING"!==t.state)return null;let m="singleURLs"===t.layout.type,f=(0,oI.vf)(s),h=!!(m||l);return(0,B.jsxs)(iL.LN,{type:h?"M":"LM",children:[(0,B.jsxs)(iL.pd,{type:"LMR",children:[(0,B.jsx)(iL.re,{type:"L",children:(0,B.jsx)(oE,{size:"sm",onClick:i,children:(0,B.jsx)(o.cC,{id:"controls.nav.back-to-configurator"})})}),(0,B.jsxs)(iL.re,{type:"M",sx:{display:"flex",gap:4,mx:"auto"},children:[(0,B.jsx)(iA.h,{label:"layoutTab",checked:"tab"===t.layout.type,onClick:()=>d("tab",()=>{r({type:"LAYOUT_CHANGED",value:{type:"tab",meta:t.layout.meta,blocks:t.layout.blocks,activeField:void 0}})})}),(0,B.jsx)(iA.h,{label:"layoutDashboard",checked:"dashboard"===t.layout.type,onClick:()=>d("dashboard",()=>{r({type:"LAYOUT_CHANGED",value:{type:"dashboard",meta:t.layout.meta,blocks:t.layout.blocks,layout:"tall",activeField:void 0}})})}),(0,B.jsx)(iA.h,{label:"layoutSingleURLs",checked:"singleURLs"===t.layout.type,onClick:()=>d("singleURLs",()=>{r({type:"LAYOUT_CHANGED",value:{type:"singleURLs",publishableChartKeys:t.chartConfigs.map(e=>e.key),meta:t.layout.meta,blocks:t.layout.blocks,activeField:void 0}})})})]}),(0,B.jsxs)(iL.re,{type:"R",sx:{display:"flex",alignItems:"start",justifyContent:"flex-end",gap:"0.5rem"},children:[(0,B.jsx)(oN,{}),(0,B.jsx)(oF,{chartId:f}),(0,B.jsx)(oG,{chartId:f})]})]}),(0,B.jsx)(iL.V6,{type:"L",sx:{zIndex:2,position:"absolute",left:h?-eK.pG:0,top:h?iL.Hq:0,width:eK.pG,height:"100%",transition:"left 0.3s"},children:(0,B.jsx)(iW,{})}),(0,B.jsxs)(iL.V6,{type:"M",style:{overflowY:"hidden",overflowX:"auto"},children:[(0,B.jsxs)(u.Z,{sx:{display:"flex",px:6,py:4},children:[!m&&l&&(0,B.jsx)(os,{onClick:()=>c(null)}),(0,B.jsx)(oe,{value:l,onChange:e=>{r({type:"LAYOUT_CHANGED",value:oZ(oZ({},t.layout),{},{activeField:void 0})}),c(l===e?null:e)}})]}),(0,B.jsxs)(i8,{breakpoint:l,singleColumn:m,children:[(0,B.jsx)(u.Z,{sx:{display:"flex",flexDirection:"column",gap:1,mt:3,mb:m?6:4},children:m?(0,B.jsx)(p.Z,{variant:"h3",sx:{fontWeight:"normal",color:"secondary.active"},children:(0,B.jsx)(o.cC,{id:"controls.layout.singleURLs.publish"})}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(en.Dx,{text:t.layout.meta.title[e],onClick:()=>{"title"!==t.layout.activeField&&r({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:"title"})}}),(0,B.jsx)(en.dk,{text:t.layout.meta.description[e],onClick:()=>{"description"!==t.layout.activeField&&r({type:"LAYOUT_ACTIVE_FIELD_CHANGE",value:"description"})}})]})}),(0,B.jsx)(ey,{dataSource:t.dataSource},l)]})]}),(0,B.jsx)(eK.oe,{anchor:"left",open:!!t.layout.activeField,hideBackdrop:!0,onClose:n,children:(0,B.jsx)("div",{style:{width:eK.pG},"data-testid":"panel-drawer",children:oM(t.layout.activeField)?(0,B.jsx)(eA,{}):(0,B.jsx)(eG,{})})})]})},oU=()=>{let[e]=(0,eF.lY)();return"PUBLISHING"!==e.state?null:(0,B.jsx)(iL.LN,{type:"LM",children:(0,B.jsx)(iL.V6,{type:"M",sx:{p:6},children:(0,B.jsx)(ey,{dataSource:e.dataSource})})})},oz=()=>{let{pathname:e}=(0,y.useRouter)(),[t]=(0,eF.lY)(),r="INITIAL"===t.state&&"/create/[chartId]"===e,n=(0,x.useMemo)(()=>(0,ee.ag)(),[]);return r?(0,B.jsx)(oB,{}):"SELECTING_DATASET"===t.state?(0,B.jsx)(w.c,{variant:"page"}):"INITIAL"===t.state?null:(0,B.jsxs)(ea.ch,{chartConfigs:t.chartConfigs,children:["CONFIGURING_CHART"===t.state&&(0,B.jsx)(ee.ax.Provider,{value:n,children:(0,B.jsx)(oV,{})}),"LAYOUTING"===t.state&&(0,B.jsx)(o$,{}),"PUBLISHING"===t.state&&(0,B.jsx)(oU,{})]})},oB=()=>(0,B.jsx)(u.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:`calc(100vh - ${J.r})`},children:(0,B.jsx)(Q.gb,{delayMs:0})})},23733:function(e,t,r){"use strict";r.d(t,{CY:function(){return m},Po:function(){return y},TZ:function(){return h},_y:function(){return f},b3:function(){return g}});var n=r(17043),i=r(28907),o=r(99729),s=r.n(o),a=r(27378),l=r(25390),c=r(15658),d=r(77142);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let m=()=>{let[e,t]=(0,c.lY)(c.N3),r=(0,l.f6)(e),n=(0,d.z)(e=>{r.interactiveFiltersConfig.legend&&t({type:"INTERACTIVE_FILTER_CHANGED",value:(0,i.ZP)(r.interactiveFiltersConfig,t=>{t.legend.active=e.currentTarget.checked})})}),o=s()(r,"interactiveFiltersConfig.legend.active");return{name:"legend",checked:!!o&&o,onChange:n}},f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",[r,n]=(0,c.lY)(c.N3),i=(0,l.f6)(r),o=(0,d.z)(()=>{let{interactiveFiltersConfig:r}=i;n({type:"INTERACTIVE_FILTER_CHANGED",value:h(r,e,void 0,t)})});return{name:"dataFilters",checked:i.interactiveFiltersConfig.dataFilters.componentIds.includes(e),onChange:o}},h=(0,i.ZP)((e,t,r,n)=>{let i=e.dataFilters.componentIds,o=void 0===r?!i.includes(t):r,s=o?[...i,t]:e.dataFilters.componentIds.filter(e=>e!==t),a=p({},e.dataFilters.defaultValueOverrides);o||delete a[t];let l=p({},e.dataFilters.filterTypes);o?n&&(l[t]=n):delete l[t];let c=p(p({},e.dataFilters),{},{componentIds:s,defaultValueOverrides:a,filterTypes:l});return c.active=s.length>0,p(p({},e),{},{dataFilters:c})}),g=()=>{let[e,t]=(0,c.lY)(c.N3),r=(0,l.f6)(e),n=(0,d.z)(()=>{let{interactiveFiltersConfig:e}=r;t({type:"INTERACTIVE_FILTER_CHANGED",value:b(e)})});return{checked:r.interactiveFiltersConfig.timeRange.active,toggle:n}},b=e=>{if(!e?.timeRange)return e;let t=p(p({},e.timeRange),{},{active:!e.timeRange.active});return p(p({},e),{},{timeRange:t})},y=e=>{let[t,r]=(0,c.lY)(c.N3),n=(0,l.f6)(t),o=(0,l.In)(n),s=n.interactiveFiltersConfig.dataFilters.defaultValueOverrides[e]??[],u=(0,d.z)(t=>{r({type:"INTERACTIVE_FILTER_CHANGED",value:(0,i.ZP)(n.interactiveFiltersConfig,r=>{0===t.length?delete r.dataFilters.defaultValueOverrides[e]:r.dataFilters.defaultValueOverrides[e]=t})})});return(0,a.useEffect)(()=>{let t=o[e],s=n.interactiveFiltersConfig.dataFilters.defaultValueOverrides[e];if(t?.type==="multi"&&s&&Array.isArray(s)&&s.filter(e=>!t.values[e]).length>0){let o=s.filter(e=>t.values[e]);r({type:"INTERACTIVE_FILTER_CHANGED",value:(0,i.ZP)(n.interactiveFiltersConfig,t=>{o.length>0?t.dataFilters.defaultValueOverrides[e]=o:delete t.dataFilters.defaultValueOverrides[e]})})}},[n.interactiveFiltersConfig,o,e,r]),{value:s,onChange:u}}},94257:function(e,t,r){"use strict";r.d(t,{M:function(){return i}});var n=r(60090);let i=e=>[...e].sort((e,t)=>(0,n.Z)(e.order??1/0,t.order??1/0))},95428:function(e,t,r){"use strict";r.d(t,{U:function(){return i},g:function(){return n}});let n="VISUALIZE_MOST_RECENT_VALUE",i=e=>e===n},37268:function(e,t,r){"use strict";r.d(t,{h2:function(){return p},oL:function(){return u},sN:function(){return c}});var n=r(17043),i=r(27378),o=r(37079),s=r(35904);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let c=["userConfigs"],d=e=>["userConfigs",e],u=e=>{let t=(0,i.useCallback)(async()=>{let e=await (0,o.q4)();return await Promise.all(e.map(async e=>l(l({},e),{},{viewCount:await (0,o.xj)(e.key)})))},[]);return(0,s.$5)({queryKey:c,queryFn:t,options:e})},p=(e,t)=>{let r=(0,i.useCallback)(async()=>{let[t,r]=await Promise.all([(0,o.XS)(e),(0,o.xj)(e)]);if(!t)throw Error("Config not found");return l(l({},t),{},{viewCount:r})},[e]);return(0,s.$5)({queryKey:d(e),queryFn:r,options:l({pause:!e},t)})}},41494:function(e,t,r){"use strict";r.d(t,{Ah:function(){return D},D2:function(){return N},GY:function(){return S},Py:function(){return w},U1:function(){return P},_1:function(){return V},e8:function(){return E},iJ:function(){return G},ls:function(){return M},pN:function(){return R},sz:function(){return T},z6:function(){return L}});var n=r(50759),i=r(88887),o=r(7387),s=r(936),a=r(96559),l=r(24631),c=r(5836),d=r(83864),u=r.n(d),p=r(16651),m=r.n(p),f=r(27378),h=r(10359),g=r(64103),b=r(45298),y=r(93912),v=r(49148);let j=e=>{let t=e.values?.[0];return t&&t.label!==t.value},x=e=>j(e),C=e=>{let t=u()(e.values,e=>e.value);return e=>t[e]?.label||e},O=e=>{let t=(0,y.v0)(),r=e.resolution??e.currencyExponent??2,n=t.format(",.8f");return e=>{let t=n(e),i=t.length,o=t.indexOf("."),s=t.length-8+r-1;for(let e=i-8+r;e<i;e++)"0"!==t[e]&&(s=e);return t.substring(0,s+(0===r||o===s?0:1))}},w=m()(e=>{let{format:t}=(0,y.X6)(e);return{empty:()=>"-",second:t("%d.%m.%Y %H:%M:%S"),minute:t("%d.%m.%Y %H:%M"),hour:t("%d.%m.%Y %H:%M"),day:t("%d.%m.%Y"),month:t("%m.%Y"),year:t("%Y")}}),I=()=>w((0,v.bU)()),S=(e,t,r)=>{if(e.timeFormat&&e.timeUnit&&t[e.timeUnit.toLowerCase()]){let r=t[e.timeUnit.toLowerCase()],n=(0,c.Z1)(e.timeFormat),i=(0,c.Z1)(`${e.timeFormat}%Z`);return e=>{if(!e)return t.empty();let o=n(e)??i(e);return o?r(o):t.empty()}}return r},P=e=>"https://cube.link/Undefined"!==e&&null!==e?`${e}`:"",k=(e,t)=>{let r=e.resolution,i=`${"number"==typeof r?`.${r}`:""}~e`,o=(0,n.WU)(i);return e=>{let r=parseFloat(e),n=Math.abs(r);return 0===r?t(e):n>999999999||n<1e-4?o(r):e}},_=e=>{let{components:t,formatNumber:r,formatDateAuto:n,dateFormatters:i}=e;return Object.fromEntries(t.map(e=>{let t;return t=(0,g.cW)(e)?e.isCurrency?O(e):e.isDecimal?k(e,r):r:(0,g.fF)(e)?S(e,i,n):x(e)?C(e):e.isNumerical&&"OrdinalDimension"!==e.__typename&&"OrdinalMeasure"!==e.__typename?r:P,[e.id,t]}))},T=e=>{let t=N(),r=Z(),n=I();return(0,f.useMemo)(()=>_({components:e,formatNumber:t,formatDateAuto:r,dateFormatters:n}),[e,t,r,n])},D=e=>t=>{if(null===t)return e.empty();let r="string"==typeof t?(0,h.sG)(t):t;return((0,i.Z_)(r)<r?e.second:(0,o.WQ)(r)<r?e.minute:(0,s.rr)(r)<r?e.hour:(0,a.F0)(r)<r?e.day:(0,l.jB)(r)<r?e.month:e.year)(r)},Z=()=>{let e=I();return(0,f.useMemo)(()=>D(e),[e])},E=()=>{let e=(0,v.bU)();return(0,f.useMemo)(()=>{let{format:t,parse:r}=(0,y.X6)(e),n=r("%Y-%m-%d"),i=t("%d.%m.%Y");return e=>{let t=n(e);return t?i(t):null}},[e])},M=()=>{let e=(0,v.bU)();return(0,f.useMemo)(()=>(0,y.X6)(e),[e])},A=new Map([[b.j1.Year,"%Y"],[b.j1.Month,"%b %Y"],[b.j1.Week,"%d.%m.%Y"],[b.j1.Day,"%d.%m.%Y"],[b.j1.Hour,"%d.%m.%Y %H:%M"],[b.j1.Minute,"%d.%m.%Y %H:%M"],[b.j1.Second,"%d.%m.%Y %H:%M:%S"]]),L=()=>{let e=(0,v.bU)();return(0,f.useMemo)(()=>{let{format:t}=(0,y.X6)(e);return(e,r)=>{let n="string"==typeof e?(0,h.sG)(e):e;return t(A.get(r)??A.get(b.j1.Day))(n)}},[e])},F=e=>{let{decimals:t=2}=e??{},{format:r}=(0,y.v0)(),n=r("auto"===t?",~f":`,.${t}~f`);return e=>null==e?"":`${n(e)}`},N=e=>(0,f.useMemo)(()=>F(e),[e]),R=()=>(0,f.useMemo)(()=>{let{format:e}=(0,y.v0)(),t=e(",.0~f");return e=>null==e?"":t(e)},[]),G=()=>{let e=(0,v.bU)();return(0,f.useMemo)(()=>{let{format:t}=(0,y.X6)(e),r=t(":%S"),n=t("%H:%M"),c=t("%H"),d=t("%d"),u=t("%b"),p=t("%Y");return e=>((0,i.Z_)(e)<e?r:(0,o.WQ)(e)<e?n:(0,s.rr)(e)<e?c:(0,a.F0)(e)<e?d:(0,l.jB)(e)<e?u:p)(e)},[e])},V=(e,t,r)=>null==e?"-":`${t(e)}${r?` ${r}`:""}`},67258:function(e,t,r){"use strict";r.d(t,{U:function(){return i}});var n=r(75067);let i=e=>{let{endpointUrl:t,cubeIri:r}=e;return n.nF[t]?.supportsCachingPerCubeIri&&r?`${t}/${r}`:t}},80207:function(e,t,r){"use strict";r.d(t,{A3:function(){return j},Tk:function(){return O},XO:function(){return x},aZ:function(){return C},bi:function(){return g},k$:function(){return y},xw:function(){return b}});var n=r(17043),i=r(27378),o=r(25380),s=r(71238),a=r(17510),l=r(92178),c=r(50726),d=r(45298);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let m=new Map,f=e=>(0,i.useMemo)(()=>JSON.stringify(e),[e]),h=e=>{let{fetch:t,check:r,transform:n}=e;return e=>{let s=(0,o.m8)(),{keepPreviousData:a}=e,l=f(e),c=m.get(l),{0:d,1:u}=(0,i.useState)(c||{fetching:!e.pause,queryKey:null,data:null}),h=(0,i.useRef)();!e.pause&&r&&r(e.variables);let g=(0,i.useCallback)(async e=>{h.current=l,u(e=>p(p({},e),{},{fetching:!1,data:e.queryKey===l||a?e.data:null,queryKey:l})),r&&r(e.variables);let n=await t(s,e.variables,()=>{h.current===l&&u(e=>p(p({},e),{},{fetching:!0}))});if(h.current===l){let e=p(p({},n),{},{queryKey:l});m.set(l,e),u(e)}},[l]);return(0,i.useEffect)(()=>{e.pause||g(e)},[l,e.pause]),[(0,i.useMemo)(()=>n&&e.chartConfig?.conversionUnitsByComponentId?n(d,{locale:e.variables.locale,conversionUnitsByComponentId:e.chartConfig.conversionUnitsByComponentId}):d,[d,e.variables.locale,e.chartConfig?.conversionUnitsByComponentId]),g]}},g=h({fetch:async(e,t,r)=>{let{locale:n,sourceType:i,sourceUrl:o,cubeFilters:s}=t,a=await Promise.all(s.map(t=>{let s={locale:n,sourceType:i,sourceUrl:o,cubeFilter:t},a=e.readQuery(d.GL,s);return a?Promise.resolve(a):(r?.(),e.query(d.GL,s).toPromise())})),l=a.find(e=>e.error)?.error,c=!l&&a.some(e=>!e.data);return{data:l||c?void 0:{dataCubesMetadata:a.map(e=>e.data.dataCubeMetadata)},error:l,fetching:c}}}),b=async(e,t,r)=>{let{locale:n,sourceType:i,sourceUrl:o,cubeFilters:s}=t,u=Object.fromEntries(s.map(e=>[e.iri,e.joinBy]).filter(a.y)),p=await Promise.all(s.map(t=>{let s={locale:n,sourceType:i,sourceUrl:o,cubeFilter:t},a=e.readQuery(d.zv,s);return a?Promise.resolve(a):(r?.(),e.query(d.zv,s).toPromise())})),m=p.find(e=>e.error)?.error,f=!m&&p.some(e=>!e.data);if(m||f)return console.log("Error or fetching",{error:m,fetching:f}),{data:void 0,error:m,fetching:f};let{dimensions:h=[],measures:g=[]}=p[0].data?.dataCubeComponents||{};return(0,l.h)(void 0!==h,"Undefined dimensions"),(0,l.h)(void 0!==g,"Undefined measures"),{data:1===p.length?{dataCubesComponents:{dimensions:h,measures:g}}:{dataCubesComponents:{dimensions:(0,c.rF)({joinBy:u,dimensions:p.map(e=>{let t=e.data?.dataCubeComponents;return(0,l.h)(void 0!==t,"Undefined dataCubeComponents"),t.dimensions}).filter(a.y).flat()}),measures:p.flatMap(e=>{let t=e.data?.dataCubeComponents.measures;return(0,l.h)(void 0!==t,"Undefined measures"),t})}},error:m,fetching:f}},y=h({fetch:b,transform:function(e,t){let{locale:r,conversionUnitsByComponentId:n}=t;return e.data&&n&&0!==Object.keys(n).length?p(p({},e),{},{data:p(p({},e.data),{},{dataCubesComponents:p(p({},e.data.dataCubesComponents),{},{measures:e.data.dataCubesComponents.measures.map(e=>{let t=n[e.id];return t?p(p({},e),{},{unit:t.labels[r]??e.unit,originalUnit:e.unit,limits:e.limits.map(e=>{switch(e.type){case"single":case"time-range":return p(p({},e),{},{value:v(e.value,t)});case"value-range":return p(p({},e),{},{min:v(e.min,t),max:v(e.max,t)});default:return e}}),values:e.values.map(e=>"number"==typeof e.value?p(p({},e),{},{value:v(e.value,t)}):"string"==typeof e.value?p(p({},e),{},{value:v(Number(e.value),t)}):e)}):e})})})}):e}}),v=(e,t)=>e*t.multiplier,j=async(e,t,r)=>{let{locale:n,sourceType:i,sourceUrl:o,cubeFilters:s}=t,a=await Promise.all(s.map(t=>{let s={locale:n,sourceType:i,sourceUrl:o,cubeFilter:t},a=e.readQuery(d.dn,s);return a?Promise.resolve(a):(r?.(),e.query(d.dn,s).toPromise())})),l=a.find(e=>e.error)?.error,u=!l&&a.some(e=>!e.data);return l||u?{data:void 0,error:l,fetching:u}:{data:{dataCubesObservations:{data:a.length>1?(0,c.r3)(a):a[0].data?.dataCubeObservations?.data,sparqlEditorUrls:a.flatMap(e=>({cubeIri:e.operation.variables?.cubeFilter.iri,url:e.data?.dataCubeObservations?.sparqlEditorUrl}))}},error:l,fetching:u}},x=h({fetch:j,transform:function(e,t){let{conversionUnitsByComponentId:r}=t;return e.data&&r&&0!==Object.keys(r).length?p(p({},e),{},{data:{dataCubesObservations:p(p({},e.data.dataCubesObservations),{},{data:e.data.dataCubesObservations.data.map(e=>{let t=p({},e);return Object.entries(r).forEach(e=>{let[r,n]=e;if(r in t){let e=t[r];"number"==typeof e?t[r]=v(e,n):"string"==typeof e&&(t[r]=v(Number(e),n))}}),t})})}}):e}}),C=h({fetch:async(e,t)=>{let{state:r,locale:n}=t,{dataSource:i}=r;(0,l.h)((0,s.Sc)(r),"Expected state with chart configs");let o=r.chartConfigs.map(e=>e.cubes.map(e=>({iri:e.iri,joinBy:e.joinBy,loadValues:!0}))),a=await Promise.all(o.map(t=>b(e,{cubeFilters:t,locale:n,sourceType:i.type,sourceUrl:i.url})));return{error:a.find(e=>e.error)?.error,fetching:a.some(e=>e.fetching),data:{dataCubesComponents:{dimensions:a.flatMap(e=>e?.data?.dataCubesComponents.dimensions??[]),measures:a.flatMap(e=>e?.data?.dataCubesComponents.measures??[])}}}}}),O=h({fetch:async(e,t,r)=>{let{locale:n,sourceType:i,sourceUrl:o,cubeFilters:s}=t,l=await Promise.all(s.map(t=>{let s={locale:n,sourceType:i,sourceUrl:o,cubeFilter:t},a=e.readQuery(d.Zu,s);return a?Promise.resolve(a):(r?.(),e.query(d.Zu,s).toPromise())})),c=l.find(e=>e.error)?.error,u=!c&&l.some(e=>!e.data);return c||u?{data:void 0,error:c,fetching:u}:{data:{dataCubeComponentTermsets:(l.length>1?l.map(e=>e.data?.dataCubeComponentTermsets).flat():l[0].data?.dataCubeComponentTermsets).filter(a.y)},error:c,fetching:u}}})},50726:function(e,t,r){"use strict";r.d(t,{A8:function(){return O},BG:function(){return j},CX:function(){return T},Tl:function(){return P},Z3:function(){return S},hm:function(){return x},i3:function(){return _},mM:function(){return v},r3:function(){return k},rF:function(){return I}});var n=r(17043),i=r(60090),o=r(38354),s=r.n(o),a=r(48159),l=r.n(a),c=r(83766),d=r.n(c),u=r(31091),p=r.n(u),m=r(64103),f=r(92178);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let b="joinBy",y="joinBy__",v=e=>`${y}${e}`,j=e=>e.startsWith(y),x=e=>e===b,C=e=>Number(e.slice(y.length)),O=(e,t)=>{(0,f.h)((0,m.P9)(e),"Dimension should be a join by at this point");let r=e.originalIds.find(e=>e.cubeIri===t.iri)?.dimensionId;return r||console.warn("Could not find original id for joinBy dimension",e,t.iri),(0,f.h)(!!r,"Original id should have been found"),g(g({},e),{},{id:r})},w=(e,t)=>(0,i.Z)(e.position??e.value??void 0,t.position??t.value??void 0),I=e=>{let t=[],r=[],{dimensions:n,joinBy:i}=e,o=n.flatMap(e=>{if((0,m.P9)(e)){let t=C(e.id),r=e.label.split(", ");return e.originalIds.map((n,i)=>g(g({},l()(e,["originalIds"])),{},{originalIds:[],dimensionId:n.dimensionId,id:n.dimensionId,label:r[i],cubeIri:n.cubeIri,joinByIndex:t}))}{let t=i[e.cubeIri],r=t?.indexOf(e.id);return[g(g({},e),{},{joinByIndex:void 0!==r&&r>-1?r:void 0})]}}),{false:a=[],true:c=[]}=s()(o,e=>void 0!==e.joinByIndex);if(t.push(...c),r.push(...a.map(e=>l()(e,["joinByIndex"]))),t.length>=1)for(let[e,n]of Object.entries(s()(t,e=>e.joinByIndex)).reverse()){let t=g(g({},l()(n[0],["joinByIndex","dimensionId"])),{},{values:p()(n.flatMap(e=>e.values??[]).sort(w),e=>e.value),id:v(Number(e)),cubeIri:b,label:d()(n.map(e=>e.label)).join(", "),isJoinByDimension:!0,originalIds:n.map(e=>({cubeIri:e.cubeIri,dimensionId:e.id,label:e.label,description:e.description??""}))});r.unshift(t)}return r},S=(e,t)=>{let r=C(e);return t.cubes.map(e=>{let t=e.joinBy;return(0,f.h)(void 0!==t,"Found joinBy id and cube has no join by"),t[r]})},P=(e,t)=>{if(!e.joinBy)return;let r=C(t);return e.joinBy[r]},k=e=>Object.values(e.reduce((e,t)=>{let r=t.operation.variables?.cubeFilter.joinBy,n=t.data?.dataCubeObservations.data;if(!n||!r)return e;for(let t of n){let n=l()(t,r),i=r.map(e=>t[e]).join("$/$/$/");if(!i)continue;for(let e=0;e<r.length;e++)void 0!==t[r[e]]&&(n[v(e)]=t[r[e]]);let o=e[i];e[i]=Object.assign(o??{},n)}return e},{})),_=e=>e,T=e=>Object.entries(e).map(e=>{let[t,r]=e;return{iri:t,joinBy:r}})},17703:function(e,t,r){"use strict";r.d(t,{O1:function(){return o},OK:function(){return i}}),r(83180);let n="(VISUALIZE.ADMIN_COMPONENT_ID_SEPARATOR)",i=e=>{let{unversionedCubeIri:t,unversionedComponentIri:r}=e;return`${t}${n}${r}`},o=e=>{let[t,r]=e.split(n);return{unversionedCubeIri:t,unversionedComponentIri:r||void 0}}},6222:function(e,t,r){"use strict";r.d(t,{v:function(){return S}});var n=r(17043),i=r(96338),o=r(19914),s=r(60116),a=r(12548),l=r(64986),c=r(65218),d=r.n(c),u=r(27378),p=r(80750),m=r(53082),f=r(99990),h=r(45214),g=r(48947),b=r(41282),y=r(90453),v=r(92178),j=r(54312),x=r(24246);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let w=d()(()=>r.e(14172).then(r.bind(r,14172)).then(e=>e.ColorPickerMenu),{ssr:!1,loadableGenerated:{webpack:()=>[14172]}}),I=(0,l.Z)({addColorButton:{minWidth:"fit-content",paddingLeft:0},categoricalColorListContainer:{display:"flex",flexDirection:"column",gap:y.r.spacing(2)},colorItem:{maxWidth:304,paddingTop:y.r.spacing(1),paddingBottom:y.r.spacing(1)},colorItemContent:{justifyContent:"space-between",alignItems:"center",width:"100%"}}),S=e=>{let{type:t}=e;switch(t){case"diverging":return(0,x.jsx)(k,O({},e));case"categorical":return(0,x.jsx)(_,O({},e));case"sequential":return(0,x.jsx)(P,O({},e));default:return t}},P=e=>{let{onUpdate:t,onAdd:r,colorValues:n}=e;(0,v.h)(n.length>0,"Sequential color palette must have at least one color");let o=n[0],a=(0,b.xT)({endColorHex:o.color}),l=(0,u.useRef)(a.startingColorHex);return(0,u.useEffect)(()=>{a.startingColorHex&&a.startingColorHex!==l.current&&(l.current=a.startingColorHex,n[1]?n[1].color!==a.startingColorHex&&t(a.startingColorHex,n[1].id):r(a.startingColorHex))},[a.startingColorHex,n,r,t]),(0,x.jsxs)(m.k,{flexDirection:"column",gap:2,children:[(0,x.jsx)(s.Z,{children:(0,x.jsx)(h.E,{height:24,width:304,colorInterpolator:a.interpolator})}),(0,x.jsxs)(s.Z,{sx:{fontSize:"1rem",pb:2,maxWidth:304},children:[(0,x.jsx)(f.__,{htmlFor:"custom-color-palette-base",children:(0,x.jsx)(i.cC,{id:"controls.custom-color-palettes.base"})}),o&&(0,x.jsx)(T,O(O({type:"sequential",colorValues:[o]},o),{},{onUpdate:t}),o.id)]})]})},k=e=>{let{onAdd:t,onRemove:r,onUpdate:n,colorValues:o,title:l}=e,c=I(),d=3<=o.length||0===l.length,[u,p,y]=o,v=(0,b.kD)({endColorHex:p.color,startColorHex:u.color,options:{midColorHex:y?.color}});return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(m.k,{flexDirection:"column",gap:2,children:[(0,x.jsx)(s.Z,{children:(0,x.jsx)(h.E,{height:24,width:304,colorInterpolator:v.interpolator})}),(0,x.jsxs)(s.Z,{sx:{fontSize:"1rem",pb:2,maxWidth:304},children:[(0,x.jsx)(f.__,{htmlFor:"custom-color-palette-start",children:(0,x.jsx)(i.cC,{id:"controls.custom-color-palettes.start"})}),u&&(0,x.jsx)(T,O(O({type:"diverging",colorValues:[u]},u),{},{onUpdate:n}),u.id)]}),y&&(0,x.jsxs)(s.Z,{sx:{fontSize:"1rem",pb:2,maxWidth:304},children:[(0,x.jsx)(f.__,{htmlFor:"custom-color-palette-mid",children:(0,x.jsx)(i.cC,{id:"controls.custom-color-palettes.mid"})}),(0,x.jsx)(T,O(O({type:"diverging",colorValues:[y]},y),{},{onUpdate:n,onRemove:r}),y.id)]}),(0,x.jsxs)(s.Z,{sx:{fontSize:"1rem",pb:2,maxWidth:304},children:[(0,x.jsx)(f.__,{htmlFor:"custom-color-palette-end",children:(0,x.jsx)(i.cC,{id:"controls.custom-color-palettes.end"})}),p&&(0,x.jsx)(T,O(O({type:"diverging",colorValues:[p]},p),{},{onUpdate:n}),p.id)]})]}),(0,x.jsx)(a.Z,{variant:"text",fullWidth:!0,className:c.addColorButton,disabled:d,startIcon:(0,x.jsx)(g.JO,{name:"plus"}),onClick:()=>t(),children:(0,x.jsx)(i.cC,{id:"controls.custom-color-palettes.add-color"})})]})},_=e=>{let{onAdd:t,onRemove:r,onUpdate:n,colorValues:o,title:l}=e,c=I(),d=26<=o.length||0===l.length;return(0,x.jsxs)(x.Fragment,{children:[o.length>0&&(0,x.jsx)(s.Z,{className:c.categoricalColorListContainer,children:o.map(e=>(0,x.jsx)(T,O(O({type:"categorical",colorValues:o},e),{},{onRemove:r,onUpdate:n}),e.id))}),(0,x.jsx)(a.Z,{variant:"text",fullWidth:!0,className:c.addColorButton,disabled:d,startIcon:(0,x.jsx)(g.JO,{name:"plus"}),onClick:()=>t(),children:(0,x.jsx)(i.cC,{id:"controls.custom-color-palettes.add-color"})})]})},T=e=>{let{id:t,color:r,colorValues:n,onRemove:i,onUpdate:a,type:l}=e,c=I(),d=(0,j.$X)(r);return(0,x.jsx)(s.Z,{className:c.colorItem,children:(0,x.jsxs)(m.k,{className:c.colorItemContent,children:[(0,x.jsx)(p.YL,{label:r,color:r,symbol:"square"}),(0,x.jsxs)(m.k,{sx:{alignItems:"center",gap:2},children:[d&&(0,x.jsx)(f.FX,{message:(()=>{switch(l){case"categorical":return o.ag._({id:"controls.custom-color-palettes.categorical-contrast-warning"});case"sequential":return o.ag._({id:"controls.custom-color-palettes.sequential-contrast-warning"});case"diverging":return o.ag._({id:"controls.custom-color-palettes.diverging-contrast-warning"});default:return l}})()}),(0,x.jsx)(w,{colorId:t,colors:n,selectedHexColor:r,onChange:e=>a(e,t),onRemove:i})]})]})})}},26732:function(e,t,r){"use strict";r.r(t),r.d(t,{DatasetBrowser:function(){return l},__N_SSP:function(){return a}});var n=r(30503),i=r(25592),o=r(15658),s=r(24246),a=!0;function l(e){let{hideHeader:t}=e;return(0,s.jsx)(i.LN,{hideHeader:t,children:(0,s.jsx)(o.c7,{chartId:"new",allowDefaultRedirect:!1,children:(0,s.jsx)(n.c,{variant:"page"})})})}t.default=l},13109:function(e,t,r){"use strict";r.d(t,{F:function(){return i}});let n=e=>`PREFIX cube: <https://cube.link/>
PREFIX schema: <http://schema.org/>

SELECT ?iri WHERE {
  {
    # Versioned cube.
    SELECT ?iri ?version WHERE {
      VALUES ?oldIri { <${e}> }
      ?unversionedIri schema:hasPart ?oldIri .
      ?unversionedIri schema:hasPart ?iri .
      ?iri schema:version ?version .
      ?iri schema:creativeWorkStatus ?status .
      ?oldIri schema:creativeWorkStatus ?oldStatus .
      FILTER(NOT EXISTS { ?iri schema:expires ?expires . } && ?status IN (?oldStatus, <https://ld.admin.ch/vocabulary/CreativeWorkStatus/Published>))
    }
    ORDER BY DESC(?version)
  } UNION {
    {
      # Version history of a cube.
      SELECT ?iri ?status ?version WHERE {
        VALUES ?unversionedIri { <${e}> }
        ?unversionedIri schema:hasPart ?iri .
        ?iri schema:version ?version .
        ?iri schema:creativeWorkStatus ?status .
        FILTER(NOT EXISTS { ?iri schema:expires ?expires . })
      }
      ORDER BY DESC(?status) DESC(?version)
    }
  } UNION {
    {
      # Non-versioned cube.
      SELECT ?iri ?status WHERE {
        VALUES ?iri { <${e}> }
        ?iri cube:observationConstraint ?shape .
        ?iri schema:creativeWorkStatus ?status .
        FILTER(NOT EXISTS { ?iri schema:expires ?expires . } && NOT EXISTS { ?unversionedIri schema:hasPart ?iri . })
      }
      ORDER BY DESC(?status)
    }
  }
}
LIMIT 1`,i=async(e,t)=>{let r=n(t),i=await e.query.select(r,{operation:"postUrlencoded"});return i[0]?.iri.value}},57060:function(e,t,r){"use strict";r.d(t,{Gy:function(){return d},Mc:function(){return b},dp:function(){return p},fK:function(){return v},iV:function(){return y},q4:function(){return f},tn:function(){return h},wb:function(){return g}});var n=r(17043),i=r(95099),o=r.n(i),s=r(47073),a=r(43107);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let d=(e,t)=>e.map(e=>c(c({},t(e)),{},{children:e.children?d(e.children,t):void 0})),u=(e,t)=>e.map(e=>c(c({},e),{},{children:e.children?u(e.children,t):void 0})).filter(t),p=(e,t)=>{let r=e=>!!t(e)||!!e.children&&e.children.some(e=>r(e));return u(e,r)},m=e=>e.sort((e,t)=>t.depth-e.depth||(0,s.NM)(e,t)),f=e=>m(e).map(e=>c(c({},e),{},{children:e.children?f(e.children):void 0})),h=(e,t)=>{let r=[...e];for(;r.length>0;){let e=r.shift();if(!1===t(e))break;for(let t of e.children||[])r.push(t)}},g=(e,t)=>{let r;return h(e,e=>{if(t(e))return r=e,!1}),r},b=e=>o()((0,a.B)(e,(e,t)=>{let{parents:r}=t;return c(c({},e),{},{parents:r})}),e=>y(e.parents)),y=e=>e?.map(e=>e.label).join(" > ")||"",v=e=>{let t=[];return(0,a.B)(e,e=>t.push(e)),t}},27102:function(e,t,r){"use strict";r.d(t,{$5:function(){return o.$5},ag:function(){return o.ag},bU:function(){return s.bU},bd:function(){return n.bd},c7:function(){return i.c7},lY:function(){return i.lY}});var n=r(96338),i=r(71238),o=r(93912),s=r(49148);r(26732)},8788:function(e,t,r){"use strict";r.d(t,{Zg:function(){return I},ch:function(){return O},yl:function(){return _},bI:function(){return S},Rx:function(){return k},Uq:function(){return P}});var n=r(17043),i=r(56141),o=r.n(i),s=r(83766),a=r.n(s),l=r(27378),c=r(58555),d=r(41143),u=r(64103),p=r(17510),m=r(50726);let f=e=>(t,r)=>(0,c.oR)(e,t,r);var h=r(92178),g=r(24246);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let v=e=>({categories:{},addCategory:t=>{e(e=>({categories:y(y({},e.categories),{},{[t]:!0})}))},removeCategory:t=>{e(e=>(delete e.categories[t],{categories:y({},e.categories)}))},resetCategories:()=>{e({categories:{}})},timeRange:{from:void 0,to:void 0},setTimeRange:(t,r)=>{e({timeRange:{from:t,to:r}})},timeSlider:{type:"interval",value:void 0},setTimeSlider:t=>{let{type:r,value:n}=t;e({timeSlider:{type:r,value:n}})},resetTimeSlider:()=>{e(e=>({timeSlider:y(y({},e.timeSlider),{},{value:void 0})}))},dataFilters:{},setDataFilters:t=>{e({dataFilters:t})},updateDataFilter:(t,r)=>{e(e=>({dataFilters:y(y({},e.dataFilters),{},{[t]:{type:"single",value:r}})}))},setMultiDataFilter:(t,r)=>{e(e=>({dataFilters:y(y({},e.dataFilters),{},{[t]:{type:"multi",values:Object.fromEntries(r.map(e=>[e,!0]))}})}))},addDataFilterValue:(t,r)=>{e(e=>{let n=e.dataFilters[t];return n?.type==="single"?{dataFilters:y(y({},e.dataFilters),{},{[t]:{type:"multi",values:{[n.value]:!0,[r]:!0}}})}:n?.type==="multi"?{dataFilters:y(y({},e.dataFilters),{},{[t]:{type:"multi",values:y(y({},n.values),{},{[r]:!0})}})}:{dataFilters:y(y({},e.dataFilters),{},{[t]:{type:"multi",values:{[r]:!0}}})}})},removeDataFilterValue:(t,r)=>{e(e=>{let n=e.dataFilters[t];if(n?.type==="multi"){let i=y({},n.values);delete i[r];let o=Object.keys(i);if(1===o.length)return{dataFilters:y(y({},e.dataFilters),{},{[t]:{type:"single",value:o[0]}})};if(0===o.length){let r=y({},e.dataFilters);return delete r[t],{dataFilters:r}}return{dataFilters:y(y({},e.dataFilters),{},{[t]:{type:"multi",values:i}})}}if(n?.type==="single"&&n.value===r){let r=y({},e.dataFilters);return delete r[t],{dataFilters:r}}return{dataFilters:e.dataFilters}})},resetDataFilters:()=>{e({dataFilters:{}})},calculation:{type:void 0},setCalculationType:t=>{e({calculation:{type:t}})},annotations:{},setAnnotations:t=>{e({annotations:t})},updateAnnotation:(t,r)=>{e(e=>({annotations:y(y({},e.annotations),{},{[t]:r})}))}}),j=(0,l.createContext)(void 0),x=e=>e.flatMap(e=>(0,d.K0)(e).encodings.filter(e=>e.componentTypes.some(e=>"TemporalDimension"===e||"TemporalEntityDimension"===e)).map(t=>{let r=t.field in e.fields?e.fields[t.field]:void 0;if(r&&"componentId"in r)return((0,m.BG)(r.componentId)?(0,m.Z3)(r.componentId,e):[r.componentId]).map(t=>({componentId:t,chartKey:e.key}))}).flat().filter(p.y)).map(e=>e.componentId),C=e=>{let t=new Map;return e.forEach(e=>{a()(e.cubes.map(e=>e.filters).flatMap(t=>Object.entries(t).filter(e=>{let[t,r]=e;return"single"===r.type||"multi"===r.type}).map(e=>{let[t]=e;return t}).concat("table"===e.chartType?Object.entries(e.fields).map(e=>{let[t,r]=e;return(0,u.h5)({__typename:r.componentType})?t:void 0}).filter(p.y):[]))).forEach(e=>{t.set(e,(t.get(e)??0)+1)})}),Array.from(t.entries()).filter(e=>{let[t,r]=e;return r>1}).map(e=>{let[t]=e;return t})},O=e=>{let{children:t,chartConfigs:r}=e,n=(0,l.useRef)({}),i=(0,l.useRef)({}),s=(0,l.useMemo)(()=>x(r),[r]),a=(0,l.useMemo)(()=>C(r),[r]),d=(0,l.useMemo)(()=>Object.fromEntries(r.map(e=>{let t=n.current[e.key]??(0,c.ZP)(v);n.current[e.key]=t,i.current[e.key]||(i.current[e.key]=f(t));let r=[t.getState,i.current[e.key],t];return[e.key,r]})),[r]),u=(0,l.useRef)(),p={potentialTimeRangeFilterIds:s,potentialDataFilterIds:a,stores:d};u.current&&o()(u.current,p)||(u.current=p);let m=u.current;return(0,g.jsx)(j.Provider,{value:m,children:t})},w=(0,l.createContext)(null),I=e=>{let{chartConfigKey:t,children:r}=e;return(0,g.jsx)(w.Provider,{value:t,children:r})},S=e=>{let t=(0,l.useContext)(j),r=(0,l.useContext)(w);(0,h.h)(t,`ctx=${t}. useChartInteractiveFilters must be called inside a InteractiveFiltersChartProvider.`),(0,h.h)(r,`key=${r}. useChartInteractiveFilters must be called inside a InteractiveFiltersChartProvider.`);let[,n]=t.stores[r];return n(e)},P=()=>{let e=(0,l.useContext)(j),t=(0,l.useContext)(w);(0,h.h)(e,"useInteractiveFilters must be called inside a InteractiveFiltersContext.Provider!"),(0,h.h)(t,"useInteractiveFilters must be called inside a InteractiveFiltersChartContext.Provider!");let[r]=e.stores[t];return r},k=()=>{let e=(0,l.useContext)(j);return(0,h.h)(e,"useInteractiveFilters must be called inside a InteractiveFiltersContext.Provider!"),e},_=(e,t,r)=>{e.setState({dataFilters:y(y({},e.getState().dataFilters),{},{[t]:{type:"single",value:r}})})}},80733:function(e,t,r){"use strict";r.d(t,{K:function(){return n}});let n=(0,r(58555).ZP)(e=>({enable:!0,setEnable:t=>e({enable:t}),brushing:!1,setBrushing:t=>e({brushing:t}),duration:400,setDuration:t=>e({duration:t}),setDefaultDuration:()=>e({duration:400})}))},90717:function(e,t,r){"use strict";r.d(t,{F:function(){return n.Z}});var n=r(43922);r(90453)},80065:function(e,t,r){"use strict";r.d(t,{r:function(){return n}});let n=()=>new Promise(e=>requestAnimationFrame(e))},92178:function(e,t,r){"use strict";r.d(t,{h:function(){return n}});let n=(e,t)=>{if(!e)throw Error(`AssertionError: ${t}`)}},37079:function(e,t,r){"use strict";r.d(t,{_g:function(){return b},pk:function(){return O},GI:function(){return I},XS:function(){return j},q4:function(){return x},xj:function(){return C},XG:function(){return w},cC:function(){return v},rF:function(){return y},rs:function(){return S}});var n=r(17043),i=r(92465),o=r.n(i),s=r(48159),a=r.n(s),l=r(40015),c=r.n(l),d=r(27668);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let p=async(e,t)=>{let r=await fetch(e,t?.data?{method:t.method||"POST",headers:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({"Content-Type":"application/json"},t.headers),body:JSON.stringify(t.data)}:void 0),i=await r.json();if(i.success)return"data"in i&&"object"==typeof i.data&&null!==i.data&&"meta"in i.data?d.ZP.deserialize(i.data):i.data;throw Error(i.message)};var m=r(59823);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let g=e=>c()(h(h({},e),{},{data:"data"in e?a()(e.data,["state"]):void 0}),o()),b=async e=>p("/api/config-create",{method:"POST",data:g({data:h({key:(0,m.M)()},e.data),user_id:e.user_id,published_state:e.published_state})}),y=async e=>{let{key:t,published_state:r}=e;return p("/api/config-update",{method:"POST",data:g({key:t,data:h({key:t},e.data),published_state:r})})},v=async e=>{let{key:t}=e;return p("/api/config-remove",{method:"POST",data:{key:t}})},j=async e=>await p(`/api/config/${e}`),x=async()=>await p("/api/config/list"),C=async e=>await p(`/api/config/view?id=${e}`),O=async e=>await p("/api/user/color-palette",{method:"POST",data:e}),w=async()=>await p("/api/user/color-palette",{method:"GET"}),I=async e=>{await p("/api/user/color-palette",{method:"DELETE",data:e})},S=async e=>{await p("/api/user/color-palette",{method:"PUT",data:e})}},17674:function(e,t,r){"use strict";r.d(t,{e:function(){return i},o:function(){return n}});let n="5.1.0",i="5.1.0"},22116:function(e,t,r){"use strict";r.d(t,{ST:function(){return h},p9:function(){return g},j0:function(){return y},XI:function(){return b}});var n=r(17043),i=r(38676),o=r.n(i),s=r(71238),a=r(67258),l=r(45298);let c=e=>`PREFIX schema: <http://schema.org/>

SELECT ?unversionedIri WHERE {
  ?unversionedIri schema:hasPart <${e}> .
}`,d=async(e,t)=>{let r=c(t),n=await e.query.select(r,{operation:"postUrlencoded"});return n[0]?.unversionedIri.value};var u=r(13109);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let f=e=>{let{cubeIriUpdateFn:t}=e;return async(e,r)=>(0,s.Sc)(e)?m(m({},e),{},{chartConfigs:await Promise.all(e.chartConfigs.map(async e=>m(m({},e),{},{cubes:await Promise.all(e.cubes.map(async e=>m(m({},e),{},{iri:await t(e.iri,r)})))})))}):e},h=async(e,t)=>{let{client:r,dataSource:n}=t,{data:i}=await r.query(l.R6,{sourceUrl:n.url,sourceType:n.type,cubeFilter:{iri:e}}).toPromise();return i?.dataCubeLatestIri??e},g=async(e,t)=>{let{client:r,dataSource:n}=t,{data:i}=await r.query(l.AJ,{sourceUrl:n.url,sourceType:n.type,cubeFilter:{iri:e}}).toPromise();return i?.dataCubeUnversionedIri??e},b=f({cubeIriUpdateFn:h}),y=async(e,t)=>{let{dataSource:r}=t,n=new(o())({endpointUrl:(0,a.U)({endpointUrl:r.url,cubeIri:e})});return await d(n,e)??e};f({cubeIriUpdateFn:async(e,t)=>{let{dataSource:r}=t,n=new(o())({endpointUrl:(0,a.U)({endpointUrl:r.url,cubeIri:e})});return await (0,u.F)(n,e)??e}})},76394:function(e,t,r){"use strict";r.d(t,{qm:function(){return M}});var n=r(90089),i=r(17043),o=r(67291),s=r(25654),a=r(44463),l=r(10359),c=r(77167),d=r(75067),u=r(18822),p=r(50726),m=r(17703),f=r(41282),h=r(17674),g=r(22116),b=r(59823),y=r(31251);let v=["show"],j=["show"],x=["calculation"],C=["publishIri"],O=["publishIri"],w=["componentIri"],I=["layout"],S=["meta"],P=["layout"],k=["meta"],_=["label"];function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let Z=A([{description:`MAP
    baseLayer {
      + locked
      + bbox
    }`,from:"1.0.0",to:"1.0.1",up:e=>{let t=D(D({},e),{},{version:"1.0.1"});return"map"===t.chartType&&(t.baseLayer={show:t.baseLayer.show,locked:!1}),t},down:e=>{let t=D(D({},e),{},{version:"1.0.0"});return"map"===t.chartType&&(t.baseLayer={show:t.baseLayer.show}),t}},{description:`MAP
    symbolLayer {
      + colors {
        + type
        + value
        + opacity
      }
      - color
    }`,from:"1.0.1",to:"1.0.2",up:e=>{let t=D(D({},e),{},{version:"1.0.2"});if("map"===t.chartType){let{fields:e}=t,{symbolLayer:r}=e,{show:n,componentIri:i,measureIri:o,color:s}=r;t.fields.symbolLayer={show:n,componentIri:i,measureIri:o,colors:{type:"fixed",value:s,opacity:80}}}return t},down:e=>{let t=D(D({},e),{},{version:"1.0.1"});if("map"===t.chartType){let{fields:e}=t,{symbolLayer:r}=e,{show:n,componentIri:i,measureIri:o,colors:s}=r;t.fields.symbolLayer={show:n,componentIri:i,measureIri:o,color:s.value}}return t}},{description:`MAP
    areaLayer? {
      - show
    }
    
    symbolLayer? {
      - show
    }`,from:"1.0.2",to:"1.1.0",up:e=>{let t=D(D({},e),{},{version:"1.1.0"});if("map"===t.chartType){let{fields:e}=t,{areaLayer:r,symbolLayer:i}=e,{show:o}=r,s=(0,n.Z)(r,v),{show:a}=i,l=(0,n.Z)(i,j);o?t.fields.areaLayer=D({},s):delete t.fields.areaLayer,a?t.fields.symbolLayer=D({},l):delete t.fields.symbolLayer}return t},down:e=>{let t=D(D({},e),{},{version:"1.0.2"});if("map"===t.chartType){let{fields:e}=t,{areaLayer:r,symbolLayer:n}=e;r?t.fields.areaLayer=D(D({},r),{},{show:!0}):t.fields.areaLayer={show:!1,componentIri:"",measureIri:n?.measureIri||"",colorScaleType:"continuous",colorScaleInterpolationType:"linear",palette:"oranges",nbClass:5},n?t.fields.symbolLayer=D(D({},n),{},{show:!0}):t.fields.symbolLayer={show:!1,componentIri:r?.componentIri||"",measureIri:r?.measureIri||"",colors:{type:"fixed",value:"#1f77b4",opacity:80}}}return t}},{description:`MAP
    areaLayer {
      - measureIri
      - palette
      - colorScaleType
      - colorScaleInterpolationType
      - nbClass
      + color {
        + type: "numerical"
        + componentIri
        + palette
        + scaleType: "continuous"
        + interpolationType: "linear"
      } | {
        + type: "numerical"
        + componentIri
        + palette
        + scaleType: "discrete"
        + nbClass
      }
    }
  
    symbolLayer {
      - colors {
        - type: "fixed"
        - value
        - opacity
      } | {
        - type: "categorical"
        - componentIri
        - palette
        - ?colorMapping
      } | {
        type: "continuous"
        - componentIri
        - palette
        - ?colorMapping
      }
      + color {
        + type: "fixed"
        + value
        + opacity
      } | {
        + type: "categorical"
        + componentIri
        + palette
        + colorMapping
      } | {
        + type: "numerical"
        + componentIri
        + palette
        + scaleType: "continuous"
        + interpolationType: "linear"
      } | {
        + type: "numerical"
        + componentIri
        + palette
        + scaleType: "discrete"
        + nbClass
      }
    }`,from:"1.1.0",to:"1.1.1",up:e=>{let t=D(D({},e),{},{version:"1.1.1"});if("map"===t.chartType){let{fields:e}=t,{areaLayer:r,symbolLayer:n}=e;if(r){let{componentIri:e,measureIri:n,palette:i,colorScaleType:o,colorScaleInterpolationType:s,nbClass:a}=r;t.fields.areaLayer={componentIri:e,color:D({type:"numerical",componentIri:n,palette:i},"discrete"===o?{scaleType:o,interpolationType:"linear"===s?"quantize":s,nbClass:a}:{scaleType:o,interpolationType:"linear"})}}if(n){let{componentIri:e,measureIri:r,colors:i}=n;t.fields.symbolLayer={componentIri:e,measureIri:r,color:"fixed"===i.type||"categorical"===i.type?i:{type:"numerical",componentIri:i.componentIri,palette:i.palette,scaleType:"continuous",interpolationType:"linear"}}}}return t},down:e=>{let t=D(D({},e),{},{version:"1.1.0"});if("map"===t.chartType){let{fields:e}=t,{areaLayer:r,symbolLayer:n}=e;if(r){let{componentIri:e,color:n}=r;t.fields.areaLayer={componentIri:e,measureIri:n.componentIri,palette:n.palette,colorScaleType:n.scaleType,colorInterpolationType:n.interpolationType,nbClass:n.nbClass??3}}if(n){let{componentIri:e,measureIri:r,color:i}=n;t.fields.symbolLayer=D({componentIri:e,measureIri:r},"fixed"===i.type||"categorical"===i.type?i:{type:"continuous",componentIri:i.componentIri,palette:i.palette})}}return t}},{description:`MAP
    areaLayer - color can be categorical
    `,from:"1.1.1",to:"1.2.0",up:e=>D(D({},e),{},{version:"1.2.0"}),down:e=>{let t=D(D({},e),{},{version:"1.1.1"});if("map"===t.chartType){let{fields:e}=t,{areaLayer:r}=e;r&&"categorical"===r.color.type&&delete t.fields.areaLayer}return t}},{description:`ALL
    interactiveFiltersConfig {
      time -> timeRange
    }`,from:"1.2.0",to:"1.2.1",up:e=>{let t=D(D({},e),{},{version:"1.2.1"}),{interactiveFiltersConfig:r}=t;return r&&(t.interactiveFiltersConfig={legend:t.interactiveFiltersConfig.legend,timeRange:t.interactiveFiltersConfig.time,dataFilters:t.interactiveFiltersConfig.dataFilters}),t},down:e=>{let t=D(D({},e),{},{version:"1.2.0"}),{interactiveFiltersConfig:r}=t;return r&&(t.interactiveFiltersConfig={legend:t.interactiveFiltersConfig.legend,time:t.interactiveFiltersConfig.timeRange,dataFilters:t.interactiveFiltersConfig.dataFilters}),t}},{description:`ALL
    interactiveFiltersConfig {
      + timeSlider
    }`,from:"1.2.1",to:"1.3.0",up:e=>{let t=D(D({},e),{},{version:"1.3.0"}),{interactiveFiltersConfig:r}=t;return r&&(t.interactiveFiltersConfig=D(D({},t.interactiveFiltersConfig),{},{timeSlider:{componentIri:""}})),t},down:e=>{let t=D(D({},e),{},{version:"1.2.1"}),{interactiveFiltersConfig:r}=t;return r&&(t.interactiveFiltersConfig={legend:t.interactiveFiltersConfig.legend,time:t.interactiveFiltersConfig.time,dataFilters:t.interactiveFiltersConfig.dataFilters}),t}},{description:`ALL
    fields {
      + animation {
        componentIri
      }
    }`,from:"1.3.0",to:"1.4.0",up:e=>{let t=D(D({},e),{},{version:"1.4.0"}),{interactiveFiltersConfig:r}=t;if(r){let{legend:e,timeRange:n,timeSlider:i,dataFilters:o}=r;t.interactiveFiltersConfig={legend:e,timeRange:n,dataFilters:o},["column","pie","scatterplot"].includes(t.chartType)&&i?.componentIri&&(t.fields.animation=D(D({},i),{},{showPlayButton:!0,duration:30,type:"continuous",dynamicScales:!1}))}return t},down:e=>{let t=D(D({},e),{},{version:"1.3.0"}),{fields:r}=e,{animation:n}=r;return n&&(delete t.fields.animation,["column","pie","scatterplot"].includes(t.chartType)?t.interactiveFiltersConfig.timeSlider={componentIri:n.componentIri}:t.interactiveFiltersConfig.timeSlider={componentIri:""}),t}},{description:`ALL
    interactiveFiltersConfig {
      timeRange {
        componentIri is tied to x.componentIri
      }
    }`,from:"1.4.0",to:"1.4.1",up:e=>{let t=D(D({},e),{},{version:"1.4.1"}),{fields:r,interactiveFiltersConfig:n}=t,{x:i}=r;return n&&["area","column","line"].includes(t.chartType)&&t.interactiveFiltersConfig.timeRange.active&&(t.interactiveFiltersConfig.timeRange=D(D({},t.interactiveFiltersConfig.timeRange),{},{componentIri:i.componentIri})),t},down:e=>{let t=D(D({},e),{},{version:"1.4.0"}),{interactiveFiltersConfig:r}=e;return r&&(t.interactiveFiltersConfig.timeRange=D(D({},t.interactiveFiltersConfig.timeRange),{},{componentIri:""})),t}},{description:`ALL
    interactiveFiltersConfig {
      + calculation
    }`,from:"1.4.1",to:"1.4.2",up:e=>{let t=D(D({},e),{},{version:"1.4.2"}),{interactiveFiltersConfig:r}=t;return r&&(t.interactiveFiltersConfig=D(D({},t.interactiveFiltersConfig),{},{calculation:{active:!1,type:"identity"}})),t},down:e=>{let t=D(D({},e),{},{version:"1.4.1"}),{interactiveFiltersConfig:r}=e;if(r){let{calculation:e}=r,i=(0,n.Z)(r,x);t.interactiveFiltersConfig=i}return t}},{description:"ALL + key",from:"1.4.2",to:"2.0.0",up:(e,t)=>{let r=D(D({},e),{},{version:"2.0.0"});return r.key=(0,b.M)(),r.meta=t.meta,r.activeField=t.activeField,r},down:e=>{let t=D(D({},e),{},{version:"1.4.2"});return delete t.key,t}},{description:"+ combo charts",from:"2.0.0",to:"2.1.0",up:e=>D(D({},e),{},{version:"2.1.0"}),down:e=>{let t=D(D({},e),{},{version:"2.0.0"});return["comboLineSingle","comboLineDual","comboLineColumn"].includes(t.chartType)&&(t.chartType="line",t.fields={x:t.fields.x,y:{componentIri:"comboLineSingle"===t.chartType?t.fields.y.componentIris[0]:"comboLineDual"===t.chartType?t.fields.y.leftAxisComponentIri:t.fields.y.lineComponentIri}}),t}},{description:`combo charts {
      y {
        + palette
        + colorMapping
      }
    }`,from:"2.1.0",to:"2.2.0",up:e=>{let t=D(D({},e),{},{version:"2.2.0"});return"comboLineSingle"===t.chartType?(t.fields.y.palette=f.h$,t.fields.y.colorMapping=(0,l.t6)({paletteId:f.h$,dimensionValues:t.fields.y.componentIris.map(e=>({value:e,label:e}))})):"comboLineDual"===t.chartType?(t.fields.y.palette=f.h$,t.fields.y.colorMapping=(0,l.t6)({paletteId:f.h$,dimensionValues:[t.fields.y.leftAxisComponentIri,t.fields.y.rightAxisComponentIri].map(e=>({value:e,label:e}))})):"comboLineColumn"===t.chartType&&(t.fields.y.palette=f.h$,t.fields.y.colorMapping=(0,l.t6)({paletteId:f.h$,dimensionValues:[t.fields.y.lineComponentIri,t.fields.y.columnComponentIri].map(e=>({value:e,label:e}))})),t},down:e=>{let t=D(D({},e),{},{version:"2.1.0"});return["comboLineSingle","comboLineDual","comboLineColumn"].includes(t.chartType)&&(delete t.fields.y.palette,delete t.fields.y.colorMapping),t}},{description:`ALL {
      + dataSet
    }`,from:"2.2.0",to:"2.3.0",up:(e,t)=>{let r=D(D({},e),{},{version:"2.3.0"}),{dataSet:n}=t;return r.dataSet=n,r},down:e=>{let t=D(D({},e),{},{version:"2.2.0"});return delete t.dataSet,t}},{description:`ALL {
      + cubes {
        + iri
        + filters
        + joinBy?
      }
      - dataSet
      - filters
    }`,from:"2.3.0",to:"3.0.0",up:e=>{let t=D(D({},e),{},{version:"3.0.0"});return t.cubes=[{iri:t.dataSet,filters:t.filters}],delete t.dataSet,delete t.filters,t},down:e=>{let t=D(D({},e),{},{version:"2.3.0"});return t.dataSet=t.cubes[0].iri,t.filters=t.cubes[0].filters,delete t.cubes,t}},{from:"3.0.0",to:"3.1.0",description:`map {
      color {
        + opacity
      }
    }`,up:e=>{let t=D(D({},e),{},{version:"3.1.0"});return"map"===t.chartType&&(t.fields.areaLayer&&(t.fields.areaLayer.color.opacity=a.pR),t.fields.symbolLayer&&"fixed"!==t.fields.symbolLayer.color.type&&(t.fields.symbolLayer.color.opacity=a.pR)),t},down:e=>{let t=D(D({},e),{},{version:"3.0.0"});return"map"===t.chartType&&(t.fields.areaLayer&&delete t.fields.areaLayer.color.opacity,t.fields.symbolLayer&&"fixed"!==t.fields.symbolLayer.color.type&&delete t.fields.symbolLayer.color.opacity),t}},{description:`ALL {
      + cubes {
        + publishIri
      }
    }`,from:"3.1.0",to:"3.2.0",up:e=>{let t=D(D({},e),{},{version:"3.2.0"});return t.cubes=t.cubes.map(e=>D(D({},e),{},{publishIri:e.iri})),t},down:e=>{let t=D(D({},e),{},{version:"3.1.0"});return t.cubes=t.cubes.map(e=>{let{publishIri:t}=e;return(0,n.Z)(e,C)}),t}},{description:`ALL {
      + cubes {
        +- joinBy (string) -> joinBy (string[])
      }
    }`,from:"3.2.0",to:"3.3.0",up:e=>{let t=D(D({},e),{},{version:"3.3.0"});return t.cubes=t.cubes.map(e=>("string"==typeof e.joinBy&&(e.joinBy=[e.joinBy]),e)),t},down:e=>{let t=D(D({},e),{},{version:"3.2.0"});return t.cubes=t.cubes.map(e=>(e.joinBy&&(e.joinBy=e.joinBy[0]),e)),t}},{description:`ALL {
      meta {
        + label
      }
    }`,from:"3.3.0",to:"3.4.0",up:e=>{let t=D(D({},e),{},{version:"3.4.0"});return t.meta.label={de:"",fr:"",it:"",en:""},t},down:e=>{let t=D(D({},e),{},{version:"3.3.0"});return delete t.meta.label,t}},{description:`ALL {
      cubes {
         + unversionedIri
         - publishIri
      }
    }`,from:"3.4.0",to:"4.0.0",up:async(e,t)=>{let r=[],i=e=>{let t=0,n="";for(let i of r){let r=(0,s.ZP)(e,i);r>t&&(t=r,n=i)}return n},o=D(D({},e),{},{version:"4.0.0"});for(let[e,s]of(o.cubes=await Promise.all(o.cubes.map(async e=>{let{publishIri:i}=e,o=(0,n.Z)(e,O),s=(0,y.K)()?async()=>await (0,g.p9)(o.iri,{client:u.L,dataSource:t.dataSource}):async()=>await (0,g.j0)(o.iri,{dataSource:t.dataSource}),a=await s();return r.push(a),D(D({},o),{},{joinBy:o.joinBy?.map(e=>m.OK({unversionedCubeIri:a,unversionedComponentIri:e})),filters:Object.fromEntries(Object.entries(e.filters).map(e=>{let[t,r]=e;return[(0,m.OK)({unversionedCubeIri:a,unversionedComponentIri:t}),r]}))})})),Object.entries(o.fields)))if("object"==typeof s&&("componentIris"in s?(s.componentIds=s.componentIris.map(e=>(0,p.BG)(e)?e:(0,m.OK)({unversionedCubeIri:i(e),unversionedComponentIri:e})),delete s.componentIris):"componentIri"in s&&(s.componentId=(0,p.BG)(s.componentIri)?s.componentIri:s.componentIri?(0,m.OK)({unversionedCubeIri:i(s.componentIri),unversionedComponentIri:s.componentIri}):"",delete s.componentIri),"measureIri"in s&&s.measureIri!==c.P&&(s.measureId=(0,p.BG)(s.measureIri)?s.measureIri:s.measureIri?(0,m.OK)({unversionedCubeIri:i(s.measureIri),unversionedComponentIri:s.measureIri}):"",delete s.measureIri),("comboLineColumn"===o.chartType||"comboLineDual"===o.chartType||"comboLineSingle"===o.chartType)&&"y"===e&&(s.colorMapping=Object.fromEntries(Object.entries(s.colorMapping).map(e=>{let[t,r]=e;return[(0,m.OK)({unversionedCubeIri:i(t),unversionedComponentIri:t}),r]}))),s.color&&"componentIri"in s.color&&(s.color.componentId=(0,p.BG)(s.color.componentIri)?s.color.componentIri:(0,m.OK)({unversionedCubeIri:i(s.color.componentIri),unversionedComponentIri:s.color.componentIri}),delete s.color.componentIri),"leftAxisComponentIri"in s&&(s.leftAxisComponentId=(0,p.BG)(s.leftAxisComponentIri)?s.leftAxisComponentIri:(0,m.OK)({unversionedCubeIri:i(s.leftAxisComponentIri),unversionedComponentIri:s.leftAxisComponentIri}),delete s.leftAxisComponentIri),"rightAxisComponentIri"in s&&(s.rightAxisComponentId=(0,p.BG)(s.rightAxisComponentIri)?s.rightAxisComponentIri:(0,m.OK)({unversionedCubeIri:i(s.rightAxisComponentIri),unversionedComponentIri:s.rightAxisComponentIri}),delete s.rightAxisComponentIri),"columnComponentIri"in s&&(s.columnComponentId=(0,p.BG)(s.columnComponentIri)?s.columnComponentIri:(0,m.OK)({unversionedCubeIri:i(s.columnComponentIri),unversionedComponentIri:s.columnComponentIri}),delete s.columnComponentIri),"lineComponentIri"in s&&(s.lineComponentId=(0,p.BG)(s.lineComponentIri)?s.lineComponentIri:(0,m.OK)({unversionedCubeIri:i(s.lineComponentIri),unversionedComponentIri:s.lineComponentIri}),delete s.lineComponentIri),"table"===o.chartType)){let t=(0,p.BG)(e)?e:(0,m.OK)({unversionedCubeIri:i(e),unversionedComponentIri:e});s.componentId=t,delete s.componentIri,o.fields[t]=s,delete o.fields[e]}for(let e of("table"===o.chartType&&(o.sorting=o.sorting.map(e=>{let{componentIri:t}=e;return D(D({},(0,n.Z)(e,w)),{},{componentId:(0,p.BG)(t)?t:(0,m.OK)({unversionedCubeIri:i(t),unversionedComponentIri:t})})})),Object.values(o.interactiveFiltersConfig??{})))"componentIris"in e?(e.componentIds=e.componentIris.map(e=>(0,p.BG)(e)?e:(0,m.OK)({unversionedCubeIri:i(e),unversionedComponentIri:e})),delete e.componentIris):"componentIri"in e&&(e.componentId=(0,p.BG)(e.componentIri)?e.componentIri:e.componentIri?(0,m.OK)({unversionedCubeIri:i(e.componentIri),unversionedComponentIri:e.componentIri}):"",delete e.componentIri);return o},down:async e=>{let t=D(D({},e),{},{version:"3.4.0"});for(let[e,r]of(t.cubes=t.cubes.map(async e=>D(D({},e),{},{joinBy:e.joinBy?.map(e=>m.O1(e).unversionedComponentIri),publishIri:e.iri,filters:Object.fromEntries(Object.entries(e.filters).map(e=>{let[t,r]=e;return[(0,m.O1)(t).unversionedComponentIri,r]}))})),Object.entries(t.fields)))if("object"==typeof r&&("componentIds"in r?(r.componentIris=r.componentIds.map(e=>(0,m.O1)(e).unversionedComponentIri),delete r.componentIds):"componentId"in r&&(r.componentIri=r.componentId?(0,m.O1)(r.componentId).unversionedComponentIri:"",delete r.componentId),"measureId"in r&&r.measureId!==c.P&&(r.measureIri=r.measureId?(0,m.O1)(r.measureId).unversionedComponentIri:"",delete r.measureId),("comboLineColumn"===t.chartType||"comboLineDual"===t.chartType||"comboLineSingle"===t.chartType)&&"y"===e&&(r.colorMapping=Object.fromEntries(Object.entries(r.colorMapping).map(e=>{let[t,r]=e;return[(0,m.O1)(t).unversionedComponentIri,r]}))),r.color&&"componentId"in r.color&&(r.color.componentIri=(0,m.O1)(r.color.componentId).unversionedComponentIri,delete r.color.componentId),"leftAxisComponentId"in r&&(r.leftAxisComponentIri=(0,m.O1)(r.leftAxisComponentId).unversionedComponentIri,delete r.leftAxisComponentId),"rightAxisComponentId"in r&&(r.rightAxisComponentIri=(0,m.O1)(r.rightAxisComponentId).unversionedComponentIri,delete r.rightAxisComponentId),"columnComponentId"in r&&(r.columnComponentIri=(0,m.O1)(r.columnComponentId).unversionedComponentIri,delete r.columnComponentId),"lineComponentId"in r&&(r.lineComponentIri=(0,m.O1)(r.lineComponentId).unversionedComponentIri,delete r.lineComponentId),"table"===t.chartType)){let n=(0,m.O1)(e).unversionedComponentIri;r.componentIri=n,delete r.componentId,t.fields[n]=r,delete t.fields[e]}for(let e of Object.values(t.interactiveFiltersConfig??{}))"componentIds"in e?(e.componentIris=e.componentIds.map(e=>(0,m.O1)(e).unversionedComponentIri),delete e.componentIds):"componentId"in e&&(e.componentIri=e.componentId?(0,m.O1)(e.componentId).unversionedComponentIri:"",delete e.componentId);return t}},{description:`ALL {
      cubes {
        - joinBy: null
      }
      fields {
        segment {
          - colorMapping
        }
        y {
          - colorMapping
        }
        + color {
          + type
          + paletteId
          + colorMapping / color
        }
      }
    }`,from:"4.0.0",to:"4.1.0",up:e=>{let t=D(D({},e),{},{version:"4.1.0"});return t.cubes.forEach(e=>{null===e.joinBy&&delete e.joinBy}),"table"===t.chartType||("map"===t.chartType?(t.fields.areaLayer?.color&&"palette"in t.fields.areaLayer.color&&(t.fields.areaLayer.color.paletteId=t.fields.areaLayer.color.palette,delete t.fields.areaLayer.color.palette),t.fields.symbolLayer?.color&&"palette"in t.fields.symbolLayer.color&&(t.fields.symbolLayer.color.paletteId=t.fields.symbolLayer.color.palette,delete t.fields.symbolLayer.color.palette)):(t.fields?.color||t.fields?.y?.colorMapping||t.fields?.segment?.colorMapping||(t.fields=D(D({},t.fields),{},{color:{type:"single",paletteId:"category10",color:o.Z[0]}})),t.fields?.segment?.colorMapping&&(t.fields=D(D({},t.fields),{},{color:{type:"segment",paletteId:t.fields.segment.palette||"category10",colorMapping:t.fields.segment.colorMapping}}),delete t.fields.segment.colorMapping,delete t.fields.segment.palette),t.fields?.y?.colorMapping&&(t.fields=D(D({},t.fields),{},{color:{type:"measures",paletteId:t.fields.y.palette||"category10",colorMapping:t.fields.y.colorMapping}}),delete t.fields.y.colorMapping,delete t.fields.y.palette))),t},down:e=>{let t=D(D({},e),{},{version:"4.0.0"});return"table"===t.chartType||("map"===t.chartType?(t.fields.areaLayer?.color&&"paletteId"in t.fields.areaLayer.color&&(t.fields.areaLayer.color.palette=t.fields.areaLayer.color.paletteId,delete t.fields.areaLayer.color.paletteId),t.fields.symbolLayer?.color&&"paletteId"in t.fields.symbolLayer.color&&(t.fields.symbolLayer.color.palette=t.fields.symbolLayer.color.paletteId,delete t.fields.symbolLayer.color.paletteId)):t.fields?.color&&("segment"===t.fields.color.type&&(t.fields=D(D({},t.fields),{},{segment:D(D({},t.fields.segment),{},{colorMapping:t.fields.color.colorMapping,palette:t.fields.color.paletteId})})),"measures"===t.fields.color.type&&(t.fields=D(D({},t.fields),{},{y:D(D({},t.fields.y),{},{colorMapping:t.fields.color.colorMapping,palette:t.fields.color.paletteId})})),delete t.fields.color)),t}},{from:"4.1.0",to:"4.2.0",description:`all {
      + limits
    }`,up:e=>{let t=D(D({},e),{},{version:"4.2.0"});return t.limits={},t},down:e=>{let t=D(D({},e),{},{version:"4.1.0"});return delete t.limits,t}},{from:"4.2.0",to:"4.3.0",description:`maps {
      baseLayer {
        + customLayers
      }
    }`,up:e=>{let t=D(D({},e),{},{version:"4.3.0"});return"map"===t.chartType&&(t.baseLayer.customLayers=[]),t},down:e=>{let t=D(D({},e),{},{version:"4.2.0"});return"map"===t.chartType&&delete t.baseLayer.customLayers,t}},{from:"4.3.0",to:"4.4.0",description:`all {
      fields {
        segment {
          + showValuesMapping
        }
      }
    }`,up:e=>{let t=D(D({},e),{},{version:"4.4.0"});return t.fields.segment&&(t.fields.segment.showValuesMapping={}),t},down:e=>{let t=D(D({},e),{},{version:"4.3.0"});return t.fields.segment&&delete t.fields.segment.showValuesMapping,t}},{from:"4.4.0",to:"4.5.0",description:`all {
      + conversionUnitsByComponentId
    }`,up:e=>{let t=D(D({},e),{},{version:"4.5.0"});return t.conversionUnitsByComponentId={},t},down:e=>{let t=D(D({},e),{},{version:"4.4.0"});return t.conversionUnitsByComponentId&&delete t.conversionUnitsByComponentId,t}},{from:"4.5.0",to:"4.6.0",description:`ALL {
      interactiveFiltersConfig can't be undefined anymore
    }`,up:e=>{let t=D(D({},e),{},{version:"4.6.0"});return t.interactiveFiltersConfig?(t.interactiveFiltersConfig.dataFilters.defaultValueOverrides={},t.interactiveFiltersConfig.dataFilters.filterTypes=Object.fromEntries(t.interactiveFiltersConfig.dataFilters.componentIds.map(e=>[e,"single"]))):t.interactiveFiltersConfig={legend:{active:!1,componentId:""},timeRange:{active:!1,componentId:"",presets:{type:"range",from:"",to:""}},dataFilters:{active:!1,componentIds:[],defaultValueOverrides:{},filterTypes:{},defaultOpen:!0},calculation:{active:!1,type:"identity"}},t},down:e=>{let t=D(D({},e),{},{version:"4.5.0"});return"table"===t.chartType?t.interactiveFiltersConfig=void 0:t.interactiveFiltersConfig&&(delete t.interactiveFiltersConfig.dataFilters.defaultValueOverrides,delete t.interactiveFiltersConfig.dataFilters.filterTypes),t}},{from:"4.6.0",to:"5.0.0",description:`all {
        + annotations
      }
    `,up:e=>{let t=D(D({},e),{},{version:"5.0.0"});return t.annotations=[],t},down:e=>{let t=D(D({},e),{},{version:"4.5.0"});return delete t.annotations,t}},{from:"5.0.0",to:"5.1.0",description:`table chart {
      links {
        + enabled
        + baseUrl
        + componentId
      }
    }`,up:e=>{let t=D(D({},e),{},{version:"5.1.0"});return"table"===t.chartType&&(t.links={enabled:!1,baseUrl:"",componentId:"",targetComponentId:""}),t},down:e=>{let t=D(D({},e),{},{version:"5.0.0"});return"table"===t.chartType&&delete t.links,t}}],{defaultToVersion:h.e}),E=e=>{let{fromVersion:t,toVersion:r,fromChartConfigVersion:n,toChartConfigVersion:i}=e;return{description:"ALL (bump ChartConfig version)",from:t,to:r,up:async e=>{let t=D(D({},e),{},{version:r}),n=[];for(let e of t.chartConfigs){let r=await Z(e,{migrationProps:t,toVersion:i});n.push(r)}return t.chartConfigs=n,t},down:async e=>{let r=D(D({},e),{},{version:t}),i=[];for(let e of r.chartConfigs){let t=await Z(e,{migrationProps:r,toVersion:n});i.push(t)}return r.chartConfigs=i,r}}},M=A([{description:"ALL",from:"1.0.0",to:"2.0.0",up:async e=>{let t=D(D({},e),{},{version:"2.0.0"}),r=await Z(t.chartConfig,{migrationProps:t,toVersion:"2.0.0"});return t.chartConfigs=[r],delete t.chartConfig,delete t.activeField,t.meta={title:{de:"",fr:"",it:"",en:""},description:{de:"",fr:"",it:"",en:""}},t.activeChartKey=r.key,t},down:async e=>{let t=D(D({},e),{},{version:"1.0.0"}),r=t.chartConfigs[0];delete t.chartConfigs,delete t.activeChartKey,t.meta=r.meta,t.activeField=r.activeField;let n=await Z(r,{toVersion:"1.4.2"});return t.chartConfig=n,t}},{description:"ALL",from:"2.0.0",to:"3.0.0",up:async e=>{let t=D(D({},e),{},{version:"3.0.0"}),r=[];for(let e of t.chartConfigs){let n=await Z(e,{migrationProps:t,toVersion:"2.3.0"});r.push(n)}return delete t.dataSet,t.chartConfigs=r,t},down:async e=>{let t;let r=D(D({},e),{},{version:"2.0.0"}),n=[];for(let e of r.chartConfigs)if(t||(t=e.dataSet),e.dataSet===t){let t=await Z(e,{migrationProps:r,toVersion:"2.2.0"});n.push(t)}else console.warn("Cannot migrate chartConfig dataSet to configuratorState dataSet because they are not the same.");return r.dataSet=t,r}},E({fromVersion:"3.0.0",toVersion:"3.0.1",fromChartConfigVersion:"2.3.0",toChartConfigVersion:"3.0.0"}),{description:"ALL + layout",from:"3.0.1",to:"3.1.0",up:e=>{let t=D(D({},e),{},{version:"3.1.0"});return t.layout={type:"tab",meta:t.meta,activeField:void 0},delete t.meta,t},down:e=>{let t=D(D({},e),{},{version:"3.0.1"});return t.meta=t.layout.meta??{title:{de:"",fr:"",it:"",en:""},description:{de:"",fr:"",it:"",en:""}},delete t.layout,t}},E({fromVersion:"3.1.0",toVersion:"3.2.0",fromChartConfigVersion:"3.1.0",toChartConfigVersion:"3.2.0"}),{description:"ALL (add dataSource in case it's missing)",from:"3.2.0",to:"3.2.1",up:e=>{let t=D(D({},e),{},{version:"3.2.1"});return t.dataSource?t.dataSource.url===d.eI&&(t.dataSource.url=d.sp):t.dataSource={type:"sparql",url:d.sp},t},down:e=>D(D({},e),{},{version:"3.2.0"})},{description:"ALL (add dashboardFilters)",from:"3.2.1",to:"3.3.0",up:e=>D(D({},e),{},{version:"3.3.0",dashboardFilters:{filters:[]}}),down:e=>{let t=D(D({},e),{},{version:"3.2.1"});return delete t.dashboardFilters,t}},E({fromVersion:"3.3.0",toVersion:"3.4.0",fromChartConfigVersion:"3.2.0",toChartConfigVersion:"3.3.0"}),{description:"ALL (modify dashboardFilters)",from:"3.4.0",to:"3.5.0",up:e=>{let t=e.dashboardFilters.filters[0];return D(D({},e),{},{version:"3.5.0",dashboardFilters:{timeRange:t?{active:t.active,timeUnit:"",presets:{from:t.from??"",to:t.to??""}}:{active:!1,timeUnit:"",presets:{from:"",to:""}}}})},down:e=>{let t=e.dashboardFilters.timeRange;return D(D({},e),{},{version:"3.4.0",dashboardFilters:{filters:[{type:"timeRange",active:t.active,componentIri:"",presets:{type:"range",from:t.presets.from,to:t.presets.to}}]}})}},{description:"ALL (modify dashboardFilters)",from:"3.5.0",to:"3.6.0",up:e=>D(D({},e),{},{version:"3.6.0",dashboardFilters:D(D({},e.dashboardFilters),{},{dataFilters:{componentIris:[],filters:{}}})}),down:e=>D(D({},e),{},{version:"3.5.0",dashboardFilters:{timeRange:e.dashboardFilters.timeRange}})},{description:`ALL {
      meta {
        + label
      }
    } & bump ChartConfig version`,from:"3.6.0",to:"3.7.0",up:async e=>{let{layout:t}=e,r=(0,n.Z)(e,I),{meta:i}=t,o=(0,n.Z)(t,S),s=D(D({},r),{},{version:"3.7.0",layout:D(D({},o),{},{meta:D(D({},i),{},{label:{de:"",fr:"",it:"",en:""}})})}),a=[];for(let e of s.chartConfigs){let t=await Z(e,{migrationProps:s,toVersion:"3.4.0"});a.push(t)}return s.chartConfigs=a,s},down:async e=>{let{layout:t}=e,r=(0,n.Z)(e,P),i=t.meta,{meta:o}=i,s=(0,n.Z)(i,k),{label:a}=o,l=(0,n.Z)(o,_),c=D(D({},r),{},{version:"3.6.0",layout:D(D({},s),{},{meta:l})}),d=[];for(let e of c.chartConfigs){let t=await Z(e,{migrationProps:c,toVersion:"3.3.0"});d.push(t)}return c.chartConfigs=d,c}},{description:"ALL (add layoutsMetadata to free canvas layout)",from:"3.7.0",to:"3.8.0",up:e=>{let t=D(D({},e),{},{version:"3.8.0"});return"dashboard"===t.layout.type&&"canvas"===t.layout.layout&&(t.layout.layoutsMetadata=t.chartConfigs.reduce((e,t)=>(e[t.key]={initialized:!0},e),{})),t},down:e=>{let t=D(D({},e),{},{version:"3.7.0"});return"dashboard"===t.layout.type&&"canvas"===t.layout.layout&&delete t.layout.layoutsMetadata,t}},{description:"ALL (bump ChartConfig version) + migrate dataFilters",from:"3.8.0",to:"4.0.0",up:async e=>{let t=D(D({},e),{},{version:"4.0.0"}),r=[];for(let e of t.chartConfigs){let n=await Z(e,{migrationProps:t,toVersion:"4.0.0"});r.push(n)}t.chartConfigs=r;let n=t.dashboardFilters.dataFilters;for(let e of n.componentIris)e:for(let r of t.chartConfigs.flatMap(e=>e.cubes))for(let t of Object.keys(r.filters))if(t.includes(e)){n.componentIris=[...n.componentIris.filter(t=>t!==e),t],n.filters[t]=n.filters[e],delete n.filters[e];break e}return n.componentIds=n.componentIris,delete n.componentIris,t.dashboardFilters.dataFilters=n,t},down:async e=>{let t=D(D({},e),{},{version:"3.8.0"}),r=[];for(let e of t.chartConfigs){let n=await Z(e,{migrationProps:t,toVersion:"3.4.0"});r.push(n)}t.chartConfigs=r;let n=t.dashboardFilters.dataFilters;for(let e of n.componentIds)n.componentIds=[...n.componentIds.filter(t=>t!==e),(0,m.O1)(e).unversionedComponentIri];for(let e of Object.keys(n.filters))n.filters[(0,m.O1)(e).unversionedComponentIri]=n.filters[e],delete n.filters[e];return n.componentIris=n.componentIds,delete n.componentIds,t.dashboardFilters.dataFilters=n,t}},E({fromVersion:"4.0.0",toVersion:"4.1.0",fromChartConfigVersion:"4.0.0",toChartConfigVersion:"4.1.0"}),{description:`ALL {
      layout {
        + blocks
        - layoutsMetadata
      }
    }`,from:"4.1.0",to:"4.2.0",up:async e=>{let t=D(D({},e),{},{version:"4.2.0"});return t.layout.layoutsMetadata&&delete t.layout.layoutsMetadata,t.layout.blocks=t.chartConfigs.map(e=>({type:"chart",key:e.key,initialized:!1})),t},down:async e=>{let t=D(D({},e),{},{version:"4.1.0"});return"dashboard"===t.layout.type&&"canvas"===t.layout.layout&&(t.layout.layoutsMetadata=Object.fromEntries(t.layout.blocks.map(e=>{let{key:t,initialized:r}=e;return[t,{initialized:r}]}))),delete t.layout.blocks,t}},E({fromVersion:"4.2.0",toVersion:"4.3.0",fromChartConfigVersion:"4.1.0",toChartConfigVersion:"4.2.0"}),E({fromVersion:"4.3.0",toVersion:"4.4.0",fromChartConfigVersion:"4.2.0",toChartConfigVersion:"4.3.0"}),E({fromVersion:"4.4.0",toVersion:"4.5.0",fromChartConfigVersion:"4.3.0",toChartConfigVersion:"4.4.0"}),E({fromVersion:"4.5.0",toVersion:"4.6.0",fromChartConfigVersion:"4.4.0",toChartConfigVersion:"4.5.0"}),E({fromVersion:"4.6.0",toVersion:"4.7.0",fromChartConfigVersion:"4.5.0",toChartConfigVersion:"4.6.0"}),E({fromVersion:"4.7.0",toVersion:"5.0.0",fromChartConfigVersion:"4.6.0",toChartConfigVersion:"5.0.0"}),E({fromVersion:"5.0.0",toVersion:"5.1.0",fromChartConfigVersion:"5.0.0",toChartConfigVersion:"5.1.0"})],{defaultToVersion:h.o});function A(e,t){let{defaultToVersion:r}=t;return async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{fromVersion:i,toVersion:o=r,migrationProps:s}=n,a=async function(t){let{fromVersion:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r??t.version??"1.0.0",i=L(n,o);if("same"===i)return t;let l=e.find(e=>e["up"===i?"from":"to"]===n);if(l){let e=await l[i](t,s);return await a(e,{fromVersion:r})}};return await a(t,{fromVersion:i})}}let L=(e,t)=>{let r=e.split(".").map(e=>+e),n=t.split(".").map(e=>+e);for(let e=0;e<r.length;e++){if(r[e]<n[e])return"up";if(r[e]>n[e])return"down"}return"same"}},59823:function(e,t,r){"use strict";r.d(t,{M:function(){return i}});var n=r(78647);let i=()=>(0,n.x0)(12)},31853:function(e,t,r){"use strict";r.d(t,{W:function(){return s},e:function(){return a}});let n="__SEP__",i="__NUM__",o="__NL__",s=e=>`#${l(e).join("||")}`,a=e=>c(decodeURIComponent(e.slice(1)).split("||")),l=e=>Object.entries(d(e)).map(e=>{let[t,r]=e;return`${t}=${r}`}),c=e=>{let t={};return e.forEach(e=>{let r=e.indexOf("=");if(-1===r)return;let n=e.slice(0,r),i=e.slice(r+1);t[n]=i}),p(t)},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"==typeof e&&null!==e&&!Array.isArray(e)&&0===Object.keys(e).length)return r[t]="{}",r;for(let s in e)if(e.hasOwnProperty(s)){let a=t?`${t}${n}${s}`:s,l=e[s];"object"!=typeof l||null===l||Array.isArray(l)?Array.isArray(l)?0===l.length?r[a]="[]":l.forEach((e,t)=>{let i=`${a}${n}${t}`;"object"==typeof e&&null!==e?d(e,i,r):r[i]="string"==typeof e?e.replace(/\n/g,o):`${e}`}):r[a]="number"==typeof l?`${i}${l}`:"string"==typeof l?l.replace(/\n/g,o):`${l}`:0===Object.keys(l).length?r[a]="{}":d(l,a,r)}return r},u=e=>{if("true"===e)return!0;if("false"===e)return!1;if("null"===e)return null;if("undefined"!==e){if("[]"===e)return[];if("{}"===e)return{};if("string"==typeof e&&e.startsWith(i)){let t=e.slice(i.length);if(""!==t&&!isNaN(+t))return+t}return"string"==typeof e?e.replace(RegExp(o,"g"),"\n"):e}},p=e=>{let t={};for(let r in e)if(e.hasOwnProperty(r)){let i=r.split(n);i.reduce((t,n,o)=>o!==i.length-1?(n in t||(t[n]={}),t[n]):(t[n]=e[r],t),t)}let r=e=>{if("object"!=typeof e||null===e)return u(e);for(let t in e)e.hasOwnProperty(t)&&(e[t]=r(e[t]));let t=Object.keys(e);return t.length>0&&t.every(e=>!isNaN(Number(e)))?t.sort((e,t)=>Number(e)-Number(t)).map(t=>e[t]):e};return r(t)}},4352:function(e,t,r){"use strict";r.d(t,{n:function(){return l},s:function(){return c}});var n=r(17043),i=r(17510),o=r(57060);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let l=(e,t)=>{let r=t?new Set(t):void 0,n=e=>{let t=e.children&&e.children.length>0?e.children.map(n).filter(i.y):void 0;if(!r||r.has(e.value)||t&&0!==t.length)return a(a({},e),{},{selectable:!!e.hasValue,children:t})};return(0,o.q4)(e).map(n).filter(i.y)},c=e=>-1===e.depth},38248:function(e,t,r){"use strict";r.d(t,{b:function(){return n}});let n=(e,t)=>{let r=Array(Math.max(2*e.length-1,0));for(let n=0;n<e.length;n++)r[2*n]=e[n],n<e.length-1&&(r[2*n+1]="function"==typeof t?t(n):t);return r}},7378:function(e,t,r){"use strict";r.d(t,{T:function(){return l},y:function(){return a}});var n=r(17043),i=r(28646),o=r(60090),s=r(47626);class a{constructor(){(0,n.Z)(this,"observers",void 0),(0,n.Z)(this,"getUpdateKey",void 0),(0,n.Z)(this,"subscribe",e=>(this.observers.push(e),()=>this.unsubscribe(e))),(0,n.Z)(this,"unsubscribe",e=>{this.observers=this.observers.filter(t=>t!==e)}),(0,n.Z)(this,"notify",()=>{this.observers.forEach(e=>e())}),this.observers=[]}}class l extends a{constructor(e){var t;let r;super(),t=this,(0,n.Z)(this,"type",void 0),(0,n.Z)(this,"animationType",void 0),(0,n.Z)(this,"playing",!1),(0,n.Z)(this,"animationProgress",1),(0,n.Z)(this,"animationDuration",void 0),(0,n.Z)(this,"requestAnimationFrameId",void 0),(0,n.Z)(this,"t",void 0),(0,n.Z)(this,"values",void 0),(0,n.Z)(this,"msValues",void 0),(0,n.Z)(this,"msValue",void 0),(0,n.Z)(this,"minMsValue",void 0),(0,n.Z)(this,"maxMsValue",void 0),(0,n.Z)(this,"msValueScale",(0,s.Z)()),(0,n.Z)(this,"msRelativeValues",void 0),(0,n.Z)(this,"formatValue",void 0),(0,n.Z)(this,"formattedMsExtent",void 0),(0,n.Z)(this,"getUpdateKey",()=>`${this.playing}_${this.progress}`),(0,n.Z)(this,"start",()=>{this.playing||(1===this.animationProgress&&this.setProgress(0,!0),this.playing=!0,this.requestAnimationFrameId=requestAnimationFrame(this.animate.bind(this)))}),(0,n.Z)(this,"animate",e=>{if(void 0===this.t&&(this.t=e-this.animationProgress*this.animationDuration),e-this.t>this.animationDuration)this.stop(!1),this.setProgress(1);else{let t=(e-this.t)/this.animationDuration;this.setProgress(t,!0),this.requestAnimationFrameId=requestAnimationFrame(this.animate.bind(this))}}),(0,n.Z)(this,"stop",function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];t.playing&&(t.playing=!1,t.t=void 0,t.requestAnimationFrameId&&(cancelAnimationFrame(t.requestAnimationFrameId),t.requestAnimationFrameId=void 0),e&&t.notify())}),(0,n.Z)(this,"setProgress",function(e){let r,n,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(t.animationType){case"continuous":t.animationProgress=e,r=e;break;case"stepped":if(o)n=Math.floor(e*t.msValues.length);else{let r=Math.round(t.msValueScale(e));n=(0,i.ZP)(t.msValues,r)-1}let s=t.msRelativeValues[n];t.animationProgress=n/(t.msValues.length-1),r=s}t.setValue(r),t.notify()}),(0,n.Z)(this,"setValue",e=>{let t=Math.round(this.msValueScale(e)),r=(0,i.ZP)(this.msValues,t)-1;this.msValue=this.msValues[r]});let{type:a,animationType:l,msDuration:c}=e;switch(this.type=a,e.type){case"interval":r=e.formatValue,this.msValues=e.msValues.sort(o.Z),this.values=this.msValues;break;case"ordinal":r=t=>e.sortedData[Math.round(t/1e3)],this.msValues=e.sortedData.map((e,t)=>1e3*t),this.values=e.sortedData}this.animationType=l,this.animationDuration=c;let[d,u]=[this.msValues[0],this.msValues[this.msValues.length-1]];this.msValue=u,this.minMsValue=d,this.maxMsValue=u,this.msValueScale=this.msValueScale.range([d,u]),this.msRelativeValues=this.msValues.map(this.msValueScale.invert),this.formatValue=r,this.formattedMsExtent=[d,u].map(r)}get domain(){return this.msRelativeValues}get value(){return"interval"===this.type?this.msValue:this.values[Math.round(this.msValue/1e3)]}get formattedValue(){return this.formatValue(this.msValue)}get formattedExtent(){return this.formattedMsExtent}get progress(){switch(this.animationType){case"continuous":return this.animationProgress;case"stepped":return(this.msValue-this.minMsValue)/(this.maxMsValue-this.minMsValue)}}}},11051:function(e,t,r){"use strict";r.d(t,{M:function(){return i}});var n=r(64103);let i=e=>{let{dimension:t,formatLocale:r,timeFormatUnit:i}=e,{timeFormat:s,timeUnit:a}=t,l=o({formatLocale:r,timeFormat:s}),c=r.format(s),d=[];for(let e of[...t.values,...t.relatedLimitValues]){let r;switch(t.__typename){case"TemporalDimension":r=e.value;break;case"TemporalEntityDimension":r=(0,n.Mp)(e);break;default:return t}let o=l(r);o&&d.push({value:c(o),label:i(o,a),date:o})}let u=d.sort((e,t)=>e.date.getTime()-t.date.getTime());return{sortedOptions:u,sortedValues:u.map(e=>e.value)}},o=e=>{let{formatLocale:t,timeFormat:r}=e,n=t.parse(r),i=t.parse(`${r}%Z`);return e=>n(`${e}`)??i(`${e}`)}},83513:function(e,t,r){"use strict";r.d(t,{o:function(){return n}});let n=e=>Error(`This should be unreachable! but got ${e}`)},35904:function(e,t,r){"use strict";r.d(t,{$5:function(){return u},Tu:function(){return m},sj:function(){return p}});var n=r(17043),i=r(27378),o=r(22175);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class l{constructor(){(0,n.Z)(this,"cache",void 0),(0,n.Z)(this,"listeners",void 0),(0,n.Z)(this,"version",void 0),this.cache=new Map,this.listeners=[],this.version=0}set(e,t){this.cache.set((0,o.h)(e),t),this.version++,this.fire(e)}get(e){return this.cache.get((0,o.h)(e))||{data:null,error:null,status:"idle"}}fire(e){let t=(0,o.h)(e);this.listeners.forEach(e=>{let[r,n]=e;return t===r&&n()})}listen(e,t){return this.listeners.push([(0,o.h)(e),t]),()=>void this.listeners.splice(this.listeners.findIndex(e=>e[1]===t),1)}}let c=new l,d=(e,t)=>{let{0:r,1:n}=(0,i.useState)(e.version);return(0,i.useEffect)(()=>e.listen(t,()=>{n(()=>e.version)}),[e,(0,o.h)(t)]),r},u=e=>{let{queryKey:t,queryFn:r,options:n={}}=e,{pause:s,defaultData:l}=n,u=c.get(t),{data:p,error:m,status:f}=u??{},h=(0,i.useCallback)(async()=>{let e=c.get(t);if(e?.status!=="fetching"){c.set(t,a(a({},c.get(t)),{},{status:"fetching"}));try{let e={data:await r(),error:null,status:"success"};return c.set(t,e),e}catch(r){let e={data:null,error:r,status:"error"};return c.set(t,e),e}}},[(0,o.h)(t)]);return d(c,t),(0,i.useEffect)(()=>{if(s){c.set(t,a(a({},c.get(t)),{},{status:"idle"}));return}"idle"===u.status&&h()},[s,h,(0,o.h)(t),u.data]),{data:p??l,error:m,status:f,invalidate:(0,i.useCallback)(()=>{h()},[h])}},p=(e,t)=>{let r=(0,i.useRef)(!1);r.current||(c.set(e,{data:t,error:null,status:"success"}),r.current=!0)},m=e=>{let{0:t,1:r}=(0,i.useState)(null),{0:n,1:o}=(0,i.useState)(null),{0:s,1:a}=(0,i.useState)("idle");return{data:t,error:n,status:s,mutate:(0,i.useCallback)(async function(){a("fetching");try{let t=await e(...arguments);return r(t),a("success"),t}catch(e){o(e),a("error")}},[e]),reset:(0,i.useCallback)(()=>{r(null),o(null),a("idle")},[])}}},66963:function(e,t,r){"use strict";r.d(t,{Q:function(){return i}});var n=r(96338);let i=()=>{let{i18n:e}=(0,n.mV)();return e}},71171:function(e,t,r){"use strict";r.d(t,{Dd:function(){return f},Kv:function(){return p},nT:function(){return h}});var n=r(59245),i=r(83763),o=r(93224),s=r(27378),a=r(83001),l=r(78081),c=r(80065),d=r(31251),u=r(30816).Buffer;let p=e=>{let{type:t,screenshotName:r,screenshotNode:n,modifyNode:i,pngMetadata:o}=e,{0:a,1:l}=(0,s.useState)(!1),c=(0,s.useCallback)(async(e,t)=>{g(e),i&&await i(e,t)},[i]);return{loading:a,screenshot:(0,s.useCallback)(async()=>{if(n){l(!0);try{await m({type:t,name:r,node:n,modifyNode:c,pngMetadata:o})}catch(e){console.error(e)}finally{l(!1)}}},[n,t,r,c,o])}},m=async e=>{let{type:t,name:r,node:s,modifyNode:p,pngMetadata:m}=e,f=!!(0,d.K)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent),h=document.createElement("div");h.style.width=`${s.offsetWidth}px`,document.body.appendChild(h);let g=s.cloneNode(!0),b=(0,n.Z)(s).selectAll("canvas").nodes(),y=(0,n.Z)(g).selectAll("canvas").nodes();for(let e of b)y[b.indexOf(e)].getContext("2d").drawImage(e,0,0),await (0,c.r)();await p?.(g,s),h.appendChild(g);let v=g.querySelector(`.${l.CW}`),j=v?.querySelector(`#${a.vw}`),x=j?.getAttribute("height"),C=j?.parentElement;v&&x&&C&&(v.style.height="fit-content",C.style.height=`${x}px`,C.style.overflow="visible"),await (0,c.r)(),f&&"png"===t&&await (0,i.YM)(h),await ("png"===t?i.YM:i.KT)(h).then(e=>{let n=e=>{let n=document.createElement("a");n.href=e,n.download=`${r}.${t}`,n.click()};switch(t){case"png":{let t=Uint8Array.from(atob(e.split(",")[1]),e=>e.charCodeAt(0));return m?.forEach(e=>{let{key:r,value:n}=e;t=o.addMetadata(t,r,n)}),n(`data:image/png;base64,${u.from(t).toString("base64")}`)}case"svg":return n(e);default:return t}}).catch(e=>console.error(e)).finally(()=>{h.remove()})},f="data-disable-screenshot",h={[f]:!0},g=e=>{e.querySelectorAll(`[${f}="true"]`).forEach(e=>e.remove())}},15351:function(e,t,r){"use strict";r.d(t,{K:function(){return i}});var n=r(27378);let i=(e,t)=>{let{0:r,1:i}=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let t=setTimeout(()=>{i(!0)},e);return()=>{clearTimeout(t)}},[e,t]),(0,n.useEffect)(()=>{i(!1)},[t]),r}},59159:function(e,t,r){"use strict";r.d(t,{H:function(){return a}});var n=r(27378),i=r(59266),o=r(37079),s=r(35904);let a=()=>{let e=(0,i.a)(),t=(0,n.useMemo)(()=>["colorPalettes",e?.id],[e?.id]);return(0,s.$5)({queryKey:t,queryFn:o.XG,options:{pause:!e?.id}})}},50937:function(e){e.exports={root:"chart-panel-layout-tall_root__kTIUE"}},25436:function(e){e.exports={common:"markdown_common__MyYa4",inheritFonts:"markdown_inheritFonts__aOOs4"}},83039:function(){},81195:function(){},74130:function(){},16357:function(){},46770:function(){},50471:function(){},71632:function(){}}]);
//# sourceMappingURL=65362-4350bad9740a99a0.js.map