{"version":3,"file":"static/chunks/pages/_preview-2826cdcb029630f4.js","mappings":"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","sources":["webpack://_N_E/./pages/_preview.tsx","webpack://_N_E/./utils/hash-utils.ts","webpack://_N_E/?0289"],"sourcesContent":["import { Box } from \"@mui/material\";\nimport { useEffect } from \"react\";\n\nimport { useLocale } from \"@/locales/use-locale\";\nimport CONFIGURATOR_STATE_MAP from \"@/test/__fixtures/config/prod/map-1.json\";\nimport { objectToHashString } from \"@/utils/hash-utils\";\n\nconst loadIframe = (id: string, config: any) => {\n  const iframe = document.getElementById(id) as HTMLIFrameElement;\n\n  const handleMessage = (e: MessageEvent) => {\n    if (e.data?.type === \"ready\" && e.source === iframe.contentWindow) {\n      iframe.contentWindow?.postMessage(config, \"*\");\n      window.removeEventListener(\"message\", handleMessage);\n    }\n  };\n\n  window.addEventListener(\"message\", handleMessage);\n};\n\nconst Page = () => {\n  const locale = useLocale();\n\n  useEffect(() => {\n    loadIframe(\"chart-map\", CONFIGURATOR_STATE_MAP);\n  }, []);\n\n  return (\n    <Box\n      sx={{\n        display: \"flex\",\n        gap: 6,\n        p: 6,\n        \"& > iframe\": {\n          width: 450,\n          height: 750,\n          border: \"none\",\n        },\n      }}\n    >\n      <iframe\n        id=\"chart-column\"\n        src={`/${locale}/preview${objectToHashString(CONFIGURATOR_STATE_COLUMN)}`}\n      />\n      <iframe id=\"chart-map\" src={`/${locale}/preview`} />\n    </Box>\n  );\n};\n\nexport default Page;\n\nconst CONFIGURATOR_STATE_COLUMN = {\n  state: \"CONFIGURING_CHART\",\n  dataSet:\n    \"https://energy.ld.admin.ch/sfoe/bfe_ogd84_einmalverguetung_fuer_photovoltaikanlagen/2\",\n  dataSource: {\n    type: \"sparql\",\n    url: \"https://lindas-cached.cluster.ldbar.ch/query\",\n  },\n  meta: {\n    title: { de: \"\", fr: \"\", it: \"\", en: \"\" },\n    description: { de: \"\", fr: \"\", it: \"\", en: \"\" },\n  },\n  chartConfig: {\n    version: \"1.4.2\",\n    chartType: \"column\",\n    filters: {\n      \"https://energy.ld.admin.ch/sfoe/bfe_ogd84_einmalverguetung_fuer_photovoltaikanlagen/Kanton\":\n        { type: \"single\", value: \"https://ld.admin.ch/canton/1\" },\n    },\n    interactiveFiltersConfig: {\n      legend: { active: false, componentIri: \"\" },\n      timeRange: {\n        active: false,\n        componentIri:\n          \"https://energy.ld.admin.ch/sfoe/bfe_ogd84_einmalverguetung_fuer_photovoltaikanlagen/Jahr\",\n        presets: { type: \"range\", from: \"\", to: \"\" },\n      },\n      dataFilters: { active: false, componentIris: [] },\n      calculation: { active: false, type: \"identity\" },\n    },\n    fields: {\n      x: {\n        componentIri:\n          \"https://energy.ld.admin.ch/sfoe/bfe_ogd84_einmalverguetung_fuer_photovoltaikanlagen/Jahr\",\n        sorting: { sortingType: \"byAuto\", sortingOrder: \"asc\" },\n      },\n      y: {\n        componentIri:\n          \"https://energy.ld.admin.ch/sfoe/bfe_ogd84_einmalverguetung_fuer_photovoltaikanlagen/AnzahlAnlagen\",\n      },\n    },\n  },\n};\n","type Object = Record<string, any>;\n\nconst KEY_SEPARATOR = \"__SEP__\";\nconst VALUE_SEPARATOR = \"=\";\nconst JOIN_SEPARATOR = \"||\";\nconst NUMBER_PREFIX = \"__NUM__\";\nconst NEWLINE_REPLACEMENT = \"__NL__\";\n\n/** Converts an object into a URL-friendly hash string. */\nexport const objectToHashString = (o: Object) => {\n  return `#${objectToKeyValuePairs(o).join(JOIN_SEPARATOR)}`;\n};\n\n/** Converts a URL-friendly hash string back into the original object. */\nexport const hashStringToObject = (hashString: string) => {\n  return keyValuePairsToObject(\n    decodeURIComponent(hashString.slice(1)).split(JOIN_SEPARATOR)\n  );\n};\n\nconst objectToKeyValuePairs = (o: Object) => {\n  const flatObject = flattenObject(o);\n  return Object.entries(flatObject).map(([k, v]) => {\n    return `${k}${VALUE_SEPARATOR}${v}`;\n  });\n};\n\nconst keyValuePairsToObject = (keyValuePairs: string[]) => {\n  const o: Object = {};\n  keyValuePairs.forEach((kv) => {\n    // Make sure we allow equal signs in the value - the first one is the actual separator.\n    const firstEqualIndex = kv.indexOf(VALUE_SEPARATOR);\n\n    if (firstEqualIndex === -1) {\n      return;\n    }\n\n    const k = kv.slice(0, firstEqualIndex);\n    const v = kv.slice(firstEqualIndex + 1);\n    o[k] = v;\n  });\n\n  return unflattenObject(o);\n};\n\nconst flattenObject = (o: Object, parentKey = \"\", result: Object = {}) => {\n  if (\n    typeof o === \"object\" &&\n    o !== null &&\n    !Array.isArray(o) &&\n    Object.keys(o).length === 0\n  ) {\n    result[parentKey] = \"{}\";\n\n    return result;\n  }\n\n  for (const k in o) {\n    if (o.hasOwnProperty(k)) {\n      const newKey = parentKey ? `${parentKey}${KEY_SEPARATOR}${k}` : k;\n      const v = o[k];\n\n      if (typeof v === \"object\" && v !== null && !Array.isArray(v)) {\n        if (Object.keys(v).length === 0) {\n          result[newKey] = \"{}\";\n        } else {\n          flattenObject(v, newKey, result);\n        }\n      } else if (Array.isArray(v)) {\n        if (v.length === 0) {\n          result[newKey] = \"[]\";\n        } else {\n          v.forEach((item, index) => {\n            const arrayKey = `${newKey}${KEY_SEPARATOR}${index}`;\n            if (typeof item === \"object\" && item !== null) {\n              flattenObject(item, arrayKey, result);\n            } else {\n              result[arrayKey] =\n                typeof item === \"string\"\n                  ? item.replace(/\\n/g, NEWLINE_REPLACEMENT)\n                  : `${item}`;\n            }\n          });\n        }\n      } else {\n        result[newKey] =\n          typeof v === \"number\"\n            ? `${NUMBER_PREFIX}${v}`\n            : typeof v === \"string\"\n              ? v.replace(/\\n/g, NEWLINE_REPLACEMENT)\n              : `${v}`;\n      }\n    }\n  }\n  return result;\n};\n\nconst parseValue = (v: any) => {\n  if (v === \"true\") return true;\n  if (v === \"false\") return false;\n  if (v === \"null\") return null;\n  if (v === \"undefined\") return undefined;\n  if (v === \"[]\") return [];\n  if (v === \"{}\") return {};\n  if (typeof v === \"string\" && v.startsWith(NUMBER_PREFIX)) {\n    const num = v.slice(NUMBER_PREFIX.length);\n\n    if (num !== \"\" && !isNaN(+num)) {\n      return +num;\n    }\n  }\n\n  if (typeof v === \"string\") {\n    return v.replace(new RegExp(NEWLINE_REPLACEMENT, \"g\"), \"\\n\");\n  }\n\n  return v;\n};\n\nconst unflattenObject = (o: Object) => {\n  const result: Object = {};\n\n  for (const rootKey in o) {\n    if (o.hasOwnProperty(rootKey)) {\n      const keys = rootKey.split(KEY_SEPARATOR);\n      keys.reduce((acc, k, i) => {\n        if (i === keys.length - 1) {\n          acc[k] = o[rootKey];\n        } else {\n          if (!(k in acc)) {\n            acc[k] = {};\n          }\n\n          return acc[k];\n        }\n\n        return acc;\n      }, result);\n    }\n  }\n\n  const transformArraysAndScalars = (obj: any) => {\n    if (typeof obj !== \"object\" || obj === null) {\n      return parseValue(obj);\n    }\n\n    for (const k in obj) {\n      if (obj.hasOwnProperty(k)) {\n        obj[k] = transformArraysAndScalars(obj[k]);\n      }\n    }\n\n    const keys = Object.keys(obj);\n\n    if (keys.length > 0 && keys.every((k) => !isNaN(Number(k)))) {\n      const sortedKeys = keys.sort((a, b) => Number(a) - Number(b));\n      const arr = sortedKeys.map((numKey) => obj[numKey]);\n\n      return arr;\n    }\n\n    return obj;\n  };\n\n  return transformArraysAndScalars(result);\n};\n","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/_preview\",\n      function () {\n        return require(\"private-next-pages/_preview.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/_preview\"])\n      });\n    }\n  "],"names":["loadIframe","id","config","iframe","document","getElementById","handleMessage","e","data","type","source","contentWindow","postMessage","window","removeEventListener","addEventListener","__webpack_exports__","Page","locale","useLocale","useEffect","CONFIGURATOR_STATE_MAP","_jsxs","Box","sx","display","gap","p","width","height","border","children","_jsx","src","objectToHashString","CONFIGURATOR_STATE_COLUMN","state","dataSet","dataSource","url","meta","title","de","fr","it","en","description","chartConfig","version","chartType","filters","value","interactiveFiltersConfig","legend","active","componentIri","timeRange","presets","from","to","dataFilters","componentIris","calculation","fields","x","sorting","sortingType","sortingOrder","y","KEY_SEPARATOR","NUMBER_PREFIX","NEWLINE_REPLACEMENT","o","objectToKeyValuePairs","join","hashStringToObject","hashString","keyValuePairsToObject","decodeURIComponent","slice","split","Object","entries","flattenObject","map","_ref","k","v","keyValuePairs","forEach","kv","firstEqualIndex","indexOf","unflattenObject","parentKey","arguments","length","undefined","result","Array","isArray","keys","hasOwnProperty","newKey","item","index","arrayKey","replace","parseValue","startsWith","num","isNaN","rootKey","reduce","acc","i","transformArraysAndScalars","obj","every","Number","sortedKeys","sort","a","b","numKey","__NEXT_P","push","__webpack_require__"],"sourceRoot":""}