(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[39175],{1283:function(e,t,r){"use strict";r.d(t,{F:function(){return G}});var a=r(17043),s=r(90089),n=r(96338),i=r(19914),o=r(60116),c=r(64986),l=r(40624),d=r(27378),u=r(58555),p=r(97091),h=r(48863),y=r(62050),x=r(93477),f=r(78222),b=r(16370),g=r(97971),j=r(47612),m=r(52137),O=r(32597),v=r(78081),w=r(10369),k=r(65619),P=r(53082),C=r(17899),S=r(5680),E=r(78839),D=r(25390),F=r(71238),Z=r(62075),K=r(56436),B=r(87182),_=r(80207),M=r(94460),I=r(49148),N=r(8788),T=r(82395),L=r(24246);let R=["dataSource","state","chartConfig","configKey","children","embedParams","shouldShrink"];function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach(function(t){(0,a.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let z=(0,d.forwardRef)((e,t)=>{let{dataSource:r,state:a,chartConfig:n,configKey:i,children:o,embedParams:c,shouldShrink:l}=e,u=(0,s.Z)(e,R),p=(0,d.useMemo)(()=>(0,S.ag)(),[]);return(0,L.jsx)(S.ax.Provider,{value:p,children:(0,L.jsx)(v.Ig,{children:(0,L.jsx)(m.hC,W(W({layout:a.layout,ref:t,chartKey:n.key},u),{},{children:(0,L.jsx)($,{dataSource:r,state:a,chartConfig:n,configKey:i,metadataPanelStore:p,embedParams:c,shouldShrink:l,children:o},n.key)}),n.key)},n.key)})}),G=e=>{let{configKey:t,embedParams:r,shouldShrink:a,isPreview:s}=e,[n]=(0,F.lY)(F.s9),{dataSource:c}=n,l=(0,I.bU)(),u=(0,d.useMemo)(()=>(0,S.ag)(),[]),p=J({shrink:!0}),h=(0,d.useCallback)(e=>(0,L.jsx)(z,{dataSource:c,state:n,chartConfig:e,configKey:t,embedParams:r},e.key),[t,c,r,n]),y=(0,d.useCallback)(e=>{switch(e.type){case"chart":return h(n.chartConfigs.find(t=>t.key===e.key));case"text":return(0,E.aW)(e);default:return e}},[n.chartConfigs,h]),f=(0,d.useCallback)(e=>{let{height:t}=e;window.parent.postMessage({type:x.m2,height:t},"*")},[]),[b]=(0,T.y)(f);return(0,L.jsx)(S.ax.Provider,{value:u,children:(0,L.jsx)(N.ch,{chartConfigs:n.chartConfigs,children:(0,L.jsx)(o.Z,{ref:b,children:"dashboard"===n.layout.type?(0,L.jsxs)(o.Z,{className:p.dashboardBoxWrapper,children:[n.layout.meta.title[l]||n.layout.meta.description[l]?(0,L.jsxs)(P.k,{flexDirection:"column",children:[n.layout.meta.title[l]&&(0,L.jsx)(Z.Dx,{text:n.layout.meta.title[l]}),n.layout.meta.description[l]&&(0,L.jsx)(Z.dk,{text:n.layout.meta.description[l]})]}):null,(0,L.jsx)(m.WK,{layoutType:n.layout.layout,renderBlock:y}),1!==n.chartConfigs.length&&t&&(0,L.jsx)(j.cS,{configKey:t,createdWith:i.ag._({id:"metadata.link.created.with"})})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(P.k,{sx:{flexDirection:"column",mb:n.layout.meta.title[l]||n.layout.meta.description[l]?4:0},children:[n.layout.meta.title[l]&&(0,L.jsx)(Z.Dx,{text:n.layout.meta.title[l]}),n.layout.meta.description[l]&&(0,L.jsx)(Z.dk,{text:n.layout.meta.description[l]})]}),(0,L.jsxs)(v.Ig,{children:[(0,L.jsx)(k.u,{}),(0,L.jsx)(m.hC,{layout:n.layout,chartKey:n.activeChartKey,children:(0,L.jsx)($,{dataSource:c,state:n,chartConfig:(0,D.f6)(n),configKey:t,metadataPanelStore:u,embedParams:r,shouldShrink:a,isPreview:s})})]})]})})})})},J=(0,c.Z)(e=>({root:{position:"relative",paddingLeft:t=>{let{shrink:r}=t;return`calc(${e.spacing(5)} + ${r?K.pG:0}px)`},padding:t=>{let{optimizeSpace:r}=t;return r?e.spacing(3):e.spacing(6)},transition:"padding 0.25s ease"},dashboardBoxWrapper:{[e.breakpoints.up("xs")]:{padding:e.spacing(5,4,2,4)},[e.breakpoints.up("md")]:{padding:e.spacing(5)},[e.breakpoints.up("lg")]:{padding:e.spacing(6)},gap:16,display:"flex",flexDirection:"column",backgroundColor:e.palette.cobalt[50]}})),V=e=>{let{dataSource:t=B.Ve,state:r,chartConfig:a,configKey:s,className:i,children:c,metadataPanelStore:x,embedParams:m,shouldShrink:k,isPreview:S}=e,{meta:E}=a,D=(0,d.useRef)(null),{isTable:F,computeContainerHeight:T}=(0,v.IS)(),R=(0,u.oR)(x,e=>e.open),U=(0,d.useMemo)(()=>{let e=D.current?.getBoundingClientRect().width;return!!e&&(k??(R&&e>2*K.pG))},[k,R]);(0,d.useEffect)(()=>{let e=x.subscribe(()=>{T()});return()=>e()});let z=(0,O.TZ)({removeBorder:m?.removeBorder}),G=J({shrink:U,optimizeSpace:m?.optimizeSpace}),V=(0,I.bU)(),$=(0,B.Id)(t),A={sourceType:t.type,sourceUrl:t.url,locale:V},[{data:H}]=(0,_.bi)({variables:{sourceType:t.type,sourceUrl:t.url,locale:V,cubeFilters:a.cubes.map(e=>({iri:e.iri}))}}),X=H?.dataCubesMetadata,q=(0,p.Zl)(r.chartConfigs),[{data:Y}]=(0,_.k$)({chartConfig:a,variables:W(W({},A),{},{cubeFilters:a.cubes.map(e=>({iri:e.iri,componentIds:q,joinBy:e.joinBy}))})}),Q=Y?.dataCubesComponents,ee=Q?.dimensions,et=Q?.measures,er=(0,d.useMemo)(()=>ee&&et?[...ee,...et]:[],[ee,et]);return(0,L.jsxs)(o.Z,{ref:D,className:(0,l.Z)(z.root,z.pastEditing,G.root,i),children:[c,(0,L.jsxs)(g.x,{resetKeys:[a],children:[(0,L.jsxs)("div",{children:[X?.some(e=>e.publicationStatus===M.sl.Draft)&&(0,L.jsx)(o.Z,{sx:{mb:4},children:(0,L.jsx)(C.BI,{children:(0,L.jsx)(n.cC,{id:"dataset.publicationStatus.draft.warning",components:{0:(0,L.jsx)("br",{}),1:(0,L.jsx)("strong",{})}})})}),X?.some(e=>e.expires)&&(0,L.jsx)(o.Z,{sx:{mb:4},children:(0,L.jsx)(C.BI,{children:(0,L.jsx)(n.cC,{id:"dataset.publicationStatus.expires.warning",components:{0:(0,L.jsx)("br",{}),1:(0,L.jsx)("strong",{})}})})}),!$&&(0,L.jsx)(o.Z,{sx:{mb:4},children:(0,L.jsx)(C.m0,{children:(0,L.jsx)(n.cC,{id:"data.source.notTrusted"})})}),(0,y.v5)(a)&&(0,L.jsx)(o.Z,{sx:{mb:4},children:(0,L.jsx)(C.pd,{children:(0,L.jsx)(n.cC,{id:"dataset.hasImputedValues"})})})]}),(0,L.jsx)(h.p,{children:(0,L.jsxs)(N.Zg,{chartConfigKey:a.key,children:[(0,L.jsxs)(P.k,{sx:{height:"fit-content",justifyContent:E.title[V]?"space-between":"flex-end",gap:2},children:[E.title[V]?(0,L.jsx)(Z.Dx,{text:E.title[V],smaller:!0}):(0,L.jsx)("span",{style:{height:1}}),m?.removeMoreOptionsButton?null:(0,L.jsx)(f.G,{children:(0,L.jsx)(O.iA,{configKey:s,chartKey:a.key,chartWrapperNode:D.current,components:er,disableDatabaseRelatedActions:S})})]}),E.description[V]?(0,L.jsx)(Z.dk,{text:E.description[V],smaller:!0}):(0,L.jsx)("span",{style:{height:1}}),(0,L.jsx)(O.xx,{dataSource:t,chartConfig:a,dashboardFilters:r.dashboardFilters,metadataPanelProps:m?.removeMoreOptionsButton?void 0:{components:er,container:D.current,allowMultipleOpen:!0}}),(0,L.jsx)(v.S4,{children:F?(0,L.jsx)(b._,{dataSource:t,chartConfig:a,dashboardFilters:r.dashboardFilters,sx:{maxHeight:"100%"}}):(0,L.jsx)(w.I,{dataSource:t,componentIds:q,chartConfig:a,dashboardFilters:r.dashboardFilters,embedParams:m})}),(0,L.jsx)(j.Tc,{configKey:s,dataSource:t,chartConfig:a,dashboardFilters:r.dashboardFilters,components:er,showVisualizeLink:"dashboard"!==r.layout.type||"dashboard"===r.layout.type&&1===r.chartConfigs.length,hideFilters:m?.removeFilters,hideMetadata:m?.removeFootnotes,metadataPanelProps:m?.removeMoreOptionsButton?{components:er,container:D.current,allowMultipleOpen:!0}:void 0})]})})]})]})},$=e=>(0,d.createElement)(V,W(W({},e),{},{key:e.chartConfig.key}))},83025:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var a=r(17043),s=r(96338),n=r(88424),i=r(27378),o=r(58555),c=r(1283),l=r(50953),d=r(15658),u=r(9707),p=r(93912),h=r(49148),y=r(90453),x=r(76394),f=r(31853),b=r(31251),g=r(24246);function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){(0,a.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let O=e=>e.data&&!e.data.type,v=(0,o.ZP)(e=>({state:null,setState:t=>e({state:t})})),w=async e=>{try{let t=(0,l.FJ)(m(m({},await (0,x.qm)(e)),{},{state:"PUBLISHED"}));t&&(await fetch("/api/config/view",{method:"POST",body:JSON.stringify({type:"preview"})}),v.setState({state:t}))}catch(e){console.error(e)}};function k(){let e=(0,h.bU)();p.ag.activate(e);let t=(0,o.oR)(v,e=>e.state),r=(0,b.K)();return(0,i.useEffect)(()=>{r?.parent?.postMessage({type:"ready"},"*")},[r]),(0,i.useEffect)(()=>{if(!r)return;let e=async e=>{O(e)&&await w(e.data)},t=async()=>{let e=r.location.hash;e&&await w((0,f.e)(e))};return r.addEventListener("message",e),r.addEventListener("hashchange",t),t(),()=>{r.removeEventListener("message",e),r.removeEventListener("hashchange",t)}},[r]),(0,g.jsx)(h.Iw,{value:e,children:(0,g.jsx)(s.bd,{i18n:p.ag,children:(0,g.jsx)(u.c,{children:(0,g.jsx)(n.Z,{theme:y.r,children:t?(0,g.jsx)(d.c7,{chartId:"published",initialState:t,children:(0,g.jsx)(c.F,m({configKey:"preview",isPreview:!0},t))},JSON.stringify(t)):null})})})})}},81624:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/preview",function(){return r(83025)}])}},function(e){e.O(0,[31434,88033,68143,72159,54568,96761,2386,22686,25592,17671,65362,92888,49774,40179],function(){return e(e.s=81624)}),_N_E=e.O()}]);
//# sourceMappingURL=preview-8b50ea405e0fcd1f.js.map