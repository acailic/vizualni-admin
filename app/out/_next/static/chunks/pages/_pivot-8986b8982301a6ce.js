(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[35673],{60906:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return I}});var a,i=r(17043),n=r(53377),l=r(7818),s=r(60116),o=r(87026),d=r(65637),c=r(971),p=r(52936),u=r(22768),h=r(28179),m=r(27378),b=r(40624),j=r(55839),v=r.n(j),f=r(64986),x=r(24246);let g=["name"],y=["children","className","clone","component"];var w=r(38354),Z=r.n(w),O=r(25389),C=r.n(O),T=r(48683),k=r(60378),P=r(17899),N=r(80207),E=r(57060),_=r(77142);function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let M=(a=n.Z,(e,t={})=>{let r;let{name:i}=t,n=(0,h.Z)(t,g),l=(0,f.Z)("function"==typeof e?t=>({root:r=>e((0,u.Z)({theme:t},r))}):{root:e},(0,u.Z)({Component:a,name:i||a.displayName,classNamePrefix:i},n));e.filterProps&&(r=e.filterProps,delete e.filterProps),e.propTypes&&(e.propTypes,delete e.propTypes);let s=m.forwardRef(function(e,t){let{children:i,className:n,clone:s,component:o}=e,d=(0,h.Z)(e,y),c=l(e),p=(0,b.Z)(c.root,n),j=d;if(r&&(j=function(e,t){let r={};return Object.keys(e).forEach(a=>{-1===t.indexOf(a)&&(r[a]=e[a])}),r}(j,r)),s)return m.cloneElement(i,(0,u.Z)({className:(0,b.Z)(i.props.className,p)},j));if("function"==typeof i)return i((0,u.Z)({className:p},j));let v=o||a;return(0,x.jsx)(v,(0,u.Z)({ref:t,className:p},j,{children:i}))});return v()(s,a),s})({border:"1px solid #ccc",backgroundColor:"#eee",padding:"1rem",marginTop:16,marginBottom:16}),B={sourceUrl:"https://lindas-cached.int.cluster.ldbar.ch/query",sourceType:"sparql"},G=C()({"https://environment.ld.admin.ch/foen/fab_Offentliche_Ausgaben_test3/8":{label:"ausgaben",datasource:B},"https://environment.ld.admin.ch/foen/ubd000502_sad_01/7":{label:"Gas",datasource:B}},(e,t)=>S(S({},e),{},{iri:t})),H=(0,f.Z)(e=>({pivotTableRoot:{display:"grid",gridTemplateColumns:"280px 1fr",gridTemplateAreas:`
"options chart"
    `,gridGap:"1rem"},pivotTableOptions:{paddingTop:"1rem",gridArea:"options"},pivotTableChart:{gridArea:"chart",overflowX:"hidden"},pivotTableContainer:{overflowX:"scroll"},pivotTableTable:{width:"100%",fontSize:"12px",borderCollapse:"collapse","& td, & th":{border:"1px solid #ccc",whiteSpace:"nowrap",padding:"4px"}},optionGroup:{"& + &":{marginTop:"0.75rem"}},row:{transition:"background-color 0.3s ease"},expanded:{},depth_0:{"&$expanded":{background:(0,l.$n)(e.palette.primary.light,.75)}},depth_1:{"&$expanded":{background:(0,l.$n)(e.palette.primary.light,.5)}},depth_2:{"&$expanded":{background:(0,l.$n)(e.palette.primary.light,.15)}}})),R=e=>{let t=new Map,r=new Map,a=new Map,i=new Map;return(0,E.tn)(e,e=>{t.set(e.label,e),i.set(e.value,e);let n=e.children;if(n)for(let t of(a.set(e.value,n),n))r.set(t.value,e)}),{byLabel:t,parentsByIri:r,childrenByIri:a,byIri:i}},A=(0,f.Z)(e=>({root:{backgroundColor:e.palette.primary.main}})),D=e=>{let{percent:t}=e,r=A();return(0,x.jsx)("div",{className:r.root,style:{height:4,width:100*t/100}})},z=e=>{let{dataset:t}=e,{0:r,1:a}=(0,m.useState)({}),{0:i,1:n}=(0,m.useState)(),{0:l,1:u}=(0,m.useState)(),{0:h,1:j}=(0,m.useState)({}),[{data:v,fetching:f}]=(0,N.k$)({chartConfig:{conversionUnitsByComponentId:{}},variables:S(S({},B),{},{locale:"en",cubeFilters:[{iri:t.iri}]})}),[{data:g,fetching:y}]=(0,N.XO)({chartConfig:{conversionUnitsByComponentId:{}},variables:S(S({},B),{},{locale:"en",cubeFilters:[{iri:t.iri}]})}),w=H(),O=v?.dataCubesComponents?.dimensions,C=(0,m.useMemo)(()=>O?.filter(e=>!h[e.id]),[O,h]),E=v?.dataCubesComponents?.measures,$=(0,m.useMemo)(()=>g?.dataCubesObservations?.data??[],[g?.dataCubesObservations?.data]),G=(0,_.z)(e=>{let t=e.currentTarget.getAttribute("name");t&&a(e=>e?S(S({},e),{},{[t]:!e[t]}):{})}),A=(0,_.z)(e=>{let t=e.currentTarget.getAttribute("name");t&&j(e=>e?S(S({},e),{},{[t]:!e[t]}):{})}),z=v?.dataCubesComponents.dimensions.find(e=>e.id===l?.id)?.hierarchy,I=(0,m.useMemo)(()=>{if(z)return R(z)},[z]),{pivotted:U,pivotUniqueValues:X,tree:q}=(0,m.useMemo)(()=>{if(!i||!C||!E)return{pivotted:[],pivotUniqueValues:[]};{let e=C.filter(e=>e!==i)||[],t=t=>e.map(e=>t[e.id]).join("/"),r=Object.values(Z()($,t=>e?.map(e=>t[e.id]).join("/"))),a=new Set,n=new Map,s=[];r.forEach(r=>{let l=Object.fromEntries(e.map(e=>[e.id,r[0][e.id]]));for(let e of r)l[`${i.id}/${e[i.id]}`]=Object.fromEntries(E.map(t=>[t.id,e[t.id]])),a.add(e[i.id]);n.set(t(l),l),s.push(l)});let o=[];return s.forEach(e=>{if(l&&I){let r=e[l.id],a=I.byLabel.get(r),i=I.parentsByIri.get(a?.value),s=t(S(S({},e),{},{[l.id]:i?.label})),d=n.get(s);d?(d.subRows=d.subRows||[],d.subRows.push(e)):o.push(e);return}o.push(e)}),{pivotted:s,tree:o,pivotUniqueValues:Array.from(a).sort()}}},[i,C,E,$,l,I]),F=(0,m.useMemo)(()=>{if(!C||!E)return[];if(!i)return[...C,...E].map(e=>({accessor:t=>t[e.id],Header:e.label}));{let e=C.filter(e=>e.id!==i.id).sort(e=>e.id===l?.id?1:0).map(e=>({id:e.id,accessor:t=>t[e.id],Header:e.label})),t=X.map(e=>({Header:e,columns:E.filter(e=>r?.[e.id]!==!1).map(t=>{let r=t.label.includes("%");return{Header:t.label,Cell:e=>{let{cell:t}=e;return(0,x.jsxs)(x.Fragment,{children:[t.value,r?(0,x.jsx)(D,{percent:parseFloat(t.value)}):null]})},id:`${i.id}/${e}/${t.id}`,accessor:r=>r[`${i.id}/${e}`]?.[t.id]||""}})}));return[...e.map(e=>e.id===l?.id?S(S({},e),{},{Cell:e=>{let{cell:t,row:r}=e,a={paddingLeft:`${1*r.depth}rem`};return(0,x.jsxs)("span",S(S({},r.canExpand?r.getToggleRowExpandedProps({style:a}):{style:a}),{},{children:[r.canExpand?r.isExpanded?"▼  ":"▶  ":null,t.value]}))}}):e),...t]}},[C,E,i,X,l?.id,r]),{getTableProps:L,getTableBodyProps:V,headerGroups:J,rows:K,prepareRow:Q,expandedDepth:W}=(0,k.useTable)({columns:F,data:i&&q?q:$},k.useSortBy,k.useExpanded);return(0,m.useEffect)(()=>{!Object.keys(r).length&&E&&a(Object.fromEntries(E.map(e=>[e.id,!0])))},[r,E]),(0,x.jsxs)(s.Z,{className:w.pivotTableRoot,children:[(0,x.jsxs)("div",{className:w.pivotTableOptions,children:[(0,x.jsxs)("div",{className:w.optionGroup,children:[(0,x.jsx)(o.Z,{variant:"h6",gutterBottom:!0,display:"block",children:"Pivot columns"}),(0,x.jsxs)("select",{onChange:e=>{let t=e.currentTarget.value;n(C?.find(e=>e.id===t))},value:i?.id||"-",children:[(0,x.jsx)("option",{value:"-",children:"-"}),C?.map(e=>x.jsx("option",{value:e.id,children:e.label},e.id))]})]}),(0,x.jsxs)("div",{className:w.optionGroup,children:[(0,x.jsx)(o.Z,{variant:"h6",gutterBottom:!0,display:"block",children:"Group rows by"}),(0,x.jsxs)("select",{onChange:e=>{let t=e.currentTarget.value;u(C?.find(e=>e.id===t))},value:l?.id||"-",children:[(0,x.jsx)("option",{value:"-",children:"-"}),C?.map(e=>x.jsx("option",{value:e.id,children:e.label},e.id))]}),f?(0,x.jsx)(d.Z,{size:12,sx:{ml:2}}):null]}),(0,x.jsxs)("div",{className:w.optionGroup,children:[(0,x.jsx)(o.Z,{variant:"h6",gutterBottom:!0,display:"block",children:"Measures"}),E?.map(e=>x.jsx(c.Z,{label:e.label,componentsProps:{typography:{variant:"caption"}},control:x.jsx(p.Z,{size:"small",checked:r?.[e.id],onChange:G,name:e.id})},e.id))]}),(0,x.jsxs)("div",{className:w.optionGroup,children:[(0,x.jsx)(o.Z,{variant:"h6",display:"block",children:"Ignored dimensions"}),(0,x.jsxs)(o.Z,{variant:"caption",gutterBottom:!0,display:"block",children:["If some dimensions contain duplicate information with another dimension, it is necessary to ignore them for the grouping to work.",(0,x.jsx)("br",{}),"Ex: the Hierarchy column of the Gas dataset is a duplicate of the Source of emission column, it needs to be ignored."]}),O?.map(e=>x.jsx(c.Z,{label:e.label,componentsProps:{typography:{variant:"caption"}},control:x.jsx(p.Z,{size:"small",checked:h?.[e.id],onChange:A,name:e.id})},e.id))]})]}),(0,x.jsxs)("div",{className:w.pivotTableChart,children:[(0,x.jsx)(M,{elevation:0,children:(0,x.jsxs)("details",{children:[(0,x.jsx)("summary",{children:(0,x.jsx)(o.Z,{variant:"h6",display:"inline",children:"Debug"})}),(0,x.jsx)(o.Z,{variant:"overline",display:"block",children:"Columns"}),(0,x.jsx)(T.lj,{data:F,table:!1}),(0,x.jsx)(o.Z,{variant:"overline",display:"block",children:"Pivoted"}),(0,x.jsx)(T.lj,{data:U,table:!1}),(0,x.jsx)(o.Z,{variant:"overline",display:"block",children:"Pivoted tree"}),(0,x.jsx)(T.lj,{data:q,table:!1}),(0,x.jsx)(o.Z,{variant:"overline",display:"block",children:"Hierarchy"}),(0,x.jsx)(T.lj,{data:z,table:!1}),(0,x.jsx)(o.Z,{variant:"overline",display:"block",children:"Hierarchy indexes"}),(0,x.jsx)(T.lj,{data:I,table:!1})]})}),f||y?(0,x.jsx)(P.gb,{}):null,(0,x.jsx)("div",{className:w.pivotTableContainer,children:(0,x.jsxs)("table",S(S({},L()),{},{className:w.pivotTableTable,children:[(0,x.jsx)("thead",{children:J.map(e=>(0,x.jsx)("tr",S(S({},e.getHeaderGroupProps()),{},{children:e.headers.map(e=>(0,x.jsxs)("th",S(S({},e.getHeaderProps(e.getSortByToggleProps())),{},{children:[e.render("Header"),(0,x.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \uD83D\uDD3D":" \uD83D\uDD3C":""})]})))})))}),(0,x.jsx)("tbody",S(S({},V()),{},{children:K.map(e=>(Q(e),(0,x.jsx)("tr",S(S({},e.getRowProps()),{},{className:(0,b.Z)(w.row,e.isExpanded?w.expanded:null,w[`depth_${W-e.depth}`]),children:e.cells.map(e=>(0,x.jsx)("td",S(S({},e.getCellProps()),{},{children:e.render("Cell")})))}))))}))]}))})]})]})};var I=()=>{let{0:e,1:t}=(0,m.useState)(G[Object.keys(G)[0]]);return(0,x.jsxs)(s.Z,{m:5,children:[(0,x.jsx)(o.Z,{variant:"h2",children:"Pivot table"}),(0,x.jsx)(o.Z,{variant:"overline",display:"block",children:"Dataset"}),(0,x.jsx)("select",{onChange:e=>{let r=e.currentTarget.value;r in G&&t(G[r])},value:e.iri,children:Object.keys(G).map(e=>{let t=G[e];return(0,x.jsx)("option",{value:t.iri,children:t.label},t.iri)})}),(0,x.jsx)(z,{dataset:e},e.iri)]})}},64298:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_pivot",function(){return r(60906)}])}},function(e){e.O(0,[31434,88033,68143,72159,54568,96761,2386,22686,60378,48683,25592,17671,65362,92888,49774,40179],function(){return e(e.s=64298)}),_N_E=e.O()}]);
//# sourceMappingURL=_pivot-8986b8982301a6ce.js.map